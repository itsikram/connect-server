/*! For license information please see main.f6dfe536.js.LICENSE.txt */
(()=>{var e={97:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(9713),i=n(888),a=n(8726);function o(e){if((0,a.A)(1,arguments),!(0,r.default)(e)&&"number"!==typeof e)return!1;var t=(0,i.default)(e);return!isNaN(Number(t))}},147:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){(0,i.A)(1,arguments);var t=(0,r.default)(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}},216:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n(888),i=n(618),a=n(8726);function o(e){return(0,a.A)(1,arguments),(0,i.default)(e,{weekStartsOn:1})}function s(e){(0,a.A)(1,arguments);var t=function(e){(0,a.A)(1,arguments);var t=(0,r.default)(e),n=t.getFullYear(),i=new Date(0);i.setFullYear(n+1,0,4),i.setHours(0,0,0,0);var s=o(i),c=new Date(0);c.setFullYear(n,0,4),c.setHours(0,0,0,0);var u=o(c);return t.getTime()>=s.getTime()?n+1:t.getTime()>=u.getTime()?n:n-1}(e),n=new Date(0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),o(n)}var c=6048e5;function u(e){(0,a.A)(1,arguments);var t=(0,r.default)(e),n=o(t).getTime()-s(t).getTime();return Math.round(n/c)+1}},219:(e,t,n)=>{"use strict";var r=n(3763),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function c(e){return r.isMemo(e)?o:s[e.$$typeof]||i}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[r.Memo]=o;var u=Object.defineProperty,l=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,p=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(p){var i=h(n);i&&i!==p&&e(t,i,r)}var o=l(n);d&&(o=o.concat(d(n)));for(var s=c(t),m=c(n),g=0;g<o.length;++g){var v=o[g];if(!a[v]&&(!r||!r[v])&&(!m||!m[v])&&(!s||!s[v])){var y=f(n,v);try{u(t,v,y)}catch(b){}}}}return t}},246:function(e){e.exports=function(){function e(e){return new Int8Array(e)}function t(e){return new Int16Array(e)}function n(e){return new Int32Array(e)}function r(e){return new Float32Array(e)}function i(e){return new Float64Array(e)}function a(e){if(1==e.length)return r(e[0]);var t=e[0];e=e.slice(1);for(var n=[],i=0;i<t;i++)n.push(a(e));return n}function o(e){if(1==e.length)return n(e[0]);var t=e[0];e=e.slice(1);for(var r=[],i=0;i<t;i++)r.push(o(e));return r}function s(e){if(1==e.length)return t(e[0]);var n=e[0];e=e.slice(1);for(var r=[],i=0;i<n;i++)r.push(s(e));return r}function c(e){if(1==e.length)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var n=[],r=0;r<t;r++)n.push(c(e));return n}var u={fill:function(e,t,n,r){if(2==arguments.length)for(var i=0;i<e.length;i++)e[i]=arguments[1];else for(i=t;i<n;i++)e[i]=r}},l={arraycopy:function(e,t,n,r,i){for(var a=t+i;t<a;)n[r++]=e[t++]}},d={};function f(e){this.ordinal=e}d.SQRT2=1.4142135623730951,d.FAST_LOG10=function(e){return Math.log10(e)},d.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},f.short_block_allowed=new f(0),f.short_block_coupled=new f(1),f.short_block_dispensed=new f(2),f.short_block_forced=new f(3);var h={};function p(e){this.ordinal=e}h.MAX_VALUE=34028235e31,p.vbr_off=new p(0),p.vbr_mt=new p(1),p.vbr_rh=new p(2),p.vbr_abr=new p(3),p.vbr_mtrh=new p(4),p.vbr_default=p.vbr_mtrh;var m={System:l,VbrMode:p,Float:h,ShortBlock:f,Util:d,Arrays:u,new_array_n:c,new_byte:e,new_double:i,new_float:r,new_float_n:a,new_int:n,new_int_n:o,new_short:t,new_short_n:s,assert:function(e){}},g=m.System,v=m.Util,y=m.Arrays,b=m.new_float;function _(){var e=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*v.SQRT2*.5/2384e-9,.017876148*v.SQRT2*.5/2384e-9,.003134727*v.SQRT2*.5/2384e-9,.002457142*v.SQRT2*.5/2384e-9,971317e-9*v.SQRT2*.5/2384e-9,218868e-9*v.SQRT2*.5/2384e-9,101566e-9*v.SQRT2*.5/2384e-9,13828e-9*v.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],t=12,n=36,r=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],i=r[j.SHORT_TYPE],a=r[j.SHORT_TYPE],o=r[j.SHORT_TYPE],s=r[j.SHORT_TYPE],c=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function u(t,n,r){for(var i,a,o,s=10,c=n+238-14-286,u=-15;u<0;u++){var l,d,f;l=e[s+-10],d=t[c+-224]*l,f=t[n+224]*l,l=e[s+-9],d+=t[c+-160]*l,f+=t[n+160]*l,l=e[s+-8],d+=t[c+-96]*l,f+=t[n+96]*l,l=e[s+-7],d+=t[c+-32]*l,f+=t[n+32]*l,l=e[s+-6],d+=t[c+32]*l,f+=t[n+-32]*l,l=e[s+-5],d+=t[c+96]*l,f+=t[n+-96]*l,l=e[s+-4],d+=t[c+160]*l,f+=t[n+-160]*l,l=e[s+-3],d+=t[c+224]*l,f+=t[n+-224]*l,l=e[s+-2],d+=t[n+-256]*l,f-=t[c+256]*l,l=e[s+-1],d+=t[n+-192]*l,f-=t[c+192]*l,l=e[s+0],d+=t[n+-128]*l,f-=t[c+128]*l,l=e[s+1],d+=t[n+-64]*l,f-=t[c+64]*l,l=e[s+2],d+=t[n+0]*l,f-=t[c+0]*l,l=e[s+3],d+=t[n+64]*l,f-=t[c+-64]*l,l=e[s+4],d+=t[n+128]*l,f-=t[c+-128]*l,l=e[s+5],d+=t[n+192]*l,l=(f-=t[c+-192]*l)-(d*=e[s+6]),r[30+2*u]=f+d,r[31+2*u]=e[s+7]*l,s+=18,n--,c++}f=t[n+-16]*e[s+-10],d=t[n+-32]*e[s+-2],f+=(t[n+-48]-t[n+16])*e[s+-9],d+=t[n+-96]*e[s+-1],f+=(t[n+-80]+t[n+48])*e[s+-8],d+=t[n+-160]*e[s+0],f+=(t[n+-112]-t[n+80])*e[s+-7],d+=t[n+-224]*e[s+1],f+=(t[n+-144]+t[n+112])*e[s+-6],d-=t[n+32]*e[s+2],f+=(t[n+-176]-t[n+144])*e[s+-5],d-=t[n+96]*e[s+3],f+=(t[n+-208]+t[n+176])*e[s+-4],d-=t[n+160]*e[s+4],f+=(t[n+-240]-t[n+208])*e[s+-3],i=(d-=t[n+224])-f,a=d+f,f=r[14],d=r[15]-f,r[31]=a+f,r[30]=i+d,r[15]=i-d,r[14]=a-f,o=r[28]-r[0],r[0]+=r[28],r[28]=o*e[s+-36+7],o=r[29]-r[1],r[1]+=r[29],r[29]=o*e[s+-36+7],o=r[26]-r[2],r[2]+=r[26],r[26]=o*e[s+-72+7],o=r[27]-r[3],r[3]+=r[27],r[27]=o*e[s+-72+7],o=r[24]-r[4],r[4]+=r[24],r[24]=o*e[s+-108+7],o=r[25]-r[5],r[5]+=r[25],r[25]=o*e[s+-108+7],o=r[22]-r[6],r[6]+=r[22],r[22]=o*v.SQRT2,o=r[23]-r[7],r[7]+=r[23],r[23]=o*v.SQRT2-r[7],r[7]-=r[6],r[22]-=r[7],r[23]-=r[22],o=r[6],r[6]=r[31]-o,r[31]=r[31]+o,o=r[7],r[7]=r[30]-o,r[30]=r[30]+o,o=r[22],r[22]=r[15]-o,r[15]=r[15]+o,o=r[23],r[23]=r[14]-o,r[14]=r[14]+o,o=r[20]-r[8],r[8]+=r[20],r[20]=o*e[s+-180+7],o=r[21]-r[9],r[9]+=r[21],r[21]=o*e[s+-180+7],o=r[18]-r[10],r[10]+=r[18],r[18]=o*e[s+-216+7],o=r[19]-r[11],r[11]+=r[19],r[19]=o*e[s+-216+7],o=r[16]-r[12],r[12]+=r[16],r[16]=o*e[s+-252+7],o=r[17]-r[13],r[13]+=r[17],r[17]=o*e[s+-252+7],o=-r[20]+r[24],r[20]+=r[24],r[24]=o*e[s+-216+7],o=-r[21]+r[25],r[21]+=r[25],r[25]=o*e[s+-216+7],o=r[4]-r[8],r[4]+=r[8],r[8]=o*e[s+-216+7],o=r[5]-r[9],r[5]+=r[9],r[9]=o*e[s+-216+7],o=r[0]-r[12],r[0]+=r[12],r[12]=o*e[s+-72+7],o=r[1]-r[13],r[1]+=r[13],r[13]=o*e[s+-72+7],o=r[16]-r[28],r[16]+=r[28],r[28]=o*e[s+-72+7],o=-r[17]+r[29],r[17]+=r[29],r[29]=o*e[s+-72+7],o=v.SQRT2*(r[2]-r[10]),r[2]+=r[10],r[10]=o,o=v.SQRT2*(r[3]-r[11]),r[3]+=r[11],r[11]=o,o=v.SQRT2*(-r[18]+r[26]),r[18]+=r[26],r[26]=o-r[18],o=v.SQRT2*(-r[19]+r[27]),r[19]+=r[27],r[27]=o-r[19],o=r[2],r[19]-=r[3],r[3]-=o,r[2]=r[31]-o,r[31]+=o,o=r[3],r[11]-=r[19],r[18]-=o,r[3]=r[30]-o,r[30]+=o,o=r[18],r[27]-=r[11],r[19]-=o,r[18]=r[15]-o,r[15]+=o,o=r[19],r[10]-=o,r[19]=r[14]-o,r[14]+=o,o=r[10],r[11]-=o,r[10]=r[23]-o,r[23]+=o,o=r[11],r[26]-=o,r[11]=r[22]-o,r[22]+=o,o=r[26],r[27]-=o,r[26]=r[7]-o,r[7]+=o,o=r[27],r[27]=r[6]-o,r[6]+=o,o=v.SQRT2*(r[0]-r[4]),r[0]+=r[4],r[4]=o,o=v.SQRT2*(r[1]-r[5]),r[1]+=r[5],r[5]=o,o=v.SQRT2*(r[16]-r[20]),r[16]+=r[20],r[20]=o,o=v.SQRT2*(r[17]-r[21]),r[17]+=r[21],r[21]=o,o=-v.SQRT2*(r[8]-r[12]),r[8]+=r[12],r[12]=o-r[8],o=-v.SQRT2*(r[9]-r[13]),r[9]+=r[13],r[13]=o-r[9],o=-v.SQRT2*(r[25]-r[29]),r[25]+=r[29],r[29]=o-r[25],o=-v.SQRT2*(r[24]+r[28]),r[24]-=r[28],r[28]=o-r[24],o=r[24]-r[16],r[24]=o,o=r[20]-o,r[20]=o,o=r[28]-o,r[28]=o,o=r[25]-r[17],r[25]=o,o=r[21]-o,r[21]=o,o=r[29]-o,r[29]=o,o=r[17]-r[1],r[17]=o,o=r[9]-o,r[9]=o,o=r[25]-o,r[25]=o,o=r[5]-o,r[5]=o,o=r[21]-o,r[21]=o,o=r[13]-o,r[13]=o,o=r[29]-o,r[29]=o,o=r[1]-r[0],r[1]=o,o=r[16]-o,r[16]=o,o=r[17]-o,r[17]=o,o=r[8]-o,r[8]=o,o=r[9]-o,r[9]=o,o=r[24]-o,r[24]=o,o=r[25]-o,r[25]=o,o=r[4]-o,r[4]=o,o=r[5]-o,r[5]=o,o=r[20]-o,r[20]=o,o=r[21]-o,r[21]=o,o=r[12]-o,r[12]=o,o=r[13]-o,r[13]=o,o=r[28]-o,r[28]=o,o=r[29]-o,r[29]=o,o=r[0],r[0]+=r[31],r[31]-=o,o=r[1],r[1]+=r[30],r[30]-=o,o=r[16],r[16]+=r[15],r[15]-=o,o=r[17],r[17]+=r[14],r[14]-=o,o=r[8],r[8]+=r[23],r[23]-=o,o=r[9],r[9]+=r[22],r[22]-=o,o=r[24],r[24]+=r[7],r[7]-=o,o=r[25],r[25]+=r[6],r[6]-=o,o=r[4],r[4]+=r[27],r[27]-=o,o=r[5],r[5]+=r[26],r[26]-=o,o=r[20],r[20]+=r[11],r[11]-=o,o=r[21],r[21]+=r[10],r[10]-=o,o=r[12],r[12]+=r[19],r[19]-=o,o=r[13],r[13]+=r[18],r[18]-=o,o=r[28],r[28]+=r[3],r[3]-=o,o=r[29],r[29]+=r[2],r[2]-=o}function l(e,t){for(var n=0;n<3;n++){var i,a,o,s,c,u;a=(s=e[t+6]*r[j.SHORT_TYPE][0]-e[t+15])+(i=e[t+0]*r[j.SHORT_TYPE][2]-e[t+9]),o=s-i,c=(s=e[t+15]*r[j.SHORT_TYPE][0]+e[t+6])+(i=e[t+9]*r[j.SHORT_TYPE][2]+e[t+0]),u=-s+i,i=2069978111953089e-26*(e[t+3]*r[j.SHORT_TYPE][1]-e[t+12]),s=2069978111953089e-26*(e[t+12]*r[j.SHORT_TYPE][1]+e[t+3]),e[t+0]=190752519173728e-25*a+i,e[t+15]=190752519173728e-25*-c+s,o=.8660254037844387*o*1907525191737281e-26,c=.5*c*1907525191737281e-26+s,e[t+3]=o-c,e[t+6]=o+c,a=.5*a*1907525191737281e-26-i,u=.8660254037844387*u*1907525191737281e-26,e[t+9]=a+u,e[t+12]=a-u,t++}}function d(e,t,n){var r,i,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w;o=n[17]-n[9],c=n[15]-n[11],u=n[14]-n[12],l=n[0]+n[8],d=n[1]+n[7],f=n[2]+n[6],h=n[3]+n[5],e[t+17]=l+f-h-(d-n[4]),i=(l+f-h)*a[19]+(d-n[4]),r=(o-c-u)*a[18],e[t+5]=r+i,e[t+6]=r-i,s=(n[16]-n[10])*a[18],d=d*a[19]+n[4],r=o*a[12]+s+c*a[13]+u*a[14],i=-l*a[16]+d-f*a[17]+h*a[15],e[t+1]=r+i,e[t+2]=r-i,r=o*a[13]-s-c*a[14]+u*a[12],i=-l*a[17]+d-f*a[15]+h*a[16],e[t+9]=r+i,e[t+10]=r-i,r=o*a[14]-s+c*a[12]-u*a[13],i=l*a[15]-d+f*a[16]-h*a[17],e[t+13]=r+i,e[t+14]=r-i,p=n[8]-n[0],g=n[6]-n[2],v=n[5]-n[3],y=n[17]+n[9],b=n[16]+n[10],_=n[15]+n[11],w=n[14]+n[12],e[t+0]=y+_+w+(b+n[13]),r=(y+_+w)*a[19]-(b+n[13]),i=(p-g+v)*a[18],e[t+11]=r+i,e[t+12]=r-i,m=(n[7]-n[1])*a[18],b=n[13]-b*a[19],r=y*a[15]-b+_*a[16]+w*a[17],i=p*a[14]+m+g*a[12]+v*a[13],e[t+3]=r+i,e[t+4]=r-i,r=-y*a[17]+b-_*a[15]-w*a[16],i=p*a[13]+m-g*a[14]-v*a[12],e[t+7]=r+i,e[t+8]=r-i,r=-y*a[16]+b-_*a[17]-w*a[15],i=p*a[12]-m+g*a[13]-v*a[14],e[t+15]=r+i,e[t+16]=r-i}this.mdct_sub48=function(e,a,f){for(var h=a,p=286,m=0;m<e.channels_out;m++){for(var v=0;v<e.mode_gr;v++){for(var _,w=e.l3_side.tt[v][m],E=w.xr,S=0,C=e.sb_sample[m][1-v],x=0,T=0;T<9;T++)for(u(h,p,C[x]),u(h,p+32,C[x+1]),x+=2,p+=64,_=1;_<32;_+=2)C[x-1][_]*=-1;for(_=0;_<32;_++,S+=18){var R=w.block_type,I=e.sb_sample[m][v],N=e.sb_sample[m][1-v];if(0!=w.mixed_block_flag&&_<2&&(R=0),e.amp_filter[_]<1e-12)y.fill(E,S+0,S+18,0);else{if(e.amp_filter[_]<1)for(T=0;T<18;T++)N[T][c[_]]*=e.amp_filter[_];if(R==j.SHORT_TYPE){for(T=-t/4;T<0;T++){var A=r[j.SHORT_TYPE][T+3];E[S+3*T+9]=I[9+T][c[_]]*A-I[8-T][c[_]],E[S+3*T+18]=I[14-T][c[_]]*A+I[15+T][c[_]],E[S+3*T+10]=I[15+T][c[_]]*A-I[14-T][c[_]],E[S+3*T+19]=N[2-T][c[_]]*A+N[3+T][c[_]],E[S+3*T+11]=N[3+T][c[_]]*A-N[2-T][c[_]],E[S+3*T+20]=N[8-T][c[_]]*A+N[9+T][c[_]]}l(E,S)}else{var k=b(18);for(T=-n/4;T<0;T++){var D,M;D=r[R][T+27]*N[T+9][c[_]]+r[R][T+36]*N[8-T][c[_]],M=r[R][T+9]*I[T+9][c[_]]-r[R][T+18]*I[8-T][c[_]],k[T+9]=D-M*i[3+T+9],k[T+18]=D*i[3+T+9]+M}d(E,S,k)}}if(R!=j.SHORT_TYPE&&0!=_)for(T=7;T>=0;--T){var L,O;L=E[S+T]*o[20+T]+E[S+-1-T]*s[28+T],O=E[S+T]*s[28+T]-E[S+-1-T]*o[20+T],E[S+-1-T]=L,E[S+T]=O}}}if(h=f,p=286,1==e.mode_gr)for(var P=0;P<18;P++)g.arraycopy(e.sb_sample[m][1][P],0,e.sb_sample[m][0][P],0,32)}}}var w=_,E=m.System,S=m.new_float,C=m.new_float_n;function x(){this.l=S(j.SBMAX_l),this.s=C([j.SBMAX_s,3]);var e=this;this.assign=function(t){E.arraycopy(t.l,0,e.l,0,j.SBMAX_l);for(var n=0;n<j.SBMAX_s;n++)for(var r=0;r<3;r++)e.s[n][r]=t.s[n][r]}}var T=x;function R(){this.thm=new T,this.en=new T}var I=R,N=m.System,A=m.VbrMode,k=m.new_array_n,D=m.new_float,M=m.new_float_n,L=m.new_int,O=m.assert;function P(){var e=w,t=I,n=P.FFTOFFSET,r=P.MPG_MD_MS_LR,i=null;this.psy=null;var a=null,o=null,s=null;this.setModules=function(e,t,n,r){i=e,this.psy=t,a=t,o=r,s=n};var c=new e;function u(e){var t,n;if(0!=e.ATH.useAdjust)if(n=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(n+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(n+=n,t+=t),2==e.mode_gr&&(n=Math.max(n,t)),n*=.5,(n*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var r=31.98*n+625e-6;e.ATH.adjust>=r?(e.ATH.adjust*=.075*r+.925,e.ATH.adjust<r&&(e.ATH.adjust=r)):e.ATH.adjustLimit>=r?e.ATH.adjust=r:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=r}else e.ATH.adjust=1}function l(e){var t,n;for(O(0<=e.bitrate_index&&e.bitrate_index<16),O(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(n=0;n<e.channels_out;++n){var r=0|e.l3_side.tt[t][n].block_type;0!=e.l3_side.tt[t][n].mixed_block_flag&&(r=4),e.bitrate_blockType_Hist[e.bitrate_index][r]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][r]++,e.bitrate_blockType_Hist[15][5]++}}function d(e,t){var n,r,i=e.internal_flags;if(0==i.lame_encode_frame_init){var a,o,s=D(2014),u=D(2014);for(i.lame_encode_frame_init=1,a=0,o=0;a<286+576*(1+i.mode_gr);++a)a<576*i.mode_gr?(s[a]=0,2==i.channels_out&&(u[a]=0)):(s[a]=t[0][o],2==i.channels_out&&(u[a]=t[1][o]),++o);for(r=0;r<i.mode_gr;r++)for(n=0;n<i.channels_out;n++)i.l3_side.tt[r][n].block_type=P.SHORT_TYPE;c.mdct_sub48(i,s,u),O(576>=P.FFTOFFSET),O(i.mf_size>=P.BLKSIZE+e.framesize-P.FFTOFFSET),O(i.mf_size>=512+e.framesize-32)}}this.lame_encode_mp3_frame=function(e,f,h,p,m,g){var v,y=k([2,2]);y[0][0]=new t,y[0][1]=new t,y[1][0]=new t,y[1][1]=new t;var b,_=k([2,2]);_[0][0]=new t,_[0][1]=new t,_[1][0]=new t,_[1][1]=new t;var w,E,S,C=[null,null],x=e.internal_flags,T=M([2,4]),R=[.5,.5],I=[[0,0],[0,0]],D=[[0,0],[0,0]];if(C[0]=f,C[1]=h,0==x.lame_encode_frame_init&&d(e,C),x.padding=0,(x.slot_lag-=x.frac_SpF)<0&&(x.slot_lag+=e.out_samplerate,x.padding=1),0!=x.psymodel){var O=[null,null],j=0,F=L(2);for(S=0;S<x.mode_gr;S++){for(E=0;E<x.channels_out;E++)O[E]=C[E],j=576+576*S-P.FFTOFFSET;if(0!=(e.VBR==A.vbr_mtrh||e.VBR==A.vbr_mt?a.L3psycho_anal_vbr(e,O,j,S,y,_,I[S],D[S],T[S],F):a.L3psycho_anal_ns(e,O,j,S,y,_,I[S],D[S],T[S],F)))return-4;for(e.mode==MPEGMode.JOINT_STEREO&&(R[S]=T[S][2]+T[S][3],R[S]>0&&(R[S]=T[S][3]/R[S])),E=0;E<x.channels_out;E++){var U=x.l3_side.tt[S][E];U.block_type=F[E],U.mixed_block_flag=0}}}else for(S=0;S<x.mode_gr;S++)for(E=0;E<x.channels_out;E++)x.l3_side.tt[S][E].block_type=P.NORM_TYPE,x.l3_side.tt[S][E].mixed_block_flag=0,D[S][E]=I[S][E]=700;if(u(x),c.mdct_sub48(x,C[0],C[1]),x.mode_ext=P.MPG_MD_LR_LR,e.force_ms)x.mode_ext=P.MPG_MD_MS_LR;else if(e.mode==MPEGMode.JOINT_STEREO){var B=0,V=0;for(S=0;S<x.mode_gr;S++)for(E=0;E<x.channels_out;E++)B+=D[S][E],V+=I[S][E];if(B<=1*V){var z=x.l3_side.tt[0],W=x.l3_side.tt[x.mode_gr-1];z[0].block_type==z[1].block_type&&W[0].block_type==W[1].block_type&&(x.mode_ext=P.MPG_MD_MS_LR)}}if(x.mode_ext==r?(b=_,w=D):(b=y,w=I),e.analysis&&null!=x.pinfo)for(S=0;S<x.mode_gr;S++)for(E=0;E<x.channels_out;E++)x.pinfo.ms_ratio[S]=x.ms_ratio[S],x.pinfo.ms_ener_ratio[S]=R[S],x.pinfo.blocktype[S][E]=x.l3_side.tt[S][E].block_type,x.pinfo.pe[S][E]=w[S][E],N.arraycopy(x.l3_side.tt[S][E].xr,0,x.pinfo.xr[S][E],0,576),x.mode_ext==r&&(x.pinfo.ers[S][E]=x.pinfo.ers[S][E+2],N.arraycopy(x.pinfo.energy[S][E+2],0,x.pinfo.energy[S][E],0,x.pinfo.energy[S][E].length));if(e.VBR==A.vbr_off||e.VBR==A.vbr_abr){var G,H;for(G=0;G<18;G++)x.nsPsy.pefirbuf[G]=x.nsPsy.pefirbuf[G+1];for(H=0,S=0;S<x.mode_gr;S++)for(E=0;E<x.channels_out;E++)H+=w[S][E];for(x.nsPsy.pefirbuf[18]=H,H=x.nsPsy.pefirbuf[9],G=0;G<9;G++)H+=(x.nsPsy.pefirbuf[G]+x.nsPsy.pefirbuf[18-G])*P.fircoef[G];for(H=3350*x.mode_gr*x.channels_out/H,S=0;S<x.mode_gr;S++)for(E=0;E<x.channels_out;E++)w[S][E]*=H}if(x.iteration_loop.iteration_loop(e,w,R,b),i.format_bitstream(e),v=i.copy_buffer(x,p,m,g,1),e.bWriteVbrTag&&o.addVbrFrame(e),e.analysis&&null!=x.pinfo){for(E=0;E<x.channels_out;E++){var Y;for(Y=0;Y<n;Y++)x.pinfo.pcmdata[E][Y]=x.pinfo.pcmdata[E][Y+e.framesize];for(Y=n;Y<1600;Y++)x.pinfo.pcmdata[E][Y]=C[E][Y-n]}s.set_frame_pinfo(e,b)}return l(x),v}}P.ENCDELAY=576,P.POSTDELAY=1152,P.MDCTDELAY=48,P.FFTOFFSET=224+P.MDCTDELAY,P.DECDELAY=528,P.SBLIMIT=32,P.CBANDS=64,P.SBPSY_l=21,P.SBPSY_s=12,P.SBMAX_l=22,P.SBMAX_s=13,P.PSFB21=6,P.PSFB12=6,P.BLKSIZE=1024,P.HBLKSIZE=P.BLKSIZE/2+1,P.BLKSIZE_s=256,P.HBLKSIZE_s=P.BLKSIZE_s/2+1,P.NORM_TYPE=0,P.START_TYPE=1,P.SHORT_TYPE=2,P.STOP_TYPE=3,P.MPG_MD_LR_LR=0,P.MPG_MD_LR_I=1,P.MPG_MD_MS_LR=2,P.MPG_MD_MS_I=3,P.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3898045e-23,.0467745*5,.50455,.756825,.187098*5];var j=P,F=m.Util,U=m.new_float;function B(){var e=U(j.BLKSIZE),t=U(j.BLKSIZE_s/2),n=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function r(e,t,r){var i,a,o,s=0,c=t+(r<<=1);i=4;do{var u,l,d,f,h,p,m;m=i>>1,p=(h=i<<1)+(f=i),i=h<<1,o=(a=t)+m;do{E=e[a+0]-e[a+f],w=e[a+0]+e[a+f],T=e[a+h]-e[a+p],C=e[a+h]+e[a+p],e[a+h]=w-C,e[a+0]=w+C,e[a+p]=E-T,e[a+f]=E+T,E=e[o+0]-e[o+f],w=e[o+0]+e[o+f],T=F.SQRT2*e[o+p],C=F.SQRT2*e[o+h],e[o+h]=w-C,e[o+0]=w+C,e[o+p]=E-T,e[o+f]=E+T,o+=i,a+=i}while(a<c);for(l=n[s+0],u=n[s+1],d=1;d<m;d++){var g,v;g=1-2*u*u,v=2*u*l,a=t+d,o=t+f-d;do{var y,b,_,w,E,S,C,x,T,R;b=v*e[a+f]-g*e[o+f],y=g*e[a+f]+v*e[o+f],E=e[a+0]-y,w=e[a+0]+y,S=e[o+0]-b,_=e[o+0]+b,b=v*e[a+p]-g*e[o+p],y=g*e[a+p]+v*e[o+p],T=e[a+h]-y,C=e[a+h]+y,R=e[o+h]-b,x=e[o+h]+b,b=u*C-l*R,y=l*C+u*R,e[a+h]=w-y,e[a+0]=w+y,e[o+p]=S-b,e[o+f]=S+b,b=l*x-u*T,y=u*x+l*T,e[o+h]=_-y,e[o+0]=_+y,e[a+p]=E-b,e[a+f]=E+b,o+=i,a+=i}while(a<c);l=(g=l)*n[s+0]-u*n[s+1],u=g*n[s+1]+u*n[s+0]}s+=2}while(i<r)}var i=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(e,n,a,o,s){for(var c=0;c<3;c++){var u=j.BLKSIZE_s/2,l=65535&192*(c+1),d=j.BLKSIZE_s/8-1;do{var f,h,p,m,g,v=255&i[d<<2];h=(f=t[v]*o[a][s+v+l])-(g=t[127-v]*o[a][s+v+l+128]),f+=g,m=(p=t[v+64]*o[a][s+v+l+64])-(g=t[63-v]*o[a][s+v+l+192]),p+=g,u-=4,n[c][u+0]=f+p,n[c][u+2]=f-p,n[c][u+1]=h+m,n[c][u+3]=h-m,h=(f=t[v+1]*o[a][s+v+l+1])-(g=t[126-v]*o[a][s+v+l+129]),f+=g,m=(p=t[v+65]*o[a][s+v+l+65])-(g=t[62-v]*o[a][s+v+l+193]),p+=g,n[c][u+j.BLKSIZE_s/2+0]=f+p,n[c][u+j.BLKSIZE_s/2+2]=f-p,n[c][u+j.BLKSIZE_s/2+1]=h+m,n[c][u+j.BLKSIZE_s/2+3]=h-m}while(--d>=0);r(n[c],u,j.BLKSIZE_s/2)}},this.fft_long=function(t,n,a,o,s){var c=j.BLKSIZE/8-1,u=j.BLKSIZE/2;do{var l,d,f,h,p,m=255&i[c];d=(l=e[m]*o[a][s+m])-(p=e[m+512]*o[a][s+m+512]),l+=p,h=(f=e[m+256]*o[a][s+m+256])-(p=e[m+768]*o[a][s+m+768]),f+=p,n[0+(u-=4)]=l+f,n[u+2]=l-f,n[u+1]=d+h,n[u+3]=d-h,d=(l=e[m+1]*o[a][s+m+1])-(p=e[m+513]*o[a][s+m+513]),l+=p,h=(f=e[m+257]*o[a][s+m+257])-(p=e[m+769]*o[a][s+m+769]),f+=p,n[u+j.BLKSIZE/2+0]=l+f,n[u+j.BLKSIZE/2+2]=l-f,n[u+j.BLKSIZE/2+1]=d+h,n[u+j.BLKSIZE/2+3]=d-h}while(--c>=0);r(n,u,j.BLKSIZE/2)},this.init_fft=function(n){for(var r=0;r<j.BLKSIZE;r++)e[r]=.42-.5*Math.cos(2*Math.PI*(r+.5)/j.BLKSIZE)+.08*Math.cos(4*Math.PI*(r+.5)/j.BLKSIZE);for(r=0;r<j.BLKSIZE_s/2;r++)t[r]=.5*(1-Math.cos(2*Math.PI*(r+.5)/j.BLKSIZE_s))}}var V=B,z=m.VbrMode,W=m.Float,G=m.ShortBlock,H=m.Util,Y=m.Arrays,q=m.new_float,K=m.new_float_n,X=m.new_int,Q=m.assert;function J(){var e=new V,t=2.302585092994046,n=2,r=16,i=2,a=16,o=.34,s=1/217621504/(j.BLKSIZE/2),c=.01,u=.8,l=.6,d=.3,f=3.5,h=21,p=.2302585093;function m(e){return e}function g(e,t){for(var n=0,r=0;r<j.BLKSIZE/2;++r)n+=e[r]*t.ATH.eql_w[r];return n*=s}function v(t,n,r,i,a,o,s,c,u,l,d){var f=t.internal_flags;if(u<2)e.fft_long(f,i[a],u,l,d),e.fft_short(f,o[s],u,l,d);else if(2==u){for(var h=j.BLKSIZE-1;h>=0;--h){var p=i[a+0][h],v=i[a+1][h];i[a+0][h]=(p+v)*H.SQRT2*.5,i[a+1][h]=(p-v)*H.SQRT2*.5}for(var y=2;y>=0;--y)for(h=j.BLKSIZE_s-1;h>=0;--h)p=o[s+0][y][h],v=o[s+1][y][h],o[s+0][y][h]=(p+v)*H.SQRT2*.5,o[s+1][y][h]=(p-v)*H.SQRT2*.5}for(n[0]=m(i[a+0][0]),n[0]*=n[0],h=j.BLKSIZE/2-1;h>=0;--h){var b=i[a+0][j.BLKSIZE/2-h],_=i[a+0][j.BLKSIZE/2+h];n[j.BLKSIZE/2-h]=m(.5*(b*b+_*_))}for(y=2;y>=0;--y)for(r[y][0]=o[s+0][y][0],r[y][0]*=r[y][0],h=j.BLKSIZE_s/2-1;h>=0;--h)b=o[s+0][y][j.BLKSIZE_s/2-h],_=o[s+0][y][j.BLKSIZE_s/2+h],r[y][j.BLKSIZE_s/2-h]=m(.5*(b*b+_*_));var w=0;for(h=11;h<j.HBLKSIZE;h++)w+=n[h];if(f.tot_ener[u]=w,t.analysis){for(h=0;h<j.HBLKSIZE;h++)f.pinfo.energy[c][u][h]=f.pinfo.energy_save[u][h],f.pinfo.energy_save[u][h]=n[h];f.pinfo.pe[c][u]=f.pe[u]}2==t.athaa_loudapprox&&u<2&&(f.loudness_sq[c][u]=f.loudness_sq_save[u],f.loudness_sq_save[u]=g(n,f))}var y,b,_,w=8,E=23,S=15,C=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function x(){y=Math.pow(10,(w+1)/16),b=Math.pow(10,(E+1)/16),_=Math.pow(10,S/10)}var T=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],R=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],I=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function N(e,t,n,r,i,a){var o,s,c;if(t>e){if(!(t<e*b))return e+t;o=t/e}else{if(e>=t*b)return e+t;o=e/t}if(Q(e>=0),Q(t>=0),e+=t,r+3<=6){if(o>=y)return e;var u=0|H.FAST_LOG10_X(o,16);return e*R[u]}return u=0|H.FAST_LOG10_X(o,16),t=0!=a?i.ATH.cb_s[n]*i.ATH.adjust:i.ATH.cb_l[n]*i.ATH.adjust,Q(t>=0),e<_*t?e>t?(s=1,u<=13&&(s=I[u]),c=H.FAST_LOG10_X(e/t,10/15),e*((T[u]-s)*c+s)):u>13?e:e*I[u]:e*T[u]}var A=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1];function k(e,t,n){var r;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(r=t>e?t/e:e/t,-2<=n&&n<=2){if(r>=y)return e+t;var i=0|H.FAST_LOG10_X(r,16);return(e+t)*A[i]}return r<b?e+t:(e<t&&(e=t),e)}function D(e,t){var n=e.internal_flags;if(n.channels_out>1){for(var r=0;r<j.SBMAX_l;r++){var i=n.thm[0].l[r],a=n.thm[1].l[r];n.thm[0].l[r]+=a*t,n.thm[1].l[r]+=i*t}for(r=0;r<j.SBMAX_s;r++)for(var o=0;o<3;o++)i=n.thm[0].s[r][o],a=n.thm[1].s[r][o],n.thm[0].s[r][o]+=a*t,n.thm[1].s[r][o]+=i*t}}function M(e){for(var t=0;t<j.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var n=e.mld_l[t]*e.en[3].l[t],r=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],n));n=e.mld_l[t]*e.en[2].l[t];var i=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],n));e.thm[2].l[t]=r,e.thm[3].l[t]=i}for(t=0;t<j.SBMAX_s;t++)for(var a=0;a<3;a++)e.thm[0].s[t][a]>1.58*e.thm[1].s[t][a]||e.thm[1].s[t][a]>1.58*e.thm[0].s[t][a]||(n=e.mld_s[t]*e.en[3].s[t][a],r=Math.max(e.thm[2].s[t][a],Math.min(e.thm[3].s[t][a],n)),n=e.mld_s[t]*e.en[2].s[t][a],i=Math.max(e.thm[3].s[t][a],Math.min(e.thm[2].s[t][a],n)),e.thm[2].s[t][a]=r,e.thm[3].s[t][a]=i)}function L(e,t,n){var r=t,i=Math.pow(10,n);t*=2,r*=2;for(var a=0;a<j.SBMAX_l;a++)l=e.ATH.cb_l[e.bm_l[a]]*i,(s=Math.min(Math.max(e.thm[0].l[a],l),Math.max(e.thm[1].l[a],l)))*t<(c=Math.max(e.thm[2].l[a],l))+(u=Math.max(e.thm[3].l[a],l))&&Q((c*=d=s*r/(c+u))+(u*=d)>0),e.thm[2].l[a]=Math.min(c,e.thm[2].l[a]),e.thm[3].l[a]=Math.min(u,e.thm[3].l[a]);for(i*=j.BLKSIZE_s/j.BLKSIZE,a=0;a<j.SBMAX_s;a++)for(var o=0;o<3;o++){var s,c,u,l,d;l=e.ATH.cb_s[e.bm_s[a]]*i,(s=Math.min(Math.max(e.thm[0].s[a][o],l),Math.max(e.thm[1].s[a][o],l)))*t<(c=Math.max(e.thm[2].s[a][o],l))+(u=Math.max(e.thm[3].s[a][o],l))&&Q((c*=d=s*t/(c+u))+(u*=d)>0),e.thm[2].s[a][o]=Math.min(e.thm[2].s[a][o],c),e.thm[3].s[a][o]=Math.min(e.thm[3].s[a][o],u)}}function O(e,t,n,r,i){var a,o,s=0,c=0;for(a=o=0;a<j.SBMAX_s;++o,++a){for(var u=e.bo_s[a],l=e.npart_s,d=u<l?u:l;o<d;)Q(t[o]>=0),Q(n[o]>=0),s+=t[o],c+=n[o],o++;if(e.en[r].s[a][i]=s,e.thm[r].s[a][i]=c,o>=l){++a;break}Q(t[o]>=0),Q(n[o]>=0);var f=e.PSY.bo_s_weight[a],h=1-f;s=f*t[o],c=f*n[o],e.en[r].s[a][i]+=s,e.thm[r].s[a][i]+=c,s=h*t[o],c=h*n[o]}for(;a<j.SBMAX_s;++a)e.en[r].s[a][i]=0,e.thm[r].s[a][i]=0}function P(e,t,n,r){var i,a,o=0,s=0;for(i=a=0;i<j.SBMAX_l;++a,++i){for(var c=e.bo_l[i],u=e.npart_l,l=c<u?c:u;a<l;)Q(t[a]>=0),Q(n[a]>=0),o+=t[a],s+=n[a],a++;if(e.en[r].l[i]=o,e.thm[r].l[i]=s,a>=u){++i;break}Q(t[a]>=0),Q(n[a]>=0);var d=e.PSY.bo_l_weight[i],f=1-d;o=d*t[a],s=d*n[a],e.en[r].l[i]+=o,e.thm[r].l[i]+=s,o=f*t[a],s=f*n[a]}for(;i<j.SBMAX_l;++i)e.en[r].l[i]=0,e.thm[r].l[i]=0}function F(e,t,n,r,o,s){var c,u,l=e.internal_flags;for(u=c=0;u<l.npart_s;++u){for(var d=0,f=0,h=l.numlines_s[u],p=0;p<h;++p,++c){var m=t[s][c];d+=m,f<m&&(f=m)}n[u]=d}for(Q(u==l.npart_s),Q(129==c),c=u=0;u<l.npart_s;u++){var g=l.s3ind_s[u][0],v=l.s3_ss[c++]*n[g];for(++g;g<=l.s3ind_s[u][1];)v+=l.s3_ss[c]*n[g],++c,++g;var y=i*l.nb_s1[o][u];if(r[u]=Math.min(v,y),l.blocktype_old[1&o]==j.SHORT_TYPE){y=a*l.nb_s2[o][u];var b=r[u];r[u]=Math.min(y,b)}l.nb_s2[o][u]=l.nb_s1[o][u],l.nb_s1[o][u]=v,Q(r[u]>=0)}for(;u<=j.CBANDS;++u)n[u]=0,r[u]=0}function U(e,t,n,r){var i=e.internal_flags;e.short_blocks!=G.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var a=0;a<i.channels_out;a++)r[a]=j.NORM_TYPE,e.short_blocks==G.short_block_dispensed&&(t[a]=1),e.short_blocks==G.short_block_forced&&(t[a]=0),0!=t[a]?(Q(i.blocktype_old[a]!=j.START_TYPE),i.blocktype_old[a]==j.SHORT_TYPE&&(r[a]=j.STOP_TYPE)):(r[a]=j.SHORT_TYPE,i.blocktype_old[a]==j.NORM_TYPE&&(i.blocktype_old[a]=j.START_TYPE),i.blocktype_old[a]==j.STOP_TYPE&&(i.blocktype_old[a]=j.SHORT_TYPE)),n[a]=i.blocktype_old[a],i.blocktype_old[a]=r[a]}function B(e,t,n){return n>=1?e:n<=0?t:t>0?Math.pow(e/t,n)*t:0}var J=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function Z(e,n){for(var r=309.07,i=0;i<j.SBMAX_s-1;i++)for(var a=0;a<3;a++){var o=e.thm.s[i][a];if(Q(i<J.length),o>0){var s=o*n,c=e.en.s[i][a];c>s&&(c>1e10*s?r+=J[i]*(10*t):(Q(s>0),r+=J[i]*H.FAST_LOG10(c/s)))}}return r}var $=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function ee(e,n){for(var r=281.0575,i=0;i<j.SBMAX_l-1;i++){var a=e.thm.l[i];if(Q(i<$.length),a>0){var o=a*n,s=e.en.l[i];s>o&&(s>1e10*o?r+=$[i]*(10*t):(Q(o>0),r+=$[i]*H.FAST_LOG10(s/o)))}}return r}function te(e,t,n,r,i){var a,o;for(a=o=0;a<e.npart_l;++a){var s,c=0,u=0;for(s=0;s<e.numlines_l[a];++s,++o){var l=t[o];Q(l>=0),c+=l,u<l&&(u=l)}n[a]=c,r[a]=u,i[a]=c*e.rnumlines_l[a],Q(e.rnumlines_l[a]>=0),Q(c>=0),Q(n[a]>=0),Q(r[a]>=0),Q(i[a]>=0)}}function ne(e,t,n,r){var i=C.length-1,a=0,o=n[a]+n[a+1];for(Q(o>=0),o>0?((s=t[a])<t[a+1]&&(s=t[a+1]),Q(e.numlines_l[a]+e.numlines_l[a+1]-1>0),(c=0|(o=20*(2*s-o)/(o*(e.numlines_l[a]+e.numlines_l[a+1]-1))))>i&&(c=i),r[a]=c):r[a]=0,a=1;a<e.npart_l-1;a++){var s,c;o=n[a-1]+n[a]+n[a+1],Q(o>=0),o>0?((s=t[a-1])<t[a]&&(s=t[a]),s<t[a+1]&&(s=t[a+1]),Q(e.numlines_l[a-1]+e.numlines_l[a]+e.numlines_l[a+1]-1>0),(c=0|(o=20*(3*s-o)/(o*(e.numlines_l[a-1]+e.numlines_l[a]+e.numlines_l[a+1]-1))))>i&&(c=i),r[a]=c):r[a]=0}Q(a>0),Q(a==e.npart_l-1),o=n[a-1]+n[a],Q(o>=0),o>0?((s=t[a-1])<t[a]&&(s=t[a]),Q(e.numlines_l[a-1]+e.numlines_l[a]-1>0),(c=0|(o=20*(2*s-o)/(o*(e.numlines_l[a-1]+e.numlines_l[a]-1))))>i&&(c=i),r[a]=c):r[a]=0,Q(a==e.npart_l-1)}var re=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function ie(t,n,r,i,a,o,s,c){var u=t.internal_flags;if(i<2)e.fft_long(u,s[c],i,n,r);else if(2==i)for(var l=j.BLKSIZE-1;l>=0;--l){var d=s[c+0][l],f=s[c+1][l];s[c+0][l]=(d+f)*H.SQRT2*.5,s[c+1][l]=(d-f)*H.SQRT2*.5}for(o[0]=m(s[c+0][0]),o[0]*=o[0],l=j.BLKSIZE/2-1;l>=0;--l){var h=s[c+0][j.BLKSIZE/2-l],p=s[c+0][j.BLKSIZE/2+l];o[j.BLKSIZE/2-l]=m(.5*(h*h+p*p))}var g=0;for(l=11;l<j.HBLKSIZE;l++)g+=o[l];if(u.tot_ener[i]=g,t.analysis){for(l=0;l<j.HBLKSIZE;l++)u.pinfo.energy[a][i][l]=u.pinfo.energy_save[i][l],u.pinfo.energy_save[i][l]=o[l];u.pinfo.pe[a][i]=u.pe[i]}}function ae(t,n,r,i,a,o,s,c){var u=t.internal_flags;if(0==a&&i<2&&e.fft_short(u,s[c],i,n,r),2==i)for(var l=j.BLKSIZE_s-1;l>=0;--l){var d=s[c+0][a][l],f=s[c+1][a][l];s[c+0][a][l]=(d+f)*H.SQRT2*.5,s[c+1][a][l]=(d-f)*H.SQRT2*.5}for(o[a][0]=s[c+0][a][0],o[a][0]*=o[a][0],l=j.BLKSIZE_s/2-1;l>=0;--l){var h=s[c+0][a][j.BLKSIZE_s/2-l],p=s[c+0][a][j.BLKSIZE_s/2+l];o[a][j.BLKSIZE_s/2-l]=m(.5*(h*h+p*p))}}function oe(e,t,n,r){var i=e.internal_flags;2==e.athaa_loudapprox&&n<2&&(i.loudness_sq[t][n]=i.loudness_sq_save[n],i.loudness_sq_save[n]=g(r,i))}this.L3psycho_anal_ns=function(e,t,i,a,o,s,c,f,p,m){var g,y,b,_,w,E,S,x,T,R,I=e.internal_flags,A=K([2,j.BLKSIZE]),k=K([2,3,j.BLKSIZE_s]),V=q(j.CBANDS+1),W=q(j.CBANDS+1),G=q(j.CBANDS+2),H=X(2),J=X(2),$=K([2,576]),ie=X(j.CBANDS+2),ae=X(j.CBANDS+2);for(Y.fill(ae,0),g=I.channels_out,e.mode==MPEGMode.JOINT_STEREO&&(g=4),T=e.VBR==z.vbr_off?0==I.ResvMax?0:I.ResvSize/I.ResvMax*.5:e.VBR==z.vbr_rh||e.VBR==z.vbr_mtrh||e.VBR==z.vbr_mt?.6:1,y=0;y<I.channels_out;y++){var oe=t[y],se=i+576-350-h+192;for(Q(re.length==(h-1)/2),_=0;_<576;_++){var ce,ue;for(ce=oe[se+_+10],ue=0,w=0;w<(h-1)/2-1;w+=2)ce+=re[w]*(oe[se+_+w]+oe[se+_+h-w]),ue+=re[w+1]*(oe[se+_+w+1]+oe[se+_+h-w-1]);$[y][_]=ce+ue}o[a][y].en.assign(I.en[y]),o[a][y].thm.assign(I.thm[y]),g>2&&(s[a][y].en.assign(I.en[y+2]),s[a][y].thm.assign(I.thm[y+2]))}for(y=0;y<g;y++){var le,de=q(12),fe=[0,0,0,0],he=q(12),pe=1,me=q(j.CBANDS),ge=q(j.CBANDS),ve=[0,0,0,0],ye=q(j.HBLKSIZE),be=K([3,j.HBLKSIZE_s]);for(Q(I.npart_s<=j.CBANDS),Q(I.npart_l<=j.CBANDS),_=0;_<3;_++)de[_]=I.nsPsy.last_en_subshort[y][_+6],Q(I.nsPsy.last_en_subshort[y][_+4]>0),he[_]=de[_]/I.nsPsy.last_en_subshort[y][_+4],fe[0]+=de[_];if(2==y)for(_=0;_<576;_++){var _e,we;_e=$[0][_],we=$[1][_],$[0][_]=_e+we,$[1][_]=_e-we}var Ee=$[1&y],Se=0;for(_=0;_<9;_++){for(var Ce=Se+64,xe=1;Se<Ce;Se++)xe<Math.abs(Ee[Se])&&(xe=Math.abs(Ee[Se]));I.nsPsy.last_en_subshort[y][_]=de[_+3]=xe,fe[1+_/3]+=xe,xe>de[_+3-2]?(Q(de[_+3-2]>0),xe/=de[_+3-2]):de[_+3-2]>10*xe?(Q(xe>0),xe=de[_+3-2]/(10*xe)):xe=0,he[_+3]=xe}if(e.analysis){var Te=he[0];for(_=1;_<12;_++)Te<he[_]&&(Te=he[_]);I.pinfo.ers[a][y]=I.pinfo.ers_save[y],I.pinfo.ers_save[y]=Te}for(le=3==y?I.nsPsy.attackthre_s:I.nsPsy.attackthre,_=0;_<12;_++)0==ve[_/3]&&he[_]>le&&(ve[_/3]=_%3+1);for(_=1;_<4;_++){var Re;fe[_-1]>fe[_]?(Q(fe[_]>0),Re=fe[_-1]/fe[_]):(Q(fe[_-1]>0),Re=fe[_]/fe[_-1]),Re<1.7&&(ve[_]=0,1==_&&(ve[0]=0))}for(0!=ve[0]&&0!=I.nsPsy.lastAttacks[y]&&(ve[0]=0),3!=I.nsPsy.lastAttacks[y]&&ve[0]+ve[1]+ve[2]+ve[3]==0||(pe=0,0!=ve[1]&&0!=ve[0]&&(ve[1]=0),0!=ve[2]&&0!=ve[1]&&(ve[2]=0),0!=ve[3]&&0!=ve[2]&&(ve[3]=0)),y<2?J[y]=pe:0==pe&&(J[0]=J[1]=0),p[y]=I.tot_ener[y],v(e,ye,be,A,1&y,k,1&y,a,y,t,i),te(I,ye,V,me,ge),ne(I,me,ge,ie),x=0;x<3;x++){var Ie,Ne;for(F(e,be,W,G,y,x),O(I,W,G,y,x),S=0;S<j.SBMAX_s;S++){if(Ne=I.thm[y].s[S][x],Ne*=u,ve[x]>=2||1==ve[x+1]){var Ae=0!=x?x-1:2;xe=B(I.thm[y].s[S][Ae],Ne,l*T),Ne=Math.min(Ne,xe)}1==ve[x]?(Ae=0!=x?x-1:2,xe=B(I.thm[y].s[S][Ae],Ne,d*T),Ne=Math.min(Ne,xe)):(0!=x&&3==ve[x-1]||0==x&&3==I.nsPsy.lastAttacks[y])&&(Ae=2!=x?x+1:0,xe=B(I.thm[y].s[S][Ae],Ne,d*T),Ne=Math.min(Ne,xe)),Ie=de[3*x+3]+de[3*x+4]+de[3*x+5],6*de[3*x+5]<Ie&&(Ne*=.5,6*de[3*x+4]<Ie&&(Ne*=.5)),I.thm[y].s[S][x]=Ne}}for(I.nsPsy.lastAttacks[y]=ve[2],E=0,b=0;b<I.npart_l;b++){for(var ke=I.s3ind[b][0],De=V[ke]*C[ie[ke]],Me=I.s3_ll[E++]*De;++ke<=I.s3ind[b][1];)De=V[ke]*C[ie[ke]],Me=N(Me,I.s3_ll[E++]*De,ke,ke-b,I,0);Me*=.158489319246111,I.blocktype_old[1&y]==j.SHORT_TYPE?G[b]=Me:G[b]=B(Math.min(Me,Math.min(n*I.nb_1[y][b],r*I.nb_2[y][b])),Me,T),I.nb_2[y][b]=I.nb_1[y][b],I.nb_1[y][b]=Me}for(;b<=j.CBANDS;++b)V[b]=0,G[b]=0;P(I,V,G,y)}for(e.mode!=MPEGMode.STEREO&&e.mode!=MPEGMode.JOINT_STEREO||e.interChRatio>0&&D(e,e.interChRatio),e.mode==MPEGMode.JOINT_STEREO&&(M(I),R=e.msfix,Math.abs(R)>0&&L(I,R,e.ATHlower*I.ATH.adjust)),U(e,J,m,H),y=0;y<g;y++){var Le,Oe,Pe,je=0;y>1?(Le=f,je=-2,Oe=j.NORM_TYPE,m[0]!=j.SHORT_TYPE&&m[1]!=j.SHORT_TYPE||(Oe=j.SHORT_TYPE),Pe=s[a][y-2]):(Le=c,je=0,Oe=m[y],Pe=o[a][y]),Oe==j.SHORT_TYPE?Le[je+y]=Z(Pe,I.masking_lower):Le[je+y]=ee(Pe,I.masking_lower),e.analysis&&(I.pinfo.pe[a][y]=Le[je+y])}return 0};var se=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function ce(e,t,n,r,i,a,o,s,c,u){for(var l=K([2,576]),d=e.internal_flags,f=d.channels_out,p=e.mode==MPEGMode.JOINT_STEREO?4:f,m=0;m<f;m++){firbuf=t[m];var g=n+576-350-h+192;Q(se.length==(h-1)/2);for(var v=0;v<576;v++){var y,b;y=firbuf[g+v+10],b=0;for(var _=0;_<(h-1)/2-1;_+=2)y+=se[_]*(firbuf[g+v+_]+firbuf[g+v+h-_]),b+=se[_+1]*(firbuf[g+v+_+1]+firbuf[g+v+h-_-1]);l[m][v]=y+b}i[r][m].en.assign(d.en[m]),i[r][m].thm.assign(d.thm[m]),p>2&&(a[r][m].en.assign(d.en[m+2]),a[r][m].thm.assign(d.thm[m+2]))}for(m=0;m<p;m++){var w=q(12),E=q(12),S=[0,0,0,0],C=l[1&m],x=0,T=3==m?d.nsPsy.attackthre_s:d.nsPsy.attackthre,R=1;if(2==m)for(v=0,_=576;_>0;++v,--_){var I=l[0][v],N=l[1][v];l[0][v]=I+N,l[1][v]=I-N}for(v=0;v<3;v++)E[v]=d.nsPsy.last_en_subshort[m][v+6],Q(d.nsPsy.last_en_subshort[m][v+4]>0),w[v]=E[v]/d.nsPsy.last_en_subshort[m][v+4],S[0]+=E[v];for(v=0;v<9;v++){for(var A=x+64,k=1;x<A;x++)k<Math.abs(C[x])&&(k=Math.abs(C[x]));d.nsPsy.last_en_subshort[m][v]=E[v+3]=k,S[1+v/3]+=k,k>E[v+3-2]?(Q(E[v+3-2]>0),k/=E[v+3-2]):E[v+3-2]>10*k?(Q(k>0),k=E[v+3-2]/(10*k)):k=0,w[v+3]=k}for(v=0;v<3;++v){var D=E[3*v+3]+E[3*v+4]+E[3*v+5],M=1;6*E[3*v+5]<D&&(M*=.5,6*E[3*v+4]<D&&(M*=.5)),s[m][v]=M}if(e.analysis){var L=w[0];for(v=1;v<12;v++)L<w[v]&&(L=w[v]);d.pinfo.ers[r][m]=d.pinfo.ers_save[m],d.pinfo.ers_save[m]=L}for(v=0;v<12;v++)0==c[m][v/3]&&w[v]>T&&(c[m][v/3]=v%3+1);for(v=1;v<4;v++){var O=S[v-1],P=S[v];Math.max(O,P)<4e4&&O<1.7*P&&P<1.7*O&&(1==v&&c[m][0]<=c[m][v]&&(c[m][0]=0),c[m][v]=0)}c[m][0]<=d.nsPsy.lastAttacks[m]&&(c[m][0]=0),3!=d.nsPsy.lastAttacks[m]&&c[m][0]+c[m][1]+c[m][2]+c[m][3]==0||(R=0,0!=c[m][1]&&0!=c[m][0]&&(c[m][1]=0),0!=c[m][2]&&0!=c[m][1]&&(c[m][2]=0),0!=c[m][3]&&0!=c[m][2]&&(c[m][3]=0)),m<2?u[m]=R:0==R&&(u[0]=u[1]=0),o[m]=d.tot_ener[m]}}function ue(e,t,n){if(0==n)for(var r=0;r<e.npart_s;r++)e.nb_s2[t][r]=e.nb_s1[t][r],e.nb_s1[t][r]=0}function le(e,t){for(var n=0;n<e.npart_l;n++)e.nb_2[t][n]=e.nb_1[t][n],e.nb_1[t][n]=0}function de(e,t,n,r){var i=C.length-1,a=0,o=n[a]+n[a+1];for(Q(o>=0),o>0?((s=t[a])<t[a+1]&&(s=t[a+1]),Q(e.numlines_s[a]+e.numlines_s[a+1]-1>0),(c=0|(o=20*(2*s-o)/(o*(e.numlines_s[a]+e.numlines_s[a+1]-1))))>i&&(c=i),r[a]=c):r[a]=0,a=1;a<e.npart_s-1;a++){var s,c;o=n[a-1]+n[a]+n[a+1],Q(a+1<e.npart_s),Q(o>=0),o>0?((s=t[a-1])<t[a]&&(s=t[a]),s<t[a+1]&&(s=t[a+1]),Q(e.numlines_s[a-1]+e.numlines_s[a]+e.numlines_s[a+1]-1>0),(c=0|(o=20*(3*s-o)/(o*(e.numlines_s[a-1]+e.numlines_s[a]+e.numlines_s[a+1]-1))))>i&&(c=i),r[a]=c):r[a]=0}Q(a>0),Q(a==e.npart_s-1),o=n[a-1]+n[a],Q(o>=0),o>0?((s=t[a-1])<t[a]&&(s=t[a]),Q(e.numlines_s[a-1]+e.numlines_s[a]-1>0),(c=0|(o=20*(2*s-o)/(o*(e.numlines_s[a-1]+e.numlines_s[a]-1))))>i&&(c=i),r[a]=c):r[a]=0,Q(a==e.npart_s-1)}function fe(e,t,n,r,i,a){var o,s,c,u=e.internal_flags,l=new float[j.CBANDS],d=q(j.CBANDS),f=new int[j.CBANDS];for(c=s=0;c<u.npart_s;++c){var h=0,p=0,m=u.numlines_s[c];for(o=0;o<m;++o,++s){var g=t[a][s];h+=g,p<g&&(p=g)}n[c]=h,Q(h>=0),l[c]=p,Q(m>0),d[c]=h/m,Q(d[c]>=0)}for(Q(c==u.npart_s),Q(129==s);c<j.CBANDS;++c)l[c]=0,d[c]=0;for(de(u,l,d,f),s=c=0;c<u.npart_s;c++){var v,y,b,_,w,E=u.s3ind_s[c][0],S=u.s3ind_s[c][1];for(v=f[E],y=1,_=u.s3_ss[s]*n[E]*C[f[E]],++s,++E;E<=S;)v+=f[E],y+=1,_=k(_,b=u.s3_ss[s]*n[E]*C[f[E]],E-c),++s,++E;_*=w=.5*C[v=(1+2*v)/(2*y)],r[c]=_,u.nb_s2[i][c]=u.nb_s1[i][c],u.nb_s1[i][c]=_,b=l[c],b*=u.minval_s[c],b*=w,r[c]>b&&(r[c]=b),u.masking_lower>1&&(r[c]*=u.masking_lower),r[c]>n[c]&&(r[c]=n[c]),u.masking_lower<1&&(r[c]*=u.masking_lower),Q(r[c]>=0)}for(;c<j.CBANDS;++c)n[c]=0,r[c]=0}function he(e,t,i,a,o){var s,c=q(j.CBANDS),u=q(j.CBANDS),l=X(j.CBANDS+2);te(e,t,i,c,u),ne(e,c,u,l);var f=0;for(s=0;s<e.npart_l;s++){var h,p,m,g=e.s3ind[s][0],v=e.s3ind[s][1],y=0,b=0;for(y=l[g],b+=1,p=e.s3_ll[f]*i[g]*C[l[g]],++f,++g;g<=v;)y+=l[g],b+=1,p=k(p,h=e.s3_ll[f]*i[g]*C[l[g]],g-s),++f,++g;if(p*=m=.5*C[y=(1+2*y)/(2*b)],e.blocktype_old[1&o]==j.SHORT_TYPE){var _=n*e.nb_1[o][s];a[s]=_>0?Math.min(p,_):Math.min(p,i[s]*d)}else{var w=r*e.nb_2[o][s],E=n*e.nb_1[o][s];w<=0&&(w=p),E<=0&&(E=p),_=e.blocktype_old[1&o]==j.NORM_TYPE?Math.min(E,w):E,a[s]=Math.min(p,_)}e.nb_2[o][s]=e.nb_1[o][s],e.nb_1[o][s]=p,h=c[s],h*=e.minval_l[s],h*=m,a[s]>h&&(a[s]=h),e.masking_lower>1&&(a[s]*=e.masking_lower),a[s]>i[s]&&(a[s]=i[s]),e.masking_lower<1&&(a[s]*=e.masking_lower),Q(a[s]>=0)}for(;s<j.CBANDS;++s)i[s]=0,a[s]=0}function pe(e,t){var n=e.internal_flags;e.short_blocks!=G.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var r=0;r<n.channels_out;r++)e.short_blocks==G.short_block_dispensed&&(t[r]=1),e.short_blocks==G.short_block_forced&&(t[r]=0)}function me(e,t,n){for(var r=e.internal_flags,i=0;i<r.channels_out;i++){var a=j.NORM_TYPE;0!=t[i]?(Q(r.blocktype_old[i]!=j.START_TYPE),r.blocktype_old[i]==j.SHORT_TYPE&&(a=j.STOP_TYPE)):(a=j.SHORT_TYPE,r.blocktype_old[i]==j.NORM_TYPE&&(r.blocktype_old[i]=j.START_TYPE),r.blocktype_old[i]==j.STOP_TYPE&&(r.blocktype_old[i]=j.SHORT_TYPE)),n[i]=r.blocktype_old[i],r.blocktype_old[i]=a}}function ge(e,t,n,r,i,a,o){for(var s,c,u=2*a,l=a>0?Math.pow(10,i):1,d=0;d<o;++d){var f=e[2][d],h=e[3][d],p=t[0][d],m=t[1][d],g=t[2][d],v=t[3][d];if(p<=1.58*m&&m<=1.58*p){var y=n[d]*h,b=n[d]*f;c=Math.max(g,Math.min(v,y)),s=Math.max(v,Math.min(g,b))}else c=g,s=v;if(a>0){var _,w,E=r[d]*l;if(_=Math.min(Math.max(p,E),Math.max(m,E)),(w=(g=Math.max(c,E))+(v=Math.max(s,E)))>0&&_*u<w){var S=_*u/w;g*=S,v*=S,Q(w>0)}c=Math.min(g,c),s=Math.min(v,s)}c>f&&(c=f),s>h&&(s=h),t[2][d]=c,t[3][d]=s}}function ve(e,t){var n;return(n=e>=0?27*-e:e*t)<=-72?0:Math.exp(n*p)}function ye(e){var t,n,r=0,i=0,a=0;for(a=0;ve(a,e)>1e-20;a-=1);for(t=a,n=0;Math.abs(n-t)>1e-12;)ve(a=(n+t)/2,e)>0?n=a:t=a;for(r=t,a=0,a=0;ve(a,e)>1e-20;a+=1);for(t=0,n=a;Math.abs(n-t)>1e-12;)ve(a=(n+t)/2,e)>0?t=a:n=a;i=n;var o,s=0,c=1e3;for(o=0;o<=c;++o)s+=ve(a=r+o*(i-r)/c,e);return(c+1)/(s*(i-r))}function be(e){var t,n,r,i;return t=e,n=(t*=t>=0?3:1.5)>=.5&&t<=2.5?8*((i=t-.5)*i-2*i):0,(r=15.811389+7.5*(t+=.474)-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((n+r)*p),t/=.6609193)}function _e(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function we(e,t,n,r,i,a,s,c,u,l,d,f){var h,p=q(j.CBANDS+1),m=c/(f>15?1152:384),g=X(j.HBLKSIZE);c/=u;var v=0,y=0;for(h=0;h<j.CBANDS;h++){var b;for(I=_e(c*v),p[h]=c*v,b=v;_e(c*b)-I<o&&b<=u/2;b++);for(e[h]=b-v,y=h+1;v<b;)Q(v<j.HBLKSIZE),g[v++]=h;if(v>u/2){v=u/2,++h;break}}Q(h<j.CBANDS),p[h]=c*v;for(var _=0;_<f;_++){var w,E,S,C,x;S=l[_],C=l[_+1],(w=0|Math.floor(.5+d*(S-.5)))<0&&(w=0),(E=0|Math.floor(.5+d*(C-.5)))>u/2&&(E=u/2),n[_]=(g[w]+g[E])/2,t[_]=g[E];var T=m*C;s[_]=(T-p[t[_]])/(p[t[_]+1]-p[t[_]]),s[_]<0?s[_]=0:s[_]>1&&(s[_]=1),x=_e(c*l[_]*d),x=Math.min(x,15.5)/15.5,a[_]=Math.pow(10,1.25*(1-Math.cos(Math.PI*x))-2.5)}v=0;for(var R=0;R<y;R++){var I,N,A=e[R];I=_e(c*v),N=_e(c*(v+A-1)),r[R]=.5*(I+N),I=_e(c*(v-.5)),N=_e(c*(v+A-.5)),i[R]=N-I,v+=A}return y}function Ee(e,t,n,r,i,a){var o,s=K([j.CBANDS,j.CBANDS]),c=0;if(a)for(var u=0;u<t;u++)for(o=0;o<t;o++){var l=be(n[u]-n[o])*r[o];s[u][o]=l*i[u]}else for(o=0;o<t;o++){var d=15+Math.min(21/n[o],12),f=ye(d);for(u=0;u<t;u++)l=f*ve(n[u]-n[o],d)*r[o],s[u][o]=l*i[u]}for(u=0;u<t;u++){for(o=0;o<t&&!(s[u][o]>0);o++);for(e[u][0]=o,o=t-1;o>0&&!(s[u][o]>0);o--);e[u][1]=o,c+=e[u][1]-e[u][0]+1}var h=q(c),p=0;for(u=0;u<t;u++)for(o=e[u][0];o<=e[u][1];o++)h[p++]=s[u][o];return h}function Se(e){var t=_e(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function Ce(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}this.L3psycho_anal_vbr=function(e,t,n,r,i,a,o,s,c,f){var h=e.internal_flags,p=q(j.HBLKSIZE),m=K([3,j.HBLKSIZE_s]),g=K([2,j.BLKSIZE]),v=K([2,3,j.BLKSIZE_s]),y=K([4,j.CBANDS]),b=K([4,j.CBANDS]),_=K([4,3]),w=.6,E=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],S=X(2),C=e.mode==MPEGMode.JOINT_STEREO?4:h.channels_out;ce(e,t,n,r,i,a,c,_,E,S),pe(e,S);for(var x=0;x<C;x++)ie(e,t,n,x,r,p,g,R=1&x),oe(e,r,x,p),0!=S[R]?he(h,p,y[x],b[x],x):le(h,x);for(S[0]+S[1]==2&&e.mode==MPEGMode.JOINT_STEREO&&ge(y,b,h.mld_cb_l,h.ATH.cb_l,e.ATHlower*h.ATH.adjust,e.msfix,h.npart_l),x=0;x<C;x++)0!=S[R=1&x]&&P(h,y[x],b[x],x);for(var T=0;T<3;T++){for(x=0;x<C;++x)0!=S[R=1&x]?ue(h,x,T):(ae(e,t,n,x,T,m,v,R),fe(e,m,y[x],b[x],x,T));for(S[0]+S[1]==0&&e.mode==MPEGMode.JOINT_STEREO&&ge(y,b,h.mld_cb_s,h.ATH.cb_s,e.ATHlower*h.ATH.adjust,e.msfix,h.npart_s),x=0;x<C;++x)0==S[R=1&x]&&O(h,y[x],b[x],x,T)}for(x=0;x<C;x++){var R;if(0==S[R=1&x])for(var I=0;I<j.SBMAX_s;I++){var N=q(3);for(T=0;T<3;T++){var A=h.thm[x].s[I][T];if(A*=u,E[x][T]>=2||1==E[x][T+1]){var k=0!=T?T-1:2,D=B(h.thm[x].s[I][k],A,l*w);A=Math.min(A,D)}else 1==E[x][T]?(k=0!=T?T-1:2,D=B(h.thm[x].s[I][k],A,d*w),A=Math.min(A,D)):(0!=T&&3==E[x][T-1]||0==T&&3==h.nsPsy.lastAttacks[x])&&(k=2!=T?T+1:0,D=B(h.thm[x].s[I][k],A,d*w),A=Math.min(A,D));A*=_[x][T],N[T]=A}for(T=0;T<3;T++)h.thm[x].s[I][T]=N[T]}}for(x=0;x<C;x++)h.nsPsy.lastAttacks[x]=E[x][2];for(me(e,S,f),x=0;x<C;x++){var M,L,F,U;x>1?(M=s,L=-2,F=j.NORM_TYPE,f[0]!=j.SHORT_TYPE&&f[1]!=j.SHORT_TYPE||(F=j.SHORT_TYPE),U=a[r][x-2]):(M=o,L=0,F=f[x],U=i[r][x]),F==j.SHORT_TYPE?M[L+x]=Z(U,h.masking_lower):M[L+x]=ee(U,h.masking_lower),e.analysis&&(h.pinfo.pe[r][x]=M[L+x])}return 0},this.psymodel_init=function(n){var r,i,a=n.internal_flags,o=!0,s=13,u=24,l=0,d=0,h=-8.25,p=-4.5,m=q(j.CBANDS),g=q(j.CBANDS),v=q(j.CBANDS),y=n.out_samplerate;switch(n.experimentalZ){default:case 0:o=!0;break;case 1:o=n.VBR!=z.vbr_mtrh&&n.VBR!=z.vbr_mt;break;case 2:o=!1;break;case 3:s=8,l=-1.75,d=-.0125,h=-8.25,p=-2.25}for(a.ms_ener_ratio_old=.25,a.blocktype_old[0]=a.blocktype_old[1]=j.NORM_TYPE,r=0;r<4;++r){for(var b=0;b<j.CBANDS;++b)a.nb_1[r][b]=1e20,a.nb_2[r][b]=1e20,a.nb_s1[r][b]=a.nb_s2[r][b]=1;for(var _=0;_<j.SBMAX_l;_++)a.en[r].l[_]=1e20,a.thm[r].l[_]=1e20;for(b=0;b<3;++b){for(_=0;_<j.SBMAX_s;_++)a.en[r].s[_][b]=1e20,a.thm[r].s[_][b]=1e20;a.nsPsy.lastAttacks[r]=0}for(b=0;b<9;b++)a.nsPsy.last_en_subshort[r][b]=10}for(a.loudness_sq_save[0]=a.loudness_sq_save[1]=0,a.npart_l=we(a.numlines_l,a.bo_l,a.bm_l,m,g,a.mld_l,a.PSY.bo_l_weight,y,j.BLKSIZE,a.scalefac_band.l,j.BLKSIZE/1152,j.SBMAX_l),Q(a.npart_l<j.CBANDS),r=0;r<a.npart_l;r++){var w=l;m[r]>=s&&(w=d*(m[r]-s)/(u-s)+l*(u-m[r])/(u-s)),v[r]=Math.pow(10,w/10),a.numlines_l[r]>0?a.rnumlines_l[r]=1/a.numlines_l[r]:a.rnumlines_l[r]=0}for(a.s3_ll=Ee(a.s3ind,a.npart_l,m,g,v,o),b=0,r=0;r<a.npart_l;r++){C=W.MAX_VALUE;for(var E=0;E<a.numlines_l[r];E++,b++){var S=y*b/(1e3*j.BLKSIZE);T=this.ATHformula(1e3*S,n)-20,T=Math.pow(10,.1*T),C>(T*=a.numlines_l[r])&&(C=T)}a.ATH.cb_l[r]=C,(C=20*m[r]/10-20)>6&&(C=100),C<-15&&(C=-15),C-=8,a.minval_l[r]=Math.pow(10,C/10)*a.numlines_l[r]}for(a.npart_s=we(a.numlines_s,a.bo_s,a.bm_s,m,g,a.mld_s,a.PSY.bo_s_weight,y,j.BLKSIZE_s,a.scalefac_band.s,j.BLKSIZE_s/384,j.SBMAX_s),Q(a.npart_s<j.CBANDS),b=0,r=0;r<a.npart_s;r++){var C;for(w=h,m[r]>=s&&(w=p*(m[r]-s)/(u-s)+h*(u-m[r])/(u-s)),v[r]=Math.pow(10,w/10),C=W.MAX_VALUE,E=0;E<a.numlines_s[r];E++,b++){var T;S=y*b/(1e3*j.BLKSIZE_s),T=this.ATHformula(1e3*S,n)-20,T=Math.pow(10,.1*T),C>(T*=a.numlines_s[r])&&(C=T)}a.ATH.cb_s[r]=C,C=7*m[r]/12-7,m[r]>12&&(C*=1+3.1*Math.log(1+C)),m[r]<12&&(C*=1+2.3*Math.log(1-C)),C<-15&&(C=-15),C-=8,a.minval_s[r]=Math.pow(10,C/10)*a.numlines_s[r]}a.s3_ss=Ee(a.s3ind_s,a.npart_s,m,g,v,o),x(),e.init_fft(a),a.decay=Math.exp(-1*t/(c*y/192)),i=f,0!=(2&n.exp_nspsytune)&&(i=1),Math.abs(n.msfix)>0&&(i=n.msfix),n.msfix=i;for(var R=0;R<a.npart_l;R++)a.s3ind[R][1]>a.npart_l-1&&(a.s3ind[R][1]=a.npart_l-1);var I=576*a.mode_gr/y;if(a.ATH.decay=Math.pow(10,-1.2*I),a.ATH.adjust=.01,a.ATH.adjustLimit=1,Q(a.bo_l[j.SBMAX_l-1]<=a.npart_l),Q(a.bo_s[j.SBMAX_s-1]<=a.npart_s),-1!=n.ATHtype){var N=n.out_samplerate/j.BLKSIZE,A=0;for(S=0,r=0;r<j.BLKSIZE/2;++r)S+=N,a.ATH.eql_w[r]=1/Math.pow(10,this.ATHformula(S,n)/10),A+=a.ATH.eql_w[r];for(A=1/A,r=j.BLKSIZE/2;--r>=0;)a.ATH.eql_w[r]*=A}for(R=b=0;R<a.npart_s;++R)for(r=0;r<a.numlines_s[R];++r)++b;for(Q(129==b),R=b=0;R<a.npart_l;++R)for(r=0;r<a.numlines_l[R];++r)++b;for(Q(513==b),b=0,r=0;r<a.npart_l;r++)S=y*(b+a.numlines_l[r]/2)/(1*j.BLKSIZE),a.mld_cb_l[r]=Se(S),b+=a.numlines_l[r];for(;r<j.CBANDS;++r)a.mld_cb_l[r]=1;for(b=0,r=0;r<a.npart_s;r++)S=y*(b+a.numlines_s[r]/2)/(1*j.BLKSIZE_s),a.mld_cb_s[r]=Se(S),b+=a.numlines_s[r];for(;r<j.CBANDS;++r)a.mld_cb_s[r]=1;return 0},this.ATHformula=function(e,t){var n;switch(t.ATHtype){case 0:n=Ce(e,9);break;case 1:n=Ce(e,-1);break;case 2:default:n=Ce(e,0);break;case 3:n=Ce(e,1)+6;break;case 4:n=Ce(e,t.ATHcurve)}return n}}var Z=J;function $(e){var t=e;this.ordinal=function(){return t}}$.STEREO=new $(0),$.JOINT_STEREO=new $(1),$.DUAL_CHANNEL=new $(2),$.MONO=new $(3),$.NOT_SET=new $(4);var ee=$;function te(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=ee.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var ne=te,re={};re.SFBMAX=3*j.SBMAX_s;var ie=re,ae=m.new_float,oe=m.new_int;function se(){this.xr=ae(576),this.l3_enc=oe(576),this.scalefac=oe(ie.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=oe(3),this.subblock_gain=oe(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=oe(ie.SFBMAX),this.window=oe(ie.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=oe(4),this.max_nonzero_coeff=0;var e=this;function t(e){return new Int32Array(e)}function n(e){return new Float32Array(e)}this.assign=function(r){e.xr=n(r.xr),e.l3_enc=t(r.l3_enc),e.scalefac=t(r.scalefac),e.xrpow_max=r.xrpow_max,e.part2_3_length=r.part2_3_length,e.big_values=r.big_values,e.count1=r.count1,e.global_gain=r.global_gain,e.scalefac_compress=r.scalefac_compress,e.block_type=r.block_type,e.mixed_block_flag=r.mixed_block_flag,e.table_select=t(r.table_select),e.subblock_gain=t(r.subblock_gain),e.region0_count=r.region0_count,e.region1_count=r.region1_count,e.preflag=r.preflag,e.scalefac_scale=r.scalefac_scale,e.count1table_select=r.count1table_select,e.part2_length=r.part2_length,e.sfb_lmax=r.sfb_lmax,e.sfb_smin=r.sfb_smin,e.psy_lmax=r.psy_lmax,e.sfbmax=r.sfbmax,e.psymax=r.psymax,e.sfbdivide=r.sfbdivide,e.width=t(r.width),e.window=t(r.window),e.count1bits=r.count1bits,e.sfb_partition_table=r.sfb_partition_table.slice(0),e.slen=t(r.slen),e.max_nonzero_coeff=r.max_nonzero_coeff}}var ce=se,ue=m.new_int;function le(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[ue(4),ue(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new ce}var de=le,fe=m.System,he=m.new_int;function pe(e,t,n,r){this.l=he(1+j.SBMAX_l),this.s=he(1+j.SBMAX_s),this.psfb21=he(1+j.PSFB21),this.psfb12=he(1+j.PSFB12);var i=this.l,a=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],fe.arraycopy(this.arrL,0,i,0,Math.min(this.arrL.length,this.l.length)),fe.arraycopy(this.arrS,0,a,0,Math.min(this.arrS.length,this.s.length)),fe.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),fe.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var me=pe,ge=m.new_float,ve=m.new_float_n,ye=m.new_int;function be(){this.last_en_subshort=ve([4,9]),this.lastAttacks=ye(4),this.pefirbuf=ge(19),this.longfact=ge(j.SBMAX_l),this.shortfact=ge(j.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var _e=be;function we(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var Ee=we,Se=m.new_byte,Ce=m.new_double,xe=m.new_float,Te=m.new_float_n,Re=m.new_int,Ie=m.new_int_n;function Ne(){var e=40;function t(){this.write_timing=0,this.ptr=0,this.buf=Se(e)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Te([2,Ne.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new de,this.ms_ratio=xe(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Re(2),this.CurrentStep=Re(2),this.masking_lower=0,this.bv_scf=Re(576),this.pseudohalf=Re(ie.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Ne.BPC+1),this.itime=Ce(2),this.sideinfo_len=0,this.sb_sample=Te([2,2,18,j.SBLIMIT]),this.amp_filter=xe(32),this.header=new Array(Ne.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new me,this.minval_l=xe(j.CBANDS),this.minval_s=xe(j.CBANDS),this.nb_1=Te([4,j.CBANDS]),this.nb_2=Te([4,j.CBANDS]),this.nb_s1=Te([4,j.CBANDS]),this.nb_s2=Te([4,j.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=xe(4),this.loudness_sq=Te([2,2]),this.loudness_sq_save=xe(2),this.mld_l=xe(j.SBMAX_l),this.mld_s=xe(j.SBMAX_s),this.bm_l=Re(j.SBMAX_l),this.bo_l=Re(j.SBMAX_l),this.bm_s=Re(j.SBMAX_s),this.bo_s=Re(j.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Ie([j.CBANDS,2]),this.s3ind_s=Ie([j.CBANDS,2]),this.numlines_s=Re(j.CBANDS),this.numlines_l=Re(j.CBANDS),this.rnumlines_l=xe(j.CBANDS),this.mld_cb_l=xe(j.CBANDS),this.mld_cb_s=xe(j.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=xe(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Re(2),this.nsPsy=new _e,this.VBR_seek_table=new Ee,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Ie([16,5]),this.bitrate_blockType_Hist=Ie([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var n=0;n<this.en.length;n++)this.en[n]=new T;for(n=0;n<this.thm.length;n++)this.thm[n]=new T;for(n=0;n<this.header.length;n++)this.header[n]=new t}Ne.MFSIZE=3456+j.ENCDELAY-j.MDCTDELAY,Ne.MAX_HEADER_BUF=256,Ne.MAX_BITS_PER_CHANNEL=4095,Ne.MAX_BITS_PER_GRANULE=7680,Ne.BPC=320;var Ae=Ne,ke=m.new_float;function De(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=ke(j.SBMAX_l),this.s=ke(j.SBMAX_s),this.psfb21=ke(j.PSFB21),this.psfb12=ke(j.PSFB12),this.cb_l=ke(j.CBANDS),this.cb_s=ke(j.CBANDS),this.eql_w=ke(j.BLKSIZE/2)}var Me=De,Le=m.System,Oe=m.Arrays;function Pe(){var e=64.82,t=(Pe.YULE_ORDER,.95),n=(Pe.MAX_SAMP_FREQ,Pe.RMS_WINDOW_TIME_NUMERATOR),r=Pe.RMS_WINDOW_TIME_DENOMINATOR,i=(Pe.MAX_SAMPLES_PER_WINDOW,[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]]),a=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(e,t,n,r,i,a){for(;0!=i--;)n[r]=1e-10+e[t+0]*a[0]-n[r-1]*a[1]+e[t-1]*a[2]-n[r-2]*a[3]+e[t-2]*a[4]-n[r-3]*a[5]+e[t-3]*a[6]-n[r-4]*a[7]+e[t-4]*a[8]-n[r-5]*a[9]+e[t-5]*a[10]-n[r-6]*a[11]+e[t-6]*a[12]-n[r-7]*a[13]+e[t-7]*a[14]-n[r-8]*a[15]+e[t-8]*a[16]-n[r-9]*a[17]+e[t-9]*a[18]-n[r-10]*a[19]+e[t-10]*a[20],++r,++t}function s(e,t,n,r,i,a){for(;0!=i--;)n[r]=e[t+0]*a[0]-n[r-1]*a[1]+e[t-1]*a[2]-n[r-2]*a[3]+e[t-2]*a[4],++r,++t}function c(e,t){for(var i=0;i<MAX_ORDER;i++)e.linprebuf[i]=e.lstepbuf[i]=e.loutbuf[i]=e.rinprebuf[i]=e.rstepbuf[i]=e.routbuf[i]=0;switch(0|t){case 48e3:e.reqindex=0;break;case 44100:e.reqindex=1;break;case 32e3:e.reqindex=2;break;case 24e3:e.reqindex=3;break;case 22050:e.reqindex=4;break;case 16e3:e.reqindex=5;break;case 12e3:e.reqindex=6;break;case 11025:e.reqindex=7;break;case 8e3:e.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return e.sampleWindow=0|(t*n+r-1)/r,e.lsum=0,e.rsum=0,e.totsamp=0,Oe.ill(e.A,0),INIT_GAIN_ANALYSIS_OK}function u(e){return e*e}function l(n,r){var i,a=0;for(i=0;i<r;i++)a+=n[i];if(0==a)return GAIN_NOT_ENOUGH_SAMPLES;var o=0|Math.ceil(a*(1-t));for(i=r;i-- >0&&!((o-=n[i])<=0););return e-i/Pe.STEPS_per_dB}this.InitGainAnalysis=function(e,t){return c(e,t)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(e.linpre=MAX_ORDER,e.rinpre=MAX_ORDER,e.lstep=MAX_ORDER,e.rstep=MAX_ORDER,e.lout=MAX_ORDER,e.rout=MAX_ORDER,Oe.fill(e.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(e,t,n,r,c,l,d){var f,h,p,m,g,v,y;if(0==l)return GAIN_ANALYSIS_OK;switch(y=0,g=l,d){case 1:r=t,c=n;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(l<MAX_ORDER?(Le.arraycopy(t,n,e.linprebuf,MAX_ORDER,l),Le.arraycopy(r,c,e.rinprebuf,MAX_ORDER,l)):(Le.arraycopy(t,n,e.linprebuf,MAX_ORDER,MAX_ORDER),Le.arraycopy(r,c,e.rinprebuf,MAX_ORDER,MAX_ORDER));g>0;){v=g>e.sampleWindow-e.totsamp?e.sampleWindow-e.totsamp:g,y<MAX_ORDER?(f=e.linpre+y,h=e.linprebuf,p=e.rinpre+y,m=e.rinprebuf,v>MAX_ORDER-y&&(v=MAX_ORDER-y)):(f=n+y,h=t,p=c+y,m=r),o(h,f,e.lstepbuf,e.lstep+e.totsamp,v,i[e.reqindex]),o(m,p,e.rstepbuf,e.rstep+e.totsamp,v,i[e.reqindex]),s(e.lstepbuf,e.lstep+e.totsamp,e.loutbuf,e.lout+e.totsamp,v,a[e.reqindex]),s(e.rstepbuf,e.rstep+e.totsamp,e.routbuf,e.rout+e.totsamp,v,a[e.reqindex]),f=e.lout+e.totsamp,h=e.loutbuf,p=e.rout+e.totsamp,m=e.routbuf;for(var b=v%8;0!=b--;)e.lsum+=u(h[f++]),e.rsum+=u(m[p++]);for(b=v/8;0!=b--;)e.lsum+=u(h[f+0])+u(h[f+1])+u(h[f+2])+u(h[f+3])+u(h[f+4])+u(h[f+5])+u(h[f+6])+u(h[f+7]),f+=8,e.rsum+=u(m[p+0])+u(m[p+1])+u(m[p+2])+u(m[p+3])+u(m[p+4])+u(m[p+5])+u(m[p+6])+u(m[p+7]),p+=8;if(g-=v,y+=v,e.totsamp+=v,e.totsamp==e.sampleWindow){var _=10*Pe.STEPS_per_dB*Math.log10((e.lsum+e.rsum)/e.totsamp*.5+1e-37),w=_<=0?0:0|_;w>=e.A.length&&(w=e.A.length-1),e.A[w]++,e.lsum=e.rsum=0,Le.arraycopy(e.loutbuf,e.totsamp,e.loutbuf,0,MAX_ORDER),Le.arraycopy(e.routbuf,e.totsamp,e.routbuf,0,MAX_ORDER),Le.arraycopy(e.lstepbuf,e.totsamp,e.lstepbuf,0,MAX_ORDER),Le.arraycopy(e.rstepbuf,e.totsamp,e.rstepbuf,0,MAX_ORDER),e.totsamp=0}if(e.totsamp>e.sampleWindow)return GAIN_ANALYSIS_ERROR}return l<MAX_ORDER?(Le.arraycopy(e.linprebuf,l,e.linprebuf,0,MAX_ORDER-l),Le.arraycopy(e.rinprebuf,l,e.rinprebuf,0,MAX_ORDER-l),Le.arraycopy(t,n,e.linprebuf,MAX_ORDER-l,l),Le.arraycopy(r,c,e.rinprebuf,MAX_ORDER-l,l)):(Le.arraycopy(t,n+l-MAX_ORDER,e.linprebuf,0,MAX_ORDER),Le.arraycopy(r,c+l-MAX_ORDER,e.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var t=l(e.A,e.A.length),n=0;n<e.A.length;n++)e.B[n]+=e.A[n],e.A[n]=0;for(n=0;n<MAX_ORDER;n++)e.linprebuf[n]=e.lstepbuf[n]=e.loutbuf[n]=e.rinprebuf[n]=e.rstepbuf[n]=e.routbuf[n]=0;return e.totsamp=0,e.lsum=e.rsum=0,t}}Pe.STEPS_per_dB=100,Pe.MAX_dB=120,Pe.GAIN_NOT_ENOUGH_SAMPLES=-24601,Pe.GAIN_ANALYSIS_ERROR=0,Pe.GAIN_ANALYSIS_OK=1,Pe.INIT_GAIN_ANALYSIS_ERROR=0,Pe.INIT_GAIN_ANALYSIS_OK=1,Pe.YULE_ORDER=10,Pe.MAX_ORDER=Pe.YULE_ORDER,Pe.MAX_SAMP_FREQ=48e3,Pe.RMS_WINDOW_TIME_NUMERATOR=1,Pe.RMS_WINDOW_TIME_DENOMINATOR=20,Pe.MAX_SAMPLES_PER_WINDOW=Pe.MAX_SAMP_FREQ*Pe.RMS_WINDOW_TIME_NUMERATOR/Pe.RMS_WINDOW_TIME_DENOMINATOR+1;var je=Pe,Fe=m.new_float,Ue=m.new_int;function Be(){this.linprebuf=Fe(2*je.MAX_ORDER),this.linpre=0,this.lstepbuf=Fe(je.MAX_SAMPLES_PER_WINDOW+je.MAX_ORDER),this.lstep=0,this.loutbuf=Fe(je.MAX_SAMPLES_PER_WINDOW+je.MAX_ORDER),this.lout=0,this.rinprebuf=Fe(2*je.MAX_ORDER),this.rinpre=0,this.rstepbuf=Fe(je.MAX_SAMPLES_PER_WINDOW+je.MAX_ORDER),this.rstep=0,this.routbuf=Fe(je.MAX_SAMPLES_PER_WINDOW+je.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Ue(0|je.STEPS_per_dB*je.MAX_dB),this.B=Ue(0|je.STEPS_per_dB*je.MAX_dB)}var Ve=Be;function ze(e){this.bits=e}var We=ze,Ge=m.new_float,He=m.new_int,Ye=m.assert;function qe(e){var t=e;this.quantize=t,this.iteration_loop=function(e,t,n,r){var i,a=e.internal_flags,o=Ge(ie.SFBMAX),s=Ge(576),c=He(2),u=0,l=a.l3_side,d=new We(u);this.quantize.rv.ResvFrameBegin(e,d),u=d.bits;for(var f=0;f<a.mode_gr;f++){i=this.quantize.qupvt.on_pe(e,t,c,u,f,f),a.mode_ext==j.MPG_MD_MS_LR&&(this.quantize.ms_convert(a.l3_side,f),this.quantize.qupvt.reduce_side(c,n[f],u,i));for(var h=0;h<a.channels_out;h++){var p,m,g=l.tt[f][h];g.block_type!=j.SHORT_TYPE?(p=0,m=a.PSY.mask_adjust-p):(p=0,m=a.PSY.mask_adjust_short-p),a.masking_lower=Math.pow(10,.1*m),this.quantize.init_outer_loop(a,g),this.quantize.init_xrpow(a,g,s)&&(this.quantize.qupvt.calc_xmin(e,r[f][h],g,o),this.quantize.outer_loop(e,g,o,s,h,c[h])),this.quantize.iteration_finish_one(a,f,h),Ye(g.part2_3_length<=Ae.MAX_BITS_PER_CHANNEL),Ye(g.part2_3_length<=c[h])}}this.quantize.rv.ResvFrameEnd(a,u)}}var Ke=qe;function Xe(e,t,n,r){this.xlen=e,this.linmax=t,this.table=n,this.hlen=r}var Qe={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};Qe.ht=[new Xe(0,0,null,null),new Xe(2,0,Qe.t1HB,Qe.t1l),new Xe(3,0,Qe.t2HB,Qe.t2l),new Xe(3,0,Qe.t3HB,Qe.t3l),new Xe(0,0,null,null),new Xe(4,0,Qe.t5HB,Qe.t5l),new Xe(4,0,Qe.t6HB,Qe.t6l),new Xe(6,0,Qe.t7HB,Qe.t7l),new Xe(6,0,Qe.t8HB,Qe.t8l),new Xe(6,0,Qe.t9HB,Qe.t9l),new Xe(8,0,Qe.t10HB,Qe.t10l),new Xe(8,0,Qe.t11HB,Qe.t11l),new Xe(8,0,Qe.t12HB,Qe.t12l),new Xe(16,0,Qe.t13HB,Qe.t13l),new Xe(0,0,null,Qe.t16_5l),new Xe(16,0,Qe.t15HB,Qe.t15l),new Xe(1,1,Qe.t16HB,Qe.t16l),new Xe(2,3,Qe.t16HB,Qe.t16l),new Xe(3,7,Qe.t16HB,Qe.t16l),new Xe(4,15,Qe.t16HB,Qe.t16l),new Xe(6,63,Qe.t16HB,Qe.t16l),new Xe(8,255,Qe.t16HB,Qe.t16l),new Xe(10,1023,Qe.t16HB,Qe.t16l),new Xe(13,8191,Qe.t16HB,Qe.t16l),new Xe(4,15,Qe.t24HB,Qe.t24l),new Xe(5,31,Qe.t24HB,Qe.t24l),new Xe(6,63,Qe.t24HB,Qe.t24l),new Xe(7,127,Qe.t24HB,Qe.t24l),new Xe(8,255,Qe.t24HB,Qe.t24l),new Xe(9,511,Qe.t24HB,Qe.t24l),new Xe(11,2047,Qe.t24HB,Qe.t24l),new Xe(13,8191,Qe.t24HB,Qe.t24l),new Xe(0,0,Qe.t32HB,Qe.t32l),new Xe(0,0,Qe.t33HB,Qe.t33l)],Qe.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],Qe.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],Qe.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],Qe.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],Qe.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],Qe.scfsi_band=[0,6,11,16,21];var Je=Qe,Ze=m.VbrMode,$e=m.Float,et=m.Util,tt=m.new_float,nt=m.new_int,rt=m.assert;function it(){var e=null,t=null,n=null;function r(e){return rt(0<=e+it.Q_MAX2&&e<it.Q_MAX),l[e+it.Q_MAX2]}this.setModules=function(r,i,a){e=r,t=i,n=a},this.IPOW20=function(e){return rt(0<=e&&e<it.Q_MAX),d[e]};var i=2220446049250313e-31,a=it.IXMAX_VAL+2,o=it.Q_MAX,s=it.Q_MAX2,c=(it.LARGE_BITS,100);this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var u=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=u,this.sfBandIndex=[new me([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new me([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new me([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new me([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new me([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new me([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new me([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new me([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new me([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var l=tt(o+s+1),d=tt(o),f=tt(a),h=tt(a);function p(e,t){var r=n.ATHformula(t,e);return r-=c,r=Math.pow(10,r/10+e.ATHlower)}function m(e){for(var t=e.internal_flags.ATH.l,n=e.internal_flags.ATH.psfb21,r=e.internal_flags.ATH.s,i=e.internal_flags.ATH.psfb12,a=e.internal_flags,o=e.out_samplerate,s=0;s<j.SBMAX_l;s++){var c=a.scalefac_band.l[s],u=a.scalefac_band.l[s+1];t[s]=$e.MAX_VALUE;for(var l=c;l<u;l++){var d=p(e,l*o/1152);t[s]=Math.min(t[s],d)}}for(s=0;s<j.PSFB21;s++)for(c=a.scalefac_band.psfb21[s],u=a.scalefac_band.psfb21[s+1],n[s]=$e.MAX_VALUE,l=c;l<u;l++)d=p(e,l*o/1152),n[s]=Math.min(n[s],d);for(s=0;s<j.SBMAX_s;s++){for(c=a.scalefac_band.s[s],u=a.scalefac_band.s[s+1],r[s]=$e.MAX_VALUE,l=c;l<u;l++)d=p(e,l*o/384),r[s]=Math.min(r[s],d);r[s]*=a.scalefac_band.s[s+1]-a.scalefac_band.s[s]}for(s=0;s<j.PSFB12;s++){for(c=a.scalefac_band.psfb12[s],u=a.scalefac_band.psfb12[s+1],i[s]=$e.MAX_VALUE,l=c;l<u;l++)d=p(e,l*o/384),i[s]=Math.min(i[s],d);i[s]*=a.scalefac_band.s[13]-a.scalefac_band.s[12]}if(e.noATH){for(s=0;s<j.SBMAX_l;s++)t[s]=1e-20;for(s=0;s<j.PSFB21;s++)n[s]=1e-20;for(s=0;s<j.SBMAX_s;s++)r[s]=1e-20;for(s=0;s<j.PSFB12;s++)i[s]=1e-20}a.ATH.floor=10*Math.log10(p(e,-1))}function g(e){this.s=e}this.adj43=h,this.iteration_init=function(t){var n,r=t.internal_flags,i=r.l3_side;if(0==r.iteration_init_init){for(r.iteration_init_init=1,i.main_data_begin=0,m(t),f[0]=0,n=1;n<a;n++)f[n]=Math.pow(n,4/3);for(n=0;n<a-1;n++)h[n]=n+1-Math.pow(.5*(f[n]+f[n+1]),.75);for(h[n]=.5,n=0;n<o;n++)d[n]=Math.pow(2,-.1875*(n-210));for(n=0;n<=o+s;n++)l[n]=Math.pow(2,.25*(n-210-s));var c,u,p,g;for(e.huffman_init(r),(n=t.exp_nspsytune>>2&63)>=32&&(n-=64),c=Math.pow(10,n/4/10),(n=t.exp_nspsytune>>8&63)>=32&&(n-=64),u=Math.pow(10,n/4/10),(n=t.exp_nspsytune>>14&63)>=32&&(n-=64),p=Math.pow(10,n/4/10),(n=t.exp_nspsytune>>20&63)>=32&&(n-=64),g=p*Math.pow(10,n/4/10),n=0;n<j.SBMAX_l;n++)v=n<=6?c:n<=13?u:n<=20?p:g,r.nsPsy.longfact[n]=v;for(n=0;n<j.SBMAX_s;n++){var v;v=n<=5?c:n<=10?u:n<=11?p:g,r.nsPsy.shortfact[n]=v}}},this.on_pe=function(e,n,r,i,a,o){var s,c,u=e.internal_flags,l=0,d=nt(2),f=new We(l),h=t.ResvMaxBits(e,i,f,o),p=(l=f.bits)+h;for(p>Ae.MAX_BITS_PER_GRANULE&&(p=Ae.MAX_BITS_PER_GRANULE),s=0,c=0;c<u.channels_out;++c)r[c]=Math.min(Ae.MAX_BITS_PER_CHANNEL,l/u.channels_out),d[c]=0|r[c]*n[a][c]/700-r[c],d[c]>3*i/4&&(d[c]=3*i/4),d[c]<0&&(d[c]=0),d[c]+r[c]>Ae.MAX_BITS_PER_CHANNEL&&(d[c]=Math.max(0,Ae.MAX_BITS_PER_CHANNEL-r[c])),s+=d[c];if(s>h)for(c=0;c<u.channels_out;++c)d[c]=h*d[c]/s;for(c=0;c<u.channels_out;++c)r[c]+=d[c],h-=d[c];for(s=0,c=0;c<u.channels_out;++c)s+=r[c];if(s>Ae.MAX_BITS_PER_GRANULE){var m=0;for(c=0;c<u.channels_out;++c)r[c]*=Ae.MAX_BITS_PER_GRANULE,r[c]/=s,m+=r[c];rt(m<=Ae.MAX_BITS_PER_GRANULE)}return p},this.reduce_side=function(e,t,n,r){rt(r<=Ae.MAX_BITS_PER_GRANULE),rt(e[0]+e[1]<=Ae.MAX_BITS_PER_GRANULE);var i=.33*(.5-t)/.5;i<0&&(i=0),i>.5&&(i=.5);var a=0|.5*i*(e[0]+e[1]);a>Ae.MAX_BITS_PER_CHANNEL-e[0]&&(a=Ae.MAX_BITS_PER_CHANNEL-e[0]),a<0&&(a=0),e[1]>=125&&(e[1]-a>125?(e[0]<n&&(e[0]+=a),e[1]-=a):(e[0]+=e[1]-125,e[1]=125)),(a=e[0]+e[1])>r&&(e[0]=r*e[0]/a,e[1]=r*e[1]/a),rt(e[0]<=Ae.MAX_BITS_PER_CHANNEL),rt(e[1]<=Ae.MAX_BITS_PER_CHANNEL),rt(e[0]+e[1]<=Ae.MAX_BITS_PER_GRANULE)},this.athAdjust=function(e,t,n){var r=90.30873362,i=94.82444863,a=et.FAST_LOG10_X(t,10),o=e*e,s=0;return a-=n,o>1e-20&&(s=1+et.FAST_LOG10_X(o,10/r)),s<0&&(s=0),a*=s,a+=n+r-i,Math.pow(10,.1*a)},this.calc_xmin=function(e,t,n,r){var a,o=0,s=e.internal_flags,c=0,u=0,l=s.ATH,d=n.xr,f=e.VBR==Ze.vbr_mtrh?1:0,h=s.masking_lower;for(e.VBR!=Ze.vbr_mtrh&&e.VBR!=Ze.vbr_mt||(h=1),a=0;a<n.psy_lmax;a++){w=(_=e.VBR==Ze.vbr_rh||e.VBR==Ze.vbr_mtrh?athAdjust(l.adjust,l.l[a],l.floor):l.adjust*l.l[a])/(v=n.width[a]),E=i,T=v>>1,x=0;do{x+=R=d[c]*d[c],E+=R<w?R:w,x+=I=d[++c]*d[c],E+=I<w?I:w,c++}while(--T>0);x>_&&u++,a==j.SBPSY_l&&E<(C=_*s.nsPsy.longfact[a])&&(E=C),0!=f&&(_=E),e.ATHonly||(S=t.en.l[a])>0&&(C=x*t.thm.l[a]*h/S,0!=f&&(C*=s.nsPsy.longfact[a]),_<C&&(_=C)),r[o++]=0!=f?_:_*s.nsPsy.longfact[a]}var p=575;if(n.block_type!=j.SHORT_TYPE)for(var m=576;0!=m--&&BitStream.EQ(d[m],0);)p=m;n.max_nonzero_coeff=p;for(var g=n.sfb_smin;a<n.psymax;g++,a+=3){var v,y,b;for(b=e.VBR==Ze.vbr_rh||e.VBR==Ze.vbr_mtrh?athAdjust(l.adjust,l.s[g],l.floor):l.adjust*l.s[g],v=n.width[a],y=0;y<3;y++){var _,w,E,S,C,x=0,T=v>>1;w=b/v,E=i;do{var R,I;x+=R=d[c]*d[c],E+=R<w?R:w,x+=I=d[++c]*d[c],E+=I<w?I:w,c++}while(--T>0);x>b&&u++,g==j.SBPSY_s&&E<(C=b*s.nsPsy.shortfact[g])&&(E=C),_=0!=f?E:b,e.ATHonly||e.ATHshort||(S=t.en.s[g][y])>0&&(C=x*t.thm.s[g][y]*h/S,0!=f&&(C*=s.nsPsy.shortfact[g]),_<C&&(_=C)),r[o++]=0!=f?_:_*s.nsPsy.shortfact[g]}e.useTemporal&&(r[o-3]>r[o-3+1]&&(r[o-3+1]+=(r[o-3]-r[o-3+1])*s.decay),r[o-3+1]>r[o-3+2]&&(r[o-3+2]+=(r[o-3+1]-r[o-3+2])*s.decay))}return u},this.calc_noise_core=function(e,t,n,r){var i=0,a=t.s,o=e.l3_enc;if(a>e.count1)for(;0!=n--;)c=e.xr[a],a++,i+=c*c,c=e.xr[a],a++,i+=c*c;else if(a>e.big_values){var s=tt(2);for(s[0]=0,s[1]=r;0!=n--;)c=Math.abs(e.xr[a])-s[o[a]],a++,i+=c*c,c=Math.abs(e.xr[a])-s[o[a]],a++,i+=c*c}else for(;0!=n--;){var c;c=Math.abs(e.xr[a])-f[o[a]]*r,a++,i+=c*c,c=Math.abs(e.xr[a])-f[o[a]]*r,a++,i+=c*c}return t.s=a,i},this.calc_noise=function(e,t,n,i,a){var o,s,c=0,l=0,d=0,f=0,h=0,p=-20,m=0,v=e.scalefac,y=0;for(i.over_SSD=0,o=0;o<e.psymax;o++){var b,_=e.global_gain-(v[y++]+(0!=e.preflag?u[o]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[o]],w=0;if(null!=a&&a.step[o]==_)w=a.noise[o],m+=e.width[o],n[c++]=w/t[l++],w=a.noise_log[o];else{var E,S=r(_);s=e.width[o]>>1,m+e.width[o]>e.max_nonzero_coeff&&(s=(E=e.max_nonzero_coeff-m+1)>0?E>>1:0);var C=new g(m);w=this.calc_noise_core(e,C,s,S),m=C.s,null!=a&&(a.step[o]=_,a.noise[o]=w),w=n[c++]=w/t[l++],w=et.FAST_LOG10(Math.max(w,1e-20)),null!=a&&(a.noise_log[o]=w)}null!=a&&(a.global_gain=e.global_gain),h+=w,w>0&&(b=Math.max(0|10*w+.5,1),i.over_SSD+=b*b,d++,f+=w),p=Math.max(p,w)}return i.over_count=d,i.tot_noise=h,i.over_noise=f,i.max_noise=p,d},this.set_pinfo=function(e,t,n,r,i){var a,o,s,c,l,d=e.internal_flags,f=0==t.scalefac_scale?.5:1,h=t.scalefac,p=tt(L3Side.SFBMAX),m=tt(L3Side.SFBMAX),g=new CalcNoiseResult;calc_xmin(e,n,t,p),calc_noise(t,p,m,g,null);var v=0;for(o=t.sfb_lmax,t.block_type!=j.SHORT_TYPE&&0==t.mixed_block_flag&&(o=22),a=0;a<o;a++){var y=d.scalefac_band.l[a],b=(_=d.scalefac_band.l[a+1])-y;for(c=0;v<_;v++)c+=t.xr[v]*t.xr[v];c/=b,l=1e15,d.pinfo.en[r][i][a]=l*c,d.pinfo.xfsf[r][i][a]=l*p[a]*m[a]/b,n.en.l[a]>0&&!e.ATHonly?c/=n.en.l[a]:c=0,d.pinfo.thr[r][i][a]=l*Math.max(c*n.thm.l[a],d.ATH.l[a]),d.pinfo.LAMEsfb[r][i][a]=0,0!=t.preflag&&a>=11&&(d.pinfo.LAMEsfb[r][i][a]=-f*u[a]),a<j.SBPSY_l&&(rt(h[a]>=0),d.pinfo.LAMEsfb[r][i][a]-=f*h[a])}if(t.block_type==j.SHORT_TYPE)for(o=a,a=t.sfb_smin;a<j.SBMAX_s;a++){y=d.scalefac_band.s[a],b=(_=d.scalefac_band.s[a+1])-y;for(var _,w=0;w<3;w++){for(c=0,s=y;s<_;s++)c+=t.xr[v]*t.xr[v],v++;c=Math.max(c/b,1e-20),l=1e15,d.pinfo.en_s[r][i][3*a+w]=l*c,d.pinfo.xfsf_s[r][i][3*a+w]=l*p[o]*m[o]/b,n.en.s[a][w]>0?c/=n.en.s[a][w]:c=0,(e.ATHonly||e.ATHshort)&&(c=0),d.pinfo.thr_s[r][i][3*a+w]=l*Math.max(c*n.thm.s[a][w],d.ATH.s[a]),d.pinfo.LAMEsfb_s[r][i][3*a+w]=-2*t.subblock_gain[w],a<j.SBPSY_s&&(d.pinfo.LAMEsfb_s[r][i][3*a+w]-=f*h[o]),o++}}d.pinfo.LAMEqss[r][i]=t.global_gain,d.pinfo.LAMEmainbits[r][i]=t.part2_3_length+t.part2_length,d.pinfo.LAMEsfbits[r][i]=t.part2_length,d.pinfo.over[r][i]=g.over_count,d.pinfo.max_noise[r][i]=10*g.max_noise,d.pinfo.over_noise[r][i]=10*g.over_noise,d.pinfo.tot_noise[r][i]=10*g.tot_noise,d.pinfo.over_SSD[r][i]=g.over_SSD}}it.Q_MAX=257,it.Q_MAX2=116,it.LARGE_BITS=1e5,it.IXMAX_VAL=8206;var at=it,ot=m.System,st=m.Arrays,ct=m.new_int,ut=m.assert;function lt(){var e=null;function t(e){this.bits=0|e}this.qupvt=null,this.setModules=function(t){this.qupvt=t,e=t};var n=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function r(e,t,n,r,i,a){var o=.5946/t;for(ut(e>0),e>>=1;0!=e--;)i[a++]=o>n[r++]?0:1,i[a++]=o>n[r++]?0:1}function i(t,n,r,i,a,o){ut(t>0);var s=(t>>=1)%2;for(t>>=1;0!=t--;){var c,u,l,d,f,h,p,m;c=r[i++]*n,u=r[i++]*n,f=0|c,l=r[i++]*n,h=0|u,d=r[i++]*n,p=0|l,c+=e.adj43[f],m=0|d,u+=e.adj43[h],a[o++]=0|c,l+=e.adj43[p],a[o++]=0|u,d+=e.adj43[m],a[o++]=0|l,a[o++]=0|d}0!=s&&(f=0|(c=r[i++]*n),h=0|(u=r[i++]*n),c+=e.adj43[f],u+=e.adj43[h],a[o++]=0|c,a[o++]=0|u)}function a(t,n,a,o,s){var c,u,l,d=0,f=0,h=0,p=0,m=n,g=0,v=m,y=0,b=t,_=0;for(l=null!=s&&o.global_gain==s.global_gain,u=o.block_type==j.SHORT_TYPE?38:21,c=0;c<=u;c++){var w=-1;if((l||o.block_type==j.NORM_TYPE)&&(w=o.global_gain-(o.scalefac[c]+(0!=o.preflag?e.pretab[c]:0)<<o.scalefac_scale+1)-8*o.subblock_gain[o.window[c]]),ut(o.width[c]>=0),l&&s.step[c]==w)0!=f&&(i(f,a,b,_,v,y),f=0),0!=h&&(r(h,a,b,_,v,y),h=0);else{var E,S=o.width[c];if(d+o.width[c]>o.max_nonzero_coeff&&(E=o.max_nonzero_coeff-d+1,st.fill(n,o.max_nonzero_coeff,576,0),(S=E)<0&&(S=0),c=u+1),0==f&&0==h&&(v=m,y=g,b=t,_=p),null!=s&&s.sfb_count1>0&&c>=s.sfb_count1&&s.step[c]>0&&w>=s.step[c]?(0!=f&&(i(f,a,b,_,v,y),f=0,v=m,y=g,b=t,_=p),h+=S):(0!=h&&(r(h,a,b,_,v,y),h=0,v=m,y=g,b=t,_=p),f+=S),S<=0){0!=h&&(r(h,a,b,_,v,y),h=0),0!=f&&(i(f,a,b,_,v,y),f=0);break}}c<=u&&(g+=o.width[c],p+=o.width[c],d+=o.width[c])}0!=f&&(i(f,a,b,_,v,y),f=0),0!=h&&(r(h,a,b,_,v,y),h=0)}function o(e,t,n){var r=0,i=0;do{var a=e[t++],o=e[t++];r<a&&(r=a),i<o&&(i=o)}while(t<n);return r<i&&(r=i),r}function s(e,t,n,r,i,a){var o,s=65536*Je.ht[r].xlen+Je.ht[i].xlen,c=0;do{var u=e[t++],l=e[t++];0!=u&&(u>14&&(u=15,c+=s),u*=16),0!=l&&(l>14&&(l=15,c+=s),u+=l),c+=Je.largetbl[u]}while(t<n);return o=65535&c,(c>>=16)>o&&(c=o,r=i),a.bits+=c,r}function c(e,t,n,r){var i=0,a=Je.ht[1].hlen;do{var o=2*e[t+0]+e[t+1];t+=2,i+=a[o]}while(t<n);return r.bits+=i,1}function u(e,t,n,r,i){var a,o,s=0,c=Je.ht[r].xlen;o=2==r?Je.table23:Je.table56;do{var u=e[t+0]*c+e[t+1];t+=2,s+=o[u]}while(t<n);return a=65535&s,(s>>=16)>a&&(s=a,r++),i.bits+=s,r}function l(e,t,n,r,i){var a=0,o=0,s=0,c=Je.ht[r].xlen,u=Je.ht[r].hlen,l=Je.ht[r+1].hlen,d=Je.ht[r+2].hlen;do{var f=e[t+0]*c+e[t+1];t+=2,a+=u[f],o+=l[f],s+=d[f]}while(t<n);var h=r;return a>o&&(a=o,h++),a>s&&(a=s,h=r+2),i.bits+=a,h}var d=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function f(e,t,n,r){var i=o(e,t,n);switch(i){case 0:return i;case 1:return c(e,t,n,r);case 2:case 3:return u(e,t,n,d[i-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return l(e,t,n,d[i-1],r);default:if(i>at.IXMAX_VAL)return r.bits=at.LARGE_BITS,-1;var a,f;for(i-=15,a=24;a<32&&!(Je.ht[a].linmax>=i);a++);for(f=a-8;f<24&&!(Je.ht[f].linmax>=i);f++);return s(e,t,n,f,a,r)}}function h(e,n,r,i,a,o,s){for(var c=n.big_values,u=0;u<=22;u++)i[u]=at.LARGE_BITS;for(u=0;u<16;u++){var l=e.scalefac_band.l[u+1];if(l>=c)break;var d=0,h=new t(d),p=f(r,0,l,h);d=h.bits;for(var m=0;m<8;m++){var g=e.scalefac_band.l[u+m+2];if(g>=c)break;var v=d,y=f(r,l,g,h=new t(v));v=h.bits,i[u+m]>v&&(i[u+m]=v,a[u+m]=u,o[u+m]=p,s[u+m]=y)}}}function p(e,n,r,i,a,o,s,c){for(var u=n.big_values,l=2;l<j.SBMAX_l+1;l++){var d=e.scalefac_band.l[l];if(d>=u)break;var h=a[l-2]+n.count1bits;if(r.part2_3_length<=h)break;var p=new t(h),m=f(i,d,u,p);h=p.bits,r.part2_3_length<=h||(r.assign(n),r.part2_3_length=h,r.region0_count=o[l-2],r.region1_count=l-2-o[l-2],r.table_select[0]=s[l-2],r.table_select[1]=c[l-2],r.table_select[2]=m)}}this.noquant_count_bits=function(e,n,r){var i=n.l3_enc,a=Math.min(576,n.max_nonzero_coeff+2>>1<<1);for(null!=r&&(r.sfb_count1=0);a>1&&0==(i[a-1]|i[a-2]);a-=2);n.count1=a;for(var o=0,s=0;a>3;a-=4){var c;if((2147483647&(i[a-1]|i[a-2]|i[a-3]|i[a-4]))>1)break;c=2*(2*(2*i[a-4]+i[a-3])+i[a-2])+i[a-1],o+=Je.t32l[c],s+=Je.t33l[c]}var u=o;if(n.count1table_select=0,o>s&&(u=s,n.count1table_select=1),n.count1bits=u,n.big_values=a,0==a)return u;if(n.block_type==j.SHORT_TYPE)(o=3*e.scalefac_band.s[3])>n.big_values&&(o=n.big_values),s=n.big_values;else if(n.block_type==j.NORM_TYPE){if(ut(a<=576),o=n.region0_count=e.bv_scf[a-2],s=n.region1_count=e.bv_scf[a-1],ut(o+s+2<j.SBPSY_l),s=e.scalefac_band.l[o+s+2],o=e.scalefac_band.l[o+1],s<a){var l=new t(u);n.table_select[2]=f(i,s,a,l),u=l.bits}}else n.region0_count=7,n.region1_count=j.SBMAX_l-1-7-1,(o=e.scalefac_band.l[8])>(s=a)&&(o=s);if(o=Math.min(o,a),s=Math.min(s,a),ut(o>=0),ut(s>=0),0<o&&(l=new t(u),n.table_select[0]=f(i,0,o,l),u=l.bits),o<s&&(l=new t(u),n.table_select[1]=f(i,o,s,l),u=l.bits),2==e.use_best_huffman&&(n.part2_3_length=u,best_huffman_divide(e,n),u=n.part2_3_length),null!=r&&n.block_type==j.NORM_TYPE){for(var d=0;e.scalefac_band.l[d]<n.big_values;)d++;r.sfb_count1=d}return u},this.count_bits=function(t,n,r,i){var o=r.l3_enc,s=at.IXMAX_VAL/e.IPOW20(r.global_gain);if(r.xrpow_max>s)return at.LARGE_BITS;if(a(n,o,e.IPOW20(r.global_gain),r,i),0!=(2&t.substep_shaping))for(var c=0,u=r.global_gain+r.scalefac_scale,l=.634521682242439/e.IPOW20(u),d=0;d<r.sfbmax;d++){var f,h=r.width[d];if(ut(h>=0),0==t.pseudohalf[d])c+=h;else for(f=c,c+=h;f<c;++f)o[f]=n[f]>=l?o[f]:0}return this.noquant_count_bits(t,r,i)},this.best_huffman_divide=function(e,n){var r=new ce,i=n.l3_enc,a=ct(23),o=ct(23),s=ct(23),c=ct(23);if(n.block_type!=j.SHORT_TYPE||1!=e.mode_gr){r.assign(n),n.block_type==j.NORM_TYPE&&(h(e,n,i,a,o,s,c),p(e,r,n,i,a,o,s,c));var u=r.big_values;if(!(0==u||(i[u-2]|i[u-1])>1)&&!((u=n.count1+2)>576)){r.assign(n),r.count1=u;var l=0,d=0;for(ut(u<=576);u>r.big_values;u-=4){var m=2*(2*(2*i[u-4]+i[u-3])+i[u-2])+i[u-1];l+=Je.t32l[m],d+=Je.t33l[m]}if(r.big_values=u,r.count1table_select=0,l>d&&(l=d,r.count1table_select=1),r.count1bits=l,r.block_type==j.NORM_TYPE)p(e,r,n,i,a,o,s,c);else{if(r.part2_3_length=l,(l=e.scalefac_band.l[8])>u&&(l=u),l>0){var g=new t(r.part2_3_length);r.table_select[0]=f(i,0,l,g),r.part2_3_length=g.bits}u>l&&(g=new t(r.part2_3_length),r.table_select[1]=f(i,l,u,g),r.part2_3_length=g.bits),n.part2_3_length>r.part2_3_length&&n.assign(r)}}}};var m=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],g=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],v=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],y=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];function b(e,t){for(var n,r=t.tt[1][e],i=t.tt[0][e],a=0;a<Je.scfsi_band.length-1;a++){for(n=Je.scfsi_band[a];n<Je.scfsi_band[a+1]&&!(i.scalefac[n]!=r.scalefac[n]&&r.scalefac[n]>=0);n++);if(n==Je.scfsi_band[a+1]){for(n=Je.scfsi_band[a];n<Je.scfsi_band[a+1];n++)r.scalefac[n]=-1;t.scfsi[e][a]=1}}var o=0,s=0;for(n=0;n<11;n++)-1!=r.scalefac[n]&&(s++,o<r.scalefac[n]&&(o=r.scalefac[n]));for(var c=0,u=0;n<j.SBPSY_l;n++)-1!=r.scalefac[n]&&(u++,c<r.scalefac[n]&&(c=r.scalefac[n]));for(a=0;a<16;a++)if(o<m[a]&&c<g[a]){var l=v[a]*s+y[a]*u;r.part2_length>l&&(r.part2_length=l,r.scalefac_compress=a)}}function _(e,t){for(var n=0;n<t;++n)if(e[n]<0)return!1;return!0}lt.slen1_tab=v,lt.slen2_tab=y,this.best_scalefac_store=function(t,n,r,i){var a,o,s,c,u=i.tt[n][r],l=0;for(s=0,a=0;a<u.sfbmax;a++){var d=u.width[a];for(ut(d>=0),s+=d,c=-d;c<0&&0==u.l3_enc[c+s];c++);0==c&&(u.scalefac[a]=l=-2)}if(0==u.scalefac_scale&&0==u.preflag){var f=0;for(a=0;a<u.sfbmax;a++)u.scalefac[a]>0&&(f|=u.scalefac[a]);if(0==(1&f)&&0!=f){for(a=0;a<u.sfbmax;a++)u.scalefac[a]>0&&(u.scalefac[a]>>=1);u.scalefac_scale=l=1}}if(0==u.preflag&&u.block_type!=j.SHORT_TYPE&&2==t.mode_gr){for(a=11;a<j.SBPSY_l&&!(u.scalefac[a]<e.pretab[a]&&-2!=u.scalefac[a]);a++);if(a==j.SBPSY_l){for(a=11;a<j.SBPSY_l;a++)u.scalefac[a]>0&&(u.scalefac[a]-=e.pretab[a]);u.preflag=l=1}}for(o=0;o<4;o++)i.scfsi[r][o]=0;for(2==t.mode_gr&&1==n&&i.tt[0][r].block_type!=j.SHORT_TYPE&&i.tt[1][r].block_type!=j.SHORT_TYPE&&(b(r,i),l=0),a=0;a<u.sfbmax;a++)-2==u.scalefac[a]&&(u.scalefac[a]=0);0!=l&&(2==t.mode_gr?this.scale_bitcount(u):this.scale_bitcount_lsf(t,u))};var w=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],E=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],S=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(t){var n,r,i,a=0,o=0,s=t.scalefac;if(ut(_(s,t.sfbmax)),t.block_type==j.SHORT_TYPE)i=w,0!=t.mixed_block_flag&&(i=E);else if(i=S,0==t.preflag){for(r=11;r<j.SBPSY_l&&!(s[r]<e.pretab[r]);r++);if(r==j.SBPSY_l)for(t.preflag=1,r=11;r<j.SBPSY_l;r++)s[r]-=e.pretab[r]}for(r=0;r<t.sfbdivide;r++)a<s[r]&&(a=s[r]);for(;r<t.sfbmax;r++)o<s[r]&&(o=s[r]);for(t.part2_length=at.LARGE_BITS,n=0;n<16;n++)a<m[n]&&o<g[n]&&t.part2_length>i[n]&&(t.part2_length=i[n],t.scalefac_compress=n);return t.part2_length==at.LARGE_BITS};var C=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(t,n){var r,i,a,o,s,c,u,l,d=ct(4),f=n.scalefac;for(r=0!=n.preflag?2:0,u=0;u<4;u++)d[u]=0;if(n.block_type==j.SHORT_TYPE){i=1;var h=e.nr_of_sfb_block[r][i];for(l=0,a=0;a<4;a++)for(o=h[a]/3,u=0;u<o;u++,l++)for(s=0;s<3;s++)f[3*l+s]>d[a]&&(d[a]=f[3*l+s])}else for(i=0,h=e.nr_of_sfb_block[r][i],l=0,a=0;a<4;a++)for(o=h[a],u=0;u<o;u++,l++)f[l]>d[a]&&(d[a]=f[l]);for(c=!1,a=0;a<4;a++)d[a]>C[r][a]&&(c=!0);if(!c){var p,m,g,v;for(n.sfb_partition_table=e.nr_of_sfb_block[r][i],a=0;a<4;a++)n.slen[a]=x[d[a]];switch(p=n.slen[0],m=n.slen[1],g=n.slen[2],v=n.slen[3],r){case 0:n.scalefac_compress=(5*p+m<<4)+(g<<2)+v;break;case 1:n.scalefac_compress=400+(5*p+m<<2)+g;break;case 2:n.scalefac_compress=500+3*p+m;break;default:ot.err.printf("intensity stereo not implemented yet\n")}}if(!c)for(ut(null!=n.sfb_partition_table),n.part2_length=0,a=0;a<4;a++)n.part2_length+=n.slen[a]*n.sfb_partition_table[a];return c};var x=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var r,i=0;e.scalefac_band.l[++i]<t;);for(r=n[i][0];e.scalefac_band.l[r+1]>t;)r--;for(r<0&&(r=n[i][0]),e.bv_scf[t-2]=r,r=n[i][1];e.scalefac_band.l[r+e.bv_scf[t-2]+2]>t;)r--;r<0&&(r=n[i][1]),e.bv_scf[t-1]=r}}}var dt=lt,ft=m.System,ht=m.Arrays,pt=m.new_byte,mt=m.new_float_n,gt=m.new_int,vt=m.assert;function yt(){var e=this,t=32773,n=32,r=null,i=null,a=null,o=null;this.setModules=function(e,t,n,s){r=e,i=t,a=n,o=s};var s=null,c=0,u=0,l=0;function d(e){ft.arraycopy(e.header[e.w_ptr].buf,0,s,u,e.sideinfo_len),u+=e.sideinfo_len,c+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&Ae.MAX_HEADER_BUF-1}function f(e,t,r){for(vt(r<n-2);r>0;){var i;0==l&&(l=8,u++,vt(u<Lame.LAME_MAXMP3BUFFER),vt(e.header[e.w_ptr].write_timing>=c),e.header[e.w_ptr].write_timing==c&&d(e),s[u]=0),i=Math.min(r,l),l-=i,vt((r-=i)<n),vt(l<n),s[u]|=t>>r<<l,c+=i}}function h(e,t,r){for(vt(r<n-2);r>0;){var i;0==l&&(l=8,u++,vt(u<Lame.LAME_MAXMP3BUFFER),s[u]=0),i=Math.min(r,l),l-=i,vt((r-=i)<n),vt(l<n),s[u]|=t>>r<<l,c+=i}}function p(e,t){var n,r=e.internal_flags;if(vt(t>=0),t>=8&&(f(r,76,8),t-=8),t>=8&&(f(r,65,8),t-=8),t>=8&&(f(r,77,8),t-=8),t>=8&&(f(r,69,8),t-=8),t>=32){var i=a.getLameShortVersion();if(t>=32)for(n=0;n<i.length&&t>=8;++n)t-=8,f(r,i.charAt(n),8)}for(;t>=1;t-=1)f(r,r.ancillary_flag,1),r.ancillary_flag^=e.disable_reservoir?0:1;vt(0==t)}function m(e,t,r){for(var i=e.header[e.h_ptr].ptr;r>0;){var a=Math.min(r,8-(7&i));vt((r-=a)<n),e.header[e.h_ptr].buf[i>>3]|=t>>r<<8-(7&i)-a,i+=a}e.header[e.h_ptr].ptr=i}function g(e,n){e<<=8;for(var r=0;r<8;r++)0!=(65536&((n<<=1)^(e<<=1)))&&(n^=t);return n}function v(e,t){var n,r,i,a=e.internal_flags;if(n=a.l3_side,a.header[a.h_ptr].ptr=0,ht.fill(a.header[a.h_ptr].buf,0,a.sideinfo_len,0),e.out_samplerate<16e3?m(a,4094,12):m(a,4095,12),m(a,e.version,1),m(a,1,2),m(a,e.error_protection?0:1,1),m(a,a.bitrate_index,4),m(a,a.samplerate_index,2),m(a,a.padding,1),m(a,e.extension,1),m(a,e.mode.ordinal(),2),m(a,a.mode_ext,2),m(a,e.copyright,1),m(a,e.original,1),m(a,e.emphasis,2),e.error_protection&&m(a,0,16),1==e.version){for(vt(n.main_data_begin>=0),m(a,n.main_data_begin,9),2==a.channels_out?m(a,n.private_bits,3):m(a,n.private_bits,5),i=0;i<a.channels_out;i++){var o;for(o=0;o<4;o++)m(a,n.scfsi[i][o],1)}for(r=0;r<2;r++)for(i=0;i<a.channels_out;i++)m(a,(s=n.tt[r][i]).part2_3_length+s.part2_length,12),m(a,s.big_values/2,9),m(a,s.global_gain,8),m(a,s.scalefac_compress,4),s.block_type!=j.NORM_TYPE?(m(a,1,1),m(a,s.block_type,2),m(a,s.mixed_block_flag,1),14==s.table_select[0]&&(s.table_select[0]=16),m(a,s.table_select[0],5),14==s.table_select[1]&&(s.table_select[1]=16),m(a,s.table_select[1],5),m(a,s.subblock_gain[0],3),m(a,s.subblock_gain[1],3),m(a,s.subblock_gain[2],3)):(m(a,0,1),14==s.table_select[0]&&(s.table_select[0]=16),m(a,s.table_select[0],5),14==s.table_select[1]&&(s.table_select[1]=16),m(a,s.table_select[1],5),14==s.table_select[2]&&(s.table_select[2]=16),m(a,s.table_select[2],5),vt(0<=s.region0_count&&s.region0_count<16),vt(0<=s.region1_count&&s.region1_count<8),m(a,s.region0_count,4),m(a,s.region1_count,3)),m(a,s.preflag,1),m(a,s.scalefac_scale,1),m(a,s.count1table_select,1)}else for(vt(n.main_data_begin>=0),m(a,n.main_data_begin,8),m(a,n.private_bits,a.channels_out),r=0,i=0;i<a.channels_out;i++){var s;m(a,(s=n.tt[r][i]).part2_3_length+s.part2_length,12),m(a,s.big_values/2,9),m(a,s.global_gain,8),m(a,s.scalefac_compress,9),s.block_type!=j.NORM_TYPE?(m(a,1,1),m(a,s.block_type,2),m(a,s.mixed_block_flag,1),14==s.table_select[0]&&(s.table_select[0]=16),m(a,s.table_select[0],5),14==s.table_select[1]&&(s.table_select[1]=16),m(a,s.table_select[1],5),m(a,s.subblock_gain[0],3),m(a,s.subblock_gain[1],3),m(a,s.subblock_gain[2],3)):(m(a,0,1),14==s.table_select[0]&&(s.table_select[0]=16),m(a,s.table_select[0],5),14==s.table_select[1]&&(s.table_select[1]=16),m(a,s.table_select[1],5),14==s.table_select[2]&&(s.table_select[2]=16),m(a,s.table_select[2],5),vt(0<=s.region0_count&&s.region0_count<16),vt(0<=s.region1_count&&s.region1_count<8),m(a,s.region0_count,4),m(a,s.region1_count,3)),m(a,s.scalefac_scale,1),m(a,s.count1table_select,1)}e.error_protection&&CRC_writeheader(a,a.header[a.h_ptr].buf);var c=a.h_ptr;vt(a.header[c].ptr==8*a.sideinfo_len),a.h_ptr=c+1&Ae.MAX_HEADER_BUF-1,a.header[a.h_ptr].write_timing=a.header[c].write_timing+t,a.h_ptr==a.w_ptr&&ft.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}function y(e,t){var n,r=Je.ht[t.count1table_select+32],i=0,a=t.big_values,o=t.big_values;for(vt(t.count1table_select<2),n=(t.count1-t.big_values)/4;n>0;--n){var s,c=0,u=0;0!=(s=t.l3_enc[a+0])&&(u+=8,t.xr[o+0]<0&&c++,vt(s<=1)),0!=(s=t.l3_enc[a+1])&&(u+=4,c*=2,t.xr[o+1]<0&&c++,vt(s<=1)),0!=(s=t.l3_enc[a+2])&&(u+=2,c*=2,t.xr[o+2]<0&&c++,vt(s<=1)),0!=(s=t.l3_enc[a+3])&&(u++,c*=2,t.xr[o+3]<0&&c++,vt(s<=1)),a+=4,o+=4,f(e,c+r.table[u],r.hlen[u]),i+=r.hlen[u]}return i}function b(e,t,r,i,a){var o=Je.ht[t],s=0;if(vt(t<32),0==t)return s;for(var c=r;c<i;c+=2){var u=0,l=0,d=o.xlen,h=o.xlen,p=0,m=a.l3_enc[c],g=a.l3_enc[c+1];if(0!=m&&(a.xr[c]<0&&p++,u--),t>15){if(m>14){var v=m-15;vt(v<=o.linmax),p|=v<<1,l=d,m=15}if(g>14){var y=g-15;vt(y<=o.linmax),p<<=d,p|=y,l+=d,g=15}h=16}0!=g&&(p<<=1,a.xr[c+1]<0&&p++,u--),vt((m|g)<16),m=m*h+g,l-=u,u+=o.hlen[m],vt(u<=n),vt(l<=n),f(e,o.table[m],u),f(e,p,l),s+=u+l}return s}function _(e,t){var n=3*e.scalefac_band.s[3];n>t.big_values&&(n=t.big_values);var r=b(e,t.table_select[0],0,n,t);return r+=b(e,t.table_select[1],n,t.big_values,t)}function w(e,t){var n,r,i,a;n=t.big_values,vt(0<=n&&n<=576);var o=t.region0_count+1;return vt(0<=o),vt(o<e.scalefac_band.l.length),i=e.scalefac_band.l[o],o+=t.region1_count+1,vt(0<=o),vt(o<e.scalefac_band.l.length),i>n&&(i=n),(a=e.scalefac_band.l[o])>n&&(a=n),r=b(e,t.table_select[0],0,i,t),r+=b(e,t.table_select[1],i,a,t),r+=b(e,t.table_select[2],a,n,t)}function E(e){var t,n,r,i,a=0,o=e.internal_flags,s=o.l3_side;if(1==e.version)for(t=0;t<2;t++)for(n=0;n<o.channels_out;n++){var c=s.tt[t][n],u=dt.slen1_tab[c.scalefac_compress],l=dt.slen2_tab[c.scalefac_compress];for(i=0,r=0;r<c.sfbdivide;r++)-1!=c.scalefac[r]&&(f(o,c.scalefac[r],u),i+=u);for(;r<c.sfbmax;r++)-1!=c.scalefac[r]&&(f(o,c.scalefac[r],l),i+=l);vt(i==c.part2_length),c.block_type==j.SHORT_TYPE?i+=_(o,c):i+=w(o,c),i+=y(o,c),vt(i==c.part2_3_length+c.part2_length),a+=i}else for(t=0,n=0;n<o.channels_out;n++){c=s.tt[t][n];var d,h,p=0;if(vt(null!=c.sfb_partition_table),i=0,r=0,h=0,c.block_type==j.SHORT_TYPE){for(;h<4;h++){var m=c.sfb_partition_table[h]/3,g=c.slen[h];for(d=0;d<m;d++,r++)f(o,Math.max(c.scalefac[3*r+0],0),g),f(o,Math.max(c.scalefac[3*r+1],0),g),f(o,Math.max(c.scalefac[3*r+2],0),g),p+=3*g}i+=_(o,c)}else{for(;h<4;h++)for(m=c.sfb_partition_table[h],g=c.slen[h],d=0;d<m;d++,r++)f(o,Math.max(c.scalefac[r],0),g),p+=g;i+=w(o,c)}i+=y(o,c),vt(i==c.part2_3_length),vt(p==c.part2_length),a+=p+i}return a}function S(){this.total=0}function C(t,n){var r,i,a,o,s,l=t.internal_flags;return s=l.w_ptr,-1==(o=l.h_ptr-1)&&(o=Ae.MAX_HEADER_BUF-1),r=l.header[o].write_timing-c,n.total=r,r>=0&&(i=1+o-s,o<s&&(i=1+o-s+Ae.MAX_HEADER_BUF),r-=8*i*l.sideinfo_len),r+=a=e.getframebits(t),n.total+=a,n.total%8!=0?n.total=1+n.total/8:n.total=n.total/8,n.total+=u+1,r<0&&ft.err.println("strange error flushing buffer ... \n"),r}this.getframebits=function(e){var t,n=e.internal_flags;return t=0!=n.bitrate_index?Je.bitrate_table[e.version][n.bitrate_index]:e.brate,vt(8<=t&&t<=640),8*(0|72e3*(e.version+1)*t/e.out_samplerate+n.padding)},this.CRC_writeheader=function(e,t){var n=65535;n=g(255&t[2],n),n=g(255&t[3],n);for(var r=6;r<e.sideinfo_len;r++)n=g(255&t[r],n);t[4]=byte(n>>8),t[5]=byte(255&n)},this.flush_bitstream=function(e){var t,n,i=e.internal_flags,a=i.h_ptr-1;if(-1==a&&(a=Ae.MAX_HEADER_BUF-1),t=i.l3_side,!((n=C(e,new S))<0)){if(p(e,n),vt(i.header[a].write_timing+this.getframebits(e)==c),i.ResvSize=0,t.main_data_begin=0,i.findReplayGain){var o=r.GetTitleGain(i.rgdata);vt(NEQ(o,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),i.RadioGain=0|Math.floor(10*o+.5)}i.findPeakSample&&(i.noclipGainChange=0|Math.ceil(20*Math.log10(i.PeakSample/32767)*10),i.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?i.noclipScale=Math.floor(32767/i.PeakSample*100)/100:i.noclipScale=-1)}},this.add_dummy_byte=function(e,t,n){for(var r,i=e.internal_flags;n-- >0;)for(h(i,t,8),r=0;r<Ae.MAX_HEADER_BUF;++r)i.header[r].write_timing+=8},this.format_bitstream=function(e){var t,n=e.internal_flags;t=n.l3_side;var r=this.getframebits(e);p(e,t.resvDrain_pre),v(e,r);var i=8*n.sideinfo_len;if(i+=E(e),p(e,t.resvDrain_post),i+=t.resvDrain_post,t.main_data_begin+=(r-i)/8,C(e,new S)!=n.ResvSize&&ft.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*t.main_data_begin!=n.ResvSize&&(ft.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*t.main_data_begin,n.ResvSize,t.resvDrain_post,t.resvDrain_pre,8*n.sideinfo_len,i-t.resvDrain_post-8*n.sideinfo_len,i,i%8,r),ft.err.println("This is a fatal error.  It has several possible causes:"),ft.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),ft.err.println(" 9%%  Your system is overclocked"),ft.err.println(" 1%%  bug in LAME encoding library"),n.ResvSize=8*t.main_data_begin),vt(c%8==0),c>1e9){var a;for(a=0;a<Ae.MAX_HEADER_BUF;++a)n.header[a].write_timing-=c;c=0}return 0},this.copy_buffer=function(e,t,n,a,c){var d=u+1;if(d<=0)return 0;if(0!=a&&d>a)return-1;if(ft.arraycopy(s,0,t,n,d),u=-1,l=0,0!=c){var f=gt(1);if(f[0]=e.nMusicCRC,o.updateMusicCRC(f,t,n,d),e.nMusicCRC=f[0],d>0&&(e.VBR_seek_table.nBytesWritten+=d),e.decode_on_the_fly)for(var h,p=mt([2,1152]),m=d,g=-1;0!=g;)if(g=i.hip_decode1_unclipped(e.hip,t,n,m,p[0],p[1]),m=0,-1==g&&(g=0),g>0){if(vt(g<=1152),e.findPeakSample){for(h=0;h<g;h++)p[0][h]>e.PeakSample?e.PeakSample=p[0][h]:-p[0][h]>e.PeakSample&&(e.PeakSample=-p[0][h]);if(e.channels_out>1)for(h=0;h<g;h++)p[1][h]>e.PeakSample?e.PeakSample=p[1][h]:-p[1][h]>e.PeakSample&&(e.PeakSample=-p[1][h])}if(e.findReplayGain&&r.AnalyzeSamples(e.rgdata,p[0],0,p[1],0,g,e.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return d},this.init_bit_stream_w=function(e){s=pt(Lame.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,u=-1,l=0,c=0}}yt.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},yt.NEQ=function(e,t){return!yt.EQ(e,t)};var bt=yt,_t=m.System,wt=m.VbrMode,Et=m.ShortBlock,St=m.new_float,Ct=m.new_int_n,xt=m.new_short_n,Tt=m.assert;function Rt(){var e=this,t=131072;Rt.V9=410,Rt.V8=420,Rt.V7=430,Rt.V6=440,Rt.V5=450,Rt.V4=460,Rt.V3=470,Rt.V2=480,Rt.V1=490,Rt.V0=500,Rt.R3MIX=1e3,Rt.STANDARD=1001,Rt.EXTREME=1002,Rt.INSANE=1003,Rt.STANDARD_FAST=1004,Rt.EXTREME_FAST=1005,Rt.MEDIUM=1006,Rt.MEDIUM_FAST=1007;var n,r,i,a,o,s=16384+t;Rt.LAME_MAXMP3BUFFER=s;var c,u,l,d=new Z;function f(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=St(j.SBMAX_l),this.bo_s_weight=St(j.SBMAX_s)}function h(){this.lowerlimit=0}function p(e,t){this.lowpass=t}this.enc=new j,this.setModules=function(e,t,s,f,h,p,m,g,v){n=e,r=t,i=s,a=f,o=h,c=p,u=g,l=v,this.enc.setModules(r,d,a,c)};var m=4294479419;function g(e){var t;return e.class_id=m,t=e.internal_flags=new Ae,e.mode=MPEGMode.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=wt.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=j.ENCDELAY+j.POSTDELAY,e.encoder_padding=0,t.mf_size=j.ENCDELAY-j.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0}function v(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function y(e,t){var n=44100;return t>=48e3?n=48e3:t>=44100?n=44100:t>=32e3?n=32e3:t>=24e3?n=24e3:t>=22050?n=22050:t>=16e3?n=16e3:t>=12e3?n=12e3:t>=11025?n=11025:t>=8e3&&(n=8e3),-1==e?n:(e<=15960&&(n=44100),e<=15250&&(n=32e3),e<=11220&&(n=24e3),e<=9970&&(n=22050),e<=7230&&(n=16e3),e<=5420&&(n=12e3),e<=4510&&(n=11025),e<=3970&&(n=8e3),t<n?t>44100?48e3:t>32e3?44100:t>24e3?32e3:t>22050?24e3:t>16e3?22050:t>12e3?16e3:t>11025?12e3:t>8e3?11025:8e3:n)}function b(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:case 11025:return t.version=0,0;case 24e3:case 12e3:return t.version=0,1;case 16e3:case 8e3:return t.version=0,2;default:return t.version=0,-1}}function _(e,t,n){n<16e3&&(t=2);for(var r=Je.bitrate_table[t][1],i=2;i<=14;i++)Je.bitrate_table[t][i]>0&&Math.abs(Je.bitrate_table[t][i]-e)<Math.abs(r-e)&&(r=Je.bitrate_table[t][i]);return r}function w(e,t,n){n<16e3&&(t=2);for(var r=0;r<=14;r++)if(Je.bitrate_table[t][r]>0&&Je.bitrate_table[t][r]==e)return r;return-1}function E(t,n){var r=[new p(8,2e3),new p(16,3700),new p(24,3900),new p(32,5500),new p(40,7e3),new p(48,7500),new p(56,1e4),new p(64,11e3),new p(80,13500),new p(96,15100),new p(112,15600),new p(128,17e3),new p(160,17500),new p(192,18600),new p(224,19400),new p(256,19700),new p(320,20500)],i=e.nearestBitrateFullIndex(n);t.lowerlimit=r[i].lowpass}function S(e){var t=e.internal_flags,n=32,r=-1;if(t.lowpass1>0){for(var i=999,a=0;a<=31;a++)(u=a/31)>=t.lowpass2&&(n=Math.min(n,a)),t.lowpass1<u&&u<t.lowpass2&&(i=Math.min(i,a));t.lowpass1=999==i?(n-.75)/31:(i-.75)/31,t.lowpass2=n/31}if(t.highpass2>0&&t.highpass2<.75/31*.9&&(t.highpass1=0,t.highpass2=0,_t.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),t.highpass2>0){var o=-1;for(a=0;a<=31;a++)(u=a/31)<=t.highpass1&&(r=Math.max(r,a)),t.highpass1<u&&u<t.highpass2&&(o=Math.max(o,a));t.highpass1=r/31,t.highpass2=-1==o?(r+.75)/31:(o+.75)/31}for(a=0;a<32;a++){var s,c,u=a/31;s=t.highpass2>t.highpass1?v((t.highpass2-u)/(t.highpass2-t.highpass1+1e-20)):1,c=t.lowpass2>t.lowpass1?v((u-t.lowpass1)/(t.lowpass2-t.lowpass1+1e-20)):1,t.amp_filter[a]=s*c}}function C(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}function x(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&u.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=Ct([16,5]),t.bitrate_blockType_Hist=Ct([16,6]),t.PeakSample=0,e.bWriteVbrTag&&c.InitVbrTag(e)}function T(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=St(t),e.in_buffer_1=St(t),e.in_buffer_nsamples=t)}function R(e){var t=j.BLKSIZE+e.framesize-j.FFTOFFSET;return t=Math.max(t,512+e.framesize-32),Tt(Ae.MFSIZE>=t),t}function I(e,t,i,a,o,s,c){var u,l,d,f,h,p=e.internal_flags,g=0,v=[null,null],y=[null,null];if(p.Class_ID!=m)return-3;if(0==a)return 0;if((h=r.copy_buffer(p,o,s,c,0))<0)return h;if(s+=h,g+=h,y[0]=t,y[1]=i,bt.NEQ(e.scale,0)&&bt.NEQ(e.scale,1))for(l=0;l<a;++l)y[0][l]*=e.scale,2==p.channels_out&&(y[1][l]*=e.scale);if(bt.NEQ(e.scale_left,0)&&bt.NEQ(e.scale_left,1))for(l=0;l<a;++l)y[0][l]*=e.scale_left;if(bt.NEQ(e.scale_right,0)&&bt.NEQ(e.scale_right,1))for(l=0;l<a;++l)y[1][l]*=e.scale_right;if(2==e.num_channels&&1==p.channels_out)for(l=0;l<a;++l)y[0][l]=.5*(y[0][l]+y[1][l]),y[1][l]=0;f=R(e),v[0]=p.mfbuf[0],v[1]=p.mfbuf[1];for(var b=0;a>0;){var _=[null,null],w=0,E=0;_[0]=y[0],_[1]=y[1];var S=new A;if(O(e,v,_,b,a,S),w=S.n_in,E=S.n_out,p.findReplayGain&&!p.decode_on_the_fly&&n.AnalyzeSamples(p.rgdata,v[0],p.mf_size,v[1],p.mf_size,E,p.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(a-=w,b+=w,p.channels_out,p.mf_size+=E,Tt(p.mf_size<=Ae.MFSIZE),p.mf_samples_to_encode<1&&(p.mf_samples_to_encode=j.ENCDELAY+j.POSTDELAY),p.mf_samples_to_encode+=E,p.mf_size>=f){var C=c-g;if(0==c&&(C=0),(u=N(e,v[0],v[1],o,s,C))<0)return u;for(s+=u,g+=u,p.mf_size-=e.framesize,p.mf_samples_to_encode-=e.framesize,d=0;d<p.channels_out;d++)for(l=0;l<p.mf_size;l++)v[d][l]=v[d][l+e.framesize]}}return Tt(0==a),g}function N(t,n,r,i,a,o){var s=e.enc.lame_encode_mp3_frame(t,n,r,i,a,o);return t.frameNum++,s}function A(){this.n_in=0,this.n_out=0}function k(){this.num_used=0}function D(e,t){return 0!=t?D(t,e%t):e}function M(e,t,n){var r=Math.PI*t;(e/=n)<0&&(e=0),e>1&&(e=1);var i=e-.5,a=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(i)<1e-9?r/Math.PI:a*Math.sin(n*r*i)/(Math.PI*n*i)}function L(e,t,n,r,i,a,o,s,c){var u,l,d=e.internal_flags,f=0,h=e.out_samplerate/D(e.out_samplerate,e.in_samplerate);h>Ae.BPC&&(h=Ae.BPC);var p=Math.abs(d.resample_ratio-Math.floor(.5+d.resample_ratio))<1e-4?1:0,m=1/d.resample_ratio;m>1&&(m=1);var g=31;0==g%2&&--g;var v=(g+=p)+1;if(0==d.fill_buffer_resample_init){for(d.inbuf_old[0]=St(v),d.inbuf_old[1]=St(v),u=0;u<=2*h;++u)d.blackfilt[u]=St(v);for(d.itime[0]=0,d.itime[1]=0,f=0;f<=2*h;f++){var y=0,b=(f-h)/(2*h);for(u=0;u<=g;u++)y+=d.blackfilt[f][u]=M(u-b,m,g);for(u=0;u<=g;u++)d.blackfilt[f][u]/=y}d.fill_buffer_resample_init=1}var _=d.inbuf_old[c];for(l=0;l<r;l++){var w,E;if(w=l*d.resample_ratio,g+(f=0|Math.floor(w-d.itime[c]))-g/2>=o)break;b=w-d.itime[c]-(f+g%2*.5),Tt(Math.abs(b)<=.501),E=0|Math.floor(2*b*h+h+.5);var S=0;for(u=0;u<=g;++u){var C=u+f-g/2;Tt(C<o),Tt(C+v>=0),S+=(C<0?_[v+C]:i[a+C])*d.blackfilt[E][u]}t[n+l]=S}if(s.num_used=Math.min(o,g+f-g/2),d.itime[c]+=s.num_used-l*d.resample_ratio,s.num_used>=v)for(u=0;u<v;u++)_[u]=i[a+s.num_used+u-v];else{var x=v-s.num_used;for(u=0;u<x;++u)_[u]=_[u+s.num_used];for(f=0;u<v;++u,++f)_[u]=i[a+f];Tt(f==s.num_used)}return l}function O(e,t,n,r,i,a){var o=e.internal_flags;if(o.resample_ratio<.9999||o.resample_ratio>1.0001)for(var s=0;s<o.channels_out;s++){var c=new k;a.n_out=L(e,t[s],o.mf_size,e.framesize,n[s],r,i,c,s),a.n_in=c.num_used}else{a.n_out=Math.min(e.framesize,i),a.n_in=a.n_out;for(var u=0;u<a.n_out;++u)t[0][o.mf_size+u]=n[0][r+u],2==o.channels_out&&(t[1][o.mf_size+u]=n[1][r+u])}}this.lame_init=function(){var e=new ne;return 0!=g(e)?null:(e.lame_allocated_gfp=1,e)},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],n=0,r=0,i=0,a=0;a=t[16],i=16,r=t[16],n=16;for(var o=0;o<16;o++)if(Math.max(e,t[o+1])!=e){a=t[o+1],i=o+1,r=t[o],n=o;break}return a-e>e-r?n:i},this.lame_init_params=function(e){var t=e.internal_flags;if(t.Class_ID=0,null==t.ATH&&(t.ATH=new Me),null==t.PSY&&(t.PSY=new f),null==t.rgdata&&(t.rgdata=new Ve),t.channels_in=e.num_channels,1==t.channels_in&&(e.mode=MPEGMode.MONO),t.channels_out=e.mode==MPEGMode.MONO?1:2,t.mode_ext=j.MPG_MD_MS_LR,e.mode==MPEGMode.MONO&&(e.force_ms=!1),e.VBR==wt.vbr_off&&128!=e.VBR_mean_bitrate_kbps&&0==e.brate&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==wt.vbr_off||e.VBR==wt.vbr_mtrh||e.VBR==wt.vbr_mt||(e.free_format=!1),e.VBR==wt.vbr_off&&0==e.brate&&bt.EQ(e.compression_ratio,0)&&(e.compression_ratio=11.025),e.VBR==wt.vbr_off&&e.compression_ratio>0&&(0==e.out_samplerate&&(e.out_samplerate=map2MP3Frequency(int(.97*e.in_samplerate))),e.brate=0|16*e.out_samplerate*t.channels_out/(1e3*e.compression_ratio),t.samplerate_index=b(e.out_samplerate,e),e.free_format||(e.brate=_(e.brate,e.version,e.out_samplerate))),0!=e.out_samplerate&&(e.out_samplerate<16e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),0==e.lowpassfreq){var s=16e3;switch(e.VBR){case wt.vbr_off:E(c=new h,e.brate),s=c.lowerlimit;break;case wt.vbr_abr:var c;E(c=new h,e.VBR_mean_bitrate_kbps),s=c.lowerlimit;break;case wt.vbr_rh:var u=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var p=u[e.VBR_q],g=u[e.VBR_q+1],v=e.VBR_q_frac;s=linear_int(p,g,v)}else s=19500;break;default:u=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950],0<=e.VBR_q&&e.VBR_q<=9?(p=u[e.VBR_q],g=u[e.VBR_q+1],v=e.VBR_q_frac,s=linear_int(p,g,v)):s=19500}e.mode!=MPEGMode.MONO||e.VBR!=wt.vbr_off&&e.VBR!=wt.vbr_abr||(s*=1.5),e.lowpassfreq=0|s}if(0==e.out_samplerate&&(2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=e.in_samplerate/2),e.out_samplerate=y(0|e.lowpassfreq,e.in_samplerate)),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==wt.vbr_off&&(e.compression_ratio=16*e.out_samplerate*t.channels_out/(1e3*e.brate)),e.VBR==wt.vbr_abr&&(e.compression_ratio=16*e.out_samplerate*t.channels_out/(1e3*e.VBR_mean_bitrate_kbps)),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,t.findPeakSample=!1),t.findReplayGain=e.findReplayGain,t.decode_on_the_fly=e.decode_on_the_fly,t.decode_on_the_fly&&(t.findPeakSample=!0),t.findReplayGain&&n.InitGainAnalysis(t.rgdata,e.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return e.internal_flags=null,-6;switch(t.decode_on_the_fly&&!e.decode_only&&(null!=t.hip&&l.hip_decode_exit(t.hip),t.hip=l.hip_decode_init()),t.mode_gr=e.out_samplerate<=24e3?1:2,e.framesize=576*t.mode_gr,e.encoder_delay=j.ENCDELAY,t.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case wt.vbr_mt:case wt.vbr_rh:case wt.vbr_mtrh:var T=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];e.compression_ratio=T[e.VBR_q];break;case wt.vbr_abr:e.compression_ratio=16*e.out_samplerate*t.channels_out/(1e3*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=16*e.out_samplerate*t.channels_out/(1e3*e.brate)}if(e.mode==MPEGMode.NOT_SET&&(e.mode=MPEGMode.JOINT_STEREO),e.highpassfreq>0?(t.highpass1=2*e.highpassfreq,e.highpasswidth>=0?t.highpass2=2*(e.highpassfreq+e.highpasswidth):t.highpass2=2*e.highpassfreq,t.highpass1/=e.out_samplerate,t.highpass2/=e.out_samplerate):(t.highpass1=0,t.highpass2=0),e.lowpassfreq>0?(t.lowpass2=2*e.lowpassfreq,e.lowpasswidth>=0?(t.lowpass1=2*(e.lowpassfreq-e.lowpasswidth),t.lowpass1<0&&(t.lowpass1=0)):t.lowpass1=2*e.lowpassfreq,t.lowpass1/=e.out_samplerate,t.lowpass2/=e.out_samplerate):(t.lowpass1=0,t.lowpass2=0),S(e),t.samplerate_index=b(e.out_samplerate,e),t.samplerate_index<0)return e.internal_flags=null,-1;if(e.VBR==wt.vbr_off){if(e.free_format)t.bitrate_index=0;else if(e.brate=_(e.brate,e.version,e.out_samplerate),t.bitrate_index=w(e.brate,e.version,e.out_samplerate),t.bitrate_index<=0)return e.internal_flags=null,-1}else t.bitrate_index=1;e.analysis&&(e.bWriteVbrTag=!1),null!=t.pinfo&&(e.bWriteVbrTag=!1),r.init_bit_stream_w(t);for(var R,I=t.samplerate_index+3*e.version+6*(e.out_samplerate<16e3?1:0),N=0;N<j.SBMAX_l+1;N++)t.scalefac_band.l[N]=a.sfBandIndex[I].l[N];for(N=0;N<j.PSFB21+1;N++){var A=(t.scalefac_band.l[22]-t.scalefac_band.l[21])/j.PSFB21,k=t.scalefac_band.l[21]+N*A;t.scalefac_band.psfb21[N]=k}for(t.scalefac_band.psfb21[j.PSFB21]=576,N=0;N<j.SBMAX_s+1;N++)t.scalefac_band.s[N]=a.sfBandIndex[I].s[N];for(N=0;N<j.PSFB12+1;N++)A=(t.scalefac_band.s[13]-t.scalefac_band.s[12])/j.PSFB12,k=t.scalefac_band.s[12]+N*A,t.scalefac_band.psfb12[N]=k;for(t.scalefac_band.psfb12[j.PSFB12]=192,1==e.version?t.sideinfo_len=1==t.channels_out?21:36:t.sideinfo_len=1==t.channels_out?13:21,e.error_protection&&(t.sideinfo_len+=2),x(e),t.Class_ID=m,R=0;R<19;R++)t.nsPsy.pefirbuf[R]=700*t.mode_gr*t.channels_out;switch(-1==e.ATHtype&&(e.ATHtype=4),Tt(e.VBR_q<=9),Tt(e.VBR_q>=0),e.VBR){case wt.vbr_mt:e.VBR=wt.vbr_mtrh;case wt.vbr_mtrh:null==e.useTemporal&&(e.useTemporal=!1),i.apply_preset(e,500-10*e.VBR_q,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),e.quality>5&&(e.quality=5),t.PSY.mask_adjust=e.maskingadjust,t.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?t.sfb21_extra=!1:t.sfb21_extra=e.out_samplerate>44e3,t.iteration_loop=new VBRNewIterationLoop(o);break;case wt.vbr_rh:i.apply_preset(e,500-10*e.VBR_q,0),t.PSY.mask_adjust=e.maskingadjust,t.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?t.sfb21_extra=!1:t.sfb21_extra=e.out_samplerate>44e3,e.quality>6&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),t.iteration_loop=new VBROldIterationLoop(o);break;default:var D;t.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),(D=e.VBR)==wt.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),i.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=D,t.PSY.mask_adjust=e.maskingadjust,t.PSY.mask_adjust_short=e.maskingadjust_short,D==wt.vbr_off?t.iteration_loop=new Ke(o):t.iteration_loop=new ABRIterationLoop(o)}if(Tt(e.scale>=0),e.VBR!=wt.vbr_off){if(t.VBR_min_bitrate=1,t.VBR_max_bitrate=14,e.out_samplerate<16e3&&(t.VBR_max_bitrate=8),0!=e.VBR_min_bitrate_kbps&&(e.VBR_min_bitrate_kbps=_(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),t.VBR_min_bitrate=w(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),t.VBR_min_bitrate<0))return-1;if(0!=e.VBR_max_bitrate_kbps&&(e.VBR_max_bitrate_kbps=_(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),t.VBR_max_bitrate=w(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),t.VBR_max_bitrate<0))return-1;e.VBR_min_bitrate_kbps=Je.bitrate_table[e.version][t.VBR_min_bitrate],e.VBR_max_bitrate_kbps=Je.bitrate_table[e.version][t.VBR_max_bitrate],e.VBR_mean_bitrate_kbps=Math.min(Je.bitrate_table[e.version][t.VBR_max_bitrate],e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(Je.bitrate_table[e.version][t.VBR_min_bitrate],e.VBR_mean_bitrate_kbps)}return e.tune&&(t.PSY.mask_adjust+=e.tune_value_a,t.PSY.mask_adjust_short+=e.tune_value_a),C(e),Tt(e.scale>=0),e.athaa_type<0?t.ATH.useAdjust=3:t.ATH.useAdjust=e.athaa_type,t.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),null==e.short_blocks&&(e.short_blocks=Et.short_block_allowed),e.short_blocks!=Et.short_block_allowed||e.mode!=MPEGMode.JOINT_STEREO&&e.mode!=MPEGMode.STEREO||(e.short_blocks=Et.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=1|e.exp_nspsytune,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=Z.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=Z.NSATTACKTHRE_S),Tt(e.scale>=0),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),null==e.useTemporal&&(e.useTemporal=!0),t.slot_lag=t.frac_SpF=0,e.VBR==wt.vbr_off&&(t.slot_lag=t.frac_SpF=72e3*(e.version+1)*e.brate%e.out_samplerate|0),a.iteration_init(e),d.psymodel_init(e),Tt(e.scale>=0),0},this.lame_encode_flush=function(e,t,n,i){var a,o,s,c,l=e.internal_flags,d=xt([2,1152]),f=0,h=l.mf_samples_to_encode-j.POSTDELAY,p=R(e);if(l.mf_samples_to_encode<1)return 0;for(a=0,e.in_samplerate!=e.out_samplerate&&(h+=16*e.out_samplerate/e.in_samplerate),(s=e.framesize-h%e.framesize)<576&&(s+=e.framesize),e.encoder_padding=s,c=(h+s)/e.framesize;c>0&&f>=0;){var m=p-l.mf_size,g=e.frameNum;m*=e.in_samplerate,(m/=e.out_samplerate)>1152&&(m=1152),m<1&&(m=1),o=i-a,0==i&&(o=0),n+=f=this.lame_encode_buffer(e,d[0],d[1],m,t,n,o),a+=f,c-=g!=e.frameNum?1:0}if(l.mf_samples_to_encode=0,f<0)return f;if(o=i-a,0==i&&(o=0),r.flush_bitstream(e),(f=r.copy_buffer(l,t,n,o,1))<0)return f;if(n+=f,o=i-(a+=f),0==i&&(o=0),e.write_id3tag_automatic){if(u.id3tag_write_v1(e),(f=r.copy_buffer(l,t,n,o,0))<0)return f;a+=f}return a},this.lame_encode_buffer=function(e,t,n,r,i,a,o){var s=e.internal_flags,c=[null,null];if(s.Class_ID!=m)return-3;if(0==r)return 0;T(s,r),c[0]=s.in_buffer_0,c[1]=s.in_buffer_1;for(var u=0;u<r;u++)c[0][u]=t[u],s.channels_in>1&&(c[1][u]=n[u]);return I(e,c[0],c[1],r,i,a,o)}}var It=Rt,Nt=m.VbrMode;function At(){function e(e,t,n,r,i,a,o,s,c,u,l,d,f,h,p){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=n,this.expY=r,this.st_lrm=i,this.st_s=a,this.masking_adj=o,this.masking_adj_short=s,this.ath_lower=c,this.ath_curve=u,this.ath_sensitivity=l,this.interch=d,this.safejoint=f,this.sfb21mod=h,this.msfix=p}function t(e,t,n,r,i,a,o,s,c,u,l,d,f,h){this.quant_comp=t,this.quant_comp_s=n,this.safejoint=r,this.nsmsfix=i,this.st_lrm=a,this.st_s=o,this.nsbass=s,this.scale=c,this.masking_adj=u,this.ath_lower=l,this.ath_curve=d,this.interch=f,this.sfscale=h}var n;this.setModules=function(e){n=e};var r=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],i=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function a(e,t,n){var a=e.VBR==Nt.vbr_rh?r:i,o=e.VBR_q_frac,s=a[t],u=a[t+1],l=s;s.st_lrm=s.st_lrm+o*(u.st_lrm-s.st_lrm),s.st_s=s.st_s+o*(u.st_s-s.st_s),s.masking_adj=s.masking_adj+o*(u.masking_adj-s.masking_adj),s.masking_adj_short=s.masking_adj_short+o*(u.masking_adj_short-s.masking_adj_short),s.ath_lower=s.ath_lower+o*(u.ath_lower-s.ath_lower),s.ath_curve=s.ath_curve+o*(u.ath_curve-s.ath_curve),s.ath_sensitivity=s.ath_sensitivity+o*(u.ath_sensitivity-s.ath_sensitivity),s.interch=s.interch+o*(u.interch-s.interch),s.msfix=s.msfix+o*(u.msfix-s.msfix),c(e,l.vbr_q),0!=n?e.quant_comp=l.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=l.quant_comp),0!=n?e.quant_comp_short=l.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=l.quant_comp_s),0!=l.expY&&(e.experimentalY=0!=l.expY),0!=n?e.internal_flags.nsPsy.attackthre=l.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=l.st_lrm),0!=n?e.internal_flags.nsPsy.attackthre_s=l.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=l.st_s),0!=n?e.maskingadjust=l.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=l.masking_adj),0!=n?e.maskingadjust_short=l.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=l.masking_adj_short),0!=n?e.ATHlower=-l.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-l.ath_lower/10),0!=n?e.ATHcurve=l.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=l.ath_curve),0!=n?e.athaa_sensitivity=l.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=l.ath_sensitivity),l.interch>0&&(0!=n?e.interChRatio=l.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=l.interch)),l.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|l.safejoint),l.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|l.sfb21mod<<20),0!=n?e.msfix=l.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=l.msfix),0==n&&(e.VBR_q=t,e.VBR_q_frac=o)}var o=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function s(e,t,r){var i=t,a=n.nearestBitrateFullIndex(t);if(e.VBR=Nt.vbr_abr,e.VBR_mean_bitrate_kbps=i,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),o[a].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),o[a].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(o[a].nsbass)>0){var s=int(4*o[a].nsbass);s<0&&(s+=64),e.exp_nspsytune=e.exp_nspsytune|s<<2}return 0!=r?e.quant_comp=o[a].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=o[a].quant_comp),0!=r?e.quant_comp_short=o[a].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=o[a].quant_comp_s),0!=r?e.msfix=o[a].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=o[a].nsmsfix),0!=r?e.internal_flags.nsPsy.attackthre=o[a].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=o[a].st_lrm),0!=r?e.internal_flags.nsPsy.attackthre_s=o[a].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=o[a].st_s),0!=r?e.scale=o[a].scale:Math.abs(e.scale- -1)>0||(e.scale=o[a].scale),0!=r?e.maskingadjust=o[a].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=o[a].masking_adj),o[a].masking_adj>0?0!=r?e.maskingadjust_short=.9*o[a].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*o[a].masking_adj):0!=r?e.maskingadjust_short=1.1*o[a].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*o[a].masking_adj),0!=r?e.ATHlower=-o[a].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-o[a].ath_lower/10),0!=r?e.ATHcurve=o[a].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=o[a].ath_curve),0!=r?e.interChRatio=o[a].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=o[a].interch),t}function c(e,t){var n=0;return 0>t&&(n=-1,t=0),9<t&&(n=-1,t=9),e.VBR_q=t,e.VBR_q_frac=0,n}this.apply_preset=function(e,t,n){switch(t){case Lame.R3MIX:t=Lame.V3,e.VBR=Nt.vbr_mtrh;break;case Lame.MEDIUM:t=Lame.V4,e.VBR=Nt.vbr_rh;break;case Lame.MEDIUM_FAST:t=Lame.V4,e.VBR=Nt.vbr_mtrh;break;case Lame.STANDARD:t=Lame.V2,e.VBR=Nt.vbr_rh;break;case Lame.STANDARD_FAST:t=Lame.V2,e.VBR=Nt.vbr_mtrh;break;case Lame.EXTREME:t=Lame.V0,e.VBR=Nt.vbr_rh;break;case Lame.EXTREME_FAST:t=Lame.V0,e.VBR=Nt.vbr_mtrh;break;case Lame.INSANE:return t=320,e.preset=t,s(e,t,n),e.VBR=Nt.vbr_off,t}switch(e.preset=t,t){case Lame.V9:return a(e,9,n),t;case Lame.V8:return a(e,8,n),t;case Lame.V7:return a(e,7,n),t;case Lame.V6:return a(e,6,n),t;case Lame.V5:return a(e,5,n),t;case Lame.V4:return a(e,4,n),t;case Lame.V3:return a(e,3,n),t;case Lame.V2:return a(e,2,n),t;case Lame.V1:return a(e,1,n),t;case Lame.V0:return a(e,0,n),t}return 8<=t&&t<=320?s(e,t,n):(e.preset=0,t)}}var kt=At;function Dt(){this.setModules=function(e,t){}}var Mt=Dt;function Lt(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var Ot=Lt,Pt=m.new_float,jt=m.new_int;function Ft(){this.global_gain=0,this.sfb_count1=0,this.step=jt(39),this.noise=Pt(39),this.noise_log=Pt(39)}var Ut=Ft,Bt=m.System,Vt=m.VbrMode,zt=m.Util,Wt=m.Arrays,Gt=m.new_float,Ht=m.assert;function Yt(){var e,t,n;this.rv=null,this.qupvt=null;var r,i=new Mt;function a(e,t,n,r){r=0;for(var i=0;i<=n;++i){var a=Math.abs(e.xr[i]);r+=a,t[i]=Math.sqrt(a*Math.sqrt(a)),t[i]>e.xrpow_max&&(e.xrpow_max=t[i])}return r}function o(e,t){var r=e.ATH,i=t.xr;if(t.block_type!=j.SHORT_TYPE)for(var a=!1,o=j.PSFB21-1;o>=0&&!a;o--){var s=e.scalefac_band.psfb21[o],c=e.scalefac_band.psfb21[o+1],u=n.athAdjust(r.adjust,r.psfb21[o],r.floor);e.nsPsy.longfact[21]>1e-12&&(u*=e.nsPsy.longfact[21]);for(var l=c-1;l>=s;l--){if(!(Math.abs(i[l])<u)){a=!0;break}i[l]=0}}else for(var d=0;d<3;d++)for(a=!1,o=j.PSFB12-1;o>=0&&!a;o--){c=(s=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*d+(e.scalefac_band.psfb12[o]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[o+1]-e.scalefac_band.psfb12[o]);var f=n.athAdjust(r.adjust,r.psfb12[o],r.floor);for(e.nsPsy.shortfact[12]>1e-12&&(f*=e.nsPsy.shortfact[12]),l=c-1;l>=s;l--){if(!(Math.abs(i[l])<f)){a=!0;break}i[l]=0}}}function s(e){this.ordinal=e}function c(e,t,n,i,a){var o,c=e.CurrentStep[i],u=!1,l=e.OldValue[i],d=s.BINSEARCH_NONE;for(t.global_gain=l,n-=t.part2_length,Ht(0!=c);;){var f;if(o=r.count_bits(e,a,t,null),1==c||o==n)break;o>n?(d==s.BINSEARCH_DOWN&&(u=!0),u&&(c/=2),d=s.BINSEARCH_UP,f=c):(d==s.BINSEARCH_UP&&(u=!0),u&&(c/=2),d=s.BINSEARCH_DOWN,f=-c),t.global_gain+=f,t.global_gain<0&&(t.global_gain=0,u=!0),t.global_gain>255&&(t.global_gain=255,u=!0)}for(Ht(t.global_gain>=0),Ht(t.global_gain<256);o>n&&t.global_gain<255;)t.global_gain++,o=r.count_bits(e,a,t,null);return e.CurrentStep[i]=l-t.global_gain>=4?4:2,e.OldValue[i]=t.global_gain,t.part2_3_length=o,o}function u(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function l(e){return zt.FAST_LOG10(.368+.632*e*e*e)}function d(e,t){for(var n=1e-37,r=0;r<t.psymax;r++)n+=l(e[r]);return Math.max(1e-20,n)}function f(e,t,n,r,i){var a;switch(e){default:case 9:t.over_count>0?(a=n.over_SSD<=t.over_SSD,n.over_SSD==t.over_SSD&&(a=n.bits<t.bits)):a=n.max_noise<0&&10*n.max_noise+n.bits<=10*t.max_noise+t.bits;break;case 0:a=n.over_count<t.over_count||n.over_count==t.over_count&&n.over_noise<t.over_noise||n.over_count==t.over_count&&BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 8:n.max_noise=d(i,r);case 1:a=n.max_noise<t.max_noise;break;case 2:a=n.tot_noise<t.tot_noise;break;case 3:a=n.tot_noise<t.tot_noise&&n.max_noise<t.max_noise;break;case 4:a=n.max_noise<=0&&t.max_noise>.2||n.max_noise<=0&&t.max_noise<0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise||n.max_noise<=0&&t.max_noise>0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.05&&t.max_noise>n.max_noise-.1&&n.tot_noise+n.over_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.1&&t.max_noise>n.max_noise-.15&&n.tot_noise+n.over_noise+n.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:a=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 6:a=n.over_noise<t.over_noise||BitStream.EQ(n.over_noise,t.over_noise)&&(n.max_noise<t.max_noise||BitStream.EQ(n.max_noise,t.max_noise)&&n.tot_noise<=t.tot_noise);break;case 7:a=n.over_count<t.over_count||n.over_noise<t.over_noise}return 0==t.over_count&&(a=a&&n.bits<t.bits),a}function h(e,t,n,r,i){var a,o=e.internal_flags;a=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var s=0,c=0;c<t.sfbmax;c++)s<n[c]&&(s=n[c]);var u=o.noise_shaping_amp;switch(3==u&&(u=i?2:1),u){case 2:break;case 1:s>1?s=Math.pow(s,.5):s*=.95;break;default:s>1?s=1:s*=.95}var l=0;for(c=0;c<t.sfbmax;c++){var d,f=t.width[c];if(l+=f,!(n[c]<s)){if(0!=(2&o.substep_shaping)&&(o.pseudohalf[c]=0==o.pseudohalf[c]?1:0,0==o.pseudohalf[c]&&2==o.noise_shaping_amp))return;for(t.scalefac[c]++,d=-f;d<0;d++)r[l+d]*=a,r[l+d]>t.xrpow_max&&(t.xrpow_max=r[l+d]);if(2==o.noise_shaping_amp)return}}}function p(e,t){for(var r=1.2968395546510096,i=0,a=0;a<e.sfbmax;a++){var o=e.width[a],s=e.scalefac[a];if(0!=e.preflag&&(s+=n.pretab[a]),i+=o,0!=(1&s)){s++;for(var c=-o;c<0;c++)t[i+c]*=r,t[i+c]>e.xrpow_max&&(e.xrpow_max=t[i+c])}e.scalefac[a]=s>>1}e.preflag=0,e.scalefac_scale=1}function m(e,t,r){var i,a=t.scalefac;for(i=0;i<t.sfb_lmax;i++)if(a[i]>=16)return!0;for(var o=0;o<3;o++){var s=0,c=0;for(i=t.sfb_lmax+o;i<t.sfbdivide;i+=3)s<a[i]&&(s=a[i]);for(;i<t.sfbmax;i+=3)c<a[i]&&(c=a[i]);if(!(s<16&&c<8)){if(t.subblock_gain[o]>=7)return!0;t.subblock_gain[o]++;var u=e.scalefac_band.l[t.sfb_lmax];for(i=t.sfb_lmax+o;i<t.sfbmax;i+=3){var l=t.width[i],d=a[i];if(Ht(d>=0),(d-=4>>t.scalefac_scale)>=0)a[i]=d,u+=3*l;else{a[i]=0;var f=210+(d<<t.scalefac_scale+1);p=n.IPOW20(f),u+=l*(o+1);for(var h=-l;h<0;h++)r[u+h]*=p,r[u+h]>t.xrpow_max&&(t.xrpow_max=r[u+h]);u+=l*(3-o-1)}}var p=n.IPOW20(202);for(u+=t.width[i]*(o+1),h=-t.width[i];h<0;h++)r[u+h]*=p,r[u+h]>t.xrpow_max&&(t.xrpow_max=r[u+h])}}return!1}function g(e,t,n,i,a){var o=e.internal_flags;h(e,t,n,i,a);var s=u(t);return!s&&(!(s=2==o.mode_gr?r.scale_bitcount(t):r.scale_bitcount_lsf(o,t))||(o.noise_shaping>1&&(Wt.fill(o.pseudohalf,0),0==t.scalefac_scale?(p(t,i),s=!1):t.block_type==j.SHORT_TYPE&&o.subblock_gain>0&&(s=m(o,t,i)||u(t))),s||(s=2==o.mode_gr?r.scale_bitcount(t):r.scale_bitcount_lsf(o,t)),!s))}this.setModules=function(a,o,s,c){e=a,t=o,this.rv=o,n=s,this.qupvt=s,r=c,i.setModules(n,r)},this.ms_convert=function(e,t){for(var n=0;n<576;++n){var r=e.tt[t][0].xr[n],i=e.tt[t][1].xr[n];e.tt[t][0].xr[n]=(r+i)*(.5*zt.SQRT2),e.tt[t][1].xr[n]=(r-i)*(.5*zt.SQRT2)}},this.init_xrpow=function(e,t,n){var r=0,i=0|t.max_nonzero_coeff;if(Ht(null!=n),t.xrpow_max=0,Ht(0<=i&&i<=575),Wt.fill(n,i,576,0),(r=a(t,n,i,r))>1e-20){var o=0;0!=(2&e.substep_shaping)&&(o=1);for(var s=0;s<t.psymax;s++)e.pseudohalf[s]=o;return!0}return Wt.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,t){t.part2_3_length=0,t.big_values=0,t.count1=0,t.global_gain=210,t.scalefac_compress=0,t.table_select[0]=0,t.table_select[1]=0,t.table_select[2]=0,t.subblock_gain[0]=0,t.subblock_gain[1]=0,t.subblock_gain[2]=0,t.subblock_gain[3]=0,t.region0_count=0,t.region1_count=0,t.preflag=0,t.scalefac_scale=0,t.count1table_select=0,t.part2_length=0,t.sfb_lmax=j.SBPSY_l,t.sfb_smin=j.SBPSY_s,t.psy_lmax=e.sfb21_extra?j.SBMAX_l:j.SBPSY_l,t.psymax=t.psy_lmax,t.sfbmax=t.sfb_lmax,t.sfbdivide=11;for(var r=0;r<j.SBMAX_l;r++)t.width[r]=e.scalefac_band.l[r+1]-e.scalefac_band.l[r],t.window[r]=3;if(t.block_type==j.SHORT_TYPE){var i=Gt(576);t.sfb_smin=0,t.sfb_lmax=0,0!=t.mixed_block_flag&&(t.sfb_smin=3,t.sfb_lmax=2*e.mode_gr+4),t.psymax=t.sfb_lmax+3*((e.sfb21_extra?j.SBMAX_s:j.SBPSY_s)-t.sfb_smin),t.sfbmax=t.sfb_lmax+3*(j.SBPSY_s-t.sfb_smin),t.sfbdivide=t.sfbmax-18,t.psy_lmax=t.sfb_lmax;var a=e.scalefac_band.l[t.sfb_lmax];for(Bt.arraycopy(t.xr,0,i,0,576),r=t.sfb_smin;r<j.SBMAX_s;r++)for(var s=e.scalefac_band.s[r],c=e.scalefac_band.s[r+1],u=0;u<3;u++)for(var l=s;l<c;l++)t.xr[a++]=i[3*l+u];var d=t.sfb_lmax;for(r=t.sfb_smin;r<j.SBMAX_s;r++)t.width[d]=t.width[d+1]=t.width[d+2]=e.scalefac_band.s[r+1]-e.scalefac_band.s[r],t.window[d]=0,t.window[d+1]=1,t.window[d+2]=2,d+=3}t.count1bits=0,t.sfb_partition_table=n.nr_of_sfb_block[0][0],t.slen[0]=0,t.slen[1]=0,t.slen[2]=0,t.slen[3]=0,t.max_nonzero_coeff=575,Wt.fill(t.scalefac,0),o(e,t)},s.BINSEARCH_NONE=new s(0),s.BINSEARCH_UP=new s(1),s.BINSEARCH_DOWN=new s(2),this.trancate_smallspectrums=function(e,t,i,a){var o=Gt(ie.SFBMAX);if((0!=(4&e.substep_shaping)||t.block_type!=j.SHORT_TYPE)&&0==(128&e.substep_shaping)){n.calc_noise(t,i,o,new Ot,null);for(var s=0;s<576;s++){var c=0;0!=t.l3_enc[s]&&(c=Math.abs(t.xr[s])),a[s]=c}s=0;var u=8;t.block_type==j.SHORT_TYPE&&(u=6);do{var l,d,f,h,p=t.width[u];if(s+=p,!(o[u]>=1)&&(Wt.sort(a,s-p,p),!BitStream.EQ(a[s-1],0))){l=(1-o[u])*i[u],d=0,h=0;do{var m;for(f=1;h+f<p&&!BitStream.NEQ(a[h+s-p],a[h+s+f-p]);f++);if(l<(m=a[h+s-p]*a[h+s-p]*f)){0!=h&&(d=a[h+s-p-1]);break}l-=m,h+=f}while(h<p);if(!BitStream.EQ(d,0))do{Math.abs(t.xr[s-p])<=d&&(t.l3_enc[s-p]=0)}while(--p>0)}}while(++u<t.psymax);t.part2_3_length=r.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,t,i,a,o,s){var u=e.internal_flags,l=new ce,d=Gt(576),h=Gt(ie.SFBMAX),p=new Ot,m=new Ut,v=9999999,y=!1,b=!1,_=0;if(c(u,t,s,o,a),0==u.noise_shaping)return 100;n.calc_noise(t,i,h,p,m),p.bits=t.part2_3_length,l.assign(t);var w=0;for(Bt.arraycopy(a,0,d,0,576);!y;){do{var E,S=new Ot,C=255;if(E=0!=(2&u.substep_shaping)?20:3,u.sfb21_extra){if(h[l.sfbmax]>1)break;if(l.block_type==j.SHORT_TYPE&&(h[l.sfbmax+1]>1||h[l.sfbmax+2]>1))break}if(!g(e,l,h,a,b))break;0!=l.scalefac_scale&&(C=254);var x=s-l.part2_length;if(x<=0)break;for(;(l.part2_3_length=r.count_bits(u,a,l,m))>x&&l.global_gain<=C;)l.global_gain++;if(l.global_gain>C)break;if(0==p.over_count){for(;(l.part2_3_length=r.count_bits(u,a,l,m))>v&&l.global_gain<=C;)l.global_gain++;if(l.global_gain>C)break}if(n.calc_noise(l,i,h,S,m),S.bits=l.part2_3_length,0!=(f(t.block_type!=j.SHORT_TYPE?e.quant_comp:e.quant_comp_short,p,S,l,h)?1:0))v=t.part2_3_length,p=S,t.assign(l),w=0,Bt.arraycopy(a,0,d,0,576);else if(0==u.full_outer_loop){if(++w>E&&0==p.over_count)break;if(3==u.noise_shaping_amp&&b&&w>30)break;if(3==u.noise_shaping_amp&&b&&l.global_gain-_>15)break}}while(l.global_gain+l.scalefac_scale<255);3==u.noise_shaping_amp?b?y=!0:(l.assign(t),Bt.arraycopy(d,0,a,0,576),w=0,_=l.global_gain,b=!0):y=!0}return Ht(t.global_gain+t.scalefac_scale<=255),e.VBR==Vt.vbr_rh||e.VBR==Vt.vbr_mtrh?Bt.arraycopy(d,0,a,0,576):0!=(1&u.substep_shaping)&&trancate_smallspectrums(u,t,i,a),p.over_count},this.iteration_finish_one=function(e,n,i){var a=e.l3_side,o=a.tt[n][i];r.best_scalefac_store(e,n,i,a),1==e.use_best_huffman&&r.best_huffman_divide(e,o),t.ResvAdjust(e,o)},this.VBR_encode_granule=function(e,t,n,r,i,a,o){var s,c=e.internal_flags,u=new ce,l=Gt(576),d=o,f=o+1,h=(o+a)/2,p=0,m=c.sfb21_extra;Ht(d<=LameInternalFlags.MAX_BITS_PER_CHANNEL),Wt.fill(u.l3_enc,0);do{Ht(h>=a),Ht(h<=o),Ht(a<=o),c.sfb21_extra=!(h>d-42)&&m,outer_loop(e,t,n,r,i,h)<=0?(p=1,f=t.part2_3_length,u.assign(t),Bt.arraycopy(r,0,l,0,576),s=(o=f-32)-a,h=(o+a)/2):(s=o-(a=h+32),h=(o+a)/2,0!=p&&(p=2,t.assign(u),Bt.arraycopy(l,0,r,0,576)))}while(s>12);c.sfb21_extra=m,2==p&&Bt.arraycopy(u.l3_enc,0,t.l3_enc,0,576),Ht(t.part2_3_length<=d)},this.get_framebits=function(n,r){var i=n.internal_flags;i.bitrate_index=i.VBR_min_bitrate;var a=e.getframebits(n);i.bitrate_index=1,a=e.getframebits(n);for(var o=1;o<=i.VBR_max_bitrate;o++){i.bitrate_index=o;var s=new MeanBits(a);r[o]=t.ResvFrameBegin(n,s),a=s.bits}},this.VBR_old_prepare=function(e,r,i,a,o,s,c,u,l){var d,f=e.internal_flags,h=0,p=1,m=0;f.bitrate_index=f.VBR_max_bitrate;var g=t.ResvFrameBegin(e,new MeanBits(0))/f.mode_gr;get_framebits(e,s);for(var v=0;v<f.mode_gr;v++){var y=n.on_pe(e,r,u[v],g,v,0);f.mode_ext==j.MPG_MD_MS_LR&&(ms_convert(f.l3_side,v),n.reduce_side(u[v],i[v],g,y));for(var b=0;b<f.channels_out;++b){var _=f.l3_side.tt[v][b];_.block_type!=j.SHORT_TYPE?(h=1.28/(1+Math.exp(3.5-r[v][b]/300))-.05,d=f.PSY.mask_adjust-h):(h=2.56/(1+Math.exp(3.5-r[v][b]/300))-.14,d=f.PSY.mask_adjust_short-h),f.masking_lower=Math.pow(10,.1*d),init_outer_loop(f,_),l[v][b]=n.calc_xmin(e,a[v][b],_,o[v][b]),0!=l[v][b]&&(p=0),c[v][b]=126,m+=u[v][b]}}for(v=0;v<f.mode_gr;v++)for(b=0;b<f.channels_out;b++)m>s[f.VBR_max_bitrate]&&(u[v][b]*=s[f.VBR_max_bitrate],u[v][b]/=m),c[v][b]>u[v][b]&&(c[v][b]=u[v][b]);return p},this.bitpressure_strategy=function(e,t,n,r){for(var i=0;i<e.mode_gr;i++)for(var a=0;a<e.channels_out;a++){for(var o=e.l3_side.tt[i][a],s=t[i][a],c=0,u=0;u<o.psy_lmax;u++)s[c++]*=1+.029*u*u/j.SBMAX_l/j.SBMAX_l;if(o.block_type==j.SHORT_TYPE)for(u=o.sfb_smin;u<j.SBMAX_s;u++)s[c++]*=1+.029*u*u/j.SBMAX_s/j.SBMAX_s,s[c++]*=1+.029*u*u/j.SBMAX_s/j.SBMAX_s,s[c++]*=1+.029*u*u/j.SBMAX_s/j.SBMAX_s;r[i][a]=0|Math.max(n[i][a],.9*r[i][a])}},this.VBR_new_prepare=function(e,r,i,a,o,s){var c,u=e.internal_flags,l=1,d=0,f=0;if(e.free_format)u.bitrate_index=0,h=new MeanBits(d),c=t.ResvFrameBegin(e,h),d=h.bits,o[0]=c;else{u.bitrate_index=u.VBR_max_bitrate;var h=new MeanBits(d);t.ResvFrameBegin(e,h),d=h.bits,get_framebits(e,o),c=o[u.VBR_max_bitrate]}for(var p=0;p<u.mode_gr;p++){n.on_pe(e,r,s[p],d,p,0),u.mode_ext==j.MPG_MD_MS_LR&&ms_convert(u.l3_side,p);for(var m=0;m<u.channels_out;++m){var g=u.l3_side.tt[p][m];u.masking_lower=Math.pow(10,.1*u.PSY.mask_adjust),init_outer_loop(u,g),0!=n.calc_xmin(e,i[p][m],g,a[p][m])&&(l=0),f+=s[p][m]}}for(p=0;p<u.mode_gr;p++)for(m=0;m<u.channels_out;m++)f>c&&(s[p][m]*=c,s[p][m]/=f);return l},this.calc_target_bits=function(r,i,a,o,s,c){var u,l,d,f,h=r.internal_flags,p=h.l3_side,m=0;h.bitrate_index=h.VBR_max_bitrate;var g=new MeanBits(m);for(c[0]=t.ResvFrameBegin(r,g),m=g.bits,h.bitrate_index=1,m=e.getframebits(r)-8*h.sideinfo_len,s[0]=m/(h.mode_gr*h.channels_out),m=r.VBR_mean_bitrate_kbps*r.framesize*1e3,0!=(1&h.substep_shaping)&&(m*=1.09),m/=r.out_samplerate,m-=8*h.sideinfo_len,m/=h.mode_gr*h.channels_out,(u=.93+.07*(11-r.compression_ratio)/5.5)<.9&&(u=.9),u>1&&(u=1),l=0;l<h.mode_gr;l++){var v=0;for(d=0;d<h.channels_out;d++){if(o[l][d]=int(u*m),i[l][d]>700){var y=int((i[l][d]-700)/1.4),b=p.tt[l][d];o[l][d]=int(u*m),b.block_type==j.SHORT_TYPE&&y<m/2&&(y=m/2),y>3*m/2?y=3*m/2:y<0&&(y=0),o[l][d]+=y}o[l][d]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(o[l][d]=LameInternalFlags.MAX_BITS_PER_CHANNEL),v+=o[l][d]}if(v>LameInternalFlags.MAX_BITS_PER_GRANULE)for(d=0;d<h.channels_out;++d)o[l][d]*=LameInternalFlags.MAX_BITS_PER_GRANULE,o[l][d]/=v}if(h.mode_ext==j.MPG_MD_MS_LR)for(l=0;l<h.mode_gr;l++)n.reduce_side(o[l],a[l],m*h.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(f=0,l=0;l<h.mode_gr;l++)for(d=0;d<h.channels_out;d++)o[l][d]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(o[l][d]=LameInternalFlags.MAX_BITS_PER_CHANNEL),f+=o[l][d];if(f>c[0])for(l=0;l<h.mode_gr;l++)for(d=0;d<h.channels_out;d++)o[l][d]*=c[0],o[l][d]/=f}}var qt=Yt,Kt=m.assert;function Xt(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,n){var r,i=t.internal_flags,a=i.l3_side,o=e.getframebits(t);n.bits=(o-8*i.sideinfo_len)/i.mode_gr;var s=2048*i.mode_gr-8;t.brate>320?r=8*int(1e3*t.brate/(t.out_samplerate/1152)/8+.5):(r=11520,t.strict_ISO&&(r=8*int(32e4/(t.out_samplerate/1152)/8+.5))),i.ResvMax=r-o,i.ResvMax>s&&(i.ResvMax=s),(i.ResvMax<0||t.disable_reservoir)&&(i.ResvMax=0);var c=n.bits*i.mode_gr+Math.min(i.ResvSize,i.ResvMax);return c>r&&(c=r),Kt(0==i.ResvMax%8),Kt(i.ResvMax>=0),a.resvDrain_pre=0,null!=i.pinfo&&(i.pinfo.mean_bits=n.bits/2,i.pinfo.resvsize=i.ResvSize),c},this.ResvMaxBits=function(e,t,n,r){var i,a=e.internal_flags,o=a.ResvSize,s=a.ResvMax;0!=r&&(o+=t),0!=(1&a.substep_shaping)&&(s*=.9),n.bits=t,10*o>9*s?(i=o-9*s/10,n.bits+=i,a.substep_shaping|=128):(i=0,a.substep_shaping&=127,e.disable_reservoir||0!=(1&a.substep_shaping)||(n.bits-=.1*t));var c=o<6*a.ResvMax/10?o:6*a.ResvMax/10;return(c-=i)<0&&(c=0),c},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var n,r=e.l3_side;e.ResvSize+=t*e.mode_gr;var i=0;r.resvDrain_post=0,r.resvDrain_pre=0,0!=(n=e.ResvSize%8)&&(i+=n),(n=e.ResvSize-i-e.ResvMax)>0&&(Kt(0==n%8),Kt(n>=0),i+=n);var a=Math.min(8*r.main_data_begin,i)/8;r.resvDrain_pre+=8*a,i-=8*a,e.ResvSize-=8*a,r.main_data_begin-=a,r.resvDrain_post+=i,e.ResvSize-=i}}var Qt=Xt;function Jt(){var e="http://www.mp3dev.org/",t=3,n=98,r=4,i=0,a=93;this.getLameVersion=function(){return t+"."+n+"."+r},this.getLameShortVersion=function(){return t+"."+n+"."+r},this.getLameVeryShortVersion=function(){return"LAME"+t+"."+n+"r"},this.getPsyVersion=function(){return i+"."+a},this.getLameUrl=function(){return e},this.getLameOsBitness=function(){return"32bits"}}var Zt=Jt,$t=m.System,en=m.VbrMode,tn=m.ShortBlock,nn=m.Arrays,rn=m.new_byte,an=m.assert;function on(){var e,t,n;this.setModules=function(r,i,a){e=r,t=i,n=a};var r=1,i=2,a=4,o=8,s=on.NUMTOCENTRIES,c=on.MAXFRAMESIZE,u=s+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,l=128,d=64,f=32,h=null,p="Xing",m="Info",g=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function v(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var n=1;n<e.size;n+=2)e.bag[n/2]=e.bag[n];e.want*=2,e.pos/=2}}function y(e,t){if(!(e.pos<=0))for(var n=1;n<s;++n){var r=n/s,i=0|Math.floor(r*e.pos);i>e.pos-1&&(i=e.pos-1);var a=0|256*e.bag[i]/e.sum;a>255&&(a=255),t[n]=255&a}}function b(e,t){var n=255&e[t+0];return n<<=8,n|=255&e[t+1],n<<=8,n|=255&e[t+2],n<<=8,n|=255&e[t+3]}function _(e,t,n){e[t+0]=255&n>>24,e[t+1]=255&n>>16,e[t+2]=255&n>>8,e[t+3]=255&n}function w(e,t,n){e[t+0]=255&n>>8,e[t+1]=255&n}function E(e,t){return new String(e,t,p.length(),h).equals(p)||new String(e,t,m.length(),h).equals(m)}function S(e,t,n){return 255&(e<<t|n&~(-1<<t))}function C(t,n){var r=t.internal_flags;n[0]=S(n[0],8,255),n[1]=S(n[1],3,7),n[1]=S(n[1],1,t.out_samplerate<16e3?0:1),n[1]=S(n[1],1,t.version),n[1]=S(n[1],2,1),n[1]=S(n[1],1,t.error_protection?0:1),n[2]=S(n[2],4,r.bitrate_index),n[2]=S(n[2],2,r.samplerate_index),n[2]=S(n[2],1,0),n[2]=S(n[2],1,t.extension),n[3]=S(n[3],2,t.mode.ordinal()),n[3]=S(n[3],2,r.mode_ext),n[3]=S(n[3],1,t.copyright),n[3]=S(n[3],1,t.original),n[3]=S(n[3],2,t.emphasis),n[0]=255;var i,a,o=241&n[1];i=1==t.version?l:t.out_samplerate<16e3?f:d,t.VBR==en.vbr_off&&(i=t.brate),a=t.free_format?0:255&16*e.BitrateIndex(i,t.version,t.out_samplerate),1==t.version?(n[1]=255&o|10,o=13&n[2],n[2]=255&(a|o)):(n[1]=255&o|2,o=13&n[2],n[2]=255&(a|o))}function x(e,t){return t=t>>8^g[255&(t^e)]}function T(e,t,r,i,a){var o,s,c=e.internal_flags,u=0,l=e.encoder_delay,d=e.encoder_padding,f=100-10*e.VBR_q-e.quality,h=n.getLameVeryShortVersion(),p=0,m=[1,5,3,2,4,0,3],g=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),v=0,y=0,b=0,E=e.internal_flags.noise_shaping,S=0,C=0,T=0,R=0,I=0,N=0!=(1&e.exp_nspsytune),A=0!=(2&e.exp_nspsytune),k=!1,D=!1,M=e.internal_flags.nogap_total,L=e.internal_flags.nogap_current,O=e.ATHtype,P=0;switch(e.VBR){case vbr_abr:s=e.VBR_mean_bitrate_kbps;break;case vbr_off:s=e.brate;break;default:s=e.VBR_min_bitrate_kbps}switch(o=16*p+(e.VBR.ordinal()<m.length?m[e.VBR.ordinal()]:0),c.findReplayGain&&(c.RadioGain>510&&(c.RadioGain=510),c.RadioGain<-510&&(c.RadioGain=-510),y=8192,y|=3072,c.RadioGain>=0?y|=c.RadioGain:(y|=512,y|=-c.RadioGain)),c.findPeakSample&&(v=Math.abs(0|c.PeakSample/32767*Math.pow(2,23)+.5)),-1!=M&&(L>0&&(D=!0),L<M-1&&(k=!0)),P=O+((N?1:0)<<4)+((A?1:0)<<5)+((k?1:0)<<6)+((D?1:0)<<7),f<0&&(f=0),e.mode){case MONO:S=0;break;case STEREO:S=1;break;case DUAL_CHANNEL:S=2;break;case JOINT_STEREO:S=e.force_ms?4:3;break;case NOT_SET:default:S=7}T=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==tn.short_block_forced||e.short_blocks==tn.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==O||e.in_samplerate<=32e3)&&(C=1),R=E+(S<<2)+(C<<5)+(T<<6),I=c.nMusicCRC,_(r,i+u,f),u+=4;for(var j=0;j<9;j++)r[i+u+j]=255&h.charAt(j);r[i+(u+=9)]=255&o,r[i+ ++u]=255&g,_(r,i+ ++u,v),w(r,i+(u+=4),y),w(r,i+(u+=2),b),r[i+(u+=2)]=255&P,r[i+ ++u]=s>=255?255:255&s,r[i+ ++u]=255&l>>4,r[i+u+1]=255&(l<<4)+(d>>8),r[i+u+2]=255&d,r[i+(u+=3)]=255&R,u++,r[i+u++]=0,w(r,i+u,e.preset),_(r,i+(u+=2),t),w(r,i+(u+=4),I),u+=2;for(var F=0;F<u;F++)a=x(r[i+F],a);return w(r,i+u,a),u+=2}function R(e){e.seek(0);var t=rn(10);return e.readFully(t),new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}this.addVbrFrame=function(e){var t=e.internal_flags,n=Tables.bitrate_table[e.version][t.bitrate_index];an(null!=t.VBR_seek_table.bag),v(t.VBR_seek_table,n)},this.getVbrTag=function(e){var t=new VBRTagData,n=0;t.flags=0;var c=e[n+1]>>3&1,u=e[n+2]>>2&3,l=e[n+3]>>6&3,d=e[n+2]>>4&15;if(d=Tables.bitrate_table[c][d],e[n+1]>>4==14?t.samprate=Tables.samplerate_table[2][u]:t.samprate=Tables.samplerate_table[c][u],!E(e,n+=0!=c?3!=l?36:21:3!=l?21:13))return null;n+=4,t.hId=c;var f=t.flags=b(e,n);if(n+=4,0!=(f&r)&&(t.frames=b(e,n),n+=4),0!=(f&i)&&(t.bytes=b(e,n),n+=4),0!=(f&a)){if(null!=t.toc)for(var h=0;h<s;h++)t.toc[h]=e[n+h];n+=s}t.vbrScale=-1,0!=(f&o)&&(t.vbrScale=b(e,n),n+=4),t.headersize=72e3*(c+1)*d/t.samprate;var p=e[(n+=21)+0]<<4;p+=e[n+1]>>4;var m=(15&e[n+1])<<8;return(p<0||p>3e3)&&(p=-1),((m+=255&e[n+2])<0||m>3e3)&&(m=-1),t.encDelay=p,t.encPadding=m,t},this.InitVbrTag=function(e){var n,r=e.internal_flags;n=1==e.version?l:e.out_samplerate<16e3?f:d,e.VBR==en.vbr_off&&(n=e.brate);var i=72e3*(e.version+1)*n/e.out_samplerate,a=r.sideinfo_len+u;if(r.VBR_seek_table.TotalFrameSize=i,i<a||i>c)e.bWriteVbrTag=!1;else{r.VBR_seek_table.nVbrNumFrames=0,r.VBR_seek_table.nBytesWritten=0,r.VBR_seek_table.sum=0,r.VBR_seek_table.seen=0,r.VBR_seek_table.want=1,r.VBR_seek_table.pos=0,null==r.VBR_seek_table.bag&&(r.VBR_seek_table.bag=new int[400],r.VBR_seek_table.size=400);var o=rn(c);C(e,o);for(var s=r.VBR_seek_table.TotalFrameSize,h=0;h<s;++h)t.add_dummy_byte(e,255&o[h],1)}},this.updateMusicCRC=function(e,t,n,r){for(var i=0;i<r;++i)e[0]=x(t[n+i],e[0])},this.getLameTagFrame=function(e,n){var c=e.internal_flags;if(!e.bWriteVbrTag)return 0;if(c.Class_ID!=Lame.LAME_ID)return 0;if(c.VBR_seek_table.pos<=0)return 0;if(n.length<c.VBR_seek_table.TotalFrameSize)return c.VBR_seek_table.TotalFrameSize;nn.fill(n,0,c.VBR_seek_table.TotalFrameSize,0),C(e,n);var u=rn(s);if(e.free_format)for(var l=1;l<s;++l)u[l]=255&255*l/100;else y(c.VBR_seek_table,u);var d=c.sideinfo_len;e.error_protection&&(d-=2),e.VBR==en.vbr_off?(n[d++]=255&m.charAt(0),n[d++]=255&m.charAt(1),n[d++]=255&m.charAt(2),n[d++]=255&m.charAt(3)):(n[d++]=255&p.charAt(0),n[d++]=255&p.charAt(1),n[d++]=255&p.charAt(2),n[d++]=255&p.charAt(3)),_(n,d,r+i+a+o),_(n,d+=4,c.VBR_seek_table.nVbrNumFrames),d+=4;var f=c.VBR_seek_table.nBytesWritten+c.VBR_seek_table.TotalFrameSize;_(n,d,0|f),d+=4,$t.arraycopy(u,0,n,d,u.length),d+=u.length,e.error_protection&&t.CRC_writeheader(c,n);var h=0;for(l=0;l<d;l++)h=x(n[l],h);return d+=T(e,f,n,d,h),c.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(e.internal_flags.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var n=R(t);t.seek(n);var r=rn(c),i=getLameTagFrame(e,r);return i>r.length?-1:(i<1||t.write(r,0,i),0)}}on.NUMTOCENTRIES=100,on.MAXFRAMESIZE=2880;var sn=on,cn=m.new_byte,un=m.assert;function ln(){this.setModules=function(e,t){}}function dn(){this.setModules=function(e,t,n){}}function fn(){}function hn(){this.setModules=function(e,t){}}function pn(e,t,n){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,n=128);var r=new Lame,i=new ln,a=new GainAnalysis,o=new BitStream,s=new Presets,c=new QuantizePVT,u=new Quantize,l=new sn,d=new Zt,f=new hn,h=new Reservoir,p=new Takehiro,m=new dn,g=new fn;r.setModules(a,o,s,c,u,l,d,f,g),o.setModules(a,g,d,l),f.setModules(o,d),s.setModules(r),u.setModules(o,h,c,p),c.setModules(p,h,r.enc.psy),h.setModules(o),p.setModules(c),l.setModules(r,o,d),i.setModules(m,g),m.setModules(d,f,s);var v=r.lame_init();v.num_channels=e,v.in_samplerate=t,v.brate=n,v.mode=MPEGMode.STEREO,v.quality=3,v.bWriteVbrTag=!1,v.disable_reservoir=!0,v.write_id3tag_automatic=!1;var y=r.lame_init_params(v);un(0==y);var b=1152,_=0|1.25*b+7200,w=cn(_);this.encodeBuffer=function(t,n){1==e&&(n=t),un(t.length==n.length),t.length>b&&(b=t.length,w=cn(_=0|1.25*b+7200));var i=r.lame_encode_buffer(v,t,n,t.length,w,0,_);return new Int8Array(w.subarray(0,i))},this.flush=function(){var e=r.lame_encode_flush(v,w,0,_);return new Int8Array(w.subarray(0,e))}}function mn(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function gn(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}Lame=It,Presets=kt,GainAnalysis=je,QuantizePVT=at,Quantize=qt,Takehiro=dt,Reservoir=Qt,MPEGMode=ee,BitStream=bt,mn.RIFF=gn("RIFF"),mn.WAVE=gn("WAVE"),mn.fmt_=gn("fmt "),mn.data=gn("data"),mn.readHeader=function(e){var t=new mn,n=e.getUint32(0,!1);if(mn.RIFF==n&&(e.getUint32(4,!0),mn.WAVE==e.getUint32(8,!1)&&mn.fmt_==e.getUint32(12,!1))){var r=e.getUint32(16,!0),i=20;switch(r){case 16:case 18:t.channels=e.getUint16(i+2,!0),t.sampleRate=e.getUint32(i+4,!0);break;default:throw"extended fmt chunk not implemented"}i+=r;for(var a=mn.data,o=0;a!=n&&(n=e.getUint32(i,!1),o=e.getUint32(i+4,!0),a!=n);)i+=o+8;return t.dataLen=o,t.dataOffset=i+8,t}};var vn=pn,yn=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},bn=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_n=function(){function e(t){yn(this,e),this.config={sampleRate:44100,bitRate:128},Object.assign(this.config,t),this.mp3Encoder=new vn(1,this.config.sampleRate,this.config.bitRate),this.maxSamples=1152,this.samplesMono=null,this.clearBuffer()}return bn(e,[{key:"clearBuffer",value:function(){this.dataBuffer=[]}},{key:"appendToBuffer",value:function(e){this.dataBuffer.push(new Int8Array(e))}},{key:"floatTo16BitPCM",value:function(e,t){for(var n=0;n<e.length;n++){var r=Math.max(-1,Math.min(1,e[n]));t[n]=r<0?32768*r:32767*r}}},{key:"convertBuffer",value:function(e){var t=new Float32Array(e),n=new Int16Array(e.length);return this.floatTo16BitPCM(t,n),n}},{key:"encode",value:function(e){this.samplesMono=this.convertBuffer(e);for(var t=this.samplesMono.length,n=0;t>=0;n+=this.maxSamples){var r=this.samplesMono.subarray(n,n+this.maxSamples),i=this.mp3Encoder.encodeBuffer(r);this.appendToBuffer(i),t-=this.maxSamples}}},{key:"finish",value:function(){return this.appendToBuffer(this.mp3Encoder.flush()),this.dataBuffer}}]),e}();return function(){function e(t){yn(this,e),this.config={bitRate:128,startRecordingAt:300,deviceId:null},this.activeStream=null,this.context=null,this.microphone=null,this.processor=null,this.startTime=0,Object.assign(this.config,t)}return bn(e,[{key:"addMicrophoneListener",value:function(e){var t=this;this.activeStream=e,this.timerToStart=setTimeout((function(){delete t.timerToStart}),this.config.startRecordingAt),this.microphone=this.context.createMediaStreamSource(e),this.processor=this.context.createScriptProcessor(0,1,1),this.processor.onaudioprocess=function(e){t.timerToStart||t.lameEncoder.encode(e.inputBuffer.getChannelData(0))},this.microphone.connect(this.processor),this.processor.connect(this.context.destination)}},{key:"stop",value:function(){return this.processor&&this.microphone&&(this.microphone.disconnect(),this.processor.disconnect(),this.context&&"closed"!==this.context.state&&this.context.close(),this.processor.onaudioprocess=null,this.activeStream.getAudioTracks().forEach((function(e){return e.stop()}))),this}},{key:"start",value:function(){var e=this,t=window.AudioContext||window.webkitAudioContext;this.context=new t,this.config.sampleRate=this.context.sampleRate,this.lameEncoder=new _n(this.config);var n=!this.config.deviceId||{deviceId:{exact:this.config.deviceId}};return new Promise((function(t,r){navigator.mediaDevices.getUserMedia({audio:n}).then((function(n){e.addMicrophoneListener(n),t(n)})).catch((function(e){r(e)}))}))}},{key:"getMp3",value:function(){var e=this,t=this.lameEncoder.finish();return new Promise((function(n,r){0===t.length?r(new Error("No buffer to send")):(n([t,new Blob(t,{type:"audio/mp3"})]),e.lameEncoder.clearBuffer())}))}}]),e}()}()},364:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var r={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};const i=function(e,t,n){var i,a=r[e];return i="string"===typeof a?a:1===t?a.one:a.other.replace("{{count}}",t.toString()),null!==n&&void 0!==n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+i:i+" ago":i};function a(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}var o={date:a({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:a({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:a({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})};var s={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function c(e){return function(t,n){var r;if("formatting"===(null!==n&&void 0!==n&&n.context?String(n.context):"standalone")&&e.formattingValues){var i=e.defaultFormattingWidth||e.defaultWidth,a=null!==n&&void 0!==n&&n.width?String(n.width):i;r=e.formattingValues[a]||e.formattingValues[i]}else{var o=e.defaultWidth,s=null!==n&&void 0!==n&&n.width?String(n.width):e.defaultWidth;r=e.values[s]||e.values[o]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function u(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.width,i=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],a=t.match(i);if(!a)return null;var o,s=a[0],c=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],u=Array.isArray(c)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return}(c,(function(e){return e.test(s)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n;return}(c,(function(e){return e.test(s)}));return o=e.valueCallback?e.valueCallback(u):u,{value:o=n.valueCallback?n.valueCallback(o):o,rest:t.slice(s.length)}}}var l;const d={code:"en-US",formatDistance:i,formatLong:o,formatRelative:function(e,t,n,r){return s[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:c({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:c({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:c({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:c({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:c({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(l={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(l.matchPattern);if(!n)return null;var r=n[0],i=e.match(l.parsePattern);if(!i)return null;var a=l.valueCallback?l.valueCallback(i[0]):i[0];return{value:a=t.valueCallback?t.valueCallback(a):a,rest:e.slice(r.length)}}),era:u({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:u({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:u({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:u({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:u({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}}},486:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(5027),i=n(8726),a=n(6191);function o(e,t){(0,i.A)(2,arguments);var n=(0,a.A)(t);return(0,r.default)(e,-n)}},579:(e,t,n)=>{"use strict";e.exports=n(1153)},618:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n(888),i=n(6191),a=n(8726),o=n(8171);function s(e,t){var n,s,c,u,l,d,f,h;(0,a.A)(1,arguments);var p=(0,o.q)(),m=(0,i.A)(null!==(n=null!==(s=null!==(c=null!==(u=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==u?u:null===t||void 0===t||null===(l=t.locale)||void 0===l||null===(d=l.options)||void 0===d?void 0:d.weekStartsOn)&&void 0!==c?c:p.weekStartsOn)&&void 0!==s?s:null===(f=p.locale)||void 0===f||null===(h=f.options)||void 0===h?void 0:h.weekStartsOn)&&void 0!==n?n:0);if(!(m>=0&&m<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=(0,r.default)(e),v=g.getDay(),y=(v<m?7:0)+v-m;return g.setDate(g.getDate()-y),g.setHours(0,0,0,0),g}},743:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){return(0,i.A)(1,arguments),(0,r.default)(e).getDay()}},745:()=>{},776:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(888),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,i.default)(e),o=(0,r.A)(t);return n.setSeconds(o),n}},802:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){(0,i.A)(1,arguments);var t=(0,r.default)(e),n=t.getFullYear();return t.setFullYear(n+1,0,0),t.setHours(23,59,59,999),t}},816:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(2284);function i(e){var t=function(e,t){if("object"!=(0,r.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(0,r.A)(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(0,r.A)(t)?t:t+""}},888:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(2284),i=n(8726);function a(e){(0,i.A)(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===(0,r.A)(e)&&"[object Date]"===t?new Date(e.getTime()):"number"===typeof e||"[object Number]"===t?new Date(e):("string"!==typeof e&&"[object String]"!==t||"undefined"===typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}},917:(e,t,n)=>{"use strict";var r,i,a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.ZX=function(e){document.body.classList.add("react-confirm-alert-body-element"),function(){if(document.getElementById("react-confirm-alert-firm-svg"))return;var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"feGaussianBlur");t.setAttribute("stdDeviation","0.3");var n=document.createElementNS(e,"filter");n.setAttribute("id","gaussian-blur"),n.appendChild(t);var r=document.createElementNS(e,"svg");r.setAttribute("id","react-confirm-alert-firm-svg"),r.setAttribute("class","react-confirm-alert-svg"),r.appendChild(n),document.body.appendChild(r)}(),function(e){var t=document.getElementById(e.targetId||m);e.targetId&&!t&&console.error("React Confirm Alert:","Can not get element id (#"+e.targetId+")");t||(document.body.children[0].classList.add("react-confirm-alert-blur"),(t=document.createElement("div")).id=m,document.body.appendChild(t)),(p=(0,l.createRoot)(t)).render(c.default.createElement(h,e))}(e)};var s=n(5043),c=d(s),u=d(n(5173)),l=n(4391);function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var h=(i=r=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.handleClickButton=function(e){e.onClick&&e.onClick(),r.close()},r.handleClickOverlay=function(e){var t=r.props,n=t.closeOnClickOutside,i=t.onClickOutside,a=e.target===r.overlay;n&&a&&(i(),r.close()),e.stopPropagation()},r.close=function(){var e=r.props.afterClose;document.body.classList.remove("react-confirm-alert-body-element"),function(e){var t=document.getElementById(e.targetId||m);t&&p.unmount(t)}(r.props),function(e){var t=document.getElementById("react-confirm-alert-firm-svg");t&&t.parentNode.removeChild(t);document.body.children[0].classList.remove("react-confirm-alert-blur"),e()}(e)},r.keyboard=function(e){var t=r.props,n=t.closeOnEscape,i=t.onKeypressEscape,a=t.onkeyPress,o=t.keyCodeForClose,s=e.keyCode,c=27===s;o.includes(s)&&r.close(),n&&c&&(i(e),r.close()),a&&a()},r.componentDidMount=function(){document.addEventListener("keydown",r.keyboard,!1)},r.componentWillUnmount=function(){document.removeEventListener("keydown",r.keyboard,!1),r.props.willUnmount()},r.renderCustomUI=function(){var e=r.props,t=e.title,n=e.message,i=e.buttons;return(0,e.customUI)({title:t,message:n,buttons:i,onClose:r.close})},f(r,n)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.title,r=t.message,i=t.buttons,o=t.childrenElement,s=t.customUI,u=t.overlayClassName;return c.default.createElement("div",{className:"react-confirm-alert-overlay "+u,ref:function(t){return e.overlay=t},onClick:this.handleClickOverlay},c.default.createElement("div",{className:"react-confirm-alert"},s?this.renderCustomUI():c.default.createElement("div",{className:"react-confirm-alert-body"},n&&c.default.createElement("h1",null,n),r,o(),c.default.createElement("div",{className:"react-confirm-alert-button-group"},i.map((function(t,n){return c.default.createElement("button",a({key:n,className:t.className},t,{onClick:function(n){return e.handleClickButton(t)}}),t.label)}))))))}}]),t}(s.Component),r.propTypes={title:u.default.string,message:u.default.string,buttons:u.default.array.isRequired,childrenElement:u.default.func,customUI:u.default.func,closeOnClickOutside:u.default.bool,closeOnEscape:u.default.bool,keyCodeForClose:u.default.arrayOf(u.default.number),willUnmount:u.default.func,afterClose:u.default.func,onClickOutside:u.default.func,onKeypressEscape:u.default.func,onkeyPress:u.default.func,overlayClassName:u.default.string},r.defaultProps={buttons:[{label:"Cancel",onClick:function(){return null},className:null},{label:"Confirm",onClick:function(){return null},className:null}],childrenElement:function(){return null},closeOnClickOutside:!0,closeOnEscape:!0,keyCodeForClose:[],willUnmount:function(){return null},afterClose:function(){return null},onClickOutside:function(){return null},onKeypressEscape:function(){return null}},i);var p=null,m="react-confirm-alert"},1153:(e,t,n)=>{"use strict";var r=n(5043),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var r,a={},u=null,l=null;for(r in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!c.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:u,ref:l,props:a,_owner:s.current}}t.Fragment=a,t.jsx=u,t.jsxs=u},1185:(e,t,n)=>{e.exports=n(9392)},1209:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var r=n(888),i=n(7451),a=n(2637),o=n(8726),s=n(6191),c=n(8171);var u=6048e5;function l(e,t){(0,o.A)(1,arguments);var n=(0,r.default)(e),l=(0,i.A)(n,t).getTime()-function(e,t){var n,r,u,l,d,f,h,p;(0,o.A)(1,arguments);var m=(0,c.q)(),g=(0,s.A)(null!==(n=null!==(r=null!==(u=null!==(l=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==l?l:null===t||void 0===t||null===(d=t.locale)||void 0===d||null===(f=d.options)||void 0===f?void 0:f.firstWeekContainsDate)&&void 0!==u?u:m.firstWeekContainsDate)&&void 0!==r?r:null===(h=m.locale)||void 0===h||null===(p=h.options)||void 0===p?void 0:p.firstWeekContainsDate)&&void 0!==n?n:1),v=(0,a.A)(e,t),y=new Date(0);return y.setUTCFullYear(v,0,g),y.setUTCHours(0,0,0,0),(0,i.A)(y,t)}(n,t).getTime();return Math.round(l/u)+1}},1218:e=>{var t,n,r,i,a,o,s,c,u,l,d,f,h,p,m,g=!1;function v(){if(!g){g=!0;var e=navigator.userAgent,v=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),y=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(f=/\b(iPhone|iP[ao]d)/.exec(e),h=/\b(iP[ao]d)/.exec(e),l=/Android/i.exec(e),p=/FBAN\/\w+;/i.exec(e),m=/Mobile/i.exec(e),d=!!/Win64/.exec(e),v){(t=v[1]?parseFloat(v[1]):v[5]?parseFloat(v[5]):NaN)&&document&&document.documentMode&&(t=document.documentMode);var b=/(?:Trident\/(\d+.\d+))/.exec(e);o=b?parseFloat(b[1])+4:t,n=v[2]?parseFloat(v[2]):NaN,r=v[3]?parseFloat(v[3]):NaN,(i=v[4]?parseFloat(v[4]):NaN)?(v=/(?:Chrome\/(\d+\.\d+))/.exec(e),a=v&&v[1]?parseFloat(v[1]):NaN):a=NaN}else t=n=r=a=i=NaN;if(y){if(y[1]){var _=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);s=!_||parseFloat(_[1].replace("_","."))}else s=!1;c=!!y[2],u=!!y[3]}else s=c=u=!1}}var y={ie:function(){return v()||t},ieCompatibilityMode:function(){return v()||o>t},ie64:function(){return y.ie()&&d},firefox:function(){return v()||n},opera:function(){return v()||r},webkit:function(){return v()||i},safari:function(){return y.webkit()},chrome:function(){return v()||a},windows:function(){return v()||c},osx:function(){return v()||s},linux:function(){return v()||u},iphone:function(){return v()||f},mobile:function(){return v()||f||h||l||m},nativeApp:function(){return v()||p},android:function(){return v()||l},ipad:function(){return v()||h}};e.exports=y},1251:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){(0,i.A)(1,arguments);var t=(0,r.default)(e);return t.setHours(23,59,59,999),t}},1315:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(2312),i=n(8726);function a(e,t){(0,i.A)(2,arguments);var n=(0,r.default)(e),a=(0,r.default)(t);return n.getTime()===a.getTime()}},1439:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5043),s=g(n(5173)),c=m(n(1774)),u=g(n(2206)),l=m(n(6619)),d=m(n(4841)),f=n(8821),h=g(f),p=g(n(2959));function m(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function g(e){return e&&e.__esModule?e:{default:e}}n(6062);var v={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},y=0,b=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.setOverlayRef=function(e){n.overlay=e,n.props.overlayRef&&n.props.overlayRef(e)},n.setContentRef=function(e){n.content=e,n.props.contentRef&&n.props.contentRef(e)},n.afterClose=function(){var e=n.props,t=e.appElement,r=e.ariaHideApp,i=e.htmlOpenClassName,a=e.bodyOpenClassName,o=e.parentSelector,s=o&&o().ownerDocument||document;a&&d.remove(s.body,a),i&&d.remove(s.getElementsByTagName("html")[0],i),r&&y>0&&0===(y-=1)&&l.show(t),n.props.shouldFocusAfterRender&&(n.props.shouldReturnFocusAfterClose?(c.returnFocus(n.props.preventScroll),c.teardownScopedFocus()):c.popWithoutFocus()),n.props.onAfterClose&&n.props.onAfterClose(),p.default.deregister(n)},n.open=function(){n.beforeOpen(),n.state.afterOpen&&n.state.beforeClose?(clearTimeout(n.closeTimer),n.setState({beforeClose:!1})):(n.props.shouldFocusAfterRender&&(c.setupScopedFocus(n.node),c.markForFocusLater()),n.setState({isOpen:!0},(function(){n.openAnimationFrame=requestAnimationFrame((function(){n.setState({afterOpen:!0}),n.props.isOpen&&n.props.onAfterOpen&&n.props.onAfterOpen({overlayEl:n.overlay,contentEl:n.content})}))})))},n.close=function(){n.props.closeTimeoutMS>0?n.closeWithTimeout():n.closeWithoutTimeout()},n.focusContent=function(){return n.content&&!n.contentHasFocus()&&n.content.focus({preventScroll:!0})},n.closeWithTimeout=function(){var e=Date.now()+n.props.closeTimeoutMS;n.setState({beforeClose:!0,closesAt:e},(function(){n.closeTimer=setTimeout(n.closeWithoutTimeout,n.state.closesAt-Date.now())}))},n.closeWithoutTimeout=function(){n.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},n.afterClose)},n.handleKeyDown=function(e){(function(e){return"Tab"===e.code||9===e.keyCode})(e)&&(0,u.default)(n.content,e),n.props.shouldCloseOnEsc&&function(e){return"Escape"===e.code||27===e.keyCode}(e)&&(e.stopPropagation(),n.requestClose(e))},n.handleOverlayOnClick=function(e){null===n.shouldClose&&(n.shouldClose=!0),n.shouldClose&&n.props.shouldCloseOnOverlayClick&&(n.ownerHandlesClose()?n.requestClose(e):n.focusContent()),n.shouldClose=null},n.handleContentOnMouseUp=function(){n.shouldClose=!1},n.handleOverlayOnMouseDown=function(e){n.props.shouldCloseOnOverlayClick||e.target!=n.overlay||e.preventDefault()},n.handleContentOnClick=function(){n.shouldClose=!1},n.handleContentOnMouseDown=function(){n.shouldClose=!1},n.requestClose=function(e){return n.ownerHandlesClose()&&n.props.onRequestClose(e)},n.ownerHandlesClose=function(){return n.props.onRequestClose},n.shouldBeClosed=function(){return!n.state.isOpen&&!n.state.beforeClose},n.contentHasFocus=function(){return document.activeElement===n.content||n.content.contains(document.activeElement)},n.buildClassName=function(e,t){var r="object"===("undefined"===typeof t?"undefined":i(t))?t:{base:v[e],afterOpen:v[e]+"--after-open",beforeClose:v[e]+"--before-close"},a=r.base;return n.state.afterOpen&&(a=a+" "+r.afterOpen),n.state.beforeClose&&(a=a+" "+r.beforeClose),"string"===typeof t&&t?a+" "+t:a},n.attributesFromObject=function(e,t){return Object.keys(t).reduce((function(n,r){return n[e+"-"+r]=t[r],n}),{})},n.state={afterOpen:!1,beforeClose:!1},n.shouldClose=null,n.moveFromContentToOverlay=null,n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(e,t){this.props.isOpen&&!e.isOpen?this.open():!this.props.isOpen&&e.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!t.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var e=this.props,t=e.appElement,n=e.ariaHideApp,r=e.htmlOpenClassName,i=e.bodyOpenClassName,a=e.parentSelector,o=a&&a().ownerDocument||document;i&&d.add(o.body,i),r&&d.add(o.getElementsByTagName("html")[0],r),n&&(y+=1,l.hide(t)),p.default.register(this)}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.className,i=e.overlayClassName,a=e.defaultStyles,o=e.children,s=n?{}:a.content,c=i?{}:a.overlay;if(this.shouldBeClosed())return null;var u={ref:this.setOverlayRef,className:this.buildClassName("overlay",i),style:r({},c,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},l=r({id:t,ref:this.setContentRef,style:r({},s,this.props.style.content),className:this.buildClassName("content",n),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",r({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),d=this.props.contentElement(l,o);return this.props.overlayElement(u,d)}}]),t}(o.Component);b.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},b.propTypes={isOpen:s.default.bool.isRequired,defaultStyles:s.default.shape({content:s.default.object,overlay:s.default.object}),style:s.default.shape({content:s.default.object,overlay:s.default.object}),className:s.default.oneOfType([s.default.string,s.default.object]),overlayClassName:s.default.oneOfType([s.default.string,s.default.object]),parentSelector:s.default.func,bodyOpenClassName:s.default.string,htmlOpenClassName:s.default.string,ariaHideApp:s.default.bool,appElement:s.default.oneOfType([s.default.instanceOf(h.default),s.default.instanceOf(f.SafeHTMLCollection),s.default.instanceOf(f.SafeNodeList),s.default.arrayOf(s.default.instanceOf(h.default))]),onAfterOpen:s.default.func,onAfterClose:s.default.func,onRequestClose:s.default.func,closeTimeoutMS:s.default.number,shouldFocusAfterRender:s.default.bool,shouldCloseOnOverlayClick:s.default.bool,shouldReturnFocusAfterClose:s.default.bool,preventScroll:s.default.bool,role:s.default.string,contentLabel:s.default.string,aria:s.default.object,data:s.default.object,children:s.default.node,shouldCloseOnEsc:s.default.bool,overlayRef:s.default.func,contentRef:s.default.func,id:s.default.string,overlayElement:s.default.func,contentElement:s.default.func,testId:s.default.string},t.default=b,e.exports=t.default},1497:(e,t,n)=>{"use strict";var r=n(3218);function i(){}function a(){}a.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,a,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:i};return n.PropTypes=n,n}},1551:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){return(0,i.A)(1,arguments),(0,r.default)(e).getMonth()}},1635:function(e,t,n){e.exports=function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i=function(e){try{return!!e()}catch(e){return!0}},a=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),o=a,s=Function.prototype,c=s.call,u=o&&s.bind.bind(c,c),l=o?u:function(e){return function(){return c.apply(e,arguments)}},d=l({}.isPrototypeOf),f=function(e){return e&&e.Math===Math&&e},h=f("object"==typeof globalThis&&globalThis)||f("object"==typeof window&&window)||f("object"==typeof self&&self)||f("object"==typeof t&&t)||f("object"==typeof t&&t)||function(){return this}()||Function("return this")(),p=a,m=Function.prototype,g=m.apply,v=m.call,y="object"==typeof Reflect&&Reflect.apply||(p?v.bind(g):function(){return v.apply(g,arguments)}),b=l,_=b({}.toString),w=b("".slice),E=function(e){return w(_(e),8,-1)},S=E,C=l,x=function(e){if("Function"===S(e))return C(e)},T="object"==typeof document&&document.all,R=void 0===T&&void 0!==T?function(e){return"function"==typeof e||e===T}:function(e){return"function"==typeof e},I={},N=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),A=a,k=Function.prototype.call,D=A?k.bind(k):function(){return k.apply(k,arguments)},M={},L={}.propertyIsEnumerable,O=Object.getOwnPropertyDescriptor,P=O&&!L.call({1:2},1);M.f=P?function(e){var t=O(this,e);return!!t&&t.enumerable}:L;var j,F,U=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},B=i,V=E,z=Object,W=l("".split),G=B((function(){return!z("z").propertyIsEnumerable(0)}))?function(e){return"String"===V(e)?W(e,""):z(e)}:z,H=function(e){return null==e},Y=H,q=TypeError,K=function(e){if(Y(e))throw new q("Can't call method on "+e);return e},X=G,Q=K,J=function(e){return X(Q(e))},Z=R,$=function(e){return"object"==typeof e?null!==e:Z(e)},ee={},te=ee,ne=h,re=R,ie=function(e){return re(e)?e:void 0},ae=function(e,t){return arguments.length<2?ie(te[e])||ie(ne[e]):te[e]&&te[e][t]||ne[e]&&ne[e][t]},oe=h.navigator,se=oe&&oe.userAgent,ce=se?String(se):"",ue=h,le=ce,de=ue.process,fe=ue.Deno,he=de&&de.versions||fe&&fe.version,pe=he&&he.v8;pe&&(F=(j=pe.split("."))[0]>0&&j[0]<4?1:+(j[0]+j[1])),!F&&le&&(!(j=le.match(/Edge\/(\d+)/))||j[1]>=74)&&(j=le.match(/Chrome\/(\d+)/))&&(F=+j[1]);var me=F,ge=me,ve=i,ye=h.String,be=!!Object.getOwnPropertySymbols&&!ve((function(){var e=Symbol("symbol detection");return!ye(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ge&&ge<41})),_e=be&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,we=ae,Ee=R,Se=d,Ce=Object,xe=_e?function(e){return"symbol"==typeof e}:function(e){var t=we("Symbol");return Ee(t)&&Se(t.prototype,Ce(e))},Te=String,Re=function(e){try{return Te(e)}catch(e){return"Object"}},Ie=R,Ne=Re,Ae=TypeError,ke=function(e){if(Ie(e))return e;throw new Ae(Ne(e)+" is not a function")},De=ke,Me=H,Le=function(e,t){var n=e[t];return Me(n)?void 0:De(n)},Oe=D,Pe=R,je=$,Fe=TypeError,Ue={exports:{}},Be=h,Ve=Object.defineProperty,ze=h,We=function(e,t){try{Ve(Be,e,{value:t,configurable:!0,writable:!0})}catch(r){Be[e]=t}return t},Ge="__core-js_shared__",He=Ue.exports=ze[Ge]||We(Ge,{});(He.versions||(He.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"\xa9 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Ye=Ue.exports,qe=Ye,Ke=function(e,t){return qe[e]||(qe[e]=t||{})},Xe=K,Qe=Object,Je=function(e){return Qe(Xe(e))},Ze=Je,$e=l({}.hasOwnProperty),et=Object.hasOwn||function(e,t){return $e(Ze(e),t)},tt=l,nt=0,rt=Math.random(),it=tt(1..toString),at=function(e){return"Symbol("+(void 0===e?"":e)+")_"+it(++nt+rt,36)},ot=Ke,st=et,ct=at,ut=be,lt=_e,dt=h.Symbol,ft=ot("wks"),ht=lt?dt.for||dt:dt&&dt.withoutSetter||ct,pt=function(e){return st(ft,e)||(ft[e]=ut&&st(dt,e)?dt[e]:ht("Symbol."+e)),ft[e]},mt=D,gt=$,vt=xe,yt=Le,bt=function(e,t){var n,r;if("string"===t&&Pe(n=e.toString)&&!je(r=Oe(n,e)))return r;if(Pe(n=e.valueOf)&&!je(r=Oe(n,e)))return r;if("string"!==t&&Pe(n=e.toString)&&!je(r=Oe(n,e)))return r;throw new Fe("Can't convert object to primitive value")},_t=TypeError,wt=pt("toPrimitive"),Et=function(e,t){if(!gt(e)||vt(e))return e;var n,r=yt(e,wt);if(r){if(void 0===t&&(t="default"),n=mt(r,e,t),!gt(n)||vt(n))return n;throw new _t("Can't convert object to primitive value")}return void 0===t&&(t="number"),bt(e,t)},St=xe,Ct=function(e){var t=Et(e,"string");return St(t)?t:t+""},xt=$,Tt=h.document,Rt=xt(Tt)&&xt(Tt.createElement),It=function(e){return Rt?Tt.createElement(e):{}},Nt=It,At=!N&&!i((function(){return 7!==Object.defineProperty(Nt("div"),"a",{get:function(){return 7}}).a})),kt=N,Dt=D,Mt=M,Lt=U,Ot=J,Pt=Ct,jt=et,Ft=At,Ut=Object.getOwnPropertyDescriptor;I.f=kt?Ut:function(e,t){if(e=Ot(e),t=Pt(t),Ft)try{return Ut(e,t)}catch(e){}if(jt(e,t))return Lt(!Dt(Mt.f,e,t),e[t])};var Bt=i,Vt=R,zt=/#|\.prototype\./,Wt=function(e,t){var n=Ht[Gt(e)];return n===qt||n!==Yt&&(Vt(t)?Bt(t):!!t)},Gt=Wt.normalize=function(e){return String(e).replace(zt,".").toLowerCase()},Ht=Wt.data={},Yt=Wt.NATIVE="N",qt=Wt.POLYFILL="P",Kt=Wt,Xt=ke,Qt=a,Jt=x(x.bind),Zt=function(e,t){return Xt(e),void 0===t?e:Qt?Jt(e,t):function(){return e.apply(t,arguments)}},$t={},en=N&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),tn=$,nn=String,rn=TypeError,an=function(e){if(tn(e))return e;throw new rn(nn(e)+" is not an object")},on=N,sn=At,cn=en,un=an,ln=Ct,dn=TypeError,fn=Object.defineProperty,hn=Object.getOwnPropertyDescriptor,pn="enumerable",mn="configurable",gn="writable";$t.f=on?cn?function(e,t,n){if(un(e),t=ln(t),un(n),"function"==typeof e&&"prototype"===t&&"value"in n&&gn in n&&!n[gn]){var r=hn(e,t);r&&r[gn]&&(e[t]=n.value,n={configurable:mn in n?n[mn]:r[mn],enumerable:pn in n?n[pn]:r[pn],writable:!1})}return fn(e,t,n)}:fn:function(e,t,n){if(un(e),t=ln(t),un(n),sn)try{return fn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new dn("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var vn=$t,yn=U,bn=N?function(e,t,n){return vn.f(e,t,yn(1,n))}:function(e,t,n){return e[t]=n,e},_n=h,wn=y,En=x,Sn=R,Cn=I.f,xn=Kt,Tn=ee,Rn=Zt,In=bn,Nn=et,An=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return wn(e,this,arguments)};return t.prototype=e.prototype,t},kn=function(e,t){var n,r,i,a,o,s,c,u,l,d=e.target,f=e.global,h=e.stat,p=e.proto,m=f?_n:h?_n[d]:_n[d]&&_n[d].prototype,g=f?Tn:Tn[d]||In(Tn,d,{})[d],v=g.prototype;for(a in t)r=!(n=xn(f?a:d+(h?".":"#")+a,e.forced))&&m&&Nn(m,a),s=g[a],r&&(c=e.dontCallGetSet?(l=Cn(m,a))&&l.value:m[a]),o=r&&c?c:t[a],(n||p||typeof s!=typeof o)&&(u=e.bind&&r?Rn(o,_n):e.wrap&&r?An(o):p&&Sn(o)?En(o):o,(e.sham||o&&o.sham||s&&s.sham)&&In(u,"sham",!0),In(g,a,u),p&&(Nn(Tn,i=d+"Prototype")||In(Tn,i,{}),In(Tn[i],a,o),e.real&&v&&(n||!v[a])&&In(v,a,o)))},Dn=Math.ceil,Mn=Math.floor,Ln=Math.trunc||function(e){var t=+e;return(t>0?Mn:Dn)(t)},On=Ln,Pn=function(e){var t=+e;return t!=t||0===t?0:On(t)},jn=Pn,Fn=Math.max,Un=Math.min,Bn=function(e,t){var n=jn(e);return n<0?Fn(n+t,0):Un(n,t)},Vn=Pn,zn=Math.min,Wn=function(e){var t=Vn(e);return t>0?zn(t,9007199254740991):0},Gn=Wn,Hn=function(e){return Gn(e.length)},Yn=J,qn=Bn,Kn=Hn,Xn=function(e){return function(t,n,r){var i=Yn(t),a=Kn(i);if(0===a)return!e&&-1;var o,s=qn(r,a);if(e&&n!=n){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((e||s in i)&&i[s]===n)return e||s||0;return!e&&-1}},Qn={includes:Xn(!0),indexOf:Xn(!1)},Jn=Qn.includes;kn({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return Jn(this,e,arguments.length>1?arguments[1]:void 0)}});var Zn=h,$n=ee,er=function(e,t){var n=$n[e+"Prototype"],r=n&&n[t];if(r)return r;var i=Zn[e],a=i&&i.prototype;return a&&a[t]},tr=er("Array","includes"),nr=$,rr=E,ir=pt("match"),ar=function(e){var t;return nr(e)&&(void 0!==(t=e[ir])?!!t:"RegExp"===rr(e))},or=ar,sr=TypeError,cr={};cr[pt("toStringTag")]="z";var ur="[object z]"===String(cr),lr=ur,dr=R,fr=E,hr=pt("toStringTag"),pr=Object,mr="Arguments"===fr(function(){return arguments}()),gr=lr?fr:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=pr(e),hr))?n:mr?fr(t):"Object"===(r=fr(t))&&dr(t.callee)?"Arguments":r},vr=gr,yr=String,br=function(e){if("Symbol"===vr(e))throw new TypeError("Cannot convert a Symbol value to a string");return yr(e)},_r=pt("match"),wr=kn,Er=function(e){if(or(e))throw new sr("The method doesn't accept regular expressions");return e},Sr=K,Cr=br,xr=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[_r]=!1,"/./"[e](t)}catch(e){}}return!1},Tr=l("".indexOf);wr({target:"String",proto:!0,forced:!xr("includes")},{includes:function(e){return!!~Tr(Cr(Sr(this)),Cr(Er(e)),arguments.length>1?arguments[1]:void 0)}});var Rr=er("String","includes"),Ir=d,Nr=tr,Ar=Rr,kr=Array.prototype,Dr=String.prototype,Mr=function(e){var t=e.includes;return e===kr||Ir(kr,e)&&t===kr.includes?Nr:"string"==typeof e||e===Dr||Ir(Dr,e)&&t===Dr.includes?Ar:t},Lr=r(Mr),Or=ke,Pr=Je,jr=G,Fr=Hn,Ur=TypeError,Br="Reduce of empty array with no initial value",Vr=function(e){return function(t,n,r,i){var a=Pr(t),o=jr(a),s=Fr(a);if(Or(n),0===s&&r<2)throw new Ur(Br);var c=e?s-1:0,u=e?-1:1;if(r<2)for(;;){if(c in o){i=o[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw new Ur(Br)}for(;e?c>=0:s>c;c+=u)c in o&&(i=n(i,o[c],c,a));return i}},zr={left:Vr(!1),right:Vr(!0)},Wr=i,Gr=function(e,t){var n=[][e];return!!n&&Wr((function(){n.call(null,t||function(){return 1},1)}))},Hr=h,Yr=ce,qr=E,Kr=function(e){return Yr.slice(0,e.length)===e},Xr=Kr("Bun/")?"BUN":Kr("Cloudflare-Workers")?"CLOUDFLARE":Kr("Deno/")?"DENO":Kr("Node.js/")?"NODE":Hr.Bun&&"string"==typeof Bun.version?"BUN":Hr.Deno&&"object"==typeof Deno.version?"DENO":"process"===qr(Hr.process)?"NODE":Hr.window&&Hr.document?"BROWSER":"REST",Qr="NODE"===Xr,Jr=zr.left;kn({target:"Array",proto:!0,forced:!Qr&&me>79&&me<83||!Gr("reduce")},{reduce:function(e){var t=arguments.length;return Jr(this,e,t,t>1?arguments[1]:void 0)}});var Zr=er("Array","reduce"),$r=d,ei=Zr,ti=Array.prototype,ni=function(e){var t=e.reduce;return e===ti||$r(ti,e)&&t===ti.reduce?ei:t},ri=ni,ii=r(ri),ai=E,oi=Array.isArray||function(e){return"Array"===ai(e)},si=kn,ci=oi,ui=l([].reverse),li=[1,2];si({target:"Array",proto:!0,forced:String(li)===String(li.reverse())},{reverse:function(){return ci(this)&&(this.length=this.length),ui(this)}});var di=er("Array","reverse"),fi=d,hi=di,pi=Array.prototype,mi=function(e){var t=e.reverse;return e===pi||fi(pi,e)&&t===pi.reverse?hi:t},gi=mi,vi=r(gi),yi=at,bi=Ke("keys"),_i=function(e){return bi[e]||(bi[e]=yi(e))},wi=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Ei=et,Si=R,Ci=Je,xi=wi,Ti=_i("IE_PROTO"),Ri=Object,Ii=Ri.prototype,Ni=xi?Ri.getPrototypeOf:function(e){var t=Ci(e);if(Ei(t,Ti))return t[Ti];var n=t.constructor;return Si(n)&&t instanceof n?n.prototype:t instanceof Ri?Ii:null},Ai=l,ki=ke,Di=$,Mi=function(e){return Di(e)||null===e},Li=String,Oi=TypeError,Pi=function(e,t,n){try{return Ai(ki(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}},ji=$,Fi=K,Ui=function(e){if(Mi(e))return e;throw new Oi("Can't set "+Li(e)+" as a prototype")},Bi=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Pi(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Fi(n),Ui(r),ji(n)?(t?e(n,r):n.__proto__=r,n):n}}():void 0),Vi={},zi={},Wi=et,Gi=J,Hi=Qn.indexOf,Yi=zi,qi=l([].push),Ki=function(e,t){var n,r=Gi(e),i=0,a=[];for(n in r)!Wi(Yi,n)&&Wi(r,n)&&qi(a,n);for(;t.length>i;)Wi(r,n=t[i++])&&(~Hi(a,n)||qi(a,n));return a},Xi=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Qi=Ki,Ji=Xi.concat("length","prototype");Vi.f=Object.getOwnPropertyNames||function(e){return Qi(e,Ji)};var Zi={};Zi.f=Object.getOwnPropertySymbols;var $i=ae,ea=Vi,ta=Zi,na=an,ra=l([].concat),ia=$i("Reflect","ownKeys")||function(e){var t=ea.f(na(e)),n=ta.f;return n?ra(t,n(e)):t},aa=et,oa=ia,sa=I,ca=$t,ua={},la=Ki,da=Xi,fa=Object.keys||function(e){return la(e,da)},ha=N,pa=en,ma=$t,ga=an,va=J,ya=fa;ua.f=ha&&!pa?Object.defineProperties:function(e,t){ga(e);for(var n,r=va(t),i=ya(t),a=i.length,o=0;a>o;)ma.f(e,n=i[o++],r[n]);return e};var ba,_a=ae("document","documentElement"),wa=an,Ea=ua,Sa=Xi,Ca=zi,xa=_a,Ta=It,Ra="prototype",Ia="script",Na=_i("IE_PROTO"),Aa=function(){},ka=function(e){return"<"+Ia+">"+e+"</"+Ia+">"},Da=function(e){e.write(ka("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ma=function(){try{ba=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;Ma="undefined"!=typeof document?document.domain&&ba?Da(ba):(t=Ta("iframe"),n="java"+Ia+":",t.style.display="none",xa.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(ka("document.F=Object")),e.close(),e.F):Da(ba);for(var r=Sa.length;r--;)delete Ma[Ra][Sa[r]];return Ma()};Ca[Na]=!0;var La=Object.create||function(e,t){var n;return null!==e?(Aa[Ra]=wa(e),n=new Aa,Aa[Ra]=null,n[Na]=e):n=Ma(),void 0===t?n:Ea.f(n,t)},Oa=$,Pa=bn,ja=Error,Fa=l("".replace),Ua=String(new ja("zxcasd").stack),Ba=/\n\s*at [^:]*:[^\n]*/,Va=Ba.test(Ua),za=U,Wa=!i((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",za(1,7)),7!==e.stack)})),Ga=bn,Ha=function(e,t){if(Va&&"string"==typeof e&&!ja.prepareStackTrace)for(;t--;)e=Fa(e,Ba,"");return e},Ya=Wa,qa=Error.captureStackTrace,Ka={},Xa=Ka,Qa=pt("iterator"),Ja=Array.prototype,Za=function(e){return void 0!==e&&(Xa.Array===e||Ja[Qa]===e)},$a=gr,eo=Le,to=H,no=Ka,ro=pt("iterator"),io=function(e){if(!to(e))return eo(e,ro)||eo(e,"@@iterator")||no[$a(e)]},ao=D,oo=ke,so=an,co=Re,uo=io,lo=TypeError,fo=function(e,t){var n=arguments.length<2?uo(e):t;if(oo(n))return so(ao(n,e));throw new lo(co(e)+" is not iterable")},ho=D,po=an,mo=Le,go=function(e,t,n){var r,i;po(e);try{if(!(r=mo(e,"return"))){if("throw"===t)throw n;return n}r=ho(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return po(r),n},vo=Zt,yo=D,bo=an,_o=Re,wo=Za,Eo=Hn,So=d,Co=fo,xo=io,To=go,Ro=TypeError,Io=function(e,t){this.stopped=e,this.result=t},No=Io.prototype,Ao=function(e,t,n){var r,i,a,o,s,c,u,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_RECORD),h=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),m=vo(t,l),g=function(e){return r&&To(r,"normal",e),new Io(!0,e)},v=function(e){return d?(bo(e),p?m(e[0],e[1],g):m(e[0],e[1])):p?m(e,g):m(e)};if(f)r=e.iterator;else if(h)r=e;else{if(!(i=xo(e)))throw new Ro(_o(e)+" is not iterable");if(wo(i)){for(a=0,o=Eo(e);o>a;a++)if((s=v(e[a]))&&So(No,s))return s;return new Io(!1)}r=Co(e,i)}for(c=f?e.next:r.next;!(u=yo(c,r)).done;){try{s=v(u.value)}catch(e){To(r,"throw",e)}if("object"==typeof s&&s&&So(No,s))return s}return new Io(!1)},ko=br,Do=kn,Mo=d,Lo=Ni,Oo=Bi,Po=function(e,t,n){for(var r=oa(t),i=ca.f,a=sa.f,o=0;o<r.length;o++){var s=r[o];aa(e,s)||n&&aa(n,s)||i(e,s,a(t,s))}},jo=La,Fo=bn,Uo=U,Bo=function(e,t){Oa(t)&&"cause"in t&&Pa(e,"cause",t.cause)},Vo=function(e,t,n,r){Ya&&(qa?qa(e,t):Ga(e,"stack",Ha(n,r)))},zo=Ao,Wo=function(e,t){return void 0===e?arguments.length<2?"":t:ko(e)},Go=pt("toStringTag"),Ho=Error,Yo=[].push,qo=function(e,t){var n,r=Mo(Ko,this);Oo?n=Oo(new Ho,r?Lo(this):Ko):(n=r?this:jo(Ko),Fo(n,Go,"Error")),void 0!==t&&Fo(n,"message",Wo(t)),Vo(n,qo,n.stack,1),arguments.length>2&&Bo(n,arguments[2]);var i=[];return zo(e,Yo,{that:i}),Fo(n,"errors",i),n};Oo?Oo(qo,Ho):Po(qo,Ho,{name:!0});var Ko=qo.prototype=jo(Ho.prototype,{constructor:Uo(1,qo),message:Uo(1,""),name:Uo(1,"AggregateError")});Do({global:!0,constructor:!0,arity:2},{AggregateError:qo});var Xo,Qo,Jo,Zo=R,$o=h.WeakMap,es=Zo($o)&&/native code/.test(String($o)),ts=h,ns=$,rs=bn,is=et,as=Ye,os=_i,ss=zi,cs="Object already initialized",us=ts.TypeError,ls=ts.WeakMap;if(es||as.state){var ds=as.state||(as.state=new ls);ds.get=ds.get,ds.has=ds.has,ds.set=ds.set,Xo=function(e,t){if(ds.has(e))throw new us(cs);return t.facade=e,ds.set(e,t),t},Qo=function(e){return ds.get(e)||{}},Jo=function(e){return ds.has(e)}}else{var fs=os("state");ss[fs]=!0,Xo=function(e,t){if(is(e,fs))throw new us(cs);return t.facade=e,rs(e,fs,t),t},Qo=function(e){return is(e,fs)?e[fs]:{}},Jo=function(e){return is(e,fs)}}var hs,ps,ms,gs={set:Xo,get:Qo,has:Jo,enforce:function(e){return Jo(e)?Qo(e):Xo(e,{})},getterFor:function(e){return function(t){var n;if(!ns(t)||(n=Qo(t)).type!==e)throw new us("Incompatible receiver, "+e+" required");return n}}},vs=N,ys=et,bs=Function.prototype,_s=vs&&Object.getOwnPropertyDescriptor,ws=ys(bs,"name"),Es={EXISTS:ws,PROPER:ws&&"something"===function(){}.name,CONFIGURABLE:ws&&(!vs||vs&&_s(bs,"name").configurable)},Ss=bn,Cs=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Ss(e,t,n),e},xs=i,Ts=R,Rs=$,Is=La,Ns=Ni,As=Cs,ks=pt("iterator"),Ds=!1;[].keys&&("next"in(ms=[].keys())?(ps=Ns(Ns(ms)))!==Object.prototype&&(hs=ps):Ds=!0);var Ms=!Rs(hs)||xs((function(){var e={};return hs[ks].call(e)!==e}));Ts((hs=Ms?{}:Is(hs))[ks])||As(hs,ks,(function(){return this}));var Ls={IteratorPrototype:hs,BUGGY_SAFARI_ITERATORS:Ds},Os=gr,Ps=ur?{}.toString:function(){return"[object "+Os(this)+"]"},js=ur,Fs=$t.f,Us=bn,Bs=et,Vs=Ps,zs=pt("toStringTag"),Ws=function(e,t,n,r){var i=n?e:e&&e.prototype;i&&(Bs(i,zs)||Fs(i,zs,{configurable:!0,value:t}),r&&!js&&Us(i,"toString",Vs))},Gs=Ls.IteratorPrototype,Hs=La,Ys=U,qs=Ws,Ks=Ka,Xs=function(){return this},Qs=function(e,t,n,r){var i=t+" Iterator";return e.prototype=Hs(Gs,{next:Ys(+!r,n)}),qs(e,i,!1,!0),Ks[i]=Xs,e},Js=kn,Zs=D,$s=Qs,ec=Ni,tc=Ws,nc=Cs,rc=Ka,ic=Ls,ac=Es.PROPER,oc=ic.BUGGY_SAFARI_ITERATORS,sc=pt("iterator"),cc="keys",uc="values",lc="entries",dc=function(){return this},fc=function(e,t,n,r,i,a,o){$s(n,t,r);var s,c,u,l=function(e){if(e===i&&m)return m;if(!oc&&e&&e in h)return h[e];switch(e){case cc:case uc:case lc:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",f=!1,h=e.prototype,p=h[sc]||h["@@iterator"]||i&&h[i],m=!oc&&p||l(i),g="Array"===t&&h.entries||p;if(g&&(s=ec(g.call(new e)))!==Object.prototype&&s.next&&(tc(s,d,!0,!0),rc[d]=dc),ac&&i===uc&&p&&p.name!==uc&&(f=!0,m=function(){return Zs(p,this)}),i)if(c={values:l(uc),keys:a?m:l(cc),entries:l(lc)},o)for(u in c)(oc||f||!(u in h))&&nc(h,u,c[u]);else Js({target:t,proto:!0,forced:oc||f},c);return o&&h[sc]!==m&&nc(h,sc,m,{name:i}),rc[t]=m,c},hc=function(e,t){return{value:e,done:t}},pc=J,mc=Ka,gc=gs;$t.f;var vc=fc,yc=hc,bc="Array Iterator",_c=gc.set,wc=gc.getterFor(bc);vc(Array,"Array",(function(e,t){_c(this,{type:bc,target:pc(e),index:0,kind:t})}),(function(){var e=wc(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,yc(void 0,!0);switch(e.kind){case"keys":return yc(n,!1);case"values":return yc(t[n],!1)}return yc([n,t[n]],!1)}),"values"),mc.Arguments=mc.Array;var Ec=$t,Sc=function(e,t,n){return Ec.f(e,t,n)},Cc=ae,xc=Sc,Tc=N,Rc=pt("species"),Ic=d,Nc=TypeError,Ac=function(e,t){if(Ic(t,e))return e;throw new Nc("Incorrect invocation")},kc=R,Dc=Ye,Mc=l(Function.toString);kc(Dc.inspectSource)||(Dc.inspectSource=function(e){return Mc(e)});var Lc=Dc.inspectSource,Oc=l,Pc=i,jc=R,Fc=gr,Uc=Lc,Bc=function(){},Vc=ae("Reflect","construct"),zc=/^\s*(?:class|function)\b/,Wc=Oc(zc.exec),Gc=!zc.test(Bc),Hc=function(e){if(!jc(e))return!1;try{return Vc(Bc,[],e),!0}catch(e){return!1}},Yc=function(e){if(!jc(e))return!1;switch(Fc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Gc||!!Wc(zc,Uc(e))}catch(e){return!0}};Yc.sham=!0;var qc,Kc,Xc,Qc,Jc=!Vc||Pc((function(){var e;return Hc(Hc.call)||!Hc(Object)||!Hc((function(){e=!0}))||e}))?Yc:Hc,Zc=Jc,$c=Re,eu=TypeError,tu=an,nu=function(e){if(Zc(e))return e;throw new eu($c(e)+" is not a constructor")},ru=H,iu=pt("species"),au=function(e,t){var n,r=tu(e).constructor;return void 0===r||ru(n=tu(r)[iu])?t:nu(n)},ou=l([].slice),su=TypeError,cu=function(e,t){if(e<t)throw new su("Not enough arguments");return e},uu=/(?:ipad|iphone|ipod).*applewebkit/i.test(ce),lu=h,du=y,fu=Zt,hu=R,pu=et,mu=i,gu=_a,vu=ou,yu=It,bu=cu,_u=uu,wu=Qr,Eu=lu.setImmediate,Su=lu.clearImmediate,Cu=lu.process,xu=lu.Dispatch,Tu=lu.Function,Ru=lu.MessageChannel,Iu=lu.String,Nu=0,Au={},ku="onreadystatechange";mu((function(){qc=lu.location}));var Du=function(e){if(pu(Au,e)){var t=Au[e];delete Au[e],t()}},Mu=function(e){return function(){Du(e)}},Lu=function(e){Du(e.data)},Ou=function(e){lu.postMessage(Iu(e),qc.protocol+"//"+qc.host)};Eu&&Su||(Eu=function(e){bu(arguments.length,1);var t=hu(e)?e:Tu(e),n=vu(arguments,1);return Au[++Nu]=function(){du(t,void 0,n)},Kc(Nu),Nu},Su=function(e){delete Au[e]},wu?Kc=function(e){Cu.nextTick(Mu(e))}:xu&&xu.now?Kc=function(e){xu.now(Mu(e))}:Ru&&!_u?(Qc=(Xc=new Ru).port2,Xc.port1.onmessage=Lu,Kc=fu(Qc.postMessage,Qc)):lu.addEventListener&&hu(lu.postMessage)&&!lu.importScripts&&qc&&"file:"!==qc.protocol&&!mu(Ou)?(Kc=Ou,lu.addEventListener("message",Lu,!1)):Kc=ku in yu("script")?function(e){gu.appendChild(yu("script"))[ku]=function(){gu.removeChild(this),Du(e)}}:function(e){setTimeout(Mu(e),0)});var Pu={set:Eu,clear:Su},ju=h,Fu=N,Uu=Object.getOwnPropertyDescriptor,Bu=function(e){if(!Fu)return ju[e];var t=Uu(ju,e);return t&&t.value},Vu=function(){this.head=null,this.tail=null};Vu.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var zu,Wu,Gu,Hu,Yu,qu=Vu,Ku=/ipad|iphone|ipod/i.test(ce)&&"undefined"!=typeof Pebble,Xu=/web0s(?!.*chrome)/i.test(ce),Qu=h,Ju=Bu,Zu=Zt,$u=Pu.set,el=qu,tl=uu,nl=Ku,rl=Xu,il=Qr,al=Qu.MutationObserver||Qu.WebKitMutationObserver,ol=Qu.document,sl=Qu.process,cl=Qu.Promise,ul=Ju("queueMicrotask");if(!ul){var ll=new el,dl=function(){var e,t;for(il&&(e=sl.domain)&&e.exit();t=ll.get();)try{t()}catch(e){throw ll.head&&zu(),e}e&&e.enter()};tl||il||rl||!al||!ol?!nl&&cl&&cl.resolve?((Hu=cl.resolve(void 0)).constructor=cl,Yu=Zu(Hu.then,Hu),zu=function(){Yu(dl)}):il?zu=function(){sl.nextTick(dl)}:($u=Zu($u,Qu),zu=function(){$u(dl)}):(Wu=!0,Gu=ol.createTextNode(""),new al(dl).observe(Gu,{characterData:!0}),zu=function(){Gu.data=Wu=!Wu}),ul=function(e){ll.head||zu(),ll.add(e)}}var fl=ul,hl=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},pl=h.Promise,ml=h,gl=pl,vl=R,yl=Kt,bl=Lc,_l=pt,wl=Xr,El=me,Sl=gl&&gl.prototype,Cl=_l("species"),xl=!1,Tl=vl(ml.PromiseRejectionEvent),Rl=yl("Promise",(function(){var e=bl(gl),t=e!==String(gl);if(!t&&66===El)return!0;if(!Sl.catch||!Sl.finally)return!0;if(!El||El<51||!/native code/.test(e)){var n=new gl((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[Cl]=r,!(xl=n.then((function(){}))instanceof r))return!0}return!(t||"BROWSER"!==wl&&"DENO"!==wl||Tl)})),Il={CONSTRUCTOR:Rl,REJECTION_EVENT:Tl,SUBCLASSING:xl},Nl={},Al=ke,kl=TypeError,Dl=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw new kl("Bad Promise constructor");t=e,n=r})),this.resolve=Al(t),this.reject=Al(n)};Nl.f=function(e){return new Dl(e)};var Ml,Ll,Ol=kn,Pl=Qr,jl=h,Fl=D,Ul=Cs,Bl=Ws,Vl=function(e){var t=Cc(e);Tc&&t&&!t[Rc]&&xc(t,Rc,{configurable:!0,get:function(){return this}})},zl=ke,Wl=R,Gl=$,Hl=Ac,Yl=au,ql=Pu.set,Kl=fl,Xl=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}},Ql=hl,Jl=qu,Zl=gs,$l=pl,ed=Il,td=Nl,nd="Promise",rd=ed.CONSTRUCTOR,id=ed.REJECTION_EVENT,ad=Zl.getterFor(nd),od=Zl.set,sd=$l&&$l.prototype,cd=$l,ud=sd,ld=jl.TypeError,dd=jl.document,fd=jl.process,hd=td.f,pd=hd,md=!!(dd&&dd.createEvent&&jl.dispatchEvent),gd="unhandledrejection",vd=function(e){var t;return!(!Gl(e)||!Wl(t=e.then))&&t},yd=function(e,t){var n,r,i,a=t.value,o=1===t.state,s=o?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(o||(2===t.rejection&&Sd(t),t.rejection=1),!0===s?n=a:(l&&l.enter(),n=s(a),l&&(l.exit(),i=!0)),n===e.promise?u(new ld("Promise-chain cycle")):(r=vd(n))?Fl(r,n,c,u):c(n)):u(a)}catch(e){l&&!i&&l.exit(),u(e)}},bd=function(e,t){e.notified||(e.notified=!0,Kl((function(){for(var n,r=e.reactions;n=r.get();)yd(n,e);e.notified=!1,t&&!e.rejection&&wd(e)})))},_d=function(e,t,n){var r,i;md?((r=dd.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),jl.dispatchEvent(r)):r={promise:t,reason:n},!id&&(i=jl["on"+e])?i(r):e===gd&&Xl("Unhandled promise rejection",n)},wd=function(e){Fl(ql,jl,(function(){var t,n=e.facade,r=e.value;if(Ed(e)&&(t=Ql((function(){Pl?fd.emit("unhandledRejection",r,n):_d(gd,n,r)})),e.rejection=Pl||Ed(e)?2:1,t.error))throw t.value}))},Ed=function(e){return 1!==e.rejection&&!e.parent},Sd=function(e){Fl(ql,jl,(function(){var t=e.facade;Pl?fd.emit("rejectionHandled",t):_d("rejectionhandled",t,e.value)}))},Cd=function(e,t,n){return function(r){e(t,r,n)}},xd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,bd(e,!0))},Td=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new ld("Promise can't be resolved itself");var r=vd(t);r?Kl((function(){var n={done:!1};try{Fl(r,t,Cd(Td,n,e),Cd(xd,n,e))}catch(t){xd(n,t,e)}})):(e.value=t,e.state=1,bd(e,!1))}catch(t){xd({done:!1},t,e)}}};rd&&(ud=(cd=function(e){Hl(this,ud),zl(e),Fl(Ml,this);var t=ad(this);try{e(Cd(Td,t),Cd(xd,t))}catch(e){xd(t,e)}}).prototype,(Ml=function(e){od(this,{type:nd,done:!1,notified:!1,parent:!1,reactions:new Jl,rejection:!1,state:0,value:null})}).prototype=Ul(ud,"then",(function(e,t){var n=ad(this),r=hd(Yl(this,cd));return n.parent=!0,r.ok=!Wl(e)||e,r.fail=Wl(t)&&t,r.domain=Pl?fd.domain:void 0,0===n.state?n.reactions.add(r):Kl((function(){yd(r,n)})),r.promise})),Ll=function(){var e=new Ml,t=ad(e);this.promise=e,this.resolve=Cd(Td,t),this.reject=Cd(xd,t)},td.f=hd=function(e){return e===cd||void 0===e?new Ll(e):pd(e)}),Ol({global:!0,constructor:!0,wrap:!0,forced:rd},{Promise:cd}),Bl(cd,nd,!1,!0),Vl(nd);var Rd=pt("iterator"),Id=!1;try{var Nd=0,Ad={next:function(){return{done:!!Nd++}},return:function(){Id=!0}};Ad[Rd]=function(){return this},Array.from(Ad,(function(){throw 2}))}catch(e){}var kd=pl,Dd=function(e,t){try{if(!t&&!Id)return!1}catch(e){return!1}var n=!1;try{var r={};r[Rd]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Md=Il.CONSTRUCTOR||!Dd((function(e){kd.all(e).then(void 0,(function(){}))})),Ld=D,Od=ke,Pd=Nl,jd=hl,Fd=Ao;kn({target:"Promise",stat:!0,forced:Md},{all:function(e){var t=this,n=Pd.f(t),r=n.resolve,i=n.reject,a=jd((function(){var n=Od(t.resolve),a=[],o=0,s=1;Fd(e,(function(e){var c=o++,u=!1;s++,Ld(n,t,e).then((function(e){u||(u=!0,a[c]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise}});var Ud=kn,Bd=Il.CONSTRUCTOR;pl&&pl.prototype,Ud({target:"Promise",proto:!0,forced:Bd,real:!0},{catch:function(e){return this.then(void 0,e)}});var Vd=D,zd=ke,Wd=Nl,Gd=hl,Hd=Ao;kn({target:"Promise",stat:!0,forced:Md},{race:function(e){var t=this,n=Wd.f(t),r=n.reject,i=Gd((function(){var i=zd(t.resolve);Hd(e,(function(e){Vd(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Yd=Nl;kn({target:"Promise",stat:!0,forced:Il.CONSTRUCTOR},{reject:function(e){var t=Yd.f(this);return(0,t.reject)(e),t.promise}});var qd=an,Kd=$,Xd=Nl,Qd=function(e,t){if(qd(e),Kd(t)&&t.constructor===e)return t;var n=Xd.f(e);return(0,n.resolve)(t),n.promise},Jd=kn,Zd=pl,$d=Il.CONSTRUCTOR,ef=Qd,tf=ae("Promise"),nf=!$d;Jd({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return ef(nf&&this===tf?Zd:this,e)}});var rf=D,af=ke,of=Nl,sf=hl,cf=Ao;kn({target:"Promise",stat:!0,forced:Md},{allSettled:function(e){var t=this,n=of.f(t),r=n.resolve,i=n.reject,a=sf((function(){var n=af(t.resolve),i=[],a=0,o=1;cf(e,(function(e){var s=a++,c=!1;o++,rf(n,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--o||r(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--o||r(i))}))})),--o||r(i)}));return a.error&&i(a.value),n.promise}});var uf=D,lf=ke,df=ae,ff=Nl,hf=hl,pf=Ao,mf="No one promise resolved";kn({target:"Promise",stat:!0,forced:Md},{any:function(e){var t=this,n=df("AggregateError"),r=ff.f(t),i=r.resolve,a=r.reject,o=hf((function(){var r=lf(t.resolve),o=[],s=0,c=1,u=!1;pf(e,(function(e){var l=s++,d=!1;c++,uf(r,t,e).then((function(e){d||u||(u=!0,i(e))}),(function(e){d||u||(d=!0,o[l]=e,--c||a(new n(o,mf)))}))})),--c||a(new n(o,mf))}));return o.error&&a(o.value),r.promise}});var gf=kn,vf=y,yf=ou,bf=Nl,_f=ke,wf=hl,Ef=h.Promise,Sf=!1;gf({target:"Promise",stat:!0,forced:!Ef||!Ef.try||wf((function(){Ef.try((function(e){Sf=8===e}),8)})).error||!Sf},{try:function(e){var t=arguments.length>1?yf(arguments,1):[],n=bf.f(this),r=wf((function(){return vf(_f(e),void 0,t)}));return(r.error?n.reject:n.resolve)(r.value),n.promise}});var Cf=Nl;kn({target:"Promise",stat:!0},{withResolvers:function(){var e=Cf.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var xf=kn,Tf=pl,Rf=i,If=ae,Nf=R,Af=au,kf=Qd,Df=Tf&&Tf.prototype;xf({target:"Promise",proto:!0,real:!0,forced:!!Tf&&Rf((function(){Df.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=Af(this,If("Promise")),n=Nf(e);return this.then(n?function(n){return kf(t,e()).then((function(){return n}))}:e,n?function(n){return kf(t,e()).then((function(){throw n}))}:e)}});var Mf=l,Lf=Pn,Of=br,Pf=K,jf=Mf("".charAt),Ff=Mf("".charCodeAt),Uf=Mf("".slice),Bf=function(e){return function(t,n){var r,i,a=Of(Pf(t)),o=Lf(n),s=a.length;return o<0||o>=s?e?"":void 0:(r=Ff(a,o))<55296||r>56319||o+1===s||(i=Ff(a,o+1))<56320||i>57343?e?jf(a,o):r:e?Uf(a,o,o+2):i-56320+(r-55296<<10)+65536}},Vf={codeAt:Bf(!1),charAt:Bf(!0)},zf=Vf.charAt,Wf=br,Gf=gs,Hf=fc,Yf=hc,qf="String Iterator",Kf=Gf.set,Xf=Gf.getterFor(qf);Hf(String,"String",(function(e){Kf(this,{type:qf,string:Wf(e),index:0})}),(function(){var e,t=Xf(this),n=t.string,r=t.index;return r>=n.length?Yf(void 0,!0):(e=zf(n,r),t.index+=e.length,Yf(e,!1))}));var Qf=ee.Promise,Jf={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Zf=h,$f=Ws,eh=Ka;for(var th in Jf)$f(Zf[th],th),eh[th]=eh.Array;var nh=Qf,rh=r(nh),ih=er("Array","values"),ah=gr,oh=et,sh=d,ch=ih,uh=Array.prototype,lh={DOMTokenList:!0,NodeList:!0},dh=function(e){var t=e.values;return e===uh||sh(uh,e)&&t===uh.values||oh(lh,ah(e))?ch:t},fh=r(dh),hh=Re,ph=TypeError,mh=ou,gh=Math.floor,vh=function(e,t){var n=e.length;if(n<8)for(var r,i,a=1;a<n;){for(i=a,r=e[a];i&&t(e[i-1],r)>0;)e[i]=e[--i];i!==a++&&(e[i]=r)}else for(var o=gh(n/2),s=vh(mh(e,0,o),t),c=vh(mh(e,o),t),u=s.length,l=c.length,d=0,f=0;d<u||f<l;)e[d+f]=d<u&&f<l?t(s[d],c[f])<=0?s[d++]:c[f++]:d<u?s[d++]:c[f++];return e},yh=vh,bh=ce.match(/firefox\/(\d+)/i),_h=!!bh&&+bh[1],wh=/MSIE|Trident/.test(ce),Eh=ce.match(/AppleWebKit\/(\d+)\./),Sh=!!Eh&&+Eh[1],Ch=kn,xh=l,Th=ke,Rh=Je,Ih=Hn,Nh=function(e,t){if(!delete e[t])throw new ph("Cannot delete property "+hh(t)+" of "+hh(e))},Ah=br,kh=i,Dh=yh,Mh=Gr,Lh=_h,Oh=wh,Ph=me,jh=Sh,Fh=[],Uh=xh(Fh.sort),Bh=xh(Fh.push),Vh=kh((function(){Fh.sort(void 0)})),zh=kh((function(){Fh.sort(null)})),Wh=Mh("sort"),Gh=!kh((function(){if(Ph)return Ph<70;if(!(Lh&&Lh>3)){if(Oh)return!0;if(jh)return jh<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Fh.push({k:t+r,v:n})}for(Fh.sort((function(e,t){return t.v-e.v})),r=0;r<Fh.length;r++)t=Fh[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));Ch({target:"Array",proto:!0,forced:Vh||!zh||!Wh||!Gh},{sort:function(e){void 0!==e&&Th(e);var t=Rh(this);if(Gh)return void 0===e?Uh(t):Uh(t,e);var n,r,i=[],a=Ih(t);for(r=0;r<a;r++)r in t&&Bh(i,t[r]);for(Dh(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Ah(t)>Ah(n)?1:-1}}(e)),n=Ih(i),r=0;r<n;)t[r]=i[r++];for(;r<a;)Nh(t,r++);return t}});var Hh=er("Array","sort"),Yh=d,qh=Hh,Kh=Array.prototype,Xh=function(e){var t=e.sort;return e===Kh||Yh(Kh,e)&&t===Kh.sort?qh:t},Qh=r(Xh),Jh=kn,Zh=l,$h=Bn,ep=RangeError,tp=String.fromCharCode,np=String.fromCodePoint,rp=Zh([].join);Jh({target:"String",stat:!0,arity:1,forced:!!np&&1!==np.length},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,i=0;r>i;){if(t=+arguments[i++],$h(t,1114111)!==t)throw new ep(t+" is not a valid code point");n[i]=t<65536?tp(t):tp(55296+((t-=65536)>>10),t%1024+56320)}return rp(n,"")}});var ip=i,ap=pt("iterator"),op=!ip((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[ap]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("https://a#\u0431").hash||"a1c3"!==r||"x"!==new URL("https://x",void 0).host})),sp=Cs,cp=kn,up=h,lp=Bu,dp=ae,fp=D,hp=l,pp=N,mp=op,gp=Cs,vp=Sc,yp=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:sp(e,r,t[r],n);return e},bp=Ws,_p=Qs,wp=gs,Ep=Ac,Sp=R,Cp=et,xp=Zt,Tp=gr,Rp=an,Ip=$,Np=br,Ap=La,kp=U,Dp=fo,Mp=io,Lp=hc,Op=cu,Pp=yh,jp=pt("iterator"),Fp="URLSearchParams",Up=Fp+"Iterator",Bp=wp.set,Vp=wp.getterFor(Fp),zp=wp.getterFor(Up),Wp=lp("fetch"),Gp=lp("Request"),Hp=lp("Headers"),Yp=Gp&&Gp.prototype,qp=Hp&&Hp.prototype,Kp=up.TypeError,Xp=up.encodeURIComponent,Qp=String.fromCharCode,Jp=dp("String","fromCodePoint"),Zp=parseInt,$p=hp("".charAt),em=hp([].join),tm=hp([].push),nm=hp("".replace),rm=hp([].shift),im=hp([].splice),am=hp("".split),om=hp("".slice),sm=hp(/./.exec),cm=/\+/g,um=/^[0-9a-f]+$/i,lm=function(e,t){var n=om(e,t,t+2);return sm(um,n)?Zp(n,16):NaN},dm=function(e){for(var t=0,n=128;n>0&&0!=(e&n);n>>=1)t++;return t},fm=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},hm=function(e){for(var t=(e=nm(e,cm," ")).length,n="",r=0;r<t;){var i=$p(e,r);if("%"===i){if("%"===$p(e,r+1)||r+3>t){n+="%",r++;continue}var a=lm(e,r+1);if(a!=a){n+=i,r++;continue}r+=2;var o=dm(a);if(0===o)i=Qp(a);else{if(1===o||o>4){n+="\ufffd",r++;continue}for(var s=[a],c=1;c<o&&!(3+ ++r>t||"%"!==$p(e,r));){var u=lm(e,r+1);if(u!=u){r+=3;break}if(u>191||u<128)break;tm(s,u),r+=2,c++}if(s.length!==o){n+="\ufffd";continue}var l=fm(s);null===l?n+="\ufffd":i=Jp(l)}}n+=i,r++}return n},pm=/[!'()~]|%20/g,mm={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},gm=function(e){return mm[e]},vm=function(e){return nm(Xp(e),pm,gm)},ym=_p((function(e,t){Bp(this,{type:Up,target:Vp(e).entries,index:0,kind:t})}),Fp,(function(){var e=zp(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Lp(void 0,!0);var r=t[n];switch(e.kind){case"keys":return Lp(r.key,!1);case"values":return Lp(r.value,!1)}return Lp([r.key,r.value],!1)}),!0),bm=function(e){this.entries=[],this.url=null,void 0!==e&&(Ip(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===$p(e,0)?om(e,1):e:Np(e)))};bm.prototype={type:Fp,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,a,o,s,c=this.entries,u=Mp(e);if(u)for(n=(t=Dp(e,u)).next;!(r=fp(n,t)).done;){if(a=(i=Dp(Rp(r.value))).next,(o=fp(a,i)).done||(s=fp(a,i)).done||!fp(a,i).done)throw new Kp("Expected sequence with length 2");tm(c,{key:Np(o.value),value:Np(s.value)})}else for(var l in e)Cp(e,l)&&tm(c,{key:l,value:Np(e[l])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=am(e,"&"),a=0;a<i.length;)(t=i[a++]).length&&(n=am(t,"="),tm(r,{key:hm(rm(n)),value:hm(em(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],tm(n,vm(e.key)+"="+vm(e.value));return em(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var _m=function(){Ep(this,wm);var e=Bp(this,new bm(arguments.length>0?arguments[0]:void 0));pp||(this.size=e.entries.length)},wm=_m.prototype;if(yp(wm,{append:function(e,t){var n=Vp(this);Op(arguments.length,2),tm(n.entries,{key:Np(e),value:Np(t)}),pp||this.length++,n.updateURL()},delete:function(e){for(var t=Vp(this),n=Op(arguments.length,1),r=t.entries,i=Np(e),a=n<2?void 0:arguments[1],o=void 0===a?a:Np(a),s=0;s<r.length;){var c=r[s];if(c.key!==i||void 0!==o&&c.value!==o)s++;else if(im(r,s,1),void 0!==o)break}pp||(this.size=r.length),t.updateURL()},get:function(e){var t=Vp(this).entries;Op(arguments.length,1);for(var n=Np(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Vp(this).entries;Op(arguments.length,1);for(var n=Np(e),r=[],i=0;i<t.length;i++)t[i].key===n&&tm(r,t[i].value);return r},has:function(e){for(var t=Vp(this).entries,n=Op(arguments.length,1),r=Np(e),i=n<2?void 0:arguments[1],a=void 0===i?i:Np(i),o=0;o<t.length;){var s=t[o++];if(s.key===r&&(void 0===a||s.value===a))return!0}return!1},set:function(e,t){var n=Vp(this);Op(arguments.length,1);for(var r,i=n.entries,a=!1,o=Np(e),s=Np(t),c=0;c<i.length;c++)(r=i[c]).key===o&&(a?im(i,c--,1):(a=!0,r.value=s));a||tm(i,{key:o,value:s}),pp||(this.size=i.length),n.updateURL()},sort:function(){var e=Vp(this);Pp(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=Vp(this).entries,r=xp(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new ym(this,"keys")},values:function(){return new ym(this,"values")},entries:function(){return new ym(this,"entries")}},{enumerable:!0}),gp(wm,jp,wm.entries,{name:"entries"}),gp(wm,"toString",(function(){return Vp(this).serialize()}),{enumerable:!0}),pp&&vp(wm,"size",{get:function(){return Vp(this).entries.length},configurable:!0,enumerable:!0}),bp(_m,Fp),cp({global:!0,constructor:!0,forced:!mp},{URLSearchParams:_m}),!mp&&Sp(Hp)){var Em=hp(qp.has),Sm=hp(qp.set),Cm=function(e){if(Ip(e)){var t,n=e.body;if(Tp(n)===Fp)return t=e.headers?new Hp(e.headers):new Hp,Em(t,"content-type")||Sm(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Ap(e,{body:kp(0,Np(n)),headers:kp(0,t)})}return e};if(Sp(Wp)&&cp({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Wp(e,arguments.length>1?Cm(arguments[1]):{})}}),Sp(Gp)){var xm=function(e){return Ep(this,Yp),new Gp(e,arguments.length>1?Cm(arguments[1]):{})};Yp.constructor=xm,xm.prototype=Yp,cp({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:xm})}}var Tm,Rm={URLSearchParams:_m,getState:Vp},Im=ee.URLSearchParams,Nm=N,Am=l,km=D,Dm=i,Mm=fa,Lm=Zi,Om=M,Pm=Je,jm=G,Fm=Object.assign,Um=Object.defineProperty,Bm=Am([].concat),Vm=!Fm||Dm((function(){if(Nm&&1!==Fm({b:1},Fm(Um({},"a",{enumerable:!0,get:function(){Um(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!==Fm({},e)[n]||Mm(Fm({},t)).join("")!==r}))?function(e,t){for(var n=Pm(e),r=arguments.length,i=1,a=Lm.f,o=Om.f;r>i;)for(var s,c=jm(arguments[i++]),u=a?Bm(Mm(c),a(c)):Mm(c),l=u.length,d=0;l>d;)s=u[d++],Nm&&!km(o,c,s)||(n[s]=c[s]);return n}:Fm,zm=an,Wm=go,Gm=N,Hm=$t,Ym=U,qm=function(e,t,n){Gm?Hm.f(e,t,Ym(0,n)):e[t]=n},Km=Zt,Xm=D,Qm=Je,Jm=function(e,t,n,r){try{return r?t(zm(n)[0],n[1]):t(n)}catch(t){Wm(e,"throw",t)}},Zm=Za,$m=Jc,eg=Hn,tg=qm,ng=fo,rg=io,ig=Array,ag=l,og=2147483647,sg=/[^\0-\u007E]/,cg=/[.\u3002\uFF0E\uFF61]/g,ug="Overflow: input needs wider integers to process",lg=RangeError,dg=ag(cg.exec),fg=Math.floor,hg=String.fromCharCode,pg=ag("".charCodeAt),mg=ag([].join),gg=ag([].push),vg=ag("".replace),yg=ag("".split),bg=ag("".toLowerCase),_g=function(e){return e+22+75*(e<26)},wg=function(e,t,n){var r=0;for(e=n?fg(e/700):e>>1,e+=fg(e/t);e>455;)e=fg(e/35),r+=36;return fg(r+36*e/(e+38))},Eg=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=pg(e,n++);if(i>=55296&&i<=56319&&n<r){var a=pg(e,n++);56320==(64512&a)?gg(t,((1023&i)<<10)+(1023&a)+65536):(gg(t,i),n--)}else gg(t,i)}return t}(e);var n,r,i=e.length,a=128,o=0,s=72;for(n=0;n<e.length;n++)(r=e[n])<128&&gg(t,hg(r));var c=t.length,u=c;for(c&&gg(t,"-");u<i;){var l=og;for(n=0;n<e.length;n++)(r=e[n])>=a&&r<l&&(l=r);var d=u+1;if(l-a>fg((og-o)/d))throw new lg(ug);for(o+=(l-a)*d,a=l,n=0;n<e.length;n++){if((r=e[n])<a&&++o>og)throw new lg(ug);if(r===a){for(var f=o,h=36;;){var p=h<=s?1:h>=s+26?26:h-s;if(f<p)break;var m=f-p,g=36-p;gg(t,hg(_g(p+m%g))),f=fg(m/g),h+=36}gg(t,hg(_g(f))),s=wg(o,d,u===c),o=0,u++}}o++,a++}return mg(t,"")},Sg=kn,Cg=N,xg=op,Tg=h,Rg=Zt,Ig=l,Ng=Cs,Ag=Sc,kg=Ac,Dg=et,Mg=Vm,Lg=function(e){var t=Qm(e),n=$m(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=void 0!==i;a&&(i=Km(i,r>2?arguments[2]:void 0));var o,s,c,u,l,d,f=rg(t),h=0;if(!f||this===ig&&Zm(f))for(o=eg(t),s=n?new this(o):ig(o);o>h;h++)d=a?i(t[h],h):t[h],tg(s,h,d);else for(s=n?new this:[],l=(u=ng(t,f)).next;!(c=Xm(l,u)).done;h++)d=a?Jm(u,i,[c.value,h],!0):c.value,tg(s,h,d);return s.length=h,s},Og=ou,Pg=Vf.codeAt,jg=function(e){var t,n,r=[],i=yg(vg(bg(e),cg,"."),".");for(t=0;t<i.length;t++)n=i[t],gg(r,dg(sg,n)?"xn--"+Eg(n):n);return mg(r,".")},Fg=br,Ug=Ws,Bg=cu,Vg=Rm,zg=gs,Wg=zg.set,Gg=zg.getterFor("URL"),Hg=Vg.URLSearchParams,Yg=Vg.getState,qg=Tg.URL,Kg=Tg.TypeError,Xg=Tg.parseInt,Qg=Math.floor,Jg=Math.pow,Zg=Ig("".charAt),$g=Ig(/./.exec),ev=Ig([].join),tv=Ig(1..toString),nv=Ig([].pop),rv=Ig([].push),iv=Ig("".replace),av=Ig([].shift),ov=Ig("".split),sv=Ig("".slice),cv=Ig("".toLowerCase),uv=Ig([].unshift),lv="Invalid scheme",dv="Invalid host",fv="Invalid port",hv=/[a-z]/i,pv=/[\d+-.a-z]/i,mv=/\d/,gv=/^0x/i,vv=/^[0-7]+$/,yv=/^\d+$/,bv=/^[\da-f]+$/i,_v=/[\0\t\n\r #%/:<>?@[\\\]^|]/,wv=/[\0\t\n\r #/:<>?@[\\\]^|]/,Ev=/^[\u0000-\u0020]+/,Sv=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Cv=/[\t\n\r]/g,xv=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)uv(t,e%256),e=Qg(e/256);return ev(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,a=0;a<8;a++)0!==e[a]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=a),++i);return i>n?r:t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=tv(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},Tv={},Rv=Mg({},Tv,{" ":1,'"':1,"<":1,">":1,"`":1}),Iv=Mg({},Rv,{"#":1,"?":1,"{":1,"}":1}),Nv=Mg({},Iv,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Av=function(e,t){var n=Pg(e,0);return n>32&&n<127&&!Dg(t,e)?e:encodeURIComponent(e)},kv={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Dv=function(e,t){var n;return 2===e.length&&$g(hv,Zg(e,0))&&(":"===(n=Zg(e,1))||!t&&"|"===n)},Mv=function(e){var t;return e.length>1&&Dv(sv(e,0,2))&&(2===e.length||"/"===(t=Zg(e,2))||"\\"===t||"?"===t||"#"===t)},Lv=function(e){return"."===e||"%2e"===cv(e)},Ov={},Pv={},jv={},Fv={},Uv={},Bv={},Vv={},zv={},Wv={},Gv={},Hv={},Yv={},qv={},Kv={},Xv={},Qv={},Jv={},Zv={},$v={},ey={},ty={},ny=function(e,t,n){var r,i,a,o=Fg(e);if(t){if(i=this.parse(o))throw new Kg(i);this.searchParams=null}else{if(void 0!==n&&(r=new ny(n,!0)),i=this.parse(o,null,r))throw new Kg(i);(a=Yg(new Hg)).bindURL(this),this.searchParams=a}};ny.prototype={type:"URL",parse:function(e,t,n){var r,i,a,o,s,c=this,u=t||Ov,l=0,d="",f=!1,h=!1,p=!1;for(e=Fg(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=iv(e,Ev,""),e=iv(e,Sv,"$1")),e=iv(e,Cv,""),r=Lg(e);l<=r.length;){switch(i=r[l],u){case Ov:if(!i||!$g(hv,i)){if(t)return lv;u=jv;continue}d+=cv(i),u=Pv;break;case Pv:if(i&&($g(pv,i)||"+"===i||"-"===i||"."===i))d+=cv(i);else{if(":"!==i){if(t)return lv;d="",u=jv,l=0;continue}if(t&&(c.isSpecial()!==Dg(kv,d)||"file"===d&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=d,t)return void(c.isSpecial()&&kv[c.scheme]===c.port&&(c.port=null));d="","file"===c.scheme?u=Kv:c.isSpecial()&&n&&n.scheme===c.scheme?u=Fv:c.isSpecial()?u=zv:"/"===r[l+1]?(u=Uv,l++):(c.cannotBeABaseURL=!0,rv(c.path,""),u=$v)}break;case jv:if(!n||n.cannotBeABaseURL&&"#"!==i)return lv;if(n.cannotBeABaseURL&&"#"===i){c.scheme=n.scheme,c.path=Og(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,u=ty;break}u="file"===n.scheme?Kv:Bv;continue;case Fv:if("/"!==i||"/"!==r[l+1]){u=Bv;continue}u=Wv,l++;break;case Uv:if("/"===i){u=Gv;break}u=Zv;continue;case Bv:if(c.scheme=n.scheme,i===Tm)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Og(n.path),c.query=n.query;else if("/"===i||"\\"===i&&c.isSpecial())u=Vv;else if("?"===i)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Og(n.path),c.query="",u=ey;else{if("#"!==i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Og(n.path),c.path.length--,u=Zv;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Og(n.path),c.query=n.query,c.fragment="",u=ty}break;case Vv:if(!c.isSpecial()||"/"!==i&&"\\"!==i){if("/"!==i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,u=Zv;continue}u=Gv}else u=Wv;break;case zv:if(u=Wv,"/"!==i||"/"!==Zg(d,l+1))continue;l++;break;case Wv:if("/"!==i&&"\\"!==i){u=Gv;continue}break;case Gv:if("@"===i){f&&(d="%40"+d),f=!0,a=Lg(d);for(var m=0;m<a.length;m++){var g=a[m];if(":"!==g||p){var v=Av(g,Nv);p?c.password+=v:c.username+=v}else p=!0}d=""}else if(i===Tm||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(f&&""===d)return"Invalid authority";l-=Lg(d).length+1,d="",u=Hv}else d+=i;break;case Hv:case Yv:if(t&&"file"===c.scheme){u=Qv;continue}if(":"!==i||h){if(i===Tm||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()){if(c.isSpecial()&&""===d)return dv;if(t&&""===d&&(c.includesCredentials()||null!==c.port))return;if(o=c.parseHost(d))return o;if(d="",u=Jv,t)return;continue}"["===i?h=!0:"]"===i&&(h=!1),d+=i}else{if(""===d)return dv;if(o=c.parseHost(d))return o;if(d="",u=qv,t===Yv)return}break;case qv:if(!$g(mv,i)){if(i===Tm||"/"===i||"?"===i||"#"===i||"\\"===i&&c.isSpecial()||t){if(""!==d){var y=Xg(d,10);if(y>65535)return fv;c.port=c.isSpecial()&&y===kv[c.scheme]?null:y,d=""}if(t)return;u=Jv;continue}return fv}d+=i;break;case Kv:if(c.scheme="file","/"===i||"\\"===i)u=Xv;else{if(!n||"file"!==n.scheme){u=Zv;continue}switch(i){case Tm:c.host=n.host,c.path=Og(n.path),c.query=n.query;break;case"?":c.host=n.host,c.path=Og(n.path),c.query="",u=ey;break;case"#":c.host=n.host,c.path=Og(n.path),c.query=n.query,c.fragment="",u=ty;break;default:Mv(ev(Og(r,l),""))||(c.host=n.host,c.path=Og(n.path),c.shortenPath()),u=Zv;continue}}break;case Xv:if("/"===i||"\\"===i){u=Qv;break}n&&"file"===n.scheme&&!Mv(ev(Og(r,l),""))&&(Dv(n.path[0],!0)?rv(c.path,n.path[0]):c.host=n.host),u=Zv;continue;case Qv:if(i===Tm||"/"===i||"\\"===i||"?"===i||"#"===i){if(!t&&Dv(d))u=Zv;else if(""===d){if(c.host="",t)return;u=Jv}else{if(o=c.parseHost(d))return o;if("localhost"===c.host&&(c.host=""),t)return;d="",u=Jv}continue}d+=i;break;case Jv:if(c.isSpecial()){if(u=Zv,"/"!==i&&"\\"!==i)continue}else if(t||"?"!==i)if(t||"#"!==i){if(i!==Tm&&(u=Zv,"/"!==i))continue}else c.fragment="",u=ty;else c.query="",u=ey;break;case Zv:if(i===Tm||"/"===i||"\\"===i&&c.isSpecial()||!t&&("?"===i||"#"===i)){if(".."===(s=cv(s=d))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(c.shortenPath(),"/"===i||"\\"===i&&c.isSpecial()||rv(c.path,"")):Lv(d)?"/"===i||"\\"===i&&c.isSpecial()||rv(c.path,""):("file"===c.scheme&&!c.path.length&&Dv(d)&&(c.host&&(c.host=""),d=Zg(d,0)+":"),rv(c.path,d)),d="","file"===c.scheme&&(i===Tm||"?"===i||"#"===i))for(;c.path.length>1&&""===c.path[0];)av(c.path);"?"===i?(c.query="",u=ey):"#"===i&&(c.fragment="",u=ty)}else d+=Av(i,Iv);break;case $v:"?"===i?(c.query="",u=ey):"#"===i?(c.fragment="",u=ty):i!==Tm&&(c.path[0]+=Av(i,Tv));break;case ey:t||"#"!==i?i!==Tm&&("'"===i&&c.isSpecial()?c.query+="%27":c.query+="#"===i?"%23":Av(i,Tv)):(c.fragment="",u=ty);break;case ty:i!==Tm&&(c.fragment+=Av(i,Rv))}l++}},parseHost:function(e){var t,n,r;if("["===Zg(e,0)){if("]"!==Zg(e,e.length-1))return dv;if(t=function(e){var t,n,r,i,a,o,s,c=[0,0,0,0,0,0,0,0],u=0,l=null,d=0,f=function(){return Zg(e,d)};if(":"===f()){if(":"!==Zg(e,1))return;d+=2,l=++u}for(;f();){if(8===u)return;if(":"!==f()){for(t=n=0;n<4&&$g(bv,f());)t=16*t+Xg(f(),16),d++,n++;if("."===f()){if(0===n)return;if(d-=n,u>6)return;for(r=0;f();){if(i=null,r>0){if(!("."===f()&&r<4))return;d++}if(!$g(mv,f()))return;for(;$g(mv,f());){if(a=Xg(f(),10),null===i)i=a;else{if(0===i)return;i=10*i+a}if(i>255)return;d++}c[u]=256*c[u]+i,2!=++r&&4!==r||u++}if(4!==r)return;break}if(":"===f()){if(d++,!f())return}else if(f())return;c[u++]=t}else{if(null!==l)return;d++,l=++u}}if(null!==l)for(o=u-l,u=7;0!==u&&o>0;)s=c[u],c[u--]=c[l+o-1],c[l+--o]=s;else if(8!==u)return;return c}(sv(e,1,-1)),!t)return dv;this.host=t}else if(this.isSpecial()){if(e=jg(e),$g(_v,e))return dv;if(t=function(e){var t,n,r,i,a,o,s,c=ov(e,".");if(c.length&&""===c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],r=0;r<t;r++){if(""===(i=c[r]))return e;if(a=10,i.length>1&&"0"===Zg(i,0)&&(a=$g(gv,i)?16:8,i=sv(i,8===a?1:2)),""===i)o=0;else{if(!$g(10===a?yv:8===a?vv:bv,i))return e;o=Xg(i,a)}rv(n,o)}for(r=0;r<t;r++)if(o=n[r],r===t-1){if(o>=Jg(256,5-t))return null}else if(o>255)return null;for(s=nv(n),r=0;r<n.length;r++)s+=n[r]*Jg(256,3-r);return s}(e),null===t)return dv;this.host=t}else{if($g(wv,e))return dv;for(t="",n=Lg(e),r=0;r<n.length;r++)t+=Av(n[r],Tv);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return Dg(kv,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&Dv(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,o=e.path,s=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",e.includesCredentials()&&(u+=n+(r?":"+r:"")+"@"),u+=xv(i),null!==a&&(u+=":"+a)):"file"===t&&(u+="//"),u+=e.cannotBeABaseURL?o[0]:o.length?"/"+ev(o,"/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},setHref:function(e){var t=this.parse(e);if(t)throw new Kg(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new ry(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+xv(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Fg(e)+":",Ov)},getUsername:function(){return this.username},setUsername:function(e){var t=Lg(Fg(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Av(t[n],Nv)}},getPassword:function(){return this.password},setPassword:function(e){var t=Lg(Fg(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Av(t[n],Nv)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?xv(e):xv(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Hv)},getHostname:function(){var e=this.host;return null===e?"":xv(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Yv)},getPort:function(){var e=this.port;return null===e?"":Fg(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=Fg(e))?this.port=null:this.parse(e,qv))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+ev(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Jv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=Fg(e))?this.query=null:("?"===Zg(e,0)&&(e=sv(e,1)),this.query="",this.parse(e,ey)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=Fg(e))?("#"===Zg(e,0)&&(e=sv(e,1)),this.fragment="",this.parse(e,ty)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var ry=function(e){var t=kg(this,iy),n=Bg(arguments.length,1)>1?arguments[1]:void 0,r=Wg(t,new ny(e,!1,n));Cg||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},iy=ry.prototype,ay=function(e,t){return{get:function(){return Gg(this)[e]()},set:t&&function(e){return Gg(this)[t](e)},configurable:!0,enumerable:!0}};if(Cg&&(Ag(iy,"href",ay("serialize","setHref")),Ag(iy,"origin",ay("getOrigin")),Ag(iy,"protocol",ay("getProtocol","setProtocol")),Ag(iy,"username",ay("getUsername","setUsername")),Ag(iy,"password",ay("getPassword","setPassword")),Ag(iy,"host",ay("getHost","setHost")),Ag(iy,"hostname",ay("getHostname","setHostname")),Ag(iy,"port",ay("getPort","setPort")),Ag(iy,"pathname",ay("getPathname","setPathname")),Ag(iy,"search",ay("getSearch","setSearch")),Ag(iy,"searchParams",ay("getSearchParams")),Ag(iy,"hash",ay("getHash","setHash"))),Ng(iy,"toJSON",(function(){return Gg(this).serialize()}),{enumerable:!0}),Ng(iy,"toString",(function(){return Gg(this).serialize()}),{enumerable:!0}),qg){var oy=qg.createObjectURL,sy=qg.revokeObjectURL;oy&&Ng(ry,"createObjectURL",Rg(oy,qg)),sy&&Ng(ry,"revokeObjectURL",Rg(sy,qg))}Ug(ry,"URL"),Sg({global:!0,constructor:!0,forced:!xg,sham:!Cg},{URL:ry});var cy=kn,uy=i,ly=cu,dy=br,fy=op,hy=ae("URL"),py=fy&&uy((function(){hy.canParse()})),my=uy((function(){return 1!==hy.canParse.length}));cy({target:"URL",stat:!0,forced:!py||my},{canParse:function(e){var t=ly(arguments.length,1),n=dy(e),r=t<2||void 0===arguments[1]?void 0:dy(arguments[1]);try{return!!new hy(n,r)}catch(e){return!1}}});var gy=kn,vy=cu,yy=br,by=op,_y=ae("URL");gy({target:"URL",stat:!0,forced:!by},{parse:function(e){var t=vy(arguments.length,1),n=yy(e),r=t<2||void 0===arguments[1]?void 0:yy(arguments[1]);try{return new _y(n,r)}catch(e){return null}}});var wy=r(ee.URL);let Ey=!0,Sy=!0;function Cy(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function xy(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const a=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,a),i.apply(this,[e,a])};const a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Ty(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Ey=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Ry(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Sy=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Iy(){if("object"==typeof window){if(Ey)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Ny(e,t){Sy&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Ay(e){return"[object Object]"===Object.prototype.toString.call(e)}function ky(e){var t;return Ay(e)?ii(t=Object.keys(e)).call(t,(function(t,n){const r=Ay(e[n]),i=r?ky(e[n]):e[n],a=r&&!Object.keys(i).length;return void 0===i||a?t:Object.assign(t,{[n]:i})}),{}):e}function Dy(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?Dy(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{Dy(e,e.get(t),n)}))})))}function My(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const a=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&Dy(e,n,i)}))})),i}const Ly=Iy;function Oy(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let a=e.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});const o=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?t=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{n=n.filter((e=>"videoinput"===e.kind));let o=n.find((e=>t.some((t=>{var n;return Lr(n=e.label.toLowerCase()).call(n,t)}))));return!o&&n.length&&Lr(t).call(t,"back")&&(o=n[n.length-1]),o&&(e.video.deviceId=a.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=r(e.video),Ly("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return Ly("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(a(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>rh.reject(a(e))))))}}}function Py(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function jy(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else xy(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function Fy(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Uy(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},a=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(a(i(e)))};return t.apply(this,[r,e])}return new rh(((e,n)=>{t.apply(this,[function(t){e(a(i(t)))},n])})).then(n,r)}}function By(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>My(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),xy(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>My(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?rh.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():rh.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Vy(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function zy(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Vy(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find((e=>e.track===t));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const a=this._streams[n.id];if(a)a.addTrack(t),rh.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=a(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>a(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wy(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function Gy(e,t){xy(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var Hy=Object.freeze({__proto__:null,fixNegotiationNeeded:Gy,shimAddTrackRemoveTrack:zy,shimAddTrackRemoveTrackWithNative:Vy,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Fy,shimGetStats:Uy,shimGetUserMedia:Oy,shimMediaStream:Py,shimOnTrack:jy,shimPeerConnection:Wy,shimSenderReceiverGetStats:By});function Yy(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Ny("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function qy(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ky(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,a]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,a)}}function Xy(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):rh.resolve(new Map)}}function Qy(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),xy(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Jy(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Ny("removeStream","removeTrack"),this.getSenders().forEach((t=>{var n;t.track&&Lr(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)}))})}function Zy(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function $y(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function eb(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function tb(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?rh.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function nb(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?rh.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var rb=Object.freeze({__proto__:null,shimAddTransceiver:$y,shimCreateAnswer:nb,shimCreateOffer:tb,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,rh.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:eb,shimGetUserMedia:Yy,shimOnTrack:qy,shimPeerConnection:Ky,shimRTCDataChannel:Zy,shimReceiverGetStats:Qy,shimRemoveStream:Jy,shimSenderGetStats:Xy});function ib(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n;this._localStreams||(this._localStreams=[]),Lr(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach((e=>{var t;this._localStreams?Lr(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{Lr(n).call(n,e.track)&&this.removeTrack(e)}))})}}function ab(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),Lr(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,this.dispatchEvent(n)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function ob(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),rh.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),rh.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),rh.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),rh.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),rh.resolve()):r},t.addIceCandidate=s}function sb(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(cb(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function cb(e){return e&&void 0!==e.video?Object.assign({},e,{video:ky(e.video)}):e}function ub(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(Ny("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function lb(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function db(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function fb(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var hb=Object.freeze({__proto__:null,shimAudioContext:fb,shimCallbacksAPI:ob,shimConstraints:cb,shimCreateOfferLegacy:db,shimGetUserMedia:sb,shimLocalStreamsAPI:ib,shimRTCIceServerUrls:ub,shimRemoteStreamsAPI:ab,shimTrackEventTransceiver:lb}),pb="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",mb=K,gb=br,vb=pb,yb=l("".replace),bb=RegExp("^["+vb+"]+"),_b=RegExp("(^|[^"+vb+"])["+vb+"]+$"),wb=function(e){return function(t){var n=gb(mb(t));return 1&e&&(n=yb(n,bb,"")),2&e&&(n=yb(n,_b,"$1")),n}},Eb={start:wb(1),end:wb(2),trim:wb(3)},Sb=Es.PROPER,Cb=i,xb=pb,Tb=Eb.trim;kn({target:"String",proto:!0,forced:function(e){return Cb((function(){return!!xb[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||Sb&&xb[e].name!==e}))}("trim")},{trim:function(){return Tb(this)}});var Rb=er("String","trim"),Ib=d,Nb=Rb,Ab=String.prototype,kb=function(e){var t=e.trim;return"string"==typeof e||e===Ab||Ib(Ab,e)&&t===Ab.trim?Nb:t},Db=r(kb),Mb={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let i=0;i<r.length;i++)n=r[i].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let a=3;a<r.length;a++){const i=r[a],o=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){const r=t.parseRtpMap(o),a=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=a.length?t.parseFmtp(a[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),a=-1!==r.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=o.length>0&&o[0].ssrc;let c;const u=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));u.length>0&&u[0].length>1&&u[0][0]===s&&(c=u[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:a?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&s&&n.push({ssrc:s});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substring(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=l}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const a=t.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const a=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let t=0;t<r.length;t++)switch(r[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(Mb);var Lb=Mb.exports,Ob=r(Lb),Pb=e({__proto__:null,default:Ob},[Lb]);function jb(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Ob.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,xy(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Fb(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||xy(e,"icecandidate",(e=>{if(e.candidate){const t=Ob.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Ub(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Ob.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Ob.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},a=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Ob.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=a(arguments[0],e);let o;o=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>o}),this._sctp=s}return o.apply(this,arguments)}}function Bb(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},xy(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Vb(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function zb(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==Db(e).call(e))).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Wb(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?rh.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),rh.resolve())})}function Gb(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var Hb=Object.freeze({__proto__:null,removeExtmapAllowMixed:zb,shimAddIceCandidateNullOrEmpty:Wb,shimConnectionState:Vb,shimMaxMessageSize:Ub,shimParameterlessSetLocalDescription:Gb,shimRTCIceCandidate:jb,shimRTCIceCandidateRelayProtocol:Fb,shimSendThrowTypeError:Bb});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Iy,r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Cy(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Cy(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Cy(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:Hb,extractVersion:Cy,disableLog:Ty,disableWarnings:Ry,sdp:Pb};switch(r.browser){case"chrome":if(!Hy||!Wy||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Hy,Wb(e,r),Gb(e),Oy(e,r),Py(e),Wy(e,r),jy(e),zy(e,r),Fy(e),Uy(e),By(e),Gy(e,r),jb(e),Fb(e),Vb(e),Ub(e,r),Bb(e),zb(e,r);break;case"firefox":if(!rb||!Ky||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=rb,Wb(e,r),Gb(e),Yy(e,r),Ky(e,r),qy(e),Jy(e),Xy(e),Qy(e),Zy(e),$y(e),eb(e),tb(e),nb(e),jb(e),Vb(e),Ub(e,r),Bb(e);break;case"safari":if(!hb||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=hb,Wb(e,r),Gb(e),ub(e),db(e),ob(e),ib(e),ab(e),lb(e),sb(e),fb(e),jb(e),Fb(e),Ub(e,r),Bb(e),zb(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var Yb=h;kn({global:!0,forced:Yb.globalThis!==Yb},{globalThis:Yb});var qb=r(h),Kb={exports:{}};!function(e,n){!function(t,r){var i="function",a="undefined",o="object",s="string",c="major",u="model",l="name",d="type",f="vendor",h="version",p="architecture",m="console",g="mobile",v="tablet",y="smarttv",b="wearable",_="embedded",w="Amazon",E="Apple",S="ASUS",C="BlackBerry",x="Browser",T="Chrome",R="Firefox",I="Google",N="Huawei",A="LG",k="Microsoft",D="Motorola",M="Opera",L="Samsung",O="Sharp",P="Sony",j="Xiaomi",F="Zebra",U="Facebook",B="Chromium OS",V="Mac OS",z=" Browser",W=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},G=function(e,t){return typeof e===s&&-1!==H(t).indexOf(H(e))},H=function(e){return e.toLowerCase()},Y=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===a?e:e.substring(0,500)},q=function(e,t){for(var n,a,s,c,u,l,d=0;d<t.length&&!u;){var f=t[d],h=t[d+1];for(n=a=0;n<f.length&&!u&&f[n];)if(u=f[n++].exec(e))for(s=0;s<h.length;s++)l=u[++a],typeof(c=h[s])===o&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,l):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=l?l.replace(c[1],c[2]):r:this[c[0]]=l?c[1].call(this,l,c[2]):r:4===c.length&&(this[c[0]]=l?c[3].call(this,l.replace(c[1],c[2])):r):this[c]=l||r;d+=2}},K=function(e,t){for(var n in t)if(typeof t[n]===o&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(G(t[n][i],e))return"?"===n?r:n}else if(G(t[n],e))return"?"===n?r:n;return t.hasOwnProperty("*")?t["*"]:e},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Q={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[h,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[h,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,h],[/opios[\/ ]+([\w\.]+)/i],[h,[l,M+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[h,[l,M+" GX"]],[/\bopr\/([\w\.]+)/i],[h,[l,M]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[h,[l,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[h,[l,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[l,h],[/quark(?:pc)?\/([-\w\.]+)/i],[h,[l,"Quark"]],[/\bddg\/([\w\.]+)/i],[h,[l,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[h,[l,"UC"+x]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[h,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[h,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[h,[l,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[h,[l,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[h,[l,"Smart Lenovo "+x]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+x],h],[/\bfocus\/([\w\.]+)/i],[h,[l,R+" Focus"]],[/\bopt\/([\w\.]+)/i],[h,[l,M+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[h,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[h,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[h,[l,M+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[h,[l,"MIUI"+z]],[/fxios\/([\w\.-]+)/i],[h,[l,R]],[/\bqihoobrowser\/?([\w\.]*)/i],[h,[l,"360"]],[/\b(qq)\/([\w\.]+)/i],[[l,/(.+)/,"$1Browser"],h],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1"+z],h],[/samsungbrowser\/([\w\.]+)/i],[h,[l,L+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[h,[l,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[l,"Sogou Mobile"],h],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[l,h],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[l],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[h,l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,U],h],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[l,h],[/\bgsa\/([\w\.]+) .*safari\//i],[h,[l,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[h,[l,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[h,[l,T+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,T+" WebView"],h],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[h,[l,"Android "+x]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,h],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[h,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[h,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[h,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,h],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],h],[/(wolvic|librewolf)\/([\w\.]+)/i],[l,h],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[h,[l,R+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[l,[h,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[l,[h,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,H]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,"",H]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,H]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[f,L],[d,v]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[u,[f,L],[d,g]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[f,E],[d,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[f,E],[d,v]],[/(macintosh);/i],[u,[f,E]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[f,O],[d,g]],[/(?:honor)([-\w ]+)[;\)]/i],[u,[f,"Honor"],[d,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[f,N],[d,v]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[f,N],[d,g]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[u,/_/g," "],[f,j],[d,g]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[f,j],[d,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[f,"OPPO"],[d,g]],[/\b(opd2\d{3}a?) bui/i],[u,[f,"OPPO"],[d,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[f,"Vivo"],[d,g]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[u,[f,"Realme"],[d,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[f,D],[d,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[f,D],[d,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[f,A],[d,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[f,A],[d,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[f,"Lenovo"],[d,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[f,"Nokia"],[d,g]],[/(pixel c)\b/i],[u,[f,I],[d,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[f,I],[d,g]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[f,P],[d,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[f,P],[d,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[f,"OnePlus"],[d,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[f,w],[d,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[f,w],[d,g]],[/(playbook);[-\w\),; ]+(rim)/i],[u,f,[d,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[f,C],[d,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[f,S],[d,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[f,S],[d,g]],[/(nexus 9)/i],[u,[f,"HTC"],[d,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[u,/_/g," "],[d,g]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[u,[f,"TCL"],[d,v]],[/(itel) ((\w+))/i],[[f,H],u,[d,K,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[f,"Acer"],[d,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[f,"Meizu"],[d,g]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[u,[f,"Ulefone"],[d,g]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[u,[f,"Energizer"],[d,g]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[u,[f,"Cat"],[d,g]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[u,[f,"Smartfren"],[d,g]],[/droid.+; (a(?:015|06[35]|142p?))/i],[u,[f,"Nothing"],[d,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,u,[d,g]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,u,[d,v]],[/(surface duo)/i],[u,[f,k],[d,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[f,"Fairphone"],[d,g]],[/(u304aa)/i],[u,[f,"AT&T"],[d,g]],[/\bsie-(\w*)/i],[u,[f,"Siemens"],[d,g]],[/\b(rct\w+) b/i],[u,[f,"RCA"],[d,v]],[/\b(venue[\d ]{2,7}) b/i],[u,[f,"Dell"],[d,v]],[/\b(q(?:mv|ta)\w+) b/i],[u,[f,"Verizon"],[d,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[f,"Barnes & Noble"],[d,v]],[/\b(tm\d{3}\w+) b/i],[u,[f,"NuVision"],[d,v]],[/\b(k88) b/i],[u,[f,"ZTE"],[d,v]],[/\b(nx\d{3}j) b/i],[u,[f,"ZTE"],[d,g]],[/\b(gen\d{3}) b.+49h/i],[u,[f,"Swiss"],[d,g]],[/\b(zur\d{3}) b/i],[u,[f,"Swiss"],[d,v]],[/\b((zeki)?tb.*\b) b/i],[u,[f,"Zeki"],[d,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],u,[d,v]],[/\b(ns-?\w{0,9}) b/i],[u,[f,"Insignia"],[d,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[f,"NextBook"],[d,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],u,[d,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],u,[d,g]],[/\b(ph-1) /i],[u,[f,"Essential"],[d,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[f,"Envizen"],[d,v]],[/\b(trio[-\w\. ]+) b/i],[u,[f,"MachSpeed"],[d,v]],[/\btu_(1491) b/i],[u,[f,"Rotor"],[d,v]],[/(shield[\w ]+) b/i],[u,[f,"Nvidia"],[d,v]],[/(sprint) (\w+)/i],[f,u,[d,g]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[f,k],[d,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[f,F],[d,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[f,F],[d,g]],[/smart-tv.+(samsung)/i],[f,[d,y]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[f,L],[d,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,A],[d,y]],[/(apple) ?tv/i],[f,[u,E+" TV"],[d,y]],[/crkey/i],[[u,T+"cast"],[f,I],[d,y]],[/droid.+aft(\w+)( bui|\))/i],[u,[f,w],[d,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[f,O],[d,y]],[/(bravia[\w ]+)( bui|\))/i],[u,[f,P],[d,y]],[/(mitv-\w{5}) bui/i],[u,[f,j],[d,y]],[/Hbbtv.*(technisat) (.*);/i],[f,u,[d,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,Y],[u,Y],[d,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,u,[d,m]],[/droid.+; (shield) bui/i],[u,[f,"Nvidia"],[d,m]],[/(playstation [345portablevi]+)/i],[u,[f,P],[d,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[f,k],[d,m]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[u,[f,L],[d,b]],[/((pebble))app/i],[f,u,[d,b]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[f,E],[d,b]],[/droid.+; (glass) \d/i],[u,[f,I],[d,b]],[/droid.+; (wt63?0{2,3})\)/i],[u,[f,F],[d,b]],[/droid.+; (glass) \d/i],[u,[f,I],[d,b]],[/(pico) (4|neo3(?: link|pro)?)/i],[f,u,[d,b]],[/; (quest( \d| pro)?)/i],[u,[f,U],[d,b]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[d,_]],[/(aeobc)\b/i],[u,[f,w],[d,_]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[u,[d,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[d,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,g]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[h,[l,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[l,h],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[l,h],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[h,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,h],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[l,[h,K,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,K,X],[l,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[h,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,V],[h,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[h,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,h],[/\(bb(10);/i],[h,[l,C]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[h,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[h,[l,R+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[h,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[h,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[h,[l,T+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,B],h],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,h],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],h],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[l,h]]},J=function(e,n){if(typeof e===o&&(n=e,e=r),!(this instanceof J))return new J(e,n).getResult();var m=typeof t!==a&&t.navigator?t.navigator:r,y=e||(m&&m.userAgent?m.userAgent:""),b=m&&m.userAgentData?m.userAgentData:r,_=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(Q,n):Q,w=m&&m.userAgent==y;return this.getBrowser=function(){var e={};return e[l]=r,e[h]=r,q.call(e,y,_.browser),e[c]=function(e){return typeof e===s?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e[h]),w&&m&&m.brave&&typeof m.brave.isBrave==i&&(e[l]="Brave"),e},this.getCPU=function(){var e={};return e[p]=r,q.call(e,y,_.cpu),e},this.getDevice=function(){var e={};return e[f]=r,e[u]=r,e[d]=r,q.call(e,y,_.device),w&&!e[d]&&b&&b.mobile&&(e[d]=g),w&&"Macintosh"==e[u]&&m&&typeof m.standalone!==a&&m.maxTouchPoints&&m.maxTouchPoints>2&&(e[u]="iPad",e[d]=v),e},this.getEngine=function(){var e={};return e[l]=r,e[h]=r,q.call(e,y,_.engine),e},this.getOS=function(){var e={};return e[l]=r,e[h]=r,q.call(e,y,_.os),w&&!e[l]&&b&&b.platform&&"Unknown"!=b.platform&&(e[l]=b.platform.replace(/chrome os/i,B).replace(/macos/i,V)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return y},this.setUA=function(e){return y=typeof e===s&&e.length>500?Y(e,500):e,this},this.setUA(y),this};J.VERSION="0.7.40",J.BROWSER=W([l,h,c]),J.CPU=W([p]),J.DEVICE=W([u,f,d,m,g,y,v,b,_]),J.ENGINE=J.OS=W([l,h]),e.exports&&(n=e.exports=J),n.UAParser=J;var Z=typeof t!==a&&(t.jQuery||t.Zepto);if(Z&&!Z.ua){var $=new J;Z.ua=$.getResult(),Z.ua.get=function(){return $.getUA()},Z.ua.set=function(e){$.setUA(e);var t=$.getResult();for(var n in t)Z.ua[n]=t[n]}}}("object"==typeof window?window:t)}(Kb,Kb.exports);var Xb=r(Kb.exports),Qb=Pu.clear;kn({global:!0,bind:!0,enumerable:!0,forced:h.clearImmediate!==Qb},{clearImmediate:Qb});var Jb=h,Zb=y,$b=R,e_=Xr,t_=ce,n_=ou,r_=cu,i_=Jb.Function,a_=/MSIE .\./.test(t_)||"BUN"===e_&&function(){var e=Jb.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2])}(),o_=kn,s_=h,c_=Pu.set,u_=function(e,t){var n=t?2:1;return a_?function(r,i){var a=r_(arguments.length,1)>n,o=$b(r)?r:i_(r),s=a?n_(arguments,n):[],c=a?function(){Zb(o,this,s)}:o;return t?e(c,i):e(c)}:e},l_=s_.setImmediate?u_(c_,!1):c_;o_({global:!0,bind:!0,enumerable:!0,forced:s_.setImmediate!==l_},{setImmediate:l_});var d_=r(ee.setImmediate),f_=h,h_=fl,p_=ke,m_=cu,g_=N;kn({global:!0,enumerable:!0,dontCallGetSet:!0,forced:i((function(){return g_&&1!==Object.getOwnPropertyDescriptor(f_,"queueMicrotask").value.length}))},{queueMicrotask:function(e){m_(arguments.length,1),h_(p_(e))}});var v_=r(ee.queueMicrotask);function y_(e,t){return function(){return e.apply(t,arguments)}}const{toString:b_}=Object.prototype,{getPrototypeOf:__}=Object,{iterator:w_,toStringTag:E_}=Symbol,S_=(C_=Object.create(null),e=>{const t=b_.call(e);return C_[t]||(C_[t]=t.slice(8,-1).toLowerCase())});var C_;const x_=e=>(e=e.toLowerCase(),t=>S_(t)===e),T_=e=>t=>typeof t===e,{isArray:R_}=Array,I_=T_("undefined"),N_=x_("ArrayBuffer"),A_=T_("string"),k_=T_("function"),D_=T_("number"),M_=e=>null!==e&&"object"==typeof e,L_=e=>{if("object"!==S_(e))return!1;const t=__(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||E_ in e||w_ in e)},O_=x_("Date"),P_=x_("File"),j_=x_("Blob"),F_=x_("FileList"),U_=x_("URLSearchParams"),[B_,V_,z_,W_]=["ReadableStream","Request","Response","Headers"].map(x_);function G_(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),R_(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),a=r.length;let o;for(n=0;n<a;n++)o=r[n],t.call(null,e[o],o,e)}}function H_(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const Y_=void 0!==qb?qb:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,q_=e=>!I_(e)&&e!==Y_,K_=(X_="undefined"!=typeof Uint8Array&&__(Uint8Array),e=>X_&&e instanceof X_);var X_;const Q_=x_("HTMLFormElement"),J_=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),Z_=x_("RegExp"),$_=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};G_(n,((n,i)=>{let a;!1!==(a=t(n,i,e))&&(r[i]=a||n)})),Object.defineProperties(e,r)},ew=x_("AsyncFunction"),tw=(nw="function"==typeof d_,rw=k_(Y_.postMessage),nw?d_:rw?(iw="axios@".concat(Math.random()),aw=[],Y_.addEventListener("message",(e=>{let{source:t,data:n}=e;t===Y_&&n===iw&&aw.length&&aw.shift()()}),!1),e=>{aw.push(e),Y_.postMessage(iw,"*")}):e=>setTimeout(e));var nw,rw,iw,aw;const ow=void 0!==v_?v_.bind(Y_):"undefined"!=typeof process&&process.nextTick||tw;var sw={isArray:R_,isArrayBuffer:N_,isBuffer:function(e){return null!==e&&!I_(e)&&null!==e.constructor&&!I_(e.constructor)&&k_(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||k_(e.append)&&("formdata"===(t=S_(e))||"object"===t&&k_(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&N_(e.buffer),t},isString:A_,isNumber:D_,isBoolean:e=>!0===e||!1===e,isObject:M_,isPlainObject:L_,isReadableStream:B_,isRequest:V_,isResponse:z_,isHeaders:W_,isUndefined:I_,isDate:O_,isFile:P_,isBlob:j_,isRegExp:Z_,isFunction:k_,isStream:e=>M_(e)&&k_(e.pipe),isURLSearchParams:U_,isTypedArray:K_,isFileList:F_,forEach:G_,merge:function e(){const{caseless:t}=q_(this)&&this||{},n={},r=(r,i)=>{const a=t&&H_(n,i)||i;L_(n[a])&&L_(r)?n[a]=e(n[a],r):L_(r)?n[a]=e({},r):R_(r)?n[a]=r.slice():n[a]=r};for(let i=0,a=arguments.length;i<a;i++)arguments[i]&&G_(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return G_(t,((t,r)=>{n&&k_(t)?e[r]=y_(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>Db(e)?Db(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,a,o;const s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)o=i[a],r&&!r(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==n&&__(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:S_,kindOfTest:x_,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(R_(e))return e;let t=e.length;if(!D_(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[w_]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:Q_,hasOwnProperty:J_,hasOwnProp:J_,reduceDescriptors:$_,freezeMethods:e=>{$_(e,((t,n)=>{if(k_(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];k_(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return R_(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:H_,global:Y_,isContextDefined:q_,isSpecCompliantForm:function(e){return!!(e&&k_(e.append)&&"FormData"===e[E_]&&e[w_])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(M_(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=R_(e)?[]:{};return G_(e,((e,t)=>{const a=n(e,r+1);!I_(a)&&(i[t]=a)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:ew,isThenable:e=>e&&(M_(e)||k_(e))&&k_(e.then)&&k_(e.catch),setImmediate:tw,asap:ow,isIterable:e=>null!=e&&k_(e[w_])};function cw(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}sw.inherits(cw,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:sw.toJSONObject(this.config),code:this.code,status:this.status}}});const uw=cw.prototype,lw={};function dw(e){return sw.isPlainObject(e)||sw.isArray(e)}function fw(e){return sw.endsWith(e,"[]")?e.slice(0,-2):e}function hw(e,t,n){return e?e.concat(t).map((function(e,t){return e=fw(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{lw[e]={value:e}})),Object.defineProperties(cw,lw),Object.defineProperty(uw,"isAxiosError",{value:!0}),cw.from=(e,t,n,r,i,a)=>{const o=Object.create(uw);return sw.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),cw.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,a&&Object.assign(o,a),o};const pw=sw.toFlatObject(sw,{},null,(function(e){return/^is[A-Z]/.test(e)}));function mw(e,t,n){if(!sw.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=sw.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!sw.isUndefined(t[e])}))).metaTokens,i=n.visitor||u,a=n.dots,o=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&sw.isSpecCompliantForm(t);if(!sw.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(sw.isDate(e))return e.toISOString();if(!s&&sw.isBlob(e))throw new cw("Blob is not supported. Use a Buffer instead.");return sw.isArrayBuffer(e)||sw.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,i){let s=e;if(e&&!i&&"object"==typeof e)if(sw.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(sw.isArray(e)&&function(e){return sw.isArray(e)&&!e.some(dw)}(e)||(sw.isFileList(e)||sw.endsWith(n,"[]"))&&(s=sw.toArray(e)))return n=fw(n),s.forEach((function(e,r){!sw.isUndefined(e)&&null!==e&&t.append(!0===o?hw([n],r,a):null===o?n:n+"[]",c(e))})),!1;return!!dw(e)||(t.append(hw(i,n,a),c(e)),!1)}const l=[],d=Object.assign(pw,{defaultVisitor:u,convertValue:c,isVisitable:dw});if(!sw.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!sw.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),sw.forEach(n,(function(n,a){!0===(!(sw.isUndefined(n)||null===n)&&i.call(t,n,sw.isString(a)?Db(a).call(a):a,r,d))&&e(n,r?r.concat(a):[a])})),l.pop()}}(e),t}function gw(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function vw(e,t){this._pairs=[],e&&mw(e,this,t)}const yw=vw.prototype;function bw(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function _w(e,t,n){if(!t)return e;const r=n&&n.encode||bw;sw.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let a;if(a=i?i(t,n):sw.isURLSearchParams(t)?t.toString():new vw(t,n).toString(r),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}yw.append=function(e,t){this._pairs.push([e,t])},yw.toString=function(e){const t=e?function(t){return e.call(this,t,gw)}:gw;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var ww=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){sw.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Ew={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Sw={exports:{}},Cw=kn,xw=N,Tw=$t.f;Cw({target:"Object",stat:!0,forced:Object.defineProperty!==Tw,sham:!xw},{defineProperty:Tw});var Rw=ee.Object,Iw=Sw.exports=function(e,t,n){return Rw.defineProperty(e,t,n)};Rw.defineProperty.sham&&(Iw.sham=!0);var Nw=r(Sw.exports),Aw=TypeError,kw=oi,Dw=Jc,Mw=$,Lw=pt("species"),Ow=Array,Pw=function(e){var t;return kw(e)&&(t=e.constructor,(Dw(t)&&(t===Ow||kw(t.prototype))||Mw(t)&&null===(t=t[Lw]))&&(t=void 0)),void 0===t?Ow:t},jw=function(e,t){return new(Pw(e))(0===t?0:t)},Fw=i,Uw=me,Bw=pt("species"),Vw=function(e){return Uw>=51||!Fw((function(){var t=[];return(t.constructor={})[Bw]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},zw=kn,Ww=i,Gw=oi,Hw=$,Yw=Je,qw=Hn,Kw=function(e){if(e>9007199254740991)throw Aw("Maximum allowed index exceeded");return e},Xw=qm,Qw=jw,Jw=Vw,Zw=me,$w=pt("isConcatSpreadable"),eE=Zw>=51||!Ww((function(){var e=[];return e[$w]=!1,e.concat()[0]!==e})),tE=function(e){if(!Hw(e))return!1;var t=e[$w];return void 0!==t?!!t:Gw(e)};zw({target:"Array",proto:!0,arity:1,forced:!eE||!Jw("concat")},{concat:function(e){var t,n,r,i,a,o=Yw(this),s=Qw(o,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(tE(a=-1===t?o:arguments[t]))for(i=qw(a),Kw(c+i),n=0;n<i;n++,c++)n in a&&Xw(s,c,a[n]);else Kw(c+1),Xw(s,c++,a);return s.length=c,s}});var nE={},rE=E,iE=J,aE=Vi.f,oE=ou,sE="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];nE.f=function(e){return sE&&"Window"===rE(e)?function(e){try{return aE(e)}catch(e){return oE(sE)}}(e):aE(iE(e))};var cE={},uE=pt;cE.f=uE;var lE=ee,dE=et,fE=cE,hE=$t.f,pE=function(e){var t=lE.Symbol||(lE.Symbol={});dE(t,e)||hE(t,e,{value:fE.f(e)})},mE=D,gE=ae,vE=pt,yE=Cs,bE=function(){var e=gE("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=vE("toPrimitive");t&&!t[r]&&yE(t,r,(function(e){return mE(n,this)}),{arity:1})},_E=Zt,wE=G,EE=Je,SE=Hn,CE=jw,xE=l([].push),TE=function(e){var t=1===e,n=2===e,r=3===e,i=4===e,a=6===e,o=7===e,s=5===e||a;return function(c,u,l,d){for(var f,h,p=EE(c),m=wE(p),g=SE(m),v=_E(u,l),y=0,b=d||CE,_=t?b(c,g):n||o?b(c,0):void 0;g>y;y++)if((s||y in m)&&(h=v(f=m[y],y,p),e))if(t)_[y]=h;else if(h)switch(e){case 3:return!0;case 5:return f;case 6:return y;case 2:xE(_,f)}else switch(e){case 4:return!1;case 7:xE(_,f)}return a?-1:r||i?i:_}},RE={forEach:TE(0),map:TE(1),filter:TE(2),some:TE(3),every:TE(4),find:TE(5),findIndex:TE(6),filterReject:TE(7)},IE=kn,NE=h,AE=D,kE=l,DE=N,ME=be,LE=i,OE=et,PE=d,jE=an,FE=J,UE=Ct,BE=br,VE=U,zE=La,WE=fa,GE=Vi,HE=nE,YE=Zi,qE=I,KE=$t,XE=ua,QE=M,JE=Cs,ZE=Sc,$E=Ke,eS=zi,tS=at,nS=pt,rS=cE,iS=pE,aS=bE,oS=Ws,sS=gs,cS=RE.forEach,uS=_i("hidden"),lS="Symbol",dS="prototype",fS=sS.set,hS=sS.getterFor(lS),pS=Object[dS],mS=NE.Symbol,gS=mS&&mS[dS],vS=NE.RangeError,yS=NE.TypeError,bS=NE.QObject,_S=qE.f,wS=KE.f,ES=HE.f,SS=QE.f,CS=kE([].push),xS=$E("symbols"),TS=$E("op-symbols"),RS=$E("wks"),IS=!bS||!bS[dS]||!bS[dS].findChild,NS=function(e,t,n){var r=_S(pS,t);r&&delete pS[t],wS(e,t,n),r&&e!==pS&&wS(pS,t,r)},AS=DE&&LE((function(){return 7!==zE(wS({},"a",{get:function(){return wS(this,"a",{value:7}).a}})).a}))?NS:wS,kS=function(e,t){var n=xS[e]=zE(gS);return fS(n,{type:lS,tag:e,description:t}),DE||(n.description=t),n},DS=function(e,t,n){e===pS&&DS(TS,t,n),jE(e);var r=UE(t);return jE(n),OE(xS,r)?(n.enumerable?(OE(e,uS)&&e[uS][r]&&(e[uS][r]=!1),n=zE(n,{enumerable:VE(0,!1)})):(OE(e,uS)||wS(e,uS,VE(1,zE(null))),e[uS][r]=!0),AS(e,r,n)):wS(e,r,n)},MS=function(e,t){jE(e);var n=FE(t),r=WE(n).concat(jS(n));return cS(r,(function(t){DE&&!AE(LS,n,t)||DS(e,t,n[t])})),e},LS=function(e){var t=UE(e),n=AE(SS,this,t);return!(this===pS&&OE(xS,t)&&!OE(TS,t))&&(!(n||!OE(this,t)||!OE(xS,t)||OE(this,uS)&&this[uS][t])||n)},OS=function(e,t){var n=FE(e),r=UE(t);if(n!==pS||!OE(xS,r)||OE(TS,r)){var i=_S(n,r);return!i||!OE(xS,r)||OE(n,uS)&&n[uS][r]||(i.enumerable=!0),i}},PS=function(e){var t=ES(FE(e)),n=[];return cS(t,(function(e){OE(xS,e)||OE(eS,e)||CS(n,e)})),n},jS=function(e){var t=e===pS,n=ES(t?TS:FE(e)),r=[];return cS(n,(function(e){!OE(xS,e)||t&&!OE(pS,e)||CS(r,xS[e])})),r};ME||(mS=function(){if(PE(gS,this))throw new yS("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?BE(arguments[0]):void 0,t=tS(e),n=function(e){var r=void 0===this?NE:this;r===pS&&AE(n,TS,e),OE(r,uS)&&OE(r[uS],t)&&(r[uS][t]=!1);var i=VE(1,e);try{AS(r,t,i)}catch(e){if(!(e instanceof vS))throw e;NS(r,t,i)}};return DE&&IS&&AS(pS,t,{configurable:!0,set:n}),kS(t,e)},JE(gS=mS[dS],"toString",(function(){return hS(this).tag})),JE(mS,"withoutSetter",(function(e){return kS(tS(e),e)})),QE.f=LS,KE.f=DS,XE.f=MS,qE.f=OS,GE.f=HE.f=PS,YE.f=jS,rS.f=function(e){return kS(nS(e),e)},DE&&ZE(gS,"description",{configurable:!0,get:function(){return hS(this).description}})),IE({global:!0,constructor:!0,wrap:!0,forced:!ME,sham:!ME},{Symbol:mS}),cS(WE(RS),(function(e){iS(e)})),IE({target:lS,stat:!0,forced:!ME},{useSetter:function(){IS=!0},useSimple:function(){IS=!1}}),IE({target:"Object",stat:!0,forced:!ME,sham:!DE},{create:function(e,t){return void 0===t?zE(e):MS(zE(e),t)},defineProperty:DS,defineProperties:MS,getOwnPropertyDescriptor:OS}),IE({target:"Object",stat:!0,forced:!ME},{getOwnPropertyNames:PS}),aS(),oS(mS,lS),eS[uS]=!0;var FS=be&&!!Symbol.for&&!!Symbol.keyFor,US=kn,BS=ae,VS=et,zS=br,WS=Ke,GS=FS,HS=WS("string-to-symbol-registry"),YS=WS("symbol-to-string-registry");US({target:"Symbol",stat:!0,forced:!GS},{for:function(e){var t=zS(e);if(VS(HS,t))return HS[t];var n=BS("Symbol")(t);return HS[t]=n,YS[n]=t,n}});var qS=kn,KS=et,XS=xe,QS=Re,JS=FS,ZS=Ke("symbol-to-string-registry");qS({target:"Symbol",stat:!0,forced:!JS},{keyFor:function(e){if(!XS(e))throw new TypeError(QS(e)+" is not a symbol");if(KS(ZS,e))return ZS[e]}});var $S=oi,eC=R,tC=E,nC=br,rC=l([].push),iC=kn,aC=ae,oC=y,sC=D,cC=l,uC=i,lC=R,dC=xe,fC=ou,hC=function(e){if(eC(e))return e;if($S(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?rC(n,i):"number"!=typeof i&&"Number"!==tC(i)&&"String"!==tC(i)||rC(n,nC(i))}var a=n.length,o=!0;return function(e,t){if(o)return o=!1,t;if($S(this))return t;for(var r=0;r<a;r++)if(n[r]===e)return t}}},pC=be,mC=String,gC=aC("JSON","stringify"),vC=cC(/./.exec),yC=cC("".charAt),bC=cC("".charCodeAt),_C=cC("".replace),wC=cC(1..toString),EC=/[\uD800-\uDFFF]/g,SC=/^[\uD800-\uDBFF]$/,CC=/^[\uDC00-\uDFFF]$/,xC=!pC||uC((function(){var e=aC("Symbol")("stringify detection");return"[null]"!==gC([e])||"{}"!==gC({a:e})||"{}"!==gC(Object(e))})),TC=uC((function(){return'"\\udf06\\ud834"'!==gC("\udf06\ud834")||'"\\udead"'!==gC("\udead")})),RC=function(e,t){var n=fC(arguments),r=hC(t);if(lC(r)||void 0!==e&&!dC(e))return n[1]=function(e,t){if(lC(r)&&(t=sC(r,this,mC(e),t)),!dC(t))return t},oC(gC,null,n)},IC=function(e,t,n){var r=yC(n,t-1),i=yC(n,t+1);return vC(SC,e)&&!vC(CC,i)||vC(CC,e)&&!vC(SC,r)?"\\u"+wC(bC(e,0),16):e};gC&&iC({target:"JSON",stat:!0,arity:3,forced:xC||TC},{stringify:function(e,t,n){var r=fC(arguments),i=oC(xC?RC:gC,null,r);return TC&&"string"==typeof i?_C(i,EC,IC):i}});var NC=Zi,AC=Je;kn({target:"Object",stat:!0,forced:!be||i((function(){NC.f(1)}))},{getOwnPropertySymbols:function(e){var t=NC.f;return t?t(AC(e)):[]}}),pE("asyncIterator"),pE("hasInstance"),pE("isConcatSpreadable"),pE("iterator"),pE("match"),pE("matchAll"),pE("replace"),pE("search"),pE("species"),pE("split");var kC=bE;pE("toPrimitive"),kC();var DC=ae,MC=Ws;pE("toStringTag"),MC(DC("Symbol"),"Symbol"),pE("unscopables"),Ws(h.JSON,"JSON",!0);var LC=ee.Symbol,OC=pt,PC=$t.f,jC=OC("metadata"),FC=Function.prototype;void 0===FC[jC]&&PC(FC,jC,{value:null}),pE("asyncDispose"),pE("dispose"),pE("metadata");var UC=LC,BC=l,VC=ae("Symbol"),zC=VC.keyFor,WC=BC(VC.prototype.valueOf),GC=VC.isRegisteredSymbol||function(e){try{return void 0!==zC(WC(e))}catch(e){return!1}};kn({target:"Symbol",stat:!0},{isRegisteredSymbol:GC});for(var HC=Ke,YC=ae,qC=l,KC=xe,XC=pt,QC=YC("Symbol"),JC=QC.isWellKnownSymbol,ZC=YC("Object","getOwnPropertyNames"),$C=qC(QC.prototype.valueOf),ex=HC("wks"),tx=0,nx=ZC(QC),rx=nx.length;tx<rx;tx++)try{var ix=nx[tx];KC(QC[ix])&&XC(ix)}catch(e){}var ax=function(e){if(JC&&JC(e))return!0;try{for(var t=$C(e),n=0,r=ZC(ex),i=r.length;n<i;n++)if(ex[r[n]]==t)return!0}catch(e){}return!1};kn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:ax}),pE("customMatcher"),pE("observable"),kn({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:GC}),kn({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:ax}),pE("matcher"),pE("metadataKey"),pE("patternMatch"),pE("replaceAll");var ox=r(UC),sx=r(cE.f("iterator"));function cx(e){return cx="function"==typeof ox&&"symbol"==typeof sx?function(e){return typeof e}:function(e){return e&&"function"==typeof ox&&e.constructor===ox&&e!==ox.prototype?"symbol":typeof e},cx(e)}var ux=r(cE.f("toPrimitive"));function lx(e){var t=function(e,t){if("object"!=cx(e)||!e)return e;var n=e[ux];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=cx(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==cx(t)?t:t+""}function dx(e,t,n){return(t=lx(t))in e?Nw(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fx=r(Im),hx={isBrowser:!0,classes:{URLSearchParams:void 0!==fx?fx:vw,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const px="undefined"!=typeof window&&"undefined"!=typeof document,mx="object"==typeof navigator&&navigator||void 0,gx=px&&(!mx||["ReactNative","NativeScript","NS"].indexOf(mx.product)<0),vx="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,yx=px&&window.location.href||"http://localhost";function bx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bx(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wx=_x(_x({},Object.freeze({__proto__:null,hasBrowserEnv:px,hasStandardBrowserEnv:gx,hasStandardBrowserWebWorkerEnv:vx,navigator:mx,origin:yx})),hx),Ex=an,Sx=D,Cx=et,xx=d,Tx=function(){var e=Ex(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Rx=RegExp.prototype,Ix=function(e){var t=e.flags;return void 0!==t||"flags"in Rx||Cx(e,"flags")||!xx(Rx,e)?t:Sx(Tx,e)},Nx=Vf.charAt,Ax=D,kx=an,Dx=R,Mx=E,Lx=/./.exec,Ox=TypeError,Px=kn,jx=D,Fx=x,Ux=Qs,Bx=hc,Vx=K,zx=Wn,Wx=br,Gx=an,Hx=$,Yx=E,qx=ar,Kx=Ix,Xx=Le,Qx=i,Jx=au,Zx=function(e,t,n){return t+(n?Nx(e,t).length:1)},$x=function(e,t){var n=e.exec;if(Dx(n)){var r=Ax(n,e,t);return null!==r&&kx(r),r}if("RegExp"===Mx(e))return Ax(Lx,e,t);throw new Ox("RegExp#exec called on incompatible receiver")},eT=gs,tT=pt("matchAll"),nT="RegExp String",rT=nT+" Iterator",iT=eT.set,aT=eT.getterFor(rT),oT=TypeError,sT=Fx("".indexOf),cT=Fx("".matchAll),uT=!!cT&&!Qx((function(){cT("a",/./)})),lT=Ux((function(e,t,n,r){iT(this,{type:rT,regexp:e,string:t,global:n,unicode:r,done:!1})}),nT,(function(){var e=aT(this);if(e.done)return Bx(void 0,!0);var t=e.regexp,n=e.string,r=$x(t,n);return null===r?(e.done=!0,Bx(void 0,!0)):e.global?(""===Wx(r[0])&&(t.lastIndex=Zx(n,zx(t.lastIndex),e.unicode)),Bx(r,!1)):(e.done=!0,Bx(r,!1))})),dT=function(e){var t,n,r,i=Gx(this),a=Wx(e),o=Jx(i,RegExp),s=Wx(Kx(i));return t=new o(o===RegExp?i.source:i,s),n=!!~sT(s,"g"),r=!!~sT(s,"u"),t.lastIndex=zx(i.lastIndex),new lT(t,a,n,r)};Px({target:"String",proto:!0,forced:uT},{matchAll:function(e){var t,n,r,i,a=Vx(this);if(Hx(e)){if(qx(e)&&(t=Wx(Vx(Kx(e))),!~sT(t,"g")))throw new oT("`.matchAll` does not allow non-global regexes");if(uT)return cT(a,e);if(void 0===(r=Xx(e,tT))&&"RegExp"===Yx(e)&&(r=dT),r)return jx(r,e,a)}else if(uT)return cT(a,e);return n=Wx(a),i=new RegExp(e,"g"),jx(dT,i,n)}});var fT=er("String","matchAll"),hT=d,pT=fT,mT=String.prototype,gT=function(e){var t=e.matchAll;return"string"==typeof e||e===mT||hT(mT,e)&&t===mT.matchAll?pT:t},vT=r(gT);function yT(e){function t(e,n,r,i){let a=e[i++];if("__proto__"===a)return!0;const o=Number.isFinite(+a),s=i>=e.length;return a=!a&&sw.isArray(r)?r.length:a,s?(sw.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!o):(r[a]&&sw.isObject(r[a])||(r[a]=[]),t(e,n,r[a],i)&&sw.isArray(r[a])&&(r[a]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let a;for(r=0;r<i;r++)a=n[r],t[a]=e[a];return t}(r[a])),!o)}if(sw.isFormData(e)&&sw.isFunction(e.entries)){const n={};return sw.forEachEntry(e,((e,r)=>{t(function(e){return vT(sw).call(sw,/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null}const bT={transitional:Ew,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=sw.isObject(e);if(i&&sw.isHTMLForm(e)&&(e=new FormData(e)),sw.isFormData(e))return r?JSON.stringify(yT(e)):e;if(sw.isArrayBuffer(e)||sw.isBuffer(e)||sw.isStream(e)||sw.isFile(e)||sw.isBlob(e)||sw.isReadableStream(e))return e;if(sw.isArrayBufferView(e))return e.buffer;if(sw.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return mw(e,new wx.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return wx.isNode&&sw.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=sw.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return mw(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(sw.isString(e))try{return(t||JSON.parse)(e),Db(sw).call(sw,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||bT.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(sw.isResponse(e)||sw.isReadableStream(e))return e;if(e&&sw.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw cw.from(e,cw.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:wx.classes.FormData,Blob:wx.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};sw.forEach(["delete","get","head","post","put","patch"],(e=>{bT.headers[e]={}}));var _T=bT;const wT=sw.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ET=Symbol("internals");function ST(e){var t;return e&&Db(t=String(e)).call(t).toLowerCase()}function CT(e){return!1===e||null==e?e:sw.isArray(e)?e.map(CT):String(e)}function xT(e,t,n,r,i){return sw.isFunction(r)?r.call(this,t,n):(i&&(t=n),sw.isString(t)?sw.isString(r)?-1!==t.indexOf(r):sw.isRegExp(r)?r.test(t):void 0:void 0)}class TT{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=ST(t);if(!i)throw new Error("header name must be a non-empty string");const a=sw.findKey(r,i);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=CT(e))}const a=(e,t)=>sw.forEach(e,((e,n)=>i(e,n,t)));if(sw.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(sw.isString(e)&&(e=Db(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Db(o=e).call(o)))a((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){var a,o;i=e.indexOf(":"),n=Db(a=e.substring(0,i)).call(a).toLowerCase(),r=Db(o=e.substring(i+1)).call(o),!n||t[n]&&wT[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t);else if(sw.isObject(e)&&sw.isIterable(e)){let n,r,i={};for(const t of e){if(!sw.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[r=t[0]]=(n=i[r])?sw.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}a(i,t)}else null!=e&&i(t,e,n);var o;return this}get(e,t){if(e=ST(e)){const n=sw.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(sw.isFunction(t))return t.call(this,e,n);if(sw.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ST(e)){const n=sw.findKey(this,e);return!(!n||void 0===this[n]||t&&!xT(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=ST(e)){const i=sw.findKey(n,e);!i||t&&!xT(0,n[i],i,t)||(delete n[i],r=!0)}}return sw.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!xT(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return sw.forEach(this,((r,i)=>{var a;const o=sw.findKey(n,i);if(o)return t[o]=CT(r),void delete t[i];const s=e?function(e){return Db(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):Db(a=String(i)).call(a);s!==i&&delete t[i],t[s]=CT(r),n[s]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return sw.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&sw.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[ET]=this[ET]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=ST(e);t[r]||(function(e,t){const n=sw.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return sw.isArray(e)?e.forEach(r):r(e),this}}TT.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),sw.reduceDescriptors(TT.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),sw.freezeMethods(TT);var RT=TT;function IT(e,t){const n=this||_T,r=t||n,i=RT.from(r.headers);let a=r.data;return sw.forEach(e,(function(e){a=e.call(n,a,i.normalize(),t?t.status:void 0)})),i.normalize(),a}function NT(e){return!(!e||!e.__CANCEL__)}function AT(e,t,n){cw.call(this,null==e?"canceled":e,cw.ERR_CANCELED,t,n),this.name="CanceledError"}function kT(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new cw("Request failed with status code "+n.status,[cw.ERR_BAD_REQUEST,cw.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}sw.inherits(AT,cw,{__CANCEL__:!0});const DT=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const i=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,a=0,o=0;return t=void 0!==t?t:1e3,function(s){const c=Date.now(),u=r[o];i||(i=c),n[a]=s,r[a]=c;let l=o,d=0;for(;l!==a;)d+=n[l++],l%=e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),c-i<t)return;const f=u&&c-u;return f?Math.round(1e3*d/f):void 0}}(50,250);return function(e,t){let n,r,i=0,a=1e3/t;const o=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=a,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-i;for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];t>=a?o(c,e):(n=c,r||(r=setTimeout((()=>{r=null,o(n)}),a-t)))},()=>n&&o(n)]}((n=>{const a=n.loaded,o=n.lengthComputable?n.total:void 0,s=a-r,c=i(s);r=a,e({loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:c||void 0,estimated:c&&o&&a<=o?(o-a)/c:void 0,event:n,lengthComputable:null!=o,[t?"download":"upload"]:!0})}),n)},MT=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},LT=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return sw.asap((()=>e(...n)))};var OT=wx.hasStandardBrowserEnv?((e,t)=>n=>(n=new wy(n,wx.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new wy(wx.origin),wx.navigator&&/(msie|trident)/i.test(wx.navigator.userAgent)):()=>!0,PT=wx.hasStandardBrowserEnv?{write(e,t,n,r,i,a){const o=[e+"="+encodeURIComponent(t)];sw.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),sw.isString(r)&&o.push("path="+r),sw.isString(i)&&o.push("domain="+i),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function jT(e,t,n){let r=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}function FT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const UT=e=>e instanceof RT?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?FT(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e):e;function BT(e,t){t=t||{};const n={};function r(e,t,n,r){return sw.isPlainObject(e)&&sw.isPlainObject(t)?sw.merge.call({caseless:r},e,t):sw.isPlainObject(t)?sw.merge({},t):sw.isArray(t)?t.slice():t}function i(e,t,n,i){return sw.isUndefined(t)?sw.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function a(e,t){if(!sw.isUndefined(t))return r(void 0,t)}function o(e,t){return sw.isUndefined(t)?sw.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,a){return a in t?r(n,i):a in e?r(void 0,n):void 0}const c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(e,t,n)=>i(UT(e),UT(t),0,!0)};return sw.forEach(Object.keys(Object.assign({},e,t)),(function(r){const a=c[r]||i,o=a(e[r],t[r],r);sw.isUndefined(o)&&a!==s||(n[r]=o)})),n}var VT=e=>{const t=BT({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:a,xsrfCookieName:o,headers:s,auth:c}=t;if(t.headers=s=RT.from(s),t.url=_w(jT(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&s.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),sw.isFormData(r))if(wx.hasStandardBrowserEnv||wx.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(n=s.getContentType())){const[e,...t]=n?n.split(";").map((e=>Db(e).call(e))).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(wx.hasStandardBrowserEnv&&(i&&sw.isFunction(i)&&(i=i(t)),i||!1!==i&&OT(t.url))){const e=a&&o&&PT.read(o);e&&s.set(a,e)}return t},zT="undefined"!=typeof XMLHttpRequest&&function(e){return new rh((function(t,n){const r=VT(e);let i=r.data;const a=RT.from(r.headers).normalize();let o,s,c,u,l,{responseType:d,onUploadProgress:f,onDownloadProgress:h}=r;function p(){u&&u(),l&&l(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let m=new XMLHttpRequest;function g(){if(!m)return;const r=RT.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());kT((function(e){t(e),p()}),(function(e){n(e),p()}),{data:d&&"text"!==d&&"json"!==d?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:r,config:e,request:m}),m=null}m.open(r.method.toUpperCase(),r.url,!0),m.timeout=r.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(g)},m.onabort=function(){m&&(n(new cw("Request aborted",cw.ECONNABORTED,e,m)),m=null)},m.onerror=function(){n(new cw("Network Error",cw.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const i=r.transitional||Ew;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new cw(t,i.clarifyTimeoutError?cw.ETIMEDOUT:cw.ECONNABORTED,e,m)),m=null},void 0===i&&a.setContentType(null),"setRequestHeader"in m&&sw.forEach(a.toJSON(),(function(e,t){m.setRequestHeader(t,e)})),sw.isUndefined(r.withCredentials)||(m.withCredentials=!!r.withCredentials),d&&"json"!==d&&(m.responseType=r.responseType),h&&([c,l]=DT(h,!0),m.addEventListener("progress",c)),f&&m.upload&&([s,u]=DT(f),m.upload.addEventListener("progress",s),m.upload.addEventListener("loadend",u)),(r.cancelToken||r.signal)&&(o=t=>{m&&(n(!t||t.type?new AT(null,e,m):t),m.abort(),m=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);v&&-1===wx.protocols.indexOf(v)?n(new cw("Unsupported protocol "+v+":",cw.ERR_BAD_REQUEST,e)):m.send(i||null)}))},WT=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,o();const t=e instanceof Error?e:this.reason;r.abort(t instanceof cw?t:new AT(t instanceof Error?t.message:t))}};let a=t&&setTimeout((()=>{a=null,i(new cw("timeout ".concat(t," of ms exceeded"),cw.ETIMEDOUT))}),t);const o=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)})),e=null)};e.forEach((e=>e.addEventListener("abort",i)));const{signal:s}=r;return s.unsubscribe=()=>sw.asap(o),s}},GT=r(nh),HT=cE.f("asyncIterator"),YT=r(HT);function qT(e,t){this.v=e,this.k=t}function KT(e){return function(){return new XT(e.apply(this,arguments))}}function XT(e){var t,n;function r(t,n){try{var a=e[t](n),o=a.value,s=o instanceof qT;GT.resolve(s?o.v:o).then((function(n){if(s){var c="return"===t?"return":"next";if(!o.k||n.done)return r(c,n);n=e[c](n).value}i(a.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new GT((function(a,o){var s={key:e,arg:i,resolve:a,reject:o,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function QT(e){return new qT(e,0)}function JT(e){var t={},n=!1;function r(t,r){return n=!0,r=new GT((function(n){n(e[t](r))})),{done:!1,value:new qT(r,1)}}return t[void 0!==ox&&sx||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}XT.prototype["function"==typeof ox&&YT||"@@asyncIterator"]=function(){return this},XT.prototype.next=function(e){return this._invoke("next",e)},XT.prototype.throw=function(e){return this._invoke("throw",e)},XT.prototype.return=function(e){return this._invoke("return",e)};var ZT=r(HT);function $T(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=ZT,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new eR(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function eR(e){function t(e){if(Object(e)!==e)return rh.reject(new TypeError(e+" is not an object."));var t=e.done;return rh.resolve(e.value).then((function(e){return{value:e,done:t}}))}return eR=function(e){this.s=e,this.n=e.next},eR.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?rh.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?rh.reject(e):t(n.apply(this.s,arguments))}},new eR(e)}const tR=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},nR=function(){var e=KT((function*(e,t){var n,r=!1,i=!1;try{for(var a,o=$T(rR(e));r=!(a=yield QT(o.next())).done;r=!1){const e=a.value;yield*JT($T(tR(e,t)))}}catch(e){i=!0,n=e}finally{try{r&&null!=o.return&&(yield QT(o.return()))}finally{if(i)throw n}}}));return function(t,n){return e.apply(this,arguments)}}(),rR=function(){var e=KT((function*(e){if(e[ZT])return void(yield*JT($T(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield QT(t.read());if(e)break;yield n}}finally{yield QT(t.cancel())}}));return function(t){return e.apply(this,arguments)}}(),iR=(e,t,n,r)=>{const i=nR(e,t);let a,o=0,s=e=>{a||(a=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return s(),void e.close();let a=r.byteLength;if(n){let e=o+=a;n(e)}e.enqueue(new Uint8Array(r))}catch(e){throw s(e),e}},cancel:e=>(s(e),i.return())},{highWaterMark:2})};function aR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aR(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const sR="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,cR=sR&&"function"==typeof ReadableStream,uR=sR&&("function"==typeof TextEncoder?(lR=new TextEncoder,e=>lR.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var lR;const dR=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(e){return!1}},fR=cR&&dR((()=>{let e=!1;const t=new Request(wx.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),hR=cR&&dR((()=>sw.isReadableStream(new Response("").body))),pR={stream:hR&&(e=>e.body)};var mR;sR&&(mR=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!pR[e]&&(pR[e]=sw.isFunction(mR[e])?t=>t[e]():(t,n)=>{throw new cw("Response type '".concat(e,"' is not supported"),cw.ERR_NOT_SUPPORT,n)})})));const gR=async(e,t)=>{const n=sw.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(sw.isBlob(e))return e.size;if(sw.isSpecCompliantForm(e)){const t=new Request(wx.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return sw.isArrayBufferView(e)||sw.isArrayBuffer(e)?e.byteLength:(sw.isURLSearchParams(e)&&(e+=""),sw.isString(e)?(await uR(e)).byteLength:void 0)})(t):n};var vR=sR&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:a,timeout:o,onDownloadProgress:s,onUploadProgress:c,responseType:u,headers:l,withCredentials:d="same-origin",fetchOptions:f}=VT(e);u=u?(u+"").toLowerCase():"text";let h,p=WT([i,a&&a.toAbortSignal()],o);const m=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let g;try{if(c&&fR&&"get"!==n&&"head"!==n&&0!==(g=await gR(l,r))){let e,n=new Request(t,{method:"POST",body:r,duplex:"half"});if(sw.isFormData(r)&&(e=n.headers.get("content-type"))&&l.setContentType(e),n.body){const[e,t]=MT(g,DT(LT(c)));r=iR(n.body,65536,e,t)}}sw.isString(d)||(d=d?"include":"omit");const i="credentials"in Request.prototype;h=new Request(t,oR(oR({},f),{},{signal:p,method:n.toUpperCase(),headers:l.normalize().toJSON(),body:r,duplex:"half",credentials:i?d:void 0}));let a=await fetch(h);const o=hR&&("stream"===u||"response"===u);if(hR&&(s||o&&m)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=a[t]}));const t=sw.toFiniteNumber(a.headers.get("content-length")),[n,r]=s&&MT(t,DT(LT(s),!0))||[];a=new Response(iR(a.body,65536,n,(()=>{r&&r(),m&&m()})),e)}u=u||"text";let v=await pR[sw.findKey(pR,u)||"text"](a,e);return!o&&m&&m(),await new rh(((t,n)=>{kT(t,n,{data:v,headers:RT.from(a.headers),status:a.status,statusText:a.statusText,config:e,request:h})}))}catch(t){if(m&&m(),t&&"TypeError"===t.name&&/Load failed|fetch/i.test(t.message))throw Object.assign(new cw("Network Error",cw.ERR_NETWORK,e,h),{cause:t.cause||t});throw cw.from(t,t&&t.code,e,h)}});const yR={http:null,xhr:zT,fetch:vR};sw.forEach(yR,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const bR=e=>"- ".concat(e),_R=e=>sw.isFunction(e)||null===e||!1===e;var wR={getAdapter:e=>{e=sw.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let a=0;a<t;a++){let t;if(n=e[a],r=n,!_R(n)&&(r=yR[(t=String(n)).toLowerCase()],void 0===r))throw new cw("Unknown adapter '".concat(t,"'"));if(r)break;i[t||"#"+a]=r}if(!r){const e=Object.entries(i).map((e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));throw new cw("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(bR).join("\n"):" "+bR(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:yR};function ER(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new AT(null,e)}function SR(e){return ER(e),e.headers=RT.from(e.headers),e.data=IT.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),wR.getAdapter(e.adapter||_T.adapter)(e).then((function(t){return ER(e),t.data=IT.call(e,e.transformResponse,t),t.headers=RT.from(t.headers),t}),(function(t){return NT(t)||(ER(e),t&&t.response&&(t.response.data=IT.call(e,e.transformResponse,t.response),t.response.headers=RT.from(t.response.headers))),rh.reject(t)}))}const CR="1.9.0",xR={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{xR[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const TR={};xR.transitional=function(e,t,n){function r(e,t){return"[Axios v"+CR+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,a)=>{if(!1===e)throw new cw(r(i," has been removed"+(t?" in "+t:"")),cw.ERR_DEPRECATED);return t&&!TR[i]&&(TR[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,a)}},xR.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var RR={assertOptions:function(e,t,n){if("object"!=typeof e)throw new cw("options must be an object",cw.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const a=r[i],o=t[a];if(o){const t=e[a],n=void 0===t||o(t,a,e);if(!0!==n)throw new cw("option "+a+" must be "+n,cw.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new cw("Unknown option "+a,cw.ERR_BAD_OPTION)}},validators:xR};const IR=RR.validators;let NR=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ww,response:new ww}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=BT(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&RR.assertOptions(n,{silentJSONParsing:IR.transitional(IR.boolean),forcedJSONParsing:IR.transitional(IR.boolean),clarifyTimeoutError:IR.transitional(IR.boolean)},!1),null!=r&&(sw.isFunction(r)?t.paramsSerializer={serialize:r}:RR.assertOptions(r,{encode:IR.function,serialize:IR.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),RR.assertOptions(t,{baseUrl:IR.spelling("baseURL"),withXsrfToken:IR.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&sw.merge(i.common,i[t.method]);i&&sw.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=RT.concat(a,i);const o=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));const c=[];let u;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let l,d=0;if(!s){const e=[SR.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,c),l=e.length,u=rh.resolve(t);d<l;)u=u.then(e[d++],e[d++]);return u}l=o.length;let f=t;for(d=0;d<l;){const t=o[d++],n=o[d++];try{f=t(f)}catch(e){n.call(this,e);break}}try{u=SR.call(this,f)}catch(e){return rh.reject(e)}for(d=0,l=c.length;d<l;)u=u.then(c[d++],c[d++]);return u}getUri(e){return _w(jT((e=BT(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};sw.forEach(["delete","get","head","options"],(function(e){NR.prototype[e]=function(t,n){return this.request(BT(n||{},{method:e,url:t,data:(n||{}).data}))}})),sw.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(BT(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}NR.prototype[e]=t(),NR.prototype[e+"Form"]=t(!0)}));var AR=NR;class kR{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new rh((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new rh((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new AT(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new kR((function(t){e=t})),cancel:e}}}var DR=kR;const MR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(MR).forEach((e=>{let[t,n]=e;MR[n]=t}));var LR=MR;const OR=function e(t){const n=new AR(t),r=y_(AR.prototype.request,n);return sw.extend(r,AR.prototype,n,{allOwnKeys:!0}),sw.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(BT(t,n))},r}(_T);OR.Axios=AR,OR.CanceledError=AT,OR.CancelToken=DR,OR.isCancel=NT,OR.VERSION=CR,OR.toFormData=mw,OR.AxiosError=cw,OR.Cancel=OR.CanceledError,OR.all=function(e){return rh.all(e)},OR.spread=function(e){return function(t){return e.apply(null,t)}},OR.isAxiosError=function(e){return sw.isObject(e)&&!0===e.isAxiosError},OR.mergeConfig=BT,OR.AxiosHeaders=RT,OR.formToJSON=e=>yT(sw.isHTMLForm(e)?new FormData(e):e),OR.getAdapter=wR.getAdapter,OR.HttpStatusCode=LR,OR.default=OR;var PR=OR;const jR=()=>{};function FR(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:jR};return e.promise=new rh(((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}})),e}const UR=new Map,BR=new Map,VR=new Map;let zR=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),WR=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const GR=new Xb;let HR=GR.getResult(),YR=null;function qR(e){if(!YR){e&&GR.setUA(e),HR=GR.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return WR.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return WR.CHROME;case"Safari":case"Mobile Safari":return WR.SAFARI;case"Edge":return WR.EDGE;case"Firefox":return WR.FIREFOX;case"QQ":case"QQBrowser":return WR.QQ;case"Opera":return WR.OPERA;case"WeChat":return WR.WECHAT;default:return e.browser.name||""}}(HR),n=KR(HR),r=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(HR),i=HR.os.version,a=KR(HR,!1),o=HR.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:a,deviceType:o};YR={name:t,version:n,os:r,osVersion:i,browserVersion:a,deviceType:o}}return YR}function KR(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function XR(){return qR().os}function QR(){const e=qR();return"".concat(e.os," ").concat(e.osVersion)}function JR(){const e=qR();return!!("WebKit"===HR.engine.name&&e.os===zR.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==WR.SAFARI||rI()&&e.name!==WR.SAFARI)}function ZR(){return qR().name===WR.CHROME}function $R(){return qR().name===WR.SAFARI}function eI(){const e=qR();if(e.name!==WR.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}function tI(){return qR().name===WR.EDGE}function nI(){return qR().name===WR.FIREFOX}function rI(){return qR().os===zR.IOS}function iI(e){const t=qR();return!(t.name!==WR.CHROME||!t.osVersion)&&Number(t.version)>=e}function aI(e){const t=qR();return!(t.name!==WR.CHROME||!t.osVersion)&&Number(t.version)<e}function oI(e,t,n){const r=qR();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function sI(e){const t=qR();return!(t.name!==WR.EDGE||!t.osVersion)&&Number(t.version)>=e}function cI(e){const t=qR();return!(t.name!==WR.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function uI(e){const t=qR();return!(t.name!==WR.SAFARI||!t.osVersion)&&Number(t.version)>=e}function lI(e,t,n){const r=qR();if(r.os!==zR.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])>t||Number(i[0])>e:t?Number(i[0])===e&&Number(i[1])>=t||Number(i[0])>e:Number(i[0])>=e}function dI(e,t,n){const r=qR();if(r.os!==zR.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function fI(e,t,n){const r=qR();if(r.name!==WR.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function hI(e){const t=qR();return!(t.name!==WR.OPERA||!t.osVersion)&&Number(t.version)>=e}function pI(){const e=qR();if(e.os!==zR.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function mI(){const e=qR();if(e.os!==zR.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function gI(){const e=qR();if(e.os!==zR.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function vI(){const e=qR();if(e.os!==zR.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function yI(){return $R()&&navigator.maxTouchPoints>0}function bI(){return qR().name===WR.WECHAT}function _I(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function wI(){const e=XR();return function(){const{deviceType:e}=qR();return"mobile"===e||"tablet"===e}()||e===zR.ANDROID||e===zR.IOS||e===zR.HARMONY_OS}function EI(){const e=qR();return e.name!==WR.EDGE&&e.name!==WR.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function SI(){return XR()===zR.ANDROID}function CI(){const e=qR();return SI()&&(e.name===WR.CHROME||e.name===WR.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function xI(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function TI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function RI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TI(Object(n),!0).forEach((function(t){xI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let II=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),NI=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),xI(this,"code",void 0),xI(this,"message",void 0),xI(this,"data",void 0),xI(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function AI(e,t){if("boolean"!=typeof e)throw new NI(II.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function kI(e,t,n){if(!Lr(n).call(n,e))throw new NI(II.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function DI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new NI(II.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function MI(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new NI(II.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&DI(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&DI(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&DI(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&DI(e.ideal,"".concat(t,".ideal"),1,1/0)}else DI(e,t,1,1/0)}function LI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new NI(II.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!jI(e,n,r,i))throw new NI(II.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function OI(e,t){if(!Array.isArray(e))throw new NI(II.INVALID_PARAMS,"".concat(t," should be an array"))}function PI(e){return null==e}function jI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}var FI=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(FI||{}),UI=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(UI||{});const BI=new class{constructor(){xI(this,"_clientSize",null),xI(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),xI(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),xI(this,"getStyle",(e=>window.getComputedStyle(e,null))),xI(this,"checkCssVisibleProperty",(e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:a,opacity:o,filter:s}=r;return("none"===i||Lr(t=["hidden","collapse"]).call(t,a)||Number(o)<.1)&&(n=!1),!!n&&(s&&s.split(" ").filter((e=>{var t;const n=e.split("(")[0];return Lr(t=["brightness","blur","opacity"]).call(t,n)})).map((e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]})).forEach((e=>{const[t,r]=e;switch(t){case"brightness":(r<.1||r>3)&&(n=!1);break;case"blur":r>3&&(n=!1);break;case"opacity":r<.1&&(n=!1)}})),n)})),xI(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0;const i=e=>t(e);let a=e;for(;a&&r;)i(a)||(n=!1,r=!1),a=a.parentElement,a||(r=!1);return n})),xI(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),xI(this,"getSizeAboutClient",(e=>{const{width:t,height:n,left:r,right:i,top:a,bottom:o}=e.getBoundingClientRect(),s=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:a,bottom:o,clientWidth:s,clientHeight:c,clientMin:Math.min(s,c)}})),xI(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),xI(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),xI(this,"checkCoverForAPoint",((e,t,n)=>{const r=this.elementFromPoint(e,t);return null!==r&&r!==n})),xI(this,"getPointPositionList",(()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,a=t/6,o=[],s=10**6;for(let c=0;c<5;c++)for(let e=0;e<5;e++){const t=(n*s+(0===c?.1:4===c?(i*c*s-1e5)/s:i*c)*s)/s,u=(r*s+(0===e?.1:4===e?(a*e*s-1e5)/s:a*e)*s)/s;o.push({x:t,y:u})}return[...o]})),xI(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((e=>!!e)).length>6)),xI(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),xI(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:a,clientMin:o}=this._clientSize;let s,c,u,l;if(e<0)s=0;else{if(!(e<a))return!1;s=e}if(t<0)return!1;if(c=t<a?t:a,n<0)u=0;else{if(!(n<i))return!1;u=n}if(r<0)return!1;l=r<i?r:i;const d=c-s,f=l-u;return this.checkSizeIsVisible(d,f,o)})),xI(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),xI(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(FI.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(FI.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(FI.SIZE)}}return this.returnHiddenResult(FI.STYLE)}return this.returnHiddenResult(UI.UNMOUNTED)}return this.returnHiddenResult(UI.INVALID_HTML_ELEMENT)})),xI(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))))}};function VI(e){return(new TextEncoder).encode(e)}const zI=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},WI=async e=>function(e,t){let n="";return new Uint8Array(e).forEach((e=>{n+=e.toString(t).padStart(2,"0")})),n}(await crypto.subtle.digest("SHA-256",VI(e)),16);class GI{constructor(){xI(this,"_events",{}),xI(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map((e=>e.listener)):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map((e=>e));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let a=0;a<t.length;a+=1){const n=t[a];n.once&&this.off(e,n.listener),n.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach((t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}}))}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}let HI=null;function YI(){if(HI)return HI;if(window.electron)return HI=window.electron;if(!window.require)return null;try{return HI=window.require("electron"),HI}catch(e){return null}}let qI=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),KI=function(e){return e.TRACER="tracer",e}({});function XI(e){return DI(e.timeout,"config.timeout",0,1e5),DI(e.timeoutFactor,"config.timeoutFactor",0,100,!1),DI(e.maxRetryCount,"config.maxRetryConfig",0,1/0),DI(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let QI=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),JI=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function ZI(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((e=>{if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function $I(e){return LI(e.turnServerURL,"turnServerURL"),LI(e.username,"username"),LI(e.password,"password"),e.udpport&&DI(e.udpport,"udpport",1,99999,!0),e.forceturn&&AI(e.forceturn,"forceturn"),e.security&&AI(e.security,"security"),e.tcpport&&DI(e.tcpport,"tcpport",1,99999,!0),!0}function eN(e){return void 0!==e.level&&kI(e.level,"level",[1,2,3]),void 0!==e.delay&&DI(e.delay,"delay",0,3e3,!0),!0}let tN=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),nN=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),rN=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),iN=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function aN(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?rh.reject(new NI(II.UNEXPECTED_ERROR,"can not emit promise")):new rh(((n,i)=>{e.emit(t,...r,n,i)}))}function oN(e,t){if(0===e.getListeners(t).length)return rh.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return aN(e,t,...r)}function sN(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return cN(e,t,...r)}function cN(e,t){let n=null,r=null;for(var i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];if(e.emit(t,...a,(e=>{n=e}),(e=>{r=e})),null!==r)throw r;if(null===n)throw new NI(II.UNEXPECTED_ERROR,"handler is not sync");return n}const uN=new class extends GI{set networkState(e){this.emit(iN.NETWORK_STATE_CHANGE,e,this._networkState),e===rN.ONLINE?this.emit(iN.ONLINE):e===rN.OFFLINE&&(this.onlineWaiter=new rh((e=>{this.once(iN.ONLINE,(()=>{this.onlineWaiter=void 0,e(rN.ONLINE)}))})),this.emit(iN.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===rN.ONLINE}constructor(){super(),xI(this,"_moduleName","network-indicator"),xI(this,"_networkState",rN.ONLINE),xI(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=rN.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=rN.OFFLINE}))}};function lN(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function dN(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function fN(e){void 0!==rh?rh.resolve().then(e):setTimeout(e,0)}function hN(e){return JSON.parse(JSON.stringify(e))}function pN(e){try{return hN(e)}catch(t){return e}}const mN={};function gN(e,t){mN[t]||(mN[t]=!0,e())}function vN(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function yN(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function bN(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const e=new Uint8Array(t);e.set(n),n=e}return n}function _N(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=ii(t).call(t,((e,t)=>e+t.length),0),i=new Uint8Array(new ArrayBuffer(r));let a=0;return t.forEach((e=>{i.set(e,a),a+=e.length})),i}function wN(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function EN(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((e=>{t+="string"==typeof e?wN(e):e.size})),t+138}function SN(e){const t=new NI(II.TIMEOUT,"timeout");return new rh(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function CN(e){return new rh((t=>{window.setTimeout(t,e)}))}function xN(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+xN(e-n.length,"")}function TN(){return xN(32,"").toUpperCase()}const RN=()=>{},IN=new class{constructor(){xI(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,a=new Array(i>4?i-4:0),o=4;o<i;o++)a[o-4]=arguments[o];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);const o=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:o,args:a,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,RI(RI({},i),{},{fn:e,args:a,skipFn:r}))}else{const i=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:a,skipFn:r})}}},NN=IN.throttleByKey.bind(IN);function AN(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function kN(e,t){if(!AN(e)||!AN(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=kN(e[r],t[r]);return n}{const n=RI({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=kN(e[r],t[r]):n[r]=t[r]);return n}}function DN(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),0===e)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,!t||r!==t););return n}function MN(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function LN(e){return ii(e).call(e,((e,t)=>e+t),0)}function ON(e){const t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,a,o){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,o)),a),n)}function a(e,t,n,r,a,o,s){return i(t&n|~t&r,e,t,a,o,s)}function o(e,t,n,r,a,o,s){return i(t&r|n&~r,e,t,a,o,s)}function s(e,t,n,r,a,o,s){return i(t^n^r,e,t,a,o,s)}function c(e,t,n,r,a,o,s){return i(n^(t|~r),e,t,a,o,s)}const u=function(e){let t;const n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e);let l,d,f,h,p,m=1732584193,g=-271733879,v=-1732584194,y=271733878;for(l=0;l<u.length;l+=16)d=m,f=g,h=v,p=y,m=a(m,g,v,y,u[l+0],7,-680876936),y=a(y,m,g,v,u[l+1],12,-389564586),v=a(v,y,m,g,u[l+2],17,606105819),g=a(g,v,y,m,u[l+3],22,-1044525330),m=a(m,g,v,y,u[l+4],7,-176418897),y=a(y,m,g,v,u[l+5],12,1200080426),v=a(v,y,m,g,u[l+6],17,-1473231341),g=a(g,v,y,m,u[l+7],22,-45705983),m=a(m,g,v,y,u[l+8],7,1770035416),y=a(y,m,g,v,u[l+9],12,-1958414417),v=a(v,y,m,g,u[l+10],17,-42063),g=a(g,v,y,m,u[l+11],22,-1990404162),m=a(m,g,v,y,u[l+12],7,1804603682),y=a(y,m,g,v,u[l+13],12,-40341101),v=a(v,y,m,g,u[l+14],17,-1502002290),g=a(g,v,y,m,u[l+15],22,1236535329),m=o(m,g,v,y,u[l+1],5,-165796510),y=o(y,m,g,v,u[l+6],9,-1069501632),v=o(v,y,m,g,u[l+11],14,643717713),g=o(g,v,y,m,u[l+0],20,-373897302),m=o(m,g,v,y,u[l+5],5,-701558691),y=o(y,m,g,v,u[l+10],9,38016083),v=o(v,y,m,g,u[l+15],14,-660478335),g=o(g,v,y,m,u[l+4],20,-405537848),m=o(m,g,v,y,u[l+9],5,568446438),y=o(y,m,g,v,u[l+14],9,-1019803690),v=o(v,y,m,g,u[l+3],14,-187363961),g=o(g,v,y,m,u[l+8],20,1163531501),m=o(m,g,v,y,u[l+13],5,-1444681467),y=o(y,m,g,v,u[l+2],9,-51403784),v=o(v,y,m,g,u[l+7],14,1735328473),g=o(g,v,y,m,u[l+12],20,-1926607734),m=s(m,g,v,y,u[l+5],4,-378558),y=s(y,m,g,v,u[l+8],11,-2022574463),v=s(v,y,m,g,u[l+11],16,1839030562),g=s(g,v,y,m,u[l+14],23,-35309556),m=s(m,g,v,y,u[l+1],4,-1530992060),y=s(y,m,g,v,u[l+4],11,1272893353),v=s(v,y,m,g,u[l+7],16,-155497632),g=s(g,v,y,m,u[l+10],23,-1094730640),m=s(m,g,v,y,u[l+13],4,681279174),y=s(y,m,g,v,u[l+0],11,-358537222),v=s(v,y,m,g,u[l+3],16,-722521979),g=s(g,v,y,m,u[l+6],23,76029189),m=s(m,g,v,y,u[l+9],4,-640364487),y=s(y,m,g,v,u[l+12],11,-421815835),v=s(v,y,m,g,u[l+15],16,530742520),g=s(g,v,y,m,u[l+2],23,-995338651),m=c(m,g,v,y,u[l+0],6,-198630844),y=c(y,m,g,v,u[l+7],10,1126891415),v=c(v,y,m,g,u[l+14],15,-1416354905),g=c(g,v,y,m,u[l+5],21,-57434055),m=c(m,g,v,y,u[l+12],6,1700485571),y=c(y,m,g,v,u[l+3],10,-1894986606),v=c(v,y,m,g,u[l+10],15,-1051523),g=c(g,v,y,m,u[l+1],21,-2054922799),m=c(m,g,v,y,u[l+8],6,1873313359),y=c(y,m,g,v,u[l+15],10,-30611744),v=c(v,y,m,g,u[l+6],15,-1560198380),g=c(g,v,y,m,u[l+13],21,1309151649),m=c(m,g,v,y,u[l+4],6,-145523070),y=c(y,m,g,v,u[l+11],10,-1120210379),v=c(v,y,m,g,u[l+2],15,718787259),g=c(g,v,y,m,u[l+9],21,-343485551),m=r(m,d),g=r(g,f),v=r(v,h),y=r(y,p);return n(m)+n(g)+n(v)+n(y)}let PN=1,jN=console,FN=class{static setLogger(e){jN=e}constructor(e,t){xI(this,"id",void 0),xI(this,"lockingPromise",rh.resolve()),xI(this,"locks",0),xI(this,"name",""),xI(this,"lockId",void 0),this.lockId=PN++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");jN.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new rh((n=>{t=()=>{this.locks-=1,this.logger("unlocked",e),n()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}};function UN(e,t){return function(n,r,i){const a=i.value;if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await n.lock("From ".concat(e,".").concat(r));try{for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return await a.apply(this,s)}finally{i()}},i}}const BN={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function VN(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function zN(e,t,n,r){const i=Object.assign({},BN,r);let a=i.timeout;const o=async()=>{await function(e){return new rh((t=>{window.setTimeout(t,e)}))}(a),a*=i.timeoutFactor,a=Math.min(i.maxRetryTimeout,a)};let s=!1;const c=new rh((async(r,a)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(s)return a(new NI(II.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return r(n);if(c+1===i.maxRetryCount)return r(n);await o()}catch(e){if(!n(e,c))return a(e);if(c+1===i.maxRetryCount)return a(e);await o()}}}));return c.cancel=()=>s=!0,c}let WN,GN=class{constructor(e){xI(this,"input",[]),xI(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:ii(e=this.input).call(e,((e,t)=>e+t))/this.input.length}},HN=0,YN=0;function qN(e,t,n,r){return new rh(((i,a)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),HN+=wN(t.data)):n&&(t.data.size?HN+=t.data.size:t.data instanceof FormData?HN+=EN(t.data):HN+=wN(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,PR.request(t).then((e=>{"string"==typeof e.data?YN+=wN(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?YN+=e.data.byteLength:YN+=wN(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{PR.isCancel(e)?a(new NI(II.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?a(new NI(II.NETWORK_TIMEOUT,e.message)):e.response?a(new NI(II.NETWORK_RESPONSE_ERROR,e.response.status)):a(new NI(II.NETWORK_ERROR,e.message))}))}))}async function KN(e,t){const n=new Blob([t.data],{type:"buffer"});return await qN(e,RI(RI({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const XN=()=>void 0!==window.isSecureContext;function QN(e){if(Array.isArray(e))return e.map((e=>e));if(!JN(e))return e;const t={};for(const n in e){const r=e[n];JN(r)||Array.isArray(r)?t[n]=QN(r):t[n]=r}return t}function JN(e){return!("object"!=typeof e||Array.isArray(e)||!e)}let ZN=class{constructor(e){xI(this,"input",[]),xI(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const $N={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},eA={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:$N,remoteCandidate:$N},updateInterval:0},tA={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},nA={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},rA={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},iA={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let aA=class{constructor(e,t){xI(this,"onFirstVideoReceived",void 0),xI(this,"onFirstVideoDecoded",void 0),xI(this,"onFirstAudioReceived",void 0),xI(this,"onFirstVideoDecodedTimeout",void 0),xI(this,"onFirstAudioDecoded",void 0),xI(this,"onSelectedLocalCandidateChanged",void 0),xI(this,"onSelectedRemoteCandidateChanged",void 0),xI(this,"videoIsReady",!1),xI(this,"videoIsReady2",{}),xI(this,"pc",void 0),xI(this,"options",void 0),xI(this,"intervalTimer",void 0),xI(this,"stats",QN(eA)),xI(this,"isFirstVideoReceived",{}),xI(this,"isFirstVideoDecoded",{}),xI(this,"isFirstAudioReceived",{}),xI(this,"isFirstAudioDecoded",{}),xI(this,"isFirstVideoDecodedTimeout",{}),xI(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new rh((e=>{e({local:RI({},$N),remote:RI({},$N)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,a=0,o=0;for(const s of n)e[s].forEach(((e,n)=>{if(!this.lossRateWindowStats[t-1][s][n]||!this.lossRateWindowStats[0][s][n])return;const c=this.lossRateWindowStats[t-1][s][n].packets-this.lossRateWindowStats[0][s][n].packets,u=this.lossRateWindowStats[t-1][s][n].packetsLost-this.lossRateWindowStats[0][s][n].packetsLost;"videoSend"===s||"audioSend"===s?(r+=c,a+=u):(i+=c,o+=u),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||u<=0?0:u/(c+u)}));e.sendPacketLossRate=r<=0||a<=0?0:a/(r+a),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}},oA=class extends aA{constructor(){super(...arguments),xI(this,"_stats",eA),xI(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=QN(eA);const n=t.filter((e=>"ssrc"===e.type));this.processSSRCStats(n);const r=t.find((e=>"VideoBwe"===e.type));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((e=>{var t;const n=Lr(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const t=QN(nA);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=QN(tA),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:RI({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=QN(iA);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=QN(rA);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}}))}_getStats(){return new rh(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t.push(n)})),t}},sA=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),cA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),uA=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),lA=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var dA=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(dA||{});function fA(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:dA.kNone;if(!t)return;const a=Number(t[n]);if("number"!=typeof a)return;const o=Number(t[r]);if("number"!=typeof o)return;if(!e)return o?a/o*i:void 0;const s=Number(e[n]);if("number"!=typeof s)return;const c=Number(e[r]);if("number"!=typeof c)return;const u=o-c;return u?(a-s)/u*i:void 0}let hA=class extends aA{constructor(){super(...arguments),xI(this,"_stats",eA),xI(this,"report",void 0),xI(this,"lastDecodeVideoReceiverStats",new Map),xI(this,"lastVideoFramesRecv",new Map),xI(this,"lastVideoFramesSent",new Map),xI(this,"lastVideoFramesDecode",new Map),xI(this,"lastVideoFramesOutput",new Map),xI(this,"lastVideoJBDelay",new Map),xI(this,"lastAudioJBDelay",new Map),xI(this,"mediaBytesSent",new Map),xI(this,"mediaBytesRetransmit",new Map),xI(this,"mediaBytesTargetEncode",new Map),xI(this,"lastDecodeAudioReceiverStats",new Map),xI(this,"lastAudioConcealment",new Map),xI(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=QN(eA),this.report.forEach((e=>{switch(e.type){case lA.OUTBOUND:case lA.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===lA.OUTBOUND?"audio"===t||r?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===lA.INBOUND&&("audio"===t||r?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case lA.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case lA.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:RI({},$N),remote:RI({},$N)};return e.forEach((n=>{let r;if(n.type===lA.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===lA.CANDIDATE_PAIR&&n.selected&&(r=n),r){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){const i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){const i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===lA.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===lA.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===lA.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(RI({},t),RI({},this.stats.selectedCandidatePair.localCandidate)),e.type===lA.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(RI({},t),RI({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((t=>t.ssrc===e.ssrc));t||(t=QN(iA),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=fA(n,t,"totalProcessingDelay","jitterBufferEmittedCount",dA.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,RI({},t))}calculateAudioFreeze(e,t,n){const r=this.lastAudioConcealment.get(e.ssrc);if(null!=t&&null!=r){const i=r.lts,a=n.timestamp,o=a-i;if(o<=0)return;const s=e.concealedSamples-t.concealedSamples-0,c=r.nonSilent+s,u=e.totalSamplesReceived-t.totalSamplesReceived;if(u<=0)return;const l=80*u/o,d=200*u/o,f=o/u;let h=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,c>l&&(r.plc80>0?(e.freezeSamples80+=s,e.freezeMs80+=Math.round(s*f)):(e.freezeSamples80+=c,e.freezeMs80+=Math.round(c*f)),h=r.plc80+1);let p=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,c>d&&(r.plc200>0?(e.freezeSamples200+=s,e.freezeMs200+=Math.round(s*f)):(e.freezeSamples200+=c,e.freezeMs200+=Math.round(c*f)),p=r.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:s,lts:a,plc80:h,plc200:p})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find((t=>t.ssrc===e.ssrc));t||(t=QN(tA),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),a=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const r=n.stats,i=a-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&i>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=fA(null==n?void 0:n.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=fA(null==n?void 0:n.stats,t,"totalProcessingDelay","framesDecodeCount",dA.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=fA(null==n?void 0:n.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",dA.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=fA(null==n?void 0:n.stats,t,"totalInterFrameDelay","framesDecodeCount",dA.kMillisecondsFromSeconds),r&&a-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((a-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&a-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((a-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:a,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:a,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:RI({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((t=>t.ssrc===e.ssrc));t||(t=QN(nA),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new ZN(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new ZN(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new ZN(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const r=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/r}}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,lA.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((t=>t.ssrc===e.ssrc));if(t||(t=QN(rA),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,lA.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(fh(n=this.report).call(n)).find((n=>n.type===t&&n.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,a,o;const s=t?this.report.get(t):void 0,c=null!==(r=null==s?void 0:s.framesSent)&&void 0!==r?r:e.framesSent;if("number"!=typeof c)return;let u=null!==(i=null==s?void 0:s.frameWidth)&&void 0!==i?i:e.frameWidth,l=null!==(a=null==s?void 0:s.frameHeight)&&void 0!==a?a:e.frameHeight,d=null!==(o=null==s?void 0:s.framesPerSecond)&&void 0!==o?o:e.framesPerSecond;if("number"==typeof u&&"number"==typeof l||(u=0,l=0),null==d){const e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(d=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:d})):t?d=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:0})}n.sentFrame={width:u,height:l,frameRate:Math.max(0,d)}}processVideoTrackReceiverStats(e,t,n){var r,i,a,o,s;const c=t?this.report.get(t):void 0,u=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,l=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(a=null==c?void 0:c.frameHeight)&&void 0!==a?a:e.frameHeight,f=null!==(o=null==c?void 0:c.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,h=null!==(s=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof u){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=u;let r=0;e&&t-e.lts>=800?(r=Math.round((u-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:t,rate:0}),n.receivedFrame={width:l||0,height:d||0,frameRate:r||0},n.decodedFrame={width:l||0,height:d||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:l||0,height:d||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(f&&h){const e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=h-e.jitterBufferEmittedCount;r>0&&(t=1e3*(f-e.jitterBufferDelay)/r),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:f,jitterBufferEmittedCount:h,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,a,o;const s=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==s?void 0:s.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,u=null!==(a=null!==(o=null==s?void 0:s.echoReturnLossEnhancement)&&void 0!==o?o:e.echoReturnLossEnhancement)&&void 0!==a?a:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=u}processAudioTrackReceiverStats(e,t,n){var r,i,a,o,s,c,u,l,d;const f=t?this.report.get(t):void 0,h=null!==(r=null==f?void 0:f.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,p=null!==(i=null==f?void 0:f.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,m=null!==(a=null==f?void 0:f.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,g=null!==(o=null==f?void 0:f.jitterBufferEmittedCount)&&void 0!==o?o:e.jitterBufferEmittedCount,v=null!==(s=null==f?void 0:f.audioLevel)&&void 0!==s?s:null==e?void 0:e.audioLevel,y=null!==(c=null==f?void 0:f.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,b=null!==(u=null==f?void 0:f.concealedSamples)&&void 0!==u?u:e.concealedSamples,_=null!==(l=null==f?void 0:f.silentConcealedSamples)&&void 0!==l?l:e.silentConcealedSamples,w=null!==(d=null==f?void 0:f.concealmentEvents)&&void 0!==d?d:e.concealmentEvents;if("number"==typeof p&&(n.totalSamplesReceived=p),"number"==typeof _&&(n.silentConcealedSamples=_),"number"==typeof w&&(n.concealmentEvents=w),"number"==typeof b&&(n.concealedSamples=b),h&&p&&(n.accelerateRate=h/p),m&&g){const e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=g-e.jitterBufferEmittedCount;r>0&&(t=1e3*(m-e.jitterBufferDelay)/r),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:m,jitterBufferEmittedCount:g,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=v;let E=1920;y&&p&&(E=p/y/50,n.receivedFrames=Math.round(p/E)),b&&(n.droppedFrames=Math.round(b/E))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((t=>{e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((e=>{t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((e=>{n=null===n?e.diffMean():n+e.diffMean()}));const r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},pA=class extends aA{updateStats(){return rh.resolve()}};function mA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const a=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return a?a<76?new oA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new hA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(e){if(!window.RTCStatsReport)return!1;const t=e.getStats();return!!(t instanceof rh||function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}(t))}(e)?new hA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new pA(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}const gA="websdk_ng_install_id";function vA(){try{if(IA("INSTALL_ID"))return IA("INSTALL_ID");let e=window.localStorage.getItem(gA);return e||(e=TN(),window.localStorage.setItem(gA,e)),RA("INSTALL_ID",e),e}catch(e){return}}const yA=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],n=t[2];return"".concat(e,".").concat(n)}return"4.0.0.999"}("4.24.0"),bA=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let _A=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const wA=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let s=0;s<6;s++)i.push("1");const a=i.join(""),o={};return o[e]=r,o[t]=a,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=wA;const EA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},SA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},CA="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",xA={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},TA=RI(RI(RI(RI({},xA),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:SA,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},EA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function RA(e,t,n){var r,i,a;Lr(r=Object.keys(TA)).call(r,e)&&(!n&&Lr(i=Object.keys(AA)).call(i,e)||(TA[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS"!==e||!0!==t||(TA.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===e&&t&&(a=!!t,TA.USE_NEW_NETWORK_CONFIG=a,a&&(TA.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],TA.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],TA.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],TA.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],TA.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",TA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",TA.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(TA.ENABLE_INSTANT_VIDEO=!0,TA.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(TA.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(TA.NEW_TURN_MODE||(TA.NEW_TURN_MODE=4))))}function IA(e){return TA[e]}bA||(TA.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],TA.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],TA.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],TA.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],TA.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],TA.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],TA.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",TA.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",TA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",TA.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",TA.AREAS=["NORTH_AMERICA","OVERSEA"]);let NA=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const AA={};var kA=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(kA||{});let DA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});const MA=128,LA=96,OA=1e3,PA=10;let jA=0;var FA=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>E,Printer:()=>R,parse:()=>k,print:()=>D});const r="\n",i="".concat("\r").concat(r),a=" ";let o;function s(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function u(e){return c(e)||e>="\x80"&&e<="\xff"}function l(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function d(e){return e>="1"&&e<="9"}function f(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function h(e){return"d"===e||"h"===e||"m"===e||"s"===e}function p(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function m(e){return f(e)||s(e)||"+"===e||"/"===e}function g(e){return s(e)||f(e)||"+"===e||"/"===e||"-"===e||"_"===e}function v(e){return f(e)||s(e)||"+"===e||"/"===e}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(o||(o={}));class w{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===r)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,a)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===a)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let i=0;i<3&&s(e[n]);i++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;s(e[n])||f(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,u)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let a=0;a<3;a++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!d(e[t]))throw new Error("Invalid integer.");for(t+=1;s(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!d(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&s(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,l)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(d(e[n])&&(n+=1);s(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,a)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,s),h(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!d(e[t]))throw new Error("Invalid repeat interval");for(t+=1;s(e[t]);)t+=1;return h(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,s)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class E extends w{constructor(){super(),_(this,"records",[]),_(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter((e=>!!Db(e).call(e))).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),a=this.parseInformation(),o=this.parseUri(),s=this.parseEmail(),c=this.parsePhone(),u=this.parseConnection(),l=this.parseBandWidth(),d=this.parseTimeFields(),f=this.parseKey(),h=this.parseSessionAttribute(),p=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:a,uri:o,emails:s,phones:c,connection:u,bandwidths:l,timeFields:d,key:f,attributes:h,mediaDescriptions:p}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===r)return"\r"===e[t-1]?i:r;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new C;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==o.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,(e=>l(e)&&":"!==e)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,p)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new x(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==o.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,(e=>l(e)&&":"!==e)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,p)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===o.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===o.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==o.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==o.BANDWIDTH)break;{const n=this.extractOneOrMore(t,l);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const r=this.extractOneOrMore(t,s);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==o.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,s));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==o.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const a=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:r,nettype:i,addrtype:a,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===o.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==o.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===o.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==o.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==o.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===o.CONNECTION){const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===o.TIME;){const t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===o.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),a=this.parseKey(),o=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:a,attributes:o})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===o.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const a=t.call(this,e.value,e.cur,...r),o=e.value.slice(e.cur,a);return e.cur=a,o}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==a)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class S extends w{constructor(){super(...arguments),_(this,"attributes",void 0),_(this,"digested",!1)}extractOneOrMore(e,t,n){const r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[a,o]=n||[];if("number"==typeof a&&i.length<a)throw new Error("error in length, should be more or equal than ".concat(a," characters."));if("number"==typeof o&&i.length>o)throw new Error("error in length, should be less or equal than ".concat(o," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==a)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const a=t.call(this,e.attValue,e._cur,...r),o=e.attValue.slice(e._cur,a);return e._cur=a,o}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,m,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,m,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,m));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,s);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,a),i=b(b({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:r});this.peekChar(e)===a&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class C extends S{constructor(){super(...arguments),_(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===a;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,v),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===a;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const r=this.extractOneOrMore(e,(e=>e!==a&&p(e)));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===a&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,a);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class x extends S{constructor(e){super(),_(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,m,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,s,[1,10]);this.consumeAttributeSpace(e);const o=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const u=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const l={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:o,port:u,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),l.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),l.relPort=this.extract(e,this.consumePort));this.peekChar(e)===a;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),l.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(l)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const r={encodingName:n,clockRate:this.extractOneOrMore(e,s)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,s);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let r;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),r=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find((e=>e.ssrcId===parseInt(t,10)));i?i.attributes[n]=r:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:r}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,a);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((e=>{let[t,n]=e.split("=");t=Db(t).call(t);const i="string"==typeof n?Db(n).call(n):null;"string"==typeof t&&t.length>0&&(r[t]=i)}));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,a),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,a);let r;if("trr-int"===n)r={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===a&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===a&&(t.additional=this.extract(e,this.consumeTill))),r=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(r);else{const e=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));e?e.rtcpFeedbacks.push(r):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[r]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===a&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,l,[1,64])};this.peekChar(e)===a&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,l,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,(e=>f(e)||s(e)||"_"===e||"-"===e));this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===a){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===a&&this.extract(e,this.consume,a)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{const r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,s,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,s,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class R{constructor(){T(this,"eol",i)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map((e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime))).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new N(this.eol).print(e)}printMediaAttributes(e){return new A(this.eol).print(e)}}class I{constructor(e){T(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(a)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map((e=>"a=fingerprint:".concat(e.hashFunction).concat(a).concat(e.fingerprint))).join(this.eol)+this.eol:""}printExtmap(e){return e.map((e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(a).concat(e.extensionName).concat(e.extensionAttributes?"".concat(a).concat(e.extensionAttributes):"").concat(this.eol))).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map((e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol))).join("")}}class N extends I{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map((e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map((e=>"".concat(a).concat(e))).join("")).concat(this.eol))).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map((e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map((e=>"".concat(a).concat(e.name).concat(e.value?"=".concat(e.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(a,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((e=>"".concat(a).concat(e)))),t+this.eol}}class A extends I{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map((e=>"a=candidate:".concat(e.foundation).concat(a).concat(e.componentId).concat(a).concat(e.transport).concat(a).concat(e.priority).concat(a).concat(e.connectionAddress).concat(a).concat(e.port).concat(a,"typ").concat(a).concat(e.type).concat(e.relAddr?"".concat(a,"raddr").concat(a).concat(e.relAddr):"").concat(e.relPort?"".concat(a,"rport").concat(a).concat(e.relPort):"").concat(Object.keys(e.extension).map((t=>"".concat(a).concat(t).concat(a).concat(e.extension[t]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(e){return e.map((e=>"a=remote-candidates:".concat(e.join(a)).concat(this.eol))).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map((e=>this.printRTCPFeedback("*",e))).join("");for(const r of t)n+=this.printRtpMap(r.payloadType,r.rtpMap),n+=this.printFmtp(r.payloadType,r.fmtp),n+=r.rtcpFeedbacks.map((e=>this.printRTCPFeedback(r.payloadType,e))).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(a).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(a).concat(Object.keys(t.parameters).map((e=>"".concat(e,"=").concat(t.parameters[e]))).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(a).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(a),r=t;return"trr-int"===r.type?n+="ttr-int".concat(a).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(a).concat(r.parameter),r.additional&&(n+="".concat(a).concat(r.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map((e=>Object.keys(e.attributes).map((t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(a).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(a).concat(e.netType)),e.addressType&&(t+="".concat(a).concat(e.addressType)),e.address&&(t+="".concat(a).concat(e.address)),t+this.eol}printMSId(e){return e.map((e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(a).concat(e.appdata):"").concat(this.eol))).join("")}printImageattr(e){return e.map((e=>"a=imageattr:".concat(e).concat(this.eol))).join("")}printRid(e){return e.map((e=>{let t="a=rid:".concat(e.id).concat(a).concat(e.direction);return e.payloads&&(t+="".concat(a,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(a).concat(e.params.map((e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val))).join(";"))),t+this.eol})).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map((e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((e=>"".concat(a).concat(e.toString(10)))).join("")).concat(this.eol))).join("")}}function k(e){return(new E).parse(e)}function D(e,t){return(new R).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})();function UA(e){return FA.parse(e)}function BA(e,t){return FA.print(e,t)}var VA=er("Array","keys"),zA=gr,WA=et,GA=d,HA=VA,YA=Array.prototype,qA={DOMTokenList:!0,NodeList:!0},KA=function(e){var t=e.keys;return e===YA||GA(YA,e)&&t===YA.keys||WA(qA,zA(e))?HA:t},XA=r(KA);function QA(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function JA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ZA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JA(Object(n),!0).forEach((function(t){QA(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const $A=new class extends GI{constructor(){super(...arguments),QA(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class ek{constructor(e){QA(this,"logger",void 0),QA(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function tk(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function nk(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const rk={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},ik=Date.now(),ak=e=>{for(const t in rk)if(Object.prototype.hasOwnProperty.call(rk,t)&&rk[t]===e)return t;return"DEFAULT"},ok=new class{constructor(){QA(this,"proxyServerURL",void 0),QA(this,"logLevel",rk.DEBUG),QA(this,"uploadState","collecting"),QA(this,"uploadLogWaitingList",[]),QA(this,"uploadLogUploadingList",[]),QA(this,"uploadErrorCount",0),QA(this,"currentLogID",0),QA(this,"url",void 0),QA(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[rk.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[rk.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[rk.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[rk.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[rk.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){RA("UPLOAD_LOG",!0)}disableLogUpload(){RA("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new ek(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-ik<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-ik);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=tk()+" Agora-SDK [".concat(ak(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=tk()+" %cAgora-SDK [".concat(ak(r),"]:");let a=[];if(!IA("USE_NEW_LOG"))switch(r){case rk.DEBUG:a=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,a);break;case rk.INFO:a=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,a);break;case rk.WARNING:a=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,a);break;case rk.ERROR:a=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-ik<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-ik);const r=Math.max(0,Math.min(4,t[0]));t[0]=tk()+" Agora-SDK [".concat(ak(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!IA("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=nk()+" Agora-SDK [".concat(ak(e),"]:"):n[0]=nk()+" Agora-SDK [".concat(ak(e),"]:");let i="";n.forEach((e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:yA,process_id:IA("PROCESS_ID"),payload:JSON.stringify(e)};return zN((async()=>{const e=await PR.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(IA("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(IA("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}}),(()=>(this.uploadLogUploadingList=[],!1)),(t=>{const n={status:-1,message:t.message,errorRange:e.map((e=>e.log_item_id))};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),$A.reportLogUploadError(n),!0}),{timeout:IA("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:IA("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,IA("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),IA("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),IA("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),IA("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var sk;function ck(e){return LI(e.reportId,"params.reportId",0,100,!1),LI(e.category,"params.category",0,100,!1),LI(e.event,"params.event",0,100,!1),LI(e.label,"params.label",0,100,!1),DI(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(sk={}).FREE="free",sk.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const uk={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let lk=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),dk=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let fk=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function hk(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){const i=r.value;if("function"==typeof i){const a=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t,r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];let c=o;if(e.argsMap)try{c=e.argsMap(this,...o)}catch(e){ok.warning(e),c=[]}try{JSON.stringify(c)}catch(e){ok.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),c=[]}const u=(e.report||pk).reportApiInvoke(this._sessionId||null,{id:this._clientId||(null===(t=this.store)||void 0===t?void 0:t.clientId)||this._ID,name:"".concat(a,".").concat(String(n)),options:c,tag:KI.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=i.apply(this,o);return t instanceof rh?t.then((t=>(u.onSuccess(e.reportResult&&t),t))).catch((e=>{throw u.onError(e),e})):(u.onSuccess(e.reportResult&&t),t)}catch(e){throw u.onError(e),e}}}return r}}const pk=new class{constructor(){QA(this,"baseInfoMap",new Map),QA(this,"proxyServer",void 0),QA(this,"eventUploadTimer",void 0),QA(this,"setSessionIdTimer",void 0),QA(this,"url",void 0),QA(this,"sids",new Set),QA(this,"backupUrl",void 0),QA(this,"_appId",void 0),QA(this,"_aid",0),QA(this,"keyEventUploadPendingItems",[]),QA(this,"normalEventUploadPendingItems",[]),QA(this,"apiInvokeUploadPendingItems",[]),QA(this,"apiInvokeCount",0),QA(this,"apiInvokeLoggedCount",0),QA(this,"ltsList",[]),QA(this,"lastSendNormalEventTime",Date.now()),QA(this,"customReportCounterTimer",void 0),QA(this,"customReportCount",0),QA(this,"extApiInvoke",(async e=>{for(const t of e){const e=ZA(ZA({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:KI.TRACER});this.sendApiInvoke(e)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),IA("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),IA("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,(e=>{let[t,n]=e;return t+n})),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,a=!!IA("SHOW_REPORT_INVOKER_LOG"),o=!!IA("SHOW_REPORT_USER_INVOKER_LOG"),s=a||o&&t.id;s&&(this.apiInvokeLoggedCount+=1);const c=this.apiInvokeLoggedCount;function u(e,n){if(s){let r="[apiInvoke-".concat(c,"]");if(t.id&&(r+="[".concat(t.id,"]")),t.name&&(r+="[".concat(t.name,"]"),t.name===qI.JOIN))return ok.info("".concat(r," ").concat(e));ok.info("".concat(r," ").concat(e),"start"===e?t.options:n||"")}}const l=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});u("start");let d=!1;CN(t.timeout).then((()=>{d||(this.sendApiInvoke(ZA(ZA({},l()),{},{error:II.API_INVOKE_TIMEOUT,success:!1})),u("timeout"))}));const f=new NI(II.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(d)throw f;return d=!0,this.sendApiInvoke(ZA(ZA({},l()),{},{success:!0},t.reportResult&&{result:e})),u("onSuccess"),e};return n?NN(r,t.name+"Success",n,(()=>d=!0)):r()},onError:e=>{const r=()=>{if(d)throw e;d=!0,this.sendApiInvoke(ZA(ZA({},l()),{},{success:!1,error:e})),u("onFailure",e.toString())};return n?NN(r,t.name+"Error",n,(()=>d=!0)):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:IA("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:bA?"global":"oversea",areas:IA("AREAS")&&IA("AREAS").join(",")},t.extend),{stringUid:a,channelProfile:o,channelMode:s,isABTestSuccess:c,lsid:u,clientRole:l}=t,d=Date.now(),f=ZA(ZA({},r),{},{eventType:lk.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:CA,lts:d,elapse:d-n,extend:JSON.stringify(i),mode:t.mode,process:IA("PROCESS_ID"),appType:IA("APP_TYPE"),success:!0,version:yA,stringUid:a,channelProfile:o,channelMode:s,isABTestSuccess:c,lsid:u,clientType:Lr(h=window.navigator.userAgent).call(h,"AgoraWebView")?42:20,clientRole:l,serviceId:IA("PROCESS_ID"),extensionID:IA("PLUGIN_INFO").join(",")||""});var h;this.send({type:dk.SESSION,data:f},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA({},r),{},{role:t.role,eventType:lk.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:dk.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA({},r),{},{eventType:lk.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:dk.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:a,addr:o,isProxy:s}=t,c=i-n.startTime,u=ZA(ZA({},r),{},{eventType:lk.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:c,eventElapse:i-t.lts,firstSuccess:a,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:vA(),isABTestSuccess:t.isABTestSuccess?1:0}),l=u.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),a)this.send({type:dk.JOIN_GATEWAY,data:u},!0);else{let e;if(o)if(s){const t=o.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=o.match(/p=[0-9]{1,6}/g);e={isSuccess:l,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:s?1:0}}else{const t=o.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=o.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:l,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(/:|p=/g)[1]:"",isProxy:s?1:0}}else e={isSuccess:l,gatewayIp:"",port:"",isProxy:s?1:0};delete u.success,delete u.eventType,delete u.firstSuccess,u.vid=Number(u.vid);const t=Object.assign({},u,e,{eventType:lk.REJOIN_GATEWAY});this.send({type:dk.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=ZA(ZA({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:dk.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA({},r),{},{eventType:lk.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:dk.PUBLISH,data:a},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,a=Date.now(),o=ZA(ZA({},i),{},{eventType:lk.SUBSCRIBE,lts:a,eventElapse:t.eventElapse,elapse:a-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:dk.SUBSCRIBE,data:o},!0)}wsCompressorInit(e){var t;const n=[...XA(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const a=i.info,o=Date.now(),s=ZA(ZA({},a),{},{eventType:lk.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:dk.WS_COMPRESSOR_INIT,data:s},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=t.peerPubStatusMs-(n.lastJoinSuccessTime||i),o=ZA(ZA({},r),{},{elapse:i-n.startTime,eventType:lk.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:a,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>a?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:dk.XLA_PEER_FIRST_VIDEO_FRAME,data:o},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const a=i.info,o=Date.now(),s=ZA(ZA(ZA({},a),r),{},{elapse:o-i.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((r.firstFrame||o)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:s},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const a=i.info,o=Date.now(),s=ZA(ZA(ZA({},a),r),{},{elapse:o-i.startTime,eventType:t,lts:o});this.send({type:n,data:s},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA(ZA({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:lk.AB_TEST,lts:i});this.send({type:dk.AB_TEST,data:a},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA(ZA({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:lk.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:dk.PC_STATS,data:a},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA(ZA({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),eventType:lk.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:dk.UPDATE_REMOTE_RTPCAPABILITIES,data:a},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const a=i.info,o=Date.now(),s=ZA(ZA(ZA({},a),r),{},{eventType:t,lts:o});this.send({type:n,data:s},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA({},r),{},{eventType:lk.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:dk.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA({},r),{},{eventType:lk.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:dk.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA({},r),{},{eventType:lk.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:dk.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(e){this.proxyServer=e,e?ok.debug("reportProxyServerurl: ".concat(e)):ok.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:dk.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(e,t,n){const r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";const i=wN(JSON.stringify(e));let a=0;const o=[];let s=0;for(let c=0;c<r.length;c++)s+=r.charCodeAt(c)<=127?1:3,s<=n-i||(o[o.length]=RI(RI({},e),{},{[t]:r.substring(a,c)}),a=c,s=r.charCodeAt(c)<=127?1:3);return a!==r.length-1&&(o[o.length]=RI(RI({},e),{},{[t]:r.substring(a)})),o})(ZA(ZA(ZA({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach((e=>this.send({type:dk.WORKER_EVENT,data:e},!0)))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA(ZA({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:dk.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA(ZA({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:dk.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),a=ZA(ZA(ZA({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:dk.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>IA("CUSTOM_REPORT_LIMIT"))throw new NI(II.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),r=t.map((t=>({type:dk.USER_ANALYTICS,data:ZA(ZA({sid:e},t),{},{lts:n})})));try{IA("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(e){throw ok.error("send custom report message failed",e.toString()),new NI(II.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){const t=IA("NOT_REPORT_EVENT");if(e.tag&&Lr(t)&&Lr(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:a}=n.info;let o;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof NI){const{code:t,message:n}=e.error;o=t||n||e.error.toString()}else o=e.error.toString();const s={invokeId:e.invokeId,sid:e.sid,cname:r,cid:a,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?o:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:dk.API_INVOKE,data:s},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(0===e.length)return;const t=Array.from(this.sids).find((e=>null!==e));t&&e.forEach((e=>{e&&(e.sid=t,this.sendApiInvoke(Object.assign({},e)))})),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>IA("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(const a of[...n]){var i;-1!==this.ltsList.indexOf(a.data.lts)?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),Qh(i=this.ltsList).call(i,((e,t)=>e-t)))}return t||(this.lastSendNormalEventTime=Date.now()),IA("ENABLE_EVENT_REPORT")?(n.length&&(IA("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{IA("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>IA("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-IA("NORMAL_EVENT_QUEUE_CAPACITY")),ok.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){uN.networkState===rN.OFFLINE&&await rh.race([uN.onlineWaiter,CN(2*BN.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach((e=>{const n=VI(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(dk).forEach((n=>{let[r,i]=n;i===e.type&&(t=fk[r])})),t})(e),a=new DataView(r);a.setUint16(0,n.byteLength,!0),a.setUint8(2,255&i),a.setUint8(3,i>>>8&255),a.setUint8(4,i>>>16&255),t=zI(t,new Uint8Array(r)),t=zI(t,n)})),t},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(IA("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(IA("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(IA("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(IA("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await qN(r,{timeout:1e4,data:t(e),headers:ZA(ZA({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===i)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0]),r=n?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((e=>JSON.stringify(e))),vid:n,aid:r};uN.networkState===rN.OFFLINE&&await rh.race([uN.onlineWaiter,CN(2*BN.maxRetryTimeout)]);const a=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(IA("EVENT_REPORT_DOMAIN"),"&p=").concat(IA("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(IA("EVENT_REPORT_DOMAIN"),":").concat(IA("STATS_COLLECTOR_PORT")).concat(a));for(let s=0;s<2;s+=1){1===s&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(IA("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(IA("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat(IA("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(IA("STATS_COLLECTOR_PORT")).concat(a)));try{t?await KN(o,{timeout:1e4,data:i}):await qN(o,{timeout:1e4,data:i})}catch(t){if(1===s)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},uk);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:KI.TRACER}).onSuccess()}};$A.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=uN.networkState,pk.reportApiInvoke(null,{name:"logUploadError",options:e,tag:KI.TRACER}).onSuccess("logUploadError")}));class mk extends NI{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),QA(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,ok)}throw(){super.throw(ok)}}const gk={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function vk(){return gk}function yk(){return"setSinkId"in HTMLAudioElement.prototype&&(!IA("RESTRICTION_SET_PLAYBACK_DEVICE")||(ZR()||tI())&&!wI())}function bk(){return!gk.supportUnifiedPlan||IA("CHROME_FORCE_PLAN_B")&&EI()}function _k(e){return!(nI()||aI(87)||bk()||!IA("ENABLE_PRE_SUB")&&(null==e||!e.autoSubscribe||IA("FORCE_DISABLE_AUTO_SUB")))}function wk(e){return!!IA("ENABLE_INSTANT_VIDEO")||!(null==e||!e.autoSubscribe||IA("FORCE_DISABLE_AUTO_SUB"))}let Ek=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Sk(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Ck(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function xk(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function Tk(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const Rk={"90p":Ck(160,90),"90p_1":Ck(160,90),"120p":Ck(160,120,15,30,65),"120p_1":Ck(160,120,15,30,65),"120p_3":Ck(120,120,15,30,50),"120p_4":Ck(212,120),"180p":Ck(320,180,15,30,140),"180p_1":Ck(320,180,15,30,140),"180p_3":Ck(180,180,15,30,100),"180p_4":Ck(240,180,15,30,120),"240p":Ck(320,240,15,40,200),"240p_1":Ck(320,240,15,40,200),"240p_3":Ck(240,240,15,40,140),"240p_4":Ck(424,240,15,40,220),"360p":Ck(640,360,15,80,400),"360p_1":Ck(640,360,15,80,400),"360p_3":Ck(360,360,15,80,260),"360p_4":Ck(640,360,30,80,600),"360p_6":Ck(360,360,30,80,400),"360p_7":Ck(480,360,15,80,320),"360p_8":Ck(480,360,30,80,490),"360p_9":Ck(640,360,15,80,800),"360p_10":Ck(640,360,24,80,800),"360p_11":Ck(640,360,24,80,1e3),"480p":Ck(640,480,15,100,500),"480p_1":Ck(640,480,15,100,500),"480p_2":Ck(640,480,30,100,1e3),"480p_3":Ck(480,480,15,100,400),"480p_4":Ck(640,480,30,100,750),"480p_6":Ck(480,480,30,100,600),"480p_8":Ck(848,480,15,100,610),"480p_9":Ck(848,480,30,100,930),"480p_10":Ck(640,480,10,100,400),"720p":Ck(1280,720,15,120,1130),"720p_auto":Ck(1280,720,30,900,3e3),"720p_1":Ck(1280,720,15,120,1130),"720p_2":Ck(1280,720,30,120,2e3),"720p_3":Ck(1280,720,30,120,1710),"720p_5":Ck(960,720,15,120,910),"720p_6":Ck(960,720,30,120,1380),"1080p":Ck(1920,1080,15,120,2080),"1080p_1":Ck(1920,1080,15,120,2080),"1080p_2":Ck(1920,1080,30,120,3e3),"1080p_3":Ck(1920,1080,30,120,3150),"1080p_5":Ck(1920,1080,60,120,4780),"1440p":Ck(2560,1440,30,120,4850),"1440p_1":Ck(2560,1440,30,120,4850),"1440p_2":Ck(2560,1440,60,120,7350),"4k":Ck(3840,2160,30,120,8910),"4k_1":Ck(3840,2160,30,120,8910),"4k_3":Ck(3840,2160,60,120,13500)},Ik={"480p":xk(640,480,5),"480p_1":xk(640,480,5),"480p_2":xk(640,480,30),"480p_3":xk(640,480,15),"720p":xk(1280,720,5),"720p_auto":Ck(1280,720,30,900,3e3),"720p_1":xk(1280,720,5),"720p_2":xk(1280,720,30),"720p_3":xk(1280,720,15),"1080p":xk(1920,1080,5),"1080p_1":xk(1920,1080,5),"1080p_2":xk(1920,1080,30),"1080p_3":xk(1920,1080,15)},Nk={"1SL1TL":Tk(1,1),"3SL3TL":Tk(3,3),"2SL3TL":Tk(2,3)};function Ak(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},Rk[e]):e}function kk(e){return"string"==typeof e?Object.assign({},Ik[e]):e}function Dk(e){return"string"==typeof e?Object.assign({},Nk[e]):e}const Mk={speech_low_quality:Sk(16e3,!1),speech_standard:Sk(32e3,!1,18),music_standard:Sk(48e3,!1),standard_stereo:Sk(48e3,!0,56),high_quality:Sk(48e3,!1,128),high_quality_stereo:Sk(48e3,!0,192)};function Lk(e){return"string"==typeof e?Object.assign({},Mk[e]):e}const Ok=[];function Pk(e){return kI(e,"mediaSource",["screen","window","application"]),!0}let jk=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Fk=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Uk=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Bk=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Vk=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),zk=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Wk=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Gk=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),Hk=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Yk=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});const qk={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Kk={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Xk={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Qk={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Jk={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Zk=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),$k=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),eD=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),tD=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),nD=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),rD=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const iD={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let aD=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function oD(e,t,n,r,i){var a,o,s={};return Object.keys(r).forEach((function(e){s[e]=r[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=ii(a=vi(o=n.slice()).call(o)).call(a,(function(n,r){return r(e,t,n)||n}),s),i&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function sD(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function uD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cD(Object(n),!0).forEach((function(t){sD(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class lD extends GI{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(zk.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),sD(this,"trackMediaType",void 0),sD(this,"_ID",void 0),sD(this,"_rtpTransceiver",void 0),sD(this,"_lowRtpTransceiver",void 0),sD(this,"_hints",[]),sD(this,"_isClosed",!1),sD(this,"_originMediaStreamTrack",void 0),sD(this,"mediaStreamTrack",void 0),sD(this,"_external",{}),this._ID=t||xN(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(e){Lr(Ok).call(Ok,e)||Ok.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||gN((()=>{var e;pk.reportApiInvoke(null,{name:qI.GET_MEDIA_STREAM_TRACK,options:[],tag:KI.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Uk.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=Ok.indexOf(e);-1!==t&&Ok.splice(t,1)}(this),this.emit(Wk.CLOSED),this.removeAllListeners(zk.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===Uk.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(zk.TRANSCEIVER_UPDATED,e,t)}}class dD extends lD{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),sD(this,"_enabled",!0),sD(this,"_muted",!1),sD(this,"_isExternalTrack",!1),sD(this,"_isClosed",!1),sD(this,"_enabledMutex",void 0),sD(this,"processor",void 0),sD(this,"_processorContext",void 0),sD(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new FN("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,ok.debug("[".concat(this.getTrackId(),"] close")),this.emit(jk.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oN(this,jk.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){ok.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Wk.TRACK_ENDED)}stateCheck(e,t){if(ok.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),AI(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new NI(II.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",ok);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new NI(II.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",ok)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():rh.resolve([])}}const fD=window.AudioContext||window.webkitAudioContext;let hD=null;const pD=new class extends GI{constructor(){super(...arguments),sD(this,"prevState",void 0),sD(this,"curState",void 0),sD(this,"currentTime",void 0),sD(this,"currentTimeStuckAt",void 0),sD(this,"interruptDetectorTrack",void 0),sD(this,"onLocalAudioTrackMute",(()=>{ok.info("ios15-interruption-start"),this.emit(Ek.IOS_15_16_INTERRUPTION_START)})),sD(this,"onLocalAudioTrackUnmute",(async()=>{ok.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?ok.info("ios15-interruption-end-canceled"):(hD&&await hD.suspend(),this.emit(Ek.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){ok.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){ok.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function mD(){if(!hD){if(function(){if(!fD)return void ok.error("your browser is not support web audio");ok.info("create audio context");const e=uD({},IA("WEBAUDIO_INIT_OPTIONS"));ok.debug("audio context init option:",JSON.stringify(e)),hD=new fD(e),pD.curState=hD.state,hD.onstatechange=()=>{pD.prevState=pD.curState,pD.curState=hD?hD.state:void 0;const{prevState:e,curState:t}=pD,n="running"===t,r="interrupted"===t,i="running"===e,a="suspended"===e,o="interrupted"===e,s=qR().osVersion;(rI()||yI())&&i&&r&&(ok.info("ios".concat(s,"-interruption-start")),pD.emit(Ek.IOS_INTERRUPTION_START)),(rI()||yI())&&(a||o)&&n&&(ok.info("ios".concat(s,"-interruption-end")),pD.emit(Ek.IOS_INTERRUPTION_END)),e!==t&&pD.emit(Ek.STATE_CHANGE,t,e)},setInterval((()=>{var e;const t=null===(e=hD)||void 0===e?void 0:e.currentTime;pD.currentTime!==t?(pD.currentTimeStuckAt&&(ok.debug("AudioContext current time resume at ".concat(t)),pD.currentTimeStuckAt=void 0),pD.currentTime=t):(t!==pD.currentTimeStuckAt&&(pk.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:KI.TRACER}).onSuccess(),ok.warning("AudioContext current time stuck at ".concat(t))),pD.currentTimeStuckAt=t)}),5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,r=!1,i=!1,a=!1;function o(t){"running"===e.state?s(!1):rI()||yI()?"suspended"===e.state&&(s(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(s(!0),t&&e.resume().then(c,c))}function s(e){if(r!==e){r=e;for(let n=0,r=t;n<r.length;n+=1){const t=r[n];e?window.addEventListener(t,u,{capture:!0,passive:!0}):window.removeEventListener(t,u,{capture:!0,passive:!0})}}}function c(){o(!1)}function u(){o(!0)}function l(e){if(!a)if(n.paused)if(e){let t;d(!1),a=!0;try{t=n.play(),t?t.then(f,f):(n.addEventListener("playing",f),n.addEventListener("abort",f),n.addEventListener("error",f))}catch(e){f()}}else d(!0);else d(!1)}function d(e){if(i!==e){i=e;for(let n=0,r=t;n<r.length;n++){const t=r[n];e?window.addEventListener(t,h,{capture:!0,passive:!0}):window.removeEventListener(t,h,{capture:!0,passive:!0})}}}function f(){n.removeEventListener("playing",f),n.removeEventListener("abort",f),n.removeEventListener("error",f),a=!1,l(!1)}function h(){l(!0)}if(rI()){const t=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=r.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,l(!0)}pD.on(Ek.STATE_CHANGE,(function(){o(!0)})),o(!1)}(hD)}(),!hD)throw new NI(II.NOT_SUPPORTED,"can not create audio context");return hD}return hD}function gD(e){if(function(){if(null!==vD)return vD;const e=mD(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),vD=i,i}())return;const t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var a;return e._inputNodes||(e._inputNodes=[]),Lr(a=e._inputNodes).call(a,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,a)=>{n.call(e),r?lN(e._inputNodes,r):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let vD=null;function yD(e,t){let n=!1;const r=1/t;if(IA("DISABLE_WEBAUDIO")){const t=window.setInterval((()=>{n?window.clearInterval(t):e(performance.now()/1e3)}),1e3*r)}else{const t=mD();let i=t.createGain();i.gain.value=0,i.connect(t.destination);const a=()=>{if(n)return void(i=null);const o=t.createOscillator();o.onended=a,o.connect(i),o.start(0),o.stop(t.currentTime+r),e(t.currentTime)};a()}return()=>{n=!0}}class bD{constructor(){sD(this,"context",void 0),sD(this,"analyserNode",void 0),sD(this,"sourceNode",void 0),this.context=mD(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||rI()||yI()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=ii(e).call(e,((e,t)=>e+t*t),0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){ok.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class _D extends GI{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),sD(this,"outputNode",void 0),sD(this,"outputTrack",void 0),sD(this,"isPlayed",!1),sD(this,"sourceNode",void 0),sD(this,"context",void 0),sD(this,"audioBufferNode",void 0),sD(this,"destNode",void 0),sD(this,"audioOutputLevel",0),sD(this,"volumeLevelAnalyser",void 0),sD(this,"_processedNode",void 0),sD(this,"playNode",void 0),sD(this,"isDestroyed",!1),sD(this,"onNoAudioInput",void 0),sD(this,"isNoAudioInput",!1),sD(this,"_noAudioInputCount",0),this.context=mD(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),gD(this.outputNode),this.volumeLevelAnalyser=new bD}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(Yk.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!vk().webAudioMediaStreamDest)throw new NI(II.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&fN((()=>{pD.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;rI()||yI()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let r=!1;for(let i=0;i<n.length;i++)0!==n[i]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await CN(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class wD extends _D{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),sD(this,"sourceNode",void 0),sD(this,"track",void 0),sD(this,"clonedTrack",void 0),sD(this,"audioElement",void 0),sD(this,"isCurrentTrackCloned",!1),sD(this,"isRemoteTrack",!1),sD(this,"originVolumeLevelAnalyser",void 0),sD(this,"rebuildWebAudio",(async()=>{if(ok.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void ok.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>ok.info("resume success"))),ok.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),gD(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),gD(this.outputNode),this.emit(Yk.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),"audio"!==e.kind)throw new NI(II.UNEXPECTED_ERROR);this.track=e;const i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),gD(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,ok.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));gD(t),this.originVolumeLevelAnalyser=new bD,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;const a=qR();t&&a.os===zR.IOS&&Number(null===(r=a.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&(pD.on(Ek.STATE_CHANGE,(()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),gD(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Yk.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),pD.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),ok.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));gD(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function ED(e,t,n){const r=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function SD(e,t){const n=await CD(e.mediaSource),{sourceId:r,audio:i}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new rh(((n,r)=>{const i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const a=document.createElement("div");a.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");const s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const u=document.createElement("button");u.innerHTML="cancel",u.setAttribute("style","width: 85px;"),u.onclick=()=>{document.body.removeChild(f);const e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};let l=t;const d=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=l,e.onchange=()=>{l=e.checked},d.appendChild(e),d.appendChild(t)}c.appendChild(d),c.appendChild(u),a.appendChild(o),a.appendChild(s),a.appendChild(c);const f=document.createElement("div");f.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),f.appendChild(i),f.appendChild(a),document.body.appendChild(f),e.map((e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=e.thumbnail;try{const{width:e}=r.getSize();e>1920&&(r=r.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",t.onclick=()=>{document.body.removeChild(f),n({sourceId:e.id,audio:l})},s.appendChild(t)}}))}))}(n,t);return await ED(r,e,i)}async function CD(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=YI();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new NI(II.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){r=null}r&&r.then||(r=new rh(((e,r)=>{n.desktopCapturer.getSources({types:t},((t,n)=>{t?r(t):e(n)}))})));try{return await r}catch(e){throw new NI(II.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}const xD=new FN("safari");let TD=!1,RD=!1;async function ID(e,t){let n=0,r=null;for(;n<2;)try{r=await ND(e,t,n>0);break}catch(e){if(e instanceof NI)throw ok.error("[".concat(t,"] ").concat(e.toString())),e;const r=AD(e.name||e.code||e,e.message);if(r.code===II.MEDIA_OPTION_INVALID){ok.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await CN(500);continue}throw ok.error("[".concat(t,"] ").concat(r.toString())),r}if(!r)throw new NI(II.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function ND(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new NI(II.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=vk(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return ok.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(YI())e.screen.sourceId?kD(i,await ED(e.screen.sourceId,e.screen,!!e.screenAudio)):kD(i,await SD(e.screen,!!e.screenAudio));else if(ZR()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new NI(II.NOT_SUPPORTED,"This browser does not support screen sharing");ok.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(o=e.screen.extensionId,s=t,new rh(((e,t)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},(n=>{if(!n||!n.streamId)return ok.error("[".concat(s,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new NI(II.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(e){ok.error("[".concat(s,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),e.toString()),t(new NI(II.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=n,kD(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var a;e.screen.mediaSource&&Pk(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(a=e.screen.displaySurface)&&void 0!==a?a:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:o,systemAudio:s,preferCurrentTab:c}=e.screen,u={selfBrowserSurface:r,surfaceSwitching:o,systemAudio:s,preferCurrentTab:c};!r&&delete u.selfBrowserSurface,!o&&delete u.surfaceSwitching,!s&&delete u.systemAudio,!c&&delete u.preferCurrentTab,ok.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:e.screenAudio,controls:u})),kD(i,await navigator.mediaDevices.getDisplayMedia(uD({video:n,audio:e.screenAudio},u)))}else{if(!nI())throw ok.error("[".concat(t,"] This browser does not support screenSharing")),new NI(II.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&Pk(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};ok.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),kD(i,await navigator.mediaDevices.getUserMedia(n))}}var o,s;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},u=IA("MEDIA_DEVICE_CONSTRAINTS");if(u)try{"string"==typeof u&&(u=JSON.parse(u)),c=kN(c,u)}catch(e){}ok.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),qR();let l,d=null;($R()||rI()||JR())&&(d=await xD.lock());try{l=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw d&&d(),e}return c.audio&&(TD=!0),c.video&&(RD=!0),kD(i,l),d&&d(),i}function AD(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new NI(II.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new NI(II.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new NI(II.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new NI(II.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new NI(II.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new NI(II.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return ok.error("getUserMedia unexpected error",e),new NI(II.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function kD(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(r&&e.removeTrack(r),e.addTrack(a)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const DD=new class extends GI{get state(){return this._state}set state(e){e!==this._state&&(this.emit(tD.STATE_CHANGE,e),this._state=e)}constructor(){super(),sD(this,"_state",eD.IDLE),sD(this,"isAccessMicrophonePermission",!1),sD(this,"isAccessCameraPermission",!1),sD(this,"lastAccessMicrophonePermission",!1),sD(this,"lastAccessCameraPermission",!1),sD(this,"checkdeviceMatched",!1),sD(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(IA("ENUMERATE_DEVICES_INTERVAL")||(SI()||XR()===zR.HARMONY_OS)&&EI())&&this.updateDevicesInfo()}),IA("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>ok.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new NI(II.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let a=!this.isAccessMicrophonePermission&&e,o=!this.isAccessCameraPermission&&t;i.audio&&(a=!1),i.video&&(o=!1);let s=null,c=null,u=null;if(!n&&(a||o)){if(xD.isLocked&&(ok.debug("[device manager] wait GUM lock"),(await xD.lock())(),ok.debug("[device manager] GUM unlock")),TD&&(a=!1,this.isAccessMicrophonePermission=!0),RD&&(o=!1,this.isAccessCameraPermission=!0),ok.debug("[device manager] check media device permissions",e,t,a,o),a&&o){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=AD(e.name||e.code||e,e.message);if(t.code===II.PERMISSION_DENIED)throw t;ok.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{s=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=AD(e.name||e.code||e,e.message);if(t.code===II.PERMISSION_DENIED)throw t;ok.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(o){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=AD(e.name||e.code||e,e.message);if(t.code===II.PERMISSION_DENIED)throw t;ok.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}ok.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return s&&s.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),u&&u.getTracks().forEach((e=>e.stop())),s=null,c=null,u=null,e}catch(e){return s&&s.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),u&&u.getTracks().forEach((e=>e.stop())),s=null,c=null,u=null,new NI(II.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audioinput"===e.kind))}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((e=>"videoinput"===e.kind))}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audiooutput"===e.kind))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((t=>t.deviceId===e));if(!t)throw new NI(II.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=eD.INITING;try{await this.updateDevicesInfo(),this.state=eD.INITEND}catch(e){throw ok.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=eD.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new NI(II.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find((e=>"audioinput"===e.kind&&"default"===e.deviceId)),n=e.find((e=>"audiooutput"===e.kind&&"default"===e.deviceId));t&&n?n.groupId===t.groupId?ok.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):ok.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):ok.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((e=>{if(!e.deviceId)return;const r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){const r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)})),this.deviceInfoMap.forEach(((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))})),this.state!==eD.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(tD.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(tD.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(tD.PLAYOUT_DEVICE_CHANGED,e)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((e=>"audioinput"===e.kind)),n=e.filter((e=>"videoinput"===e.kind)),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let MD=!1;const LD=new class extends GI{constructor(){super(...arguments),sD(this,"onAutoplayFailed",void 0),sD(this,"onAudioAutoplayFailed",void 0)}};function OD(){if(qR(),!MD){const e=t=>{t.preventDefault(),MD=!1,CI()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};MD=!0,CI()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),ok.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),LD.onAutoplayFailed?LD.onAutoplayFailed():LD.onAudioAutoplayFailed?ok.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):ok.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),LD.emit("autoplay-failed")}}function PD(e,t,n,r){if(!e)return;const i=pk.getBaseInfoBySessionId(e);if(!i)return;const a=i.info,o=Date.now(),s=uD(uD({},a),{},{vid:void 0===a.vid?0:Number(a.vid),lts:o,elapse:o-i.startTime,cbRegistered:LD.onAutoplayFailed||LD.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});pk.send({type:dk.AUTOPLAY_FAILED,data:s},!0)}const jD=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],FD=new class{constructor(){sD(this,"onAutoplayFailed",void 0),sD(this,"elementMap",new Map),sD(this,"elementStateMap",new Map),sD(this,"elementsNeedToResume",[]),sD(this,"sinkIdMap",new Map),sD(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[n,r]=t;const i=this.elementStateMap.get(n),a=r.srcObject.getAudioTracks()[0],o=a&&a.readyState;if(ok.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(e)),"live"===o){if(e)return r.pause(),void r.play();if("running"===pD.curState)return mI()?(r.pause(),void r.play()):void(i&&"paused"===i&&r.play())}}))})),sD(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(ok.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),pD.on(Ek.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pD.on(Ek.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),pD.on(Ek.STATE_CHANGE,(()=>{rI()&&"suspended"===pD.prevState&&"running"===pD.curState&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new NI(II.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,nD.INIT),this.setVolume(t,n);const a=this.sinkIdMap.get(t);if(a)try{i.setSinkId(a).catch((e=>{ok.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(e){ok.warning("[".concat(t,"] set sink id failed"),e.toString())}const o=i.play();o&&o.then&&o.catch((e=>{r&&PD(r,"audio",e.message,t),ok.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(ok.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),fN((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),OD()})))}))}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){jD.forEach((n=>{t.addEventListener(n,(n=>{const r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(ok.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){const n=null==t?void 0:t.error;n&&ok.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((e=>{e.play().then((e=>{ok.debug("Auto resume audio element success")})).catch((e=>{ok.warning("Auto resume audio element failed!",e)}))})),this.elementsNeedToResume=[]};new rh((e=>{document.body?e():window.addEventListener("load",(()=>e()))})).then((()=>{CI()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function UD(){return function(e,t,n){const r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new NI(II.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",ok);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=r.apply(this,t);return i instanceof rh?new rh(((e,t)=>{i.then(e).catch(t)})):i}),n}}class BD extends GI{constructor(e){super(),sD(this,"name","VideoProcessorDestination"),sD(this,"ID","0"),sD(this,"_source",void 0),sD(this,"videoContext",void 0),sD(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new NI(II.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new NI(II.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Zk.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Zk.ON_TRACK,void 0)}}class VD extends GI{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),sD(this,"constraintsMap",new Map),sD(this,"statsRegistry",[]),sD(this,"usageRegistry",[]),sD(this,"trackId",void 0),sD(this,"direction",void 0),sD(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await aN(this,$k.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return ok.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),oN(this,$k.REQUEST_UPDATE_CONSTRAINTS,Array.from(fh(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return ok.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),oN(this,$k.REQUEST_UPDATE_CONSTRAINTS,Array.from(fh(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const a=i();e.push({processorID:t,processorName:n,type:r,stats:a})}catch(e){ok.error(new NI(II.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof rh&&(n=await n),e.push(uD(uD({},n),{},{direction:this.direction}))}catch(e){ok.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class zD extends GI{constructor(e){super(),sD(this,"name","AudioProcessorDestination"),sD(this,"ID","0"),sD(this,"inputTrack",void 0),sD(this,"inputNode",void 0),sD(this,"audioProcessorContext",void 0),sD(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new NI(II.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new NI(II.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Zk.ON_TRACK,void 0),this.emit(Zk.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Zk.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Zk.ON_NODE,this.inputNode))}}class WD extends GI{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),sD(this,"constraintsMap",new Map),sD(this,"statsRegistry",[]),sD(this,"audioContext",void 0),sD(this,"trackId",void 0),sD(this,"direction",void 0),sD(this,"usageRegistry",[]),sD(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return aN(this,$k.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return ok.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),oN(this,$k.REQUEST_UPDATE_CONSTRAINTS,Array.from(fh(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),oN(this,$k.REQUEST_UPDATE_CONSTRAINTS,Array.from(fh(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const a=i();e.push({processorID:t,processorName:n,type:r,stats:a})}catch(e){ok.error(new NI(II.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof rh&&(n=await n),e.push(uD(uD({},n),{},{direction:this.direction}))}catch(e){ok.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class GD extends GI{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),sD(this,"context",void 0),sD(this,"processSourceNode",void 0),sD(this,"outputTrack",void 0),sD(this,"processedNode",void 0),sD(this,"clonedTrack",void 0),sD(this,"outputNode",void 0),this.outputNode=new HD}setVolume(){}createOutputTrack(){throw new NI(II.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class HD{disconnect(){}connect(){}}function YD(e){return new rh(((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const a=rI()?"canplay":"playing";i.addEventListener(a,(()=>{const e=i.videoWidth,n=i.videoHeight;!e&&nI()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(RN),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function qD(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Ak(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!_I()&&n.frameRate&&(t.frameRate=n.frameRate),tI()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),nI()&&(t.frameRate={ideal:30,max:30}),t}function KD(e){const t={};return _I()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,ZR()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function XD(e){const t=KD(e);if(e.encoderConfig){const n=Lk(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),SI()&&(t.sampleRate=void 0),t}const QD=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:a=n,width:o=r,height:s=i}=t;if(!a||!o||!s)return;o=MN(o),s=MN(s),a=MN(a);const{max:c,min:u}=function(e,t,n){const r=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(r),max:Math.floor(4*r)}}(o,s,a),{bitrateMax:l,bitrateMin:d}=t||{};l||ok.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(l,", brMin: ").concat(d,"]"));const{maxFramerate:f}=IA("ENCODER_CONFIG_LIMIT");return f&&"number"==typeof f&&(a=Math.min(a,f)),{frameRate:a,bitrateMax:l||c,bitrateMin:d||u,scaleResolutionDownBy:1,scale:0}},JD=async(e,t,n)=>await(async(e,t,n)=>{const r=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(ON(""+t+n)).slice(0,16),i=r.slice(0,12),a=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},a,e))})(e.buffer,t,n),ZD=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new rh(((n,r)=>{t.toBlob((async e=>{if(t.remove(),e){const r=await $D(e);n({buffer:r,width:t.width,height:t.height})}else r(new NI(II.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},$D=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var eM,tM,nM,rM,iM,aM,oM,sM,cM,uM,lM,dM,fM,hM,pM,mM,gM,vM,yM,bM,_M,wM,EM,SM,CM,xM,TM,RM,IM,NM,AM,kM,DM,MM,LM,OM,PM,jM,FM,UM;let BM=(eM=hk({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),tM=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),nM=UD(),rM=UN("LocalAudioTrack","_enabledMutex"),iM=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),aM=UD(),oM=UN("LocalAudioTrack","_enabledMutex"),sM=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),cM=UD(),uM=UD(),lM=UD(),dM=hk({argsMap:e=>[e.getTrackId()]}),fM=UD(),hM=hk({argsMap:e=>[e.getTrackId()]}),pM=UD(),mM=hk({argsMap:e=>[e.getTrackId()]}),gM=hk({argsMap:(e,t)=>[e.getTrackId(),t.name]}),vM=hk({argsMap:e=>[e.getTrackId()]}),oD((yM=class extends dD{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?FD.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),sD(this,"trackMediaType",Hk.AUDIO),sD(this,"_encoderConfig",void 0),sD(this,"_trackSource",void 0),sD(this,"metadata",[]),sD(this,"_enabled",!0),sD(this,"_volume",100),sD(this,"_useAudioElement",!0),sD(this,"_bypassWebAudio",!1),sD(this,"processor",void 0),sD(this,"_processorContext",void 0),sD(this,"_processorDestination",void 0),sD(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new GD,IA("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),IA("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),$R()&&!hD?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){DI(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&FD.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void ok.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,oN(this,jk.NEED_REPLACE_TRACK,this).then((()=>{ok.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((e=>{ok.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)})))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!yk())throw new NI(II.NOT_SUPPORTED,"your browser does not support setting the audio output device");await FD.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(ok.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await oN(this,jk.NEED_ENABLE_TRACK,this),ok.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),ok.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await oN(this,jk.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),ok.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,ok.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await oN(this,jk.NEED_MUTE_TRACK,this):await oN(this,jk.NEED_UNMUTE_TRACK,this))}getStats(){return gN((()=>{ok.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),sN(this,jk.GET_STATS)||uD({},qk)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Yk.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Yk.ON_AUDIO_BUFFER),this._source.on(Yk.ON_AUDIO_BUFFER,(t=>e(t)))}play(){ok.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(ok.debug("[".concat(this.getTrackId(),"] start audio playback in element")),FD.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){ok.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?FD.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];ok.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&FD.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oN(this,jk.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return rh.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new NI(II.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new NI(II.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Zk.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await oN(this,jk.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oN(this,jk.NEED_REPLACE_TRACK,this))})),e.on(Zk.ON_NODE,(e=>{this._source.processedNode=e}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(Zk.ON_TRACK),e.removeAllListeners(Zk.ON_NODE)}bindProcessorContextEvents(e){e.on($k.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners($k.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof GD&&(this._trackSource=new wD(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new WD(this._source.context,this.getTrackId(),"local"),t=new zD(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Yk.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(FD.stop(this.getTrackId()),this._source.play()),oN(this,jk.NEED_REPLACE_MIXING_TRACK,this).then((()=>{ok.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((e=>{ok.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[eM],Object.getOwnPropertyDescriptor(yM.prototype,"setVolume"),yM.prototype),oD(yM.prototype,"setPlaybackDevice",[tM,nM],Object.getOwnPropertyDescriptor(yM.prototype,"setPlaybackDevice"),yM.prototype),oD(yM.prototype,"setEnabled",[rM,iM,aM],Object.getOwnPropertyDescriptor(yM.prototype,"setEnabled"),yM.prototype),oD(yM.prototype,"setMuted",[oM,sM,cM],Object.getOwnPropertyDescriptor(yM.prototype,"setMuted"),yM.prototype),oD(yM.prototype,"getStats",[uM],Object.getOwnPropertyDescriptor(yM.prototype,"getStats"),yM.prototype),oD(yM.prototype,"setAudioFrameCallback",[lM],Object.getOwnPropertyDescriptor(yM.prototype,"setAudioFrameCallback"),yM.prototype),oD(yM.prototype,"play",[dM,fM],Object.getOwnPropertyDescriptor(yM.prototype,"play"),yM.prototype),oD(yM.prototype,"stop",[hM,pM],Object.getOwnPropertyDescriptor(yM.prototype,"stop"),yM.prototype),oD(yM.prototype,"close",[mM],Object.getOwnPropertyDescriptor(yM.prototype,"close"),yM.prototype),oD(yM.prototype,"pipe",[gM],Object.getOwnPropertyDescriptor(yM.prototype,"pipe"),yM.prototype),oD(yM.prototype,"unpipe",[vM],Object.getOwnPropertyDescriptor(yM.prototype,"unpipe"),yM.prototype),yM),VM=(bM=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),_M=UD(),wM=UN("MicrophoneAudioTrack","_enabledMutex"),EM=hk({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),SM=UD(),CM=hk({argsMap:e=>[e.getTrackId()]}),oD((xM=class extends BM{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Lk(t.encoderConfig):{},r,IA("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),sD(this,"_config",void 0),sD(this,"_deviceName","default"),sD(this,"_constraints",void 0),sD(this,"_originalConstraints",void 0),sD(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(mI()||gI())&&pD.bindInterruptDetectorTrack(this)}async setDevice(e){if(ok.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await DD.getDeviceById(e),n={};n.audio=uD({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await ID(n,this.getTrackId())}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await ID({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await DD.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}ok.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return ok.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(ok.info("[".concat(this.getTrackId(),"] start setEnabled"),e),IA("AUTO_RESET_AUDIO_ROUTE")&&(rI()||yI())){const t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await oN(this,jk.NEED_DISABLE_TRACK,this)}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const i=uD({},this._constraints),a=DD.searchDeviceIdByName(this._deviceName);a&&!i.deviceId&&(i.deviceId=a);try{n||(this._enabled=!0);const e=await ID({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await oN(this,jk.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),ok.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}ok.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(mI()||gI())&&pD.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((rI()||yI())&&this._enabled&&!this._isClosed&&pD.duringInterruption){const e=async()=>{pD.off(Ek.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(ok.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};pD.on(Ek.IOS_INTERRUPTION_END,e)}else ok.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Wk.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=DD.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await ID({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on($k.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners($k.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[bM,_M],Object.getOwnPropertyDescriptor(xM.prototype,"setDevice"),xM.prototype),oD(xM.prototype,"setEnabled",[wM,EM,SM],Object.getOwnPropertyDescriptor(xM.prototype,"setEnabled"),xM.prototype),oD(xM.prototype,"close",[CM],Object.getOwnPropertyDescriptor(xM.prototype,"close"),xM.prototype),xM),zM=(TM=hk({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),RM=UD(),IM=hk({argsMap:e=>[e.getTrackId()]}),NM=UD(),AM=hk({argsMap:e=>[e.getTrackId()]}),kM=UD(),DM=hk({argsMap:e=>[e.getTrackId()]}),MM=UD(),LM=hk({argsMap:e=>[e.getTrackId()]}),OM=UD(),PM=hk({argsMap:e=>[e.getTrackId()]}),jM=hk({argsMap:e=>[e.getTrackId()]}),FM=UD(),oD((UM=class extends BM{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),sD(this,"source",void 0),sD(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Yk.AUDIO_SOURCE_STATE_CHANGE,(e=>{this.safeEmit(Wk.SOURCE_STATE_CHANGE,e)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){DI(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[TM,RM],Object.getOwnPropertyDescriptor(UM.prototype,"startProcessAudioBuffer"),UM.prototype),oD(UM.prototype,"pauseProcessAudioBuffer",[IM,NM],Object.getOwnPropertyDescriptor(UM.prototype,"pauseProcessAudioBuffer"),UM.prototype),oD(UM.prototype,"seekAudioBuffer",[AM,kM],Object.getOwnPropertyDescriptor(UM.prototype,"seekAudioBuffer"),UM.prototype),oD(UM.prototype,"resumeProcessAudioBuffer",[DM,MM],Object.getOwnPropertyDescriptor(UM.prototype,"resumeProcessAudioBuffer"),UM.prototype),oD(UM.prototype,"stopProcessAudioBuffer",[LM,OM],Object.getOwnPropertyDescriptor(UM.prototype,"stopProcessAudioBuffer"),UM.prototype),oD(UM.prototype,"close",[PM],Object.getOwnPropertyDescriptor(UM.prototype,"close"),UM.prototype),oD(UM.prototype,"setAudioBufferPlaybackSpeed",[jM,FM],Object.getOwnPropertyDescriptor(UM.prototype,"setAudioBufferPlaybackSpeed"),UM.prototype),UM);class WM extends BM{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=mD().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,xN(8,"track-mix-")),sD(this,"trackList",void 0),sD(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(ok.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):ok.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){ok.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}lN(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach((t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach((t=>{t instanceof WM?t.emit(zk.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)})))}}class GM extends _D{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(Yk.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),sD(this,"audioBuffer",void 0),sD(this,"sourceNode",void 0),sD(this,"startPlayTime",0),sD(this,"startPlayOffset",0),sD(this,"pausePlayTime",0),sD(this,"options",void 0),sD(this,"currentLoopCount",0),sD(this,"currentPlaybackSpeed",100),sD(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):ok.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const HM=new Map;function YM(e,t){if(0===e.length||0===t.length)return 1/0;const n=LN(e),r=LN(t);return Math.floor(r/n)}class qM{get rendFrameRate(){const e=Math.max(1,YM(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:nD.DESTROYED}set videoElementStatus(e){e!==this._videoElementStatus&&(ok.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){sD(this,"trackId",void 0),sD(this,"config",void 0),sD(this,"onFirstVideoFrameDecoded",void 0),sD(this,"onFirstVideoFrameRender",void 0),sD(this,"onVideoStateChanged",void 0),sD(this,"freezeTimeCounterList",[]),sD(this,"renderFreezeAccTime",0),sD(this,"renderFreezeAccTime2",0),sD(this,"isKeepLastFrame",!1),sD(this,"isDestroyed",!1),sD(this,"timeUpdatedCount",0),sD(this,"freezeTime",0),sD(this,"playbackTime",0),sD(this,"lastTimeUpdatedTime",0),sD(this,"autoplayFailed",!1),sD(this,"videoTrack",void 0),sD(this,"videoElement",void 0),sD(this,"cacheVideoElement",void 0),sD(this,"internal",!1),sD(this,"_render_interframe_delays",[]),sD(this,"_render_interframe_delays_sizes",[]),sD(this,"_videoState",rD.VideoStateStopped),sD(this,"videoElementCheckInterval",void 0),sD(this,"videoElementFreezeTimeout",void 0),sD(this,"_videoElementStatus",nD.NONE),sD(this,"_isInPage",!0),sD(this,"isGettingVideoDimensions",!1),sD(this,"startGetVideoDimensions",(()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return ok.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()})),sD(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===pD.curState&&(ok.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(QR())),vI()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),sD(this,"handleVideoEvents",(e=>{switch(e.type){case"play":case"playing":"play"===e.type&&ok.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=nD.PLAYING;break;case"loadeddata":if(this.videoState=rD.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=nD.CANPLAY;break;case"stalled":this.videoElementStatus=nD.STALLED;break;case"suspend":this.videoElementStatus=nD.SUSPEND;break;case"pause":this.videoElementStatus=nD.PAUSED,rI()||yI()||$R()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(ok.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=nD.WAITING;break;case"abort":this.videoElementStatus=nD.ABORT;break;case"ended":this.videoElementStatus=nD.ENDED;break;case"emptied":this.videoElementStatus=nD.EMPTIED;break;case"error":{const e=this.videoElement.error;e&&(this.videoElementStatus=nD.ERROR,ok.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")")));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,ZL.lastVisibleTime<ZL.lastHiddenTime||n<ZL.lastHiddenTime||n<ZL.lastVisibleTime)return;if(this.isSkipCalcRenderFreezeTime())return;for(t>IA("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),sD(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(ok.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(QR())),vI()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),pD.on(Ek.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pD.on(Ek.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch((t=>{e&&PD(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(ok.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):ok.warning("[".concat(this.trackId,"] play warning: "),t)}));const n=qR();if(("Safari"===n.name&&15===Number(n.version)||mI())&&t&&t.then){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return ok.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new rh(((r,i)=>{n.toBlob((async e=>{if(n.remove(),e){const t=await $D(e);r({buffer:t,width:n.width,height:n.height})}else i(new NI(II.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,t<0?.1:t>1?1:t)}))):await ZD(e)}destroy(){this.isDestroyed=!0,pD.off(Ek.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pD.off(Ek.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=rD.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=nD.INIT,!this.videoElementCheckInterval&&(KM.forEach((e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{this._isInPage=function(e){return e!==document.body&&document.body.contains(e)}(this.videoElement)}),1e3),IA("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const r=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",r),this.videoElementFreezeTimeout=window.setTimeout(i,IA("VIDEO_FREEZE_DURATION")))},i=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===rD.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=rD.VideoStateFrozen:document.addEventListener("visibilitychange",r))},a=(e,t)=>{if(this.videoElementStatus===nD.PLAYING){if(n){const e=t.presentationTime-n.presentationTime,r=t.presentedFrames-n.presentedFrames;this._render_interframe_delays_sizes.push(r),this._render_interframe_delays.push(e);const a=LN(this._render_interframe_delays_sizes),o=a-this._render_interframe_delays_sizes[0];if(a>30&&o>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===rD.VideoStateStarting&&(this.videoState=rD.VideoStateDecoding),this.videoState===rD.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(i,IA("VIDEO_FREEZE_DURATION"))),e<IA("VIDEO_FREEZE_DURATION")&&this.videoState===rD.VideoStateFrozen&&(this.videoState=rD.VideoStateDecoding),e>IA("VIDEO_FREEZE_DURATION")&&ZL.lastVisibleTime>=ZL.lastHiddenTime&&n.timestamp>ZL.lastVisibleTime&&n.timestamp>ZL.lastHiddenTime){const t=Math.min(66,YM(this._render_interframe_delays_sizes,this._render_interframe_delays)),n=Math.max(0,e-(r-1)*t);this.renderFreezeAccTime2+=n>t?n:0,this.renderFreezeAccTime+=e}}n=uD(uD({},t),{},{timestamp:e})}else this.isSkipCalcRenderFreezeTime()&&(n=uD(uD({},t),{},{timestamp:e}));var r,o;IA("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(r=(o=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(o,a))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,a)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),SI()&&!IA("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n=qR();"Safari"===n.name&&15===Number(n.version)||mI()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nI()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,nI()&&this.videoElement.load());const r=this.videoElement.play();void 0!==r&&r.catch((e=>{ok.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())}))}resetVideoElement(){KM.forEach((e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=nD.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===nD.DESTROYED||this.internal}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then((()=>{ok.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((e=>{ok.error(e)})),this.autoplayFailed=!1,CI()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};CI()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),OD()}}const KM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class XM extends qM{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(e),sD(this,"container",void 0),sD(this,"slot",void 0),this.slot=e.element,this.internal=t,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;var n;!this.internal||this.slot?(t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()):(this.slot=t,t&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",null===(n=this.slot)||void 0===n||n.appendChild(this.container)):this.createElements())}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await ZD(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var e;this.container.remove(),null===(e=this.slot)||void 0===e||e.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){var e;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",IA("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),null===(e=this.slot)||void 0===e||e.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var QM,JM,ZM,$M,eL,tL,nL,rL,iL,aL,oL,sL,cL,uL,lL,dL,fL,hL,pL,mL,gL,vL,yL,bL,_L,wL,EL,SL,CL,xL,TL,RL,IL,NL,AL,kL,DL,ML;let LL=(QM=hk({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),JM=UD(),ZM=hk({argsMap:e=>[e.getTrackId()]}),$M=UN("LocalVideoTrack","_enabledMutex"),eL=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),tL=UD(),nL=UN("LocalVideoTrack","_enabledMutex"),rL=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),iL=UD(),aL=hk({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),oL=UD(),sL=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),cL=UD(),uL=UD(),lL=hk({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),dL=UD(),fL=UD(),hL=UD(),pL=hk({argsMap:e=>[e.getTrackId()]}),mL=UD(),gL=UD(),vL=UD(),yL=UD(),bL=UD(),_L=hk({argsMap:(e,t)=>[e.getTrackId(),t.name]}),wL=hk({argsMap:e=>[e.getTrackId()]}),EL=hk({argsMap:e=>[e.getTrackId()]}),SL=hk({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),CL=class e extends dD{get videoHeight(){if($R()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if($R()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nD.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,a){if(super(e,i),sD(this,"trackMediaType",Hk.VIDEO),sD(this,"_player",void 0),sD(this,"isUseScaleResolutionDownBy",!1),sD(this,"_videoVisibleTimer",null),sD(this,"_previousVideoVisibleStatus",void 0),sD(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),sD(this,"_encoderConfig",void 0),sD(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),sD(this,"_optimizationMode",void 0),sD(this,"_saveEncodeBitrateRatio",1),sD(this,"_videoHeight",void 0),sD(this,"_videoWidth",void 0),sD(this,"_forceBitrateLimit",void 0),sD(this,"_enabled",!0),sD(this,"_processorDestination",void 0),sD(this,"_processorContext",void 0),$R()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=n,this._optimizationMode=r,this._hints=a||[],t&&-1!==this._hints.indexOf(Fk.CUSTOM_TRACK)?this._encoderConfig=hN(t):this._encoderConfig=t,-1===this._hints.indexOf(Fk.SCREEN_TRACK))this.updateBitrateFromProfile();else if(oI(WR.CHROME,115)&&-1!==XR().indexOf("Windows")){const t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&vk().supportWebRTCInsertableStream){const n=new MediaStreamTrackProcessor(e),r=new MediaStreamTrackGenerator({kind:"video"});let i,a,o=Date.now();const s=()=>{c&&(clearInterval(c),c=void 0),i&&(i.close(),i=void 0),e.stop(),a=void 0,r.removeEventListener("ended",s)};let c=window.setInterval((()=>{if(a&&i&&Date.now()-o>(null!=t?t:1e3))try{"live"===r.readyState?a.enqueue(i.clone()):s()}catch(e){s()}}),null!=t?t:1e3);const u=new TransformStream({transform:(e,t)=>{"live"===r.readyState?(a=t,o=Date.now(),void 0===i?(i=e,t.enqueue(e.clone())):(t.enqueue(i),i=e)):e.close()}});return r.addEventListener("ended",s),n.readable.pipeThrough(u).pipeTo(r.writable),r}}(e);t&&(ok.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(Fk.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new VD(this.getTrackId(),"local"),this._processorDestination=new BD(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(ok.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}ok.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=uD(uD(uD({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new qM(n):this._player=new XM(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(Wk.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),IA("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,ok.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(ok.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await oN(this,jk.NEED_DISABLE_TRACK,this)}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void ok.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await oN(this,jk.NEED_ENABLE_TRACK,this)}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}ok.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,ok.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await oN(this,jk.NEED_MUTE_TRACK,this):await oN(this,jk.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._saveEncodeBitrateRatio;if(1!==this._saveEncodeBitrateRatio&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),ok.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await oN(this,jk.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(ok)}}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new NI(II.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=Ak(e),IA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=qD({encoderConfig:e});($R()||rI()||yI())&&(t.deviceId=void 0),ok.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new NI(II.UNEXPECTED_ERROR,e.toString());throw ok.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(Fk.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await oN(this,jk.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(ok)}}getStats(){return gN((()=>{ok.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),sN(this,jk.GET_STATS)||uD({},Kk)}async setBeautyEffect(e){ok.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await ZD(e)}async findClosestProfile(){const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings(),{width:r,height:i,frameRate:a}=this._encoderConfig||{},o=MN(this._videoWidth||e||r||0),s=MN(this._videoHeight||t||i||0),c=function(e,t,n){if(!Array.isArray(IA("VIDEO_ENCODER_CONFIG_LIST")))return!1;if(0===IA("VIDEO_ENCODER_CONFIG_LIST").length)return!1;const r=Math.min(e,t);return!(r>=480)&&uD(uD({},IA("VIDEO_ENCODER_CONFIG_LIST").find((e=>e.height>r))),{},{frameRate:n})}(o,s,MN(n||a||15));if(c)return ok.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(o,"x").concat(s," => ").concat(JSON.stringify(c))),this.setEncoderConfiguration(c)}async setBitrateLimit(e){ok.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void ok.error(II.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await oN(this,jk.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,ok.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}ok.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return ok.error(II.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,ok.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){YD(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(RN)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new NI(II.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");ok.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=Ak(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(Fk.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await oN(this,jk.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(ok)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const{bitrateMax:r,bitrateMin:i}=this._encoderConfig;if(null==i||null==r){const{max:a,min:o}=function(e,t,n,r,i){const a=IA("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===a)return{min:r,max:i};if(void 0===i){const o=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));i="STANDARD_BITRATE"===a?4*o:2*o,r=null!=r?r:o}else r=null!=r?r:Math.floor(i/10);return{min:r,max:i}}(e,t,n,i,r);if(this._encoderConfig.bitrateMin=o,this._encoderConfig.bitrateMax=a,IA("VIDEO_STANDARD_BITRATE_VERSION")&&null==i&&null==r){const[r,i]=function(e,t,n){const r=4*Math.floor(2e5*Math.pow(n/15,.6)*Math.pow(e*t/230400,.75)),i=e*t,a=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),o=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let s=fh(a).call(a).next().value,c=1;if(a.has(i))s=a.get(i);else{var u;const e=Qh(u=Array.from(a.entries())).call(u,((e,t)=>{let[n]=e,[r]=t;return n-r})),t=e.find((e=>{let[t]=e;return t>i}));if(t){const n=e.indexOf(t);if(n>0){const r=e[n-1],a=(i-r[0])/(t[0]-r[0]);s=r[1]+a*(t[1]-r[1])}else s=t[1]}else s=e[e.length-1][1]}if(o.has(i))c=o.get(i);else{var l;const e=Qh(l=Array.from(o.entries())).call(l,((e,t)=>{let[n]=e,[r]=t;return n-r})),t=e.find((e=>{let[t]=e;return t>i}));if(t){const n=e.indexOf(t);if(n>0){const r=e[n-1],a=(i-r[0])/(t[0]-r[0]);c=r[1]+a*(t[1]-r[1])}else c=t[1]}else c=e[e.length-1][1]}const d=IA("VIDEO_NEW_BITRATE_RATIO");d&&d>0&&(s=d/100);const f=Math.floor(r*s),h=Math.floor(65e4*Math.pow(e*t/230400,.5)*Math.pow(n/15,.69));let p=f;const m=IA("VIDEO_STANDARD_BITRATE_VERSION");return m&&m>0&&(1===m?p=r:2===m?p=f:3===m&&(p=h)),[Math.floor(p/1e3),c]}(e,t,n);this._encoderConfig.bitrateMax=r,this._encoderConfig.bitrateMin=o?Math.min(o,r):r,this._saveEncodeBitrateRatio=i,ok.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else ok.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(a,", brMin: ").concat(o,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:a}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&a instanceof HTMLElement){const e=BI.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=pk.reportApiInvoke(null,{tag:KI.TRACER,name:qI.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new NI(II.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new NI(II.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=uD(uD({},r),Ak(t))),r=pN(r);const i=xN(8,"track-video-cloned-"),a=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,pN(this._scalabilityMode),this._optimizationMode,i,pN(this._hints));return t&&r&&a.setEncoderConfiguration(r),ok.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),a}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new NI(II.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new NI(II.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(gN((()=>{pk.reportApiInvoke(null,{name:qI.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:KI.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!IA("ENABLE_VIDEO_SEI")||!IA("ENABLE_ENCODED_TRANSFORM"))return void ok.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new NI(II.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void ok.warning("Video track is not published, SEI can not be send");const n=t.sender.getParameters();if(0===n.codecs.length)return;const r=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===r||"video/h265"===r?this.safeEmit("sei-to-send",e):ok.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(Zk.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await oN(this,jk.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await oN(this,jk.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Zk.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners($k.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners($k.REQUEST_CONSTRAINTS)}},oD(CL.prototype,"play",[QM,JM],Object.getOwnPropertyDescriptor(CL.prototype,"play"),CL.prototype),oD(CL.prototype,"stop",[ZM],Object.getOwnPropertyDescriptor(CL.prototype,"stop"),CL.prototype),oD(CL.prototype,"setEnabled",[$M,eL,tL],Object.getOwnPropertyDescriptor(CL.prototype,"setEnabled"),CL.prototype),oD(CL.prototype,"setMuted",[nL,rL,iL],Object.getOwnPropertyDescriptor(CL.prototype,"setMuted"),CL.prototype),oD(CL.prototype,"setSaveEncodeBitrateRatio",[aL,oL],Object.getOwnPropertyDescriptor(CL.prototype,"setSaveEncodeBitrateRatio"),CL.prototype),oD(CL.prototype,"setEncoderConfiguration",[sL,cL],Object.getOwnPropertyDescriptor(CL.prototype,"setEncoderConfiguration"),CL.prototype),oD(CL.prototype,"getStats",[uL],Object.getOwnPropertyDescriptor(CL.prototype,"getStats"),CL.prototype),oD(CL.prototype,"setBeautyEffect",[lL,dL],Object.getOwnPropertyDescriptor(CL.prototype,"setBeautyEffect"),CL.prototype),oD(CL.prototype,"getCurrentFrameData",[fL],Object.getOwnPropertyDescriptor(CL.prototype,"getCurrentFrameData"),CL.prototype),oD(CL.prototype,"getCurrentFrameImage",[hL],Object.getOwnPropertyDescriptor(CL.prototype,"getCurrentFrameImage"),CL.prototype),oD(CL.prototype,"findClosestProfile",[pL,mL],Object.getOwnPropertyDescriptor(CL.prototype,"findClosestProfile"),CL.prototype),oD(CL.prototype,"setBitrateLimit",[gL],Object.getOwnPropertyDescriptor(CL.prototype,"setBitrateLimit"),CL.prototype),oD(CL.prototype,"setOptimizationMode",[vL],Object.getOwnPropertyDescriptor(CL.prototype,"setOptimizationMode"),CL.prototype),oD(CL.prototype,"setScalabiltyMode",[yL],Object.getOwnPropertyDescriptor(CL.prototype,"setScalabiltyMode"),CL.prototype),oD(CL.prototype,"updateMediaStreamTrackResolution",[bL],Object.getOwnPropertyDescriptor(CL.prototype,"updateMediaStreamTrackResolution"),CL.prototype),oD(CL.prototype,"pipe",[_L],Object.getOwnPropertyDescriptor(CL.prototype,"pipe"),CL.prototype),oD(CL.prototype,"unpipe",[wL],Object.getOwnPropertyDescriptor(CL.prototype,"unpipe"),CL.prototype),oD(CL.prototype,"close",[EL],Object.getOwnPropertyDescriptor(CL.prototype,"close"),CL.prototype),oD(CL.prototype,"replaceTrack",[SL],Object.getOwnPropertyDescriptor(CL.prototype,"replaceTrack"),CL.prototype),CL),OL=(xL=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),TL=UD(),RL=UN("CameraVideoTrack","_enabledMutex"),IL=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),NL=UD(),AL=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),kL=UD(),DL=hk({argsMap:e=>[e.getTrackId()]}),ML=class e extends LL{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,a){super(e,Ak(t.encoderConfig),r,i,a),sD(this,"_config",void 0),sD(this,"_originalConstraints",void 0),sD(this,"_constraints",void 0),sD(this,"_enabled",!0),sD(this,"_deviceName","default"),sD(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(mI()||gI())&&!function(){const e=qR();if(e.os!==zR.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&bI()&&this._enabled&&!this._isClosed&&(ok.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=Ak(this._config.encoderConfig),pD.on(Ek.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),pD.on(Ek.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(ok.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await DD.getDeviceById(e),n={};n.video=uD({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await ID(n,this.getTrackId())}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await ID({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await DD.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}ok.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){ok.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:uD(uD({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await ID(t,this.getTrackId())}catch(t){throw ok.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await ID({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=uD({},t.video),ok.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(ok.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await ID({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await oN(this,jk.NEED_ENABLE_TRACK,this)}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),ok.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await oN(this,jk.NEED_DISABLE_TRACK,this)}catch(e){throw ok.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}ok.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new NI(II.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=Ak(e),IA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const n=hN(this._config);n.encoderConfig=e;const r=qD(n);($R()||rI()||yI())&&(r.deviceId=void 0),ok.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(e){const t=new NI(II.UNEXPECTED_ERROR,e.toString());throw ok.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(Fk.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await oN(this,jk.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(ok)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((rI()||yI())&&this._enabled&&!this._isClosed&&pD.duringInterruption){const e=async()=>{pD.off(Ek.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(ok.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};pD.on(Ek.IOS_INTERRUPTION_END,e)}else ok.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Wk.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=DD.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await ID({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),pD.off(Ek.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),pD.off(Ek.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=uD(uD({},r),Ak(t))),r=pN(r);const i=xN(8,"track-cam-cloned-"),a=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,pN(uD(uD({},this._config),{},{encoderConfig:r})),pN(this._constraints),pN(this._scalabilityMode),this._optimizationMode,i);return t&&r&&a.setEncoderConfiguration(r),ok.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),a}bindProcessorContextEvents(){this.processorContext.on($k.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})),this.processorContext.on($k.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}},oD(ML.prototype,"setDevice",[xL,TL],Object.getOwnPropertyDescriptor(ML.prototype,"setDevice"),ML.prototype),oD(ML.prototype,"setEnabled",[RL,IL,NL],Object.getOwnPropertyDescriptor(ML.prototype,"setEnabled"),ML.prototype),oD(ML.prototype,"setEncoderConfiguration",[AL,kL],Object.getOwnPropertyDescriptor(ML.prototype,"setEncoderConfiguration"),ML.prototype),oD(ML.prototype,"close",[DL],Object.getOwnPropertyDescriptor(ML.prototype,"close"),ML.prototype),ML);function PL(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=uD(uD({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?ok.debug("[".concat(e,"] set content hint to"),n.optimizationMode):ok.debug("[".concat(e,"] set content hint failed")))):ok.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var jL,FL,UL,BL,VL,zL,WL,GL,HL,YL,qL,KL;class XL extends lD{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(xN(5,""))),sD(this,"_userId",void 0),sD(this,"_uintId",void 0),sD(this,"_isDestroyed",!1),sD(this,"store",void 0),sD(this,"processor",void 0),sD(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,ok.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let QL=(jL=hk({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),FL=hk({argsMap:e=>[e.getTrackId()]}),UL=hk({argsMap:(e,t)=>[e.getTrackId(),t.name]}),BL=hk({argsMap:e=>[e.getTrackId()]}),oD((VL=class extends XL{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nD.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r,i){super(e,t,n,r),sD(this,"_videoVisibleTimer",null),sD(this,"_previousVideoVisibleStatus",void 0),sD(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),sD(this,"trackMediaType",Hk.VIDEO),sD(this,"_videoWidth",void 0),sD(this,"_videoHeight",void 0),sD(this,"_player",void 0),sD(this,"_prePlayer",void 0),sD(this,"processorDestination",void 0),sD(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new VD(this.getTrackId(),"remote"),this.processorDestination=new BD(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return gN((()=>{ok.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),sN(this,jk.GET_STATS)||uD({},Jk)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.safeEmit(Gk.PLAY_START),"string"==typeof e){const t=document.getElementById(e);t?e=t:(ok.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}ok.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=uD(uD({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let t=!1,r=!1;e instanceof HTMLVideoElement?(this._player=new qM(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,r=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,t=this._player.videoState>0,this._player.updateConfig(n)):this._player=new XM(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Gk.FIRST_FRAME_DECODED),r&&this.safeEmit(Gk.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=e=>{this.safeEmit(Gk.VIDEO_STATE_CHANGED,e)},t&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(Gk.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),IA("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Gk.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,ok.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){YD(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(RN)}_updatePlayerSource(){ok.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:a}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&a instanceof HTMLElement){const e=BI.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=pk.reportApiInvoke(null,{tag:KI.TRACER,name:qI.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new NI(II.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new NI(II.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Zk.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Zk.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(zk.SEI_RECEIVED,e)}}).prototype,"play",[jL],Object.getOwnPropertyDescriptor(VL.prototype,"play"),VL.prototype),oD(VL.prototype,"stop",[FL],Object.getOwnPropertyDescriptor(VL.prototype,"stop"),VL.prototype),oD(VL.prototype,"pipe",[UL],Object.getOwnPropertyDescriptor(VL.prototype,"pipe"),VL.prototype),oD(VL.prototype,"unpipe",[BL],Object.getOwnPropertyDescriptor(VL.prototype,"unpipe"),VL.prototype),VL),JL=(zL=hk({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),WL=hk({argsMap:(e,t)=>[e.getTrackId(),t]}),GL=hk({argsMap:e=>[e.getTrackId()]}),HL=hk({argsMap:e=>[e.getTrackId()]}),YL=hk({argsMap:(e,t)=>[e.getTrackId(),t.name]}),qL=hk({argsMap:e=>[e.getTrackId()]}),oD((KL=class extends XL{get isPlaying(){return this._useAudioElement?FD.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),sD(this,"trackMediaType",Hk.AUDIO),sD(this,"_source",void 0),sD(this,"_useAudioElement",!0),sD(this,"_volume",100),sD(this,"processorContext",void 0),sD(this,"processorDestination",void 0),sD(this,"_played",!1),sD(this,"_bypassWebAudio",!1),IA("DISABLE_WEBAUDIO")?(this._source=new GD,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new wD(e,!0),IA("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Yk.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(Gk.FIRST_FRAME_DECODED)})),this.processorContext=new WD(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new zD(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Yk.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Yk.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Yk.ON_AUDIO_BUFFER),this._source.on(Yk.ON_AUDIO_BUFFER,(t=>e(t)))}setVolume(e){this._volume=e,this._useAudioElement?FD.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!yk())throw new NI(II.NOT_SUPPORTED,"your browser does not support setting the audio output device");await FD.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return gN((()=>{ok.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),sN(this,jk.GET_STATS)||uD({},Xk)}play(){ok.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(ok.debug("[".concat(this.getTrackId(),"] use audio element to play")),FD.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){ok.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?FD.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];ok.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&FD.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new NI(II.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new NI(II.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new NI(II.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Zk.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(Zk.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Zk.ON_TRACK),this.processorDestination.removeAllListeners(Zk.ON_NODE)}}).prototype,"setVolume",[zL],Object.getOwnPropertyDescriptor(KL.prototype,"setVolume"),KL.prototype),oD(KL.prototype,"setPlaybackDevice",[WL],Object.getOwnPropertyDescriptor(KL.prototype,"setPlaybackDevice"),KL.prototype),oD(KL.prototype,"play",[GL],Object.getOwnPropertyDescriptor(KL.prototype,"play"),KL.prototype),oD(KL.prototype,"stop",[HL],Object.getOwnPropertyDescriptor(KL.prototype,"stop"),KL.prototype),oD(KL.prototype,"pipe",[YL],Object.getOwnPropertyDescriptor(KL.prototype,"pipe"),KL.prototype),oD(KL.prototype,"unpipe",[qL],Object.getOwnPropertyDescriptor(KL.prototype,"unpipe"),KL.prototype),KL);const ZL=new class extends GI{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),sD(this,"_lastHiddenTime",0),sD(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),ok.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class $L extends GI{constructor(e,t){super(),sD(this,"trackMediaType",Hk.DATA),sD(this,"_version",1),sD(this,"_type",3),sD(this,"_config",void 0),sD(this,"_originDataChannel",void 0),sD(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),sD(this,"_dataStreamPacketHandler",{serialize:e=>e,deserialize:e=>e}),sD(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return IA("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new rh(((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();const n=setTimeout((()=>{var e;t(new NI(II.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new NI(II.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new NI(II.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[aD.OPEN,aD.CLOSE,aD.ERROR].forEach((t=>{const n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)}))}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach((t=>{let[n,r]=t;e.removeEventListener(n,r)})),this._datachannelEventMap.clear()}}class eO extends $L{constructor(e){super(e),sD(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(t).getUint8(3);if(n!==this.id)return void(IA("SHOW_DATASTREAM2_LOG")&&ok.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let r=e.data.slice(this._dataStreamPacketHeader.byteLength);r=this._dataStreamPacketHandler.deserialize(r),this.emit(aD.MESSAGE,r)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class tO extends $L{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function nO(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout((()=>wy.revokeObjectURL(e)),0),new Worker(wy.createObjectURL(e))}const rO=71,iO=1,aO=2,oO=1,sO=2;var cO=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(cO||{});function uO(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.getUint8(0);if(n!==rO)return;const r=e.getUint16(1),i=iO+aO+r,a=new Uint8Array(e.byteLength-i);a.set(new Uint8Array(e.buffer,i,e.byteLength-i));const o={m:n,tlvLen:r,tlv:[],frame:a};let s=iO+aO;for(;s<i;){const n=e.getUint8(s),r=e.getUint16(s+oO),i=oO+sO;if(n===cO.AUDIO_LEVEL){let a=e.getUint8(s+i);for(let t=1;t<r;t++)a=a<<8|e.getUint8(s+i+t);o.tlv.push({tag:n,length:r,value:t?127^a>>1:127&a})}else if(n===cO.METADATA||n===cO.AUDIO_64_BIT_PTS){const t=new Uint8Array(r);for(let n=0;n<r;n++)t[n]=e.getUint8(s+i+n);o.tlv.push({tag:n,length:r,value:t})}s+=i+r}return o}const lO=new Map,dO=127,fO=1e-10,hO=139/13,pO=new Map;function mO(e,t,n){const r="".concat(e,"-").concat(t,"-").concat(n);let i=0;if(pO.has(r))i=pO.get(r);else{const a=.5;i=Math.log(function(e,t){const n=e-t;t<n&&(t=n);let r=1;for(let i=e,a=1;i>t;i--,a++)r=r*i/a;return r}(t,e))+e*Math.log(a)+(t-e)*Math.log(1-a)-Math.log(n)+n*e,pO.set(r,i)}return i<fO&&(i=fO),i}function gO(e,t,n){const r=t.length,i=e.length/r;let a=!1;for(let o=0,s=0;o<r;o++){let r=0;for(let t=s+i;s<t;s++)e[s]>n&&r++;t[o]!==r&&(t[o]=r,a=!0)}return a}window.cache=pO;let vO=0;class yO{constructor(e){sD(this,"id",void 0),sD(this,"immediates",[]),sD(this,"lastNonSilence",-1),sD(this,"immediateSpeechActivityScore",fO),sD(this,"lastLevelChangedTime",Date.now()),sD(this,"levels",[]),sD(this,"longs",[]),sD(this,"longSpeechActivityScore",fO),sD(this,"mediums",[]),sD(this,"mediumSpeechActivityScore",fO),sD(this,"minLevel",0),sD(this,"nextMinLevel",0),sD(this,"nextMinLevelWindowLength",0),sD(this,"energyScore",0),this.id=e||"".concat(vO++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,t=this.levels,n=this.minLevel+hO;let r=!1;for(let i=0;i<e.length;++i){let a=t[i];a<n&&(a=0);const o=Math.floor(a/hO);e[i]!==o&&(e[i]=o,r=!0)}return r}computeLongs(){return gO(this.mediums,this.longs,4)}computeMediums(){return gO(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=mO(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=mO(this.longs[0],10,47),this.longSpeechActivityScore>fO&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=mO(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(vi(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;let n=e;return e<0&&(n=0),e>dO&&(n=dO),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+hO?n:n/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(0!==e){if(0===this.minLevel||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(0===this.nextMinLevel)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let e=Math.sqrt(this.minLevel*this.nextMinLevel);e<0?e=0:e>dO&&(e=dO),this.minLevel=e,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class bO{constructor(e){sD(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch(t){e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class _O{constructor(e,t,n){sD(this,"isDominant",void 0),sD(this,"energyRanking",void 0),sD(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=n}}class wO extends GI{constructor(e){super(),sD(this,"dominantId",null),sD(this,"lastDecisionTime",0),sD(this,"lastLevelChangedTime",0),sD(this,"lastLevelIdleTime",0),sD(this,"relativeSpeechActivities",[]),sD(this,"speakers",new Map),sD(this,"enableSilence",!1),sD(this,"timeoutToSilenceInterval",0),sD(this,"decisionMaker",null),sD(this,"loudest",[]),sD(this,"numLoudestToTrack",3),sD(this,"energyExpireTimeMs",250),sD(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,null!=t&&(this.energyExpireTimeMs=t),null!=n&&(this.energyAlphaPct=n),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some((t=>t.id===e))}levelChanged(e,t){const n=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());const i=r.levelChanged(t,n);return this.updateLoudestList(r,i,n)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach((e=>{this.speakers.has(e.id)||this.speakers.set(e.id,e)}))}removeSpeakers(e){e.forEach((e=>{this.speakers.delete(e.id)}))}getOrCreateSpeaker(e){let t=this.speakers.get(e);return t||(t=new yO(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t}updateLoudestList(e,t,n){const r=e.id===this.dominantId;if(t<0){let t=0;for(;t<this.loudest.length&&this.loudest[t]!==e;)++t;return new _O(r,t,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),0===this.numLoudestToTrack)return new _O(r,0,e.energyScore);const i=n-this.energyExpireTimeMs;let a=0;for(;a<this.loudest.length;){const t=this.loudest[a];if(t.getLastLevelChangedTime()<i&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(a,1);else if(t.id!==e.id)++a;else if(this.loudest.splice(a,1),this.loudest.length<this.numLoudestToTrack)break}let o=0;for(;o<this.loudest.length&&!(this.loudest[o].energyScore<e.energyScore);)++o;return o<this.numLoudestToTrack&&(this.loudest.splice(o,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new _O(r,o,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new bO(this),this.decisionMaker.execute())}makeDecision(e){let t=null,n=null;const r=this.speakers.size;let i=null;if(0===r)i=null;else if(1===r){var a;const t=fh(a=this.speakers).call(a).next().value;this.enableSilence&&t&&(i=t.id,t.evaluateSpeechActivityScores(e),e-t.lastNonSilence>this.timeoutToSilenceInterval&&(i=null))}else{let t=null==this.dominantId?null:this.speakers.get(this.dominantId);if(null==t){const e=this.speakers.entries().next();e.value&&(i=e.value[0],t=e.value[1])}else i=t.id;null!=t&&t.evaluateSpeechActivityScores(e);const n=this.relativeSpeechActivities;let r=2;for(const a of this.speakers.entries()){const[o,s]=a;if(s===t)continue;s.evaluateSpeechActivityScores(e);for(let e=0;e<n.length;++e){const r=null==t?fO:t.getSpeechActivityScore(e);n[e]=Math.log(s.getSpeechActivityScore(e)/r)}const c=n[0],u=n[1],l=n[2];c>3&&u>2&&l>0&&u>r&&(r=u,i=o)}this.enableSilence&&null!=t&&i===t.id&&e-t.lastNonSilence>this.timeoutToSilenceInterval&&(i=null)}null==i&&!this.enableSilence||i===this.dominantId||(t=this.dominantId,this.dominantId=i,n=this.dominantId),null==n&&!this.enableSilence||n===t||this.emit("ActiveSpeakerChanged",n)}_runInDecisionMaker(){const e=Date.now(),t=300-(e-this.lastLevelIdleTime);let n=0;t<=0?(0!==this.lastLevelIdleTime&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):n=t;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&n>r&&(n=r),n}timeoutIdleLevels(e){const t=[];for(const r of fh(n=this.speakers).call(n)){var n;const i=e-r.getLastLevelChangedTime();36e5<i&&(null==this.dominantId||r.id!==this.dominantId)?t.push(r.id):300<i&&r.levelTimedOut()}t.forEach((e=>this.speakers.delete(e)))}}const EO=new Map;let SO=null,CO=null;const xO=3;let TO=[];const RO=new Map,IO=new Map;class NO{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,t){sD(this,"id",void 0),sD(this,"track",void 0),sD(this,"score",0),sD(this,"active",!0),sD(this,"muted",!1),sD(this,"timer",0),sD(this,"actives",0),sD(this,"inactives",0),this.id=e,this.track=t,this.setActive(RO.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:t,inactives:n}=function(){const e=[],t=[];return Array.from(fh(RO).call(RO)).forEach((n=>{n.active?e.push(n):t.push(n)})),{actives:e,inactives:t}}();if(t.length>3){let e;t.forEach((t=>{(!e||e.score>t.score)&&(e=t)})),e&&e.setActive(!1)}if(t.length<3&&n.length>0){let t;n.forEach((e=>{(!t||t.score<e.score)&&e.id!==this.id&&(t=e)})),t&&e&&!this.active&&(t.samples>40&&t.activeRate-this.activeRate>.4?t.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(e){let t;return Array.from(fh(RO).call(RO)).forEach((n=>{!n.active||n.id===e||n.samples<40||(!t||n.score<t.score)&&(t=n)})),t}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(e){let t;return Array.from(fh(RO).call(RO)).forEach((n=>{n.active||n.id===e||n.samples<40||(!t||n.score>t.score)&&(t=n)})),t}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(0!==this.samples)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let AO;function kO(e){const t=RO.get(e);t&&(RO.delete(e),t.clearTimer())}const DO=new Map,MO=new Map,LO="video/h264",OO="video/h265";function PO(e,t,n){let r=new Uint8Array(e,t,n),i=[],a=0;for(;i.length<n;)a+3<n&&0===r[a]&&0===r[a+1]&&3===r[a+2]&&(0===r[a+3]||1===r[a+3]||2===r[a+3]||3===r[a+3])?(i.push(r[a],r[a+1],r[a+3]),a+=4):(i.push(r[a]),a++);return new Uint8Array(i)}function jO(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&0===e[r]&&0===e[r+1]&&(0===e[r+2]||1===e[r+2]||2===e[r+2]||3===e[r+2])?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}function FO(e){if(e.length<5)return"";let t=-1;for(let i=0;i<e.length-3;i++){if(0===e[i]&&0===e[i+1]&&1===e[i+2]){t=i;break}if(i<e.length-4&&0===e[i]&&0===e[i+1]&&0===e[i+2]&&1===e[i+3]){t=i;break}}if(-1===t)return"";const n=t+(0===e[t+2]?4:3);if(n>=e.length)return"";const r=e[n];return 128&r?"":(r>>1&63)>=32||n+1<e.length&&0==(248&e[n+1])?OO:(31&r)<=31?LO:""}const UO=new Map,BO=new Map;!function(){const e=qR();gk.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),gk.getStreamFromExtension=e.name===WR.CHROME&&Number(e.version)>34,gk.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),gk.supportMinBitrate=e.name===WR.CHROME||e.name===WR.EDGE,gk.supportSetRtpSenderParameters=function(){const e=qR();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!EI()||!(!$R()&&!JR())||e.name===WR.FIREFOX&&Number(e.version)>=64)}(),e.name===WR.SAFARI&&(Number(e.version)>=14?gk.supportDualStream=!0:gk.supportDualStream=!1),gk.webAudioMediaStreamDest=function(){const e=qR();return!(e.name===WR.SAFARI&&Number(e.version)<12)}(),gk.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,gk.supportWebGL="undefined"!=typeof WebGLRenderingContext,gk.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,EI()||(gk.webAudioWithAEC=!0),gk.supportShareAudio=function(){const e=qR();return(e.os===zR.WIN_10||e.os===zR.WIN_81||e.os===zR.WIN_7||e.os===zR.LINUX||e.os===zR.MAC_OS||e.os===zR.CHROMIUM_OS)&&e.name===WR.CHROME&&Number(e.version)>=74}(),gk.supportDataChannel=!!(iI(76)||cI(68)||uI(14)),gk.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!nI()&&!!e&&e.prototype.setConfiguration instanceof Function}(),gk.supportWebRTCEncodedTransform=iI(87)||eI()||cI(117),gk.supportWebRTCInsertableStream=function(){const e=qR();return(e.name===WR.CHROME||e.name===WR.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),gk.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,gk.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,fN((()=>{gk.supportDualStreamEncoding=function(){const e=qR();return!!IA("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&IA("CHROME_DUAL_STREAM_USE_ENCODING"))}(),ok.debug("browser ua: ",navigator.userAgent),ok.info("browser info: ",e),ok.info("browser compatibility: ",gk)}))}();const VO=["CHINA","GLOBAL"],zO=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],WO=[],GO=[];function HO(e,t){return!!t&&WO.some((n=>n.uid===e&&n.channelName===t))}function YO(){return GO.length>0}var qO=RE.forEach,KO=Gr("forEach")?[].forEach:function(e){return qO(this,e,arguments.length>1?arguments[1]:void 0)};kn({target:"Array",proto:!0,forced:[].forEach!==KO},{forEach:KO});var XO=er("Array","forEach"),QO=gr,JO=et,ZO=d,$O=XO,eP=Array.prototype,tP={DOMTokenList:!0,NodeList:!0},nP=function(e){var t=e.forEach;return e===eP||ZO(eP,e)&&t===eP.forEach||JO(tP,QO(e))?$O:t},rP=r(nP),iP=Je,aP=fa;kn({target:"Object",stat:!0,forced:i((function(){aP(1)}))},{keys:function(e){return aP(iP(e))}});var oP=r(ee.Object.keys),sP=r(ri),cP=r(gi),uP=kn,lP=oi,dP=Jc,fP=$,hP=Bn,pP=Hn,mP=J,gP=qm,vP=pt,yP=ou,bP=Vw("slice"),_P=vP("species"),wP=Array,EP=Math.max;uP({target:"Array",proto:!0,forced:!bP},{slice:function(e,t){var n,r,i,a=mP(this),o=pP(a),s=hP(e,o),c=hP(void 0===t?o:t,o);if(lP(a)&&(n=a.constructor,(dP(n)&&(n===wP||lP(n.prototype))||fP(n)&&null===(n=n[_P]))&&(n=void 0),n===wP||void 0===n))return yP(a,s,c);for(r=new(void 0===n?wP:n)(EP(c-s,0)),i=0;s<c;s++,i++)s in a&&gP(r,i,a[s]);return r.length=i,r}});var SP=er("Array","slice"),CP=d,xP=SP,TP=Array.prototype,RP=function(e){var t=e.slice;return e===TP||CP(TP,e)&&t===TP.slice?xP:t},IP=r(RP);function NP(e,t,n,r,i){var a,o,s,c={};return rP(a=oP(r)).call(a,(function(e){c[e]=r[e]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=sP(o=cP(s=IP(n).call(n)).call(s)).call(o,(function(n,r){return r(e,t,n)||n}),c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer?(Nw(e,t,c),null):c}let AP=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),kP=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),DP=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),MP=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),LP=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),OP=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),PP=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),jP=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),FP=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),UP=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),BP=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),VP=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function zP(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw ok.error("Invalid Channel Name ".concat(e)),new mk(II.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function WP(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||jI(e,1,255)))throw new mk(II.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&ok.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let GP=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const HP={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},YP={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function qP(e,t){LI(e.url,"".concat(t,".url"),1,1e3,!1),PI(e.x)||DI(e.x,"".concat(t,".x"),0,1e4),PI(e.y)||DI(e.y,"".concat(t,".y"),0,1e4),PI(e.width)||DI(e.width,"".concat(t,".width"),0,1e4),PI(e.height)||DI(e.height,"".concat(t,".height"),0,1e4),PI(e.zOrder)||DI(e.zOrder,"".concat(t,".zOrder"),0,255),PI(e.alpha)||DI(e.alpha,"".concat(t,".alpha"),0,1,!1)}const KP={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let XP=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),QP=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),JP=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function ZP(e){if(!e.channelName)throw new mk(II.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new mk(II.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&LI(e.token,"info.token",1,2047),WP(e.uid),zP(e.channelName),!0}let $P=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),ej=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),tj=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),nj=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),rj=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),ij=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),aj=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),oj=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),sj=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const cj=[sj.AFRICA,sj.ASIA,sj.CHINA,sj.EUROPE,sj.GLOBAL,sj.INDIA,sj.JAPAN,sj.NORTH_AMERICA,sj.OCEANIA,sj.OVERSEA,sj.SOUTH_AMERICA];let uj=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const lj={CHINA:{},ASIA:{CODE:uj.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:uj.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:uj.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:uj.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:uj.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:uj.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:uj.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:uj.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:uj.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:uj.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:uj.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:uj.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:uj.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};bA&&(lj.CHINA={CODE:uj.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let dj=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function fj(e){return!!e&&!(!e.uplink||!e.id)&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate}class hj extends GI{constructor(e,t){super(),dx(this,"onICEConnectionStateChange",void 0),dx(this,"onConnectionStateChange",void 0),dx(this,"onDTLSTransportStateChange",void 0),dx(this,"onDTLSTransportError",void 0),dx(this,"onICETransportStateChange",void 0),dx(this,"onFirstAudioReceived",void 0),dx(this,"onFirstVideoReceived",void 0),dx(this,"onFirstAudioDecoded",void 0),dx(this,"onFirstVideoDecoded",void 0),dx(this,"onFirstVideoRender",void 0),dx(this,"onFirstVideoDecodedTimeout",void 0),dx(this,"onSelectedLocalCandidateChanged",void 0),dx(this,"onSelectedRemoteCandidateChanged",void 0),dx(this,"onICECandidateError",void 0),dx(this,"getLocalVideoStats",void 0)}}class pj extends hj{constructor(e,t){super(e,t),dx(this,"establishPromise",void 0)}}let mj=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),gj=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),vj=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const yj=["disconnected","failed"];let bj=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),_j=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),wj=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Ej=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Sj=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Cj=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),xj=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Tj=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Rj=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Ij=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Nj=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Aj=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),kj=function(e){return e.ABORT="abort",e}({}),Dj=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Mj=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Lj={[AP.ACCESS_POINT]:{[MP.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[MP.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[MP.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[MP.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[MP.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[MP.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[MP.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[AP.UNILBS]:{[DP.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[DP.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[DP.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[DP.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[DP.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[DP.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[DP.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[DP.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[DP.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[DP.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[DP.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[DP.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[AP.STRING_UID_ALLOCATOR]:{[kP.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[kP.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[kP.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Oj(e){const t=Lj[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===AP.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const Pj={[LP.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[LP.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[LP.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[LP.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[LP.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[LP.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[LP.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[LP.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[LP.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[LP.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[LP.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[LP.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[LP.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[LP.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[LP.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[LP.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[LP.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[LP.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[LP.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[LP.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[LP.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[LP.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[LP.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[LP.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[LP.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[LP.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[LP.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[LP.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[LP.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[LP.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[LP.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[LP.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[LP.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[LP.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[LP.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[LP.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[LP.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[LP.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[LP.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[LP.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[LP.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[LP.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[LP.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[LP.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[LP.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[LP.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[LP.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[LP.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[LP.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[LP.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[LP.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[LP.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[LP.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[LP.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[LP.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[LP.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[LP.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[LP.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[LP.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[LP.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[LP.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[LP.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[LP.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[LP.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function jj(e){return Pj[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function Fj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Uj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fj(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Bj(e,t){if("string"==typeof e)return e;const{proxy:n,host:r,port:i}=e;if(t){const e=IA("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(e,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const Vj=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,zj=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Wj=/wss:\/\/(.+):([0-9]+)\/?/,Gj=/wss:\/\/(.[^\/]+)\/?/;let Hj=0;class Yj{constructor(e,t){dx(this,"id",0),dx(this,"store",void 0),dx(this,"recordIndex",void 0),dx(this,"websockets",[]),dx(this,"try443PortDuration",2e3),dx(this,"forceCloseWSDuration",5e3),dx(this,"try443PortTimeout",null),dx(this,"forceCloseTimeout",null),dx(this,"isTry443PortFailed",!1),dx(this,"isNormalPortFailed",!1),dx(this,"useDoubleDomain",!1),dx(this,"useProxy",!1),dx(this,"startTime",Date.now()),this.id=++Hj,this.try443PortDuration=IA("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach((e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const t=Date.now()-this.startTime;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];ok.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});const r=IA("GATEWAY_DOMAINS"),i=Date.now(),a=[],o=r.find((t=>{var n;return Lr(n=e.host).call(n,t)}));o||(this.useDoubleDomain=!1);const s=[];if(this.useDoubleDomain)r.forEach((n=>{s.push(Bj(Uj(Uj({},e),{},{host:e.host.replace(o,n)}),t))}));else{const n=Uj({},e);if(t&&o){const e=r.find((e=>e!==o));e&&(n.host=n.host.replace(o,e))}s.push(Bj(n,t))}try{s.forEach((e=>{const t=new WebSocket(e);t.binaryType="arraybuffer",a.push(t),this.logger("ws is connecting:",t.url)}))}catch(r){if(this.logger("ws create failed"),a.forEach((e=>e.close())),a.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new mk(II.WS_ERR,"init websocket failed! Error: ".concat(r.toString()))}const c=FR();this.store&&this.store.recordJoinChannelService({urls:a.map((e=>e.url)),service:"gateway"},this.recordIndex),a.forEach((e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach((t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))})),this.websockets.length=0,c.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(e.readyState));const r=a.every((e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING));this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(r)),r&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:aj.A_ROUND_WS_FAILED})):!t&&r&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),l()),t?this.isTry443PortFailed=r:this.isNormalPortFailed=r},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))})),this.websockets.push(...a);const u=()=>{this.websockets.forEach((e=>e.readyState!==WebSocket.OPEN&&e.close()))},l=()=>{if(c.isResolved)return u();qR().os===zR.MAC_OS&&nI()&&u(),this.createWebSocket(e,!0,!0).then((e=>{c.resolve(e)})).catch((e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.forceCloseTimeout=null,u()}),this.forceCloseWSDuration)};return n||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,u()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",c.isResolved),this.try443PortTimeout=null,l()}),this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,n,r){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,r;return[,t,n,r]=e.match(Vj)||[],t||([,n,r]=e.match(zj)||[]),n&&r||([,n,r]=e.match(Wj)||[]),n&&r||([,n]=e.match(Gj)||[]),n||ok.warning("un-destructible url: ",e),{proxy:t,host:n,port:r||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(ok.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally((()=>this.clearTimeout()))}}function qj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class Kj extends GI{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Lr(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(VP.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(VP.CONNECTED):"closed"===this._state?this.emit(VP.CLOSED):"failed"===this._state&&this.emit(VP.FAILED))}resetReconnectCount(e){ok.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;super(),dx(this,"_websocketUrl",null),dx(this,"connectionID",0),dx(this,"currentURLIndex",0),dx(this,"urls",[]),dx(this,"_reconnectMode","tryNext"),dx(this,"reconnectReason",void 0),dx(this,"_initMutex",void 0),dx(this,"name",void 0),dx(this,"_state","closed"),dx(this,"reconnectInterrupter",void 0),dx(this,"websocket",void 0),dx(this,"retryConfig",void 0),dx(this,"reconnectCount",0),dx(this,"forceCloseTimeout",5e3),dx(this,"onlineReconnectListener",void 0),dx(this,"useCompress",void 0),dx(this,"tryDoubleDomain",!1),dx(this,"use443PortOnly",!1),dx(this,"wsInflateLength",0),dx(this,"wsDeflateLength",0),dx(this,"closeEstablishingWs",(()=>{})),dx(this,"store",void 0),dx(this,"joinGatewayRecordIndex",void 0),this.store=a,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qj(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qj(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r,this.use443PortOnly=i,this._initMutex=new FN("websocket",a?a.clientId:void 0);const{timeout:o,timeoutFactor:s}=t,c=Math.max(300,Math.floor(3*o/5)),u=Math.max(1.2,Math.floor(8*s)/10);rN.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=u),uN.on(iN.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===rN.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=u):(this.retryConfig.timeout=o,this.retryConfig.timeoutFactor=s))}))}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{var r;const e=FR(),t=this.urls[this.currentURLIndex];null===(r=this.store)||void 0===r||r.beforeConnect(),function(e){return!(bk()||IA("USE_NEW_TOKEN")||!IA("ENABLE_PREALLOC_PC")&&(null==e||!e.autoSubscribe||IA("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(xj.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(VP.CLOSED,(()=>{e.reject(new NI(II.WS_DISCONNECT))})),this.once(VP.CONNECTED,e.resolve),await e.promise}catch(e){}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout((()=>e.close()),500):e.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void ok.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),ok.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new NI(II.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new NI(II.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const n=FR();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),ok.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},i=async e=>{var t;if(ok.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new NI(II.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=sN(this,VP.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void ok.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return n.reject(new NI(II.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},a=e=>{this.emit(VP.ON_MESSAGE,e)},o=e=>{ok.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),IA("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=IA("GATEWAY_WSS_ADDRESS")),ok.debug("[".concat(this.name,"] start connect, url:"),e);const s=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;this._websocketUrl=Bj(e);const t=await this.chooseBestWebsocketConnection(e);this.websocket=t,r&&r(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=a,this.websocket.onerror=o,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},s),this.joinGatewayRecordIndex=s}catch(e){const t="closed"===this.state,r=e instanceof NI,a=r&&e.code===II.WS_ABORT,o=r&&e.code===II.WS_ERR,c=r?e.message:e&&(e.reason||e.toString());ok.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:a?"aborted":"error",errors:[e]},s),t||o?(n.reject(t?new NI(II.WS_DISCONNECT,"websocket is closed: ".concat(c)):new NI(II.WS_ERR,"init websocket failed: ".concat(c))),o&&ok.error("[".concat(this.name,"] init websocket failed: ").concat(c))):i&&i(e)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;ok.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||uN.isOnline||!uN.onlineWaiter||(this.onlineReconnectListener=uN.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){const t=VN(this.reconnectCount,this.retryConfig);ok.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await rh.race([CN(t),this.onlineReconnectListener||new rh((()=>{}))])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;const r=async(e,t)=>{this.emit(VP.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)await r(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);ok.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else"recover"===e&&(ok.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await aN(this,VP.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(n){var i;ok.error("[".concat(this.name,"] reconnect failed ").concat(n&&n.toString()));const r=null==n||null===(i=n.data)||void 0===i?void 0:i.desc;return Array.isArray(r)&&Lr(r).call(r,"dynamic key expired")?(this.emit(VP.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class Xj extends Kj{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const n=FR(),r=function(e,t){return new Yj(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{ok.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),n.reject(new NI(II.WS_ABORT,"choose best websocket aborted"))};const i=IA("GATEWAY_DOMAINS");return ok.debug("[choose-best-ws] currentDomain: ",e,", domains: ",i,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class Qj extends Kj{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new rh(((n,r)=>{let i=!1;const a=[];this.closeEstablishingWs=()=>{ok.debug("[choose-best-ws] close establishing websockets"),a.forEach((e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),r(new NI(II.WS_ABORT,"choose best websocket aborted"))};const o=IA("GATEWAY_DOMAINS");let s;const c=e.indexOf("?h="),u=o.find((t=>-1!==c?Lr(e).call(e,t,c):Lr(e).call(e,t)));ok.debug("[choose-best-ws] currentDomain: ",u,", domains: ",o);let l=!this.tryDoubleDomain||!u;if(!l&&u){var d;const f=Date.now();try{o.forEach((t=>{const n=-1===c?e.replace(u,t):e.substr(0,c)+e.substr(c).replace(u,t),r=new WebSocket(n);r.binaryType="arraybuffer",a.push(r),ok.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(e){for(ok.debug("[choose-best-ws] ws create failed, fallback to single url"),a.forEach((e=>e.close()));a.length;)a.pop();l=!0}null===(d=this.store)||void 0===d||d.recordJoinChannelService({urls:a.map((e=>e.url)),service:"gateway"},t),a.forEach((e=>{e.onopen=()=>{if(i)return;const t=Date.now()-f;ok.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),a.filter((t=>t!==e)).forEach((e=>{ok.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),i=!0,n(e)},e.onclose=e=>{s=e,i||a.find((e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)))||(ok.debug("[choose-best-ws] all websocket is closed"),i=!0,r(s))},e.onmessage=t=>{ok.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}})),CN(this.forceCloseTimeout).then((()=>{a.forEach((e=>{e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(l){var f;let i;ok.debug("[choose-best-ws] use single url: ",e),null===(f=this.store)||void 0===f||f.recordJoinChannelService({urls:[e],service:"gateway"},t);try{i=new WebSocket(e),a.push(i),i.binaryType="arraybuffer"}catch(e){const n=new NI(II.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return ok.error("[".concat(this.name,"]").concat(n)),void r(n)}i.onopen=()=>{n(i)},i.onclose=e=>{r(e)},i.onmessage=e=>{ok.debug("[choose-best-ws]".concat(i.url," onmessage: ").concat(e.data))},CN(this.forceCloseTimeout).then((()=>{i&&i.readyState!==WebSocket.OPEN&&i.close()}))}})).then((e=>(this.closeEstablishingWs=void 0,e))).catch((e=>{throw this.closeEstablishingWs=void 0,e}))}}class Jj extends GI{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===OP.CONNECTED?this.emit(PP.WS_CONNECTED):e===OP.RECONNECTING?this.emit(PP.WS_RECONNECTING,this._websocketReconnectReason):e===OP.CLOSED&&this.emit(PP.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),dx(this,"_disconnectedReason",void 0),dx(this,"_websocketReconnectReason",void 0),dx(this,"_connectionState",OP.CLOSED),dx(this,"reconnectToken",void 0),dx(this,"websocket",void 0),dx(this,"openConnectionTime",void 0),dx(this,"clientId",void 0),dx(this,"lastMsgTime",Date.now()),dx(this,"uploadCache",[]),dx(this,"uploadCacheInterval",void 0),dx(this,"rttRolling",new GN(5)),dx(this,"pingpongTimer",void 0),dx(this,"wsInflateDataTimer",void 0),dx(this,"pingpongTimeoutCount",0),dx(this,"ortc",void 0),dx(this,"joinResponse",void 0),dx(this,"multiIpOption",void 0),dx(this,"initError",void 0),dx(this,"spec",void 0),dx(this,"store",void 0),dx(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(PP.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===UP.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===UP.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(JI.UID_BANNED);break;case 15:this.close(JI.IP_BANNED);break;case 16:this.close(JI.CHANNEL_BANNED)}if(t._type===UP.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case LP.ERR_LICENSE_MISSING:this.close(JI.LICENSE_MISSING);break;case LP.ERR_LICENSE_EXPIRED:this.close(JI.LICENSE_EXPIRED);break;case LP.ERR_LICENSE_MINUTES_EXCEEDED:this.close(JI.LICENSE_MINUTES_EXCEEDED);break;case LP.ERR_LICENSE_PERIOD_INVALID:this.close(JI.LICENSE_PERIOD_INVALID);break;case LP.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(JI.LICENSE_MULTIPLE_SDK_SERVICE);break;case LP.ERR_LICENSE_ILLEGAL:this.close(JI.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Xj("gateway-".concat(this.clientId),this.spec.retryConfig,!0,IA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),IA("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===OP.CONNECTED&&this.reconnect("retry",nN.OFFLINE)}))}async request(e,t,n,r){const i=xN(6,""),a={_id:i,_type:e,_message:t},o=this.websocket.connectionID,s=()=>new rh(((t,n)=>{if(this.connectionState===OP.CONNECTED)return t();const r=()=>{this.off(PP.WS_CLOSED,i),t()},i=()=>{this.off(PP.WS_CONNECTED,r),n(new mk(II.WS_ABORT))};this.once(PP.WS_CONNECTED,r),this.once(PP.WS_CLOSED,i),e!==jP.PUBLISH&&e!==jP.PUBLISH_DATASTREAM&&e!==jP.SUBSCRIBE&&e!==jP.SUBSCRIBE_DATASTREAM&&e!==jP.UNSUBSCRIBE&&e!==jP.UNSUBSCRIBE_DATASTREAM&&e!==jP.UNPUBLISH&&e!==jP.UNPUBLISH_DATASTREAM&&e!==jP.CONTROL&&e!==jP.RESTART_ICE||this.once(PP.DISCONNECT_P2P,(()=>{n(new mk(II.DISCONNECT_P2P))})),e!==jP.PUBLISH&&e!==jP.RESTART_ICE||this.once(PP.ABORT_P2P_EXECUTION,(()=>{n(new mk(II.DISCONNECT_P2P))}))}));if(this.connectionState!==OP.CONNECTING&&this.connectionState!==OP.RECONNECTING||e===jP.JOIN||e===jP.REJOIN||await s(),this.websocket.sendMessage(a,!0),r)return;const c=new rh(((n,r)=>{let a=!1;const s=(r,i)=>{a=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(PP.WS_CLOSED,c),this.off(PP.WS_RECONNECTING,c),this.emit(PP.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);const c=()=>{r(new mk(II.WS_ABORT,"type: ".concat(e))),this.off(PP.WS_CLOSED,c),this.off(PP.WS_RECONNECTING,c),this.off("res-@".concat(i),s)};this.once(PP.WS_CLOSED,c),this.once(PP.WS_RECONNECTING,c),CN(IA("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==o||a||(ok.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(PP.REQUEST_TIMEOUT,e,t))}))}));let u=null;try{u=await c}catch(r){if(this.connectionState===OP.CLOSED||e===jP.LEAVE)throw new mk(II.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===jP.JOIN||e===jP.REJOIN?null:(await s(),await this.request(e,t))}if(u.isSuccess)return u.message;const l=Number(u.message.error_code||u.message.code),d=jj(l),f=new mk(II.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(u.message.error_str),{code:l,data:u.message,desc:d.desc});return"success"===d.action?u.message:(ok.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(d.desc,", action: ").concat(d.action)),l===LP.ERR_TOO_MANY_BROADCASTERS?e===jP.JOIN||e===jP.REJOIN?(this.initError=f,this.close(),f.throw()):f.throw():"failed"===d.action?f.throw():"quit"===d.action?(this.initError=f,this.close(),f.throw()):(l===LP.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,ok.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nN.MULTI_IP)):this.reconnect(d.action,nN.SERVER_ERROR),e===jP.JOIN||e===jP.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new rh((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void ok.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(FP.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=IA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==OP.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),IA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new rh(((t,n)=>{this.once(PP.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(PP.WS_CLOSED,(e=>n(this.initError||new mk(II.WS_ABORT,e)))),this.connectionState=OP.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||JI.LEAVE,this.connectionState=OP.CLOSED,ok.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(PP.ABORT_P2P_EXECUTION),this.store.signalConnected();const e=await aN(this,PP.REQUEST_JOIN_INFO);this.store.joinReq();const t=await this.request(jP.JOIN,e);if(this.ortc=null==e?void 0:e.ortc,this.store.joinRep(),!t)return this.emit(PP.REPORT_JOIN_GATEWAY,aj.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(PP.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=OP.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new mk(II.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=cN(this,PP.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(jP.REJOIN,e);return!!t&&(this.connectionState=OP.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(UP.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(UP.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(UP.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(UP.MUTE_AUDIO,{uid:e.uid}):this.emit(UP.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(UP.MUTE_VIDEO,{uid:e.uid}):this.emit(UP.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(UP.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(UP.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(UP.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(UP.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(UP.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){if(!this.ortc)return!1;const t={downgrade_codec:e,ortc:this.ortc};return!!await this.request(jP.DOWNGRADE_CODEC,t)}handleNotification(e){ok.debug("[".concat(this.clientId,"] receive notification: "),e);const t=jj(e.code);if(28===e.code&&"detail"in e&&(ok.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(PP.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(JI.UID_BANNED),void this.close()):void this.reconnect(t.action,nN.SERVER_ERROR);ok.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=IA("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(ok.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>IA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nN.TIMEOUT):this.request(jP.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),IA("REPORT_STATS")&&this.send(jP.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(FP.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(VP.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(PP.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(VP.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(VP.CLOSED,(()=>{this.connectionState=OP.CLOSED})),this.websocket.on(VP.FAILED,(()=>{this._disconnectedReason=JI.NETWORK_ERROR,this.connectionState=OP.CLOSED})),this.websocket.on(VP.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===OP.CONNECTED?this.connectionState=OP.RECONNECTING:this.connectionState=OP.CONNECTING})),this.websocket.on(VP.WILL_RECONNECT,((e,t,n)=>{const r=cN(this,PP.IS_P2P_DISCONNECTED),i=r||"retry"!==e;r&&"retry"===e&&(ok.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=aj.P2P_DISCONNECTED),i&&(ok.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(PP.REPORT_JOIN_GATEWAY,t||aj.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(PP.DISCONNECT_P2P)),n(e)})),this.websocket.on(VP.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{ok.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",nN.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(PP.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof mk){if(e.code===II.UNEXPECTED_RESPONSE&&e.data.code===LP.ERR_NO_AUTHORIZED)return this.initError=new mk(II.TOKEN_EXPIRE,"dynamic key expired"),void this.close(JI.TOKEN_EXPIRE);ok.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nN.SERVER_ERROR):(this.initError=e,this.close())}}))})),this.websocket.on(VP.REQUEST_NEW_URLS,((e,t)=>{aN(this,PP.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(VP.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(UP.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(xj.PRE_CONNECT_PC,(()=>{this.emit(PP.PRE_CONNECT_PC)}))}}let Zj=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),$j=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function eF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eF(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nF(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(IA("TURN_DOMAIN")):(ok.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function rF(e){try{const t=IA("GATEWAY_DOMAINS").concat(IA("TURN_DOMAIN")).find((t=>Lr(e).call(e,t)));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch(t){return ok.debug("serverUrlToIp error, fallback to url",e),e}}function iF(e,t){e.addresses||(e.addresses=[]);const n=function(e,t){if(IA("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map((e=>{let{ip:t,port:n}=e;return{address:"".concat(t,":").concat(n)}}));const n=IA("GATEWAY_DOMAINS");let r=n[1]&&Lr(t).call(t,n[1])?1:0;return e.map((e=>{let{domain_prefix:t,port:i,ip:a}=e;if(t)return{address:"".concat(t,".").concat(n[r++%n.length],":").concat(i)};const o=/^[\.\:\d]+$/.test(a),s=o?"".concat(a.replace(/[^\d]/g,"-"),".").concat(n[r++%n.length],":").concat(i):"".concat(a,":").concat(i);return o||ok.debug("Cannot recognized as ip address: ".concat(a,", use as host3")),{ip:a,port:i,address:s}}))}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&"string"==typeof r){const e=r.split(";");for(let t=0;t<e.length;t++){var i;const r=Db(i=e[t]).call(i);n[t]&&r&&(n[t].ip6=r)}}const a=e.detail&&e.detail.candidate;let o;if(a){const[e,t]=a.split(":");e&&t&&(o={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:n,apGatewayAddress:o,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function aF(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function oF(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(aF(t.width),"x").concat(aF(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function sF(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function cF(e,t){let n,r,i;switch(t){case $j.CHOOSE_SERVER:r=4096,i="choose server";break;case $j.CLOUD_PROXY:r=1048576,i="proxy";break;case $j.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case $j.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new mk(II.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((t=>{t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((e=>tF(tF({},e),{},{ticket:t.buffer.cert}))),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:tF(tF({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!n)throw new mk(II.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function uF(e,t){return await rh.all(e.addresses.map((async e=>({address:nF(e.ip),tcpport:e.port,udpport:e.port,username:t&&IA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():wA.username,password:t&&IA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await WI(t.toString()):wA.password}))))}function lF(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(aF(e.height),aF(e.width)),1):(ok.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function dF(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:a,protocol:o}=e;const s={candidateType:t,relayProtocol:n,protocol:o};if("local-candidate"!==r){const e=i.split(".");e.length>=4&&(e[1]="*",e[2]="*"),s.address=e.join("."),s.port=a}return s}function fF(e){const t=e.split(":"),n=e.split(/[-.]/),r=Lr(e).call(e,"-")?"-":".";let i=e;return t.length>1?n.length>1?(n[1]="**",i=n[0]+r+"**:"+t[t.length-1]):i=t.length>2?t[0]+r+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(i=n[0]+r+"**"),i}function hF(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:IA("SVC_MODE");if(IA("ENABLE_SVC"))return function(e){return e in cA}(e)?e:cA.L1T3}const pF={[mj.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[mj.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function mF(e,t,n){t.forEach((t=>{var r;const i=pF[e].find((e=>{var n;let{key:r}=e;return Lr(n=t.extensionName).call(n,r)}));if(!i)return;const a=n.find((e=>{let{extensionName:t}=e;return Lr(t).call(t,i.key)}));a&&Lr(r=a.extensionName).call(r,"gdpr_forbidden")&&(t.extensionName=a.extensionName)}))}function gF(e,t){t.forEach((t=>{var n;const r=pF[e].find((e=>{var n;let{key:r}=e;return Lr(n=t.extensionName).call(n,r)}));Lr(n=t.extensionName).call(n,"gdpr_forbidden")&&r&&(t.extensionName=r.extensionName)}))}function vF(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e||Lr(e).call(e,"abs-send-time")}function yF(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e||Lr(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function bF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bF(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:a,filterAudioFec:o,filterAudioCodec:s,filterVideoCodec:c,unsupportedVideoUplinkCodec:u,unsupportedVideoDownlinkCodec:l}=t,{useXR:d}=n;let f=[],h=[],p=[],m=[],g=!1,v=!1;if(UA(e).mediaDescriptions.forEach((e=>{r&&r!==e.attributes.direction||("video"!==e.media.mediaType||g||(h=e.attributes.payloads,m=e.attributes.extmaps,g=!0),"audio"!==e.media.mediaType||v||(f=e.attributes.payloads,p=e.attributes.extmaps,v=!0))})),!m||0===h.length)throw new Error("Cannot get video capabilities from SDP.");if(!p||0===f.length)throw new Error("Cannot get audio capabilities from SDP.");if(h.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),d&&e.rtcpFeedbacks.push({type:"rrtr"})})),f.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),d&&e.rtcpFeedbacks.push({type:"rrtr"})})),i&&(f=f.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),h=h.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),a){const e=h.filter((e=>{var t;return/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),t=UF(e,h).map((e=>e.payloadType)),n=[...e.map((e=>e.payloadType)),...t];h=h.filter((e=>!Lr(n).call(n,e.payloadType)))}if(o&&(f=f.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),s&&(null==s?void 0:s.length)>0&&(f=f.filter((e=>{var t;return Lr(s).call(s,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),c&&(null==c?void 0:c.length)>0){const e=h.filter((e=>{var t;return Lr(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}));h=e.concat(i?[]:UF(e,h))}const y=IA("UNSUPPORTED_VIDEO_CODEC");if(y&&y.length>0){const e=h.filter((e=>e.rtpMap&&Lr(y).call(y,e.rtpMap.encodingName.toLowerCase()))),t=UF(e,h),n=e.concat(t).map((e=>e.payloadType));h=h.filter((e=>!Lr(n).call(n,e.payloadType))),ok.debug("unsupportedVideoCodec: ".concat(y,", toBeRemoved: ").concat(n))}if(u&&u.length>0&&"sendonly"===r){const e=h.filter((e=>e.rtpMap&&Lr(u).call(u,e.rtpMap.encodingName.toLowerCase()))),t=UF(e,h),n=e.concat(t).map((e=>e.payloadType));h=h.filter((e=>!Lr(n).call(n,e.payloadType))),ok.debug("unsupportedVideoUplinkCodec: ".concat(u,", toBeRemoved: ").concat(n))}if(l&&l.length>0&&"recvonly"===r){const e=h.filter((e=>e.rtpMap&&Lr(l).call(l,e.rtpMap.encodingName.toLowerCase()))),t=UF(e,h),n=e.concat(t).map((e=>e.payloadType));h=h.filter((e=>!Lr(n).call(n,e.payloadType))),ok.debug("unsupportedVideoDownlinkCodec: ".concat(l,", toBeRemoved: ").concat(n))}return{audioCodecs:f,videoCodecs:h,audioExtensions:p,videoExtensions:m}}function EF(e){const t=UA(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const e=i.attributes.iceUfrag,t=i.attributes.icePwd;if(!e||!t)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:e,icePwd:t}}if(!r){const e=i.attributes.fingerprints;e.length>0&&(r={fingerprints:e})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function SF(e,t){const n=[],r=e.attributes.ssrcGroups.filter((e=>"FID"===e.semantic)),i=e.attributes.ssrcGroups.find((e=>"SIM"===e.semantic)),a=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((e=>{var i;const a=null===(i=r.find((t=>t.ssrcIds[0]===e)))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?a:void 0})}));else if(r.length>0){const e=r[0].ssrcIds[0],i=r[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===a.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function CF(e,t,n){const{cname:r}=e;let i=[];t&&(i=xF(t)),0===i.length&&(i=e.iceParameters.candidates.map((e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}}))),ok.debug("Using candidates from gateway."));const a={fingerprints:e.dtlsParameters.fingerprints.map((e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint})))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let s;switch(e.dtlsParameters.role){case"server":s="passive";break;case"client":s="active";break;case"auto":s="actpass"}const c=PF(e.rtpCapabilities),u=[];return Array.isArray(n)&&n.length>0&&n.forEach((e=>{u.push({kind:mj.VIDEO,ssrcMsg:[{ssrcId:e.v,rtx:e.v_rtx}],mslabel:"".concat(e.v,"_").concat(e.a)},{kind:mj.AUDIO,ssrcMsg:[{ssrcId:e.a}],mslabel:"".concat(e.v,"_").concat(e.a)})})),{dtlsParameters:a,iceParameters:o,candidates:i,rtpCapabilities:c,setup:s,cname:r,preSSRCs:u}}function xF(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],ok.debug("Using remote candidate from AP ".concat(fF(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),ok.debug("Using IPV6 remote candidate from AP ".concat(fF(e.ip6),":").concat(e.port)))),t}function TF(e,t,n){const r=[],i=[];return e.forEach((e=>{let{ssrcId:a,rtx:o}=e;const s=xN(8,"track-"),c={ssrcId:a,attributes:_F({label:s,mslabel:n=n||xN(10,""),msid:"".concat(n," ").concat(s)},t&&{cname:t})};if(r.push(c),void 0!==o){const e={ssrcId:o,attributes:_F({label:s,mslabel:n,msid:"".concat(n," ").concat(s)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[a,o]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((e=>{let{ssrcId:t}=e;return t}))}),{ssrcs:r,ssrcGroups:i}}function RF(e,t){t instanceof BM&&e.attributes.payloads.forEach((e=>{var n;const r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),"opus"===r&&"number"==typeof IA("OPUS_PTIME")?e.fmtp.parameters.ptime=IA("OPUS_PTIME"):e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const i=t._encoderConfig;i&&("pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!nI()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1")),t instanceof VM&&"opus"===r&&t._config.DTX&&(e.fmtp.parameters.usedtx="1"))}))}function IF(e){const t=e.attributes.unrecognized.findIndex((e=>"x-google-flag"===e.attField&&"conference"===e.attValue));-1!==t&&e.attributes.unrecognized.splice(t,1)}function NF(e,t){var n;if(!(t instanceof LL&&t._encoderConfig&&-1===t._hints.indexOf(Fk.SCREEN_TRACK)))return;const r=t._encoderConfig;vk().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((e=>{var t,n;Lr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),vk().supportMinBitrate&&!Lr(n=t._hints).call(n,Fk.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((e=>{var t,n;Lr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(IA("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}function AF(e){if("video"!==e.media.mediaType)return;const t=qR();if(t.name!==WR.SAFARI&&t.os!==zR.IOS)return;const n=e.attributes.extmaps.findIndex((e=>/video-orientation/g.test(e.extensionName)));-1!==n&&e.attributes.extmaps.splice(n,1)}function kF(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){const t=r.find((e=>yF(e.extensionName)));if(t){const n=t.extensionName;e.attributes.extmaps.find((e=>yF(e.extensionName)))||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const r=function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))))))}(i,e.attributes.payloads);r.forEach((e=>{e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))||e.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex((e=>yF(e.extensionName)));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){const t=r.find((e=>vF(e.extensionName)));if(t){const n=t.extensionName;e.attributes.extmaps.find((e=>e.extensionName===n))||e.attributes.extmaps.push({entry:t.entry,extensionName:n});const r=function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))))))}(i,e.attributes.payloads);r.forEach((e=>{e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))||e.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex((e=>vF(e.extensionName)));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"goog-remb"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}function DF(e,t,n){if(nI())return;if("video"!==e.media.mediaType)return;if(!(t instanceof LL))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!IA("SIMULCAST"))return;if("vp9"===n&&IA("ENABLE_SVC"))return;if(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find((e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId)),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let s=1;s<r;s++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+s,attributes:hN(i.attributes)}),o.ssrcIds.push(i.ssrcId+s),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+s,attributes:hN(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+s,a.ssrcIds[1]+s]}));e.attributes.ssrcGroups.unshift(o)}async function MF(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:a,sendrecv:o}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=wF(n,e,t,"sendonly"),i=wF(n,e,t,"recvonly"),a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(OF(r,i,"videoExtensions",a,o,s),OF(r,i,"videoCodecs",a,o,s),OF(r,i,"audioExtensions",a,o,s),OF(r,i,"audioCodecs",a,o,s),IA("RAISE_H264_BASELINE_PRIORITY")){const e=[],t=[];if(s.videoCodecs.forEach(((n,r)=>{var i;if("h264"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLocaleLowerCase())){var a,o;const i=s.videoCodecs[r+1],c=i&&GF(n,i),u=null===(a=n.fmtp)||void 0===a?void 0:a.parameters["profile-level-id"],l=null===(o=n.fmtp)||void 0===o?void 0:o.parameters["packetization-mode"];!u||u!==IA("FIRST_H264_PROFILE_LEVEL_ID")||IA("FIRST_PACKETIZATION_MODE")&&l!==IA("FIRST_PACKETIZATION_MODE")?c?t.push([n,i]):t.push([n]):c?e.push([n,i]):e.push([n])}})),e.length>0&&t.length>0){ok.debug("raising H264 baseline profile priority"),s.videoCodecs.forEach(((n,r)=>{var i;if("h264"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLocaleLowerCase())){const i=GF(n,s.videoCodecs[r+1]),a=e.shift()||t.shift()||[];a.length>0&&(i?s.videoCodecs.splice(r,2,...a):s.videoCodecs.splice(r,1,...a))}}));const n=o.videoCodecs.filter((e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==IA("FIRST_H264_PROFILE_LEVEL_ID")}));if(n.length>0){const e=UF(n,o.videoCodecs).map((e=>e.payloadType)),t=[...n.map((e=>e.payloadType)),...e];o.videoCodecs=o.videoCodecs.filter((e=>!Lr(t).call(t,e.payloadType)))}IA("FILTER_SEND_H264_BASELINE")&&(a.videoCodecs=a.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])!==IA("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:a,recv:o,sendrecv:s}}return{send:a,recv:o,sendrecv:s}}(e,t,r);try{n.close()}catch(e){}return{send:i,recv:a,sendrecv:o}}function LF(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=wF(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(OF(e,t,"videoExtensions",n,r,i),OF(e,t,"videoCodecs",n,r,i),OF(e,t,"audioExtensions",n,r,i),OF(e,t,"audioCodecs",n,r,i),IA("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){const t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){ok.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&(r.videoCodecs=r.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}function OF(e,t,n,r,i,a){if("videoExtensions"===n||"audioExtensions"===n){const o=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return o.push(n),!0}))?a[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===o.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){const o=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return o.push(n),!0}))?a[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===o.indexOf(t)&&i[n].push(e)}))}}function PF(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,a;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...n.audioCodecs,...r.audioCodecs],a.videoCodecs=[...n.videoCodecs,...r.videoCodecs],a.audioExtensions=[...n.audioExtensions,...r.audioExtensions],a.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):a=r,{send:i,recv:a}}function jF(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function FF(e,t,n,r){let i=[];if(e===mj.VIDEO){if(IA("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(i=t.videoCodecs.filter((e=>{var t;return Lr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===IA("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(i)||0===i.length){let e=[];const a=[],o=[],s=[];if(n.videoCodecs.forEach((t=>{const n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";Lr(n).call(n,r)?e.push(t):Lr(n).call(n,"vp9")?a.push(t):Lr(n).call(n,"vp8")?o.push(t):Lr(n).call(n,"h264")&&s.push(t)})),0===e.length){let t="";0!==a.length?(e=a,t="vp9"):0!==o.length?(e=o,t="vp8"):0!==s.length&&(e=s,t="h264"),ok.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(i=t.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(0===i.length&&(ok.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),IA("USE_PUB_RTX")||IA("USE_SUB_RTX")){const e=UF(i,t.videoCodecs);i=[...i,...e]}}else{i=t.audioCodecs.filter((e=>{var t;return Lr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)}));const e=t.audioCodecs.filter((e=>{var t;return Lr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"red")}));0===i.length&&(ok.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter((e=>{var t;return Lr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")}))),IA("ENABLE_AUDIO_RED")&&0!==e.length&&(i=[...e,...i])}return i}function UF(e,t){const n=e.map((e=>e.payloadType.toString()));return t.filter((e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&Lr(n).call(n,e.fmtp&&e.fmtp.parameters.apt)))}async function BF(e,t,n){const r=t.toString(),i=zF(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const a=await e.createAnswer();if(!a.sdp)throw new Error("cannot get answer sdp");let o=a.sdp;o=VF(o,n||{}),null==i||i(o||""),await e.setLocalDescription({type:"answer",sdp:o})}function VF(e,t,n){const r=UA(e),{useXR:i}=t;return r.mediaDescriptions.forEach((e=>{var t;e.attributes.mid&&(Array.isArray(n)&&!Lr(n).call(n,e.attributes.mid)||("audio"===e.media.mediaType&&jF(e),i&&Lr(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach((e=>{-1===e.rtcpFeedbacks.findIndex((e=>"rrtr"===e.type))&&e.rtcpFeedbacks.push({type:"rrtr"})}))))})),BA(r)}function zF(e,t,n,r){if(IA("SDP_LOGGING"))return ok.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{zF(e,"answer","local"===n?"remote":"local",r)}:void 0}function WF(e){const t=IA("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some((t=>Lr(e).call(e,t)))}function GF(e,t){try{var n;return(null===(n=e.fmtp)||void 0===n?void 0:n.parameters.apt)===t.payloadType.toString()}catch(e){return!1}}function HF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function YF(e,t){return typeof IA(e)===t?IA(e):void 0}function qF(){try{const e=IA("EXPERIMENTS")||{};return"string"==typeof e||Array.isArray(e)?{}:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?HF(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HF(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)}catch(e){return ok.debug("handle gateway attributes failed: ",e),{}}}const KF={};function XF(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&ok.debug("install service ".concat(e.name)),KF[e.name]=e}function QF(e){const t=KF[e];if(!t)throw new NI(II.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function JF(e,t){return QF("DataStream").create(e,t)}function ZF(){return QF("InterceptFrame").create()}function $F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function eU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$F(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const tU=new Map;class nU extends GI{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(ij.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(ij.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){ok.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var n,r,i;super(),dx(this,"store",void 0),dx(this,"joinInfo",void 0),dx(this,"key",void 0),dx(this,"ntpOffset",0),dx(this,"signal",void 0),dx(this,"role",void 0),dx(this,"isPreallocation",void 0),dx(this,"isPreSub",void 0),dx(this,"inChannelInfo",{joinAt:null,duration:0}),dx(this,"spec",void 0),dx(this,"_state","DISCONNECTED"),dx(this,"_statsCollector",void 0),dx(this,"_disconnectedReason",void 0),dx(this,"isSignalRecover",!1),dx(this,"hasChangeBGPAddress",!1),dx(this,"trafficStatsInterval",void 0),dx(this,"networkQualityInterval",void 0),dx(this,"_joinGatewayStartTime",0),dx(this,"_signalTimeout",!1),dx(this,"_clientRoleOptions",void 0),dx(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?(n={spec:eU(eU({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},null===(r=(i=QF("P2PChannel")).createSubmodule)||void 0===r?void 0:r.call(i,n)):new Jj(eU(eU({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const r=Date.now();let i=tU.get(e.cname);if(i||(i=new Map,tU.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){const t=new mk(II.UID_CONFLICT);throw pk.joinGateway(e.sid,{lts:r,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let a=0;this.joinGatewayStartTime=r;const o=e.proxyServer;try{ok.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(a));const t=e.gatewayAddrs.map((t=>{let{address:n}=t;const[r,i]=n.split(":"),a={host:r,port:i};return e.proxyServer&&(a.proxy=e.proxyServer),a}));a=(await this.signal.init(t)).uid,ok.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(a," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){var s;throw ok.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),pk.joinGateway(e.sid,{lts:r,succ:!1,ec:(null===(s=t.data)||void 0===s?void 0:s.desc)||t.code,errorMsg:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!o,signalChannel:"0",preload:e.preload}),i.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),ok.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((e=>{ok.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(ij.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ij.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(ij.NETWORK_QUALITY,{uplinkNetworkQuality:sF(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:sF(this._statsCollector.trafficStats.B_dnq)}):this.emit(ij.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),a}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==JI.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==OP.CONNECTED||await function(e,t){return t===1/0?e:rh.race([e,SN(t)])}(this.signal.request(jP.LEAVE,void 0,!0),3e3)}catch(e){ok.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==JI.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new mk(II.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:IA("PUB_EXTEND"),twcc:!!IA("PUBLISH_TWCC"),rtx:!!IA("USE_PUB_RTX")};try{return(await this.signal.request(jP.PUBLISH,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===LP.ERR_PUBLISH_REQUEST_INVALID)return ok.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw r}}async publishDataChannel(e,t,n){var r;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new mk(II.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(r=t.maxRetransmits)&&void 0!==r?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(jP.PUBLISH_DATASTREAM,i,!0)}catch(r){if(n&&r.data&&r.data.code===LP.ERR_PUBLISH_REQUEST_INVALID)return ok.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),r.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw r}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new mk(II.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(jP.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){ok.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new mk(II.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await rh.all(e.map((e=>this.signal.request(jP.UNPUBLISH_DATASTREAM,{channel_id:e},!0))))}catch(e){ok.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new mk(II.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!IA("SUBSCRIBE_TWCC"),rtx:!!IA("USE_SUB_RTX")||void 0,extend:IA("SUB_EXTEND"),svc:Array.isArray(IA("SVC"))&&0!==IA("SVC").length?IA("SVC"):void 0};try{return await this.signal.request(jP.PRE_SUBSCRIBE,r,!0)}catch(r){if(n&&r.data&&r.data.code===LP.ERR_SUBSCRIBE_REQUEST_INVALID)return ok.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),r.toString()),this.presubscribe(e,t,!1);throw r}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new mk(II.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!IA("SUBSCRIBE_TWCC"),rtx:!!IA("USE_SUB_RTX"),extend:IA("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(IA("SVC"))&&0!==IA("SVC").length?IA("SVC"):void 0};try{return(await this.signal.request(jP.SUBSCRIBE,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===LP.ERR_SUBSCRIBE_REQUEST_INVALID)return ok.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw r}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new mk(II.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(jP.SUBSCRIBE_DATASTREAM,r,!0)}catch(r){if(n&&r.data&&r.data.code===LP.ERR_SUBSCRIBE_REQUEST_INVALID)return ok.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),r.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw r}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new mk(II.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!IA("USE_SUB_RTX"),twcc:!!IA("SUBSCRIBE_TWCC"),svc:Array.isArray(IA("SVC"))&&0!==IA("SVC").length?IA("SVC"):void 0};try{return await this.signal.request(jP.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===LP.ERR_SUBSCRIBE_REQUEST_INVALID)return ok.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(jP.SET_VIDEO_PROFILE,t);ok.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(jP.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){ok.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new mk(II.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await rh.all(e.map((e=>this.signal.request(jP.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0))))}catch(e){ok.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(jP.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){ok.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(jP.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(jP.GATEWAY_INFO)}async renewToken(e){await this.signal.request(jP.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),IA("CLIENT_ROLE_OPTIONS")&&(ok.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(IA("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},IA("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),IA("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},IA("CLIENT_ROLE_OPTIONS")),ok.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(IA("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),"CONNECTED"!==this.state)return void(this.role=e);let n,r=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0;const i=Object.assign({},t);delete i.delay,delete i.level,await this.signal.request(jP.SET_CLIENT_ROLE,eU(eU({role:e,level:r,delay:n},i),{},{client_ts:Date.now()})),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(jP.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(jP.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(jP.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(jP.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(jP.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),eU({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(jP.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=tU.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:wA.username,password:wA.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(eU(eU({},wA),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(jP.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach((e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((t=>t.peer_uid===e.peer_uid));t&&t.B_st!==e.B_st&&fN((()=>{this.emit(ij.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var t,n;if(!this.joinInfo||!this.key)throw new mk(II.UNEXPECTED_ERROR,"can not generate join message, no join info");const r=Object.assign({},this.joinInfo.apResponse);let i=IA("REPORT_APP_SCENARIO");if("string"!=typeof i)try{i=JSON.stringify(i)}catch(e){i=void 0}var a;i&&i.length>128&&(i=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ij.UPDATE_GATEWAY_CONFIG),a=this.store.clientId,Lr(GO).call(GO,a)||GO.push(a);const o=_k(this.store),s=!(null===(t=this.isPreallocation)||void 0===t||!t.call(this)),c=wk(this.store),u=qF(),l=iI(87)||eI()||cI(117),d=(function(){const e=qR();if(e.name!==WR.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>18||18===Number(t[0])&&Number(t[1])>=4}()||lI(18,4,!1))&&fI(18,6,!0)&&"h264"===this.spec.codec&&IA("ENABLE_ABSSENDTIME_AS_SENTTS"),f=eU({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:yA,browser:navigator.userAgent,process_id:IA("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:IA("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:eU(eU({enableEncodedTransform:(!!IA("ENABLE_AUDIO_METADATA")||!!IA("ENABLE_AUDIO_PTS"))&&l||!!IA("ENABLE_AUDIO_TOPN")&&oI(WR.CHROME,87,116)||void 0,enableAudioMetadata:!!IA("ENABLE_AUDIO_METADATA")&&l,enableAudioPts:!!IA("ENABLE_AUDIO_PTS")&&l,topnSmoothLevel:IA("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:IA("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:IA("TOPN_SWITCH_HOLD_MS"),topnAudioGain:IA("TOPN_AUDIO_GAIN"),enablePublishedUserList:IA("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:IA("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:YF("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:YF("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:YF("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:!0===IA("USE_PUB_RTX")||!0===IA("USE_SUB_RTX")||void 0,disableFEC:IA("DISABLE_FEC"),enableNTPReport:!!IA("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:c,enableFulllinkAvSync:!!IA("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:YF("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!IA("FORCE_ENABLE_AUT_CC")||!bk()&&(!!IA("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!IA("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:YF("USE_XR","boolean"),enableLossbasedBwe:YF("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!IA("FORCE_ENABLE_AUT_CC")||!bk()&&(!!IA("ENABLE_AUT_CC")||void 0),enableCCFallback:YF("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:s,preSubNum:o?YF("PRE_SUB_NUM","number"):void 0,enablePubTWCC:YF("PUBLISH_TWCC","boolean"),enableSubTWCC:YF("SUBSCRIBE_TWCC","boolean"),enablePubRTX:YF("USE_PUB_RTX","boolean"),enableSubRTX:YF("USE_SUB_RTX","boolean"),enableSubSVC:IA("ENABLE_SVC")?IA("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(IA("SVC"))&&0!==IA("SVC").length?IA("SVC"):void 0,enableSvcExtended:IA("ENABLE_SVC")&&Array.isArray(IA("SVC_EXTENDED"))&&0!==IA("SVC_EXTENDED").length?IA("SVC_EXTENDED"):void 0},u),{},{audioDuplicate:YF("ENABLE_AUDIO_RED","boolean")?null!==(n=YF("AUDIO_DUPLICATE_NUM","number"))&&void 0!==n?n:2:void 0,senttsUsesAbsSendTime:!!d||void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(f.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(f.aes_mode=this.joinInfo.aesmode,IA("ENCRYPT_AES")?(f.aes_secret=this.joinInfo.aespassword,f.aes_encrypt=!0):f.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(f.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(f.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),void 0!==this.joinInfo.defaultVideoStream&&(f.default_video_stream=this.joinInfo.defaultVideoStream),f}getRejoinMessage(){if(!this.joinInfo)throw new mk(II.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(PP.WS_RECONNECT_CREATE_CONNECTION,(e=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(PP.WS_RECONNECTING,(e=>{this.joinInfo&&pk.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||nN.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",pk.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(PP.WS_CLOSED,(e=>{let t;switch(e){case JI.LEAVE:t=nN.LEAVE;break;case JI.UID_BANNED:case JI.IP_BANNED:case JI.CHANNEL_BANNED:case JI.SERVER_ERROR:t=nN.SERVER_ERROR;break;case JI.FALLBACK:t=nN.FALLBACK;break;case JI.LICENSE_MISSING:case JI.LICENSE_EXPIRED:case JI.LICENSE_MINUTES_EXCEEDED:case JI.LICENSE_PERIOD_INVALID:case JI.LICENSE_MULTIPLE_SDK_SERVICE:case JI.LICENSE_ILLEGAL:case JI.TOKEN_EXPIRE:t=e;break;default:t=nN.NETWORK_ERROR}ok.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+nN.NETWORK_ERROR)),this.joinInfo&&pk.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===JI.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==JI.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(PP.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if("audience"===this.role){const e=IA("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(ok.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(pk.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void ok.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));RA("EVENT_REPORT_DOMAIN",e[1]),RA("EVENT_REPORT_BACKUP_DOMAIN",e[1]),RA("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}})),this.signal.on(UP.ON_UPLINK_STATS,(e=>{this._statsCollector.updateUplinkStats(e)})),this.signal.on(PP.REQUEST_RECOVER,((e,t,n)=>{if(!this.joinInfo)return n(new mk(II.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,aN(this,ij.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)})),this.signal.on(PP.REQUEST_JOIN_INFO,(async(e,t,n)=>{var r,i,a;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const o=hN(null===(r=this.joinInfo)||void 0===r?void 0:r.turnServer);if(IA("NEW_TURN_MODE")&&o&&"disabled"===(null===(i=this.joinInfo)||void 0===i?void 0:i.cloudProxyServer)){var s;let e=o.servers.map((e=>"turnServerURL"in e&&IA("USE_TURN_IP")?eU(eU({},e),{},{turnServerURL:rF(e.turnServerURL)}):e)),t=null===(s=o.serversFromGateway)||void 0===s?void 0:s.map((e=>IA("USE_TURN_IP")?eU(eU({},e),{},{turnServerURL:rF(e.turnServerURL)}):e));const n=this.signal.currentURLIndex;e.length>0&&(e=[e[n%e.length]],o.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],o.serversFromGateway=t),ok.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(n))}const{iceParameters:c,dtlsParameters:u,rtpCapabilities:l}=await aN(this,ij.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:o,cloudProxyServer:null===(a=this.joinInfo)||void 0===a?void 0:a.cloudProxyServer});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:u,rtpCapabilities:l,version:"2"}}))}catch(e){t(e)}})),this.signal.on(PP.REQUEST_REJOIN_INFO,(e=>{e(this.getRejoinMessage())})),this.signal.on(PP.REPORT_JOIN_GATEWAY,((e,t)=>{if(!this.joinInfo)return;let n,r="";var i;e instanceof mk?(n=(null===(i=e.data)||void 0===i?void 0:i.desc)||e.code,r=e.message):n=e,pk.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:r,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(PP.IS_P2P_DISCONNECTED,(e=>{e(cN(this,ij.IS_P2P_DISCONNECTED))})),this.signal.on(PP.DISCONNECT_P2P,(()=>{this.emit(ij.DISCONNECT_P2P)})),this.signal.on(PP.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(PP.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(PP.JOIN_RESPONSE,(e=>{const t=this.getCurrentGatewayAddress();this.emit(ij.JOIN_RESPONSE,e,t)})),this.signal.on(PP.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){var e,t;this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),i=hN(null===(e=this.joinInfo)||void 0===e?void 0:e.turnServer);if(IA("NEW_TURN_MODE")&&i&&"disabled"===(null===(t=this.joinInfo)||void 0===t?void 0:t.cloudProxyServer)){var n;let e=i.servers.map((e=>"turnServerURL"in e&&IA("USE_TURN_IP")?eU(eU({},e),{},{turnServerURL:rF(e.turnServerURL)}):e)),t=null===(n=i.serversFromGateway)||void 0===n?void 0:n.map((e=>IA("USE_TURN_IP")?eU(eU({},e),{},{turnServerURL:rF(e.turnServerURL)}):e));const r=this.signal.currentURLIndex;e.length>0&&(e=[e[r%e.length]],i.servers=e),Array.isArray(t)&&t.length>0&&(t=[t[0]],i.serversFromGateway=t),ok.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(r,",in pre pc"))}const a=IA("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&a){const e=xF(r);this.emit(ij.PRE_CONNECT_PC,{candidates:e,fingerprint:a,turnServer:i})}}})),this.signal.on(PP.RECOVER_NOTIFICATION,(e=>{this.joinInfo&&"string"==typeof IA("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(IA("AP_REQUEST_DETAIL"),";").concat(e))}))}async tryUnsubBeforeResub(e,t){try{await this.signal.request(jP.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw ok.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(jP.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw ok.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(jP.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw ok.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(jP.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw ok.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map((e=>({stream_id:e.stream_id,stream_type:e.stream_type})))};try{await this.signal.request(jP.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw ok.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find((e=>e.stream_type===rj.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(jP.CONTROL,n,!0,!0)}catch(e){throw ok.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find((e=>e.stream_type===rj.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(jP.CONTROL,n,!0,!0)}catch(e){throw ok.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){const n={action:e===mj.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(jP.CONTROL,n,!0,!0)}catch(e){throw ok.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){const n={action:e===mj.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(jP.CONTROL,n,!0,!0)}catch(e){throw ok.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(jP.RESTART_ICE,t,!0)}catch(e){throw ok.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(e,t){"CONNECTED"===this.state&&this.signal.reconnect(e||void 0,t||nN.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!IA("GATEWAY_WSS_ADDRESS"))return IA("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(ok.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(jP.SET_PARAMETER,{enablePublishAudioFilter:e})}downgradeCodec(e){this.signal.downgradeCodec(e)}}let rU=0,iU=0;function aU(e,t,n,r){return new rh(((i,a)=>{t.timeout=t.timeout||IA("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),rU+=wN(t.data)):n&&(t.data.size?rU+=t.data.size:t.data instanceof FormData?rU+=EN(t.data):rU+=wN(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,PR.request(t).then((e=>{"string"==typeof e.data?iU+=wN(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?iU+=e.data.byteLength:iU+=wN(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{PR.isCancel(e)?a(new mk(II.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?a(new mk(II.NETWORK_TIMEOUT,e.message)):e.response?a(new mk(II.NETWORK_RESPONSE_ERROR,e.response.status)):a(new mk(II.NETWORK_ERROR,e.message))}))}))}!function(){var e;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},a=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var n=0;n<e.length;++n){var r=e[n];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function o(e,t){if(t)e:{var n=a;e=e.split(".");for(var r=0;r<e.length-1;r++){var o=e[r];if(!(o in n))break e;n=n[o]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function s(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(o("Symbol",(function(e){function t(e,t){this.A=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(i||"")+"_"+r++,i)}})),o("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var o=a[t[r]];"function"==typeof o&&"function"!=typeof o.prototype[e]&&i(o.prototype,e,{configurable:!0,writable:!0,value:function(){return s(n(this))}})}return e})),"function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var u;e:{var l={};try{l.__proto__={a:!0},u=l.a;break e}catch(e){}u=!1}r=u?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var d=r;function f(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function p(e,t){return e.h=3,{value:t}}function m(e){this.g=new f,this.G=e}function g(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var a=i.value}catch(t){return e.g.j=null,e.g.s(t),v(e)}return e.g.j=null,r.call(e.g,a),v(e)}function v(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function y(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){h(e.g);var n=e.g.j;return n?g(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),v(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function b(e,t){return t=new y(new m(t)),d&&e.prototype&&d(t,e.prototype),t}if(f.prototype.o=function(e){this.v=e},f.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},f.prototype.return=function(e){this.l={return:e},this.h=this.u},m.prototype.o=function(e){return h(this.g),this.g.j?g(this,this.g.j.next,e,this.g.o):(this.g.o(e),v(this))},m.prototype.s=function(e){return h(this.g),this.g.j?g(this,this.g.j.throw,e,this.g.o):(this.g.s(e),v(this))},o("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var _=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},w=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},E=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},S=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},C="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,x=C.FormData,T=C.XMLHttpRequest&&C.XMLHttpRequest.prototype.send,R=C.Request&&C.fetch,I=C.navigator&&C.navigator.sendBeacon,N=C.Element&&C.Element.prototype,A=C.Symbol&&Symbol.toStringTag;A&&(Blob.prototype[A]||(Blob.prototype[A]="Blob"),"File"in C&&!File.prototype[A]&&(File.prototype[A]="File"));try{new File([],"")}catch(e){C.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),A&&Object.defineProperty(e,A,{value:"File"}),e}}var k=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},D=function(e){this.i=[];var t=this;e&&_(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];_(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?_(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?w(e.value):e.value,t.append(e.name,n))}))};if((e=D.prototype).append=function(e,t,n){S(arguments,2),this.i.push(E(e,t,n))},e.delete=function(e){S(arguments,1);var t=[];e=String(e),_(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return b(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=p(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){S(arguments,1);for(var n=c(this),r=n.next();!r.done;r=n.next()){var i=c(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){S(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){S(arguments,1);var t=[];return e=String(e),_(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){S(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return b(e,(function(e){if(1==e.h&&(t=c(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,p(e,c(r).next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){S(arguments,2),e=String(e);var r=[],i=E(e,t,n),a=!0;_(this.i,(function(t){t[0]===e?a&&(a=!r.push(i)):r.push(t)})),a&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,a=this;return b(e,(function(e){if(1==e.h&&(t=c(a),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=c(r)).next(),p(e,i.next().value));n=t.next(),e.h=2}))},D.prototype._asNative=function(){for(var e=new x,t=c(this),n=t.next();!n.done;n=t.next()){var r=c(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},D.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+k(w(r))+'"\r\n\r\n'+w(e)+"\r\n"):t.push(n+k(w(r))+'"; filename="'+k(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},D.prototype[Symbol.iterator]=function(){return this.entries()},D.prototype.toString=function(){return"[object FormData]"},N&&!N.matches&&(N.matches=N.matchesSelector||N.mozMatchesSelector||N.msMatchesSelector||N.oMatchesSelector||N.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),A&&(D.prototype[A]="FormData"),T){var M=C.XMLHttpRequest.prototype.setRequestHeader;C.XMLHttpRequest.prototype.setRequestHeader=function(e,t){M.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},C.XMLHttpRequest.prototype.send=function(e){e instanceof D?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),T.call(this,e)):T.call(this,e)}}R&&(C.fetch=function(e,t){return t&&t.body&&t.body instanceof D&&(t.body=t.body._blob()),R.call(this,e,t)}),I&&(C.navigator.sendBeacon=function(e,t){return t instanceof D&&(t=t._asNative()),I.call(this,e,t)}),C.FormData=D}}();const oU=()=>{const e=IA("AREAS");return 0===e.length&&e.push(sj.GLOBAL),ii(e).call(e,((e,t,n)=>{const r=sU(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},sU=e=>e===sj.OVERSEA?"".concat(uj.ASIA,",").concat(uj.EUROPE,",").concat(uj.AFRICA,",").concat(uj.NORTH_AMERICA,",").concat(uj.SOUTH_AMERICA,",").concat(uj.OCEANIA):uj[e],cU=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((e=>{const n=lj[e],r=Object.keys(n);r&&r.map((e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},uU={GLOBAL:{ASIA:[sj.CHINA,sj.JAPAN,sj.INDIA,sj.KOREA,sj.HKMC],EUROPE:[],NORTH_AMERICA:[sj.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},lU=Object.keys(uU[sj.GLOBAL]),dU=[sj.CHINA,sj.NORTH_AMERICA,sj.EUROPE,sj.ASIA,sj.JAPAN,sj.INDIA,sj.OCEANIA,sj.SOUTH_AMERICA,sj.AFRICA,sj.KOREA,sj.HKMC,sj.US],fU=function(e,t){let n=[];if(Lr(e).call(e,sj.GLOBAL)){const a=[sj.GLOBAL,sj.OVERSEA],o=Object.keys(lj);if(t===sj.GLOBAL)throw new mk(II.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===sj.CHINA)n=[sj.OVERSEA];else if(i=t,Lr(lU).call(lU,i)){const e=(r=t,uU[sj.GLOBAL][r]||[]),i=[...a,t,...e];n=o.filter((e=>!Lr(i).call(i,e)))}else if(function(e){let t=!1;return lU.forEach((n=>{var r;Lr(r=uU[sj.GLOBAL][n]).call(r,e)&&(t=!0)})),t}(t)){const e=function(e){let t;return lU.forEach((n=>{var r;Lr(r=uU[sj.GLOBAL][n]).call(r,e)&&(t=n)})),t}(t),r=[...a,e,t];n=o.filter((e=>!Lr(r).call(r,e)))}else n=e;n=function(e){const t=[];return dU.forEach((n=>{Lr(e).call(e,n)&&t.push(n)})),t.concat(e.filter((e=>!Lr(dU).call(dU,e))))}(n)}else n=e;var r,i;return n};function hU(e){var t,n;if(!e&&Lr(t=IA("AREAS")).call(t,sj.EXTENSIONS))return ok.debug("update area from ap : reset"),void pU(VO,!0);if(!Lr(n=IA("AREAS")).call(n,sj.GLOBAL)||!e)return;let r=lj.EXTENSIONS;r&&(r={CODE:sU(sj.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},ok.debug("update area from ap success: ".concat(e,",config is "),r),RA("AREAS",[sj.EXTENSIONS],!0),Object.keys(r).map((e=>{RA(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])})))}function pU(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=pk.reportApiInvoke(null,{name:qI.SET_AREA,options:e,tag:KI.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((e=>{if(!Lr(cj).call(cj,e))throw new mk(II.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new mk(II.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?fU(i,n):i}if(!t){if(AA.AREAS){const e=new mk(II.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void ok.warning("setArea is prohibited because of config-distribute")}if(Lr(r).call(r,sj.GLOBAL)&&IA("AREAS")===sj.EXTENSIONS){const e=new mk(II.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void ok.warning("setArea is prohibited because of ap extensions")}}RA("AREAS",r,t);const i=cU(r);Object.keys(i).map((e=>{RA(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])})),ok.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function mU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mU(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let vU=1;function yU(e,t,n,r,i){vU+=1;const a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:vU,requestId:vU,version:yA,cname:n.cname},o={service_name:t,json_body:JSON.stringify(a)};let s,c,u=e[0];return zN((async()=>{s=Date.now();const e=await aU(u,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-s,0!==e.code){const t=new mk(II.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw ok.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new mk(II.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw ok.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new mk(II.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw ok.error(e.toString()),e}const i=function(e,t){return{addressList:e.servers.map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(IA("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t)))),workerToken:e.workerToken,vid:e.vid}}(n,t);return IA("LIVE_STREAMING_ADDRESS")&&(i.addressList=IA("LIVE_STREAMING_ADDRESS")instanceof Array?IA("LIVE_STREAMING_ADDRESS"):[IA("LIVE_STREAMING_ADDRESS")]),gU(gU({},i),{},{responseTime:c})}),((r,i)=>(pk.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:c,serverIp:e[i%e.length]}),!1)),((r,i)=>(pk.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:c,serverIp:e[i%e.length]}),!!(r.code!==II.OPERATION_ABORTED&&r.code!==II.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(u=e[(i+1)%e.length],!0))),i)}let bU=1;function _U(e,t,n,r){let{url:i,areaCode:a}=e;const{clientId:o,sid:s}=t,c=Date.now();let u;const l=t.role,[d,f]=xU(t,a,[$j.CHOOSE_SERVER]);let h=uN.networkState;return zN((async()=>{h&&uN.networkState===rN.OFFLINE&&uN.onlineWaiter&&await rh.race([uN.onlineWaiter,CN(r&&r.maxRetryTimeout||BN.maxRetryTimeout)]),h=uN.networkState;const{data:e,headers:a}=await aU(i,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u="1"===a.http3?1:-1,pk.reportResourceTiming(i,s),EU(e,i,t,c,[$j.CHOOSE_SERVER],u);const o=cF(e,$j.CHOOSE_SERVER);return SU(o),iF(o,i)}),(e=>(e&&pk.joinChooseServer(s,{role:l,lts:c,succ:!0,csAddr:i,opid:f,serverList:e.gatewayAddrs.map((e=>e.address)),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[$j.CHOOSE_SERVER].toString(),isHttp3:u,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1)),(e=>e.code!==II.OPERATION_ABORTED&&(e.code===II.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(pk.joinChooseServer(s,{role:l,lts:c,succ:!1,csAddr:i,serverList:null,opid:f,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[$j.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:u,corssRegionTagReq:t.apRequestDetail}),ok.warning("[".concat(o||"sid-".concat(s.slice(0,6)),"] Choose server network error, retry"),e),!0))),r)}function wU(e,t,n,r){let i,{url:a,areaCode:o,serviceIds:s}=e;const c=Date.now(),u=t.role,[l,d]=xU(t,o,s);let f;return zN((async()=>{f&&uN.networkState===rN.OFFLINE&&uN.onlineWaiter&&await rh.race([uN.onlineWaiter,CN(r&&r.maxRetryTimeout||BN.maxRetryTimeout)]),f=uN.networkState;const{data:e,headers:o}=await aU(a,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===o.http3?1:-1,pk.reportResourceTiming(a,t.sid),EU(e,a,t,c,s,i);const u=cF(e,$j.CHOOSE_SERVER),d=cF(e,"proxy5"===t.cloudProxyServer?$j.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?$j.CLOUD_PROXY:$j.CLOUD_PROXY_FALLBACK),h=performance.getEntriesByName(a),p=h[h.length-1];let m;return p&&(m={name:p.name,protocol:"nextHopProtocol"in p?p.nextHopProtocol:"",dnscost:"domainLookupEnd"in p&&"domainLookupStart"in p&&"number"==typeof p.domainLookupEnd&&"number"==typeof p.domainLookupStart?p.domainLookupEnd-p.domainLookupStart:-1,tcpTlsCost:"connectEnd"in p&&"connectStart"in p&&"number"==typeof p.connectEnd&&"number"==typeof p.connectStart?p.connectEnd-p.connectStart:-1,reqCost:"requestStart"in p&&"number"==typeof p.requestStart&&"responseEnd"in p&&"number"==typeof p.responseEnd?p.responseEnd-p.requestStart:-1,handleCost:"leave_ts"in e&&"enter_ts"in e&&"number"==typeof e.leave_ts&&"number"==typeof e.enter_ts?e.leave_ts-e.enter_ts:-1}),SU(u),{gatewayInfo:iF(u,a),proxyInfo:d,url:a,resourceTimingInfo:m}}),(e=>(e.gatewayInfo&&pk.joinChooseServer(t.sid,{role:u,lts:c,succ:!0,csAddr:a,serverList:e.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,opid:d,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:s.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38],resourceTimingInfo:e.resourceTimingInfo?JSON.stringify(e.resourceTimingInfo):void 0}),e.proxyInfo&&pk.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:a,turnServerAddrList:e.proxyInfo.addresses.map((e=>e.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:s.toString()}),!1)),(e=>e.code!==II.OPERATION_ABORTED&&(e.code===II.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(pk.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:s.toString(),extend:JSON.stringify({networkState:f})}),ok.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))),r)}const EU=(e,t,n,r,i,a)=>{const{sid:o,clientId:s,cloudProxyServer:c}=n,u=[],l=s=>{4096===s.flag?pk.joinChooseServer(o,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:s.error.message,csIp:s.error.data&&s.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:a,corssRegionTagReq:n.apRequestDetail}):1048576!==s.flag&&4194304!==s.flag&&4194310!==s.flag||pk.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:s.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach((t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)ok.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new mk(II.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};u.push(n),l(n)}if(0!==n){const r=Oj(n),i={error:new mk(II.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?ok.warning(i.error.toString()):u.push(i),l(i)}})),u.length)throw ok.warning("[".concat(s||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(u.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry))).join(" | "))),new mk(II.CAN_NOT_GET_GATEWAY_SERVER,u.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!u.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(u.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})},SU=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new mk(II.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(IA("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?hU(e.detail[23].toLowerCase()):hU()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let r=0;r<n.length;r++){var a;const t=Db(a=n[r]).call(a);e.addresses[r]&&n&&(e.addresses[r].fingerprint=t)}}if(IA("GATEWAY_ADDRESS")&&IA("GATEWAY_ADDRESS").length>0){ok.debug("assign gateway address to",IA("GATEWAY_ADDRESS"));const t=IA("GATEWAY_ADDRESS").map((t=>{var n,r;const i=null!==(n=null===(r=e.addresses.find((e=>e.ip===t.ip&&e.port===t.port)))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=t}},CU=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=Oj(t.buffer.code);throw new mk(II.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw ok.debug("update ticket request received ap response without response body:",t),new mk(II.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},xU=(e,t,n)=>{const r=Math.floor(Math.random()*10**12),i="host"===e.role?"1":"audience"===e.role?"2":void 0,a={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:gU(gU(gU({6:e.stringUid,11:t,12:IA("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};a.request_bodies.forEach((t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const o=new FormData;return o.append("request",JSON.stringify(a)),[o,r]},TU=(e,t)=>{const n=Math.floor(Math.random()*10**12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((e=>({ip:e.ip,port:e.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let RU=0;function IU(e){return rh.all(e.map((e=>e.then((e=>{throw e}),(e=>e))))).then((e=>{throw e}),(e=>e))}const NU=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:a}=e,o=0;const s=t;let c,u=0;const l=async()=>{const e=(()=>{const e=o*s,t=e+s;return n.slice(e,t).map(r)})();a&&a.push(...e);try{c=await IU(e)}catch(e){if(u+=s,o++,!(u>=n.length))return void await l();i(e)}e.forEach((e=>e.cancel()))};return await l(),c},AU=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let a=0;const o=async()=>{const e=n(t.shift());try{return await e}catch(e){if(a++,a>=i||null!=r&&r(e))throw e;return o()}};return o()};async function kU(){if("undefined"==typeof VideoDecoder)return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],a=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],o=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128],s=await new rh(((s,c)=>{let u;!async function(){e&&"closed"!==e.state||await async function(){e=new VideoDecoder({output:e=>{e.close(),clearTimeout(u),s(!0)},error:e=>{clearTimeout(u),s(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const c=[t,n,r,i,a,o];for(let t=0;t<c.length;t++){const n=new EncodedVideoChunk({type:0==t?"key":"delta",timestamp:33333*t,duration:33333,data:new Uint8Array(c[t])});try{await e.decode(n)}catch(e){return void s(!1)}}}(),u=setTimeout((()=>{s(!1)}),5e3)}));return s}async function DU(e,t,n,r){const i=async function(e,t,n,r){let i=null;const a=[],o=async()=>{const i=IA("WEBCS_DOMAIN").slice(0,IA("AJAX_REQUEST_CONCURRENT")).map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:oU()}))),o=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),s=await NU({fragementLength:IA("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(ok.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),_U(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},o),s},s=async()=>{if(await CN(1e3),null!==i)return i;const o=IA("WEBCS_DOMAIN_BACKUP_LIST").map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:oU()}))),s=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:o.map((e=>e.url))}),c=await NU({fragementLength:IA("FRAGEMENT_LENGTH"),referenceList:o,asyncMapHandler:r=>(ok.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),_U(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c};try{return i=await IU([o(),s()]),a.length&&a.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),i}catch(e){throw e[0]}}(e,t,n,r);return{gatewayInfo:await i}}async function MU(e,t,n,r,i){const a=e.cloudProxyServer;if("disabled"===a){if(!r)return;if(e.useLocalAccessPoint)return await DU(e,t,n,i);if(IA("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:r,proxyInfo:a}=await FU(e,t,n,i);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:r};const s=a.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||wA.tcpport,udpport:e.udpport||wA.udpport,username:e.username||wA.username,password:e.password||wA.password,forceturn:!1,security:!0})));if(i.useP2P){var o;const t=null!==(o=e.uid)&&void 0!==o?o:r.uid,n="glb:".concat(t.toString()),i=await WI(n),c=a.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||wA.tcpport,udpport:e.udpport||wA.udpport,username:n,password:i,forceturn:!1,security:!0})));s.push(...c)}return e.turnServer={mode:"manual",servers:s},{gatewayInfo:r}}return await DU(e,t,n,i)}const{proxyInfo:s,gatewayInfo:c}=await FU(e,t,n,i),u={gatewayInfo:c},l=s.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===a?void 0:e.tcpport?e.tcpport:wA.tcpport,udpport:"proxy4"===a?void 0:e.udpport?e.udpport:wA.udpport,username:e.username||wA.username,password:e.password||wA.password,forceturn:"proxy4"!==a,security:"proxy5"===a})));if(i.useP2P){var d;const t=null!==(d=e.uid)&&void 0!==d?d:c.uid,n="glb:".concat(t.toString()),r=await WI(n),i=s.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===a?void 0:e.tcpport||wA.tcpport,udpport:"proxy4"===a?void 0:e.udpport||wA.udpport,username:n,password:r,forceturn:"proxy4"!==a,security:"proxy5"===a})));l.push(...i)}return e.turnServer={mode:"manual",servers:l},ok.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(a)),u}async function LU(e,t,n,r,i){const a=IA("ACCOUNT_REGISTER").slice(0,IA("AJAX_REQUEST_CONCURRENT"));let o=[];o=t.proxyServer?a.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):a.map((e=>"https://".concat(e,"/api/v1")));const s=null==i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const a=await async function(e,t,n,r,i){const a=Date.now(),o={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let s=e[0];const c=await zN((()=>aU(s+"".concat(-1===s.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw ok.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),pk.reqUserAccount(o.sid,{lts:a,success:!1,serverAddr:s,stringUid:o.string_uid,uid:n.uid,errorCode:II.INVALID_UINT_UID_FROM_STRING_UID,extend:o}),new mk(II.INVALID_UINT_UID_FROM_STRING_UID);return pk.reqUserAccount(o.sid,{lts:a,success:!0,serverAddr:s,stringUid:o.string_uid,uid:n.uid,errorCode:null,extend:o}),!1}const i=Oj(n.code);return i.retry&&(s=e[(r+1)%e.length]),pk.reqUserAccount(o.sid,{lts:a,success:!1,serverAddr:s,stringUid:o.string_uid,uid:n.uid,errorCode:i.desc,extend:o}),i.retry}),((t,n)=>t.code!==II.OPERATION_ABORTED&&(pk.reqUserAccount(o.sid,{lts:a,success:!1,serverAddr:s,stringUid:o.string_uid,uid:null,errorCode:t.code,extend:o}),s=e[(n+1)%e.length],!0)),i);if(0!==c.code){const e=Oj(c.code);throw new mk(II.UNEXPECTED_RESPONSE,e.desc)}return c}(o,e,t,n,r);return null==i||i.recordJoinChannelService({status:"success",endTs:Date.now()},s),a.uid}catch(e){throw null==i||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},s),e}}async function OU(e,t,n){const r=IA("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):r.map((e=>"https://".concat(e,"/api/v1")));try{const r=await AU({referenceList:i,asyncMapHandler:r=>async function(e,t,n,r){const i=Date.now(),a={sid:n.sid,opid:10,appid:n.appId,string_uid:t};try{const t=await aU(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){const e=Oj(t.code);throw new mk(II.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new mk(II.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:i,url:e,req:a,uid:t.uid,elapse:Date.now()-i}}catch(e){throw e}}(r,e,t,n),closeFn:e=>e.code===II.OPERATION_ABORTED||e.code===II.UNEXPECTED_RESPONSE&&!e.data.retry});return r}catch(e){throw e}}async function PU(e,t,n){const r=IA("CDS_AP").slice(0,IA("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config"))),i=r.map((r=>function(e,t,n,r){const i=qR(),a={flag:64,cipher_method:0,features:gU(gU(gU(gU(gU({install_id:vA(),device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:yA,cname:t.cname,session_id:t.sid,proxyServer:t.proxyServer,sdk_type:Zj.WEB_RTC,browser_name:i.name,browser_version:i.version,user_agent:navigator.userAgent,channel_name:t.cname},t.stringUid&&{string_uid:t.stringUid}),t.uid&&{uid:t.uid+""}),i.os&&{os_name:i.os}),i.osVersion&&{os_version:i.osVersion}),{},{detail:""})};return zN((()=>aU(e,{data:a,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(e=>e.code!==II.OPERATION_ABORTED),r)}(r,e,t,n)));let a=null,o=null,s={};try{a=await IU(i)}catch(e){if(e.code===II.OPERATION_ABORTED)throw e;o=e}if(i.forEach((e=>e.cancel())),pk.reportApiInvoke(e.sid,{name:qI.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:a}}).onSuccess(),a&&a.test_tags)try{s=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),r={};return n.forEach((e=>{var n;const i=Db(n=e.slice(4)).call(n),a=JSON.parse(t[e]),o=a[1];r[i]={tag:a[0]||"",value:o}})),r}(a)}catch(e){}return s}async function jU(e,t){const n=IA("WEBCS_DOMAIN").concat(IA("WEBCS_DOMAIN_BACKUP_LIST")).map((e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:oU(),serviceIds:[$j.CHOOSE_SERVER,$j.CLOUD_PROXY_FALLBACK]})));try{const r=await AU({referenceList:n,asyncMapHandler:n=>async function(e,t,n){let r,{url:i,areaCode:a,serviceIds:o}=e;const s=Date.now(),[c,u]=xU(t,a,o);let l=uN.networkState;try{l&&uN.networkState===rN.OFFLINE&&uN.onlineWaiter&&await rh.race([uN.onlineWaiter,CN(BN.maxRetryTimeout)]),l=uN.networkState;const{data:e,headers:t}=await aU(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===t.http3?1:-1;const a=e=>{const t=[];if(e.response_body.forEach((n=>{const r=n.buffer.code;if(23===n.uri&&0===r&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{const r={error:new mk(II.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(r)}if(0!==r){const i=Oj(r),a={error:new mk(II.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?ok.warning(a.error.toString()):t.push(a)}})),t.length)throw new mk(II.CAN_NOT_GET_GATEWAY_SERVER,t.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!t.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(t.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})};a(e);const o=cF(e,$j.CHOOSE_SERVER),d=cF(e,$j.CLOUD_PROXY_FALLBACK);return SU(o),{gatewayInfo:iF(o,i),proxyInfo:d,opid:u,requestTime:s,url:i,isHttp3:r,elapse:Date.now()-s}}catch(e){throw e}}(n,e,t),closeFn:e=>e.code===II.OPERATION_ABORTED||e.code===II.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry});return r}catch(e){throw e}}async function FU(e,t,n,r){const i=IA("PROXY_SERVER_TYPE3"),a=(e,t,n)=>{let r=n||i;return Array.isArray(r)&&(r=t%2==0&&i[1]||i[0]),"https://".concat(r,"/ap/?url=").concat(e)};let o=null;const s=[],c=async()=>{const i=IA("WEBCS_DOMAIN").slice(0,IA("AJAX_REQUEST_CONCURRENT")).map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?a("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):a("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:oU(),serviceIds:[$j.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?$j.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?$j.CLOUD_PROXY:$j.CLOUD_PROXY_FALLBACK]}})),o=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),c=await NU({fragementLength:IA("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(ok.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),wU(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:s});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},o),c},u=async()=>{if(await CN(1e3),null!==o)return o;const i=IA("WEBCS_DOMAIN_BACKUP_LIST").map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?a("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):a("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:oU(),serviceIds:[$j.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?$j.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?$j.CLOUD_PROXY:$j.CLOUD_PROXY_FALLBACK]}})),c=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),u=await NU({fragementLength:IA("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(ok.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),wU(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:s});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},c),u};let l,d,f;try{({gatewayInfo:l,proxyInfo:d,url:f}=await IU([c(),u()]))}catch(e){throw e[0]}if(s.length&&s.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),!l||!d)throw new mk(II.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=f,"disabled"!==e.cloudProxyServer&&Array.isArray(i)&&f){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(f)[1];Lr(i).call(i,t)&&(e.proxyServer=t,ok.setProxyServer(t),pk.setProxyServer(t))}return o={gatewayInfo:l,proxyInfo:await uF(d,l.uid)},o}async function UU(e,t,n){const r=IA("UAP_AP").slice(0,IA("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap"))),i=r.map((r=>function(e,t,n,r){const i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:yA,cname:t.cname,uid:t.uid.toString(),requestId:bU,seq:bU};bU+=1;const a={service_name:"tele_channel",json_body:JSON.stringify(i)};return zN((async()=>{const t=await aU(e,{data:a,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new mk(II.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw ok.error(e.toString()),e}const r=JSON.parse(t.json_body);if(200!==r.code){const e=new mk(II.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw ok.error(e.toString()),e}if(!r.servers||0===r.servers.length){const e=new mk(II.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw ok.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:(IA("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(IA("WORKER_DOMAIN"),":").concat(e.wss)))}}),void 0,(e=>!!(e.code!==II.OPERATION_ABORTED&&e.code!==II.UNEXPECTED_RESPONSE||e.data&&e.data.retry)),r)}(r,e,t,n)));try{const e=await IU(i);return i.forEach((e=>e.cancel())),e}catch(e){throw e[0]}}async function BU(e,t,n){let r=null;const i=[],a=async a=>{const o=IA(a?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2")));return a&&(await CN(1e3),null!==r)?r:await NU({fragementLength:IA("FRAGEMENT_LENGTH"),referenceList:o,asyncMapHandler:r=>(ok.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(a?"backup":""," choose_server:"),r),function(e,t,n,r){const[i]=TU(t,[$j.CHOOSE_SERVER]);let a=uN.networkState;return zN((async()=>{a&&uN.networkState===rN.OFFLINE&&uN.onlineWaiter&&await rh.race([uN.onlineWaiter,CN(r&&r.maxRetryTimeout||BN.maxRetryTimeout)]),a=uN.networkState;const t=await aU(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return CU(t,e)}),(()=>!1),(e=>e.code!==II.OPERATION_ABORTED&&(e.code===II.UPDATE_TICKET_FAILED?e.data.retry:(ok.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await IU([a(!1),a(!0)]),i.length&&i.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),r}catch(e){throw e[0]}}function VU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VU(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class WU extends GI{get isSuccess(){return!!this.configs}constructor(e,t){super(),dx(this,"configs",void 0),dx(this,"store",void 0),dx(this,"joinInfo",void 0),dx(this,"cancelToken",void 0),dx(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),dx(this,"interval",void 0),dx(this,"mutex",void 0),dx(this,"mutableParamsRead",!1),dx(this,"configCache",{}),dx(this,"limit_bitrate",void 0),this.mutex=new FN("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),IA("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),IA("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,pk.reportApiInvoke(null,{options:void 0,name:qI.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:KI.TRACER}).onSuccess(JSON.stringify(AA))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void ok.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await PU(this.joinInfo,this.cancelToken,this.retryConfig),ok.debug("[config-distribute] get config distribute",JSON.stringify(e));const t=function(e){var t;const n=Qh(t=Object.keys(e).filter((e=>/^webrtc_ng_global_parameter/.test(e)))).call(t);for(let a=0;a<n.length;a++)for(let t=n.length-1;t>a;t--){const r=n[t],i=e[r].value;if("number"==typeof i.__priority){const a=i.__priority,o=n[t-1],s=e[o].value;if("number"==typeof s.__priority){if(!(a>s.__priority))continue;{const e=r;n[t]=n[t-1],n[t-1]=e}}else{const e=r;n[t]=n[t-1],n[t-1]=e}}}const r=Date.now();let i={};return n.forEach((t=>{const n=e[t].value.__expires;n&&n<=r||(i[t]=e[t])})),i}(e);this.cacheGlobalParameterConfig(t),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=t}catch(e){const t=new mk(II.NETWORK_RESPONSE_ERROR,e);ok.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){fj(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(dj.UPDATE_BITRATE_LIMIT,e):this.emit(dj.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&zU({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const t={},n=Object.keys(e),r=[];n.forEach((n=>{const i=e[n].value;t[n]=i;const a=i.__id;if(a&&this.configCache[n]&&this.configCache[n].__id===a)return;const o=i.__type,s=e[n].value,c=e[n].tag;let u=0;o?o===NA.REALTIME&&(u=1):Object.keys(s).some((e=>Object.prototype.hasOwnProperty.call(xA,e)||!YO()&&Object.prototype.hasOwnProperty.call(EA,e)?(u=1,!0):void 0)),r.push({tag:c,isApplied:u,feature:n,params:JSON.stringify(i)})})),r.forEach((e=>{let{tag:t,feature:n,params:r,isApplied:i}=e;this.store.sessionId&&pk.abTest(this.store.sessionId,{intSucc:1,isApplied:i,tag:t,feature:n,params:r,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=t}catch(e){ok.debug("handleABTestConfigDistribute error",e)}}cacheGlobalParameterConfig(e){const t=function(e){const t={};return Object.keys(e).forEach((n=>{const r=e[n].value,i=r.__expires,a=r.__type;Object.keys(r).forEach((e=>{"__id"===e||"__type"===e||"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(t,e)||(t[e]=zU(zU({value:r[e]},i&&{expires:i}),a&&{type:a}))}))})),t}(e);try{var n;const r=null===(n=t.LIMIT_BITRATE)||void 0===n?void 0:n.value;delete t.LIMIT_BITRATE,r&&fj(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),function(e){try{const t=Date.now();Object.keys(e).forEach((n=>{const{value:r,type:i,expires:a}=e[n];a&&a<=t||((i===NA.REALTIME||Object.prototype.hasOwnProperty.call(xA,n))&&(AA[n]=r,TA[n]=r,ok.debug("Update realtime parameters from config distribute",n,r)),i||YO()||!Object.prototype.hasOwnProperty.call(EA,n)||(AA[n]=r,TA[n]=r,ok.debug("Update gateway parameters from config distribute",n,r)))}))}catch(t){ok.error("Error update config immediately: ".concat(e),t.message)}}(t);const i=JSON.stringify(t),a=window.btoa(i);window.localStorage.setItem("websdk_ng_global_parameter",a),ok.debug("Caching global parameters ".concat(i))}catch(e){ok.error("Error caching global parameters:",e.message)}}handleGlobalParameterConfig(e){try{const t=Date.now();Object.keys(e).forEach((n=>{if("CLIENT_ROLE_OPTIONS"===n&&Object.prototype.hasOwnProperty.call(TA,n)){const{value:r,expires:i}=e[n];if(i&&i<=t)return;(function(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}})(TA[n],r)||(AA[n]=r,TA[n]=r,this.emit(dj.UPDATE_CLIENT_ROLE_OPTIONS,r),ok.debug("Updating client role options: ".concat(JSON.stringify(r))))}}))}catch(e){ok.error("Error handling global parameter config:",e.message)}}}class GU extends GI{constructor(){super(...arguments),dx(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n)),!t.muted&&this.record("VIDEO_ENCODE_FAILED",e,this.checResolutionSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(IA("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(!r)return;r.result.push(n);const i="VIDEO_ENCODE_FAILED"===e?IA("ENCODE_EXCEPTION_TIMES"):5;if(r.result.length>=i){var a;const n=Lr(a=r.result).call(a,!0);r.isPrevNormal&&!n&&this.emit("exception",HU[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",HU[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof WM&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=aF(t._encoderConfig.frameRate));const r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checResolutionSent(e){var t;return!(!e.codecType||Lr(t=IA("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(t,e.codecType.toLocaleLowerCase()))||!e.captureFrameRate||0!==e.sendFrameRate||0!==e.sendResolutionWidth||0!==e.sendResolutionHeight}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof WM&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const HU={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},YU=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function qU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function KU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qU(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class XU{constructor(e){dx(this,"store",void 0),dx(this,"onStatsException",void 0),dx(this,"onUploadPublishDuration",void 0),dx(this,"onStatsChanged",void 0),dx(this,"onVideoCodecChanged",void 0),dx(this,"localStats",new Map),dx(this,"remoteStats",new Map),dx(this,"updateStatsInterval",void 0),dx(this,"trafficStats",void 0),dx(this,"trafficStatsPeerList",[]),dx(this,"uplinkStats",void 0),dx(this,"exceptionMonitor",void 0),dx(this,"p2pChannel",void 0),dx(this,"scalabilityMode",cA.L1T1),dx(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=e,this.exceptionMonitor=new GU,this.exceptionMonitor.on("exception",((e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(bj.LocalAudioTrack)||KU({},qk)}getLocalVideoTrackStats(){return this.localStats.get(bj.LocalVideoTrack)||KU({},Kk)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)}));return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRTCStats(){let e=0,t=0,n=0,r=0;const i=this.localStats.get(bj.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const a=this.localStats.get(bj.LocalVideoTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate);const o=this.localStats.get(bj.LocalVideoLowTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate),this.remoteStats.forEach((e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));let s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter((e=>void 0!==e.B_ppad||void 0!==e.B_ppvd)),e.peer_delay.filter((e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid))).forEach((e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?YU.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?YU.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&ok.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;const r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach((t=>{let[n,r]=t;switch(n){case bj.LocalVideoTrack:case bj.LocalVideoLowTrack:{const t=r,o=KU({},Kk),s=e.getStats(),c=e.getLocalMedia(n);if(s){const n=s.videoSend.find((e=>e.ssrc===(null==c?void 0:c.ssrcs[0].ssrcId)));if(n){const r=e.getLocalVideoSize(),a=e.getEncoderConfig(bj.LocalVideoTrack);var i;"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(o.codecType=n.codec,(null==t?void 0:t.codecType)!==n.codec&&(null===(i=this.onVideoCodecChanged)||void 0===i||i.call(this,n.codec.toLocaleLowerCase()))),o.sendBytes=n.bytes,o.sendBitrate=t?8*Math.max(0,o.sendBytes-t.sendBytes):0,n.inputFrame?(o.captureFrameRate=n.inputFrame.frameRate,o.captureResolutionHeight=n.inputFrame.height,o.captureResolutionWidth=n.inputFrame.width):r&&(o.captureResolutionWidth=r.width,o.captureResolutionHeight=r.height),n.sentFrame?(o.sendFrameRate=n.sentFrame.frameRate,o.sendResolutionHeight=n.sentFrame.height,o.sendResolutionWidth=n.sentFrame.width):r&&(o.sendResolutionWidth=r.width,o.sendResolutionHeight=r.height),n.avgEncodeMs&&(o.encodeDelay=n.avgEncodeMs),a&&a.bitrateMax?o.targetSendBitrate=1e3*a.bitrateMax:n.targetBitrate&&(o.targetSendBitrate=n.targetBitrate),o.sendPackets=n.packets,o.sendPacketsLost=n.packetsLost,o.sendJitterMs=n.jitterMs,o.sendRttMs=n.rttMs,o.totalDuration=t?t.totalDuration+1:1,o.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(o.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(ok.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(o.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var a;this.localStats.set(n,o),((null==t?void 0:t.sendResolutionWidth)!==o.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==o.sendResolutionHeight)&&(null===(a=this.onStatsChanged)||void 0===a||a.call(this,"resolution",{width:o.sendResolutionWidth,height:o.sendResolutionHeight})),o&&c&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,c.track,o);break}case bj.LocalAudioTrack:{const t=r,i=KU({},qk),a=e.getStats(),o=e.getLocalMedia(n);if(a){const n=a.audioSend.find((e=>e.ssrc===(null==o?void 0:o.ssrcs[0].ssrcId)));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendJitterMs=n.jitterMs,i.sendRttMs=n.rttMs,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(bj.LocalAudioTrack,i),i&&o&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,o.track,i);break}}}))}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach((t=>{var n,r;let[i,{videoStats:a,audioStats:o,videoPcStats:s}]=t;const c=o,u=a,l=s,d=KU({},Xk),f=KU({},Jk),h=KU({},Qk),{audioTrack:p,videoTrack:m,audioSSRC:g,videoSSRC:v}=e.getRemoteMedia(i);let y;y=this.store.useP2P?e.getStats(!0):e.getStats();const b=null===(n=y)||void 0===n?void 0:n.audioRecv.find((e=>e.ssrc===g)),_=null===(r=y)||void 0===r?void 0:r.videoRecv.find((e=>e.ssrc===v)),w=this.trafficStats&&this.trafficStats.peer_delay.find((e=>e.peer_uid===i));if(b&&("opus"!==b.codec&&"aac"!==b.codec&&"PCMU"!==b.codec&&"PCMA"!==b.codec&&"G722"!==b.codec||(d.codecType=b.codec),b.outputLevel?d.receiveLevel=Math.round(32767*b.outputLevel):p&&(d.receiveLevel=Math.round(32767*p.getVolumeLevel())),d.receiveBytes=b.bytes,d.receivePackets=b.packets,d.receivePacketsLost=b.packetsLost,d.receivePacketsDiscarded=b.packetsDiscarded,d.packetLossRate=d.receivePacketsLost/(d.receivePackets+d.receivePacketsLost),d.receiveBitrate=c?8*Math.max(0,d.receiveBytes-c.receiveBytes):0,d.totalDuration=c?c.totalDuration+1:1,d.totalFreezeTime=c?c.totalFreezeTime:0,d.freezeRate=d.totalFreezeTime/d.totalDuration,d.receiveDelay=b.jitterBufferMs,d.totalDuration>10&&XU.isRemoteAudioFreeze(p)&&(d.totalFreezeTime+=1)),_){var E;"H264"!==_.codec&&"H265"!==_.codec&&"VP8"!==_.codec&&"VP9"!==_.codec&&"AV1X"!==_.codec&&"AV1"!==_.codec||(f.codecType=_.codec),f.receiveBytes=_.bytes,f.receiveBitrate=u?8*Math.max(0,f.receiveBytes-u.receiveBytes):0,f.decodeFrameRate=_.decodeFrameRate<0?0:_.decodeFrameRate,f.renderFrameRate=_.decodeFrameRate<0?0:_.decodeFrameRate,_.outputFrame&&(f.renderFrameRate=_.outputFrame.frameRate),_.receivedFrame?(f.receiveFrameRate=_.receivedFrame.frameRate,f.receiveResolutionHeight=_.receivedFrame.height,f.receiveResolutionWidth=_.receivedFrame.width):m&&(f.receiveResolutionHeight=m._videoHeight||0,f.receiveResolutionWidth=m._videoWidth||0),void 0!==_.framesRateFirefox&&(f.receiveFrameRate=Math.round(_.framesRateFirefox)),f.receivePackets=_.packets,f.receivePacketsLost=_.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost);const t=u?u.totalFreezeTime:0,n=u?u.totalDuration:0;f.totalDuration=u?u.totalDuration+1:1,f.totalFreezeTime=null!==(E=_.totalFreezesDuration)&&void 0!==E?E:t||0,f.receiveDelay=_.jitterBufferMs||0;const r=!!v&&e.getRemoteVideoIsReady(v);void 0===_.totalFreezesDuration&&m&&r&&XU.isRemoteVideoFreeze(m,_,l)&&(f.totalFreezeTime+=1),f.freezeRate=Math.max(0,Math.min((f.totalFreezeTime-t)/(f.totalDuration-n),1))}w&&(d.end2EndDelay=w.B_ad,f.end2EndDelay=w.B_vd,d.transportDelay=w.B_ed,f.transportDelay=w.B_ed,d.currentPacketLossRate=w.B_ealr4/100,f.currentPacketLossRate=w.B_evlr4/100,h.uplinkNetworkQuality=w.B_punq?w.B_punq:0,h.downlinkNetworkQuality=w.B_pdnq?w.B_pdnq:0),this.remoteStats.set(i,{audioStats:d,videoStats:f,videoPcStats:_,networkStats:h}),p&&this.exceptionMonitor.setRemoteAudioStats(p,d),m&&this.exceptionMonitor.setRemoteVideoStats(m,f)}))}}class QU{constructor(){dx(this,"destChannelMediaInfos",new Map),dx(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){ZP(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){ZP(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){zP(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function JU(e){if(!(e instanceof QU))return new mk(II.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new mk(II.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new mk(II.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class ZU{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){dx(this,"uid",void 0),dx(this,"_uintid",void 0),dx(this,"_trust_in_room_",!0),dx(this,"_trust_audio_enabled_state_",!0),dx(this,"_trust_video_enabled_state_",!0),dx(this,"_trust_audio_mute_state_",!0),dx(this,"_trust_video_mute_state_",!0),dx(this,"_audio_muted_",!1),dx(this,"_video_muted_",!1),dx(this,"_audio_enabled_",!0),dx(this,"_video_enabled_",!0),dx(this,"_audio_added_",!1),dx(this,"_video_added_",!1),dx(this,"_is_pre_created",!1),dx(this,"_video_pre_subscribed",!1),dx(this,"_audio_pre_subscribed",!1),dx(this,"_trust_video_stream_added_state_",!0),dx(this,"_trust_audio_stream_added_state_",!0),dx(this,"_audioTrack",void 0),dx(this,"_videoTrack",void 0),dx(this,"_dataChannels",[]),dx(this,"_audioSSRC",void 0),dx(this,"_videoSSRC",void 0),dx(this,"_audioOrtc",void 0),dx(this,"_videoOrtc",void 0),dx(this,"_cname",void 0),dx(this,"_rtxSsrcId",void 0),dx(this,"_videoMid",void 0),dx(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}function $U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function eB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$U(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const tB="9",nB=2e4,rB=4e4;function iB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function aB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iB(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var oB=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(oB||{});const sB=new Map;function cB(e,t,n,r){let{scale:i}=e;if(0===i&&r===oB.UP||i>=t.length-1&&r===oB.DOWN)return e;let a=aB(aB({},e),{},{scale:r===oB.DOWN?++i:--i});switch(n){case"maintain-framerate":a=aB(aB({},a),t[i].motion);break;case"maintain-resolution":a=aB(aB({},a),t[i].detail);break;case"balanced":a=aB(aB({},a),t[i].balanced)}return a}function uB(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:lB(t)};sB.set(e,n)}else sB.delete(e)}function lB(e){const t=aB({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:a}=t,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:s,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:u,BITRATE_MAX_THRESHOLD:l,BWE_SCALE_UP_THRESHOLD:d,BWE_SCALE_DOWN_THRESHOLD:f,PERF_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_UP_THRESHOLD:p,BALANCE_BITRATE_FACTOR:m,BALANCE_FRAMERATE_FACTOR:g,BALANCE_RESOLUTION_FACTOR:v,MOTION_RESOLUTION_FACTOR:y,MOTION_BITRATE_FACTOR:b,DETAIL_FRAMERATE_FACTOR:_,DETAIL_BITRATE_FACTOR:w}=SA,E=Math.min(t.frameRate,s),S=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(f,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(h,1)*E),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a}}];for(let C=1;C<=c;C++){const e={bwe_up:Math.round(Math.pow(d,C)*n),bwe_down:Math.round(Math.pow(f,C+1)*n),fps_up:Math.round(Math.pow(p,C)*E),fps_down:Math.round(Math.pow(h,C+1)*E)},t={scaleResolutionDownBy:i/Math.pow(v,C),frameRate:Math.max(Math.round(Math.pow(g,C)*r),o),bitrateMax:Math.max(Math.round(Math.pow(m,C)*n),l),bitrateMin:Math.max(Math.round(Math.pow(m,C)*a),u)},s={scaleResolutionDownBy:i/Math.pow(y,C),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(b,C)*n),l),bitrateMin:Math.max(Math.round(Math.pow(b,C)*a),u)},c={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_,C)*r),o),bitrateMax:Math.max(Math.round(Math.pow(w,C)*n),l),bitrateMin:Math.max(Math.round(Math.pow(w,C)*a),u)};S.push({scale:C,threshold:e,balanced:t,motion:s,detail:c})}return S}function dB(e,t,n,r,i,a){const o=sB.get(e)||{overUse:0,underUse:0,adaptationList:lB(i)},{adaptationList:s}=o;sB.set(e,o);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:u}=SA,{scale:l}=r;let d,f;return"number"==typeof t&&t>0&&function(e,t,n,r){if(t>=n.length)return!1;let{threshold:{fps_down:i}}=n[t];return IA("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[0].threshold.fps_down),e<i}(t,l,s,a)&&(o.overUse++,f=sA.CPU,o.overUse>c)||"number"==typeof n&&n>0&&function(e,t,n){if(t>=n.length)return!1;const{threshold:{bwe_down:r}}=n[t];return e<r}(n,l,s)&&(o.overUse++,f=sA.BANDWIDTH,o.overUse>c)?(o.overUse=0,o.underUse=0,d=cB(r,s,a,oB.DOWN),[d,f]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,r){if(0===t)return;let{threshold:{fps_up:i}}=n[t];return IA("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[1].threshold.fps_up),e>i}(t,l,s,a)&&function(e,t,n){if(0===t)return;const{threshold:{bwe_up:r}}=n[t];return e>r}(n,l,s)&&(o.underUse++,o.underUse>u&&(o.overUse=0,o.underUse=0,d=cB(r,s,a,oB.UP),0===d.scale&&(f=sA.NONE))),[d,f])}function fB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fB(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const pB=new Map;function mB(e,t){const n=pB.get(e);if(n){const{timer:t}=n;window.clearTimeout(t),pB.delete(e)}t.qualityLimitationReason=sA.NONE,uB(e)}function gB(e,t){var n;let r;switch(t){case bj.LocalAudioTrack:r=rj.Audio;break;case bj.LocalVideoTrack:r=Lr(n=e._hints).call(n,Fk.SCREEN_TRACK)?rj.Screen:rj.High;break;case bj.LocalVideoLowTrack:r=rj.Low}return r}function vB(e){const t=vk();if(e.some((e=>e._bypassWebAudio)))throw new NI(II.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new NI(II.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function yB(e,t){vB(e);const n=t||new WM;return e.forEach((e=>n.addAudioTrack(e))),n}const bB=!vk().supportUnifiedPlan||IA("CHROME_FORCE_PLAN_B")&&EI();function _B(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;return bB?(n={spec:t,store:e},QF("PlanBConnection").create(n)):new TB(t,e)}function wB(e){return e&&("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)}function EB(e){try{if(e.iceServers)return!1;if(e.turnServer&&"off"!==e.turnServer.mode){if(ZI(e.turnServer.servers))return!1;if(IA("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some((e=>e.forceturn)))return!0}return!1}catch(e){return!1}}var SB;function CB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CB(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let TB=(SB=class e extends pj{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Lr(t=Object.keys(DA)).call(t,e)})))]}constructor(t,n){super(t,n),dx(this,"id",xN(5,"connection-")),dx(this,"store",void 0),dx(this,"peerConnection",void 0),dx(this,"forceTurn",!1),dx(this,"remoteSDP",void 0),dx(this,"initialOffer",void 0),dx(this,"transportEventReceiver",void 0),dx(this,"statsFilter",void 0),dx(this,"extension",{useXR:IA("USE_XR")}),dx(this,"localCapabilities",void 0),dx(this,"remoteCodecs",void 0),dx(this,"localCandidateCount",0),dx(this,"allCandidatesReceived",!1),dx(this,"isPreallocation",!1),dx(this,"preMediaMap",new Map),dx(this,"dataStreamChannelMap",new Map),dx(this,"establishPromise",void 0),dx(this,"recoveredDataChannelIds",[]),dx(this,"currentDataChannelId",1),dx(this,"supportAV1RtpSpec",!1),dx(this,"mutex",void 0),dx(this,"qualityLimitationReason",sA.NONE),dx(this,"isFirstConnected",!1),this.store=n,this.forceTurn=EB(t),this.mutex=new FN("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=mA(this.peerConnection,IA("STATS_UPDATE_INTERVAL"),void 0,nI()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(e){return this.preMediaMap.get(e)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else ok.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else ok.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=EF(n.sdp),i=await MF({filterRTX:!IA("USE_PUB_RTX")&&!IA("USE_SUB_RTX"),filterVideoFec:IA("FILTER_VIDEO_FEC"),filterAudioFec:IA("FILTER_AUDIO_FEC"),filterVideoCodec:IA("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:IA("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:IA("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=PF(i),this.initialOffer=n,IA("ENABLE_SVC")&&"av1"==this.store.codec){const t=await async function(){try{const e=new RTCPeerConnection;e.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:cA.L1T3}]});const t=await e.createOffer();if(!t.sdp)return void e.close();const n=UA(t.sdp).mediaDescriptions[0];if(!n)return;const r=n.attributes.extmaps.find((e=>"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"===e.extensionName));return e.close(),r}catch(e){return}}();var e;t&&(this.supportAV1RtpSpec=!0,null===(e=i.send)||void 0===e||e.videoExtensions.push(t))}let a;return n.sdp&&WF(n.sdp)&&(a=hN(i),(t=a).send&&(gF(mj.VIDEO,t.send.videoExtensions),gF(mj.AUDIO,t.send.audioExtensions)),t.recv&&(gF(mj.VIDEO,t.recv.videoExtensions),gF(mj.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(gF(mj.VIDEO,t.sendrecv.videoExtensions),gF(mj.AUDIO,t.sendrecv.audioExtensions))),xB(xB({},r),{},{rtpCapabilities:a||i,offerSDP:n.sdp})}catch(e){throw new NI(II.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}var t}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&WF(this.initialOffer.sdp)&&(t=e.rtpCapabilities,n=this.localCapabilities,t.send&&(mF(mj.VIDEO,t.send.videoExtensions,n.send.videoExtensions),mF(mj.AUDIO,t.send.audioExtensions,n.send.audioExtensions)),t.recv&&(mF(mj.VIDEO,t.recv.videoExtensions,n.recv.videoExtensions),mF(mj.AUDIO,t.recv.audioExtensions,n.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return hN(this._localCapabilities)}get rtpCapabilities(){return hN(this._rtpCapabilities)}get candidates(){return hN(this._candidates)}get iceParameters(){return hN(this._iceParameters)}get dtlsParameters(){return hN(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];dx(this,"sessionDesc",void 0),dx(this,"_localCapabilities",void 0),dx(this,"_rtpCapabilities",void 0),dx(this,"_candidates",void 0),dx(this,"_originCandidates",void 0),dx(this,"_iceParameters",void 0),dx(this,"_isUseExtmapAllowMixed",void 0),dx(this,"_isUseLocalCodecs",void 0),dx(this,"_dtlsParameters",void 0),dx(this,"setup",void 0),dx(this,"currentMidIndex",void 0),dx(this,"cname",void 0),dx(this,"useLocalCodecsMids",[]),dx(this,"preloadSsrcs",[]),dx(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,this._isUseLocalCodecs=n,e=hN(e);const{iceParameters:r,dtlsParameters:i,candidates:a,rtpCapabilities:o,setup:s,localCapabilities:c,cname:u}=e;this._rtpCapabilities=o,this._candidates=a,this._originCandidates=hN(a),this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=c,this.setup=s,this.cname=u,[this.sessionDesc]=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(e){return e.length===this.preloadSsrcs.length&&e.every((e=>{var t;return Lr(t=this.preloadSsrcs).call(t,e)}))}preloadRemoteMedia(e){let t=0;const n=[],r=[];for(;e>0;){const i=[eB({ssrcId:rB+t},IA("USE_SUB_RTX")?{rtx:rB+t+1}:{})],a="".concat(rB+t,"_").concat(nB+t),{ssrcs:o,ssrcGroups:s}=TF(i,this.cname,IA("SYNC_GROUP")?a:void 0),c=this.preCreateOrRecycleSendMedia("video",o,s,void 0),u=[{ssrcId:nB+t}],l="".concat(rB+t,"_").concat(nB+t),{ssrcs:d,ssrcGroups:f}=TF(u,this.cname,IA("SYNC_GROUP")?l:void 0),h=this.preCreateOrRecycleSendMedia("audio",d,f,void 0);e--,t+=2,n.push(c,h),r.push(o[0].ssrcId,d[0].ssrcId)}return this.useLocalCodecsMids.push(...n),this.preloadSsrcs=r,{mids:n,preSSRCs:r,isAvailable:!0}}preCreateOrRecycleSendMedia(e,t,n,r){const i=this.rtpCapabilities.send.videoCodecs,a=this._isUseLocalCodecs||0===i.length?this.localCapabilities.recv:this.rtpCapabilities.send;ok.debug("create or recycle send media without remote rtp capabilities, ssrcs ",t[0].ssrcId);const o=e===mj.VIDEO?a.videoCodecs:a.audioCodecs,s=e===mj.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let u={media:{mediaType:e,port:tB,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};return u=this.mungSendMediaDesc(u,r),this.sessionDesc.mediaDescriptions.push(u),this.updateBundleMids(),c}toString(){return BA(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:a}=TF(t,this.cname,IA("SYNC_GROUP")?n:void 0),o=this.findPreloadMediaDesc(i);if(o){if(nI()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,o.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(o);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(o,r),{mid:o.attributes.mid,needExchangeSDP:!0}}return{mid:o.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||1===t&&($R()||function(){const e=qR();return!(e.name!==WR.CHROME||!e.osVersion)&&Number(e.version)<=90}()||IA("ENABLE_ENCODED_TRANSFORM")&&ZR())||0===t&&!function(e){const t=qR();return!(t.name!==WR.FIREFOX||!t.osVersion)&&Number(t.version)===e}(138)&&IA("USE_SUB_RTX")||pI()?(n=this.createOrRecycleSendMedia(e,i,a,"sendonly",r),this.updateBundleMids()):(n=hN(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),nI()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||nI()||pI()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Lr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Lr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||UA((n=this._isUseExtmapAllowMixed,"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite".concat(n?"\na=extmap-allow-mixed":"","\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n")));var n;this._rtpCapabilities=e;let r=!1;const i=this.rtpCapabilities.send,a=this.localCapabilities.send,o=this.localCapabilities.recv,s=o.videoCodecs,c=o.audioCodecs,u=o.videoExtensions,l=o.audioExtensions;for(const p of t.mediaDescriptions){var d;if("sendonly"!==p.attributes.direction||"string"!=typeof p.attributes.mid||!Lr(d=this.useLocalCodecsMids).call(d,p.attributes.mid)){if(r=!0,p.attributes.iceUfrag=this._iceParameters.iceUfrag,p.attributes.icePwd=this._iceParameters.icePwd,p.attributes.fingerprints=this._dtlsParameters.fingerprints,p.attributes.candidates=this._candidates,p.attributes.setup=this.setup,"application"===p.media.mediaType&&(p.attributes.sctpPort="5000"),"video"===p.media.mediaType)if(this._isUseLocalCodecs&&"sendonly"===p.attributes.direction){var f;p.media.fmts=s.map((e=>e.payloadType.toString(10))),p.attributes.payloads=s,p.attributes.extmaps=u;const e=p.attributes.mid;"string"!=typeof e||Lr(f=this.useLocalCodecsMids).call(f,e)||this.useLocalCodecsMids.push(e)}else if(0===i.videoCodecs.length){const e=a.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Lr(n=t.encodingName.toLowerCase()).call(n,"vp8")}))||[a.videoCodecs[0]];p.media.fmts=e.map((e=>e.payloadType.toString(10))),p.attributes.payloads=e,p.attributes.extmaps=[]}else p.media.fmts=i.videoCodecs.map((e=>e.payloadType.toString(10))),p.attributes.payloads=i.videoCodecs,p.attributes.extmaps=i.videoExtensions;if("audio"===p.media.mediaType)if(this._isUseLocalCodecs&&"sendonly"===p.attributes.direction){var h;p.media.fmts=c.map((e=>e.payloadType.toString(10))),p.attributes.payloads=c,p.attributes.extmaps=l;const e=p.attributes.mid;"string"!=typeof e||Lr(h=this.useLocalCodecsMids).call(h,e)||this.useLocalCodecsMids.push(e)}else if(0===i.audioCodecs.length){const e=a.audioCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Lr(n=t.encodingName.toLowerCase()).call(n,"opus")}))||[a.audioCodecs[0]];p.media.fmts=e.map((e=>e.payloadType.toString(10))),p.attributes.payloads=e,p.attributes.extmaps=[]}else p.media.fmts=i.audioCodecs.map((e=>e.payloadType.toString(10))),p.attributes.payloads=i.audioCodecs,p.attributes.extmaps=i.audioExtensions,jF(p)}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,[this.sessionDesc,r]}updateCandidates(e){const t=this._originCandidates.filter((e=>"udp"===e.transport)),n=[];if(t.forEach((e=>{n.push(eB(eB({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),0!==t.length){switch(e){case gj.TCP_RELAY:this._candidates=n;break;case gj.UDP_TCP_RELAY:case gj.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=hN(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(nI()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:tB,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,a){const o=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=FF(o,s,this.localCapabilities.send,o===mj.VIDEO?r:i),u=o===mj.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let d={media:{mediaType:o,port:tB,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e,a);const f=this.findFirstClosedMedia(o);if(f){const e=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteDtlsParameters(e){const t=new Set(this._dtlsParameters.fingerprints.map((e=>e.fingerprint))),n=new Set(e.map((e=>e.fingerprint)));let r=!1;t.size!==n.size&&(r=!0);for(const i of t)n.has(i)||(r=!0);return r}updateRemoteCodec(e,t,n){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Lr(t=Object.keys(DA)).call(t,e)})))],i=new Set(t);if(r.every((e=>i.has(e))))return ok.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const a=this._rtpCapabilities.recv.videoCodecs.filter((e=>t.some((t=>{var n;return Lr(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))));if(0===a.length)return ok.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const o=[...new Set(a.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")))];let s;if(ok.debug("updateRemoteCodec, from ".concat(r," to ").concat(o)),0===e.length)s=this.sessionDesc.mediaDescriptions.filter((e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction));else if(s=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&"video"===t.media.mediaType&&Lr(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)),s.length!==e.length)return ok.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(IA("USE_PUB_RTX")||IA("USE_SUB_RTX")){const e=UF(a,this.rtpCapabilities.recv.videoCodecs);a.push(...e)}this._rtpCapabilities.recv.videoCodecs=a;const c=this.localCapabilities.send,u=this.rtpCapabilities.recv,l=FF(mj.VIDEO,u,c,n);return s.forEach((e=>{const t=l.map((e=>e.payloadType.toString(10)));ok.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from"),e.attributes.payloads,"to",l),e.attributes.payloads=l,e.media.fmts=t})),!0}createOrRecycleSendMedia(e,t,n,r,i){const a=this.rtpCapabilities.send.videoCodecs,o=this._isUseLocalCodecs||0===a.length?this.localCapabilities.recv:this.rtpCapabilities.send,s=e===mj.VIDEO?o.videoCodecs:o.audioCodecs,c=e===mj.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:tB,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};l=this.mungSendMediaDesc(l,i);const d=this.findFirstClosedMedia(e);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=hN(e);return IF(r),RF(r,t),NF(r,t),AF(r),kF(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=hN(e);return kF(n,t,this.localCapabilities.recv),jF(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>nI()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}(xB(xB({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!IA("ENABLE_PRE_SUB_WITH_PRE_PC")||!IA("PRE_USE_LOCAL_CODECS"))&&_k(this.store)),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),i=VF(this.initialOffer.sdp,this.extension),a=this.logSDPExchange(i||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==a||a(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const o=this.peerConnection.getTransceivers()[0];if(null!=o&&o.receiver&&this.tryBindTransportEvents(o.receiver),_k(this.store))if(e.preallocation&&IA("ENABLE_PRE_SUB_WITH_PRE_PC")){const e=IA("PRE_SUB_NUM"),{mids:t,preSSRCs:n}=this.remoteSDP.preloadRemoteMedia(e);await BF(this.peerConnection,this.remoteSDP,this.extension),ok.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(n)),this.presetMedia(t,n)}else{const{preSSRCs:t=[]}=e,n=t.map((e=>e.ssrcMsg[0].ssrcId));if(0===t.length)return;const{mids:r}=this.remoteSDP.batchSend(t.map((e=>Object.assign({},e))));await BF(this.peerConnection,this.remoteSDP,this.extension),ok.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(n)),this.presetMedia(r,n)}}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}var t,n}presetMedia(e,t){e.forEach(((e,n)=>{this.peerConnection.getTransceivers().forEach((r=>{if(null!=r.mid&&e===r.mid&&r.receiver.track){const i=r.receiver.track;let a;"video"===i.kind&&IA("ENABLE_PRE_RENDER")&&(a=new XM({trackId:"track-".concat(i.kind,"-unknown-").concat(this.store.clientId,"_").concat(xN(5,""))},!0),a.updateVideoTrack(i),a.onFirstVideoFrameRender=()=>{var e;const r=this.preMediaMap.get(t[n]);r&&(r.firstVideoRender=Date.now()),null===(e=this.onFirstVideoRender)||void 0===e||e.call(this,t[n])},a.play(this.store.sessionId||void 0)),this.preMediaMap.set(t[n],{mid:e,track:i,player:a,transceiver:r})}})),this.store.peerReceiver()}))}checkDtlsParameters(e){return!!this.remoteSDP&&e.length>0&&this.remoteSDP.updateRemoteDtlsParameters(e)}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let t=!1;const{rtpCapabilities:n}=e;if([,t]=this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const e=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);t=t||e}const{preSSRCs:r=[]}=e,i=r.map((e=>e.ssrcMsg[0].ssrcId));if(!this.remoteSDP.checkPreloadSsrcs(i)){const e=[],t=[];if(Array.from(this.preMediaMap.entries()).every((n=>{let[r,{mid:i,player:a,track:o}]=n;return e.push(i),t.push(r),this.preMediaMap.delete(r),a&&a.destroy(),!0})),e.length>0&&(this.remoteSDP.stopSending(e),await BF(this.peerConnection,this.remoteSDP,this.extension),ok.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(t)),pk.reportApiInvoke(this.store.sessionId,{name:qI.PRELOAD_MEDIA_FAILED,options:[r,t],tag:KI.TRACER}).onSuccess()),r.length>0){const{mids:e}=this.remoteSDP.batchSend(r.map((e=>Object.assign({},e))));await BF(this.peerConnection,this.remoteSDP,this.extension),ok.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(i)),this.presetMedia(e,i)}}t?(await BF(this.peerConnection,this.remoteSDP,this.extension),ok.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):ok.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return KT((function*(){const i=yield QT(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=[],o=hF();e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,xB({direction:"sendonly"},"video"===e.trackMediaType&&r.supportAV1RtpSpec&&o?{sendEncodings:[{scalabilityMode:o}]}:{}));a.push(t),e._updateRtpTransceiver(t)})),nI()&&!0===IA("SIMULCAST")&&(yield QT(r.applySimulcastForFirefox(a,e)));const s=yield QT(r.peerConnection.createOffer()),c=r.remoteSDP.predictReceivingMids(e.length),u=r.mungSendOfferSDP(s.sdp,e,c),l=UA(u),d=c.map((e=>{const t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return SF(t,IA("USE_PUB_RTX"))}));let f;try{f=yield d}catch(i){f=[],r.remoteSDP.receive(e,t,n,f);const a=r.remoteSDP.toString();throw yield QT(r.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield QT(r.peerConnection.setRemoteDescription({type:"answer",sdp:a})),yield QT(r.stopSending(c,!0)),i}r.remoteSDP.receive(e,t,n,f);const h=r.remoteSDP.toString(),p=r.logSDPExchange(u,"offer","local","send");return yield QT(r.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield QT(r.applySimulcastEncodings(a,e)),yield QT(r.applySendEncodings(a,e)),null==p||p(h),yield QT(r.peerConnection.setRemoteDescription({type:"answer",sdp:h})),a.map(((e,t)=>{const n=c[t];return{localSSRC:d[t],id:n,transceiver:e}}))}catch(e){throw e instanceof NI?e:new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&"open"===n.readyState)ok.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:IA("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach((e=>{e._updateOriginDataChannel(n)}));const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),ok.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else ok.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof NI?e:new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof NI?e:new NI(II.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{var t;mB(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:a}=this.remoteSDP.send(e,t,n,r);a&&(await BF(this.peerConnection,this.remoteSDP,this.extension),ok.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const o=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:i,transceiver:o}}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);return n&&(await BF(this.peerConnection,this.remoteSDP,this.extension),ok.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}}))}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach((e=>{Array.from(this.preMediaMap.entries()).some((t=>{let[n,{mid:r,player:i}]=t;if(r===e)return this.preMediaMap.delete(n),i&&i.destroy(),!0}))})),this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return KT((function*(){const n=yield QT(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=vk().supportPCSetConfiguration,r=IA("FORCE_TURN_TCP")||t.forceTurn;if(e===gj.RELAY&&!n)return;if(n&&!r){const n=e===gj.RELAY?"relay":"all",r=t.peerConnection.getConfiguration();r.iceTransportPolicy!==n&&(ok.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(r.iceTransportPolicy,"] to [").concat(n,"]")),r.iceTransportPolicy=n,t.peerConnection.setConfiguration(r))}t.remoteSDP.updateCandidates(e);const i=yield QT(t.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=EF(i.sdp),{remoteIceParameters:o}=yield a.iceParameters;t.remoteSDP.restartICE(o);const s=t.remoteSDP.toString(),c=t.logSDPExchange(i.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield QT(t.peerConnection.setLocalDescription(i)),null==c||c(s),yield QT(t.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(e){ok.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(gj.TCP_RELAY),await BF(this.peerConnection,this.remoteSDP,this.extension)}catch(e){ok.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),e)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach((e=>{mB(this.id+e.mid,this)})),this.preMediaMap.forEach((e=>{let{player:t}=e;t&&t.destroy()})),this.preMediaMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return xB(xB({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==a||a(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?nI()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:xB(xB({},$N),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:xB(xB({},$N),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.isFirstConnected=!0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;const n="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"",i=fF(e.url||"");ok.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(n,"), url: ").concat(i||"",", host_candidate:").concat(r)),null===(t=this.onICECandidateError)||void 0===t||t.call(this,n)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&ok.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,ok.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,ok.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),IA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},r=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(ZI(t.turnServer.servers)?n.iceServers=t.turnServer.servers:IA("NEW_TURN_MODE")&&n.iceServers&&"disabled"===r?(IA("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...e.newTurnServerConfigToIceServers(t.turnServer.servers)),IA("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):"off"!==t.turnServer.mode&&(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),IA("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),IA("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),IA("ENABLE_ENCODED_TRANSFORM")&&vk().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nF(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!IA("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}static newTurnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{const n=IA("NEW_TURN_MODE");1===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}):2===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}):3===n?t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nF(e.turnServerURL),":443?transport=tcp")}):4===n&&(t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=udp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":3478?transport=tcp")}),t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nF(e.turnServerURL),":443?transport=tcp")}))})),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair()||{};if(e&&t){const n=e.address+":"+e.port,r=t.address+":"+t.port;ok.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(fF(n)),", remote ").concat(JSON.stringify(fF(r))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,r;if(!t){const n=this.peerConnection.getSenders();t=n.find((t=>t.track===e._mediaStreamTrack))}if(!t)return ok.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return ok.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!vk().supportSetRtpSenderParameters)return ok.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},a={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;case"balanced":i.degradationPreference="balanced"}const o=function(e,t){return e.getTransceivers().find((e=>e.sender.track===t||e.receiver.track===t))}(this.peerConnection,e._mediaStreamTrack),s=QD(e);if(function(e){var t;return!(!IA("ENABLE_AG_ADAPTATION")||!(e instanceof OL||Lr(t=e._hints).call(t,Fk.CUSTOM_TRACK))||!IA("FORCE_SUPPORT_AG_ADAPTATION")&&!(lI(14,0,!1)&&dI(17,4,!0)||uI(14)&&fI(17,4,!0)))}(e)&&o&&t&&s&&this.getLocalVideoStats&&Lr(n=["vp8","vp9"]).call(n,this.store.codec)){var c;const n=i.degradationPreference||(Lr(c=e._hints).call(c,Fk.CUSTOM_TRACK)?IA("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,n,r,i,a){if(mB(e,n),i(t),"balanced"!==r&&"maintain-framerate"!==r&&"maintain-resolution"!==r)return;let o=-1;uB(e,t);const s=window.setInterval((()=>{const s=pB.get(e);if(!IA("ENABLE_AG_ADAPTATION")||!s)return mB(e,n),void i(t);const c=a();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===o)return void(o=Date.now());if(Date.now()-o<1e3)return;const a=c.sendFrameRate,u=c.OutgoingAvailableBandwidth,[l,d]=dB(e,a,u,s.adaptationConfig,t,r);d&&(n.qualityLimitationReason=d),l&&s.adaptationConfig.scale!==l.scale&&(ok.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(a,", bwe ").concat(u,", switch from ").concat(s.adaptationConfig.scale," to ").concat(l.scale," ")),s.adaptationConfig=hB(hB({},s.adaptationConfig),l),i(l))}}),IA("CHECK_LOCAL_STATS_INTERVAL")),c=hB({},t);pB.set(e,{timer:s,adaptationConfig:c,originConfig:t,adaptationFunc:i}),ok.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}(this.id+o.mid,s,this,n,(e=>{t&&this.updateAdaptation(t,e)}),this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var u;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(a.maxBitrate=1e3*t),(Lr(u=e._hints).call(u,Fk.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(a.maxFramerate=aF(n)),r&&r>=1&&(a.scaleResolutionDownBy=r))}const{maxFramerate:l}=IA("ENCODER_CONFIG_LIMIT");if(l&&"number"==typeof l&&(a.maxFramerate=a.maxFramerate?Math.min(a.maxFramerate,l):l),IA("DSCP_TYPE")&&EI()){var d;const e=IA("DSCP_TYPE");Lr(d=["very-low","low","medium","high"]).call(d,e)&&(a.networkPriority=e)}const f=t.getParameters(),h=null===(r=f.encodings)||void 0===r?void 0:r[0];nI()&&!h&&(i.encodings=[a]),h&&Object.assign(h,a),Object.assign(f,i),ok.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await t.setParameters(f),await async function(e,t,n){try{var r;if(!vk().supportSetRtpSenderParameters)return;if(!function(e){return"vp9"===e||"av1"===e}(e)||!IA("ENABLE_SVC"))return;const i={},a={},o=t.getParameters(),s=null===(r=o.encodings)||void 0===r?void 0:r[0];a.scalabilityMode=hF(n),s&&Object.assign(s,a),Object.assign(o,i),await t.setParameters(o),ok.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(o.encodings)))}catch(e){ok.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e)}}(this.store.codec,t,IA("SVC_MODE"))}async updateAdaptation(e,t){var n,r;if(!e)return ok.debug("[updateAdaptation] no rtpSender found");if(!vk().supportSetRtpSenderParameters)return ok.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const i={},{bitrateMax:a,frameRate:o,scaleResolutionDownBy:s}=t;a&&(i.maxBitrate=1e3*a),o&&(i.maxFramerate=aF(o)),s&&s>=1&&Lr(n=["vp8","vp9"]).call(n,this.store.codec)&&(i.scaleResolutionDownBy=s);const c=e.getParameters(),u=null===(r=c.encodings)||void 0===r?void 0:r[0];u&&Object.assign(u,i),Object.assign(c,{});try{await e.setParameters(c),ok.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(t){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?ok.debug("[updateAdaptation] peerConnection not connected}"):ok.debug("[updateAdaptation] updateRtpSenderEncodings failed",t):ok.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!vk().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof LL&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){ok.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=UA(e);return t.forEach(((e,t)=>{const i=n[t],a=r.mediaDescriptions.find((e=>e.attributes.mid===i));a&&(RF(a,e),DF(a,e,this.store.codec))})),BA(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,a,o;const c=e[s],u=t[s];if(u instanceof LL&&!Lr(n=u._hints).call(n,Fk.LOW_STREAM)&&null!==(r=u._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=u._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(a=u._scalabilityMode)&&void 0!==a&&a.numSpatialLayers&&(null===(o=u._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!nI()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof LL&&this.isVP8Simulcast(r)){const t=e[n],i={},a={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];const o=t.sender.getParameters();await t.sender.setParameters(Object.assign(o,i))}}}isVP8Simulcast(e){var t,n,r,i,a;return!!(e instanceof LL&&IA("SIMULCAST")&&"vp8"===this.store.codec&&!Lr(t=e._hints).call(t,Fk.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=e._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(IA("SDP_LOGGING"))return ok.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(vk().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},NP(SB.prototype,"updateRemoteRTPCapabilities",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"updateRemoteRTPCapabilities"),SB.prototype),NP(SB.prototype,"connect",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"connect"),SB.prototype),NP(SB.prototype,"updateRemoteConnect",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"updateRemoteConnect"),SB.prototype),NP(SB.prototype,"createDataChannels",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"createDataChannels"),SB.prototype),NP(SB.prototype,"receive",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"receive"),SB.prototype),NP(SB.prototype,"batchReceive",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"batchReceive"),SB.prototype),NP(SB.prototype,"stopReceiving",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"stopReceiving"),SB.prototype),NP(SB.prototype,"muteRemote",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"muteRemote"),SB.prototype),NP(SB.prototype,"unmuteRemote",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"unmuteRemote"),SB.prototype),NP(SB.prototype,"muteLocal",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"muteLocal"),SB.prototype),NP(SB.prototype,"unmuteLocal",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"unmuteLocal"),SB.prototype),NP(SB.prototype,"close",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"close"),SB.prototype),NP(SB.prototype,"updateEncoderConfig",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"updateEncoderConfig"),SB.prototype),NP(SB.prototype,"updateSendParameters",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"updateSendParameters"),SB.prototype),NP(SB.prototype,"replaceTrack",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"replaceTrack"),SB.prototype),NP(SB.prototype,"updateAdaptation",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"updateAdaptation"),SB.prototype),NP(SB.prototype,"getRemoteSSRC",[RB],Object.getOwnPropertyDescriptor(SB.prototype,"getRemoteSSRC"),SB.prototype),SB);function RB(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return await r.apply(this,a)}finally{n()}},n}function IB(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=aF(t.width),r.height=aF(t.height);const i=aF(t.framerate||15);document.body.append(n),document.body.append(r);let a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();const o=r.getContext("2d");if(!o)throw new mk(II.UNEXPECTED_ERROR,"can not get canvas context");const s=vk(),c=r.captureStream(s.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=n.videoWidth,t=n.videoHeight/e,i=r.width*t;Math.abs(i-r.height)>=2&&(ok.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(i)),r.height=i)}o.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))},r.stopCapture=yD((()=>r.startCapture&&r.startCapture()),i);const u=c.stop;return c.stop=()=>{u.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),ok.debug("clean low stream renderer")},c}var NB=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(NB||{}),AB=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(AB||{}),kB=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(kB||{}),DB=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(DB||{}),MB=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(MB||{}),LB=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(LB||{});const OB=1e3,PB=6,jB=3,FB=Math.max(PB,jB,60);function UB(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function BB(e){const t={[MB.CONN_TYPE]:0,[MB.RTT]:e.rtt,[MB.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[MB.CONN_TYPE]=1),"tcp"===n&&(t[MB.CONN_TYPE]=3),"tls"===n&&(t[MB.CONN_TYPE]=4);break}case"srflx":t[MB.CONN_TYPE]=2;break;case"unknown":t[MB.CONN_TYPE]=5;break;default:t[MB.CONN_TYPE]=0}return t}function VB(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class zB extends GI{constructor(e){super(),dx(this,"store",void 0),dx(this,"uploadWRTCStatsTimer",void 0),dx(this,"uploadOutboundDenoiserStatsTimer",void 0),dx(this,"uploadExtStatsTimer",void 0),dx(this,"uploadExtUsageStatsTimer",void 0),dx(this,"uploadInboundExtStatsTimer",void 0),dx(this,"requestStats",void 0),dx(this,"requestTransportStats",void 0),dx(this,"requestLocalMedia",void 0),dx(this,"requestRemoteMedia",void 0),dx(this,"requestAllTracks",void 0),dx(this,"requestVideoIsReady",void 0),dx(this,"requestUploadStats",void 0),dx(this,"requestUpload",void 0),dx(this,"uploadOutboundStarted",!1),dx(this,"uploadInboundStarted",!1),dx(this,"uploadTransportStarted",!1),dx(this,"uploadBaseStatsStarted",!1),dx(this,"uploadExtensionUsageStarted",!1),dx(this,"lastRecvStats",void 0),dx(this,"lastSendStats",void 0),dx(this,"lastRefRecvStats",void 0),dx(this,"lastRefSendStats",void 0),dx(this,"lastNormalRecvStats",void 0),dx(this,"lastNormalSendStats",void 0),dx(this,"lastExtendStats",{}),dx(this,"needUploadStats",{}),dx(this,"needUploadRenderFreezeTime",!0),dx(this,"lastUploadCompensateTime",-1),dx(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const t=e%jB==0,n=e%PB==0,r=e%60==0;let i,a;if(this.uploadTransportStarted&&(i=this.requestStats(),this.store.useP2P&&(a=this.requestStats(!0))),!i&&this.uploadOutboundStarted&&(i=this.requestStats()),!a&&this.uploadInboundStarted&&(a=this.requestStats(!0)),i||a){var o;const s={};if(this.uploadTransportStarted&&i){const e=this.getTransportStats(i,a,t);e&&(s.misc=[e])}if(this.uploadOutboundStarted&&i){const e=this.getOutboundStats(i,n?this.lastNormalSendStats:void 0,t?this.lastRefSendStats:void 0,this.lastSendStats,r);e&&(s.outbound=[e])}if(this.uploadInboundStarted&&a){this.uploadCompensateStats(e);const r=this.getInboundStats(a,n?this.lastNormalRecvStats:void 0,t?this.lastRefRecvStats:void 0,this.lastRecvStats);r&&(s.inbound=r)}const c=null===(o=this.requestTransportStats)||void 0===o?void 0:o.call(this).connectState;c&&(Array.isArray(s.misc)?s.misc[0]&&s.misc[0].addition&&(s.misc[0].addition[LB.RTC_PEER_CONNECTION_STATE]=uA[c]):s.misc=[{addition:{[LB.RTC_PEER_CONNECTION_STATE]:uA[c]}}]),this.needUploadStats.sendType&&(Array.isArray(s.outbound)&&s.outbound[0]&&s.outbound[0].high&&(s.outbound[0].high[NB.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(s)}this.lastRecvStats=a,this.lastSendStats=i,n&&(this.lastNormalRecvStats=a,this.lastNormalSendStats=i),t&&(this.lastRefRecvStats=a,this.lastRefSendStats=i)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,n;const e=null===(t=this.requestTransportStats)||void 0===t?void 0:t.call(this);return void(e&&(null===(n=this.requestUploadStats)||void 0===n||n.call(this,{misc:[{addition:{[LB.RTC_PEER_CONNECTION_STATE]:uA[e.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===FB+1&&(e=1)}),OB)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const t=e%jB==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!t)return;if(-1===this.lastUploadCompensateTime)return void(this.lastUploadCompensateTime=Date.now());const n=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=n,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const r=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*r;const i=this.requestStats(!0);new Array(r).fill(0).forEach((()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const e={};if(this.uploadInboundStarted&&i){const t=this.requestRemoteMedia()||[],n=[];t.forEach((e=>{let[t,r]=e;const a={peer:t.uid};if(t._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(t._videoSSRC)&&r.has(mj.VIDEO)&&t.videoTrack){const e=function(e,t,n){if(!t.videoRecv.find((t=>t.ssrc===e)))return;const r={};if(n&&n._player){const e=n._player,{renderFreezeAccTime2:t,videoElementStatus:i}=e;if("visible"===ZL.visibility&&i===nD.PLAYING&&vk().supportRequestVideoFrameCallback){const n=Math.min(6e3,t);e.renderFreezeAccTime2=Math.max(0,t-n),UB(r,AB.Video_Render_Freeze_Time_Render2,n),IA("USE_NEW_RENDER_FREEZE_TIME")&&UB(r,AB.Video_Render_Freeze_Time_Render,n)}}return r}(t._videoSSRC,i,t.videoTrack);e&&(a.video=e)}a.video&&n.push(a)})),n.length>0&&(e.inbound=n,this.requestUploadStats(e))}}))}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,t,n){if(!this.requestStats)return;if(!n)return null==e.rtt?void 0:{addition:{[MB.RTT]:e.rtt,[MB.CONN_TYPE]:void 0,[MB.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=BB(e);if(this.store.useP2P){if(t){const e=BB(t);r[MB.CONN_TYPE]+=e[MB.CONN_TYPE]<<3}r[MB.CONN_TYPE]+=110}else r[MB.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,t,n,r,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;const a=this.requestLocalMedia();if(!a||0===a.length)return;let o,s,c;return a.forEach((r=>{let[a,{track:u,ssrcs:l}]=r;switch(a){case bj.LocalVideoLowTrack:case bj.LocalVideoTrack:if(a===bj.LocalVideoTrack){var d;const r=function(e,t,n,r,i){const a=t.videoSend.find((t=>t.ssrc===e));if(!a)return;const o={},{sentFrame:s,inputFrame:c}=a;if(r&&(UB(o,AB.Video_Send_Qp_Sum,a.qpSumPerFrame),c&&s)){const e=c.frameRate,t=s.frameRate;o[AB.Video_Send_Freeze]=function(e,t){let n=!0;return n=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),n}(e,t)?1:0}if(i){switch(s&&(UB(o,kB.Video_Send_Height,s.height),UB(o,kB.Video_Send_Width,s.width),UB(o,kB.Video_Send_Frame_Rate,s.frameRate)),o[kB.Video_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0,a.adaptionChangeReason){case"none":o[kB.Video_Send_Adaptation]=0;break;case"cpu":o[kB.Video_Send_Adaptation]=1;break;case"bandwidth":o[kB.Video_Send_Adaptation]=2;break;case"other":o[kB.Video_Send_Adaptation]=3}let r=0;a.adaptionChangeReason&&(r+=VB(a.adaptionChangeReason)),t.qualityLimitationReason&&(r+=VB(t.qualityLimitationReason)<<3),o[kB.Video_Send_Adaptation]=r,o[kB.Video_Send_Player_Status]=iD[n._player?n._player.videoElementStatus:"uninit"],UB(o,kB.Video_Send_Nacks,a.nacksCount),UB(o,kB.Video_Send_Plis,a.plisCount),UB(o,kB.Video_Send_Firs,a.firsCount),UB(o,kB.Video_Send_Avg_Encode,a.avgEncodeMs),UB(o,kB.Video_Send_Huge_Frame_Sent,a.hugeFramesSent),UB(o,kB.Video_Send_Bytes_Retransmit,a.retransmittedBytesSent),UB(o,kB.Video_Send_Packages_Retransmit,a.retransmittedPacketsSent),UB(o,kB.Video_Send_Key_Frames_Encoded,a.keyFramesEncoded);const c=i.videoSend.find((t=>t.ssrc===e));if(c){let e=OB*jB;c.timestamp&&a.timestamp&&(e=a.timestamp-c.timestamp),null!=c.packets&&null!=a.packets&&UB(o,kB.Video_Send_Package_Rate,1e3*(a.packets-c.packets)/e),null!=a.packetsLost&&null!=c.packetsLost&&UB(o,kB.Video_Send_Package_Lost,a.packetsLost-c.packetsLost),null!=c.bytes&&null!=a.bytes&&UB(o,kB.Video_Send_Bitrate,8*(a.bytes-c.bytes)/e)}}return o}(l[0].ssrcId,e,u,t,n),a="CameraVideoTrack"===u.__className__?3:Lr(d=u._hints).call(d,Fk.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==a||i)&&(this.needUploadStats={sendType:a},this.lastExtendStats.sendType=a);const o=u&&function(e,t,n,r){const i=t.videoSend.find((t=>t.ssrc===e));if(!i)return null;const a={};if(r){const e=i.inputFrame,t=e&&e.height||n.videoHeight||0,r=e&&e.width||n.videoWidth||0,o=e&&e.frameRate||0;UB(a,kB.Video_Capture_Height,t),UB(a,kB.Video_Capture_Width,r),UB(a,kB.Video_Capture_Frame_Rate,o)}return a}(l[0].ssrcId,e,u,!!n),c=function(e,t){const n={};return t&&(UB(n,kB.Video_Send_Retransmit,e.bitrate.retransmit),UB(n,kB.Video_Send_Target_Encoded,e.bitrate.targetEncoded),UB(n,kB.Video_Send_Actual_Encoded,e.bitrate.actualEncoded),UB(n,kB.Video_Send_Transmit,e.bitrate.transmit),UB(n,kB.Video_Send_Bandwidth,e.sendBandwidth)),n}(e,!!n);s=Object.assign({},r,o,c)}else c=function(e,t,n,r){const i=t.videoSend.find((t=>t.ssrc===e));if(!i)return;const a={};if(r){const t=i.sentFrame;t&&(UB(a,kB.Video_Send_Low_Height,t.height),UB(a,kB.Video_Send_Low_Width,t.width),UB(a,kB.Video_Send_Low_Frame_Rate,t.frameRate));const n=r.videoSend.find((t=>t.ssrc===e));if(n){let e=OB*PB;n.timestamp&&i.timestamp&&(e=i.timestamp-n.timestamp),null!=n.packets&&null!=i.packets&&UB(a,kB.Video_Send_Low_Package_Rate,1e3*(i.packets-n.packets)/e),null!=i.packetsLost&&null!=n.packetsLost&&UB(a,kB.Video_Send_Low_Package_Lost,i.packetsLost-n.packetsLost),null!=n.bytes&&null!=i.bytes&&UB(a,kB.Video_Send_Low_Bitrate,8*(i.bytes-n.bytes)/e)}}return a}(l[0].ssrcId,e,0,n);break;case bj.LocalAudioTrack:o=u&&function(e,t,n,r,i){const a=t.audioSend.find((t=>t.ssrc===e));if(!a)return;const o={};if(i){o[kB.Audio_Send_Disabled]=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?1:0;const t=100*n._source.getAccurateVolumeLevel(),r=a.inputLevel;if(null!=r){const e=Math.ceil(50*Math.log10(100*r+1));UB(o,kB.Audio_Send_Level,e)}UB(o,kB.Audio_Capture_PCM_Level,t),UB(o,kB.Audio_Send_AEC_Return_Loss,a.aecReturnLoss),UB(o,kB.Audio_Send_AEC_Return_Loss_Enhancement,a.aecReturnLossEnhancement),UB(o,kB.Audio_Send_Bytes_Retransmit,a.retransmittedBytesSent),UB(o,kB.Audio_Send_Packages_Retransmit,a.retransmittedPacketsSent),o[kB.Audio_Send_Freeze]=0;const s=i.audioSend.find((t=>t.ssrc===e));if(s){let e=OB*PB;s.timestamp&&a.timestamp&&(e=a.timestamp-s.timestamp),null!=s.bytes&&null!=a.bytes&&UB(o,kB.Audio_Send_Bitrate,8*(a.bytes-s.bytes)/e),null!=s.packets&&null!=a.packets&&UB(o,kB.Audio_Send_Package_Rate,1e3*(a.packets-s.packets)/e)}}return o}(l[0].ssrcId,e,u,0,n)}})),{high:s,low:c,audio:o}}getInboundStats(e,t,n,r){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],a=[];return i.forEach((i=>{let[o,s]=i;const c={peer:o.uid};if(s.has(mj.VIDEO)&&o.videoTrack){const i=o._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(o._videoSSRC)||!1,a=o.videoTrack?function(e,t,n,r,i,a,o,s){const c=t.videoRecv.find((t=>t.ssrc===e));if(!c)return;const u={},{receivedFrame:l,outputFrame:d,decodeFrameRate:f}=c;UB(u,DB.Video_Render_Frame_Rate_Decode,f),c.framesRateFirefox&&UB(u,DB.Video_Recv_Frame_Rate,c.framesRateFirefox),l&&UB(u,DB.Video_Recv_Frame_Rate,l.frameRate),UB(u,DB.Video_Recv_Frame_Dropped,c.framesDroppedCount),UB(u,DB.Video_Recv_Bytes_Retransmit,c.retransmittedBytesReceived),UB(u,DB.Video_Recv_Packages_Retransmit,c.retransmittedPacketsReceived),UB(u,DB.Video_Recv_Packages_Discarded,c.packetsDiscarded),UB(u,DB.Video_Recv_Avg_Decode,c.avgDecodeMs),UB(u,DB.Video_Recv_Avg_Processing_Delay,c.avgProcessingDelayMs),UB(u,DB.Video_Recv_Avg_Assembly_Time,c.avgFramesAssembledFromMultiplePacketsMs),UB(u,DB.Video_Recv_Avg_Inter_Frame_Delay,c.avgInterFrameDelayMs),UB(u,DB.Video_Recv_Key_Frames_Decoded,c.keyFramesDecoded);const h=s&&s.videoRecv.find((t=>t.ssrc===e));if(h){const e=t.timestamp-s.timestamp||OB;null!=c.packetsLost&&null!=h.packetsLost&&UB(u,DB.Video_Recv_Package_Lost,c.packetsLost-h.packetsLost),null!=h.bytes&&null!=c.bytes&&UB(u,DB.Video_Recv_Bitrate,8*(c.bytes-h.bytes)/e),null!=h.packets&&null!=c.packets&&UB(u,DB.Video_Recv_Package_Rate,1e3*(c.packets-h.packets)/e)}const p=a&&a.videoRecv.find((t=>t.ssrc===e));if(p&&(UB(u,AB.Video_Recv_Qp_Sum,c.qpSumPerFrame),u[AB.Video_Recv_Freeze]=r&&XU.isRemoteVideoFreeze(n,c,p)?1:0),o){var m;const t=o.videoRecv.find((t=>t.ssrc===e));l?(UB(u,kB.Video_Recv_Height,l.height),UB(u,kB.Video_Recv_Width,l.width)):n&&(UB(u,kB.Video_Recv_Height,n._videoHeight||0),UB(u,kB.Video_Recv_Width,n._videoWidth||0)),d&&UB(u,kB.Video_Recv_Frame_Rate_Output,d.frameRate);const r=null===(m=n._player)||void 0===m?void 0:m.rendFrameRate.toFixed(0);if(r&&UB(u,kB.Video_Render_Frame_Rate_Render,+r),UB(u,kB.Video_Recv_Jitter_Buffer,c.jitterBufferMs),UB(u,kB.Video_Recv_Current_Delay,c.currentDelayMs),UB(u,kB.Video_Recv_Firs,c.firsCount),UB(u,kB.Video_Recv_Nacks,c.nacksCount),UB(u,kB.Video_Recv_Plis,c.plisCount),n){u[kB.Video_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1;const e=n._player;if(e){const{freezeTimeCounterList:n,renderFreezeAccTime:r,renderFreezeAccTime2:a,videoElementStatus:o}=e;if(n&&n.length>0&&UB(u,AB.Video_Render_Freeze_Time,n.splice(0,1)[0]),i&&"visible"===ZL.visibility&&o===nD.PLAYING&&vk().supportRequestVideoFrameCallback){const t=Math.min(6e3,a);e.renderFreezeAccTime2=Math.max(0,a-t),UB(u,AB.Video_Render_Freeze_Time_Render2,t);const n=Math.min(6e3,r);e.renderFreezeAccTime=Math.max(0,r-n),UB(u,AB.Video_Render_Freeze_Time_Render,IA("USE_NEW_RENDER_FREEZE_TIME")?t:n)}if("number"==typeof c.totalFreezesDuration){const e=t&&t.totalFreezesDuration?c.totalFreezesDuration-t.totalFreezesDuration:c.totalFreezesDuration;UB(u,kB.Video_Render_Freeze_Duration,1e3*e)}}}if(u[kB.Video_Recv_Player_Status]=iD[n._player?n._player.videoElementStatus:"uninit"],t&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==t.totalInterFrameDelay&&void 0!==t.totalSquaredInterFrameDelay){const e=c.totalInterFrameDelay-t.totalInterFrameDelay,n=c.totalSquaredInterFrameDelay-t.totalSquaredInterFrameDelay,r=c.framesDecodeCount-t.framesDecodeCount,i=e/r*1e3,a=Math.round(1e3*Math.sqrt((n-Math.pow(e,2)/r)/r));!isNaN(a)&&i+a>Math.max(3*i,i+150)&&(u[kB.Video_Recv_I_Frame_Delay]=a)}}return u}(o._videoSSRC,e,o.videoTrack,!0===i,this.needUploadRenderFreezeTime,t,n,r):void 0;a&&(c.video=a)}if(s.has(mj.AUDIO)&&o.audioTrack){const i=o.audioTrack?function(e,t,n,r,i,a){const o=t.audioRecv.find((t=>t.ssrc===e));if(!o)return;const s={};UB(s,DB.Audio_Recv_Jitter,o.jitterMs),UB(s,DB.Audio_Recv_Bytes_Retransmit,o.retransmittedBytesReceived),UB(s,DB.Audio_Recv_Packages_Retransmit,o.retransmittedPacketsReceived),UB(s,DB.Audio_Recv_Packages_Discarded,o.packetsDiscarded),UB(s,DB.Audio_Recv_Avg_Processing_Delay,o.avgProcessingDelayMs);const c=a&&a.audioRecv.find((t=>t.ssrc===e));if(c){const e=OB;null!=o.packets&&null!=c.packets&&UB(s,DB.Audio_Recv_Package_Rate,1e3*(o.packets-c.packets)/e),null!=o.packetsLost&&null!=c.packetsLost&&UB(s,DB.Audio_Recv_Package_Lost,o.packetsLost-c.packetsLost)}if(r){const{receivedFrames:e,droppedFrames:t}=o;null!=e&&null!=t&&(s[AB.Audio_Recv_Freeze]=0===(u=e)||100*t/u>20?1:0)}var u;if(i){const t=100*n._source.getAccurateVolumeLevel(),r=o.outputLevel;if(null!=r){const e=Math.ceil(50*Math.log10(100*r+1));UB(s,kB.Audio_Render_Level,e)}UB(s,kB.Audio_Recv_PCM_Level,t),n&&(s[kB.Audio_Recv_Disabled]=n._originMediaStreamTrack.enabled&&n._mediaStreamTrack.enabled?0:1),UB(s,kB.Audio_Recv_Jitter_Buffer,o.jitterBufferMs),UB(s,kB.Audio_Recv_Current_Delay,o.jitterBufferMs),s[kB.Audio_Recv_Player_Status]=iD[FD.getPlayerState(n.getTrackId())];const a=i.audioRecv.find((t=>t.ssrc===e));if(a){null!=a.bytes&&null!=o.bytes&&UB(s,kB.Audio_Recv_Bitrate,8*(o.bytes-a.bytes)/(OB*jB));const e=o.concealedSamples-a.concealedSamples;e>0&&UB(s,kB.Audio_Recv_Concealed_Samples,e);const t=o.totalSamplesReceived-a.totalSamplesReceived;t>0&&UB(s,kB.Audio_Recv_Total_Samples_Received,t);const n=o.freezeSamples80-a.freezeSamples80;n>0&&UB(s,kB.Audio_Render_Freeze_Samples_80ms,n);const r=o.freezeSamples200-a.freezeSamples200;r>0&&UB(s,kB.Audio_Render_Freeze_Samples_200ms,r);const i=o.freezeMs80-a.freezeMs80;UB(s,kB.Audio_Render_Freeze_Time_80ms,i<0?0:i);const c=o.freezeMs200-a.freezeMs200;UB(s,kB.Audio_Render_Freeze_Time_200ms,c<0?0:c)}}return s}(o._audioSSRC,e,o.audioTrack,t,n,r):void 0;i&&(c.audio=i)}(c.video||c.audio)&&a.push(c)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,a}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find((e=>e instanceof VM));if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(FP.DENOISER_STATS,t)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach((e=>{e.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach((e=>{let[t,n]=e;n.has(mj.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})),n.has(mj.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const t=Date.now(),n={connectionInterval:IA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let r=[];const i=this.requestAllTracks&&this.requestAllTracks()||[];for(const e of i)!e.muted&&e.enabled&&(r=r.concat(await e.getProcessorUsage()));const a=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[e,c]of a)c.has(mj.VIDEO)&&e.videoTrack&&(r=r.concat(await e.videoTrack.getProcessorUsage())),c.has(mj.AUDIO)&&e.audioTrack&&(r=r.concat(await e.audioTrack.getProcessorUsage()));if(0===r.length)return;n.details=function(e,t){const n={};for(const{id:o,value:s,level:c,direction:u}of e){var r;const e=null!==(r=t.get(o))&&void 0!==r?r:0,l=2===s?e+IA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,a;t.set(o,l),n[o]?(2===s&&(n[o].value=s),c>n[o].level&&(n[o].level=c),"remote"===u&&(n[o].remoteUidCount+=1),n[o].totalTs=null!==(i=t.get(o))&&void 0!==i?i:0):n[o]={value:s,level:c,remoteUidCount:"local"===u?0:1,totalTs:null!==(a=t.get(o))&&void 0!==a?a:0}}return Object.keys(n).map((e=>{const{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}}))}(r,e);const o=Date.now(),s=o>t?o:t+1;this.requestUpload&&this.requestUpload(FP.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:s})}),IA("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const WB=IA("ICE_RESTART_INTERVAL");let GB=new Map,HB=new Map,YB=[gj.UDP_TCP_RELAY,gj.TCP_RELAY,gj.RELAY],qB=IA("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&vk().supportPCSetConfiguration;function KB(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=GB.get(e.id);n&&(window.clearTimeout(n),GB.delete(e.id));const r=HB.get(e.id);t&&r&&r.index===YB.length-1&&(ok.debug("[".concat(e.id,"] reset ICE restart policy")),HB.delete(e.id))}function XB(e,t,n){if(0===GB.size&&0===HB.size&&(Array.isArray(IA("RESTART_SEQUENCE"))&&IA("RESTART_SEQUENCE").length>0&&!function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1){const r=e[n];if(e.filter((e=>e===r)).length!==t.filter((e=>e===r)).length)return!1}return!0}(YB,IA("RESTART_SEQUENCE"))&&(YB=IA("RESTART_SEQUENCE").filter((e=>{var t;if(Lr(t=Object.values(gj)).call(t,e))return!0})),ok.debug("use reconnection policy from config distribution, queues: ".concat(YB.join(" => ")))),qB=IA("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&vk().supportPCSetConfiguration),0===YB.length)return void n();let r,{index:i=0,type:a}=HB.get(e.id)||{};if(qB&&a===gj.RELAY)return void n();let o=a&&i>=YB.length-1;if(qB)a=gj.RELAY;else{if(o)return void n();a?(i++,a=YB[i]):(a=YB[0],i=0)}ok.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(a,", index: ").concat(i)),t(a),HB.set(e.id,{index:i,type:a}),r=window.setTimeout((()=>XB(e,t,n)),WB),GB.set(e.id,r)}var QB;function JB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ZB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JB(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $B(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=ZT,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new eV(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function eV(e){function t(e){if(Object(e)!==e)return rh.reject(new TypeError(e+" is not an object."));var t=e.done;return rh.resolve(e.value).then((function(e){return{value:e,done:t}}))}return eV=function(e){this.s=e,this.n=e.next},eV.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?rh.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?rh.reject(e):t(n.apply(this.s,arguments))}},new eV(e)}let tV=(QB=class extends GI{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(wj.StateChange,t,this._state)}constructor(e,t){super(),dx(this,"isPlanB",void 0),dx(this,"store",void 0),dx(this,"statsUploader",void 0),dx(this,"connection",void 0),dx(this,"localTrackMap",new Map),dx(this,"remoteUserMap",new Map),dx(this,"localDataChannels",[]),dx(this,"remoteDataChannelMap",new Map),dx(this,"pendingLocalTracks",[]),dx(this,"pendingRemoteTracks",[]),dx(this,"pendingLocalDataChannels",[]),dx(this,"pendingRemoteDataChannels",[]),dx(this,"statsCollector",void 0),dx(this,"shouldForwardP2PCreation",void 0),dx(this,"iceFailedCount",0),dx(this,"dtlsFailedCount",0),dx(this,"mutex",void 0),dx(this,"_state",_j.Disconnected),dx(this,"_pcStatsUploadType",IA("NEW_ICE_RESTART")?vj.FIRST_CONNECTION:vj.OLD_FIRST_CONNECTION),dx(this,"_isStartRestartIce",!1),dx(this,"_restartTimer",void 0),dx(this,"_isTryConnecting",!1),dx(this,"_iceError",null),dx(this,"_forceTurn",!1),dx(this,"_isWaitPcToRePub",!1),dx(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==_j.Connected)return void n(new NI(II.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));if(i){const e=i[1];this.store.enableInstantMuteRestore?(e.track._originMediaStreamTrack.enabled=!1,ok.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):e.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?ok.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const a=this.createMuteMessage(r);await oN(this,wj.RequestMuteLocal,a),t()}catch(e){n(e)}finally{r()}})),dx(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==_j.Connected)return void n(new NI(II.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));if(i){const t=i[1];if(this.store.enableInstantMuteRestore)t.track._originMediaStreamTrack.enabled=!0,ok.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(t.track._originMediaStreamTrack.stop(),!IA("DISABLE_DUAL_STREAM_USE_ENCODING")&&vk().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=IB(e,cN(this,wj.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new rh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}this.store.enableInstantMuteRestore?ok.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const a=this.createUnmuteMessage(r);await oN(this,wj.RequestUnmuteLocal,a),t()}catch(e){n(e)}finally{r()}})),dx(this,"handleUpdateVideoEncoder",(async(e,t,n,r)=>{let i;r||(i=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get(bj.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==_j.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),await this.connection.updateEncoderConfig(r,i),this.emit(wj.UpdateVideoEncoder,i),t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}})),dx(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(bj.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==_j.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),dx(this,"handleReplaceMixingTrack",(async(e,t,n,r)=>{if(!this.connection||this.state!==_j.Connected)return void t();const i=yB([e]);let a;ok.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(i.getTrackId(),"]")),"boolean"==typeof r&&r||(a=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,i),t()}catch(e){n(e)}finally{var o;null===(o=a)||void 0===o||o()}})),dx(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;ok.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var a;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.connection||!n||this.state!==_j.Connected)return void t();if(await(null===(a=this.connection)||void 0===a?void 0:a.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===bj.LocalVideoTrack&&!IA("DISABLE_DUAL_STREAM_USE_ENCODING")&&vk().supportDualStreamEncoding){const t=this.localTrackMap.get(bj.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new rh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var o;null===(o=i)||void 0===o||o()}})),dx(this,"handleGetRTCStats",(e=>{e(this.statsCollector.getRTCStats())})),dx(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),dx(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),dx(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),dx(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new zB(this.store),this.bindStatsUploaderEvents(),this.mutex=new FN("P2PChannel-mutex",this.store.clientId),this.isPlanB=!vk().supportUnifiedPlan||IA("CHROME_FORCE_PLAN_B")&&EI(),this.shouldForwardP2PCreation=IA("FORWARD_P2P_CREATION")&&vk().supportPCSetConfiguration&&wI(),this.shouldForwardP2PCreation&&(this.connection=_B(this.store),this.emit(wj.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=_j.New,this._forceTurn=EB(e),ok.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const r=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState);if((!this.shouldForwardP2PCreation||r||t)&&((r||t)&&this.connection&&(ok.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=_B(this.store,e),this.emit(wj.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new NI(II.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=IA("NEW_ICE_RESTART")?vj.FIRST_CONNECTION:vj.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new NI(II.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===_j.Connected){if(this.connection instanceof TB&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return ok.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),pk.reportApiInvoke(this.store.sessionId,{name:qI.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:KI.TRACER}).onSuccess(),void setTimeout((()=>{this.emit(wj.RequestReconnect)}));await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=_j.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((e=>{var t;let[n]=e;return Lr(t=[bj.LocalVideoLowTrack,bj.LocalVideoTrack]).call(t,n)})),n=t.map((e=>{let[,{id:t}]=e;return t})),r=t.map((e=>{let[t]=e;return t}));if(this.connection instanceof TB){if(pk.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Lr(e).call(e,this.store.codec)){const t=["vp9","vp8","h264"].find((t=>Lr(e).call(e,t)));t&&(this.store.codec=t,ok.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof TB&&"closed"!==this.connection.peerConnectionState&&Lr(e=[_j.New,_j.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==_j.Connected){if(this.state===_j.Disconnected)throw new NI(II.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach((e=>{var t;Lr(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)})),[]}const t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach((e=>{const t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((e=>{this.localDataChannels.push(e);const t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)})),e.map((e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId}))))}publish(e,t,n){var r=this;return KT((function*(){const i=yield QT(r.mutex.lock("From P2PChannel.publish"));try{var a;const i=r.connection&&Lr(a=["disconnected","failed"]).call(a,r.connection.peerConnectionState);if(!r.connection||r.state!==_j.Connected||i){if(r.state===_j.Disconnected)throw new NI(II.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return r.pendingLocalTracks=r.pendingLocalTracks.concat(t),void(i&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,YU.markPublishStart(r.store.clientId,r.store.pubId);const o=r.filterTobePublishedTracks(e,t,n);if(0===o.length)return void(yield QT(r.tryToUnmuteAudio(e)));yield*JT($B(r.doPublish(r.connection,o)))}finally{i()}}))()}doPublish(e,t){var n=this;return KT((function*(){t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===bj.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t);const r=t.map((e=>{let{track:t}=e;return t})),i=yield QT(e.send(r,n.store.codec,n.store.audioCodec)),a=(yield QT(i.next())).value,o=n.createGatewayPublishMessage(t,a);let s;try{s=yield o}catch(e){throw i.throw(e),(null==e?void 0:e.code)===II.WS_ABORT&&t.forEach((e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),e}const c=n.mapPubResToRemoteConfig(o,s,r),u=(yield QT(i.next(c))).value;if(n.state===_j.Disconnected)throw new NI(II.UNEXPECTED_ERROR,"PeerConnection already disconnected.");IA("ENABLE_VIDEO_SEI");const l=IA("ENABLE_ENCODED_TRANSFORM"),d=IA("ENABLE_AUDIO_METADATA");r.forEach((async e=>{const t=e.getRTCRtpTransceiver();if(!t||!l)return;const{interceptLocalVideoFrame:n,interceptLocalAudioFrame:r}=ZF();e.trackMediaType===mj.VIDEO?await n(t.sender,e):e.trackMediaType===mj.AUDIO&&await r(t.sender,{metadata:d?()=>{const t=e.metadata.shift();return t&&t.value}:void 0})})),t.forEach((e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,u),n.statsUploader.startUploadOutboundStats(),t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===bj.LocalAudioTrack?"audio":"video",void 0,i)}))}))()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof LL))return ok.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:r}=n,i=function(e,t){const n={};return e.height&&e.width&&(n.scaleResolutionDownBy=lF(e,t)),n.maxFramerate=e.framerate?aF(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==bj.LocalVideoLowTrack||!IA("DISABLE_DUAL_STREAM_USE_ENCODING")&&vk().supportDualStreamEncoding)null!=i.scaleResolutionDownBy&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const t=r._originMediaStreamTrack;if(!t.canvas)return ok.warn("[".concat(r.getTrackId(),"] no canvas on track"));!function(e,t){const n=e.canvas;t.width&&(n.width=aF(t.width)),t.height&&(n.height=aF(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=yD((()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()}),aF(t.framerate)))}(t,e)}null!=i.maxBitrate&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),null!=i.maxFramerate&&(r._encoderConfig.frameRate&&"object"==typeof r._encoderConfig.frameRate?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),ok.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return KT((function*(){if(!t.connection||t.state!==_j.Connected)return;const n=yield QT(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const n=t.localTrackMap.get(bj.LocalVideoTrack);if(!n)throw new NI(II.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(bj.LocalVideoLowTrack))throw new NI(II.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const i=[{track:t.getLowVideoTrack(n.track,e),type:bj.LocalVideoLowTrack}];if(yield*JT($B(t.doPublish(t.connection,i))),n.track.muted||!n.track.enabled){var r;const e=null===(r=t.localTrackMap.get(bj.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield QT(t.connection.muteLocal([e])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(ok.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await aN(this,wj.RequestRePublish,this.pendingLocalTracks),this.emit(wj.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(ok.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await aN(this,wj.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==mj.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==mj.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await aN(this,wj.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===mj.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((e=>{let{user:t}=e;this.emit(wj.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==_j.Connected)return void e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==_j.Connected)return void e.forEach((e=>{const t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach((e=>{const t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)})),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map((e=>e.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==_j.Connected)return;const e=this.localTrackMap.get(bj.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[bj.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==_j.Connected)throw new NI(II.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter((t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))}));if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach((t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));const r=this.pendingRemoteDataChannels.findIndex((n=>{let{user:r,id:i}=n;return r.uid===e.uid&&i===t.id}));-1!==r&&this.pendingRemoteDataChannels.splice(r,1)})),n.map((e=>e.id))}async subscribe(e,t,n,r,i){var a;if(!this.connection||this.state!==_j.Connected)throw new NI(II.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(a=this.remoteUserMap.get(e))&&void 0!==a&&a.has(t))return;let o,s,c,u;const l=this.connection.getPreMedia(n);if(l)ok.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),c=l.transceiver,o=l.track,s=l.mid,u=l.player,l.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:l.firstVideoRender});else if(i){const n=i.find((e=>{let{stream_type:n}=e;return n===t}));if(!n)throw new NI(II.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof TB&&(c=r.transceiver),o=r.track,s=r.id}else{const i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof TB&&(c=i.transceiver),o=i.track,s=i.id}if(t===mj.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new JL(o,e.uid,e._uintid,this.store),ok.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new QL(o,e.uid,e._uintid,this.store,u),ok.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Gk.PLAY_START,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})})),e._videoTrack.once(Gk.PLAY_END,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)})),u?e._videoTrack.once(Gk.FIRST_FRAME_RENDER,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})):e._videoTrack.once(Gk.FIRST_FRAME_DECODED,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),c&&IA("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:n,interceptRemoteAudioFrame:r}=ZF();t==mj.VIDEO?await n(c.receiver,{onSei:IA("ENABLE_VIDEO_SEI")&&(t=>{var n;return null===(n=e._videoTrack)||void 0===n?void 0:n._onSei(t)})}):t==mj.AUDIO&&await r(c.receiver,{enableTopn:!!IA("ENABLE_AUDIO_TOPN"),enableMetadata:!!IA("ENABLE_AUDIO_METADATA"),enablePts:!!IA("ENABLE_AUDIO_PTS"),onMetadata:e=>{this.safeEmit(wj.AudioMetadata,e)},onPts:e=>{this.safeEmit(wj.AudioPts,e)}})}const d=this.remoteUserMap.get(e);d?d.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const f=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==f&&(this.pendingRemoteTracks.splice(f,1),this.emit(wj.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==_j.Connected)throw new NI(II.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))}));const t=[],n=new Map;e.forEach((e=>{if(!this.connection)return;const r=this.connection.getPreMedia(e.ssrcId);if(r){const{track:t,mid:i,transceiver:a,player:o}=r;n.set(e.ssrcId,{track:t,id:i,transceiver:a,player:o})}else t.push(e)}));const r=await this.connection.batchReceive(t.map((e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}})));t.forEach(((e,t)=>{n.set(e.ssrcId,r[t])}));for(const{user:i,mediaType:a,ssrcId:o}of e){const e=n.get(o);if(!e)return void ok.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(a,", ").concat(o));const{track:t,id:r,transceiver:s,player:c}=e;if(s&&IA("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=ZF();a==mj.VIDEO?await e(s.receiver,{onSei:IA("ENABLE_VIDEO_SEI")&&(e=>{var t;return null===(t=i._videoTrack)||void 0===t?void 0:t._onSei(e)})}):a==mj.AUDIO&&await t(s.receiver,{enableTopn:!!IA("ENABLE_AUDIO_TOPN"),enableMetadata:!!IA("ENABLE_AUDIO_METADATA"),enablePts:!!IA("ENABLE_AUDIO_PTS"),onMetadata:e=>{this.safeEmit(wj.AudioMetadata,e)},onPts:e=>{this.safeEmit(wj.AudioPts,e)}})}if(a===mj.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(t):(i._audioTrack=new JL(t,i.uid,i._uintid,this.store),ok.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),s&&i._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(t):(i._videoTrack=new QL(t,i.uid,i._uintid,this.store,c),ok.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),s&&i._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(i,i._videoTrack)),IA("ENABLE_VIDEO_SEI")&&s){const{interceptRemoteVideoFrame:e,interceptRemoteAudioFrame:t}=ZF();a==mj.VIDEO?await e(s.receiver,{onSei:e=>{var t;null===(t=i._videoTrack)||void 0===t||t._onSei(e)}}):a==mj.AUDIO&&await t(s.receiver)}const u=this.remoteUserMap.get(i);u?u.set(a,r):this.remoteUserMap.set(i,new Map([[a,r]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();const l=this.pendingRemoteTracks.findIndex((e=>{let{user:t,kind:n}=e;return t.uid===i.uid&&a===n}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(wj.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===_j.Connected||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===mj.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===mj.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==_j.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t})));const a=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),i.forEach((e=>{let[t,{kind:r}]=e;var i,a;if(r===mj.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===mj.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(a=t._videoTrack)||void 0===a||a._destroy(),t._videoTrack=void 0);else if(r===mj.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0)}})),a}async unsubscribeDataChannel(e,t){if(t.forEach((e=>{const t=this.pendingRemoteDataChannels.findIndex((t=>t.id===e.id));-1!==t&&this.pendingRemoteDataChannels.splice(t,1)})),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach((e=>{e._close()}));const r=this.remoteDataChannelMap.get(e);return n.forEach((e=>{r&&r.delete(e.id)})),r&&0===r.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map((e=>e.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:a}of e){const e=this.pendingRemoteTracks.filter((e=>{let{user:t,kind:n}=e;return void 0!==a?t.uid===i.uid&&a===n:t.uid===i.uid}));e.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),t=t.concat(e)}if(!this.connection||this.state!==_j.Connected)return void t.forEach((e=>{let{user:t,kind:n}=e;var r;if(n===mj.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===mj.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}}));const n=ii(e).call(e,((e,t)=>{let{user:n,mediaType:r}=t;const i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]);if(0===n.length)return;await this.connection.stopReceiving(n.map((e=>{let[,{id:t}]=e;return t})));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach((e=>{let[t,{kind:n}]=e;var r,i;if(n===mj.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===mj.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===mj.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0}})),r}isPreSubScribe(e){return!(!this.connection||this.state!==_j.Connected)&&!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void ok.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void ok.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===mj.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||ok.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):ok.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(bj.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(bj.LocalAudioTrack);if((null==t?void 0:t.track)instanceof WM){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==bj.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===bj.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===bj.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(bj.LocalAudioTrack),a=r?this.localTrackMap.get(bj.LocalVideoLowTrack):this.localTrackMap.get(bj.LocalVideoTrack);pk.publish(this.store.sessionId,{eventElapse:YU.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==a?void 0:a.track.getTrackLabel(),screenshare:-1!==(null==a?void 0:a.track._hints.indexOf(Fk.SCREEN_TRACK)),audio:!!n,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var a;n||(n=[]);const o=n.find((e=>e instanceof BM)),s=r?null===(a=this.localTrackMap.get(bj.LocalVideoTrack))||void 0===a?void 0:a.track:n.find((e=>e instanceof LL));pk.publish(this.store.sessionId,{eventElapse:YU.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==o?void 0:o.getTrackLabel(),videoName:null==s?void 0:s.getTrackLabel(),screenshare:-1!==(null==s?void 0:s._hints.indexOf(Fk.SCREEN_TRACK)),audio:!!o,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===mj.VIDEO?n._videoSSRC:n._audioSSRC;i&&pk.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===mj.VIDEO,audio:r===mj.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:YU.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){ok.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new FN("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=_B(this.store),this.emit(wj.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(bj.LocalAudioTrack);if((null==e?void 0:e.track)instanceof WM){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=_j.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(bj.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(bj.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof LL||t&&t.track instanceof BM?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(bj.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Qh(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.connection&&(ok.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=_j.Reconnecting,IA("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=_B(this.store),this.emit(wj.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case bj.LocalVideoTrack:Lr(t=r._hints).call(t,Fk.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case bj.LocalAudioTrack:r instanceof WM?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case bj.LocalVideoLowTrack:}})),this.emit(wj.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(XA(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(wj.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,n]=e;Array.from(XA(n).call(n)).forEach((e=>{this.setPendingRemoteDataChannel(t,e)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),ok.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof ZU?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof ZU?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return KT((function*(){if(!t.connection||t.state!==_j.Connected)return;const n=yield QT(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield QT(t.connection.restartICE(e));const n=yield QT(r.next());if(n.done)return;const i=n.value,a=yield i;switch(wB(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case gj.UDP_TCP_RELAY:t._pcStatsUploadType=vj.UDP_TCP_RESTART;break;case gj.TCP_RELAY:t._pcStatsUploadType=vj.TCP_RESTART;break;case gj.RELAY:t._pcStatsUploadType=vj.RELAY_RESTART;break;default:t._pcStatsUploadType=vj.OLD_RESTART}t._isTryConnecting=!0,r.next(a)}catch(e){var i;null===(i=r)||void 0===i||i.throw(e)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(bj.LocalVideoTrack),n=this.localTrackMap.get(bj.LocalAudioTrack),r=e.videoSend.find((e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId))),i=e.audioSend.find((e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)));if(!r||!i)return 1;const a=sN(this,wj.NeedSignalRTT),o=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=o&&s?(o+s)/2:o||s,u=(c&&a?(c+a)/2:c||a)||0,l=100*e.sendPacketLossRate*.7/50+.3*u/1500,d=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,f=null==t?void 0:t.track;if(f&&f._encoderConfig&&-1===f._hints.indexOf(Fk.SCREEN_TRACK)){const t=f._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return zO[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,a=r._videoSSRC,o=e.audioRecv.find((e=>e.ssrc===i)),s=e.videoRecv.find((e=>e.ssrc===a));if(!o&&!s)return void(t+=1);const c=sN(this,wj.NeedSignalRTT),u=e.rtt,l=(u&&c?(u+c)/2:u||c)||0,d=o?o.jitterMs:void 0,f=e.recvPacketLossRate;let h=.7*f*100/50+.3*l/1500;d&&(h=.6*f*100/50+.2*l/1500+.2*d/400),t+=h<.1?1:h<.17?2:h<.36?3:h<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new rh(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}async replaceTrack(e,t){var n;if(ok.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==_j.Connected)return;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await(null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const e=r[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,e)}if(i===bj.LocalVideoTrack&&!IA("DISABLE_DUAL_STREAM_USE_ENCODING")&&vk().supportDualStreamEncoding){const t=this.localTrackMap.get(bj.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new rh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=dN(e=e.filter((e=>-1===i.indexOf(e))));let a,o=!1;const s=this.localTrackMap.get(bj.LocalAudioTrack);for(const c of e){if(c instanceof LL&&(this.localTrackMap.has(bj.LocalVideoTrack)||o?new NI(II.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:bj.LocalVideoTrack}),o=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:bj.LocalVideoLowTrack})}if(c instanceof BM)if(s){const e=s.track;if(e instanceof WM)vB([c]),e.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const t=yB([e,c]);ok.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else a instanceof WM?(vB([c]),a.addAudioTrack(c)):a=a||!c._useAudioElement&&vk().webAudioMediaStreamDest&&!c._bypassWebAudio?yB(a?[c,a]:[c]):c}return a&&(ok.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(a.getTrackId(),"]")),r.push({track:a,type:bj.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=dN(e=e.filter((e=>-1!==n.indexOf(e))));for(const r of e){if(r instanceof BM){const e=this.localTrackMap.get(bj.LocalAudioTrack);if(!e)continue;e.track instanceof WM?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([bj.LocalAudioTrack,e]),e.track.close())):t.push([bj.LocalAudioTrack,e])}if(r instanceof LL){const e=this.localTrackMap.get(bj.LocalVideoTrack);if(!e)continue;t.push([bj.LocalVideoTrack,e]);const n=this.localTrackMap.get(bj.LocalVideoLowTrack);n&&t.push([bj.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=dN(e)).filter((e=>-1===this.localDataChannels.findIndex((t=>t.id===e.id))))}filterTobeUnpublishedDataChannels(e){return(e=(e=dN(e)).filter((e=>-1!==this.localDataChannels.indexOf(e)))).filter((e=>e._originDataChannel))}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case bj.LocalVideoTrack:t.addListener(jk.GET_STATS,this.handleGetLocalVideoStats),t.addListener(jk.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(jk.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(jk.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(jk.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case bj.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case bj.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof WM?e.trackList.forEach((e=>{e.addListener(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(jk.GET_STATS,this.handleGetLocalAudioStats),e.addListener(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(jk.GET_STATS,this.handleGetLocalAudioStats),e.addListener(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(jk.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(jk.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case bj.LocalVideoTrack:t.off(jk.GET_STATS,this.handleGetLocalVideoStats),t.off(jk.GET_RTC_STATS,this.handleGetRTCStats),t.off(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(jk.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(jk.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(jk.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case bj.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case bj.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof WM?e.trackList.forEach((e=>{e.off(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(jk.GET_STATS,this.handleGetLocalAudioStats),e.off(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(jk.GET_STATS,this.handleGetLocalAudioStats),e.off(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(jk.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(jk.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof QL&&t.addListener(jk.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof JL&&t.addListener(jk.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(jk.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(mj.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(mj.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,a,{track:o,type:s}=e;switch(s){case bj.LocalAudioTrack:i=rj.Audio,a={dtx:o instanceof VM&&o._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case bj.LocalVideoTrack:i=Lr(r=o._hints).call(r,Fk.SCREEN_TRACK)?rj.Screen:rj.High,a=ZB(ZB({},oF(o)),{},{codec:this.store.codec,svc_mode:hF()});break;case bj.LocalVideoLowTrack:i=rj.Low,a=ZB(ZB({},oF(o)),{},{codec:this.store.codec,svc_mode:hF()})}return{stream_type:i,attributes:a,ssrcs:t[n]}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case bj.LocalVideoTrack:n=Lr(t=i._hints).call(t,Fk.SCREEN_TRACK)?rj.Screen:rj.High;break;case bj.LocalAudioTrack:n=rj.Audio;break;case bj.LocalVideoLowTrack:n=rj.Low}return{stream_type:n,ssrcs:a,mid:o}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(wj.PeerConnectionStateChange,t),"connecting"===t&&e instanceof TB&&!nI()&&IA("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{"connecting"===t&&e.extendCandidate()}),IA("FIRST_TCP_CANDIDATE_INTERVAL")),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof TB&&KB(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=vj.DISCONNECTED_OR_FAILED,"CONNECTED"===sN(this,wj.QueryClientConnectionState)&&this._isWaitPcToRePub)){const e=this.pendingLocalTracks.map((e=>e.getTrackId())),t=this.pendingLocalDataChannels.map((e=>"dc_".concat(e.id)));pk.reportApiInvoke(this.store.sessionId,{name:qI.REPUB_AFTER_PC_CONNECTED,options:e.concat(t),tag:KI.TRACER}).onSuccess(),this.republish()}if(IA("NEW_ICE_RESTART")&&e instanceof TB&&!nI()&&!this._forceTurn){if(Lr(yj).call(yj,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{wB(e)&&(ok.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(t)),"CONNECTED"===sN(this,wj.QueryClientConnectionState)&&this.emit(wj.RequestRestartICE,t))},n=()=>{wB(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),ok.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(wj.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{XB(e,t,n)}),800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout((()=>{"disconnected"===e.iceConnectionState&&IA("ICE_RESTART")&&"CONNECTED"===sN(this,wj.QueryClientConnectionState)&&this.emit(wj.RequestRestartICE)}),800),void setTimeout((()=>{"disconnected"===e.peerConnectionState&&(ok.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(wj.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);"failed"===t&&(ok.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(wj.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),pk.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:KI.TRACER}).onSuccess(),this.emit(wj.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(Gk.FIRST_FRAME_DECODED),pk.firstRemoteFrame(this.store.sessionId,lk.FIRST_AUDIO_DECODE,dk.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:YU.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&pk.firstRemoteFrame(this.store.sessionId,lk.FIRST_AUDIO_RECEIVED,dk.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:YU.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{var r;const i=Array.from(XA(r=this.remoteUserMap).call(r)).find((t=>t._videoSSRC===e));i&&this.store.firstVideoFrameDecoded(i.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoRender=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&(this.store.firstVideoFrameDecoded(n.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(n))},e.onFirstVideoReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&(this.store.firstVideoFrameDecoded(n.uid,{firstReceived:Date.now()}),pk.firstRemoteFrame(this.store.sessionId,lk.FIRST_VIDEO_RECEIVED,dk.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:YU.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(wj.ConnectionTypeChange,n),ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(dF(t))," -> ").concat(JSON.stringify(dF(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(dF(t))," -> ").concat(JSON.stringify(dF(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return ZB(ZB({},e),t)},e.onICECandidateError=e=>{this._iceError=e}}resetConnection(e){e instanceof TB&&function(e){HB.delete(e.id),KB(e)}(e),e.close(),this.emit(wj.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(bj.LocalAudioTrack);if(e instanceof BM&&(null==n?void 0:n.track)instanceof WM)return n.track.isActive||t.push([bj.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===bj.LocalVideoTrack)){const e=this.localTrackMap.get(bj.LocalVideoLowTrack);e&&t.push([bj.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(bj.LocalAudioTrack);if(e instanceof BM&&(null==n?void 0:n.track)instanceof WM)return n.track.isActive&&t.push([bj.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===bj.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(bj.LocalVideoLowTrack);e&&t.push([bj.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case bj.LocalAudioTrack:n=rj.Audio;break;case bj.LocalVideoTrack:n=Lr(t=i._hints).call(t,Fk.SCREEN_TRACK)?rj.Screen:rj.High;break;case bj.LocalVideoLowTrack:n=rj.Low}return{stream_type:n,ssrcs:a,mid:o}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case bj.LocalAudioTrack:n=rj.Audio;break;case bj.LocalVideoTrack:n=Lr(t=i._hints).call(t,Fk.SCREEN_TRACK)?rj.Screen:rj.High;break;case bj.LocalVideoLowTrack:n=rj.Low}return{stream_type:n,ssrcs:a,mid:o}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach((t=>{var r;null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.has(t.id)&&n.push(t)})),n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case mj.VIDEO:return void(n._videoSSRC&&t.push({stream_type:mj.VIDEO,ssrcId:n._videoSSRC}));case mj.AUDIO:return void(n._audioSSRC&&t.push({stream_type:mj.AUDIO,ssrcId:n._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);r===mj.VIDEO?e|=oj.Video:e|=oj.Audio,t.set(n,e)}else r===mj.VIDEO?t.set(n,oj.Video):t.set(n,oj.Audio)})),{users:Array.from(t.entries()).map((e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}}))}}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(bj.LocalVideoTrack),n=this.localTrackMap.get(bj.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new rh(((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new rh(((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)})))}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}isPreallocation(){return this.connection instanceof TB&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof TB&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map(((e,r)=>{var i;let{stream_type:a}=e;const o=null===(i=t.find((e=>{let{stream_type:t}=e;return a===t})))||void 0===i?void 0:i.attributes;if(o&&IA("DISABLE_SCREEN_SHARE_REMB")){const e=n[r]._hints;(Lr(e).call(e,Fk.SCREEN_TRACK)||Lr(e).call(e,Fk.SCREEN_LOW_TRACK))&&(o.remb=!1,ok.debug("disable remb for screen share, hints:",e))}return o}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof BM){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t}))));const i=this.createUnmuteMessage(r);return void await oN(this,wj.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(wj.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(wj.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:(null===(e=this.connection)||void 0===e?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await CN(VN(this.dtlsFailedCount,BN)),this.emit(wj.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await aN(this,wj.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(wj.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(bj.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof LL))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof LL)).length>1)throw new NI(II.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof BM)).length>1&&(e.some((e=>e instanceof BM&&e._bypassWebAudio))||!vk().webAudioMediaStreamDest))throw new NI(II.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof LL&&this.pendingLocalTracks.some((e=>e instanceof LL)))throw new NI(II.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof BM&&this.pendingLocalTracks.some((e=>e instanceof BM))&&(!vk().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof BM&&e._bypassWebAudio))))throw new NI(II.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!IA("DISABLE_DUAL_STREAM_USE_ENCODING")&&vk().supportDualStreamEncoding,i=ZB(ZB({},{width:160,height:120,framerate:15,bitrate:50}),t);let a;a=r?e._mediaStreamTrack.clone():IB(e,i);const o=xN(8,"track-low-"),s=new LL(a,ZB(ZB({},r&&{scaleResolutionDownBy:lF(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return s.on(zk.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,Uk.LOW_STREAM)})),s._hints.push(Fk.LOW_STREAM),Lr(n=e._hints).call(n,Fk.SCREEN_TRACK)&&s._hints.push(Fk.SCREEN_LOW_TRACK),e.on("sei-to-send",(e=>{s.emit("sei-to-send",e)})),e.addListener(jk.NEED_CLOSE,(()=>{s.close()})),s}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof TB){var i,a,o,s;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u,dtlsTransportState:l,peerConnectionState:d}=this.connection,{local:f,remote:h}=await this.connection.getSelectedCandidatePair();pk.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:u,dtlsstate:l,connectionstate:d,intSucc:t?1:2,error:this._iceError||r||"",selectedLocalCandidateProtocol:null!==(i=null==f?void 0:f.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(a=f.candidateType)&&void 0!==a?a:"",selectedLocalCandidateAddress:"".concat(f.address,":").concat(f.port),selectedRemoteCandidateProtocol:null!==(o=h.protocol)&&void 0!==o?o:"",selectedRemoteCandidateType:null!==(s=h.candidateType)&&void 0!==s?s:"",selectedRemoteCandidateAddress:"".concat(h.address,":").concat(h.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find((t=>t.userId===e.uid));if(!n)return;const{isInternalUpload:r,isExternalUpload:i}=n;if(r&&i)return;const{subscribeEnd:a,firstPreRender:o,peerPublishDuration:s,peerPubStatusMs:c}=n;let{firstRender:u=0}=n;if(a&&(u||o)&&s&&c){n.isInternalUpload=!0;const{playEnd:r}=n;r&&(n.isExternalUpload=!0);const{firstPreRender:i=0}=n;u=i||u;const o=e.videoTrack,l={peer:e._uintid,width:(null==o?void 0:o._videoWidth)||0,height:(null==o?void 0:o._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:s,peerPubStatusMs:c,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:i||0,firstRender:r?Math.max(u,r):Math.max(u,a),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:wk(this.store)};pk.firstXLAPeerFirstVideoFrame(this.store.sessionId,l)}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const a=Array.from(XA(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,o=i.subscribe.find((e=>e.userId===a.uid&&"video"===e.type));pk.firstRemoteVideoDecode(this.store.sessionId,lk.FIRST_VIDEO_DECODE,dk.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:YU.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==o?void 0:o.subscribeEnd)||0,subscriberStart:(null==o?void 0:o.subscribeStart)||0,videoAddNotify:(null==o?void 0:o.streamAdded)||0,state:r?1:0,firstFrame:(null==o?void 0:o.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const a=await this.connection.getRemoteSSRC(i);return void 0!==a&&a!==n}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===bj.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Uk.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},NP(QB.prototype,"startP2PConnection",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"startP2PConnection"),QB.prototype),NP(QB.prototype,"connect",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"connect"),QB.prototype),NP(QB.prototype,"updateRemoteRTPCapabilities",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"updateRemoteRTPCapabilities"),QB.prototype),NP(QB.prototype,"publishDataChannel",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"publishDataChannel"),QB.prototype),NP(QB.prototype,"unpublish",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"unpublish"),QB.prototype),NP(QB.prototype,"unpublishDataChannel",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"unpublishDataChannel"),QB.prototype),NP(QB.prototype,"unpublishLowStream",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"unpublishLowStream"),QB.prototype),NP(QB.prototype,"subscribeDataChannel",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"subscribeDataChannel"),QB.prototype),NP(QB.prototype,"subscribe",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"subscribe"),QB.prototype),NP(QB.prototype,"massSubscribe",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"massSubscribe"),QB.prototype),NP(QB.prototype,"unsubscribe",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"unsubscribe"),QB.prototype),NP(QB.prototype,"unsubscribeDataChannel",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"unsubscribeDataChannel"),QB.prototype),NP(QB.prototype,"massUnsubscribe",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"massUnsubscribe"),QB.prototype),NP(QB.prototype,"muteRemote",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"muteRemote"),QB.prototype),NP(QB.prototype,"unmuteRemote",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"unmuteRemote"),QB.prototype),NP(QB.prototype,"hasRemoteMediaWithLock",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"hasRemoteMediaWithLock"),QB.prototype),NP(QB.prototype,"disconnectForReconnect",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"disconnectForReconnect"),QB.prototype),NP(QB.prototype,"updateBitrateLimit",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"updateBitrateLimit"),QB.prototype),NP(QB.prototype,"remoteMediaSsrcChanged",[nV],Object.getOwnPropertyDescriptor(QB.prototype,"remoteMediaSsrcChanged"),QB.prototype),QB);function nV(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return await r.apply(this,a)}finally{n()}},n}function rV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function iV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rV(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const aV=Date.now(),oV=20,sV=new Map,cV=new Map;async function uV(e){const t=sV.get(e),n=Array.isArray(t)&&t[t.length-1],r=cV.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};0===r.firstRecvTs&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const a=n.sendTs-r.firstSendTs,o=a-(Date.now()-r.firstRecvTs);o>0&&(r.firstRecvTs=Date.now()-a);let s=n.mediaDelay+o;s<=0?(t.pop(),lV(n.context,i),s=0):s=Math.min(s,oV),setTimeout((()=>t.length&&uV(e)),s)}function lV(e,t){e.safeEmit(tN.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function dV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return lV(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=sV.get(r)||[],a=i.findIndex((t=>e.sendTs>=t.sendTs)),o=iV(iV({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===a?i.push(o):i.splice(a,0,o),sV.set(r,i);let s=!1;var c;cV.has(r)?s=!(null===(c=cV.get(r))||void 0===c||!c.isSyncing):cV.set(r,{isSyncing:s,firstRecvTs:0,firstSendTs:0}),s||uV(r)}const fV=qR().name;function hV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hV(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const mV="websdk_ng_cache_parameter",gV=IA("MAX_PRELOAD_ASYNC_LENGTH"),vV=1e4,yV=new Map,bV=[];let _V=null,wV=0,EV=0;const SV=new Map,CV=function(e,t){const n=[];let r=0;const i=async()=>{const e=n.shift();e&&await e(),n.length>0&&r<t?i():r--};return async function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return new rh((async(a,s)=>{n.push((async()=>{try{const t=await e(...o);a(t)}catch(e){s(e)}})),r<t&&(r++,i())}))}}(TV,gV),xV=PR.CancelToken.source();async function TV(e,t,n,r,i,a){try{if(!IA("ENABLE_PRELOAD"))return;if(!vk().supportWebCrypto)return void gN((()=>{ok.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!n&&null!==n)throw new NI(II.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&LI(n,"token",1,2047),LI(e,"appid",1,2047),zP(t),r&&WP(r);const o=TN();ok.debug("preload channel ".concat(t,", uid is ").concat(r));const s={appId:e,cname:t,token:n||e,uid:"string"!=typeof r?r:null,sid:o,proxyServer:i};let c,u;"string"==typeof r?(s.stringUid=r,[u,c]=await rh.all([OU(r,{sid:o,appId:e},xV.token),jU(pV(pV({},s),{},{token:n||e,uid:0}),xV.token)]),s.uid=u.uid,c.gatewayInfo.uid=s.uid,c.gatewayInfo.res.uid=s.uid):(a&&(s.stringUid=a),c=await jU(s,xV.token));const l={sid:o,appId:e,cname:t,token:n||e,uid:s.stringUid||r,intUid:s.uid||c.gatewayInfo.uid,stringUid:s.stringUid,ts:Date.now(),sua:u,ap:c};await async function(e){let t;try{e.uid&&IV({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=LV(e),r=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",bN(t),"AES-GCM",!1,["encrypt"]),r=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,vN(window.btoa(JSON.stringify(e))));return yN(new Uint8Array(r))}catch(e){return}}(e,e.token||e.appId);if(!r)return;t=DV(mV);const i=t?JSON.parse(t):[];i.push({[n]:r}),i.length>IA("AP_CACHE_NUM")&&i.shift(),MV(mV,JSON.stringify(i))}catch(e){ok.warn("Error caching server parameters:",e.message),MV(mV,"")}}(l),wV++}catch(e){throw EV++,function(e){_V||(_V=window.setTimeout((()=>{let t="";SV.forEach(((e,n)=>{t+="".concat(n,": ").concat(e," ;")})),pk.reportApiInvoke(null,{name:qI.PRELOAD,options:{success:wV,failed:EV,err:t}}).onError(e),wV=0,EV=0,SV.clear(),_V=null}),vV));const t=SV.get(e.code)||0;SV.set(e.code,t+1)}(e),e}}async function RV(e){try{if(IA("AP_REQUEST_DETAIL")||IA("ENABLE_ROLE_SELECT_EDGE"))return;const t=IV(e);if(!t||"disabled"!==e.cloudProxyServer)return;const n=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",bN(t),"AES-GCM",!1,["decrypt"]),r=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,vN(e));return JSON.parse(window.atob(yN(new Uint8Array(r))))}catch(e){return}}(t,e.token||e.appId);if(!n)return;if(!function(e,t){return!(e.cname!==t.cname||e.appId!==t.appId||e.token!==t.token)&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(n,e))return;if(n&&Date.now()-n.ts<IA("AP_CACHE_LIFETIME"))return n}catch(e){ok.warn("Error get preloadInfo",e.message)}}function IV(e){let t;try{if(t=DV(mV),!t)return;const n=JSON.parse(t),r=LV(e),i=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,(e=>r in e));if(-1===i)return;const a=n.splice(i,1)[0];return MV(mV,JSON.stringify(n)),a[r]}catch(e){ok.warn("Error delete preload info: ".concat(t),e.message),MV(mV,"")}}function NV(e){if(e){let t=yV.get(e);t&&(window.clearTimeout(t),t=null,yV.delete(e)),Lr(bV).call(bV,e)||"disabled"!==e.cloudProxyServer||bV.push(e)}if(yV.size<IA("AP_CACHE_NUM")&&bV.length>0){const e=bV.shift();yV.set(e,window.setTimeout((async()=>{const{appId:t,cname:n,token:r,stringUid:i,uid:a,proxyServer:o}=e;try{await CV(t,n,r,a,o,i),yV.has(e)&&NV(e)}catch(t){ok.warn("update preload failed",t.message),AV(e)}}),IA("AP_UPDATE_INTERVAL")))}}function AV(e){const t=bV.indexOf(e);-1!==t&&bV.splice(t,1);let n=yV.get(e);n&&(window.clearTimeout(n),n=null,yV.delete(e),NV())}function kV(e,t){const n=e.sua,r=e.ap;t&&n&&pk.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),pk.reportResourceTiming(e.ap.url,e.sid),pk.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map((e=>e.ip)).join(","),eventType:"disabled",unilbsServerIds:[$j.CHOOSE_SERVER,$j.CLOUD_PROXY_FALLBACK].toString()}),pk.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[$j.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function DV(e){return window.atob(window.localStorage.getItem(e)||"")}function MV(e,t){window.localStorage.setItem(e,window.btoa(t))}function LV(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),ON(t)}function OV(e){let t=function(){const e=UV.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(QV(t,10),YV(t,n));let r=e.cid;void 0!==r&&(QV(t,16),QV(t,r));let i=e.cname;void 0!==i&&(QV(t,26),YV(t,i));let a=e.deviceId;void 0!==a&&(QV(t,34),YV(t,a));let o=e.elapse;void 0!==o&&(QV(t,40),ZV(t,o));let s=e.fileSize;void 0!==s&&(QV(t,48),ZV(t,FV(s)));let c=e.height;void 0!==c&&(QV(t,56),ZV(t,FV(c)));let u=e.jpg;void 0!==u&&(QV(t,66),QV(t,u.length),GV(t,u));let l=e.networkType;void 0!==l&&(QV(t,72),ZV(t,FV(l)));let d=e.osType;void 0!==d&&(QV(t,80),ZV(t,FV(d)));let f=e.requestId;void 0!==f&&(QV(t,90),YV(t,f));let h=e.sdkVersion;void 0!==h&&(QV(t,98),YV(t,h));let p=e.sequence;void 0!==p&&(QV(t,104),ZV(t,FV(p)));let m=e.sid;void 0!==m&&(QV(t,114),YV(t,m));let g=e.timestamp;void 0!==g&&(QV(t,120),ZV(t,g));let v=e.uid;void 0!==v&&(QV(t,128),QV(t,v));let y=e.vid;void 0!==y&&(QV(t,136),QV(t,y));let b=e.width;void 0!==b&&(QV(t,144),ZV(t,FV(b)));let _=e.service;void 0!==_&&(QV(t,152),QV(t,_));let w=e.callbackData;void 0!==w&&(QV(t,162),QV(t,w.length),GV(t,w));let E=e.ticket;void 0!==E&&(QV(t,170),YV(t,E));let S=e.vendorConfigs;void 0!==S&&(QV(t,178),YV(t,S))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function PV(e){return function(e){let t={};e:for(;!VV(e);){let n=XV(e);switch(n>>>3){case 0:break e;case 1:t.code=XV(e);break;case 2:t.msg=HV(e,XV(e));break;case 3:t.requestId=HV(e,XV(e));break;case 4:t.timestamp=JV(e,!1);break;default:jV(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function jV(e,t){switch(t){case 0:for(;128&qV(e););break;case 2:BV(e,XV(e));break;case 5:BV(e,4);break;case 1:BV(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function FV(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let UV=[];function BV(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function VV(e){return e.offset>=e.limit}function zV(e,t){let n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){let t=new Uint8Array(2*a);t.set(n),e.bytes=t}return e.offset=a,a>i&&(e.limit=a),r}function WV(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function GV(e,t){let n=zV(e,t.length);e.bytes.set(t,n)}function HV(e,t){let n=WV(e,t),r=String.fromCharCode,i=e.bytes,a="\ufffd",o="";for(let s=0;s<t;s++){let e,c,u,l,d=i[s+n];0==(128&d)?o+=r(d):192==(224&d)?s+1>=t?o+=a:(e=i[s+n+1],128!=(192&e)?o+=a:(l=(31&d)<<6|63&e,l<128?o+=a:(o+=r(l),s++))):224==(240&d)?s+2>=t?o+=a:(e=i[s+n+1],c=i[s+n+2],32896!=(49344&(e|c<<8))?o+=a:(l=(15&d)<<12|(63&e)<<6|63&c,l<2048||l>=55296&&l<=57343?o+=a:(o+=r(l),s+=2))):240==(248&d)?s+3>=t?o+=a:(e=i[s+n+1],c=i[s+n+2],u=i[s+n+3],8421504!=(12632256&(e|c<<8|u<<16))?o+=a:(l=(7&d)<<18|(63&e)<<12|(63&c)<<6|63&u,l<65536||l>1114111?o+=a:(l-=65536,o+=r(55296+(l>>10),56320+(1023&l)),s+=3))):o+=a}return o}function YV(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let e=t.charCodeAt(o);e>=55296&&e<=56319&&o+1<n&&(e=(e<<10)+t.charCodeAt(++o)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}QV(e,r);let i=zV(e,r),a=e.bytes;for(let o=0;o<n;o++){let e=t.charCodeAt(o);e>=55296&&e<=56319&&o+1<n&&(e=(e<<10)+t.charCodeAt(++o)-56613888),e<128?a[i++]=e:(e<2048?a[i++]=e>>6&31|192:(e<65536?a[i++]=e>>12&15|224:(a[i++]=e>>18&7|240,a[i++]=e>>12&63|128),a[i++]=e>>6&63|128),a[i++]=63&e|128)}}function qV(e){return e.bytes[WV(e,1)]}function KV(e,t){let n=zV(e,1);e.bytes[n]=t}function XV(e){let t,n=0,r=0;do{t=qV(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function QV(e,t){for(t>>>=0;t>=128;)KV(e,127&t|128),t>>>=7;KV(e,t)}function JV(e,t){let n,r=0,i=0,a=0;return n=qV(e),r=127&n,128&n&&(n=qV(e),r|=(127&n)<<7,128&n&&(n=qV(e),r|=(127&n)<<14,128&n&&(n=qV(e),r|=(127&n)<<21,128&n&&(n=qV(e),i=127&n,128&n&&(n=qV(e),i|=(127&n)<<7,128&n&&(n=qV(e),i|=(127&n)<<14,128&n&&(n=qV(e),i|=(127&n)<<21,128&n&&(n=qV(e),a=127&n,128&n&&(n=qV(e),a|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|a<<24,unsigned:t}}function ZV(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=zV(e,a),s=e.bytes;switch(a){case 10:s[o+9]=i>>>7&1;case 9:s[o+8]=9!==a?128|i:127&i;case 8:s[o+7]=8!==a?r>>>21|128:r>>>21&127;case 7:s[o+6]=7!==a?r>>>14|128:r>>>14&127;case 6:s[o+5]=6!==a?r>>>7|128:r>>>7&127;case 5:s[o+4]=5!==a?128|r:127&r;case 4:s[o+3]=4!==a?n>>>21|128:n>>>21&127;case 3:s[o+2]=3!==a?n>>>14|128:n>>>14&127;case 2:s[o+1]=2!==a?n>>>7|128:n>>>7&127;case 1:s[o]=1!==a?128|n:127&n}}const $V={},ez={},tz=4294967296,nz=tz*tz,rz=nz/2,iz=uz(0,!0),az=uz(0),oz=lz(0,-2147483648,!1),sz=lz(-1,2147483647,!1),cz=lz(-1,-1,!0);function uz(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=ez[e],r)?r:(n=lz(e,0,!0),i&&(ez[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=$V[e],r)?r:(n=lz(e,e<0?-1:0,!1),i&&($V[e]=n),n)}function lz(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function dz(e,t){if(isNaN(e))return t?iz:az;if(t){if(e<0)return iz;if(e>=nz)return cz}else{if(e<=-rz)return oz;if(e+1>=rz)return sz}return e<0?t?iz:az:lz(e%tz|0,e/tz|0,t)}function fz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class hz extends GI{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(Ij.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(e){var t;super(),dx(this,"name","AgoraRTCImageModeration"),dx(this,"_connectionState",Rj.CONNECTING),dx(this,"_sequence",0),dx(this,"_moderationStartTime",void 0),dx(this,"_workerConnection",void 0),dx(this,"_workerMessageLengthLimit",void 0),dx(this,"_qualityRatio",void 0),dx(this,"_connectInfo",void 0),dx(this,"_cancelTokenSource",PR.CancelToken.source()),dx(this,"_retryConfig",void 0),dx(this,"_moderationInterval",void 0),dx(this,"_moderationTimer",null),dx(this,"_moderationMode",1),dx(this,"_quality",1),dx(this,"_qualityTimer",null),dx(this,"_ticket",void 0),dx(this,"_moderationIntervalMinimum",void 0),dx(this,"_uploadFailedNum",0),dx(this,"_uploadNum",0),dx(this,"_uploadTimer",null),dx(this,"_extraInfo",void 0),dx(this,"_vendor",""),dx(this,"_encoder",new TextEncoder),dx(this,"_moderationId",void 0),dx(this,"inspectImage",(()=>{if(this.connectionState!==Rj.CONNECTED)throw new mk(II.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===Rj.CONNECTED?this.requestToInspectImage():ok.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=xN(5,"image-moderation-"),this._workerMessageLengthLimit=IA("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=IA("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=IA("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Qj("worker-"+this._moderationId,BN),this.on(Ij.STATE_CHANGE,((e,t)=>{ok.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Nj[e]," ").concat(t||""))})),this.handleWorkerEvents()}async init(e,t){this.emit(Ij.STATE_CHANGE,Nj.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new rh(((r,i)=>{this.on(Ij.CONNECTION_STATE_CHANGE,((e,t)=>{e===Rj.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorker(e)})).catch((e=>{i(e)}))}))}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),ok.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Rj.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const r=IA("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:a,cname:o,sid:s,token:c,uid:u}=t;RU++;const l="moderation_plugin",d={service_name:l,json_body:JSON.stringify({appId:i,areaCode:a,cname:o,command:"allocateEdge",requestId:RU,seq:RU,sid:s,appToken:c,ts:Date.now(),uid:u+""})};let f,h,p=e[0];return zN((async()=>{f=Date.now();const e=await aU(p,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(h=Date.now()-f,0!==e.code){const t=new mk(II.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:h});throw ok.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new mk(II.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:h});throw ok.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new mk(II.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:h});throw ok.error(e.toString()),e}if(!t.servers.some((e=>!!e.wss))){const e=new mk(II.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:h});throw ok.error(e.toString()),e}const r=IA("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:h}}),((t,n)=>(pk.apworkerEvent(s,{success:!0,sc:200,serviceName:l,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:h,serverIp:e[n%e.length]}),!1)),((t,n)=>(pk.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:l,responseTime:h,serverIp:e[n%e.length]}),!!(t.code!==II.OPERATION_ABORTED&&t.code!==II.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(p=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(Ij.STATE_CHANGE,Nj.AP_CONNECTED);const{addressList:a,ticket:o}=i;return this._ticket=o,a}async connectWorker(e){this.emit(Ij.STATE_CHANGE,Nj.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(VP.CONNECTED,(async()=>{this.emit(Ij.STATE_CHANGE,Nj.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Rj.CONNECTED})),this._workerConnection.on(VP.CLOSED,(()=>{this.connectionState=Rj.CLOSED})),this._workerConnection.on(VP.FAILED,(()=>{this.connectionState=Rj.CLOSED})),this._workerConnection.on(VP.RECONNECTING,(()=>{this.connectionState=this.connectionState===Rj.CONNECTED?Rj.RECONNECTING:Rj.CONNECTING})),this._workerConnection.on(VP.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const t=PV(new Uint8Array(e.data));IA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&ok.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,ok.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{pk.reportApiInvoke(this._connectInfo.sid||null,{name:qI.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:KI.TRACER}).onError(new mk(II.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null}),IA("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else ok.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(VP.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this._workerConnection.on(VP.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=sN(this,Ij.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(IA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&ok.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else IA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&ok.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:a,sid:o,uid:s}=t;const c=Date.now(),u=await e.getCurrentFrameImage("image/jpeg",this.quality),l=await JD(u,n,r),d=this._sequence+"-"+i+"-"+s+"-"+c+"-"+xN(12,""),f={appId:n,cid:i,cname:r,deviceId:"",elapse:hz.intToLong(Number(c-this._moderationStartTime)),fileSize:u.buffer.byteLength,height:u.height,width:u.width,jpg:l,networkType:6,osType:7,requestId:d,sdkVersion:"4.24.0",sequence:this._sequence,sid:o,timestamp:dz(c),uid:s,vid:a,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete f.callbackData;const h=OV(f);if(h.byteLength<this._workerMessageLengthLimit){if(IA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fz(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fz(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},f);delete e.jpg,ok.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return h}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:a,sid:o,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=PR.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Rj.CLOSED,this.emit(Ij.STATE_CHANGE,Nj.CLOSED)}}function pz(e){if(DI(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new mk(II.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new mk(II.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const mz={name:"ImageModeration",create:function(e){let{config:t}=e;return pz(t),new hz(t)}};var gz,vz,yz,bz,_z,wz,Ez,Sz,Cz,xz,Tz,Rz,Iz,Nz,Az,kz,Dz,Mz,Lz,Oz,Pz,jz,Fz,Uz,Bz,Vz,zz,Wz,Gz,Hz,Yz,qz,Kz,Xz,Qz,Jz,Zz,$z,eW,tW,nW,rW;function iW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function aW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iW(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}FN.setLogger(ok);let oW=(gz=hk(),vz=hk({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof dD))return[t];t=[t]}return t.map((e=>e?Object(e).toString():"null"))}}),yz=hk({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Hk.DATA?(Array.isArray(t)||(t=[t]),t.map((e=>e.getTrackId()))):[t.getChannelId()])}),bz=hk({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),_z=hk({argsMap:(e,t,n)=>[t,n]}),wz=hk({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]}))}),Ez=hk({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),Sz=hk({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}}))}),Cz=hk(),xz=hk(),Tz=hk(),Rz=hk(),Iz=hk(),Nz=hk(),Az=hk(),kz=hk(),Dz=hk(),Mz=hk(),Lz=hk(),Oz=hk(),Pz=hk(),jz=hk(),Fz=hk(),Uz=hk({argsMap:(e,t)=>[t]}),Bz=hk(),Vz=hk(),zz=hk(),Wz=hk(),Gz=hk(),Hz=hk(),Yz=hk(),qz=hk(),Kz=hk({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),Xz=hk(),Qz=hk(),Jz=hk(),Zz=hk(),$z=hk(),eW=hk(),tW=hk({reportResult:!0}),nW=hk(),rW=class extends GI{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),dx(this,"store",void 0),dx(this,"_uid",void 0),dx(this,"_channelName",void 0),dx(this,"_uintUid",void 0),dx(this,"_users",[]),dx(this,"_config",void 0),dx(this,"_clientId",void 0),dx(this,"_appId",void 0),dx(this,"_sessionId",null),dx(this,"_key",void 0),dx(this,"_rtmConfig",{}),dx(this,"_joinInfo",void 0),dx(this,"_gateway",void 0),dx(this,"_statsCollector",void 0),dx(this,"_configDistribute",void 0),dx(this,"_leaveMutex",void 0),dx(this,"_publishMutex",void 0),dx(this,"_renewTokenMutex",void 0),dx(this,"_subscribeMutex",void 0),dx(this,"_encryptionMode","none"),dx(this,"_encryptionSecret",null),dx(this,"_encryptionSalt",null),dx(this,"_encryptDataStream",!1),dx(this,"_encryptDataStreamKey",null),dx(this,"_encryptDataStreamIv",null),dx(this,"_proxyServer",void 0),dx(this,"_turnServer",{servers:[],mode:"auto"}),dx(this,"_cloudProxyServerMode","disabled"),dx(this,"_isDualStreamEnabled",!1),dx(this,"_defaultStreamFallbackType",void 0),dx(this,"_lowStreamParameter",void 0),dx(this,"_streamFallbackTypeCacheMap",new Map),dx(this,"_remoteStreamTypeCacheMap",new Map),dx(this,"_axiosCancelSource",PR.CancelToken.source()),dx(this,"_audioVolumeIndicationInterval",void 0),dx(this,"_networkQualityInterval",void 0),dx(this,"_userOfflineTimeout",void 0),dx(this,"_streamRemovedTimeout",void 0),dx(this,"_liveTranscodeStreamingClient",void 0),dx(this,"_liveRawStreamingClient",void 0),dx(this,"_channelMediaRelayClient",void 0),dx(this,"_networkQualitySensitivity","normal"),dx(this,"_p2pChannel",void 0),dx(this,"_useLocalAccessPoint",!1),dx(this,"_setLocalAPVersion",void 0),dx(this,"_joinAndNotLeaveYet",!1),dx(this,"_numberOfJoinCount",0),dx(this,"_joinResponse",null),dx(this,"_remoteDefaultVideoStreamType",void 0),dx(this,"_inspect",void 0),dx(this,"_moderation",void 0),dx(this,"_license",void 0),dx(this,"_pendingPublishedUsers",[]),dx(this,"ntpAlignErrorCount",0),dx(this,"remoteInboundOffset",0),dx(this,"_peerConnectionState",void 0),dx(this,"_handleLocalTrackEnable",((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),dx(this,"_handleLocalTrackDisable",((e,t,n)=>{this.unpublish(e).then(t).catch(n)})),dx(this,"_handleUserOnline",(e=>{if(IA("BLOCK_LOCAL_CLIENT")&&HO(e.uid,this.channelName))return void ok.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&ok.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find((t=>t.uid===e.uid));if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(tN.USER_JOINED,t));else{const t=new ZU(e.uid,e.uint_id||e.uid);this._users.push(t),ok.debug("[".concat(this._clientId,"] user online"),e.uid),this.store.firstVideoFrameDecoded(t.uid,{userJoinNotify:Date.now()}),this.safeEmit(tN.USER_JOINED,t)}})),dx(this,"_handleUserOffline",(e=>{if(IA("BLOCK_LOCAL_CLIENT")&&HO(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:lN(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),ok.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(tN.USER_LEAVED,t,e.reason))})),dx(this,"_handleAddAudioOrVideoStream",((e,t,n,r,i,a,o,s)=>{if(IA("BLOCK_LOCAL_CLIENT")&&HO(t,this.channelName))return;const c=this._users.find((e=>e.uid===t));if(!c)return void ok.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));ok.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(c.uid,e,void 0,void 0,void 0,Date.now()),"video"===e&&this.store.firstVideoFrameDecoded(c.uid,{videoAddNotify:Date.now()});const u="audio"===e?c.hasAudio:c.hasVideo;if(c._uintid||(c._uintid=a||t),"audio"===e?c._trust_audio_stream_added_state_=!0:c._trust_video_stream_added_state_=!0,"audio"===e?(c._audio_added_=!0,void 0!==n&&(c._audioSSRC=n),void 0!==r&&(c._cname=r),o&&(c._audioOrtc=o)):(c._video_added_=!0,void 0!==n&&(c._videoSSRC=n),void 0!==r&&(c._cname=r),void 0!==s&&(c._rtxSsrcId=s),o&&(c._videoOrtc=o)),("audio"===e?c.hasAudio:c.hasVideo)&&!u&&(ok.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published ").concat(e)),this.safeEmit(tN.USER_PUBLISHED,c,e)),"video"===e?pk.onGatewayStream(this._sessionId,lk.ON_ADD_VIDEO_STREAM,dk.ON_ADD_VIDEO_STREAM,{peer:a||t,ssrc:c._videoSSRC}):pk.onGatewayStream(this._sessionId,lk.ON_ADD_AUDIO_STREAM,dk.ON_ADD_AUDIO_STREAM,{peer:a||t,ssrc:c._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(c,e,n).then((t=>{if(t&&(ok.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof tV))return this._p2pChannel.unsubscribe(c,e,!0).then((()=>this._subscribe(c,e,!0).catch((e=>{ok.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(c,e)&&(ok.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(c.uid," after reconnect.")),this._subscribe(c,e,!0).catch((e=>{ok.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))),"video"===e&&!$R()&&!rI()){const e=this._getEncodingName(i);(null==e?void 0:e.toLocaleLowerCase())==DA.av1&&kU().then((t=>{t||this._gateway.downgradeCodec(e)}))}})),dx(this,"_handleRemoveStream",(e=>{if(IA("BLOCK_LOCAL_CLIENT")&&HO(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));if(!t)return void ok.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));ok.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{ok.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(tN.USER_UNPUBLISHED,t,"audio"),ok.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(tN.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{ok.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(tN.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{ok.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(tN.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof tV&&this._p2pChannel.unsubscribe(t).then((e=>{if(e)return this._gateway.unsubscribe(e,t.uid)})),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),pk.onGatewayStream(this._sessionId,lk.ON_REMOVE_STREAM,dk.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()})),dx(this,"_handleSetStreamLocalEnable",((e,t,n)=>{if(IA("BLOCK_LOCAL_CLIENT")&&HO(t,this.channelName))return;const r=this._users.find((e=>e.uid===t));if(!r)return void ok.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));ok.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;const e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{const e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";ok.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(tN.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;const e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{const e=r._video_enabled_?"enable-local-video":"disable-local-video";ok.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(tN.USER_INFO_UPDATED,t,e)}}const a="audio"===e?r.hasAudio:r.hasVideo;return i!==a?!i&&a?(ok.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(tN.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,this._p2pChannel.muteRemote(r,e),ok.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(tN.USER_UNPUBLISHED,r,e)):void 0})),dx(this,"_handleMuteStream",((e,t,n)=>{if(IA("BLOCK_LOCAL_CLIENT")&&HO(e,this.channelName))return;ok.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const r=this._users.find((t=>t.uid===e));if(!r)return void ok.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const i="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;const t=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===t)return;{const t=r._audio_muted_?"mute-audio":"unmute-audio";ok.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(tN.USER_INFO_UPDATED,e,t)}}else{r._trust_video_mute_state_=!0;const t=r._video_muted_;if(r._video_muted_=n,r._video_muted_===t)return;{const t=r._video_muted_?"mute-video":"unmute-video";ok.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(tN.USER_INFO_UPDATED,e,t)}}const a="audio"===t?r.hasAudio:r.hasVideo;if(i!==a){if(!i&&a)return("audio"===t?r._audioSSRC:r._videoSSRC)?(ok.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(tN.USER_PUBLISHED,r,t)):void ok.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&!r._video_pre_subscribed&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,this._p2pChannel.muteRemote(r,t),ok.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(tN.USER_UNPUBLISHED,r,t)}})),dx(this,"_handleP2PLost",(async e=>{ok.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():ok.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)})),dx(this,"_handleTokenWillExpire",(()=>{ok.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(tN.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),dx(this,"_handleBeforeUnload",(e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),ok.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),dx(this,"_handleUpdateNetworkQuality",(()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(tN.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(tN.NETWORK_QUALITY,e)})),dx(this,"_handleP2PAddAudioOrVideoStream",((e,t,n,r)=>{const i=this._users.find((e=>e.uid===t));if(!i)return void ok.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));ok.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(i.uid,e,void 0,void 0,void 0,Date.now());const a="audio"===e?i.hasAudio:i.hasVideo;"audio"===e?i._trust_audio_stream_added_state_=!0:i._trust_video_stream_added_state_=!0,"audio"===e?(i._audio_added_=!0,void 0!==n&&(i._audioSSRC=n),void 0!==r&&(i._audioMid=r)):(i._video_added_=!0,void 0!==n&&(i._videoSSRC=n),void 0!==r&&(i._videoMid=r)),("audio"===e?i.hasAudio:i.hasVideo)&&!a&&(ok.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published ").concat(e)),this.safeEmit(tN.USER_PUBLISHED,i,e)),this._p2pChannel.hasPendingRemoteMedia(i,e)&&(ok.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(i.uid," after reconnect.")),this._subscribe(i,e,!0).catch((e=>{ok.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),this._config=e,this._clientId=t||xN(5,"client-"),this.store=new class{constructor(e,t,n,r){xI(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:_A.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case kA.SET_SESSION_ID:return RI(RI({},e),{},{sessionId:t.sessionId});case kA.SET_P2P_ID:return RI(RI({},e),{},{p2pId:t.p2pId});case kA.SET_UID:return RI(RI({},e),{},{uid:t.uid});case kA.SET_INT_UID:return RI(RI({},e),{},{intUid:t.intUid});case kA.SET_PUB_ID:return RI(RI({},e),{},{pubId:t.pubId});case kA.KEY_METRIC_CLIENT_CREATED:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{clientCreated:t.metric})});case kA.KEY_METRIC_JOIN_START:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{joinStart:t.metric})});case kA.KEY_METRIC_PRELOAD_START:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{preloadStart:t.metric})});case kA.KEY_METRIC_PRELOAD_END:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{preloadEnd:t.metric})});case kA.KEY_METRIC_JOIN_END:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{joinEnd:t.metric})});case kA.KEY_METRIC_REQUEST_AP_START:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{requestAPStart:t.metric})});case kA.KEY_METRIC_REQUEST_AP_END:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{requestAPEnd:t.metric})});case kA.KEY_METRIC_REQUEST_SUA_END:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{requestSUAEnd:t.metric})});case kA.KEY_METRIC_BEFORE_CONNECT:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{beforeConnect:t.metric})});case kA.KEY_METRIC_PEER_RECEIVER:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{peerReceiver:t.metric})});case kA.KEY_METRIC_SIGNAL_CONNECTED:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{signalConnected:t.metric})});case kA.KEY_METRIC_JOIN_REQ:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{joinReq:t.metric})});case kA.KEY_METRIC_JOIN_REP:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{joinRep:t.metric})});case kA.KEY_METRIC_JOIN_GATEWAY_START:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case kA.KEY_METRIC_JOIN_GATEWAY_END:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case kA.KEY_METRIC_PEER_CONNECTION_START:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case kA.KEY_METRIC_PEER_CONNECTION_END:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case kA.KEY_METRIC_DESCRIPTION_START:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{descriptionStart:t.metric})});case kA.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case kA.KEY_METRIC_ICE_CONNECTION_END:return RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case kA.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,r=n.findIndex((e=>e.trackId===t.metric.trackId));return-1!==r?(n[r]=RI(RI({},n[r]),t.metric),RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{publish:[...n]})})):RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case kA.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,r=n.findIndex((e=>e.userId===t.metric.userId&&e.type===t.metric.type));return-1!==r?(n[r]=RI(RI({},n[r]),t.metric),RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{subscribe:[...n]})})):RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case kA.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const n=e.keyMetrics.firstVideoFrameDecoded,r=n.findIndex((e=>e.userId===t.metric.userId));return-1!==r?(n[r]=RI(RI({},n[r]),t.metric),RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{firstVideoFrameDecoded:[...n]})})):RI(RI({},e),{},{keyMetrics:RI(RI({},e.keyMetrics),{},{firstVideoFrameDecoded:[...e.keyMetrics.firstVideoFrameDecoded,t.metric]})})}case kA.RESET_FIRST_VIDEO_FRAME_DECODED:return e.keyMetrics.firstVideoFrameDecoded=[],e;case kA.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case kA.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=RI(RI({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case kA.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case kA.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},e;case kA.SET_USE_P2P:return RI(RI({},e),{},{useP2P:t.val});case kA.SET_TRANSPORT_TYPE:return RI(RI({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set autoSubscribe(e){this.state.autoSubscribe=e}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(e){this.state.enableInstantMuteRestore=e}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(e){this.dispatch({type:kA.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:kA.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:kA.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:kA.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:kA.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:kA.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:kA.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:kA.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:kA.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:kA.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:kA.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:kA.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:kA.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:kA.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:kA.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:kA.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:kA.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:kA.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:kA.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:kA.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:kA.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:kA.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:kA.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:kA.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:kA.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:kA.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(e,t){this.dispatch({type:kA.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:RI({userId:e},t)})}descriptionStart(){this.dispatch({type:kA.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:kA.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:kA.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:kA.KEY_METRIC_PUBLISH,metric:RI(RI({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,a,o){this.dispatch({type:kA.KEY_METRIC_SUBSCRIBE,metric:RI(RI(RI(RI(RI({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),a&&{streamAdded:a}),o&&{firstDecoded:o})})}massSubscribe(e,t,n,r){e.forEach((e=>{this.dispatch({type:kA.KEY_METRIC_SUBSCRIBE,metric:RI(RI(RI({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof t?(this.dispatch({type:kA.RECORD_JOIN_CHANNEL_SERVICE,record:RI(RI({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:kA.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:kA.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:kA.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:kA.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new FN("client-leave",this._clientId),this._publishMutex=new FN("client-publish",this._clientId),this._renewTokenMutex=new FN("client-renewtoken",this._clientId),this._subscribeMutex=new FN("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),ok.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(yA," build: ").concat(CA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{eN(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(e){ok.warning("[".concat(this._clientId,"] ").concat(e.toString()))}var r;this._statsCollector=new XU(this.store),this._statsCollector.onStatsException=(e,t,n)=>{ok.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),e===HU.VIDEO_ENCODE_FAILED&&this.localTracks.forEach((e=>{e instanceof OL&&IA("ENABLE_ENCODE_EXCEPTION")&&e.findClosestProfile()})),this.safeEmit(tN.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{const i=this._users.find((t=>t.uid===e));i&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(i._uintid,{peerPublishDuration:n,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(i)),pk.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid}))},this._statsCollector.onVideoCodecChanged=e=>{if(IA("VIDEO_STANDARD_BITRATE_VERSION")&&("av1"===e||"h265"===e||"h264"===e)){const t=this.localTracks.find((e=>e instanceof LL));t&&1!==t._saveEncodeBitrateRatio&&t.setSaveEncodeBitrateRatio("h264"===e?IA("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P="p2p"===e.mode,this._gateway=new nU(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||BN,httpRetryConfig:e.httpRetryConfig||BN,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new WU(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},QF("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new tV(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];RA("JOIN_GATEWAY_USE_443PORT_ONLY",a),RA("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const s=this._gateway.signal.websocket;return s instanceof Xj&&(s.use443PortOnly=a,s.tryDoubleDomain=o),async function(e,t,n){UR.get(e)||UR.set(e,[]),BR.get(e)||BR.set(e,t),VR.get(e)||VR.set(e,0);const r=UR.get(e),i=BR.get(e);if(!r||!i)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(VR.get(e)===i){const e=FR();r.push(e),await e.promise}VR.set(e,VR.get(e)+1);for(var a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];const c=await n(...o);return VR.set(e,VR.get(e)-1),VR.get(e)===i-1&&r.length>0&&(r[0].resolve(),r.shift()),0===VR.get(e)&&(UR.set(e,[]),BR.set(e,0),VR.set(e,0)),c}("client.join",IA("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const a=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const o="HTTPS"===(WN||WN||(WN=(window.location.protocol.split(":")[0]||"").toUpperCase(),WN)),s=XN()?window.isSecureContext:"Browser Not Support";if(!XN()&&!o||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";ok.warning(e)}let c;pk.setAppId(e);try{if(!n&&null!==n)throw new mk(II.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&LI(n,"token",1,2047),LI(e,"appid",1,2047),zP(t),r&&WP(r),i)if("string"==typeof i)LI(i,"optionalInfo",1,256),c=i;else{if("object"!=typeof i)throw new mk(II.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:e,enableInstantMuteRestore:t}=i;e&&(AI(e,"autoSubscribe"),ok.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(e)),this.store.autoSubscribe=e),t&&(AI(t,"enableInstantMuteRestore"),ok.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(t)),this.store.enableInstantMuteRestore=t)}}}catch(i){throw pk.reportApiInvoke(TN(),{name:qI.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:s},tag:KI.TRACER}).onError(i),i}if(this._leaveMutex.isLocked&&(ok.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),ok.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const i=new mk(II.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw pk.reportApiInvoke(TN(),{name:qI.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:s},tag:KI.TRACER}).onError(i),i}this._gateway.state="CONNECTING",this.store.preloadStart();const u=await RV({appId:e,cname:t,uid:r,stringUid:"string"==typeof r?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new mk(II.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const l=(null==u?void 0:u.sid)||TN();ok.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(a)),this._sessionId||(this._sessionId=l,this.store.sessionId=this._sessionId);const d=pk.reportApiInvoke(l,{id:this._clientId,name:qI.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:s},tag:KI.TRACER}),f=aW(aW(aW({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!u},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:IA("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(f.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(f.stringUid=r,this._uintUid?(f.uid=this._uintUid,this._uintUid=void 0):f.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(f.aesmode=this._encryptionMode,f.aespassword=await(async e=>{const t=function(){const e=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}(),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=VI(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new mk(II.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(f.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const e=new TextEncoder,t=IA("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(f.appId+this._encryptionSecret+this._encryptionSecret):e.encode(f.appId+f.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256,a=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:OA,hash:"SHA-256",salt:n},r,i+LA);return new Uint8Array(a).subarray(i/8)}(this._encryptionMode,t,vN(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:OA,hash:"SHA-256",salt:n},r,{name:"AES-GCM",length:i},!0,["encrypt","decrypt"])}(this._encryptionMode,t,vN(this._encryptionSalt))}else s?ok.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):ok.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,ok.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:f.stringUid});const h=this._sessionId;setTimeout((()=>{"CONNECTING"===this.connectionState&&h===this._sessionId&&pk.joinChannelTimeout(this._sessionId,5)}),5e3);try{var p;let r;const i=f.cloudProxyServer;if(Lr(p=["proxy3","proxy4","proxy5"]).call(p,i)){const e=IA("PROXY_SERVER_TYPE3");Array.isArray(e)?f.proxyServer=e[0]:f.proxyServer=e}if(pk.setProxyServer(f.proxyServer),ok.setProxyServer(f.proxyServer),this.store.requestAPStart(),u){if(ok.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(f.stringUid?", ".concat(f.stringUid," => ").concat(u.intUid):""," ")),f.stringUid&&!f.uid&&(f.uid=u.intUid),r={gatewayInfo:u.ap.gatewayInfo},IA("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===f.turnServer.mode)if(0===u.ap.proxyInfo.addresses.length)ok.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const e=(await uF(u.ap.proxyInfo,u.ap.gatewayInfo.uid)).map((e=>({turnServerURL:e.address,tcpport:e.tcpport||wA.tcpport,udpport:e.udpport||wA.udpport,username:e.username||wA.username,password:e.password||wA.password,forceturn:!1,security:!0})));f.turnServer={mode:"manual",servers:e}}kV(u,f.stringUid)}else{if(f.stringUid&&!f.uid){let e;[e,r]=await rh.all([LU(f.stringUid,f,this._axiosCancelSource.token,this._config.httpRetryConfig||BN,this.store).finally((()=>{this.store.requestSUAEnd()})),MU(f,this._axiosCancelSource.token,this._config.httpRetryConfig||BN,!0,this.store).finally((()=>{this.store.requestAPEnd()}))]),ok.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(f.stringUid," => ").concat(e)),f.uid=e,r.gatewayInfo.uid=e,r.gatewayInfo.res.uid=e}else r=await MU(f,this._axiosCancelSource.token,this._config.httpRetryConfig||BN,!0,this.store);if(!this._joinAndNotLeaveYet)throw new mk(II.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(f,this._axiosCancelSource.token),this._configDistribute.on(dj.UPDATE_BITRATE_LIMIT,(e=>{this._p2pChannel.updateBitrateLimit(e)})),this._configDistribute.on(dj.UPDATE_CLIENT_ROLE_OPTIONS,(e=>{this._setClientRoleOptions(e)}))}),0),this._key=n||e;const a=r.gatewayInfo,o=f.uid?f.uid:a.uid;this._joinInfo=aW(aW({},f),{},{cid:a.cid,uid:o,vid:a.vid,apResponse:a.res,apGatewayAddress:a.apGatewayAddress,uni_lbs_ip:a.uni_lbs_ip,gatewayAddrs:a.gatewayAddrs}),this.store.intUid=o,this.store.cid=a.cid;const s=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new mk(II.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));d.onSuccess(s),this._appId=e,this._channelName=f.cname,this._uid=s,this.store.uid=s,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener($R()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const c=f.stringUid?"string uid: ".concat(f.stringUid,",uid: ").concat(f.uid):"uid: ".concat(this._uid);return ok.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(c)),setTimeout((()=>{ok.startUpload()}),5e3),this.store.joinEnd(),m=this,Lr(WO).call(WO,m)||WO.push(m),"disabled"===this._cloudProxyServerMode&&vk().supportWebCrypto&&IA("ENABLE_PRELOAD")&&NV(this._joinInfo),s}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===II.OPERATION_ABORTED?ok.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),t):ok.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),t),t.code!==II.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),d.onError(t),t}var m}_joinGateway(){if(!this._joinInfo||!this._key)throw new mk(II.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!IA("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){ok.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener($R()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=WO.indexOf(e);-1!==t&&WO.splice(t,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return ok.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState,JI.LEAVE),ok.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof dD))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new mk(II.INVALID_PARAMS,"param list is empty");const n=e;if("audience"===this._gateway.role)throw new mk(II.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof dD))throw new mk(II.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new mk(II.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}ok.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach((e=>{const t=this._configDistribute.getBitrateLimit();e instanceof LL&&t&&e.setBitrateLimit(t.uplink)}));try{await this._publishHighStream(n),ok.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))))}catch(e){throw ok.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{r()}}async _publishDataChannel(e){if(null==e)throw new mk(II.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));DI(e.id,"id",0,65535,!0),AI(e.ordered,"ordered"),LI(e.metadata,"metadata",0,512),ok.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex((t=>t.id===e.id)))throw new mk(II.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new mk(II.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&IA("FORCE_TURN")&&!IA("TURN_ENABLE_TCP")&&!IA("TURN_ENABLE_UDP"))throw new mk(II.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const t=function(e){return JF(e,!1)}(e),n=await this._p2pChannel.publishDataChannel([t]);if(n.length>0){if("number"!=typeof t._originDataChannelId)throw ok.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new mk(II.CREATE_DATACHANNEL_ERROR);try{await rh.all(n.map((e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)))),await t._waitTillOpen()}catch(e){if(e.code!==II.DISCONNECT_P2P)throw e}}return ok.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw ok.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new mk(II.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof dD))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);ok.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((e=>"".concat(e.getTrackId()," ")))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(Aj.UNPUBLISH,{unpubMsg:e},!0)}else{const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),ok.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((e=>"".concat(e.getTrackId())))))}}catch(e){throw ok.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),ok.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((e=>"".concat(e.id," ")))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),ok.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((e=>"".concat(e.id)))))}catch(e){throw ok.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof ZU)){const t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new mk(II.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(kI(t,"mediaType",["audio","video"]),this.store.useP2P)throw new mk(II.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new mk(II.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===mj.AUDIO,r=t===mj.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:i,ortc:a,rtxSsrcId:o,cname:s,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==i)throw new mk(II.UNEXPECTED_RESPONSE,"no ssrc id");let u=this._users.find((t=>t.uid===e));u||(u=new ZU(e,c||e),u._is_pre_created=!0,this._users.push(u)),s&&(u._cname=s),u._uintid||(u._uintid=c||e),n&&(u._audioSSRC=i,u._audio_pre_subscribed=!0,a&&(u._audioOrtc=a)),r&&(u._videoSSRC=i,u._video_pre_subscribed=!0,a&&(u._videoOrtc=a),null!=o&&(u._rtxSsrcId=o)),ok.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(i)),await this._p2pChannel.subscribe(u,t,i,o,a);const l=n?u._audioTrack:u._videoTrack;if(!l)throw new mk(II.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(u._trust_audio_stream_added_state_=!0,u._audio_added_=!0),r&&(u._trust_video_stream_added_state_=!0,u._video_added_=!0),l}catch(t){throw ok.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{i()}}async _subscribeDataChannel(e,t){var n;if(DI(t,"channelId",0,65535,!0),!this._joinInfo)throw new mk(II.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r)throw ok.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new mk(II.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw ok.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new mk(II.INVALID_REMOTE_USER,"user is not published");const i=null===(n=e._dataChannels)||void 0===n?void 0:n.find((e=>e.id===t));if(!i)throw ok.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new mk(II.REMOTE_USER_IS_NOT_PUBLISHED);const a=await this._subscribeMutex.lock();ok.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const n=await this._p2pChannel.subscribeDataChannel(e,[i]);if(n&&Lr(n).call(n,i.id))try{var o;if("number"!=typeof i._originDataChannelId)throw ok.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new mk(II.CREATE_DATACHANNEL_ERROR);const t={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:null!==(o=i.metadata)&&void 0!==o?o:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await i._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==II.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),t;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return ok.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{a()}}async _p2pSubscribe(e,t,n){if(kI(t,"mediaType",["audio","video"]),!this._joinInfo)throw new mk(II.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r){const t=new mk(II.INVALID_REMOTE_USER,"user is not in the channel");throw ok.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new mk(II.INVALID_REMOTE_USER,"user is not published");throw ok.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const n=new mk(II.REMOTE_USER_IS_NOT_PUBLISHED);throw ok.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const i=await this._subscribeMutex.lock();ok.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const n="audio"===t?e._audioSSRC:e._videoSSRC,r="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,n,r)}catch(e){throw e}ok.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{ok.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new mk(II.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(t){throw ok.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{i()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(kI(t,"mediaType",["audio","video"]),!this._joinInfo)throw new mk(II.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r){const t=new mk(II.INVALID_REMOTE_USER,"user is not in the channel");throw ok.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new mk(II.INVALID_REMOTE_USER,"user is not published");throw ok.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new mk(II.REMOTE_USER_IS_NOT_PUBLISHED);throw ok.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let i="audio"===t?e._audioSSRC:e._videoSSRC,a="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,s={stream_type:"audio"===t?mj.AUDIO:mj.VIDEO,ssrcId:i};"video"===t&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const c=await this._subscribeMutex.lock();ok.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const r="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==r&&r!==i&&(i=r,a="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,s={stream_type:"audio"===t?mj.AUDIO:mj.VIDEO,ssrcId:i}),YU.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,o,a);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,s,!0)}catch(n){if((null==n?void 0:n.code)!==II.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}ok.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{ok.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const r="audio"===t?e._audioTrack:e._videoTrack;if(!r)throw new mk(II.UNEXPECTED_ERROR,"can not find remote track in user object");return"video"===t&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),r}catch(t){throw ok.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{c()}}async massSubscribe(e){if(OI(e,"subscribeList"),!this._joinInfo)throw new mk(II.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();ok.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; ")));const i=(e=[...e]).map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}})),a=await this._p2pChannel.globalLock();try{var o;for(let t=e.length-1;t>=0;t--){const r=e[t],{user:a,mediaType:o}=r;if(kI(o,"mediaType",["audio","video"]),!a){const e=new mk(II.INVALID_PARAMS,"user property does not exist in subscribeList item");throw ok.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}const s=this._users.find((e=>e===a));if(!s){const n=new mk(II.INVALID_REMOTE_USER,"user is not in the channel");ok.error("[".concat(this._clientId,"] can not massSubscribe ").concat(a.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===o&&(!a.hasAudio||void 0===a._audioSSRC)||"video"===o&&(!a.hasVideo||void 0===a._videoSSRC)){const n=new mk(II.REMOTE_USER_IS_NOT_PUBLISHED);ok.error("[".concat(this._clientId,"] can not subscribe ").concat(a.uid," with mediaType ").concat(o,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}const c=oj.Video|oj.LwoVideo,u=n.get(a);if(u){if("video"===o?u&c:u&oj.Audio){e.splice(t,1),ok.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(a.uid,", mediaType:").concat(o," twice"));continue}n.set(a,u|("video"===o?c:oj.Audio))}else n.set(a,"video"===o?c:oj.Audio)}for(let t=e.length-1;t>=0;t--){const r=e[t],{user:i,mediaType:a}=r,o=oj.Video|oj.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,a)){await this._p2pChannel.unmuteRemoteNoLock(i,a);const r=n.get(i);n.set(i,"video"===a?r^o:r^oj.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map((e=>({userId:e.user.uid,type:e.mediaType}))),t);let r=ii(o=Array.from(n.entries())).call(o,((e,t)=>{let[n,r]=t;if(0===r)return e;const i={stream_id:n.uid,stream_type:r};return r&oj.Audio&&(i.audio_ssrc=n._audioSSRC),r&oj.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===mj.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===mj.VIDEO?t._rtxSsrcId:void 0}})));const n=new Map;if(r=r.filter((e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc)),r.length>0){const e=await this._gateway.subscribeAll(r,!0);((null==e?void 0:e.users)||[]).forEach((e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:a}=e;(r||i||a)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:a})}))}if(Array.from(n.entries()).length>0){const e=[];Array.from(n.entries()).forEach((t=>{let[n,r]=t;const i=this.remoteUsers.find((e=>e.uid===n));if(i){let t;r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=mj.VIDEO:r.audio_error_code&&(t=mj.AUDIO),e.push({user:i,mediaType:t})}})),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of i){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=jj(n);ok.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new mk(II.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter((e=>!e.error)).map((e=>({userId:e.user.uid,type:e.mediaType}))),void 0,Date.now()),i.forEach((e=>{var n;pk.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===mj.VIDEO,audio:e.mediaType===mj.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===mj.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)})),ok.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),i}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{a(),r()}}async unsubscribe(e,t,n){if(!(e instanceof ZU)){const t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new mk(II.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&kI(t,"mediaType",["audio","video"]),!this._joinInfo)throw new mk(II.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const r=this._users.find((t=>t===e));if(!r){const t=new mk(II.INVALID_REMOTE_USER,"user is not in the channel");throw ok.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}ok.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&lN(this._users,e),ok.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===II.DISCONNECT_P2P)return void ok.warning("disconnecting p2p, abort unsubscribe request.");throw ok.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&DI(t,"id",0,65535,!0),!this._joinInfo)throw new mk(II.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");const n=this._users.find((t=>t===e));if(!n){const t=new mk(II.INVALID_REMOTE_USER,"user is not in the channel");throw ok.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let r;if("number"==typeof t){const n=e._dataChannels.find((e=>e.id===t));n&&(r=[n])}else r=e._dataChannels;if(void 0===r){const n=new mk(II.REMOTE_USER_IS_NOT_PUBLISHED);throw ok.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}ok.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map((e=>e.id))));try{const t=await this._p2pChannel.unsubscribeDataChannel(e,r);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),ok.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===II.DISCONNECT_P2P)return void ok.warning("disconnecting p2p, abort unsubscribe request.");throw ok.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(OI(e,"unsubscribeList"),!this._joinInfo)throw new mk(II.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");ok.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const e=new mk(II.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw ok.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}kI(i,"mediaType",["video","audio",void 0]);const a=this._users.find((e=>e===r));if(!a){ok.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const o=oj.Video|oj.LwoVideo;if(t.has(r)){const a=t.get(r);let s;switch(i){case"video":s=a&o;break;case"audio":s=a&oj.Audio;break;default:s=a&(oj.Audio|o)}if(s){ok.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(r,a|oj.Audio):"video"===i&&t.set(r,a|o):t.set(r,a|oj.Audio|o)}else i?"audio"===i?t.set(r,oj.Audio):"video"===i&&t.set(r,o):t.set(r,oj.Audio|o)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),ok.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join()))}catch(e){if(e.code===II.DISCONNECT_P2P)return void ok.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw ok.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){!function(e){if(!e)throw new NI(II.INVALID_PARAMS);PI(e.width)||MI(e.width,"streamParameter.width"),PI(e.height)||MI(e.height,"streamParameter.height"),PI(e.framerate)||MI(e.framerate,"streamParameter.framerate"),PI(e.bitrate)||DI(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&ok.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),ok.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,bj.LocalVideoLowTrack)}async enableDualStream(){if(!vk().supportDualStream)throw pk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new mk(II.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new mk(II.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw pk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,pk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),ok.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new mk(II.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(bj.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw pk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,pk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),ok.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){kI(e,"role",["audience","host"])}(e),t&&eN(t),"rtc"===this.mode||"p2p"===this.mode)throw ok.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new mk(II.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new mk(II.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new mk(II.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&IA("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",nN.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),ok.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if("rtc"===this.mode||"p2p"===this.mode)return;if("audience"!==this._config.role||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&eN(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch(e){}finally{ok.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(LI(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new mk(II.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,pk.setProxyServer(this._proxyServer),ok.setProxyServer(this._proxyServer),ok.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new mk(II.INVALID_OPERATION,"You have already set the proxy")}if(ZI(e))return this._turnServer={servers:e,mode:"original-manual"},void ok.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((e=>e.urls)).join(","),"."));e.forEach((e=>$I(e))),this._turnServer={servers:e,mode:"manual"},ok.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"you should set license before join channel");if(LI(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new mk(II.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,ok.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new mk(II.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new mk(II.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new mk(II.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,ok.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"Stop proxy server after leave channel");pk.setProxyServer(),ok.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",ok.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new mk(II.INVALID_PARAMS,"accessPoints is required.");OI(e.accessPoints.serverList,"accessPoints.serverList"),LI(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{DI(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new mk(II.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");IA("CLOSE_AFB_FOR_LOCAL_AP")&&(RA("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),RA("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,a=e.accessPoints.serverList.map((e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e)),o=a.map((e=>"".concat(e,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,RA("WEBCS_DOMAIN",o),RA("WEBCS_DOMAIN_BACKUP_LIST",o),RA("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(OI(e.report.hostname,"report.hostname"),RA("EVENT_REPORT_DOMAIN",e.report.hostname[0]),RA("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(RA("EVENT_REPORT_DOMAIN",a[0]),RA("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),RA("STATS_COLLECTOR_PORT",s),e.report?RA("ENABLE_EVENT_REPORT",!0):RA("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(OI(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=a[0];let u=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),u=e.log.port),RA("LOG_UPLOAD_SERVER","".concat(c,":").concat(u));let l=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(OI(e.cds.hostname,"cds.hostname"),l=e.cds.hostname):l=a;let d=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),d=e.cds.port),RA("CDS_AP",l.map((e=>"".concat(e,":").concat(d)))),e.cds?RA("ENABLE_CONFIG_DISTRIBUTE",!0):RA("ENABLE_CONFIG_DISTRIBUTE",!1),ok.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(OI(e,"serverList"),LI(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new mk(II.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,RA("WEBCS_DOMAIN",e),RA("WEBCS_DOMAIN_BACKUP_LIST",e),RA("GATEWAY_DOMAINS",[t]),RA("EVENT_REPORT_DOMAIN",e[0]),RA("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),RA("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),ok.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(kI(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw ok.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else ok.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){kI(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const t=this._users.find((t=>t.uid===e));t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(e){throw ok.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}ok.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){kI(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw ok.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}ok.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){!function(e){kI(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),LI(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Lr(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new mk(II.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new mk(II.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(AI(r,"encryptDataStream"),!Lr(i).call(i,e))throw new mk(II.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||ok.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=yN(n))}async renewToken(e){if(LI(e,"token",1,2047),!this._key||!this._joinInfo)throw new mk(II.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(IA("USE_NEW_TOKEN")){ok.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await BU(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||BN);ok.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else ok.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});ok.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,ok.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?ok.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(tN.VOLUME_INDICATOR,e)}),IA("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new mk(II.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new mk(II.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new mk(II.LIVE_STREAMING_TASK_CONFLICT);const n=t?GP.TRANSCODE:GP.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(GP.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((t=>t&&t.hasUrl(e)));if(!t.length)throw new mk(II.INVALID_PARAMS,"can not find live streaming url to stop");await rh.all(t.map((t=>t&&t.stopLiveStreamingTask(e))))}async startChannelMediaRelay(e){JU(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){JU(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof tV&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new mk(II.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const t=new TextEncoder;e.payload=t.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Lr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(e,t,n){var r;const i=ii(r=Array.from(n)).call(r,((e,t)=>e+t),0),a={serverTs:0,seq:jA++,length:n.length,checkSum:i},o=new Uint8Array(DN(i,2)),s=new ArrayBuffer(PA),c=new DataView(s);c.setUint32(0,a.serverTs),c.setUint16(4,a.seq),c.setUint16(6,a.length),c.setUint16(8,a.checkSum);const u=16-n.length%16;n=_N(n,new Uint8Array(u));const l=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:MA,additionalData:o},t,n);return _N(new Uint8Array(s),new Uint8Array(l))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new mk(II.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(jP.DATA_STREAM,{payload:yN(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-aV},!n)}sendMetadata(e){if(!this._joinInfo)throw new mk(II.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new mk(II.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(jP.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:yN(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(ck),!this._joinInfo)throw new mk(II.INVALID_OPERATION,"can not send custom report, not joined");await pk.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(IA("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map((e=>e.uid+""));Object.keys(e).forEach((n=>{Lr(t).call(t,n)||delete e[n]}))}return e}async pickSVCLayer(e,t){kI(t.spatialLayer,"spatialLayer",[0,1,2,3]),kI(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw ok.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(AI(t,"apRTM"),DI(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,ok.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(ok.debug("[".concat(this._clientId,"] reset client")),function(e){const t=GO.indexOf(e);-1!==t&&GO.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=PR.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&AV(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&pk.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((e=>e._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new FN("client-publish",this._clientId),this._subscribeMutex=new FN("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var n;const r=e||TN();e?ok.debug("[".concat(this._clientId,"] new Session ").concat(r)):ok.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,pk.addSid(r);const a={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null==t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:"audience"===this.role?2:1};pk.sessionInit(this._sessionId,aW({cname:t.channel,appid:t.appId},a)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new mk(II.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&IA("FORCE_TURN")&&!IA("TURN_ENABLE_TCP")&&!IA("TURN_ENABLE_UDP"))throw new mk(II.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");ok.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const t=(await n.next()).value;if(t){try{await this._gateway.sendExtensionMessage(Aj.PUBLISH,t,!0)}catch(e){throw n.throw(e),e}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(e){if(e.code!==II.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=i)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof LL&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig).catch((e=>{ok.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===II.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new mk(II.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));ok.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==II.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=r)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===II.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new mk(II.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=(t={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},QF("LiveStreaming").create(t));var t;return e.onLiveStreamError=(e,t)=>{pk.reportApiInvoke(this._sessionId,{name:qI.ON_LIVE_STREAM_ERROR,options:[e,t],tag:KI.TRACER}).onSuccess(),this.safeEmit(tN.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{pk.reportApiInvoke(this._sessionId,{name:qI.ON_LIVE_STREAM_WARNING,options:[e,t],tag:KI.TRACER}).onSuccess(),this.safeEmit(tN.LIVE_STREAMING_WARNING,e,t)},e.on(QP.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new mk(II.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,n,r){const i=IA("UAP_AP").slice(0,IA("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")));return await yU(i,e,t,n,r)})(e,this._joinInfo,this._axiosCancelSource.token,BN).then(t).catch(n)})),e};return e===GP.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new mk(II.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},QF("ChannelMediaRelay").create(e));r.on("state",(e=>{e===tj.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(tN.CHANNEL_MEDIA_RELAY_STATE,e)})),r.on("event",(e=>{this.safeEmit(tN.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const e=[];this._users.forEach((t=>{t._dataChannels.forEach((r=>{n.every((e=>e.uid!==t._uintid||e.stream_id!==r.id))&&e.push({uid:t._uintid,stream_id:r.id,ordered:r.ordered,max_retrans_times:r.maxRetransmits,metadata:r.metadata})}))})),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(n)&&n.length>0&&n.forEach((e=>{const{uid:n,stream_id:r,ordered:a,max_retrans_times:o,metadata:s}=e,c=this._users.find((e=>e._uintid===n));if(c){if(ok.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),Lr(i).call(i,c)||i.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex((t=>t.id===e.stream_id))){const e={id:r,ordered:!!a,maxRetransmits:o,metadata:s},n=function(e){return JF(e,!0)}(e);c._dataChannels.push(n),ok.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(tN.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(ok.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch((e=>{ok.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())})))}else ok.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))})),t&&(this.safeEmit(tN.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach((e=>{const{uid:t,stream_id:n}=e,r=this._users.find((e=>e._uintid===t));if(!r)return void ok.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const i=r._dataChannels.find((t=>t.id===e.stream_id));i&&(ok.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(r,[i]).then((e=>{if(r._dataChannels=r._dataChannels.filter((e=>e!==i)),e)return this._gateway.unsubscribeDataChannel(e,r.uid)})),ok.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),this.safeEmit(tN.USER_UNPUBLISHED,r,"datachannel",i._config))}))}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=null===(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)||void 0===t?void 0:t.videoCodecs;if(n)for(const i of n){var r;if(i.payloadType===e)return null==i||null===(r=i.rtpMap)||void 0===r?void 0:r.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find((t=>t.uid===e.uid));if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){ok.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{ok.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((e=>{this.safeEmit(tN.USER_UNPUBLISHED,t,"datachannel",e._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)})),n()}}else ok.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ij.UPDATE_GATEWAY_CONFIG,(()=>{!function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void ok.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach((e=>{const{value:r,type:i,expires:a}=t[e];a&&a<=n||i||YO()||!Object.prototype.hasOwnProperty.call(EA,e)||(AA[e]=r,TA[e]=r,ok.debug("Update gateway parameters from config distribute",e,r))}))}catch(e){ok.error("Error update config from local cache",e.message)}}()})),this._gateway.on(ij.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(ij.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===JI.FALLBACK)return;const i=()=>{this.safeEmit(tN.CONNECTION_STATE_CHANGE,e,t,n)};if(pk.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:qI.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:KI.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),ok.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach((e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var a;this._streamFallbackTypeCacheMap.forEach(((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch((e=>{ok.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)}))})),this._remoteStreamTypeCacheMap.forEach(((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch((e=>{ok.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)}))})),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(a=this._joinInfo)||void 0===a?void 0:a.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{ok.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((e=>{ok.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter((e=>!e._trust_in_room_)).forEach((e=>{ok.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach((e=>{e._trust_audio_mute_state_||(ok.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,mj.AUDIO,!1)),e._trust_video_mute_state_||(ok.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,mj.VIDEO,!1)),e._trust_audio_enabled_state_||(ok.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(ok.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(ok.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(ok.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(ok.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))})))}),1e3))}i()})),this._gateway.on(ij.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new mk(II.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;const n=await RV(aW(aW({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(t=n.ap,kV(n),this._joinInfo.preload=!0):(t=await DU(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||BN,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);const r=[];t.gatewayInfo.gatewayAddrs.forEach((e=>{let{address:t}=e;const[n,i]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:n,port:i}):r.push({host:n,port:i})})),e(r)}catch(e){t(e)}})),this._gateway.on(ij.NETWORK_QUALITY,(e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(tN.NETWORK_QUALITY,e)})),this._gateway.on(ij.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(tN.STREAM_TYPE_CHANGED,e,t),pk.reportApiInvoke(this._sessionId,{name:qI.STREAM_TYPE_CHANGE,options:[e,t],tag:KI.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(ij.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(ij.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{let n=await this._p2pChannel.getEstablishParams();n&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(e){n(e)}})),this._gateway.on(ij.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:ok.debug("no attributes in joinResponse");const r=CF(e.ortc,t,n);this._p2pChannel.connect(r)})),this._gateway.on(ij.PRE_CONNECT_PC,(async e=>{const{candidates:t,fingerprint:n,turnServer:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:a,cid:o}=this._joinInfo.apResponse,s="".concat(o,"_").concat(a);if(s.length<4||s.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(a),icePwd:"".concat(o,"_").concat(a)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(i=IA("FINGERPRINT"))&&void 0!==i?i:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(e){e.code&&e.code===II.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:r,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(UP.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(UP.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(UP.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc))),this._gateway.signal.on(UP.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(UP.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(UP.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(UP.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(UP.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(UP.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,mj.AUDIO,!0))),this._gateway.signal.on(UP.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,mj.AUDIO,!1))),this._gateway.signal.on(UP.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,mj.VIDEO,!0))),this._gateway.signal.on(UP.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,mj.VIDEO,!1))),this._gateway.signal.on(UP.RECEIVE_METADATA,(e=>{const t=vN(e.metadata);this.safeEmit(tN.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(UP.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let n=vN(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Lr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<PA)throw new mk(II.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(PA));const t=await async function(e,t,n){const r=n.subarray(0,PA),i=r.slice(8,PA),a=(i[0]<<8)+i[1],o=(r[6]<<8)+r[7],s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:MA,additionalData:new Uint8Array(DN(a,2))},t,n.subarray(PA));return new Uint8Array(s).subarray(0,o)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n);n=t}let r=0;if(e.ordered||e.syncWithAudio){const t=this._p2pChannel.getStats(),n=this.remoteUsers.find((t=>t.uid===e.uid)),i=null==t?void 0:t.audioRecv.find((e=>e.ssrc===(null==n?void 0:n._audioSSRC)));r=null==i?void 0:i.jitterBufferMs}(null==r||Number.isNaN(r))&&(r=0),dV(aW(aW({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(UP.ON_CRYPT_ERROR,(()=>{gN((()=>{ok.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(tN.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(UP.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(UP.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{ok.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,JI.TOKEN_EXPIRE),this.safeEmit(tN.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(UP.ON_STREAM_FALLBACK_UPDATE,(e=>{ok.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(tN.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")})),this._gateway.signal.on(UP.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),ok.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(UP.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(UP.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(PP.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case jP.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var n,r;const i=e.some((e=>{let{stream_type:t}=e;return t===rj.Audio})),a=e.some((e=>{let{stream_type:t}=e;return t!==rj.Audio})),o=e.some((e=>{let{stream_type:t}=e;return t===rj.Screen||t===rj.ScreenLow}));"offer"===t.state&&pk.publish(this._joinInfo.sid,{eventElapse:YU.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:II.TIMEOUT,audio:i,video:a,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:o,audioName:i?null===(n=e.find((e=>{let{stream_type:t}=e;return t===rj.Audio})))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:a?null===(r=e.find((e=>{let{stream_type:t}=e;return t!==rj.Audio})))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0})}break}case jP.SUBSCRIBE:t&&pk.subscribe(this._joinInfo.sid,{succ:!1,ec:II.TIMEOUT,audio:t.stream_type===mj.AUDIO,video:t.stream_type===mj.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:YU.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}})),this._gateway.signal.on(UP.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(UP.ON_PUBLISHED_USER_LIST,(e=>{if(null==e||!e.users)return;IA("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((e=>!HO(e.string_id||e.stream_id,this.channelName))));const t=[],n=[];for(const r of e.users){let e=this._users.find((e=>e._uintid===r.stream_id));e?e._trust_in_room_=!0:(e=new ZU(r.string_id||r.stream_id,r.stream_id),this._users.push(e),this.store.firstVideoFrameDecoded(e.uid,{userJoinNotify:Date.now()}),0===this.getListeners(tN.PUBLISHED_USER_LIST).length&&(ok.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(tN.USER_JOINED,e)));const i=oj.Audio&r.stream_type,a=(oj.Video|oj.LwoVideo)&r.stream_type,o=0!=(65280&r.stream_type),s=i&&e.hasAudio,c=a&&e.hasVideo;a&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!s&&0===this.getListeners(tN.PUBLISHED_USER_LIST).length&&(ok.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(tN.USER_PUBLISHED,e,"audio")),a&&!c&&0===this.getListeners(tN.PUBLISHED_USER_LIST).length&&(ok.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(tN.USER_PUBLISHED,e,"video")),(i&&!s||a&&!c||o)&&t.push(e),a&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(ok.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((e=>{ok.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())}))),this.getListeners(tN.PUBLISHED_USER_LIST).length>0?IA("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(ok.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((e=>e.uid)).join(", "))),this.safeEmit(tN.PUBLISHED_USER_LIST,t)):ok.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((e=>e.uid)).join(", ")))})),this._gateway.signal.on(UP.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof tV&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((e=>e.toLowerCase())).filter((e=>{var t;return Lr(t=Object.keys(DA)).call(t,e)})))}))}_handleP2PEvents(){this._gateway.signal.on(UP.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(Aj.PUBLISH,((e,t,n)=>{const{uid:r}=e;e.forEach((e=>{const{kind:i,ssrcs:a,mid:o,isMuted:s}=e;this._handleP2PAddAudioOrVideoStream(i,r,a[0].ssrcId,o);const c=this._users.find((e=>e.uid===r));return c&&this.store.useP2P?this._p2pChannel.mockSubscribe(c,i,a[0].ssrcId,o).then((()=>{t()})).catch(n):t(),this._handleMuteStream(r,i,!!s)}))})),this._gateway.signal.on(Aj.CALL,(async(e,t,n)=>{if(this.store.useP2P)try{var r;t(await this._p2pChannel.startP2P({turnServer:null===(r=this._joinInfo)||void 0===r?void 0:r.turnServer},e))}catch(e){n(e)}})),this._gateway.signal.on(PP.P2P_CONNECTION,(async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(Aj.UNPUBLISH,(async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:r,uid:i}=e,a=this._users.find((e=>e.uid===i));if(!a)return ok.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach((async e=>{let{stream_type:t}=e;const n=t===rj.Audio?mj.AUDIO:mj.VIDEO;await this._p2pChannel.unsubscribe(a,n),this._handleMuteStream(i,n,!0)})),t()}catch(e){n(e)}}})),this._gateway.signal.on(Aj.CONTROL,(async(e,t)=>{const{action:n}=e;switch(n){case Dj.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,mj.VIDEO,!0);break;case Dj.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,mj.AUDIO,!0);break;case Dj.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,mj.VIDEO,!1);break;case Dj.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,mj.AUDIO,!1)}})),this._gateway.signal.on(Aj.RESTART_ICE,(async(e,t,n)=>{if(this.store.useP2P)try{const{direction:n,iceParameter:r}=e;n!==BP.SEND_ONLY||r?t(await this._p2pChannel.restartICE(n,r)):(this._p2pChannel.handleDisconnect(n),t())}catch(e){n(e)}})),this._gateway.signal.on(Aj.CANDIDATE,(e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}})),this._p2pChannel.on(wj.RequestP2PRestartICE,(async(e,t,n)=>{try{const{direction:n}=e;t(await this._gateway.sendExtensionMessage(Aj.RESTART_ICE,e,n===BP.SEND_ONLY))}catch(e){n(e)}})),this._p2pChannel.on(wj.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(Aj.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(wj.RequestP2PMuteLocal,(async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Aj.CONTROL,e,!0),t()}catch(e){n(e)}})),this._p2pChannel.on(wj.RequestP2PUnmuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===II.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(wj.RequestP2PMuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===II.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(wj.StateChange,((e,t)=>{t===_j.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(wj.PeerConnectionStateChange,(e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(tN.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)})),this._p2pChannel.on(wj.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===II.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(wj.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===II.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(wj.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(wj.RequestRePublishDataChannel,((e,t,n)=>{rh.all(e.map((async e=>{const t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach((e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)}))}catch(e){if(e.code!==II.DISCONNECT_P2P)throw e}}))).then(t).catch(n)})),this._p2pChannel.on(wj.RequestReSubscribe,(async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===mj.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}})),this._p2pChannel.on(wj.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(wj.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(wj.MediaReconnectStart,(e=>{this.safeEmit(tN.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(wj.MediaReconnectEnd,(e=>{this.safeEmit(tN.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(wj.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(wj.RequestRestartICE,(async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(e){return void t.throw(e)}const{iceParameters:a}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(i);await t.next({remoteIceParameters:a})})),this._p2pChannel.on(wj.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(wj.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),o=CF(i,a);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(wj.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(wj.P2PLost,(()=>{this.safeEmit(tN.P2P_LOST,this.store.uid)})),this._p2pChannel.on(wj.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(wj.ConnectionTypeChange,(e=>{this.safeEmit(tN.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(wj.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(wj.QueryClientConnectionState,(e=>{e(this.connectionState)})),this._p2pChannel.on(wj.AudioMetadata,(e=>{this.safeEmit(tN.AUDIO_METADATA,e)})),this._p2pChannel.on(wj.AudioPts,(e=>{this.safeEmit(tN.AUDIO_PTS,Number(e))}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new mk(II.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new mk(II.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},QF("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:a,token:o,uid:s,cid:c,vid:u}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:a,token:o,uid:s,cid:c,vid:u?Number(u):0},BN)}catch(e){throw Array.isArray(e)?e[0]:e}var t}handleVideoInspectEvents(e){e.on(Cj.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(tN.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Ej.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(tN.CONTENT_INSPECT_ERROR,new mk(II.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(Cj.INSPECT_RESULT,((e,t)=>{var n;if((null==t?void 0:t.code)===II.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return ok.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(tN.CONTENT_INSPECT_RESULT,e,t)})),e.on(Cj.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}async disableContentInspect(){if(!this._inspect)throw new mk(II.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(AI(e,"enabled"),e){if(!t)throw new mk(II.INVALID_PARAMS,"config is required");if(pz(t),!this._joinInfo)throw new mk(II.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const e=(n={config:t},QF("ImageModeration").create(n));this._moderation=e,this.handleImageModerationEvents(e);const{appId:r,cname:i,sid:a,token:o,uid:s,cid:c,vid:u}=this._joinInfo;await e.init({appId:r,areaCode:"",cname:i,sid:a,token:o,uid:s,cid:c,vid:u?Number(u):0},BN)}}catch(e){throw Array.isArray(e)?e[0]:e}}else{var n;if(!this._moderation)throw new mk(II.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(Ij.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(tN.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===Rj.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new mk(II.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(Ij.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}setP2PTransport(e){if(function(e){kI(e,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new mk(II.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,ok.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return ok.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){AI(e,"enabled"),RA("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},NP(rW.prototype,"leave",[gz],Object.getOwnPropertyDescriptor(rW.prototype,"leave"),rW.prototype),NP(rW.prototype,"publish",[vz],Object.getOwnPropertyDescriptor(rW.prototype,"publish"),rW.prototype),NP(rW.prototype,"unpublish",[yz],Object.getOwnPropertyDescriptor(rW.prototype,"unpublish"),rW.prototype),NP(rW.prototype,"subscribe",[bz],Object.getOwnPropertyDescriptor(rW.prototype,"subscribe"),rW.prototype),NP(rW.prototype,"presubscribe",[_z],Object.getOwnPropertyDescriptor(rW.prototype,"presubscribe"),rW.prototype),NP(rW.prototype,"massSubscribe",[wz],Object.getOwnPropertyDescriptor(rW.prototype,"massSubscribe"),rW.prototype),NP(rW.prototype,"unsubscribe",[Ez],Object.getOwnPropertyDescriptor(rW.prototype,"unsubscribe"),rW.prototype),NP(rW.prototype,"massUnsubscribe",[Sz],Object.getOwnPropertyDescriptor(rW.prototype,"massUnsubscribe"),rW.prototype),NP(rW.prototype,"setLowStreamParameter",[Cz],Object.getOwnPropertyDescriptor(rW.prototype,"setLowStreamParameter"),rW.prototype),NP(rW.prototype,"enableDualStream",[xz],Object.getOwnPropertyDescriptor(rW.prototype,"enableDualStream"),rW.prototype),NP(rW.prototype,"disableDualStream",[Tz],Object.getOwnPropertyDescriptor(rW.prototype,"disableDualStream"),rW.prototype),NP(rW.prototype,"setClientRole",[Rz],Object.getOwnPropertyDescriptor(rW.prototype,"setClientRole"),rW.prototype),NP(rW.prototype,"_setClientRoleOptions",[Iz],Object.getOwnPropertyDescriptor(rW.prototype,"_setClientRoleOptions"),rW.prototype),NP(rW.prototype,"setProxyServer",[Nz],Object.getOwnPropertyDescriptor(rW.prototype,"setProxyServer"),rW.prototype),NP(rW.prototype,"setTurnServer",[Az],Object.getOwnPropertyDescriptor(rW.prototype,"setTurnServer"),rW.prototype),NP(rW.prototype,"setLicense",[kz],Object.getOwnPropertyDescriptor(rW.prototype,"setLicense"),rW.prototype),NP(rW.prototype,"startProxyServer",[Dz],Object.getOwnPropertyDescriptor(rW.prototype,"startProxyServer"),rW.prototype),NP(rW.prototype,"stopProxyServer",[Mz],Object.getOwnPropertyDescriptor(rW.prototype,"stopProxyServer"),rW.prototype),NP(rW.prototype,"setLocalAccessPointsV2",[Lz],Object.getOwnPropertyDescriptor(rW.prototype,"setLocalAccessPointsV2"),rW.prototype),NP(rW.prototype,"setLocalAccessPoints",[Oz],Object.getOwnPropertyDescriptor(rW.prototype,"setLocalAccessPoints"),rW.prototype),NP(rW.prototype,"setRemoteDefaultVideoStreamType",[Pz],Object.getOwnPropertyDescriptor(rW.prototype,"setRemoteDefaultVideoStreamType"),rW.prototype),NP(rW.prototype,"setRemoteVideoStreamType",[jz],Object.getOwnPropertyDescriptor(rW.prototype,"setRemoteVideoStreamType"),rW.prototype),NP(rW.prototype,"setStreamFallbackOption",[Fz],Object.getOwnPropertyDescriptor(rW.prototype,"setStreamFallbackOption"),rW.prototype),NP(rW.prototype,"setEncryptionConfig",[Uz],Object.getOwnPropertyDescriptor(rW.prototype,"setEncryptionConfig"),rW.prototype),NP(rW.prototype,"renewToken",[Bz],Object.getOwnPropertyDescriptor(rW.prototype,"renewToken"),rW.prototype),NP(rW.prototype,"enableAudioVolumeIndicator",[Vz],Object.getOwnPropertyDescriptor(rW.prototype,"enableAudioVolumeIndicator"),rW.prototype),NP(rW.prototype,"startLiveStreaming",[zz],Object.getOwnPropertyDescriptor(rW.prototype,"startLiveStreaming"),rW.prototype),NP(rW.prototype,"setLiveTranscoding",[Wz],Object.getOwnPropertyDescriptor(rW.prototype,"setLiveTranscoding"),rW.prototype),NP(rW.prototype,"stopLiveStreaming",[Gz],Object.getOwnPropertyDescriptor(rW.prototype,"stopLiveStreaming"),rW.prototype),NP(rW.prototype,"startChannelMediaRelay",[Hz],Object.getOwnPropertyDescriptor(rW.prototype,"startChannelMediaRelay"),rW.prototype),NP(rW.prototype,"updateChannelMediaRelay",[Yz],Object.getOwnPropertyDescriptor(rW.prototype,"updateChannelMediaRelay"),rW.prototype),NP(rW.prototype,"stopChannelMediaRelay",[qz],Object.getOwnPropertyDescriptor(rW.prototype,"stopChannelMediaRelay"),rW.prototype),NP(rW.prototype,"sendCustomReportMessage",[Kz],Object.getOwnPropertyDescriptor(rW.prototype,"sendCustomReportMessage"),rW.prototype),NP(rW.prototype,"pickSVCLayer",[Xz],Object.getOwnPropertyDescriptor(rW.prototype,"pickSVCLayer"),rW.prototype),NP(rW.prototype,"setRTMConfig",[Qz],Object.getOwnPropertyDescriptor(rW.prototype,"setRTMConfig"),rW.prototype),NP(rW.prototype,"enableContentInspect",[Jz],Object.getOwnPropertyDescriptor(rW.prototype,"enableContentInspect"),rW.prototype),NP(rW.prototype,"disableContentInspect",[Zz],Object.getOwnPropertyDescriptor(rW.prototype,"disableContentInspect"),rW.prototype),NP(rW.prototype,"setImageModeration",[$z],Object.getOwnPropertyDescriptor(rW.prototype,"setImageModeration"),rW.prototype),NP(rW.prototype,"setP2PTransport",[eW],Object.getOwnPropertyDescriptor(rW.prototype,"setP2PTransport"),rW.prototype),NP(rW.prototype,"getJoinChannelServiceRecords",[tW],Object.getOwnPropertyDescriptor(rW.prototype,"getJoinChannelServiceRecords"),rW.prototype),NP(rW.prototype,"setPublishAudioFilterEnabled",[nW],Object.getOwnPropertyDescriptor(rW.prototype,"setPublishAudioFilterEnabled"),rW.prototype),rW);class sW{constructor(e,t){dx(this,"id",0),dx(this,"element",void 0),dx(this,"peerPair",void 0),dx(this,"context",void 0),dx(this,"audioPlayerElement",void 0),dx(this,"audioTrack",void 0),sW.count+=1,this.id=sW.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new rh((t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}}))},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(e){throw new mk(II.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new mk(II.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new mk(II.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){ok.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((e=>{e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var cW,uW;dx(sW,"count",0);const lW=window.AudioContext||window.webkitAudioContext,dW=new(cW=hk({report:pk}),NP((uW=class{constructor(){dx(this,"units",[]),dx(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return ok.debug("the system does not need to process local aec"),-1;this.context||(this.context=new lW);let t=this.units.find((t=>t&&t.getElement()===e));return t||(t=new sW(e,this.context),this.units.push(t)),t.startEchoCancellation(),ok.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return qR().name!==WR.SAFARI}}).prototype,"processExternalMediaAEC",[cW],Object.getOwnPropertyDescriptor(uW.prototype,"processExternalMediaAEC"),uW.prototype),uW);function fW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fW(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const pW=window||document;function mW(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!pW)return;const n=OK._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=e=>{if(!(e&&e.blockedURI&&(OK.onSecurityPolicyViolation||OK.getListeners(Tj.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;IA("CSP_DETECTED_HOSTNAME_LIST").some((e=>Lr(t).call(t,e)))&&(OK.onSecurityPolicyViolation&&"function"==typeof OK.onSecurityPolicyViolation&&OK.onSecurityPolicyViolation(e),OK.getListeners(Tj.SECURITY_POLICY_VIOLATION).length>0&&OK.safeEmit(Tj.SECURITY_POLICY_VIOLATION,e))};n&&pW.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||OK.getListeners(Tj.SECURITY_POLICY_VIOLATION).length>0)&&pW.addEventListener("securitypolicyviolation",r),OK._cspEventHandlerPointer=r}var gW=d,vW=Ix,yW=RegExp.prototype,bW=function(e){return e===yW||gW(yW,e)?vW(e):e.flags},_W=r(bW);function wW(e){let t=e.length;for(;--t>=0;)e[t]=0}const EW=256,SW=286,CW=30,xW=15,TW=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),RW=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),IW=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),NW=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),AW=new Array(576);wW(AW);const kW=new Array(60);wW(kW);const DW=new Array(512);wW(DW);const MW=new Array(256);wW(MW);const LW=new Array(29);wW(LW);const OW=new Array(CW);function PW(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let jW,FW,UW;function BW(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}wW(OW);const VW=e=>e<256?DW[e]:DW[256+(e>>>7)],zW=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},WW=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,zW(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},GW=(e,t,n)=>{WW(e,n[2*t],n[2*t+1])},HW=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},YW=(e,t,n)=>{const r=new Array(16);let i,a,o=0;for(i=1;i<=xW;i++)o=o+n[i-1]<<1,r[i]=o;for(a=0;a<=t;a++){let t=e[2*a+1];0!==t&&(e[2*a]=HW(r[t]++,t))}},qW=e=>{let t;for(t=0;t<SW;t++)e.dyn_ltree[2*t]=0;for(t=0;t<CW;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},KW=e=>{e.bi_valid>8?zW(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},XW=(e,t,n,r)=>{const i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},QW=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&XW(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!XW(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},JW=(e,t,n)=>{let r,i,a,o,s=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+s++],r+=(255&e.pending_buf[e.sym_buf+s++])<<8,i=e.pending_buf[e.sym_buf+s++],0===r?GW(e,i,t):(a=MW[i],GW(e,a+EW+1,t),o=TW[a],0!==o&&(i-=LW[a],WW(e,i,o)),r--,a=VW(r),GW(e,a,n),o=RW[a],0!==o&&(r-=OW[a],WW(e,r,o)))}while(s<e.sym_next);GW(e,256,t)},ZW=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems;let o,s,c,u=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<a;o++)0!==n[2*o]?(e.heap[++e.heap_len]=u=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=u<2?++u:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=r[2*c+1]);for(t.max_code=u,o=e.heap_len>>1;o>=1;o--)QW(e,n,o);c=a;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],QW(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=s,n[2*c]=n[2*o]+n[2*s],e.depth[c]=(e.depth[o]>=e.depth[s]?e.depth[o]:e.depth[s])+1,n[2*o+1]=n[2*s+1]=c,e.heap[1]=c++,QW(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,c=t.stat_desc.max_length;let u,l,d,f,h,p,m=0;for(f=0;f<=xW;f++)e.bl_count[f]=0;for(n[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)l=e.heap[u],f=n[2*n[2*l+1]+1]+1,f>c&&(f=c,m++),n[2*l+1]=f,l>r||(e.bl_count[f]++,h=0,l>=s&&(h=o[l-s]),p=n[2*l],e.opt_len+=p*(f+h),a&&(e.static_len+=p*(i[2*l+1]+h)));if(0!==m){do{for(f=c-1;0===e.bl_count[f];)f--;e.bl_count[f]--,e.bl_count[f+1]+=2,e.bl_count[c]--,m-=2}while(m>0);for(f=c;0!==f;f--)for(l=e.bl_count[f];0!==l;)d=e.heap[--u],d>r||(n[2*d+1]!==f&&(e.opt_len+=(f-n[2*d+1])*n[2*d],n[2*d+1]=f),l--)}})(e,t),YW(n,u,e.bl_count)},$W=(e,t,n)=>{let r,i,a=-1,o=t[1],s=0,c=7,u=4;for(0===o&&(c=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<c&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4))},eG=(e,t,n)=>{let r,i,a=-1,o=t[1],s=0,c=7,u=4;for(0===o&&(c=138,u=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<c&&i===o)){if(s<u)do{GW(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(GW(e,i,e.bl_tree),s--),GW(e,16,e.bl_tree),WW(e,s-3,2)):s<=10?(GW(e,17,e.bl_tree),WW(e,s-3,3)):(GW(e,18,e.bl_tree),WW(e,s-11,7));s=0,a=i,0===o?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4)}};let tG=!1;const nG=(e,t,n,r)=>{WW(e,0+(r?1:0),3),KW(e),zW(e,n),zW(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var rG=e=>{tG||((()=>{let e,t,n,r,i;const a=new Array(16);for(n=0,r=0;r<28;r++)for(LW[r]=n,e=0;e<1<<TW[r];e++)MW[n++]=r;for(MW[n-1]=r,i=0,r=0;r<16;r++)for(OW[r]=i,e=0;e<1<<RW[r];e++)DW[i++]=r;for(i>>=7;r<CW;r++)for(OW[r]=i<<7,e=0;e<1<<RW[r]-7;e++)DW[256+i++]=r;for(t=0;t<=xW;t++)a[t]=0;for(e=0;e<=143;)AW[2*e+1]=8,e++,a[8]++;for(;e<=255;)AW[2*e+1]=9,e++,a[9]++;for(;e<=279;)AW[2*e+1]=7,e++,a[7]++;for(;e<=287;)AW[2*e+1]=8,e++,a[8]++;for(YW(AW,287,a),e=0;e<CW;e++)kW[2*e+1]=5,kW[2*e]=HW(e,5);jW=new PW(AW,TW,257,SW,xW),FW=new PW(kW,RW,0,CW,xW),UW=new PW(new Array(0),IW,0,19,7)})(),tG=!0),e.l_desc=new BW(e.dyn_ltree,jW),e.d_desc=new BW(e.dyn_dtree,FW),e.bl_desc=new BW(e.bl_tree,UW),e.bi_buf=0,e.bi_valid=0,qW(e)},iG=(e,t,n,r)=>{let i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<EW;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ZW(e,e.l_desc),ZW(e,e.d_desc),o=(e=>{let t;for($W(e,e.dyn_ltree,e.l_desc.max_code),$W(e,e.dyn_dtree,e.d_desc.max_code),ZW(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*NW[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?nG(e,t,n,r):4===e.strategy||a===i?(WW(e,2+(r?1:0),3),JW(e,AW,kW)):(WW(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(WW(e,t-257,5),WW(e,n-1,5),WW(e,r-4,4),i=0;i<r;i++)WW(e,e.bl_tree[2*NW[i]+1],3);eG(e,e.dyn_ltree,t-1),eG(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),JW(e,e.dyn_ltree,e.dyn_dtree)),qW(e),r&&KW(e)},aG=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(MW[n]+EW+1)]++,e.dyn_dtree[2*VW(t)]++),e.sym_next===e.sym_end),oG=e=>{WW(e,2,3),GW(e,256,AW),(e=>{16===e.bi_valid?(zW(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},sG={_tr_init:rG,_tr_stored_block:nG,_tr_flush_block:iG,_tr_tally:aG,_tr_align:oG},cG=(e,t,n,r)=>{let i=65535&e,a=e>>>16&65535,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{i=i+t[r++]|0,a=a+i|0}while(--o);i%=65521,a%=65521}return i|a<<16};const uG=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var lG=(e,t,n,r)=>{const i=uG,a=r+n;e^=-1;for(let o=r;o<a;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},dG={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},fG={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:hG,_tr_stored_block:pG,_tr_flush_block:mG,_tr_tally:gG,_tr_align:vG}=sG,{Z_NO_FLUSH:yG,Z_PARTIAL_FLUSH:bG,Z_FULL_FLUSH:_G,Z_FINISH:wG,Z_BLOCK:EG,Z_OK:SG,Z_STREAM_END:CG,Z_STREAM_ERROR:xG,Z_DATA_ERROR:TG,Z_BUF_ERROR:RG,Z_DEFAULT_COMPRESSION:IG,Z_FILTERED:NG,Z_HUFFMAN_ONLY:AG,Z_RLE:kG,Z_FIXED:DG,Z_DEFAULT_STRATEGY:MG,Z_UNKNOWN:LG,Z_DEFLATED:OG}=fG,PG=286,jG=30,FG=19,UG=2*PG+1,BG=15,VG=258,zG=262,WG=42,GG=113,HG=666,YG=(e,t)=>(e.msg=dG[t],t),qG=e=>2*e-(e>4?9:0),KG=e=>{let t=e.length;for(;--t>=0;)e[t]=0},XG=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let QG=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const JG=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},ZG=(e,t)=>{mG(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,JG(e.strm)},$G=(e,t)=>{e.pending_buf[e.pending++]=t},eH=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},tH=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=cG(e.adler,t,i,n):2===e.state.wrap&&(e.adler=lG(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},nH=(e,t)=>{let n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match;const c=e.strstart>e.w_size-zG?e.strstart-(e.w_size-zG):0,u=e.window,l=e.w_mask,d=e.prev,f=e.strstart+VG;let h=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(n=t,u[n+o]===p&&u[n+o-1]===h&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<f);if(r=VG-(f-a),a=f-VG,r>o){if(e.match_start=t,o=r,r>=s)break;h=u[a+o-1],p=u[a+o]}}}while((t=d[t&l])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead},rH=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-zG)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),XG(e),r+=t),0===e.strm.avail_in)break;if(n=tH(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=QG(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=QG(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<zG&&0!==e.strm.avail_in)},iH=(e,t)=>{let n,r,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,s=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<a&&(0===n&&t!==wG||t===yG||n!==r+e.strm.avail_in))break;o=t===wG&&n===r+e.strm.avail_in?1:0,pG(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,JG(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(tH(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==yG&&t!==wG&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(tH(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,a=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=a||(r||t===wG)&&t!==yG&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,o=t===wG&&0===e.strm.avail_in&&n===r?1:0,pG(e,e.block_start,n,o),e.block_start+=n,JG(e.strm)),o?3:1)},aH=(e,t)=>{let n,r;for(;;){if(e.lookahead<zG){if(rH(e),e.lookahead<zG&&t===yG)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=QG(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-zG&&(e.match_length=nH(e,n)),e.match_length>=3)if(r=gG(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=QG(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=QG(e,e.ins_h,e.window[e.strstart+1]);else r=gG(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(ZG(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===wG?(ZG(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZG(e,!1),0===e.strm.avail_out)?1:2},oH=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<zG){if(rH(e),e.lookahead<zG&&t===yG)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=QG(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-zG&&(e.match_length=nH(e,n),e.match_length<=5&&(e.strategy===NG||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=gG(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=QG(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(ZG(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=gG(e,0,e.window[e.strstart-1]),r&&ZG(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=gG(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===wG?(ZG(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZG(e,!1),0===e.strm.avail_out)?1:2};function sH(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const cH=[new sH(0,0,0,0,iH),new sH(4,4,8,4,aH),new sH(4,5,16,8,aH),new sH(4,6,32,32,aH),new sH(4,4,16,16,oH),new sH(8,16,32,32,oH),new sH(8,16,128,128,oH),new sH(8,32,128,256,oH),new sH(32,128,258,1024,oH),new sH(32,258,258,4096,oH)];function uH(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=OG,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*UG),this.dyn_dtree=new Uint16Array(2*(2*jG+1)),this.bl_tree=new Uint16Array(2*(2*FG+1)),KG(this.dyn_ltree),KG(this.dyn_dtree),KG(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(BG+1),this.heap=new Uint16Array(2*PG+1),KG(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*PG+1),KG(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const lH=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==WG&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==GG&&t.status!==HG?1:0},dH=e=>{if(lH(e))return YG(e,xG);e.total_in=e.total_out=0,e.data_type=LG;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?WG:GG,e.adler=2===t.wrap?0:1,t.last_flush=-2,hG(t),SG},fH=e=>{const t=dH(e);return t===SG&&(e=>{e.window_size=2*e.w_size,KG(e.head),e.max_lazy_match=cH[e.level].max_lazy,e.good_match=cH[e.level].good_length,e.nice_match=cH[e.level].nice_length,e.max_chain_length=cH[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},hH=(e,t,n,r,i,a)=>{if(!e)return xG;let o=1;if(t===IG&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==OG||r<8||r>15||t<0||t>9||a<0||a>DG||8===r&&1!==o)return YG(e,xG);8===r&&(r=9);const s=new uH;return e.state=s,s.strm=e,s.status=WG,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=a,s.method=n,fH(e)};var pH=(e,t)=>{if(lH(e)||t>EG||t<0)return e?YG(e,xG):xG;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===HG&&t!==wG)return YG(e,0===e.avail_out?RG:xG);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(JG(e),0===e.avail_out)return n.last_flush=-1,SG}else if(0===e.avail_in&&qG(t)<=qG(r)&&t!==wG)return YG(e,RG);if(n.status===HG&&0!==e.avail_in)return YG(e,RG);if(n.status===WG&&0===n.wrap&&(n.status=GG),n.status===WG){let t=OG+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=AG||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,eH(n,t),0!==n.strstart&&(eH(n,e.adler>>>16),eH(n,65535&e.adler)),e.adler=1,n.status=GG,JG(e),0!==n.pending)return n.last_flush=-1,SG}if(57===n.status)if(e.adler=0,$G(n,31),$G(n,139),$G(n,8),n.gzhead)$G(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),$G(n,255&n.gzhead.time),$G(n,n.gzhead.time>>8&255),$G(n,n.gzhead.time>>16&255),$G(n,n.gzhead.time>>24&255),$G(n,9===n.level?2:n.strategy>=AG||n.level<2?4:0),$G(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&($G(n,255&n.gzhead.extra.length),$G(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=lG(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if($G(n,0),$G(n,0),$G(n,0),$G(n,0),$G(n,0),$G(n,9===n.level?2:n.strategy>=AG||n.level<2?4:0),$G(n,3),n.status=GG,JG(e),0!==n.pending)return n.last_flush=-1,SG;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=lG(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,JG(e),0!==n.pending)return n.last_flush=-1,SG;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=lG(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=lG(e.adler,n.pending_buf,n.pending-r,r)),JG(e),0!==n.pending)return n.last_flush=-1,SG;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,$G(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=lG(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=lG(e.adler,n.pending_buf,n.pending-r,r)),JG(e),0!==n.pending)return n.last_flush=-1,SG;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,$G(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=lG(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(JG(e),0!==n.pending))return n.last_flush=-1,SG;$G(n,255&e.adler),$G(n,e.adler>>8&255),e.adler=0}if(n.status=GG,JG(e),0!==n.pending)return n.last_flush=-1,SG}if(0!==e.avail_in||0!==n.lookahead||t!==yG&&n.status!==HG){let r=0===n.level?iH(n,t):n.strategy===AG?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(rH(e),0===e.lookahead)){if(t===yG)return 1;break}if(e.match_length=0,n=gG(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(ZG(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===wG?(ZG(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZG(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===kG?((e,t)=>{let n,r,i,a;const o=e.window;for(;;){if(e.lookahead<=VG){if(rH(e),e.lookahead<=VG&&t===yG)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){a=e.strstart+VG;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=VG-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=gG(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=gG(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(ZG(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===wG?(ZG(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ZG(e,!1),0===e.strm.avail_out)?1:2})(n,t):cH[n.level].func(n,t);if(3!==r&&4!==r||(n.status=HG),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),SG;if(2===r&&(t===bG?vG(n):t!==EG&&(pG(n,0,0,!1),t===_G&&(KG(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),JG(e),0===e.avail_out))return n.last_flush=-1,SG}return t!==wG?SG:n.wrap<=0?CG:(2===n.wrap?($G(n,255&e.adler),$G(n,e.adler>>8&255),$G(n,e.adler>>16&255),$G(n,e.adler>>24&255),$G(n,255&e.total_in),$G(n,e.total_in>>8&255),$G(n,e.total_in>>16&255),$G(n,e.total_in>>24&255)):(eH(n,e.adler>>>16),eH(n,65535&e.adler)),JG(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?SG:CG)},mH=(e,t)=>{let n=t.length;if(lH(e))return xG;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==WG||r.lookahead)return xG;if(1===i&&(e.adler=cG(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(KG(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const a=e.avail_in,o=e.next_in,s=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,rH(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=QG(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,rH(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=s,e.avail_in=a,r.wrap=i,SG},gH={deflateInit:(e,t)=>hH(e,t,OG,15,8,MG),deflateInit2:hH,deflateReset:fH,deflateResetKeep:dH,deflateSetHeader:(e,t)=>lH(e)||2!==e.state.wrap?xG:(e.state.gzhead=t,SG),deflate:pH,deflateEnd:e=>{if(lH(e))return xG;const t=e.state.status;return e.state=null,t===GG?YG(e,TG):SG},deflateSetDictionary:mH,deflateInfo:"pako deflate (from Nodeca project)"};const vH=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var yH={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)vH(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,a=e.length;r<a;r++){let t=e[r];n.set(t,i),i+=t.length}return n}};let bH=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){bH=!1}const _H=new Uint8Array(256);for(let n=0;n<256;n++)_H[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;_H[254]=_H[254]=1;var wH={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,a,o=e.length,s=0;for(i=0;i<o;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<o&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,i=0;a<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<o&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const a=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){a[i++]=t;continue}let o=_H[t];if(o>4)a[i++]=65533,r+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&r<n;)t=t<<6|63&e[r++],o--;o>1?a[i++]=65533:t<65536?a[i++]=t:(t-=65536,a[i++]=55296|t>>10&1023,a[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&bH)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(a,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+_H[e[n]]>t?n:t}},EH=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const SH=Object.prototype.toString,{Z_NO_FLUSH:CH,Z_SYNC_FLUSH:xH,Z_FULL_FLUSH:TH,Z_FINISH:RH,Z_OK:IH,Z_STREAM_END:NH,Z_DEFAULT_COMPRESSION:AH,Z_DEFAULT_STRATEGY:kH,Z_DEFLATED:DH}=fG;function MH(e){this.options=yH.assign({level:AH,method:DH,chunkSize:16384,windowBits:15,memLevel:8,strategy:kH},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new EH,this.strm.avail_out=0;let n=gH.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==IH)throw new Error(dG[n]);if(t.header&&gH.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?wH.string2buf(t.dictionary):"[object ArrayBuffer]"===SH.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=gH.deflateSetDictionary(this.strm,e),n!==IH)throw new Error(dG[n]);this._dict_set=!0}}function LH(e,t){const n=new MH(t);if(n.push(e,!0),n.err)throw n.msg||dG[n.err];return n.result}MH.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,a;if(this.ended)return!1;for(a=t===~~t?t:!0===t?RH:CH,"string"==typeof e?n.input=wH.string2buf(e):"[object ArrayBuffer]"===SH.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(a===xH||a===TH)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=gH.deflate(n,a),i===NH)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=gH.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===IH;if(0!==n.avail_out){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},MH.prototype.onData=function(e){this.chunks.push(e)},MH.prototype.onEnd=function(e){e===IH&&(this.result=yH.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var OH={Deflate:MH,deflate:LH,deflateRaw:function(e,t){return(t=t||{}).raw=!0,LH(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,LH(e,t)},constants:fG};const PH=16209;var jH=function(e,t){let n,r,i,a,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w,E,S,C,x;const T=e.state;n=e.next_in,C=e.input,r=n+(e.avail_in-5),i=e.next_out,x=e.output,a=i-(t-e.avail_out),o=i+(e.avail_out-257),s=T.dmax,c=T.wsize,u=T.whave,l=T.wnext,d=T.window,f=T.hold,h=T.bits,p=T.lencode,m=T.distcode,g=(1<<T.lenbits)-1,v=(1<<T.distbits)-1;e:do{h<15&&(f+=C[n++]<<h,h+=8,f+=C[n++]<<h,h+=8),y=p[f&g];t:for(;;){if(b=y>>>24,f>>>=b,h-=b,b=y>>>16&255,0===b)x[i++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=p[(65535&y)+(f&(1<<b)-1)];continue t}if(32&b){T.mode=16191;break e}e.msg="invalid literal/length code",T.mode=PH;break e}_=65535&y,b&=15,b&&(h<b&&(f+=C[n++]<<h,h+=8),_+=f&(1<<b)-1,f>>>=b,h-=b),h<15&&(f+=C[n++]<<h,h+=8,f+=C[n++]<<h,h+=8),y=m[f&v];n:for(;;){if(b=y>>>24,f>>>=b,h-=b,b=y>>>16&255,!(16&b)){if(0==(64&b)){y=m[(65535&y)+(f&(1<<b)-1)];continue n}e.msg="invalid distance code",T.mode=PH;break e}if(w=65535&y,b&=15,h<b&&(f+=C[n++]<<h,h+=8,h<b&&(f+=C[n++]<<h,h+=8)),w+=f&(1<<b)-1,w>s){e.msg="invalid distance too far back",T.mode=PH;break e}if(f>>>=b,h-=b,b=i-a,w>b){if(b=w-b,b>u&&T.sane){e.msg="invalid distance too far back",T.mode=PH;break e}if(E=0,S=d,0===l){if(E+=c-b,b<_){_-=b;do{x[i++]=d[E++]}while(--b);E=i-w,S=x}}else if(l<b){if(E+=c+l-b,b-=l,b<_){_-=b;do{x[i++]=d[E++]}while(--b);if(E=0,l<_){b=l,_-=b;do{x[i++]=d[E++]}while(--b);E=i-w,S=x}}}else if(E+=l-b,b<_){_-=b;do{x[i++]=d[E++]}while(--b);E=i-w,S=x}for(;_>2;)x[i++]=S[E++],x[i++]=S[E++],x[i++]=S[E++],_-=3;_&&(x[i++]=S[E++],_>1&&(x[i++]=S[E++]))}else{E=i-w;do{x[i++]=x[E++],x[i++]=x[E++],x[i++]=x[E++],_-=3}while(_>2);_&&(x[i++]=x[E++],_>1&&(x[i++]=x[E++]))}break}}break}}while(n<r&&i<o);_=h>>3,n-=_,h-=_<<3,f&=(1<<h)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),T.hold=f,T.bits=h};const FH=15,UH=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),BH=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),VH=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),zH=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var WH=(e,t,n,r,i,a,o,s)=>{const c=s.bits;let u,l,d,f,h,p,m=0,g=0,v=0,y=0,b=0,_=0,w=0,E=0,S=0,C=0,x=null;const T=new Uint16Array(16),R=new Uint16Array(16);let I,N,A,k=null;for(m=0;m<=FH;m++)T[m]=0;for(g=0;g<r;g++)T[t[n+g]]++;for(b=c,y=FH;y>=1&&0===T[y];y--);if(b>y&&(b=y),0===y)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(v=1;v<y&&0===T[v];v++);for(b<v&&(b=v),E=1,m=1;m<=FH;m++)if(E<<=1,E-=T[m],E<0)return-1;if(E>0&&(0===e||1!==y))return-1;for(R[1]=0,m=1;m<FH;m++)R[m+1]=R[m]+T[m];for(g=0;g<r;g++)0!==t[n+g]&&(o[R[t[n+g]]++]=g);if(0===e?(x=k=o,p=20):1===e?(x=UH,k=BH,p=257):(x=VH,k=zH,p=0),C=0,g=0,m=v,h=a,_=b,w=0,d=-1,S=1<<b,f=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){I=m-w,o[g]+1<p?(N=0,A=o[g]):o[g]>=p?(N=k[o[g]-p],A=x[o[g]-p]):(N=96,A=0),u=1<<m-w,l=1<<_,v=l;do{l-=u,i[h+(C>>w)+l]=I<<24|N<<16|A}while(0!==l);for(u=1<<m-1;C&u;)u>>=1;if(0!==u?(C&=u-1,C+=u):C=0,g++,0==--T[m]){if(m===y)break;m=t[n+o[g]]}if(m>b&&(C&f)!==d){for(0===w&&(w=b),h+=v,_=m-w,E=1<<_;_+w<y&&(E-=T[_+w],!(E<=0));)_++,E<<=1;if(S+=1<<_,1===e&&S>852||2===e&&S>592)return 1;d=C&f,i[d]=b<<24|_<<16|h-a}}return 0!==C&&(i[h+C]=m-w<<24|64<<16),s.bits=b,0};const{Z_FINISH:GH,Z_BLOCK:HH,Z_TREES:YH,Z_OK:qH,Z_STREAM_END:KH,Z_NEED_DICT:XH,Z_STREAM_ERROR:QH,Z_DATA_ERROR:JH,Z_MEM_ERROR:ZH,Z_BUF_ERROR:$H,Z_DEFLATED:eY}=fG,tY=16180,nY=16190,rY=16191,iY=16192,aY=16194,oY=16199,sY=16200,cY=16206,uY=16209,lY=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function dY(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const fY=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<tY||t.mode>16211?1:0},hY=e=>{if(fY(e))return QH;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=tY,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,qH},pY=e=>{if(fY(e))return QH;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,hY(e)},mY=(e,t)=>{let n;if(fY(e))return QH;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?QH:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,pY(e))},gY=(e,t)=>{if(!e)return QH;const n=new dY;e.state=n,n.strm=e,n.window=null,n.mode=tY;const r=mY(e,t);return r!==qH&&(e.state=null),r};let vY,yY,bY=!0;const _Y=e=>{if(bY){vY=new Int32Array(512),yY=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(WH(1,e.lens,0,288,vY,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;WH(2,e.lens,0,32,yY,0,e.work,{bits:5}),bY=!1}e.lencode=vY,e.lenbits=9,e.distcode=yY,e.distbits=5},wY=(e,t,n,r)=>{let i;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};var EY=(e,t)=>{let n,r,i,a,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w,E,S,C=0;const x=new Uint8Array(4);let T,R;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(fY(e)||!e.output||!e.input&&0!==e.avail_in)return QH;n=e.state,n.mode===rY&&(n.mode=iY),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,u=n.hold,l=n.bits,d=s,f=c,S=qH;e:for(;;)switch(n.mode){case tY:if(0===n.wrap){n.mode=iY;break}for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(2&n.wrap&&35615===u){0===n.wbits&&(n.wbits=15),n.check=0,x[0]=255&u,x[1]=u>>>8&255,n.check=lG(n.check,x,2,0),u=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=uY;break}if((15&u)!==eY){e.msg="unknown compression method",n.mode=uY;break}if(u>>>=4,l-=4,E=8+(15&u),0===n.wbits&&(n.wbits=E),E>15||E>n.wbits){e.msg="invalid window size",n.mode=uY;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&u?16189:rY,u=0,l=0;break;case 16181:for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(n.flags=u,(255&_W(n))!==eY){e.msg="unknown compression method",n.mode=uY;break}if(57344&_W(n)){e.msg="unknown header flags set",n.mode=uY;break}n.head&&(n.head.text=u>>8&1),512&_W(n)&&4&n.wrap&&(x[0]=255&u,x[1]=u>>>8&255,n.check=lG(n.check,x,2,0)),u=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.head&&(n.head.time=u),512&_W(n)&&4&n.wrap&&(x[0]=255&u,x[1]=u>>>8&255,x[2]=u>>>16&255,x[3]=u>>>24&255,n.check=lG(n.check,x,4,0)),u=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&_W(n)&&4&n.wrap&&(x[0]=255&u,x[1]=u>>>8&255,n.check=lG(n.check,x,2,0)),u=0,l=0,n.mode=16184;case 16184:if(1024&_W(n)){for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&_W(n)&&4&n.wrap&&(x[0]=255&u,x[1]=u>>>8&255,n.check=lG(n.check,x,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&_W(n)&&(h=n.length,h>s&&(h=s),h&&(n.head&&(E=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+h),E)),512&_W(n)&&4&n.wrap&&(n.check=lG(n.check,r,h,a)),s-=h,a+=h,n.length-=h),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&_W(n)){if(0===s)break e;h=0;do{E=r[a+h++],n.head&&E&&n.length<65536&&(n.head.name+=String.fromCharCode(E))}while(E&&h<s);if(512&_W(n)&&4&n.wrap&&(n.check=lG(n.check,r,h,a)),s-=h,a+=h,E)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&_W(n)){if(0===s)break e;h=0;do{E=r[a+h++],n.head&&E&&n.length<65536&&(n.head.comment+=String.fromCharCode(E))}while(E&&h<s);if(512&_W(n)&&4&n.wrap&&(n.check=lG(n.check,r,h,a)),s-=h,a+=h,E)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&_W(n)){for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(4&n.wrap&&u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=uY;break}u=0,l=0}n.head&&(n.head.hcrc=_W(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=rY;break;case 16189:for(;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}e.adler=n.check=lY(u),u=0,l=0,n.mode=nY;case nY:if(0===n.havedict)return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=l,XH;e.adler=n.check=1,n.mode=rY;case rY:if(t===HH||t===YH)break e;case iY:if(n.last){u>>>=7&l,l-=7&l,n.mode=cY;break}for(;l<3;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}switch(n.last=1&u,u>>>=1,l-=1,3&u){case 0:n.mode=16193;break;case 1:if(_Y(n),n.mode=oY,t===YH){u>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=uY}u>>>=2,l-=2;break;case 16193:for(u>>>=7&l,l-=7&l;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=uY;break}if(n.length=65535&u,u=0,l=0,n.mode=aY,t===YH)break e;case aY:n.mode=16195;case 16195:if(h=n.length,h){if(h>s&&(h=s),h>c&&(h=c),0===h)break e;i.set(r.subarray(a,a+h),o),s-=h,a+=h,c-=h,o+=h,n.length-=h;break}n.mode=rY;break;case 16196:for(;l<14;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=uY;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.lens[I[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,T={bits:n.lenbits},S=WH(0,n.lens,0,19,n.lencode,0,n.work,T),n.lenbits=T.bits,S){e.msg="invalid code lengths set",n.mode=uY;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;C=n.lencode[u&(1<<n.lenbits)-1],g=C>>>24,v=C>>>16&255,y=65535&C,!(g<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(y<16)u>>>=g,l-=g,n.lens[n.have++]=y;else{if(16===y){for(R=g+2;l<R;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(u>>>=g,l-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=uY;break}E=n.lens[n.have-1],h=3+(3&u),u>>>=2,l-=2}else if(17===y){for(R=g+3;l<R;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}u>>>=g,l-=g,E=0,h=3+(7&u),u>>>=3,l-=3}else{for(R=g+7;l<R;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}u>>>=g,l-=g,E=0,h=11+(127&u),u>>>=7,l-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=uY;break}for(;h--;)n.lens[n.have++]=E}}if(n.mode===uY)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=uY;break}if(n.lenbits=9,T={bits:n.lenbits},S=WH(1,n.lens,0,n.nlen,n.lencode,0,n.work,T),n.lenbits=T.bits,S){e.msg="invalid literal/lengths set",n.mode=uY;break}if(n.distbits=6,n.distcode=n.distdyn,T={bits:n.distbits},S=WH(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,T),n.distbits=T.bits,S){e.msg="invalid distances set",n.mode=uY;break}if(n.mode=oY,t===YH)break e;case oY:n.mode=sY;case sY:if(s>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=l,jH(e,f),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,u=n.hold,l=n.bits,n.mode===rY&&(n.back=-1);break}for(n.back=0;C=n.lencode[u&(1<<n.lenbits)-1],g=C>>>24,v=C>>>16&255,y=65535&C,!(g<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(v&&0==(240&v)){for(b=g,_=v,w=y;C=n.lencode[w+((u&(1<<b+_)-1)>>b)],g=C>>>24,v=C>>>16&255,y=65535&C,!(b+g<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}u>>>=b,l-=b,n.back+=b}if(u>>>=g,l-=g,n.back+=g,n.length=y,0===v){n.mode=16205;break}if(32&v){n.back=-1,n.mode=rY;break}if(64&v){e.msg="invalid literal/length code",n.mode=uY;break}n.extra=15&v,n.mode=16201;case 16201:if(n.extra){for(R=n.extra;l<R;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;C=n.distcode[u&(1<<n.distbits)-1],g=C>>>24,v=C>>>16&255,y=65535&C,!(g<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(0==(240&v)){for(b=g,_=v,w=y;C=n.distcode[w+((u&(1<<b+_)-1)>>b)],g=C>>>24,v=C>>>16&255,y=65535&C,!(b+g<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}u>>>=b,l-=b,n.back+=b}if(u>>>=g,l-=g,n.back+=g,64&v){e.msg="invalid distance code",n.mode=uY;break}n.offset=y,n.extra=15&v,n.mode=16203;case 16203:if(n.extra){for(R=n.extra;l<R;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=uY;break}n.mode=16204;case 16204:if(0===c)break e;if(h=f-c,n.offset>h){if(h=n.offset-h,h>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=uY;break}h>n.wnext?(h-=n.wnext,p=n.wsize-h):p=n.wnext-h,h>n.length&&(h=n.length),m=n.window}else m=i,p=o-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do{i[o++]=m[p++]}while(--h);0===n.length&&(n.mode=sY);break;case 16205:if(0===c)break e;i[o++]=n.length,c--,n.mode=sY;break;case cY:if(n.wrap){for(;l<32;){if(0===s)break e;s--,u|=r[a++]<<l,l+=8}if(f-=c,e.total_out+=f,n.total+=f,4&n.wrap&&f&&(e.adler=n.check=_W(n)?lG(n.check,i,f,o-f):cG(n.check,i,f,o-f)),f=c,4&n.wrap&&(_W(n)?u:lY(u))!==n.check){e.msg="incorrect data check",n.mode=uY;break}u=0,l=0}n.mode=16207;case 16207:if(n.wrap&&_W(n)){for(;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(4&n.wrap&&u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=uY;break}u=0,l=0}n.mode=16208;case 16208:S=KH;break e;case uY:S=JH;break e;case 16210:return ZH;default:return QH}return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=l,(n.wsize||f!==e.avail_out&&n.mode<uY&&(n.mode<cY||t!==GH))&&wY(e,e.output,e.next_out,f-e.avail_out),d-=e.avail_in,f-=e.avail_out,e.total_in+=d,e.total_out+=f,n.total+=f,4&n.wrap&&f&&(e.adler=n.check=_W(n)?lG(n.check,i,f,e.next_out-f):cG(n.check,i,f,e.next_out-f)),e.data_type=n.bits+(n.last?64:0)+(n.mode===rY?128:0)+(n.mode===oY||n.mode===aY?256:0),(0===d&&0===f||t===GH)&&S===qH&&(S=$H),S},SY={inflateReset:pY,inflateReset2:mY,inflateResetKeep:hY,inflateInit:e=>gY(e,15),inflateInit2:gY,inflate:EY,inflateEnd:e=>{if(fY(e))return QH;let t=e.state;return t.window&&(t.window=null),e.state=null,qH},inflateGetHeader:(e,t)=>{if(fY(e))return QH;const n=e.state;return 0==(2&n.wrap)?QH:(n.head=t,t.done=!1,qH)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,a;return fY(e)?QH:(r=e.state,0!==r.wrap&&r.mode!==nY?QH:r.mode===nY&&(i=1,i=cG(i,t,n,0),i!==r.check)?JH:(a=wY(e,t,n,n),a?(r.mode=16210,ZH):(r.havedict=1,qH)))},inflateInfo:"pako inflate (from Nodeca project)"},CY=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const xY=Object.prototype.toString,{Z_NO_FLUSH:TY,Z_FINISH:RY,Z_OK:IY,Z_STREAM_END:NY,Z_NEED_DICT:AY,Z_STREAM_ERROR:kY,Z_DATA_ERROR:DY,Z_MEM_ERROR:MY}=fG;function LY(e){this.options=yH.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new EH,this.strm.avail_out=0;let n=SY.inflateInit2(this.strm,t.windowBits);if(n!==IY)throw new Error(dG[n]);if(this.header=new CY,SY.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=wH.string2buf(t.dictionary):"[object ArrayBuffer]"===xY.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=SY.inflateSetDictionary(this.strm,t.dictionary),n!==IY)))throw new Error(dG[n])}function OY(e,t){const n=new LY(t);if(n.push(e),n.err)throw n.msg||dG[n.err];return n.result}LY.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let a,o,s;if(this.ended)return!1;for(o=t===~~t?t:!0===t?RY:TY,"[object ArrayBuffer]"===xY.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),a=SY.inflate(n,o),a===AY&&i&&(a=SY.inflateSetDictionary(n,i),a===IY?a=SY.inflate(n,o):a===DY&&(a=AY));n.avail_in>0&&a===NY&&n.state.wrap>0&&0!==e[n.next_in];)SY.inflateReset(n),a=SY.inflate(n,o);switch(a){case kY:case DY:case AY:case MY:return this.onEnd(a),this.ended=!0,!1}if(s=n.avail_out,n.next_out&&(0===n.avail_out||a===NY))if("string"===this.options.to){let e=wH.utf8border(n.output,n.next_out),t=n.next_out-e,i=wH.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==IY||0!==s){if(a===NY)return a=SY.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},LY.prototype.onData=function(e){this.chunks.push(e)},LY.prototype.onEnd=function(e){e===IY&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=yH.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var PY={Inflate:LY,inflate:OY,inflateRaw:function(e,t){return(t=t||{}).raw=!0,OY(e,t)},ungzip:OY,constants:fG};const{Deflate:jY,deflate:FY,deflateRaw:UY,gzip:BY}=OH,{Inflate:VY,inflate:zY,inflateRaw:WY,ungzip:GY}=PY;var HY=FY,YY=zY,qY=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(qY||{});class KY{constructor(){dx(this,"_sequence",0),dx(this,"_startTime",Date.now()),dx(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const n=new Uint8Array(4);n.set([1,0,0,0]);const r={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[r]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;IA("SHOW_DATASTREAM2_LOG")&&ok.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const n=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(n),i=new DataView(n);let a=0;if(i.setUint16(a,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),a+=2,i.setUint32(a,t.commonPacketHeader.sequence,!0),a+=4,i.setUint16(a,t.commonStreamHeader,!0),a+=2,t.extension){const e=this.serializeExtension(t.extension);r.set(new Uint8Array(e),a),a+=e.byteLength}if(r.set(new Uint8Array(t.payload),a),a+=t.payload.byteLength,a!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let n=0;const r=t.getUint16(n,!0);n+=2;const i={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};let a,o;if(n+=4,IA("SHOW_DATASTREAM2_LOG")&&ok.debug("receive data header: ".concat(JSON.stringify(i))),t.getUint16(n,!0),n+=2,i.extension){o=this.deserializeExtension(e.slice(n)),n+=2+o.length,a=e.slice(n);let t=!1;if(o.datas.length>0){const e=o.datas.find((e=>0===e.id));e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}a=t?this.decompress(a):a}else a=e.slice(8);return a}serializeExtension(e){const{profile:t,length:n,datas:r}=e,i=new ArrayBuffer(n+2),a=new Uint8Array(i),o=new DataView(i);let s=0;if(o.setUint8(s++,t),o.setUint8(s++,n),r.forEach((e=>{t?(o.setUint8(s++,e.id),o.setUint8(s++,e.length),a.set(new Uint8Array(e.data),s),s+=e.data.byteLength):(o.setUint8(s++,e.id|e.length<<4),a.set(new Uint8Array(e.data),s),s+=e.data.byteLength)})),s!==n+2)throw Error("serialize extension error, is ".concat(s,"!==").concat(n+2));return i}deserializeExtension(e){const t=new DataView(e);let n=0;const r=t.getUint8(n);n++;const i=t.getUint8(n);n++;const a=r===qY.TWO_BYTE,o=[],s=new DataView(e,2);let c=0;for(;c<i;){let e=0,t=0,n=new ArrayBuffer(0);a?(e=s.getUint8(c),c++,t=s.getUint8(c),c++):(e=15&s.getUint8(c),t=s.getUint8(c)>>4,c++),t>0&&(n=s.buffer.slice(c+2,c+2+t),c+=n.byteLength),o.push({id:e,length:t,data:n})}if(c!==i)throw Error("parse error");return{profile:r,length:i,datas:o}}decompress(e){return YY(new Uint8Array(e))}compress(e){return HY(new Uint8Array(e))}}const XY={name:"DataStream",create:(e,t)=>{const n=t?new eO(e):new tO(e);return n.useDataStream(new KY),n}};class QY extends GI{constructor(e,t,n){super(),dx(this,"ws",void 0),dx(this,"requestId",1),dx(this,"heartBeatTimer",void 0),dx(this,"joinInfo",void 0),dx(this,"clientId",void 0),dx(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),dx(this,"onClose",(e=>{this.emit("close"),this.dispose()})),dx(this,"onMessage",(e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)})),this.joinInfo=e,this.clientId=t,this.ws=new Qj("cross-channel-".concat(this.clientId),n),this.ws.on(VP.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(VP.CONNECTED,this.onOpen),this.ws.on(VP.ON_MESSAGE,this.onMessage),this.ws.on(VP.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new rh(((t,n)=>{const r=window.setTimeout((()=>{n(new mk(II.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);this.once(e,(i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new mk(II.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)})),this.once("dispose",(()=>{window.clearTimeout(r),n(new mk(II.WS_ABORT))}))}))}async request(e){if("closed"===this.ws.state)throw new mk(II.WS_DISCONNECT);const t=()=>new rh(((e,t)=>{this.ws.once(VP.CLOSED,(()=>t(new mk(II.WS_ABORT)))),this.ws.once(VP.CONNECTED,e)}));"connected"!==this.ws.state&&await t();const n=this.sendMessage(e),r=new rh(((e,t)=>{const r=()=>{t(new mk(II.WS_ABORT))};this.ws.once(VP.RECONNECTING,r),this.ws.once(VP.CLOSED,r),this.once("req_".concat(n),e),CN(3e3).then((()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(VP.RECONNECTING,r),this.ws.off(VP.CLOSED,r),t(new mk(II.TIMEOUT,"cross channel ws request timeout"))}))})),i=await r;if(!i||200!==i.code)throw new mk(II.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i)));return i}async connect(e){this.ws.removeAllListeners(VP.REQUEST_NEW_URLS),this.ws.on(VP.REQUEST_NEW_URLS,(t=>{t(e)})),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class JY extends GI{set state(e){e!==this._state&&(e!==tj.RELAY_STATE_FAILURE&&(this.errorCode=nj.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),dx(this,"joinInfo",void 0),dx(this,"sid",void 0),dx(this,"clientId",void 0),dx(this,"cancelToken",PR.CancelToken.source()),dx(this,"workerToken",void 0),dx(this,"requestId",0),dx(this,"signal",void 0),dx(this,"prevChannelMediaConfig",void 0),dx(this,"httpRetryConfig",void 0),dx(this,"_resolution",void 0),dx(this,"_state",tj.RELAY_STATE_IDLE),dx(this,"errorCode",nj.RELAY_OK),dx(this,"onStatus",(e=>{ok.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",ej.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",ej.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=nj.SRC_TOKEN_EXPIRED,this.state=tj.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=nj.DEST_TOKEN_EXPIRED,this.state=tj.RELAY_STATE_FAILURE))})),dx(this,"onReconnect",(async()=>{ok.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ej.NETWORK_DISCONNECTED),this.state=tj.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((e=>{this.state!==tj.RELAY_STATE_IDLE&&(ok.error("auto restart channel media relay failed",e.toString()),this.errorCode=nj.SERVER_CONNECTION_LOST,this.state=tj.RELAY_STATE_FAILURE)}))})),this.joinInfo=e,this.clientId=t,this.sid=TN(),this.signal=new QY(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==tj.RELAY_STATE_IDLE)throw new mk(II.INVALID_OPERATION);this.state=tj.RELAY_STATE_CONNECTING,await this.connect(),ok.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new mk(II.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new mk(II.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new mk(II.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==tj.RELAY_STATE_RUNNING)throw new mk(II.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==tj.RELAY_STATE_RUNNING)throw new mk(II.INVALID_OPERATION);const t=this.genMessage($P.SetVideoProfile);await this.signal.request(t),ok.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),ok.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=tj.RELAY_STATE_IDLE,this.dispose()}dispose(){ok.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=PR.CancelToken.source(),this.state=tj.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await UU(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",ej.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage($P.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),ok.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage($P.SetSdkProfile,e);await this.signal.request(n),ok.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage($P.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ej.PACKET_JOINED_SRC_CHANNEL),ok.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage($P.SetSourceUserId,e);await this.signal.request(i),ok.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const a=this.genMessage($P.SetDestChannel,e);await this.signal.request(a),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ej.PACKET_JOINED_DEST_CHANNEL),ok.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const o=this.genMessage($P.StartPacketTransfer,e);await this.signal.request(o),this.emit("event",ej.PACKET_SENT_TO_DEST_CHANNEL),this.state=tj.RELAY_STATE_RUNNING,ok.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage($P.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",ej.PACKET_UPDATE_DEST_CHANNEL),ok.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage($P.StopPacketTransfer);await this.signal.request(e),ok.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],r=[],i=[];this.requestId+=1;const a={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:yA,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.24.0"===a.sdkVersion&&(a.sdkVersion="0.0.1");let o=null,s=null;switch(e){case $P.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case $P.SetSourceChannel:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new mk(II.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceChannel",uid:"0",channelName:s.channelName,token:s.token||this.joinInfo.appId},a;case $P.SetSourceUserId:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new mk(II.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceUserId",uid:s.uid+""},a;case $P.SetDestChannel:if(o=t&&t.getDestChannelMediaInfo(),!o)throw new mk(II.UNEXPECTED_ERROR,"can not find dest config");return o.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),a.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},a;case $P.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case $P.Reconnect:return a.clientRequest={command:"Reconnect"},a;case $P.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case $P.UpdateDestChannel:if(o=t&&t.getDestChannelMediaInfo(),!o)throw new mk(II.UNEXPECTED_ERROR,"can not find dest config");return o.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),a.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},a;case $P.SetVideoProfile:a.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return a}}const ZY={name:"ChannelMediaRelay",create:function(e){return new JY(e.joinInfo,e.clientId,e.websocketRetryConfig||BN,e.httpRetryConfig||BN,e.resolution)}};function $Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function eq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$Y(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class tq extends GI{constructor(e,t,n,r){super(),dx(this,"spec",void 0),dx(this,"token",void 0),dx(this,"websocket",void 0),dx(this,"pingpongTimer",void 0),dx(this,"reconnectMode","retry"),dx(this,"serviceMode",void 0),dx(this,"reqId",0),dx(this,"commandReqId",0),dx(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),dx(this,"handleWebSocketMessage",(e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):(pk.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===GP.TRANSCODE?1:2}),this.emit(XP.PUBLISH_STREAM_STATUS,t))})),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new Qj("live-streaming",n),this.websocket.on(VP.CONNECTED,this.handleWebSocketOpen),this.websocket.on(VP.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(VP.REQUEST_NEW_URLS,((e,t)=>{aN(this,XP.REQUEST_NEW_ADDRESS).then(e).catch(t)})),this.websocket.on(VP.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const i=this.commandReqId,a=this.reqId;if(!a||!this.websocket)throw new mk(II.UNEXPECTED_ERROR);const o=eq({command:e,sdkVersion:"4.24.0"===yA?"0.0.1":yA,seq:a,requestId:a,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new mk(II.WS_DISCONNECT);const s=()=>new rh(((e,t)=>{this.websocket.once(VP.CLOSED,(()=>t(new mk(II.WS_ABORT)))),this.websocket.once(VP.CONNECTED,e)}));"connected"!==this.websocket.state&&await s(),o.clientRequest&&(o.clientRequest.workerToken=this.token);const c=new rh(((e,t)=>{const n=()=>{t(new mk(II.WS_ABORT))};this.websocket.once(VP.RECONNECTING,n),this.websocket.once(VP.CLOSED,n),this.once("@".concat(a,"-").concat(this.spec.sid),(t=>{e(t)}))}));r&&pk.workerEvent(this.spec.sid,eq(eq({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const u=Date.now();this.websocket.sendMessage(o);let l=null;try{l=await c}catch(r){if("closed"===this.websocket.state)throw r;return await s(),await this.request(e,t,n)}return r&&pk.workerEvent(this.spec.sid,eq(eq({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(l.serverResponse),serverCode:l.code,success:200===l.code,responseTime:Date.now()-u})),200!==l.code&&this.handleResponseError(l),l}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.24.0"===yA?"0.0.1":yA;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case JP.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void ok.warning("live stream response already exists stream");case JP.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case JP.LIVE_STREAM_RESPONSE_BAD_STREAM:case JP.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new mk(II.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case JP.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new mk(II.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case JP.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new mk(II.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case JP.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new mk(II.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(XP.WARNING,t,e.serverResponse.url)}case JP.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new mk(II.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(XP.WARNING,t,e.serverResponse.url)}case JP.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new mk(II.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case JP.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new mk(II.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case JP.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new mk(II.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(XP.WARNING,t,e.serverResponse.url)}case JP.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new mk(II.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case JP.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new mk(II.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case JP.LIVE_STREAM_RESPONSE_WORKER_LOST:case JP.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new mk(II.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case JP.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new mk(II.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new mk(II.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case JP.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case JP.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case JP.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case JP.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new mk(II.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(RN)}),6e3)}}function nq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nq(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class iq extends GI{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BN,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:BN;super(),dx(this,"onLiveStreamWarning",void 0),dx(this,"onLiveStreamError",void 0),dx(this,"spec",void 0),dx(this,"retryTimeout",1e4),dx(this,"connection",void 0),dx(this,"httpRetryConfig",void 0),dx(this,"wsRetryConfig",void 0),dx(this,"streamingTasks",new Map),dx(this,"isStartingStreamingTask",!1),dx(this,"taskMutex",new FN("live-streaming")),dx(this,"cancelToken",PR.CancelToken.source()),dx(this,"transcodingConfig",void 0),dx(this,"uapResponse",void 0),dx(this,"lastTaskId",1),dx(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=rq(rq({},KP),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(ok.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map((e=>rq(rq(rq({},HP),e),{},{zOrder:e.zOrder?e.zOrder+1:1})))),function(e){PI(e.width)||DI(e.width,"config.width",0,1e4),PI(e.height)||DI(e.height,"config.height",0,1e4),PI(e.videoBitrate)||DI(e.videoBitrate,"config.videoBitrate",1,1e6),PI(e.videoFrameRate)||DI(e.videoFrameRate,"config.videoFrameRate"),PI(e.lowLatency)||AI(e.lowLatency,"config.lowLatency"),PI(e.audioSampleRate)||kI(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),PI(e.audioBitrate)||DI(e.audioBitrate,"config.audioBitrate",1,128),PI(e.audioChannels)||kI(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),PI(e.videoGop)||DI(e.videoGop,"config.videoGop"),PI(e.videoCodecProfile)||kI(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),PI(e.userCount)||DI(e.userCount,"config.userCount",0,17),PI(e.backgroundColor)||DI(e.backgroundColor,"config.backgroundColor",0,16777215),PI(e.userConfigExtraInfo)||LI(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!PI(e.transcodingUsers)&&(OI(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach(((e,t)=>{WP(e.uid),PI(e.x)||DI(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),PI(e.y)||DI(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),PI(e.width)||DI(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),PI(e.height)||DI(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),PI(e.zOrder)||DI(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),PI(e.alpha)||DI(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),PI(e.watermark)||qP(e.watermark,"watermark"),PI(e.backgroundImage)||qP(e.backgroundImage,"backgroundImage"),e.images&&!PI(e.images)&&(OI(e.images,"config.images"),e.images.forEach(((e,t)=>{qP(e,"images[".concat(t,"]"))})))}(t);const n=[];t.images&&n.push(...t.images.map((e=>rq(rq(rq({},YP),e),{},{zOrder:255})))),t.backgroundImage&&(n.push(rq(rq(rq({},YP),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(rq(rq(rq({},YP),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map((e=>rq({},e))),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const r=(t.userConfigs||[]).map((e=>"number"==typeof e.uid?rh.resolve(e.uid):LU(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await rh.all(r)).forEach(((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)})),this.transcodingConfig=t,this.connection)try{var i;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(fh(i=this.streamingTasks).call(i)).map((e=>e.taskId)).join("#")});ok.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((t=>{ok.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then((()=>{ok.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((e=>{ok.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)}))}))}}async startLiveStreamingTask(e,t,n){if(!this.transcodingConfig&&t===GP.TRANSCODE)throw new mk(II.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};ok.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const i=await this.taskMutex.lock();if(!this.connection&&n)return void i();if(this.streamingTasks.get(e)&&!n)return i(),new mk(II.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw i(),e}switch(t){case GP.TRANSCODE:r.transcodingConfig=rq({},this.transcodingConfig);case GP.RAW:}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const a=this.lastTaskId++;try{const o=new rh(((t,r)=>{CN(this.retryTimeout).then((()=>{if(n)return r(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0}))})),s=await rh.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:t===GP.TRANSCODE?1:2,requestByUser:!n,tid:a.toString()}),o]);this.isStartingStreamingTask=!1,ok.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(s.code)),this.streamingTasks.set(e,{clientRequest:r,mode:t,url:e,taskId:a}),i()}catch(r){if(i(),this.isStartingStreamingTask=!1,!r.data||!r.data.retry||n)throw r;return r.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,r)):await this.startLiveStreamingTask(e,t,r)}}stopLiveStreamingTask(e){return new rh(((t,n)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new mk(II.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const i=r.mode;r.abortTask=()=>{ok.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===GP.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((n=>{ok.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),t()})).catch(n)}))}resetAllTask(){var e;const t=Array.from(fh(e=this.streamingTasks).call(e));this.terminate();for(const n of t)this.startLiveStreamingTask(n.url,n.mode).catch((e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=PR.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new mk(II.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await aN(this,QP.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new tq(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(XP.WARNING,((e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e))),this.connection.on(XP.PUBLISH_STREAM_STATUS,(e=>this.handlePublishStreamServer(e))),this.connection.on(XP.REQUEST_NEW_ADDRESS,((t,n)=>{if(!this.connection)return n(new mk(II.UNEXPECTED_ERROR,"can not get new live streaming address list"));aN(this,QP.REQUEST_WORKER_MANAGER_LIST,e).then((e=>{this.uapResponse=e,t(e.addressList)})).catch(n)})),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case JP.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case JP.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case JP.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case JP.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const r=new mk(II.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return ok.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case JP.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new mk(II.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case JP.LIVE_STREAM_RESPONSE_WORKER_LOST:case JP.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(fh(i=this.streamingTasks).call(i));for(const n of t)n.abortTask?n.abortTask():(ok.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new mk(II.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((()=>{ok.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)})).catch((e=>{ok.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const aq={name:"LiveStreaming",create:function(e){return new iq(e.joinInfo,e.websocketRetryConfig||BN,e.httpRetryConfig||BN)}};function oq(e){let t=vq();return function(e,t){let n=e.appId;void 0!==n&&(kq(t,10),Cq(t,n));let r=e.cid;void 0!==r&&(kq(t,16),kq(t,r));let i=e.cname;void 0!==i&&(kq(t,26),Cq(t,i));let a=e.deviceId;void 0!==a&&(kq(t,34),Cq(t,a));let o=e.elapse;void 0!==o&&(kq(t,40),Dq(t,o));let s=e.fileSize;void 0!==s&&(kq(t,48),Dq(t,mq(s)));let c=e.height;void 0!==c&&(kq(t,56),Dq(t,mq(c)));let u=e.jpg;void 0!==u&&(kq(t,66),kq(t,u.length),function(e,t){let n=wq(e,t.length);e.bytes.set(t,n)}(t,u));let l=e.networkType;void 0!==l&&(kq(t,72),Dq(t,mq(l)));let d=e.osType;void 0!==d&&(kq(t,80),Dq(t,mq(d)));let f=e.requestId;void 0!==f&&(kq(t,90),Cq(t,f));let h=e.sdkVersion;void 0!==h&&(kq(t,98),Cq(t,h));let p=e.sequence;void 0!==p&&(kq(t,104),Dq(t,mq(p)));let m=e.sid;void 0!==m&&(kq(t,114),Cq(t,m));let g=e.timestamp;void 0!==g&&(kq(t,120),Dq(t,g));let v=e.uid;void 0!==v&&(kq(t,128),kq(t,v));let y=e.vid;void 0!==y&&(kq(t,136),kq(t,y));let b=e.width;void 0!==b&&(kq(t,144),Dq(t,mq(b)));let _=e.service;void 0!==_&&(kq(t,152),kq(t,_));let w=e.callbackData;void 0!==w&&(kq(t,162),Cq(t,w));let E=e.jpgEncryption;void 0!==E&&(kq(t,168),kq(t,E));let S=e.requestType;void 0!==S&&(kq(t,176),kq(t,S));let C=e.scorePorn;void 0!==C&&(kq(t,185),Nq(t,C));let x=e.scoreSexy;void 0!==x&&(kq(t,193),Nq(t,x));let T=e.scoreNeutral;void 0!==T&&(kq(t,201),Nq(t,T));let R=e.scene;void 0!==R&&(kq(t,208),kq(t,R));let I=e.ossFilePrefix;void 0!==I&&(kq(t,218),Cq(t,I));let N=e.serviceVendor;if(void 0!==N)for(let A of N){kq(t,226);let e=vq();uq(A,e),kq(t,e.limit),xq(t,e),yq(e)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function sq(e){return function(e){let t={};e:for(;!_q(e);){let n=Aq(e);switch(n>>>3){case 0:break e;case 1:t.code=Aq(e);break;case 2:t.msg=Sq(e,Aq(e));break;case 3:{let n=lq(e);t.data=cq(e),e.limit=n;break}default:dq(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function cq(e){let t={};e:for(;!_q(e);){let n=Aq(e);switch(n>>>3){case 0:break e;case 1:t.requestId=Sq(e,Aq(e));break;case 2:t.requestType=Aq(e)>>>0;break;case 3:t.scorePorn=Iq(e);break;case 4:t.scoreSexy=Iq(e);break;case 5:t.scoreNeutral=Iq(e);break;case 6:t.requestScene=Aq(e)>>>0;break;case 7:t.scene=Aq(e)>>>0;break;default:dq(e,7&n)}}return t}function uq(e,t){let n=e.service;void 0!==n&&(kq(t,8),kq(t,n));let r=e.vendor;void 0!==r&&(kq(t,16),kq(t,r));let i=e.token;void 0!==i&&(kq(t,26),Cq(t,i));let a=e.callbackUrl;void 0!==a&&(kq(t,34),Cq(t,a))}function lq(e){let t=Aq(e),n=e.limit;return e.limit=e.offset+t,n}function dq(e,t){switch(t){case 0:for(;128&Tq(e););break;case 2:bq(e,Aq(e));break;case 5:bq(e,4);break;case 1:bq(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let fq=new Float32Array(1);new Uint8Array(fq.buffer);let hq=new Float64Array(1),pq=new Uint8Array(hq.buffer);function mq(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let gq=[];function vq(){const e=gq.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function yq(e){gq.push(e)}function bq(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function _q(e){return e.offset>=e.limit}function wq(e,t){let n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){let t=new Uint8Array(2*a);t.set(n),e.bytes=t}return e.offset=a,a>i&&(e.limit=a),r}function Eq(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function Sq(e,t){let n=Eq(e,t),r=String.fromCharCode,i=e.bytes,a="\ufffd",o="";for(let s=0;s<t;s++){let e,c,u,l,d=i[s+n];0==(128&d)?o+=r(d):192==(224&d)?s+1>=t?o+=a:(e=i[s+n+1],128!=(192&e)?o+=a:(l=(31&d)<<6|63&e,l<128?o+=a:(o+=r(l),s++))):224==(240&d)?s+2>=t?o+=a:(e=i[s+n+1],c=i[s+n+2],32896!=(49344&(e|c<<8))?o+=a:(l=(15&d)<<12|(63&e)<<6|63&c,l<2048||l>=55296&&l<=57343?o+=a:(o+=r(l),s+=2))):240==(248&d)?s+3>=t?o+=a:(e=i[s+n+1],c=i[s+n+2],u=i[s+n+3],8421504!=(12632256&(e|c<<8|u<<16))?o+=a:(l=(7&d)<<18|(63&e)<<12|(63&c)<<6|63&u,l<65536||l>1114111?o+=a:(l-=65536,o+=r(55296+(l>>10),56320+(1023&l)),s+=3))):o+=a}return o}function Cq(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let e=t.charCodeAt(o);e>=55296&&e<=56319&&o+1<n&&(e=(e<<10)+t.charCodeAt(++o)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}kq(e,r);let i=wq(e,r),a=e.bytes;for(let o=0;o<n;o++){let e=t.charCodeAt(o);e>=55296&&e<=56319&&o+1<n&&(e=(e<<10)+t.charCodeAt(++o)-56613888),e<128?a[i++]=e:(e<2048?a[i++]=e>>6&31|192:(e<65536?a[i++]=e>>12&15|224:(a[i++]=e>>18&7|240,a[i++]=e>>12&63|128),a[i++]=e>>6&63|128),a[i++]=63&e|128)}}function xq(e,t){let n=wq(e,t.limit),r=e.bytes,i=t.bytes;for(let a=0,o=t.limit;a<o;a++)r[a+n]=i[a]}function Tq(e){return e.bytes[Eq(e,1)]}function Rq(e,t){let n=wq(e,1);e.bytes[n]=t}function Iq(e){let t=Eq(e,8),n=e.bytes;return pq[0]=n[t++],pq[1]=n[t++],pq[2]=n[t++],pq[3]=n[t++],pq[4]=n[t++],pq[5]=n[t++],pq[6]=n[t++],pq[7]=n[t++],hq[0]}function Nq(e,t){let n=wq(e,8),r=e.bytes;hq[0]=t,r[n++]=pq[0],r[n++]=pq[1],r[n++]=pq[2],r[n++]=pq[3],r[n++]=pq[4],r[n++]=pq[5],r[n++]=pq[6],r[n++]=pq[7]}function Aq(e){let t,n=0,r=0;do{t=Tq(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function kq(e,t){for(t>>>=0;t>=128;)Rq(e,127&t|128),t>>>=7;Rq(e,t)}function Dq(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=wq(e,a),s=e.bytes;switch(a){case 10:s[o+9]=i>>>7&1;case 9:s[o+8]=9!==a?128|i:127&i;case 8:s[o+7]=8!==a?r>>>21|128:r>>>21&127;case 7:s[o+6]=7!==a?r>>>14|128:r>>>14&127;case 6:s[o+5]=6!==a?r>>>7|128:r>>>7&127;case 5:s[o+4]=5!==a?128|r:127&r;case 4:s[o+3]=4!==a?n>>>21|128:n>>>21&127;case 3:s[o+2]=3!==a?n>>>14|128:n>>>14&127;case 2:s[o+1]=2!==a?n>>>7|128:n>>>7&127;case 1:s[o]=1!==a?128|n:127&n}}function Mq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const Lq=new Map([["moderation",1],["supervise",2]]);class Oq extends GI{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(Cj.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=ii(t=e.map((e=>Lq.get(e)||0))).call(t,((e,t)=>e+t)),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(e){super(),dx(this,"name","AgoraRTCVideoContentInspect"),dx(this,"_connectionState",Ej.CONNECTING),dx(this,"_innerConnectionState",void 0),dx(this,"sequence",0),dx(this,"inspectStartTime",void 0),dx(this,"workerManagerConnection",void 0),dx(this,"workerConnection",void 0),dx(this,"workerMessageLengthLimit",void 0),dx(this,"inspectIntervalMinimum",void 0),dx(this,"qualityRatio",void 0),dx(this,"_connectInfo",void 0),dx(this,"_cancelTokenSource",PR.CancelToken.source()),dx(this,"_retryConfig",void 0),dx(this,"wmSequence",0),dx(this,"inspectInterval",void 0),dx(this,"inspectTimer",null),dx(this,"ossFilePrefix",void 0),dx(this,"extraInfo",void 0),dx(this,"_inspectType",void 0),dx(this,"_inspectMode",void 0),dx(this,"_quality",1),dx(this,"qualityTimer",null),dx(this,"_inspectId",void 0),dx(this,"_needWorkUrlOnly",!1),dx(this,"inspectImage",(()=>{if(this.connectionState!==Ej.CONNECTED)throw new mk(II.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===Ej.CONNECTED?this.requestToInspectImage():ok.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=xN(5,"inspect-"),this.workerMessageLengthLimit=IA("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=IA("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=IA("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Qj("worker-manager-"+this._inspectId,BN),this.on(Cj.STATE_CHANGE,((e,t)=>{this._innerConnectionState=e,ok.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Sj[e]," ").concat(t||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new Qj("worker-"+this._inspectId,BN),this.handleWorkerEvents()}async init(e,t){this.emit(Cj.STATE_CHANGE,Sj.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new rh(((r,i)=>{this.on(Cj.CONNECTION_STATE_CHANGE,((e,t)=>{t===Ej.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorkerManager(e)})).catch((e=>{i(e)}))}))}async requestAP(e,t,n){const r=IA("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:a,cname:o,sid:s,token:c,uid:u}=t;RU++;const l="image_moderation_api",d={service_name:l,json_body:JSON.stringify({appId:i,areaCode:a,cname:o,command:"allocateEdge",requestId:RU,seq:RU,sid:s,token:c,ts:Date.now(),uid:u+""})};let f,h,p=e[0];return zN((async()=>{f=Date.now();const e=await aU(p,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(h=Date.now()-f,0!==e.code){const t=new mk(II.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:h});throw ok.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new mk(II.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:h});throw ok.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new mk(II.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:h});throw ok.error(e.toString()),e}const r=IA("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=IA("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,responseTime:h}}),((t,n)=>(pk.apworkerEvent(s,{success:!0,sc:200,serviceName:l,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:h,serverIp:e[n%e.length]}),!1)),((t,n)=>(pk.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:l,responseTime:h,serverIp:e[n%e.length]}),!!(t.code!==II.OPERATION_ABORTED&&t.code!==II.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(p=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(Cj.STATE_CHANGE,Sj.AP_CONNECTED);const{addressList:a}=i;return this.wmSequence++,a}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(Cj.STATE_CHANGE,Sj.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(VP.CONNECTED,(async()=>{this.emit(Cj.STATE_CHANGE,Sj.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(VP.CLOSED,(()=>{this._innerConnectionState<Sj.GET_WORKER_MANAGER_RESPONSE&&ok.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(VP.FAILED,(()=>{this._innerConnectionState<Sj.GET_WORKER_MANAGER_RESPONSE&&ok.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(VP.RECONNECTING,(()=>{this._innerConnectionState<Sj.GET_WORKER_MANAGER_RESPONSE&&ok.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(VP.ON_MESSAGE,(async e=>{this.emit(Cj.STATE_CHANGE,Sj.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw ok.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new mk(II.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw ok.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new mk(II.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=IA("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(Cj.STATE_CHANGE,Sj.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(Cj.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}})),this.workerManagerConnection.on(VP.WILL_RECONNECT,((e,t,n)=>{n(e)})),this.workerManagerConnection.on(VP.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}handleWorkerEvents(){this.workerConnection.on(VP.CONNECTED,(async()=>{this.emit(Cj.STATE_CHANGE,Sj.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ej.CONNECTED})),this.workerConnection.on(VP.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const n=sq(new Uint8Array(e.data));if(IA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&ok.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(Cj.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=ii(t=Object.keys(e)).call(t,((t,n)=>e[t]>e[n]?t:n),"porn"),i=Object.keys(e).find((e=>e===r));this.emit(Cj.INSPECT_RESULT,i)}else this.emit(Cj.INSPECT_RESULT,void 0,new mk(II.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(Cj.INSPECT_RESULT,void 0,new mk(II.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else ok.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Cj.INSPECT_RESULT,void 0,new mk(II.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(VP.CLOSED,(()=>{this.connectionState=Ej.CLOSED})),this.workerConnection.on(VP.FAILED,(()=>{this.connectionState=Ej.CLOSED})),this.workerConnection.on(VP.RECONNECTING,(()=>{this.connectionState=this.connectionState===Ej.CONNECTED?Ej.RECONNECTING:Ej.CONNECTING})),this.workerConnection.on(VP.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this.workerConnection.on(VP.REQUEST_NEW_URLS,((e,t)=>{this.workerManagerConnection.close(),this.once(Cj.REQUEST_NEW_WORKER_URL,(t=>{e([t])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((e=>{this.connectWorkerManager(e,!0)})).catch((e=>{t(e)}))}))}async requestToInspectImage(){this.sequence++;const e=sN(this,Cj.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Cj.INSPECT_RESULT,void 0,new mk(II.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(Cj.INSPECT_RESULT,void 0,new mk(II.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:a,sid:o,uid:s}=t;const c=Date.now(),u=await e.getCurrentFrameImage("image/jpeg",this.quality),l=await JD(u,n,r),d=this.sequence+"-"+i+"-"+s+"-"+c+"-"+xN(12,""),f={appId:n,cid:i,cname:r,deviceId:"",elapse:(h=Number(c-this.inspectStartTime),{low:h|=0,high:h>>31,unsigned:h>=0}),fileSize:l.byteLength,jpgEncryption:2,height:u.height,width:u.width,jpg:l,networkType:6,osType:7,requestId:d,sdkVersion:"4.24.0",sequence:this.sequence,sid:o,timestamp:dz(c),uid:s,vid:a,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var h;void 0===this.extraInfo&&delete f.callbackData,void 0===this.ossFilePrefix&&delete f.ossFilePrefix;const p=oq(f);if(p.byteLength<this.workerMessageLengthLimit){if(IA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mq(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},f);delete e.jpg,ok.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return p}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:a,sid:o,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=PR.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ej.CLOSED,this.emit(Cj.STATE_CHANGE,Sj.CLOSED)}}const Pq={name:"ContentInspect",create:function(e){let{config:t}=e;return function(e){if(!e)throw new mk(II.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new mk(II.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const t=[...new Set(e.inspectType)];t.forEach((e=>{var t;if(!Lr(t=["supervise","moderation"]).call(t,e))throw new mk(II.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))})),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new mk(II.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new Oq(t)}};var jq=r(ee.Object.getOwnPropertySymbols),Fq=kn,Uq=Qn.indexOf,Bq=Gr,Vq=x([].indexOf),zq=!!Vq&&1/Vq([1],1,-0)<0;Fq({target:"Array",proto:!0,forced:zq||!Bq("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return zq?Vq(this,e,t)||0:Uq(this,e,t)}});var Wq=er("Array","indexOf"),Gq=d,Hq=Wq,Yq=Array.prototype,qq=function(e){var t=e.indexOf;return e===Yq||Gq(Yq,e)&&t===Yq.indexOf?Hq:t},Kq=r(qq);function Xq(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==Kq(t).call(t,r))continue;n[r]=e[r]}return n}(e,t);if(jq){var a=jq(e);for(r=0;r<a.length;r++)n=a[r],-1===Kq(t).call(t,n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let Qq=class{get localCapabilities(){return hN(this._localCapabilities)}get rtpCapabilities(){return hN(this._rtpCapabilities)}get candidates(){return hN(this._candidates)}get iceParameters(){return hN(this._iceParameters)}get dtlsParameters(){return hN(this._dtlsParameters)}constructor(e){dx(this,"sessionDesc",void 0),dx(this,"_localCapabilities",void 0),dx(this,"_rtpCapabilities",void 0),dx(this,"_candidates",void 0),dx(this,"_iceParameters",void 0),dx(this,"_dtlsParameters",void 0),dx(this,"setup",void 0),dx(this,"currentMidIndex",void 0),dx(this,"cname","o/i14u9pJrxRKAsu"),dx(this,"firefoxSsrcMidMap",new Map),e=hN(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:a,direction:o,setup:s,videoCodec:c,audioCodec:u}=e;let l;this.setup=s,l=o===BP.RECEIVE_ONLY?UA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):UA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=a;const d=o===BP.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,f=o===BP.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,h=o===BP.RECEIVE_ONLY?i.send.videoCodecs:FF(mj.VIDEO,d,f,c),p=o===BP.RECEIVE_ONLY?i.send.audioCodecs:FF(mj.AUDIO,d,f,u);for(const m of l.mediaDescriptions)m.attributes.iceUfrag=t.iceUfrag,m.attributes.icePwd=t.icePwd,m.attributes.fingerprints=n.fingerprints,m.attributes.candidates=r,m.attributes.setup=this.setup,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType&&(m.media.fmts=h.map((e=>e.payloadType.toString(10))),m.attributes.payloads=h,m.attributes.extmaps=d.videoExtensions),"audio"===m.media.mediaType&&(m.media.fmts=p.map((e=>e.payloadType.toString(10))),m.attributes.payloads=p,m.attributes.extmaps=d.audioExtensions,jF(m));this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return BA(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((e=>this.hasMid(e))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:a,ssrcGroups:o}=TF(t,this.cname,IA("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(a);if(s){if(nI()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,s.attributes.mid),i&&(i.twcc||i.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,i),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,a,r);let n;return-1===t?(n=this.createOrRecycleSendMedia(e,a,o,"sendonly",r,i),this.updateBundleMids()):(n=hN(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=a,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,i)),nI()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,n.attributes.mid),{needExchangeSDP:!0,mid:n.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{e.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach((e=>{const i=e._mediaStreamTrack.kind,a=this.findAvailableRecvMediaIndex(i);let o,s=!1;-1===a?(s=!0,o=this.createOrRecycleRecvMedia(e,[],"recvonly",t,n),this.updateBundleMids()):(o=hN(this.sessionDesc.mediaDescriptions[a]),o.attributes.direction="recvonly"),r.push({mid:o.attributes.mid,needCreateTransceiver:s})})),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:a,relatedAddress:o,relatedPort:s,priority:c}=new RTCIceCandidate(e),u={foundation:null!=t?t:"",componentId:"1",transport:null!=n?n:"",priority:c?c+"":"",connectionAddress:null!=r?r:"",port:i?i+"":"",type:a?a+"":"",relAddr:null!=o?o:"",relPort:s?s+"":"",extension:{}};this.candidates.some((e=>e.priority===u.priority&&e.connectionAddress===u.connectionAddress&&e.port===u.port))||(this._candidates.push(u),this.sessionDesc.mediaDescriptions.forEach((e=>{e.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const a=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,s=FF(a,o,this.localCapabilities.send,a===mj.AUDIO?i:r),c=a===mj.VIDEO?o.videoExtensions:o.audioExtensions,u="".concat(++this.currentMidIndex);let l={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};l=this.mungRecvMediaDsec(l,e);const d=this.findFirstClosedMedia(a);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Lr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Lr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex((r=>{const i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(nI()){if(i){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!e||e!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{const n=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&n}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=hN(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,n,r,i,a){const o=this.rtpCapabilities.send,s=e===mj.VIDEO?o.videoCodecs:o.audioCodecs,c=e===mj.VIDEO?o.videoExtensions:o.audioExtensions;nI()&&(i="".concat(++this.currentMidIndex));let u={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};u=this.mungSendMediaDesc(u,a);const l=this.findFirstClosedMedia(e);if(l){const e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}mungRecvMediaDsec(e,t,n){const r=hN(e);return IF(r),RF(r,t),NF(r,t),AF(r),kF(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=hN(e);return kF(n,t,this.localCapabilities.recv),jF(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>nI()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}};const Jq=["sdp"];var Zq;function $q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function eK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$q(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let tK=(Zq=class e extends hj{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),dx(this,"direction",void 0),dx(this,"name",void 0),dx(this,"store",void 0),dx(this,"spec",void 0),dx(this,"peerConnection",void 0),dx(this,"initialOffer",void 0),dx(this,"transport",void 0),dx(this,"statsFilter",void 0),dx(this,"localCandidateCount",0),dx(this,"_isInRestartIce",!1),dx(this,"mutex",void 0),dx(this,"onLocalCandidate",void 0),dx(this,"remoteSDP",void 0),dx(this,"pendingCandidates",[]),dx(this,"localCapabilities",void 0),dx(this,"isReady",!1),dx(this,"restartCnt",0),dx(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new FN("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!=r?r:BP.SEND_ONLY,this.name=this.direction===BP.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=mA(this.peerConnection,IA("STATS_UPDATE_INTERVAL"),void 0,nI()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await MF();if(this.localCapabilities=PF(t),e){const{sdp:t}=e,n=Xq(e,Jq),r=function(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=wF(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(OF(t,e,"videoExtensions",n,r,i),OF(t,e,"videoCodecs",n,r,i),OF(t,e,"audioExtensions",n,r,i),OF(t,e,"audioCodecs",n,r,i),IA("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){const t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){ok.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&IA("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}({},{},t);this.remoteSDP=new Qq({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:r,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const a=EF(i.sdp);await this.peerConnection.setLocalDescription(i);const o=await LF({},{},i.sdp);this.localCapabilities=PF(o);const s=this.peerConnection.getTransceivers()[0];return null!=s&&s.receiver&&s.receiver.transport&&this.tryBindTransportEvents(s.receiver.transport),eK(eK({},a),{},{sdp:i.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=EF(e.sdp);return this.initialOffer=e,eK(eK({},t),{},{sdp:e.sdp})}}catch(e){throw new NI(II.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:n,dtlsParameters:r}=e,i=await LF({},{},t);this.remoteSDP=new Qq({remoteIceParameters:n,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const a=this.peerConnection.getTransceivers()[0];null!=a&&a.sender&&a.sender.transport&&this.tryBindTransportEvents(a.sender.transport)}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((e=>{this.peerConnection.addIceCandidate(e)})),this.pendingCandidates=[])}catch(e){throw new NI(II.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return KT((function*(){const i=yield QT(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const i=[],a=r.remoteSDP.receive(e,t,n);e.forEach(((e,t)=>{if(a[t].needCreateTransceiver){const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)}else{const n=r.peerConnection.getTransceivers().find((e=>e.mid===a[t].mid));if(!n)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a[t].mid));i.push(n),e._updateRtpTransceiver(n)}})),nI()&&!0===IA("SIMULCAST")&&(yield QT(r.applySimulcastForFirefox(i,e)));const o=a.map((e=>e.mid)),s=yield QT(r.peerConnection.createOffer()),c=r.mungSendOfferSDP(s.sdp,e,o),u=UA(c),l=o.map((e=>{const t=u.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return SF(t,IA("USE_PUB_RTX"))})),d=i.map(((e,t)=>{const n=o[t];return{localSSRC:l[t],id:n}}));yield QT(r.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield d}catch(e){const n=r.remoteSDP.toString();throw yield QT(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield QT(r.peerConnection.setRemoteDescription({type:"answer",sdp:n})),yield QT(r.stopSending(o,!0)),e}yield QT(r.applySimulcastEncodings(i,e)),yield QT(r.applySendEncodings(i,e));const f=r.remoteSDP.toString(),h=r.logSDPExchange(c,"offer","local","send");return null==h||h(f),yield QT(r.setRemoteDescription({type:"answer",sdp:f})),i.map(((e,t)=>{const n=o[t];return{localSSRC:l[t],id:n}}))}catch(e){throw e instanceof NI?e:new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:a}=this.remoteSDP.send(e,t,n,r);if(a){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),a=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(a||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:a}),ok.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else ok.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const o=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!o||null===o.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,mid:o.mid,transceiver:o}}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async mockReceive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:a}=this.remoteSDP.send(e,t,n,r);if(a){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),a=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(a||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:a}),ok.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else ok.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===_A.Auto&&(this.store.p2pTransport=_A.SdRtn,vk().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,vk().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:t}=EF(e.sdp);return this.store.descriptionStart(),this.direction===BP.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===BP.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:t}=EF(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==a||a(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?nI()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:eK(eK({},$N),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:eK(eK({},$N),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Lr(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):ok.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i={iceServers:[]};var a;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(ZI(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,n,r)),IA("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Lr(a=[_A.Relay,_A.SdRtn]).call(a,n)&&(i.iceTransportPolicy="relay"),IA("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(i.iceTransportPolicy="relay")})))),IA("ENABLE_ENCODED_TRANSFORM")&&vk().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),ok.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=[],i=e.filter((e=>e.tcpport));ok.debug("P2PConnection turnServers is ".concat(i,", current index is ").concat(n));const a=i.length>n?i[n]:i[0];switch(t){case _A.SdRtn:const t=e.filter((e=>{var t;return Lr(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL})),i=t.length>n?t[n]:t[0];i&&(r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(nF(i.turnServerURL),":").concat(i.tcpport,"?transport=udp")}),r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(nF(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}));break;case _A.Relay:a&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(nF(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}));break;default:a&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(nF(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:e,remote:n}=t.getSelectedCandidatePair()||{};if(e&&n){const t=e.address+":"+e.port,r=n.address+":"+n.port;ok.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(fF(t)),", remote ").concat(JSON.stringify(fF(r))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>t.track===e._mediaStreamTrack))),!t)return ok.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return ok.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!vk().supportSetRtpSenderParameters)return ok.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var a;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),Lr(a=e._hints).call(a,Fk.LOW_STREAM)&&(n&&(i.maxFramerate=aF(n)),r&&r>=1&&(i.scaleResolutionDownBy=r))}if(IA("DSCP_TYPE")&&EI()){var o;const e=IA("DSCP_TYPE");Lr(o=["very-low","low","medium","high"]).call(o,e)&&(i.networkPriority=e)}const s=t.getParameters(),c=null===(n=s.encodings)||void 0===n?void 0:n[0];nI()&&!c&&(r.encodings=[i]),c&&Object.assign(c,i),Object.assign(s,r),ok.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await t.setParameters(s)}async applySendEncodings(e,t){try{if(!vk().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof LL&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){ok.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=UA(e);return t.forEach(((e,t)=>{const i=n[t],a=r.mediaDescriptions.find((e=>e.attributes.mid===i));a&&(RF(a,e),DF(a,e,this.store.codec))})),BA(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,a,o;const c=e[s],u=t[s];if(u instanceof LL&&!Lr(n=u._hints).call(n,Fk.LOW_STREAM)&&null!==(r=u._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=u._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(a=u._scalabilityMode)&&void 0!==a&&a.numSpatialLayers&&(null===(o=u._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!nI()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof LL&&this.isVP8Simulcast(r)){const t=e[n],i={},a={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];const o=t.sender.getParameters();await t.sender.setParameters(Object.assign(o,i))}}}isVP8Simulcast(e){var t,n,r,i,a;return!!(e instanceof LL&&IA("SIMULCAST")&&"vp8"===this.store.codec&&!Lr(t=e._hints).call(t,Fk.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=e._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(IA("SDP_LOGGING"))return ok.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async e=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}async getRemoteSSRC(e,t){var n;if(t=null!=t?t:null===(n=this.currentRemoteDescription)||void 0===n?void 0:n.sdp){var r;const n=null===(r=UA(t).mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===r?void 0:r.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Lr(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){const r=UA(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===mj.AUDIO&&"audio"===i.media.mediaType&&jF(i),BA(r)}},NP(Zq.prototype,"establish",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"establish"),Zq.prototype),NP(Zq.prototype,"connect",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"connect"),Zq.prototype),NP(Zq.prototype,"receive",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"receive"),Zq.prototype),NP(Zq.prototype,"mockReceive",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"mockReceive"),Zq.prototype),NP(Zq.prototype,"stopReceiving",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"stopReceiving"),Zq.prototype),NP(Zq.prototype,"restartICE",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"restartICE"),Zq.prototype),NP(Zq.prototype,"close",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"close"),Zq.prototype),NP(Zq.prototype,"updateEncoderConfig",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"updateEncoderConfig"),Zq.prototype),NP(Zq.prototype,"updateSendParameters",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"updateSendParameters"),Zq.prototype),NP(Zq.prototype,"replaceTrack",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"replaceTrack"),Zq.prototype),NP(Zq.prototype,"muteLocal",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"muteLocal"),Zq.prototype),NP(Zq.prototype,"unmuteLocal",[nK],Object.getOwnPropertyDescriptor(Zq.prototype,"unmuteLocal"),Zq.prototype),Zq);function nK(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return await r.apply(this,a)}finally{n()}},n}let rK=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var iK,aK,oK,sK,cK,uK,lK,dK,fK,hK,pK,mK;function gK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gK(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let yK=(iK=bK(rK.SEND_ONLY),aK=bK(rK.SEND_ONLY),oK=bK(),sK=bK(rK.RECEIVE_ONLY),cK=bK(rK.RECEIVE_ONLY),uK=bK(rK.RECEIVE_ONLY),lK=bK(rK.RECEIVE_ONLY),dK=bK(rK.RECEIVE_ONLY),fK=bK(rK.RECEIVE_ONLY),hK=bK(),pK=bK(rK.RECEIVE_ONLY),mK=class extends GI{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(wj.StateChange,t,this._state)}constructor(e,t){super(),dx(this,"isPlanB",!1),dx(this,"store",void 0),dx(this,"statsUploader",void 0),dx(this,"sendConnection",void 0),dx(this,"recvConnection",void 0),dx(this,"localTrackMap",new Map),dx(this,"remoteUserMap",new Map),dx(this,"localDataChannels",[]),dx(this,"pendingLocalTracks",[]),dx(this,"pendingRemoteTracks",[]),dx(this,"statsCollector",void 0),dx(this,"dtlsFailedCount",0),dx(this,"sendMutex",void 0),dx(this,"recvMutex",void 0),dx(this,"_state",_j.Disconnected),dx(this,"_restartStates",["disconnected","failed"]),dx(this,"reconnectInterval",void 0),dx(this,"uploadUnplinkStarted",!1),dx(this,"uploadDownlinkStarted",!1),dx(this,"uplinkStateUploadInterval",void 0),dx(this,"downlinkStatsUploadInterval",void 0),dx(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==_j.Connected)return void n(new NI(II.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const o=r.find((e=>"videoLowTrack"===e[0]));o&&o[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let s=!1;var i,a;s="video"===e.trackMediaType?!(null===(i=this.localTrackMap.get(bj.LocalAudioTrack))||void 0===i||!i.track._muted):void 0===(null===(a=this.localTrackMap.get(bj.LocalVideoTrack))||void 0===a?void 0:a.id);const c=this.createMuteMessage(r);await oN(this,wj.RequestMuteLocal,c);const u="video"===e.trackMediaType?Dj.MUTE_LOCAL_VIDEO:Dj.MUTE_LOCAL_AUDIO;await oN(this,wj.RequestP2PMuteLocal,{action:u,message:c,isMuteAll:s}),t()}catch(e){n(e)}finally{r()}})),dx(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==_j.Connected)return void n(new NI(II.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();await this.sendConnection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const i=this.createUnmuteMessage(r),a="video"===e.trackMediaType?Dj.UNMUTE_LOCAL_VIDEO:Dj.UNMUTE_LOCAL_AUDIO;await oN(this,wj.RequestP2PMuteLocal,{action:a,message:i}),t()}catch(e){n(e)}finally{r()}})),dx(this,"handleUpdateVideoEncoder",(async(e,t,n,r)=>{let i;"boolean"==typeof r&&r||(i=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const n=this.localTrackMap.get(bj.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==_j.Connected)return void t();const{id:r,track:i}=n;r&&(await this.sendConnection.updateSendParameters(r,i),await this.sendConnection.updateEncoderConfig(r,i),this.emit(wj.UpdateVideoEncoder,i)),t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}})),dx(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(bj.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==_j.Connected)return void t();const{id:r,track:i}=n;r&&await this.sendConnection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),dx(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;ok.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var a;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.sendConnection||!n||void 0===n[1].id||this.state!==_j.Connected)return void t();if(await(null===(a=this.sendConnection)||void 0===a?void 0:a.replaceTrack(e,n[1].id)),n[0]===bj.LocalVideoTrack&&vk().supportDualStreamEncoding){const t=this.localTrackMap.get(bj.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new rh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var o;null===(o=i)||void 0===o||o()}})),dx(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),dx(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),dx(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),dx(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new zB(e),this.bindStatsUploaderEvents(),this.sendMutex=new FN("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new FN("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))}))}),IA("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new NI(II.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new NI(II.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(ok.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new tK(e,this.store,BP.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=_j.New,this.sendConnection&&(ok.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new tK(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new NI(II.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=_j.Connected}async addRemoteCandidate(e,t){if(t===BP.RECEIVE_ONLY){if(!this.sendConnection)throw new NI(II.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new NI(II.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return KT((function*(){const i=yield QT(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==_j.Connected){r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,YU.markPublishStart(r.store.clientId,r.store.pubId);const i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield QT(r.tryToUnmuteAudio(e)));i.forEach((e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===bj.LocalAudioTrack?"audio":"video",i)})),r.bindLocalTrackEvents(i);const a=yield QT(r.sendConnection.send(i.map((e=>{let{track:t}=e;return t})),r.store.codec,r.store.audioCodec)),o=(yield QT(a.next())).value,s=r.createGatewayPublishMessage(i,o);try{yield s}catch(e){throw a.throw(e),(null==e?void 0:e.code)===II.WS_ABORT&&i.forEach((e=>{let{track:t}=e;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)})),r.unbindLocalTrackEvents(i),e}yield QT(a.next()),i.forEach((e=>{let{type:t}=e;r.statsCollector.addLocalStats(t)})),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(i,o),i.forEach((e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===bj.LocalAudioTrack?"audio":"video",void 0,i)})),r.startUploadUplinkState()}finally{i()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==_j.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((t=>!Lr(e).call(e,t))));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===_j.Connected)return n&&n[1].track.close(),r;e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const e=[],t=[];Array.from(this.localTrackMap.entries()).forEach((n=>{let[r,{track:i,ssrcs:a}]=n;const o={stream_type:gB(i,r),ssrcs:a};i._muted||!i._enabled?e.push(o):t.push(o)})),e.length>0&&e.forEach((e=>{oN(this,wj.RequestMuteLocal,[e])})),t.length>0&&t.forEach((e=>{oN(this,wj.RequestUnmuteLocal,[e])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return KT((function*(){throw new NI(II.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(ok.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await aN(this,wj.RequestRePublish,this.pendingLocalTracks),this.emit(wj.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new NI(II.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new NI(II.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;const{track:a,mid:o,transceiver:s}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===mj.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new JL(a,e.uid,e._uintid,this.store),ok.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),s&&e._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new QL(a,e.uid,e._uintid,this.store),ok.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),s&&e._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const u=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==u&&(this.pendingRemoteTracks.splice(u,1),this.emit(wj.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new NI(II.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.recvConnection||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===mj.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===mj.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);0!==i.length&&(await this.recvConnection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach((e=>{let[t,{kind:r}]=e;var i,a;if(r===mj.VIDEO&&t._videoSSRC&&(null===(i=this.recvConnection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===mj.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(a=t._videoTrack)||void 0===a||a._destroy(),t._videoTrack=void 0);else if(r===mj.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0)}})),i.forEach((e=>{let[,{kind:t}]=e;oN(this,wj.RequestP2PMuteRemote,t)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach((e=>{let[,t]=e;[mj.VIDEO,mj.AUDIO].forEach((e=>{t.has(e)?oN(this,wj.RequestP2PUnmuteRemote,e):oN(this,wj.RequestP2PMuteRemote,e)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new NI(II.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new NI(II.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new NI(II.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new NI(II.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void ok.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void ok.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===mj.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||ok.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):ok.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(bj.LocalAudioTrack);if((null==t?void 0:t.track)instanceof WM){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==bj.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===bj.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===bj.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(bj.LocalAudioTrack),a=r?this.localTrackMap.get(bj.LocalVideoLowTrack):this.localTrackMap.get(bj.LocalVideoTrack);pk.publish(this.store.sessionId,{eventElapse:YU.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==a?void 0:a.track.getTrackLabel(),screenshare:-1!==(null==a?void 0:a.track._hints.indexOf(Fk.SCREEN_TRACK)),audio:!!n,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var a;n||(n=[]);const o=n.find((e=>e instanceof BM)),s=r?null===(a=this.localTrackMap.get(bj.LocalVideoTrack))||void 0===a?void 0:a.track:n.find((e=>e instanceof LL));pk.publish(this.store.sessionId,{eventElapse:YU.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==o?void 0:o.getTrackLabel(),videoName:null==s?void 0:s.getTrackLabel(),screenshare:-1!==(null==s?void 0:s._hints.indexOf(Fk.SCREEN_TRACK)),audio:!!o,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===mj.VIDEO?n._videoSSRC:n._audioSSRC;i&&pk.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===mj.VIDEO,audio:r===mj.AUDIO,peerid:n.uid,subscribeRequestid:r===mj.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:YU.measureFromSubscribeStart(this.store.clientId,i)})}reset(){ok.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new FN("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new FN("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(bj.LocalAudioTrack);if((null==e?void 0:e.track)instanceof WM){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=_j.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(bj.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(bj.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof LL||t&&t.track instanceof BM?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(bj.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Qh(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(ok.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=_j.Reconnecting,IA("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case bj.LocalVideoTrack:Lr(t=r._hints).call(t,Fk.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case bj.LocalAudioTrack:r instanceof WM?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case bj.LocalVideoLowTrack:}})),this.emit(wj.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(XA(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(wj.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),ok.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof ZU?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===BP.SEND_ONLY){if(!this.sendConnection)throw new NI(II.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new NI(II.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const e=await r.restartICE(t);return r.isInRestartIce=!1,e}{const e=await r.restartICE();if(e){const t=await aN(this,wj.RequestP2PRestartICE,{direction:BP.RECEIVE_ONLY,iceParameter:e});await r.restartICE(t),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(bj.LocalVideoTrack),n=this.localTrackMap.get(bj.LocalAudioTrack),r=e.videoSend.find((e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)})),i=e.audioSend.find((e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)}));if(!r||!i)return 1;const a=sN(this,wj.NeedSignalRTT),o=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=o&&s?(o+s)/2:o||s,u=(c&&a?(c+a)/2:c||a)||0,l=100*e.sendPacketLossRate*.7/50+.3*u/1500,d=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,f=null==t?void 0:t.track;if(f&&f._encoderConfig&&-1===f._hints.indexOf(Fk.SCREEN_TRACK)){const t=f._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return zO[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,a=r._videoSSRC,o=e.audioRecv.find((e=>e.ssrc===i)),s=e.videoRecv.find((e=>e.ssrc===a));if(!o&&!s)return void(t+=1);const c=sN(this,wj.NeedSignalRTT),u=e.rtt,l=(u&&c?(u+c)/2:u||c)||0,d=o?o.jitterMs:void 0,f=e.recvPacketLossRate;let h=.7*f*100/50+.3*l/1500;d&&(h=.6*f*100/50+.2*l/1500+.2*d/400),t+=h<.1?1:h<.17?2:h<.36?3:h<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new rh(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const r=[],i=vk(),a=this.getAllTracks();e=dN(e=e.filter((e=>-1===a.indexOf(e))));let o=!1,s=!1;for(const c of e){if(c instanceof LL&&(this.localTrackMap.has(bj.LocalVideoTrack)||o?new NI(II.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:bj.LocalVideoTrack}),o=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:bj.LocalVideoLowTrack})}if(c instanceof BM){const e=this.localTrackMap.get(bj.LocalAudioTrack);if(e){if(!(e.track instanceof WM))throw new NI(II.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new NI(II.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(s){const e=r.find((e=>{let{type:t}=e;return t===bj.LocalAudioTrack}));if(!(e.track instanceof WM))throw new NI(II.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new NI(II.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof WM||c._bypassWebAudio)r.push({track:c,type:bj.LocalAudioTrack});else{const e=new WM;e.addAudioTrack(c),r.push({track:e,type:bj.LocalAudioTrack})}s=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=dN(e=e.filter((e=>-1!==n.indexOf(e))));for(const r of e){if(r instanceof BM){const e=this.localTrackMap.get(bj.LocalAudioTrack);if(!e)continue;e.track instanceof WM?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([bj.LocalAudioTrack,e]),e.track.close())):t.push([bj.LocalAudioTrack,e])}if(r instanceof LL){const e=this.localTrackMap.get(bj.LocalVideoTrack);if(!e)continue;t.push([bj.LocalVideoTrack,e]);const n=this.localTrackMap.get(bj.LocalVideoLowTrack);n&&t.push([bj.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case bj.LocalVideoTrack:t.addListener(jk.GET_STATS,this.handleGetLocalVideoStats),t.addListener(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(jk.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(jk.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(jk.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case bj.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case bj.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof WM?e.trackList.forEach((e=>{e.addListener(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(jk.GET_STATS,this.handleGetLocalAudioStats),e.addListener(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(jk.GET_STATS,this.handleGetLocalAudioStats),e.addListener(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(jk.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case bj.LocalVideoTrack:t.off(jk.GET_STATS,this.handleGetLocalVideoStats),t.off(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(jk.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(jk.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(jk.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case bj.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case bj.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof WM?e.trackList.forEach((e=>{e.off(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(jk.GET_STATS,this.handleGetLocalAudioStats),e.off(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(jk.GET_STATS,this.handleGetLocalAudioStats),e.off(jk.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(jk.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(jk.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(jk.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(jk.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof QL&&t.addListener(jk.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof JL&&t.addListener(jk.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(jk.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(mj.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(mj.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,{track:a,type:o}=e;switch(o){case bj.LocalAudioTrack:i=rj.Audio;break;case bj.LocalVideoTrack:i=Lr(r=a._hints).call(r,Fk.SCREEN_TRACK)?rj.Screen:rj.High;break;case bj.LocalVideoLowTrack:i=rj.Low}return{kind:o===bj.LocalAudioTrack?mj.AUDIO:mj.VIDEO,stream_type:i,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:a.muted||!a.enabled}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case bj.LocalVideoTrack:n=Lr(t=i._hints).call(t,Fk.SCREEN_TRACK)?rj.Screen:rj.High;break;case bj.LocalAudioTrack:n=rj.Audio;break;case bj.LocalVideoLowTrack:n=rj.Low}return{stream_type:n,ssrcs:a,mid:o}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(wj.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),Lr(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&("disconnected"===t&&await CN(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),pk.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:KI.TRACER}).onSuccess(),this.emit(wj.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(Gk.FIRST_FRAME_DECODED),pk.firstRemoteFrame(this.store.sessionId,lk.FIRST_AUDIO_DECODE,dk.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:YU.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&pk.firstRemoteFrame(this.store.sessionId,lk.FIRST_AUDIO_RECEIVED,dk.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:YU.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(XA(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&pk.firstRemoteFrame(this.store.sessionId,lk.FIRST_VIDEO_RECEIVED,dk.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:YU.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(wj.ConnectionTypeChange,n),ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(dF(t))," -> ").concat(JSON.stringify(dF(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{ok.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(dF(t))," -> ").concat(JSON.stringify(dF(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(wj.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===BP.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,ok.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===BP.SEND_ONLY?this.restartICE(e):aN(this,wj.RequestP2PRestartICE,{direction:BP.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(bj.LocalAudioTrack);if(e instanceof BM&&(null==n?void 0:n.track)instanceof WM)return n.track.isActive||t.push([bj.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===bj.LocalVideoTrack)){const e=this.localTrackMap.get(bj.LocalVideoLowTrack);e&&t.push([bj.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(bj.LocalAudioTrack);if(e instanceof BM&&(null==n?void 0:n.track)instanceof WM)return n.track.isActive&&t.push([bj.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===bj.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(bj.LocalVideoLowTrack);e&&t.push([bj.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case bj.LocalAudioTrack:n=rj.Audio;break;case bj.LocalVideoTrack:n=Lr(t=i._hints).call(t,Fk.SCREEN_TRACK)?rj.Screen:rj.High;break;case bj.LocalVideoLowTrack:n=rj.Low}return{stream_type:n,ssrcs:a,mid:o}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case bj.LocalAudioTrack:n=rj.Audio;break;case bj.LocalVideoTrack:n=Lr(t=i._hints).call(t,Fk.SCREEN_TRACK)?rj.Screen:rj.High;break;case bj.LocalVideoLowTrack:n=rj.Low}return{stream_type:n,ssrcs:a,mid:o}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case mj.VIDEO:return void(n._videoSSRC&&t.push({stream_type:mj.VIDEO,ssrcId:n._videoSSRC}));case mj.AUDIO:return void(n._audioSSRC&&t.push({stream_type:mj.AUDIO,ssrcId:n._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(bj.LocalVideoTrack),n=this.localTrackMap.get(bj.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new rh(((e,n)=>{this.handleUpdateVideoEncoder(t.track,e,n,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new rh(((e,t)=>{this.handleUpdateVideoEncoder(n.track,e,t,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof BM){const n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;const r=this.createUnmuteMessage(n);return void await oN(this,wj.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(wj.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(wj.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await CN(VN(this.dtlsFailedCount,BN)),this.emit(wj.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(bj.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof LL))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof LL)).length>1)throw new NI(II.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof BM)).length>1&&(e.some((e=>e instanceof BM&&e._bypassWebAudio))||!vk().webAudioMediaStreamDest))throw new NI(II.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof LL&&this.pendingLocalTracks.some((e=>e instanceof LL)))throw new NI(II.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof BM&&this.pendingLocalTracks.some((e=>e instanceof BM))&&(!vk().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof BM&&e._bypassWebAudio))))throw new NI(II.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!IA("DISABLE_DUAL_STREAM_USE_ENCODING")&&vk().supportDualStreamEncoding,r=vK(vK({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():IB(e,r);const a=xN(8,"track-low-"),o=new LL(i,vK(vK({},n&&{scaleResolutionDownBy:lF(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,a);return o.on(zk.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,Uk.LOW_STREAM)})),o._hints.push(Fk.LOW_STREAM),e.addListener(jk.NEED_CLOSE,(()=>{o.close()})),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const a=Array.from(XA(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,o=i.subscribe.find((e=>e.userId===a.uid&&"video"===e.type));pk.firstRemoteVideoDecode(this.store.sessionId,lk.FIRST_VIDEO_DECODE,dk.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:YU.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==o?void 0:o.subscribeEnd)||0,subscriberStart:(null==o?void 0:o.subscribeStart)||0,videoAddNotify:(null==o?void 0:o.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const a=await this.recvConnection.getRemoteSSRC(i);return void 0!==a&&a!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new NI(II.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new NI(II.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new NI(II.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new NI(II.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new NI(II.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new NI(II.NOT_SUPPORTED)}async preConnect(e){throw new NI(II.NOT_SUPPORTED)}getEstablishParams(){throw new NI(II.NOT_SUPPORTED)}async reSubscribe(e){throw new NI(II.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new NI(II.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===bj.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Uk.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},NP(mK.prototype,"p2pConnect",[iK],Object.getOwnPropertyDescriptor(mK.prototype,"p2pConnect"),mK.prototype),NP(mK.prototype,"unpublish",[aK],Object.getOwnPropertyDescriptor(mK.prototype,"unpublish"),mK.prototype),NP(mK.prototype,"unpublishLowStream",[oK],Object.getOwnPropertyDescriptor(mK.prototype,"unpublishLowStream"),mK.prototype),NP(mK.prototype,"subscribe",[sK],Object.getOwnPropertyDescriptor(mK.prototype,"subscribe"),mK.prototype),NP(mK.prototype,"mockSubscribe",[cK],Object.getOwnPropertyDescriptor(mK.prototype,"mockSubscribe"),mK.prototype),NP(mK.prototype,"unsubscribe",[uK],Object.getOwnPropertyDescriptor(mK.prototype,"unsubscribe"),mK.prototype),NP(mK.prototype,"muteRemote",[lK],Object.getOwnPropertyDescriptor(mK.prototype,"muteRemote"),mK.prototype),NP(mK.prototype,"unmuteRemote",[dK],Object.getOwnPropertyDescriptor(mK.prototype,"unmuteRemote"),mK.prototype),NP(mK.prototype,"hasRemoteMediaWithLock",[fK],Object.getOwnPropertyDescriptor(mK.prototype,"hasRemoteMediaWithLock"),mK.prototype),NP(mK.prototype,"disconnectForReconnect",[hK],Object.getOwnPropertyDescriptor(mK.prototype,"disconnectForReconnect"),mK.prototype),NP(mK.prototype,"remoteMediaSsrcChanged",[pK],Object.getOwnPropertyDescriptor(mK.prototype,"remoteMediaSsrcChanged"),mK.prototype),mK);function bK(e){return function(t,n,r){const i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];switch(e){case rK.SEND_ONLY:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}case rK.RECEIVE_ONLY:{const e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}default:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e(),t()}}}},r}}class _K extends GI{constructor(e,t){super(),dx(this,"signal",void 0),dx(this,"token",void 0),dx(this,"tokenTimeout",void 0),dx(this,"tokenInterval",void 0),dx(this,"_sequence",0),dx(this,"userMap",new Map),dx(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const n=()=>{this.signal.connectionState===OP.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*IA("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,r,i){var a;if(0===this.userMap.size)return;const o=Array.from(fh(a=this.userMap).call(a))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),r=null!=r?r:xN(6,""),i=null!=i?i:this._sequence++;const s={_id:r,_type:e,_seq:i,_message:t,token:"".concat(this.token,"_").concat(o)};IA("SHOW_P2P_LOG")&&ok.debug("send message",s,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(s)).forEach((e=>{this.signal.request(jP.DATA_STREAM,{payload:yN(this.encoder.encode(e))})}));const c=new rh(((t,i)=>{const a=window.setTimeout((()=>{this.off("res-@".concat(r,"_ack"),o),this.off("res-@".concat(r),u),this.off(kj.ABORT,c),ok.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),0===this.userMap.size?i(new NI(II.INVALID_REMOTE_USER)):i(new NI(II.TIMEOUT))}),IA("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),o=()=>{a&&window.clearTimeout(a),this.off(kj.ABORT,c),n&&t()},c=()=>{a&&window.clearTimeout(a),this.off("res-@".concat(r,"_ack"),o),this.off("res-@".concat(r),u),i(new NI(II.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(kj.ABORT,c),this.once("res-@".concat(r,"_ack"),o);const u=(n,s)=>{l=!0,a&&window.clearTimeout(a),this.off("res-@".concat(r,"_ack"),o),this.off(kj.ABORT,c),"success"===n?t(s):i(new NI(II.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let l=!1;n||(this.once("res-@".concat(r),u),CN(IA("SIGNAL_REQUEST_TIMEOUT")).then((()=>{l||ok.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(s))})))}));try{return await c}catch(a){if(a.code===II.TIMEOUT)return await this.send(e,t,n,r,i);throw a}}onMessage(e){var t;const{_uid:n}=e;let r,i=this.userMap.get(n);if(i)r=i.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==Aj.CHECK)return;const{token:t}=e;r=new Map,i={uid:n,isStart:!0,token:t,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,i),this.signal.emit(UP.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in e&&"total"in e){var a;const{id:t,total:i}=e,o=null!==(a=r.get(t))&&void 0!==a?a:[];if(o.push(e),r.has(t)||r.set(t,o),o.length!==i)return;{const i=Qh(o).call(o,((e,t)=>e.index-t.index)).map((e=>e.payload)).join("");r.delete(t),(e=JSON.parse(i))._uid=n}}const{_type:o,token:s}=e;if(Lr(t=[Aj.ACK,Aj.CHECK]).call(t,o))return o===Aj.CHECK&&this.handleCheckToken(i,s),void this.receiveMessage(e);s==="".concat(i.token,"_").concat(this.token)?this.handleReceivedMessage(e):ok.debug('Receive unexpected message", '.concat(s,", cur_token: ").concat(i.token,"_").concat(this.token),e)}check(){const e={_id:xN(6,""),token:this.token,_type:Aj.CHECK};IA("SHOW_P2P_LOG")&&ok.debug("send message",e),this.signal.request(jP.DATA_STREAM,{payload:yN(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:Aj.ACK,token:this.token};IA("SHOW_P2P_LOG")&&ok.debug("send message",t),this.signal.request(jP.DATA_STREAM,{payload:yN(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(Aj.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach((e=>{const{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){const r=t.get(n);t.delete(n),this.receiveMessage(r),e.nextExpectedSequenceNumber++}}))};if(!e)return void t();const{_uid:n,_seq:r}=e,i=this.userMap.get(n),{receivedMessagesMap:a,isStart:o,nextExpectedSequenceNumber:s}=i;if(r<s)return this.ack(e._id),void ok.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));a.set(r,e),o&&r===s&&(this.receiveMessage(e),a.delete(s),i.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:n,_message:r,_uid:i}=e;if(IA("SHOW_P2P_LOG")&&ok.debug("receive message",e),t){let a;switch(e._type!==Aj.ACK&&(r&&(a=JSON.parse(r)),this.ack(e._id)),e._type){case Aj.CANDIDATE:case Aj.CONTROL:this.signal.emit(n,a,i);break;case Aj.PUBLISH:case Aj.UNPUBLISH:case Aj.RESTART_ICE:case Aj.CALL:a.uid=i,aN(this.signal,n,a).then((t=>{this.response(e._id,t)})).catch((()=>{this.response(e._id,void 0,!0)}));break;case Aj.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case Aj.RESPONSE:{const{success:e,message:n}=a;this.emit("res-@".concat(t),e?"success":"failed",n);break}}}}splitMessage(e){if(e.length<_K.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:n}=JSON.parse(e),r=xN(6,"");let i=0,a=800;const o=Math.ceil(e.length/a);for(;e.length>0;){i++;const s={id:r,index:i,total:o,payload:e.slice(0,a),token:"".concat(this.token,"_").concat(n)};JSON.stringify(s).length>_K.MAX_MESSAGE_SIZE?a-=50:(t.push(s),e=e.slice(a))}return t.map((e=>JSON.stringify(e)))}handleCheckToken(e,t){return e.token!==t?(ok.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{ok.debug("token timeout, ".concat(t)),this.reset(e.uid)}),IA("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await aN(this.signal,Aj.CALL,void 0),t=await this.send(Aj.CALL,e);this.signal.emit(PP.P2P_CONNECTION,t,!0)}async reset(e,t){const n=this.userMap.get(e);n&&(this.emit(kj.ABORT),this.signal.emit(UP.ON_USER_OFFLINE,{uid:n.uid,reason:Mj.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(ok.debug("change local token from ".concat(t," to ").concat(t)),this.token=xN(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(kj.ABORT)}}dx(_K,"MAX_SIZE",1),dx(_K,"MAX_MESSAGE_SIZE",1024);class wK extends GI{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===OP.CONNECTED?this.emit(PP.WS_CONNECTED):e===OP.RECONNECTING?this.emit(PP.WS_RECONNECTING,this._websocketReconnectReason):e===OP.CLOSED&&this.emit(PP.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),dx(this,"_disconnectedReason",void 0),dx(this,"_websocketReconnectReason",void 0),dx(this,"_connectionState",OP.CLOSED),dx(this,"reconnectToken",void 0),dx(this,"p2pToken",void 0),dx(this,"websocket",void 0),dx(this,"openConnectionTime",void 0),dx(this,"clientId",void 0),dx(this,"lastMsgTime",Date.now()),dx(this,"uploadCache",[]),dx(this,"uploadCacheInterval",void 0),dx(this,"rttRolling",new GN(5)),dx(this,"pingpongTimer",void 0),dx(this,"pingpongTimeoutCount",0),dx(this,"joinResponse",void 0),dx(this,"multiIpOption",void 0),dx(this,"initError",void 0),dx(this,"spec",void 0),dx(this,"store",void 0),dx(this,"_external_signal",void 0),dx(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(PP.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case UP.ON_DATA_STREAM:return void this.handleDataStream(t._message);case UP.MUTE_AUDIO:case UP.MUTE_VIDEO:case UP.ON_P2P_LOST:case UP.ON_USER_ONLINE:return;case UP.ON_USER_OFFLINE:const{uid:e}=t._message;return ok.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===UP.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===UP.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(JI.UID_BANNED);break;case 15:this.close(JI.IP_BANNED);break;case 16:this.close(JI.CHANNEL_BANNED)}if(t._type===UP.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case LP.ERR_LICENSE_MISSING:this.close(JI.LICENSE_MISSING);break;case LP.ERR_LICENSE_EXPIRED:this.close(JI.LICENSE_EXPIRED);break;case LP.ERR_LICENSE_MINUTES_EXCEEDED:this.close(JI.LICENSE_MINUTES_EXCEEDED);break;case LP.ERR_LICENSE_PERIOD_INVALID:this.close(JI.LICENSE_PERIOD_INVALID);break;case LP.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(JI.LICENSE_MULTIPLE_SDK_SERVICE);break;case LP.ERR_LICENSE_ILLEGAL:this.close(JI.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Xj("gateway-".concat(this.clientId),this.spec.retryConfig,!0,IA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),IA("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===OP.CONNECTED&&this.reconnect("retry",nN.OFFLINE)})),this.p2pToken=xN(6,""),this._external_signal=new _K(this,this.p2pToken)}async request(e,t,n,r){const i=xN(6,""),a={_id:i,_type:e,_message:t},o=this.websocket.connectionID,s=()=>new rh(((e,t)=>{if(this.connectionState===OP.CONNECTED)return e();const n=()=>{this.off(PP.WS_CLOSED,r),e()},r=()=>{this.off(PP.WS_CONNECTED,n),t(new NI(II.WS_ABORT))};this.once(PP.WS_CONNECTED,n),this.once(PP.WS_CLOSED,r)}));if(this.connectionState!==OP.CONNECTING&&this.connectionState!==OP.RECONNECTING||e===jP.JOIN||e===jP.REJOIN||await s(),this.websocket.sendMessage(a,!0),r)return;const c=new rh(((n,r)=>{let a=!1;const s=(r,i)=>{a=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(PP.WS_CLOSED,c),this.off(PP.WS_RECONNECTING,c),this.emit(PP.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);const c=()=>{r(new NI(II.WS_ABORT,"type: ".concat(e))),this.off(PP.WS_CLOSED,c),this.off(PP.WS_RECONNECTING,c),this.off("res-@".concat(i),s)};this.once(PP.WS_CLOSED,c),this.once(PP.WS_RECONNECTING,c),CN(IA("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==o||a||(ok.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(PP.REQUEST_TIMEOUT,e,t))}))}));let u=null;try{u=await c}catch(r){if(this.connectionState===OP.CLOSED||e===jP.LEAVE)throw new NI(II.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===jP.JOIN||e===jP.REJOIN?null:(await s(),await this.request(e,t))}if(u.isSuccess)return u.message;const l=Number(u.message.error_code||u.message.code),d=jj(l),f=new NI(II.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(u.message.error_str),{code:l,data:u.message,desc:d.desc});return"success"===d.action?u.message:(ok.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(d.desc,", action: ").concat(d.action)),l===LP.ERR_TOO_MANY_BROADCASTERS?e===jP.JOIN||e===jP.REJOIN?(this.initError=f,this.close(),f.throw()):f.throw():"failed"===d.action?f.throw():"quit"===d.action?(this.initError=f,this.close(),f.throw()):(l===LP.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,ok.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nN.MULTI_IP)):this.reconnect(d.action,nN.SERVER_ERROR),e===jP.JOIN||e===jP.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new rh((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void ok.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(FP.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=IA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==OP.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),IA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new rh(((t,n)=>{this.once(PP.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(PP.WS_CLOSED,(()=>n(this.initError||new NI(II.WS_ABORT)))),this.connectionState=OP.CONNECTING,this.websocket.init(e).catch(n)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||JI.LEAVE,this.connectionState=OP.CLOSED,ok.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=xN(6,""),this._external_signal.clear(),this._external_signal=new _K(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(PP.ABORT_P2P_EXECUTION);const e=await aN(this,PP.REQUEST_JOIN_INFO),t=await this.request(jP.JOIN,e);if(!t)return this.emit(PP.REPORT_JOIN_GATEWAY,II.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(PP.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=OP.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){return!1}handleDataStream(e){try{var t;const n=vN(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||Lr(t=Object.values(Aj)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(UP.ON_DATA_STREAM,e)}catch(t){this.emit(UP.ON_DATA_STREAM,e)}}handleNotification(e){ok.debug("[".concat(this.clientId,"] receive notification: "),e);const t=jj(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(JI.UID_BANNED),void this.close()):void this.reconnect(t.action,nN.SERVER_ERROR);ok.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=IA("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(ok.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>IA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nN.TIMEOUT):this.request(jP.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),IA("REPORT_STATS")&&this.send(jP.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWebsocketEvents(){this.websocket.on(VP.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(PP.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(VP.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(VP.CLOSED,(()=>{this.connectionState=OP.CLOSED})),this.websocket.on(VP.FAILED,(()=>{this._disconnectedReason=JI.NETWORK_ERROR,this.connectionState=OP.CLOSED})),this.websocket.on(VP.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===OP.CONNECTED?this.connectionState=OP.RECONNECTING:this.connectionState=OP.CONNECTING})),this.websocket.on(VP.WILL_RECONNECT,((e,t,n)=>{"retry"!==e?(ok.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):ok.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)})),this.websocket.on(VP.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((e=>{if(this.emit(PP.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof NI&&e.code===II.UNEXPECTED_RESPONSE&&e.data.code===LP.ERR_NO_AUTHORIZED)return ok.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",nN.SERVER_ERROR);ok.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nN.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(VP.REQUEST_NEW_URLS,((e,t)=>{aN(this,PP.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(VP.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(UP.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const EK={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new yK(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new wK(n,t)}};function SK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function CK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SK(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class xK{constructor(e){dx(this,"sessionDesc",void 0),dx(this,"localCapabilities",void 0),dx(this,"rtpCapabilities",void 0),dx(this,"candidates",void 0),dx(this,"_originCandidates",void 0),dx(this,"iceParameters",void 0),dx(this,"dtlsParameters",void 0),dx(this,"setup",void 0),dx(this,"currentMidIndex",void 0),dx(this,"cname",void 0),e=hN(e);const{iceParameters:t,dtlsParameters:n,candidates:r,rtpCapabilities:i,setup:a,localCapabilities:o,sdkCodec:s,cname:c}=e,u=UA("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this._originCandidates=hN(r),this.iceParameters=t,this.dtlsParameters=n,this.setup=a,this.localCapabilities=o,this.cname=c;for(let l=0;l<u.mediaDescriptions.length;l++){const e=u.mediaDescriptions[l];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=a,"video"===e.media.mediaType){e.media.fmts=i.videoCodecs.map((e=>e.payloadType.toString(10)));const t=i.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Lr(n=t.encodingName.toLowerCase()).call(n,s)})),n=i.videoCodecs.filter((e=>!Lr(t).call(t,e)));e.attributes.payloads=[...t,...n],e.attributes.extmaps=i.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=i.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions),u.mediaDescriptions[l]=this.mungMediaDesc(e)}this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1}toString(){return BA(this.sessionDesc)}send(e,t,n){const{ssrcs:r,ssrcGroups:i}=TF(t,this.cname),a=this.sessionDesc.mediaDescriptions.find((t=>e===mj.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType)),o=r[0].attributes.label,s=r[0].attributes.mslabel;return a.attributes.ssrcs=a.attributes.ssrcs.concat(r),a.attributes.ssrcGroups=a.attributes.ssrcGroups.concat(i),{id:o,mslabel:s}}batchSend(e){return e.map((e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)}))}stopSending(e){this.sessionDesc.mediaDescriptions.forEach((t=>{const n=[],r=[],i=[];t.attributes.ssrcs.forEach((t=>{Lr(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((e=>{var t;Lr(t=i.map((e=>e.ssrcId))).call(t,e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach(((e,t)=>{const n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===n.kind)),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i}))}stopReceiving(e){}updateCandidates(e){const t=this._originCandidates.filter((e=>"udp"===e.transport)),n=[];if(t.forEach((e=>{n.push(CK(CK({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),0!==t.length){switch(e){case gj.TCP_RELAY:this.candidates=n;break;case gj.UDP_TCP_RELAY:case gj.RELAY:this.candidates=[...t,...n];break;default:this.candidates=t}for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}}restartICE(e){e=hN(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=hN(e);return RF(n,t),NF(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const r=this.sessionDesc.mediaDescriptions.find((t=>e===mj.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid));if(r){const e=r.attributes.ssrcs.find((e=>e.attributes.label===t));var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){const t=hN(e);return IF(t),function(e){const t=e.attributes.extmaps.find((e=>yF(e.extensionName)));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}var TK;function RK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function IK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?RK(Object(n),!0).forEach((function(t){dx(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let NK=(TK=class e extends pj{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Lr(t=Object.keys(DA)).call(t,e)})))]}constructor(t,n){super(t,n),dx(this,"store",void 0),dx(this,"peerConnection",void 0),dx(this,"remoteSDP",void 0),dx(this,"initialOffer",void 0),dx(this,"statsFilter",void 0),dx(this,"useRTX",!1),dx(this,"localCapabilities",void 0),dx(this,"localCandidateCount",0),dx(this,"allCandidatesReceived",!1),dx(this,"establishPromise",void 0),dx(this,"mutex",void 0),this.store=n,this.mutex=new FN("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=mA(this.peerConnection,IA("STATS_UPDATE_INTERVAL"),void 0,nI()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=EF(e.sdp),n=wF(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:IA("FILTER_VIDEO_FEC"),filterAudioFec:IA("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,IK(IK({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new NI(II.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new xK(IK(IK({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new NI(II.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var n=this;return KT((function*(){const r=yield QT(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=e.map((e=>n.peerConnection.addTrack(e._mediaStreamTrack))),i=yield QT(n.peerConnection.createOffer()),a=UA(i.sdp),o=e.map((e=>{const t=e._mediaStreamTrack,r=a.mediaDescriptions.find((e=>e.attributes.mid===t.kind));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const r=e.attributes.ssrcs.filter((e=>e.attributes.label===t)),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){const e=i.find((e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId)));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)}));let s;try{s=yield o}catch(e){throw r.forEach((e=>{$R()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),e}const c=n.mungSendOfferSDP(i.sdp,e);n.remoteSDP.receive(e,t,s);const u=n.remoteSDP.toString();return yield QT(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield QT(n.applySendEncodings(r,e)),yield QT(n.peerConnection.setRemoteDescription({type:"answer",sdp:u})),e.map(((e,t)=>{const n=e._mediaStreamTrack.id;return{localSSRC:o[t],id:n}}))}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}}))()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{$R()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),a=new rh(((t,r)=>{const a=setTimeout((()=>{r(new Error("Cannot receive track, id: ".concat(n)))}),1e4),o=r=>{const s=qR();if(("Safari"===s.name&&11===Number(s.version)||rI())&&r.track.id!==n&&r.streams[0].id===i){var c;const i=r.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",o),clearTimeout(a),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",o),clearTimeout(a),void t(r.track)};this.peerConnection.addEventListener("track",o)})),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),{track:await a,id:n}}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map((e=>{if($R()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!1)),e.setParameters(t)}}))}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map((async e=>{if($R()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!0)),await e.setParameters(t)}}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return KT((function*(){const n=yield QT(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const n=vk().supportPCSetConfiguration;if(e===gj.RELAY&&!n)return;if(n){const n=t.peerConnection.getConfiguration(),r=e===gj.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(ok.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}e!==gj.RELAY&&t.remoteSDP.updateCandidates(e);const r=yield QT(t.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const i=EF(r.sdp),{remoteIceParameters:a}=yield i.iceParameters;t.remoteSDP.restartICE(a);const o=t.remoteSDP.toString();yield QT(t.peerConnection.setLocalDescription(r)),yield QT(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){ok.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e}));1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t}));n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new NI(II.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new NI(II.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,ok.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,ok.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),IA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(ZI(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),IA("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id}))),!t)return ok.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!vk().supportSetRtpSenderParameters)return ok.warn("Browser not support set rtp-sender parameters");const r={},i={};if(e instanceof LL)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(IA("DSCP_TYPE")&&EI()){var a;const e=IA("DSCP_TYPE");Lr(a=["very-low","low","medium","high"]).call(a,e)&&(i.networkPriority=e)}const o=t.getParameters(),s=null===(n=o.encodings)||void 0===n?void 0:n[0];s&&Object.assign(s,i),Object.assign(o,r),ok.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(o.encodings))),await t.setParameters(o)}async applySendEncodings(e,t){try{if(!vk().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];r&&i&&await this.updateRtpSenderEncodings(i,r)}}catch(e){ok.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=UA(e);return t.forEach(((e,t)=>{const r=e._mediaStreamTrack,i=n.mediaDescriptions.find((e=>e.attributes.mid===r.kind));i&&RF(i,e)})),BA(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map(((t,n)=>{let{id:r,mslabel:i}=t;const{kind:a}=e[n];return new rh(((e,t)=>{const n=setTimeout((()=>{t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),o=t=>{const s=qR();if("Safari"===s.name&&11===Number(s.version)&&t.track.id!==r&&t.streams[0].id===i){var c;const i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(a,r,t.track.id),this.peerConnection.removeEventListener("track",o),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",o),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",o)}))})),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await rh.all(t)}catch(e){throw new NI(II.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(vk().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},NP(TK.prototype,"connect",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"connect"),TK.prototype),NP(TK.prototype,"stopSending",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"stopSending"),TK.prototype),NP(TK.prototype,"receive",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"receive"),TK.prototype),NP(TK.prototype,"stopReceiving",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"stopReceiving"),TK.prototype),NP(TK.prototype,"muteRemote",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"muteRemote"),TK.prototype),NP(TK.prototype,"unmuteRemote",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"unmuteRemote"),TK.prototype),NP(TK.prototype,"muteLocal",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"muteLocal"),TK.prototype),NP(TK.prototype,"unmuteLocal",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"unmuteLocal"),TK.prototype),NP(TK.prototype,"close",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"close"),TK.prototype),NP(TK.prototype,"updateEncoderConfig",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"updateEncoderConfig"),TK.prototype),NP(TK.prototype,"updateSendParameters",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"updateSendParameters"),TK.prototype),NP(TK.prototype,"replaceTrack",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"replaceTrack"),TK.prototype),NP(TK.prototype,"getRemoteSSRC",[AK],Object.getOwnPropertyDescriptor(TK.prototype,"getRemoteSSRC"),TK.prototype),TK);function AK(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return await r.apply(this,a)}finally{n()}},n}const kK={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new NK(n,t)}},DK={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!vk().supportWebRTCEncodedTransform)return void ok.warning("browser not support audio encoded transform");if(lO.has(e))return;if(!e.track)return;const n={track:e.track};if(ZR()){if(!e.createEncodedStreams)return void ok.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void ok.error("create audio-encoded-streams error",e&&e.message)}const a=new TransformStream({transform(i,a){n.controller||(n.controller=a),e.track&&e.track.id!==n.track.id&&(ok.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const o=t.metadata&&t.metadata();o?function(e,t){const{chunk:n,controller:r}=t,i=cO.METADATA;n.data=function(e,t,n){const r=n.byteLength,i=r+oO+sO,a=iO+aO+i,o=new ArrayBuffer(e.byteLength+a),s=new DataView(o);s.setUint8(0,rO),s.setUint16(1,i),s.setUint8(3,t),s.setUint16(4,r);for(let u=0;u<r;u++)s.setUint8(6+u,n[u]);const c=new Uint8Array(s.buffer);return c.set(new Uint8Array(e),a),c.buffer}(n.data,i,e),r.enqueue(n)}(o,{sender:e,chunk:i,controller:a}):a.enqueue(i)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else if($R()){if("undefined"==typeof RTCRtpScriptTransform)return void ok.warning("browser not support RTCRtpScriptTransform");const i=nO(),a=new MessageChannel;await new rh((e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)}));const o=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:a.port2},[a.port2]);e.transform=o,await new rh((e=>i.onmessage=t=>{"started"===t.data&&e(void 0)})),a.port1.onmessage=i=>{var o;if(i.data.transformed&&e.track&&(null===(o=e.track)||void 0===o?void 0:o.id)!==n.track.id)ok.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r);else if(i.data.getMetadata){const e=t.metadata&&t.metadata();e&&a.port1.postMessage({metadata:e})}},n.worker=i}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const t=lO.get(e);if(t){lO.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){ok.warning(e&&e.message)}}}lO.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!vk().supportWebRTCEncodedTransform)return void ok.warning("browser not support audio encoded transform");if(DO.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(ZR()&&!rI()){if(!e.createEncodedStreams)return void ok.warning("browser not support createEncodedStreams() API");oI(WR.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(e){return void ok.error("create audio-encoded-streams error",e&&e.message)}const a=new TransformStream({transform(i,a){n.controller||(n.controller=a),e.track&&e.track.id!==n.track.id&&(ok.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)),t.enableTopn?function(e,t,n){var r;const i=uO(new DataView(t.data));if(!i)return n.enqueue(t);const a=e.track.id;MO.set(a,e.track);const o=null===(r=i.tlv.find((e=>e.tag===cO.AUDIO_LEVEL)))||void 0===r?void 0:r.value;let s=0;"number"==typeof o&&(s=127-o);const c=Math.round(Math.pow(10,s/60)-1),{selected:u,speaker:l}=function(e,t){let n=EO.get(e);if(n||(n=function(e){const t=new yO;return EO.set(e,t),SO||(SO=new wO(IA("TOPN_SILENCE_THRESHOLD")||500),SO.on("ActiveSpeakerChanged",(e=>{null!=e&&(CO=e)}))),SO.addSpeakers([t]),t}(e)),EO.size<=xO)return{selected:!0,speaker:n};if(!SO)throw new Error("no active speaker detector");return SO.levelChanged(n.id,t),TO=SO.loudest.map((e=>e.id)),CO&&!Lr(TO).call(TO,CO)&&TO.length>=xO&&TO.pop(),{selected:Lr(TO).call(TO,n.id)||n.id===CO,speaker:n}}(e,c),d=function(e,t,n){const r=RO.get(e)||new NO(e,t);return r.score=n,RO.set(e,r),function(e){if(IO.set(e,!0),!AO)return void(AO=Date.now());const t=Date.now();t-AO>1e3&&(IO.get(e)?IO.set(e,!1):(kO(e),IO.delete(e)),AO=t)}(e),r}(a,e.track,l.energyScore);d.addSample(u),d.active&&(t.data=i.frame.buffer,n.enqueue(t))}(e,i,a):t.enableMetadata||t.enablePts?function(e,t,n,r){const i=new DataView(e.data),a=i.getUint8(0);let o;if(0!=(128&a)&&71!==a){const t=function(e){if(e.byteLength<=0)return[];const t=[];let n=0;for(;n<e.byteLength;){const r=(128&e.getUint8(n))>>7,i=127&e.getUint8(n);if(!(r&&n+4<=e.byteLength)){n++;break}{const r=e.getUint32(n,!1),a=(16776192&r)>>10,o=1023&r;t.push({pt:i,ts_offset:a,length:o,data:new Uint8Array}),n+=4}}let r=e.byteLength-n;for(const i of t){if(i.length>r)return console.warn("Broken red payload"),[];i.length>0&&(i.data=new Uint8Array(e.buffer,e.byteOffset+n,i.length),n+=i.length,r-=i.length)}if(r>0){const i={pt:t.length>0?t[t.length-1].pt:0,ts_offset:0,length:r,data:new Uint8Array(e.buffer,e.byteOffset+n,r)};t.push(i)}return t}(i);if(t.length>0){const n=function(e){let t=0;for(let i=0;i<e.length;i++)t+=i<e.length-1?4:1,t+=e[i].length;const n=new Uint8Array(t);let r=0;for(let i=0;i<e.length;i++)if(i<e.length-1){const t=(2147483648|(127&e[i].pt)<<24|(262143&e[i].ts_offset)<<10|1023&e[i].length)>>>0;n[r++]=t>>24&255,n[r++]=t>>16&255,n[r++]=t>>8&255,n[r++]=255&t}else n[r++]=127&e[i].pt;for(const i of e)n.set(i.data,r),r+=i.length;return n}(t.map((e=>{const t=new Uint8Array(e.length);t.set(e.data);const n=uO(new DataView(t.buffer));return null!=n&&n.frame&&(e.data=null==n?void 0:n.frame),o=n,e})));e.data=n.buffer}}else o=uO(i),o&&(e.data=o.frame.buffer);if(t.enqueue(e),!o)return;const s=o.tlv.find((e=>e.tag===cO.METADATA));s&&n&&s.value instanceof Uint8Array&&n(s.value);const c=o.tlv.find((e=>e.tag===cO.AUDIO_64_BIT_PTS));c&&r&&c.value instanceof Uint8Array&&8==c.value.length&&r(new DataView(c.value.buffer).getBigUint64(0,!0))}(i,a,t.onMetadata,t.onPts):a.enqueue(i)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else{if("undefined"==typeof RTCRtpScriptTransform)return void ok.warning("browser not support RTCRtpScriptTransform");const t=nO(),i=new MessageChannel;await new rh((e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)}));const a=new RTCRtpScriptTransform(t,{name:"audio-metadata-rx",port:i.port2},[i.port2]);e.transform=a,await new rh((e=>t.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(ok.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.metadata&&n.onMetadata?n.onMetadata(t.data.metadata):t.data.pts&&n.onPts&&n.onPts(t.data.pts)},n.worker=t}function r(){e.track.removeEventListener("ended",r),function(e){const t=DO.get(e);if(t){!function(e){const t=EO.get(e);t&&(EO.delete(e),SO&&(SO.removeSpeakers([t]),0===EO.size&&(SO.destroy(),SO=null)))}(e),kO(e.track.id),DO.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){ok.warning(e&&e.message)}}}(e)}DO.set(e,n),e.track.addEventListener("ended",r)},interceptLocalVideoFrame:async function(e,t){if(!vk().supportWebRTCEncodedTransform)return void ok.warning("browser not support video encoded transform");if(UO.has(e))return;if(!e.track)return;const n={track:e.track};if(ZR()){if(!e.createEncodedStreams)return void ok.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void ok.error("create video-encoded-streams error",e&&e.message)}const a=[];t.on("sei-to-send",(e=>{a.push(e)}));const o=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(ok.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const o=FO(new Uint8Array(t.data)),s=a.shift();if(s){const e=function(e,t,n){switch(n){case LO:return function(e,t){const n=jO(t),r=n.length,i=Math.floor(r/255),a=r%255,o=new Uint8Array(6+i+1+r+e.byteLength);o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=6,o[5]=101;let s=0;for(;s<i;)o[6+s]=255,s++;return o[6+s]=a,s++,o.set(n,6+s),o.set(new Uint8Array(e),6+s+r),o.buffer}(e,t);case OO:return function(e,t){const n=jO(t),r=n.length,i=Math.floor(r/255),a=r%255,o=new Uint8Array(7+i+1+r+1+e.byteLength);o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=78,o[5]=1,o[6]=101;let s=0;for(;s<i;)o[7+s]=255,s++;return o[7+s]=a,s++,o.set(n,7+s),s+=r,o[7+s]=128,s++,o.set(new Uint8Array(e),7+s),o.buffer}(e,t);default:return null}}(t.data,s,o);e&&(t.data=e)}i.enqueue(t)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(!$R())return;{if("undefined"==typeof RTCRtpScriptTransform)return void ok.warning("browser not support RTCRtpScriptTransform");const i=nO(),a=new MessageChannel;await new rh((e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)}));const o=new RTCRtpScriptTransform(i,{name:"sei-tx",port:a.port2},[a.port2]);e.transform=o,await new rh((e=>i.onmessage=t=>{"started"===t.data&&e(void 0)})),t.on("sei-to-send",(e=>{a.port1.postMessage({sei:e})})),a.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id&&(ok.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const t=UO.get(e);if(t){UO.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){ok.warning(e&&e.message)}}}UO.set(e,n),e.track.addEventListener("ended",r)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!vk().supportWebRTCEncodedTransform)return void ok.warning("browser not support video encoded transform");if(!e.track)return;if(BO.has(e)){const n=BO.get(e);return void(n&&(n.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(ZR()){if(!e.createEncodedStreams)return void ok.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(e){return void ok.error("create video-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(ok.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const a=function(e,t){switch(t){case LO:return function(e){const t=new DataView(e.data);let n=0;for(;n+4<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&6===t.getUint8(n+4)){let r=n+6,i=0,a=0;for(;255===(a=t.getUint8(r++));)i+=255;i+=a;const o=PO(e.data,r,i);return new Uint8Array(o)}n++}return null}(e);case OO:return function(e){const t=new DataView(e.data);let n=0;for(;n+5<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&78===t.getUint8(n+4)&&1===t.getUint8(n+5)&&101===t.getUint8(n+6)){let r=n+7,i=0,a=0;for(;255===(a=t.getUint8(r++));)i+=255;i+=a;const o=PO(e.data,r,i);return new Uint8Array(o)}n++}return null}(e);default:return null}}(t,FO(new Uint8Array(t.data)));a&&n.onSei&&n.onSei(a),i.enqueue(t)}});t.readable.pipeThrough(i).pipeTo(t.writable)}else if($R()){if("undefined"==typeof RTCRtpScriptTransform)return void ok.warning("browser not support RTCRtpScriptTransform");const t=nO(),i=new MessageChannel;await new rh((e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)}));const a=new RTCRtpScriptTransform(t,{name:"sei-rx",port:i.port2},[i.port2]);e.transform=a,await new rh((e=>t.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(ok.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.sei&&n.onSei&&n.onSei(t.data.sei)},n.worker=t}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}!function(e){const t=BO.get(e);if(t){BO.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){ok.warning(e&&e.message)}}}(e)}BO.set(e,n),e.track.addEventListener("ended",r)}},MK={name:"InterceptFrame",create:()=>DK};vA(),RA("PROCESS_ID","process-".concat(xN(8,""),"-").concat(xN(4,""),"-").concat(xN(4,""),"-").concat(xN(4,""),"-").concat(xN(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void ok.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();ok.debug("Loading global parameters from cache",t),Object.keys(t).forEach((e=>{if(Object.prototype.hasOwnProperty.call(TA,e)){const{value:r,expires:i}=t[e];if(i&&i<=n)return;AA[e]=r,TA[e]=r}}))}catch(t){ok.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(AA.AREAS)&&AA.AREAS.length>0&&pU(AA.AREAS,!0);const LK=(e,t,n)=>{ok.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),RA(e,t,n)};XF(ZY,!1),XF(aq,!1),XF(mz,!1),XF(Pq,!1),XF(XY,!1),XF(EK,!1),XF(kK,!1),XF(MK,!1);const OK=function(e){const t=new GI,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===Tj.SECURITY_POLICY_VIOLATION&&mW(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return hW(hW({},n),r)}({__TRACK_LIST__:Ok,VERSION:yA,BUILD:CA,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:LK,getParameter:IA,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(e){let t;return vk().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new mk(II.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=pk.reportApiInvoke(null,{name:qI.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:KI.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r),t&&wI()&&aI(75)&&(new e).close()}catch(e){return ok.error("check system requirement failed: ",e),!1}let n=!1;const r=qR();r.name===WR.CHROME&&Number(r.version)>=58&&("WebKit"!==HR.engine.name||function(){const e=qR();if(JR()){if(e.os===zR.MAC_OS)return!0;if(e.os===zR.IOS){const e=HR.os.version&&HR.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),(r.name===WR.FIREFOX&&Number(r.version)>=56||r.name===WR.OPERA&&Number(r.version)>=45||r.name===WR.SAFARI&&Number(r.version)>=11||"WebKit"===r.name&&(rI()||yI())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||bI()||qR().name===WR.QQ)&&(n=!0),ok.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return DD.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return DD.getRecordingDevices(e)},getCameras:function(e){return DD.getCamerasDevices(e)},getElectronScreenSources:CD,getPlaybackDevices:function(e){return DD.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=xN(5,"client-"),r=pk.reportApiInvoke(null,{id:n,name:qI.CREATE_CLIENT,options:[t],tag:KI.TRACER});try{!function(e){kI(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),kI(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&kI(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&LI(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&$I(e.turnServer),void 0!==e.httpRetryConfig&&XI(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&XI(e.websocketRetryConfig)}(t)}catch(e){throw r.onError(e),e}return(dI(16,0,!0)||fI(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",ok.debug("browser not support vp9, force use vp8")),RA("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),r.onSuccess(),new oW(aW(aW({forceWaitGatewayResponse:!0},t),{},{role:Lr(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=IA("CAMERA_CAPTURE_CONFIG"),n=xN(8,"track-cam-"),r=pk.reportApiInvoke(null,{id:n,tag:KI.TRACER,name:qI.CREATE_CAM_VIDEO_TRACK,options:[uD({},e),t]});t&&(e.encoderConfig=t);const i=qD(e);let a=null;ok.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{a=(await ID({video:i},n)).getVideoTracks()[0]||null}catch(e){throw r.onError(e),e}if(!a){const e=new NI(II.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(e),e.throw(ok)}if(e.optimizationMode&&PL(n,a,e,Ak(e.encoderConfig)),IA("USE_STANDARD_BITRATE_DEFAULT")){const t=Ak(e.encoderConfig);e.encoderConfig=t,delete t.bitrateMax,delete t.bitrateMin}const o=new OL(a,e,i,e.scalabiltyMode?Dk(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(o.getTrackId()),ok.info("create camera video success, trackId:",n),o},createCustomVideoTrack:function(e){const t=xN(8,"track-cus-"),n=pk.reportApiInvoke(null,{id:t,tag:KI.TRACER,name:qI.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});IA("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const r=new LL(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Dk(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Fk.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),ok.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n="object"==typeof t?function(e){return KD(e)}(t):void 0;n&&(t="auto");const r=xN(8,"track-scr-v-"),i=pk.reportApiInvoke(null,{id:r,tag:KI.TRACER,name:qI.CREATE_SCREEN_VIDEO_TRACK,options:[uD({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const a=function(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&ZR()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:a,preferCurrentTab:o}=e;(iI(107)||sI(107)||hI(93))&&(n&&(kI(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(kI(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(kI(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(iI(105)||sI(105)||hI(91))&&a&&(kI(a,"systemAudio",["exclude","include"]),t.systemAudio=a),(iI(94)||sI(94)||hI(80))&&o&&(t.preferCurrentTab=!0),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const s=e.encoderConfig?kk(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:s?s.width:void 0,maxHeight:s?s.height:void 0},s&&(s.frameRate&&("number"==typeof s.frameRate?(t.mandatory.maxFrameRate=s.frameRate,t.mandatory.minFrameRate=s.frameRate):(t.mandatory.maxFrameRate=s.frameRate.max||s.frameRate.ideal||s.frameRate.exact||void 0,t.mandatory.minFrameRate=s.frameRate.min||s.frameRate.ideal||s.frameRate.exact||void 0),t.frameRate=s.frameRate),s.width&&(t.width=s.width),s.height&&(t.height=s.height)),t}(e);let o=null,s=null;const c=vk();if(!c.supportShareAudio&&"enable"===t){const e=new NI(II.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(e),e.throw(ok)}ok.info("start create screen video track with config",e,"withAudio",t,"trackId",r);const u=c.supportShareAudio&&"disable"!==t;try{const e=await ID({screen:a,screenAudio:u?n||!0:void 0},r);o=e.getVideoTracks()[0]||null,s=e.getAudioTracks()[0]||null}catch(e){throw i.onError(e),e}if(!o){const e=new NI(II.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(e),e.throw(ok)}if(!s&&"enable"===t){o&&o.stop();const e=new NI(II.SHARE_AUDIO_NOT_ALLOWED);return i.onError(e),e.throw(ok)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(PL(r,o,e,e.encoderConfig&&kk(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const l=new LL(o,e.encoderConfig?kk(e.encoderConfig):{},e.scalabiltyMode?Dk(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[Fk.SCREEN_TRACK]);if(!s)return i.onSuccess(l.getTrackId()),ok.info("create screen video track success","video:",l.getTrackId()),l;const d=new BM(s,void 0,xN(8,"track-scr-a-"),!1);return i.onSuccess([l.getTrackId(),d.getTrackId()]),ok.info("create screen video track success","video:",l.getTrackId(),"audio:",d.getTrackId()),[l,d]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=IA("CAMERA_CAPTURE_CONFIG"),r=xN(8,"track-mic-"),i=xN(8,"track-cam-"),a=pk.reportApiInvoke(null,{id:"".concat(r,"-").concat(i),tag:KI.TRACER,name:qI.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const o=qD(t),s=XD(e);let c=null,u=null;ok.info("start create camera video track(".concat(i,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await ID({audio:s,video:o},"".concat(r,"-").concat(i));c=e.getAudioTracks()[0],u=e.getVideoTracks()[0]}catch(e){throw a.onError(e),e}if(!c||!u){const e=new NI(II.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(e),e.throw(ok)}if(t.optimizationMode&&PL(i,u,t,Ak(t.encoderConfig)),IA("USE_STANDARD_BITRATE_DEFAULT")){const e=Ak(t.encoderConfig);t.encoderConfig=e,delete e.bitrateMax,delete e.bitrateMin}const l=new VM(c,e,s,r),d=new OL(u,t,o,t.scalabiltyMode?Dk(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return a.onSuccess([l.getTrackId(),d.getTrackId()]),ok.info("create camera video track(".concat(i,") and microphone audio track(").concat(r,") success")),[l,d]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=xN(8,"track-mic-"),n=pk.reportApiInvoke(null,{id:t,tag:KI.TRACER,name:qI.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=XD(e);let i=null;ok.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await ID({audio:r},t)).getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!i){const e=new NI(II.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(ok)}const a=new VM(i,e,r,t);return n.onSuccess(a.getTrackId()),ok.info("create microphone audio track success, trackId:",t),a},createCustomAudioTrack:function(e){const t=xN(8,"track-cus-"),n=pk.reportApiInvoke(null,{id:t,tag:KI.TRACER,name:qI.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new BM(e.mediaStreamTrack,e.encoderConfig?Lk(e.encoderConfig):{},t,!1);return ok.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const a={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":i,cacheOnlineFile:n,encoderConfig:r},o=xN(8,"track-buf-"),s=pk.reportApiInvoke(null,{id:o,tag:KI.TRACER,name:qI.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(IA("DISABLE_WEBAUDIO"))throw new NI(II.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");ok.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",o);const c=i;if(!(i instanceof AudioBuffer))try{i=await async function(e,t){let n=null;if("string"==typeof e){const t=HM.get(e);if(t)return ok.debug("use cached audio resource: ",e),t;try{n=(await zN((()=>PR.get(e,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new NI(II.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new rh(((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new NI(II.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new NI(II.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)}));n=await t}const r=await function(e){const t=mD();return new rh(((n,r)=>{t.decodeAudioData(e,(e=>{n(e)}),(e=>{r(new NI(II.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(n);return"string"==typeof e&&t&&HM.set(e,r),r}(i,n)}catch(e){return s.onError(e),e.throw(ok)}const u=new GM(i),l=new zM(c,u,r?Lk(r):{},o);return ok.info("create buffer source audio track success, trackId:",o),s.onSuccess(l.getTrackId()),l},setAppType:function(e){if(ok.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw ok.debug("Invalid appType"),new mk(II.INVALID_PARAMS,"invalid app type",e);RA("APP_TYPE",Math.floor(e))},setLogLevel:function(e){ok.setLogLevel(e)},enableLogUpload:function(){IA("USE_NEW_LOG")?RA("UPLOAD_LOG",!0):ok.enableLogUpload()},disableLogUpload:function(){IA("USE_NEW_LOG")?RA("UPLOAD_LOG",!1):ok.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new QU},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=pk.reportApiInvoke(null,{tag:KI.TRACER,name:qI.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof BM||e instanceof JL)){const e=new mk(II.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof BM?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let a=i,o=i;const s=Date.now();return new rh((i=>{const c=setInterval((()=>{const u=e.getVolumeLevel();a=u>a?u:a,o=u<o?u:o;const l=a-o>1e-4,d=Date.now()-s;if(l||d>t){clearInterval(c);const t=l,o={duration:d,deviceLabel:r,maxVolumeLevel:a,result:t};ok.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(o))),n.onSuccess(o),i(t)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=pk.reportApiInvoke(null,{tag:KI.TRACER,name:qI.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof LL||e instanceof QL)){const e=new mk(II.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof LL?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,($R()||JR())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([i]),a.play();const o=document.createElement("canvas");o.width=160,o.height=120;let s=0,c=0;try{const e=Date.now();s=await function(e,t,n,r){let i,a=0,o=null;return new rh(((s,c)=>{function u(){a>r&&i&&(i(),s(a));const t=n.getContext("2d");if(!t){const e=new mk(II.UNEXPECTED_ERROR,"can not get canvas 2d context.");return ok.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const u=t.getImageData(0,0,n.width,n.height),l=Math.floor(u.data.length/3);if(o){for(let e=0;e<l;e+=3)if(u.data[e]!==o[e])return a+=1,void(o=u.data);o=u.data}else o=u.data}setTimeout((()=>{i&&(i(),s(a))}),t),i=yD((()=>{u()}),30)}))}(a,t,o,4),c=Date.now()-e}catch(e){throw n.onError(e),e}fV===WR.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;const u=s>4,l={duration:c,changedPicNum:s,deviceLabel:r,result:u};return ok.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l))),n.onSuccess(l),u},setArea:pU,audioElementPlayCenter:FD,resumeAudioContext:function(){FD.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){dW.processExternalMediaAEC(e)},registerExtensions:function(e){const t=IA("PLUGIN_INFO")||[];e.forEach((e=>{"name"in e&&!Lr(t).call(t,e.name)&&t.push(e.name);const n=e;n.__registered__=!0,n.logger.hookLog=ok.extLog,n.reporter.hookApiInvoke=pk.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach((e=>{n.parameters[e]=IA(e)}))})),LK("PLUGIN_INFO",t)},ChannelMediaRelayError:nj,ChannelMediaRelayEvent:ej,ChannelMediaRelayState:tj,RemoteStreamFallbackType:Vk,RemoteStreamType:Bk,ConnectionDisconnectedReason:JI,AudienceLatencyLevelType:QI,AREAS:sj,preload:async function(e,t,n,r){return TV(e,t,n,r)}});return Object.defineProperties(OK,{onAudioAutoplayFailed:{get:()=>LD.onAudioAutoplayFailed,set:e=>{LD.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>LD.onAutoplayFailed,set:e=>{LD.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>OK._onSecurityPolicyViolation,set(e){OK._onSecurityPolicyViolation=e,mW(e)}},__CLIENT_LIST__:{get:()=>IA("SHOW_GLOBAL_CLIENT_LIST")?WO:[]}}),DD.on(tD.CAMERA_DEVICE_CHANGED,(e=>{ok.info("camera device changed",JSON.stringify(e)),OK.onCameraChanged&&OK.onCameraChanged(e),OK.safeEmit(Tj.CAMERA_CHANGED,e)})),DD.on(tD.RECORDING_DEVICE_CHANGED,(e=>{ok.info("microphone device changed",JSON.stringify(e)),OK.onMicrophoneChanged&&OK.onMicrophoneChanged(e),OK.safeEmit(Tj.MICROPHONE_CHANGED,e)})),DD.on(tD.PLAYOUT_DEVICE_CHANGED,(e=>{ok.debug("playout device changed",JSON.stringify(e)),OK.onPlaybackDeviceChanged&&OK.onPlaybackDeviceChanged(e),OK.safeEmit(Tj.PLAYBACK_DEVICE_CHANGED,e)})),FD.onAutoplayFailed=()=>{ok.info("detect audio element autoplay failed"),LD.onAudioAutoplayFailed&&LD.onAudioAutoplayFailed()},pD.on("autoplay-failed",(()=>{ok.info("detect webaudio autoplay failed"),LD.onAudioAutoplayFailed&&LD.onAudioAutoplayFailed(),OK.safeEmit(Tj.AUTOPLAY_FAILED)})),pD.on(Ek.STATE_CHANGE,((e,t)=>{ok.info("audio context state changed: ".concat(t," => ").concat(e)),OK.onAudioContextStateChanged&&OK.onAudioContextStateChanged(e,t),OK.safeEmit(Tj.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),uN.on(iN.NETWORK_STATE_CHANGE,((e,t)=>{ok.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=OK),OK}()},1747:function(e,t,n){var r,i;e.exports=(r=n(6178),i=n(5043),function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){e.exports=n(3)()},function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t,n){"use strict";var r=n(4);function i(){}function a(){}a.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,a,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:i};return n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){var r,i,a,o,s;o=this,s=function(e){var t=!1,n=!1,r=!1,i=!1,a="escape years months weeks days hours minutes seconds milliseconds general".split(" "),o=[{type:"seconds",targets:[{type:"minutes",value:60},{type:"hours",value:3600},{type:"days",value:86400},{type:"weeks",value:604800},{type:"months",value:2678400},{type:"years",value:31536e3}]},{type:"minutes",targets:[{type:"hours",value:60},{type:"days",value:1440},{type:"weeks",value:10080},{type:"months",value:44640},{type:"years",value:525600}]},{type:"hours",targets:[{type:"days",value:24},{type:"weeks",value:168},{type:"months",value:744},{type:"years",value:8760}]},{type:"days",targets:[{type:"weeks",value:7},{type:"months",value:31},{type:"years",value:365}]},{type:"months",targets:[{type:"years",value:12}]}];function s(e,t){return!(t.length>e.length)&&-1!==e.indexOf(t)}function c(e){for(var t="";e;)t+="0",e-=1;return t}function u(e,t){var n=e+"+"+y(T(t).sort(),(function(e){return e+":"+t[e]})).join(",");return u.cache[n]||(u.cache[n]=Intl.NumberFormat(e,t)),u.cache[n]}function l(e,t,a){var o,s,d,f=t.useToLocaleString,h=t.useGrouping,p=h&&t.grouping.slice(),m=t.maximumSignificantDigits,g=t.minimumIntegerDigits||1,v=t.fractionDigits||0,y=t.groupingSeparator,b=t.decimalSeparator;if(f&&a){var _,w={minimumIntegerDigits:g,useGrouping:h};return v&&(w.maximumFractionDigits=v,w.minimumFractionDigits=v),m&&e>0&&(w.maximumSignificantDigits=m),r?(i||((_=x({},t)).useGrouping=!1,_.decimalSeparator=".",e=parseFloat(l(e,_),10)),u(a,w).format(e)):(n||((_=x({},t)).useGrouping=!1,_.decimalSeparator=".",e=parseFloat(l(e,_),10)),e.toLocaleString(a,w))}var E=(m?e.toPrecision(m+1):e.toFixed(v+1)).split("e");d=E[1]||"",s=(E=E[0].split("."))[1]||"";var S=(o=E[0]||"").length,C=s.length,T=S+C,R=o+s;(m&&T===m+1||!m&&C===v+1)&&((R=function(e){for(var t=e.split("").reverse(),n=0,r=!0;r&&n<t.length;)n?"9"===t[n]?t[n]="0":(t[n]=(parseInt(t[n],10)+1).toString(),r=!1):(parseInt(t[n],10)<5&&(r=!1),t[n]="0"),n+=1;return r&&t.push("1"),t.reverse().join("")}(R)).length===T+1&&(S+=1),C&&(R=R.slice(0,-1)),o=R.slice(0,S),s=R.slice(S)),m&&(s=s.replace(/0*$/,""));var I=parseInt(d,10);I>0?s.length<=I?(o+=s+=c(I-s.length),s=""):(o+=s.slice(0,I),s=s.slice(I)):I<0&&(s=c(Math.abs(I)-o.length)+o+s,o="0"),m||((s=s.slice(0,v)).length<v&&(s+=c(v-s.length)),o.length<g&&(o=c(g-o.length)+o));var N,A="";if(h)for(E=o;E.length;)p.length&&(N=p.shift()),A&&(A=y+A),A=E.slice(-N)+A,E=E.slice(0,-N);else A=o;return s&&(A=A+b+s),A}function d(e,t){return e.label.length>t.label.length?-1:e.label.length<t.label.length?1:0}function f(e,t){var n=[];return v(T(t),(function(r){if("_durationLabels"===r.slice(0,15)){var i=r.slice(15).toLowerCase();v(T(t[r]),(function(a){a.slice(0,1)===e&&n.push({type:i,key:a,label:t[r][a]})}))}})),n}u.cache={};var h={durationLabelsStandard:{S:"millisecond",SS:"milliseconds",s:"second",ss:"seconds",m:"minute",mm:"minutes",h:"hour",hh:"hours",d:"day",dd:"days",w:"week",ww:"weeks",M:"month",MM:"months",y:"year",yy:"years"},durationLabelsShort:{S:"msec",SS:"msecs",s:"sec",ss:"secs",m:"min",mm:"mins",h:"hr",hh:"hrs",d:"dy",dd:"dys",w:"wk",ww:"wks",M:"mo",MM:"mos",y:"yr",yy:"yrs"},durationTimeTemplates:{HMS:"h:mm:ss",HM:"h:mm",MS:"m:ss"},durationLabelTypes:[{type:"standard",string:"__"},{type:"short",string:"_"}],durationPluralKey:function(e,t,n){return 1===t&&null===n?e:e+e}};function p(e){return"[object Array]"===Object.prototype.toString.call(e)}function m(e){return"[object Object]"===Object.prototype.toString.call(e)}function g(e,t){var n,r=0,i=e&&e.length||0;for("function"!=typeof t&&(n=t,t=function(e){return e===n});r<i;){if(t(e[r]))return e[r];r+=1}}function v(e,t){var n=0,r=e.length;if(e&&r)for(;n<r;){if(!1===t(e[n],n))return;n+=1}}function y(e,t){var n=0,r=e.length,i=[];if(!e||!r)return i;for(;n<r;)i[n]=t(e[n],n),n+=1;return i}function b(e,t){return y(e,(function(e){return e[t]}))}function _(e){var t=[];return v(e,(function(e){e&&t.push(e)})),t}function w(e){var t=[];return v(e,(function(e){g(t,e)||t.push(e)})),t}function E(e,t){var n=[];return v(e,(function(e){v(t,(function(t){e===t&&n.push(e)}))})),w(n)}function S(e,t){var n=[];return v(e,(function(r,i){if(!t(r))return n=e.slice(i),!1})),n}function C(e,t){return S(e.slice().reverse(),t).reverse()}function x(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function T(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}function R(e,t){var n=0,r=e.length;if(!e||!r)return!1;for(;n<r;){if(!0===t(e[n],n))return!0;n+=1}return!1}function I(e){var t=[];return v(e,(function(e){t=t.concat(e)})),t}function N(e){return"3.6"===e(3.55,"en",{useGrouping:!1,minimumIntegerDigits:1,minimumFractionDigits:1,maximumFractionDigits:1})}function A(e){var t=!0;return!!((t=(t=(t=t&&"1"===e(1,"en",{minimumIntegerDigits:1}))&&"01"===e(1,"en",{minimumIntegerDigits:2}))&&"001"===e(1,"en",{minimumIntegerDigits:3}))&&(t=(t=(t=(t=t&&"100"===e(99.99,"en",{maximumFractionDigits:0,minimumFractionDigits:0}))&&"100.0"===e(99.99,"en",{maximumFractionDigits:1,minimumFractionDigits:1}))&&"99.99"===e(99.99,"en",{maximumFractionDigits:2,minimumFractionDigits:2}))&&"99.990"===e(99.99,"en",{maximumFractionDigits:3,minimumFractionDigits:3}))&&(t=(t=(t=(t=(t=t&&"100"===e(99.99,"en",{maximumSignificantDigits:1}))&&"100"===e(99.99,"en",{maximumSignificantDigits:2}))&&"100"===e(99.99,"en",{maximumSignificantDigits:3}))&&"99.99"===e(99.99,"en",{maximumSignificantDigits:4}))&&"99.99"===e(99.99,"en",{maximumSignificantDigits:5}))&&(t=(t=t&&"1,000"===e(1e3,"en",{useGrouping:!0}))&&"1000"===e(1e3,"en",{useGrouping:!1})))}function k(){var e,t=[].slice.call(arguments),n={};if(v(t,(function(t,r){if(!r){if(!p(t))throw"Expected array as the first argument to durationsFormat.";e=t}"string"!=typeof t&&"function"!=typeof t?"number"!=typeof t?m(t)&&x(n,t):n.precision=t:n.template=t})),!e||!e.length)return[];n.returnMomentTypes=!0;var r=y(e,(function(e){return e.format(n)})),i=E(a,w(b(I(r),"type"))),o=n.largest;return o&&(i=i.slice(0,o)),n.returnMomentTypes=!1,n.outputTypes=i,y(e,(function(e){return e.format(n)}))}function D(){var n=[].slice.call(arguments),i=x({},this.format.defaults),c=this.asMilliseconds(),u=this.asMonths();"function"==typeof this.isValid&&!1===this.isValid()&&(c=0,u=0);var I=c<0,N=e.duration(Math.abs(c),"milliseconds"),A=e.duration(Math.abs(u),"months");v(n,(function(e){"string"!=typeof e&&"function"!=typeof e?"number"!=typeof e?m(e)&&x(i,e):i.precision=e:i.template=e}));var k={years:"y",months:"M",weeks:"w",days:"d",hours:"h",minutes:"m",seconds:"s",milliseconds:"S"},D={escape:/\[(.+?)\]/,years:/\*?[Yy]+/,months:/\*?M+/,weeks:/\*?[Ww]+/,days:/\*?[Dd]+/,hours:/\*?[Hh]+/,minutes:/\*?m+/,seconds:/\*?s+/,milliseconds:/\*?S+/,general:/.+?/};i.types=a;var M=function(e){return g(a,(function(t){return D[t].test(e)}))},L=new RegExp(y(a,(function(e){return D[e].source})).join("|"),"g");i.duration=this;var O="function"==typeof i.template?i.template.apply(i):i.template,P=i.outputTypes,j=i.returnMomentTypes,F=i.largest,U=[];P||(p(i.stopTrim)&&(i.stopTrim=i.stopTrim.join("")),i.stopTrim&&v(i.stopTrim.match(L),(function(e){var t=M(e);"escape"!==t&&"general"!==t&&U.push(t)})));var B=e.localeData();B||(B={}),v(T(h),(function(e){"function"!=typeof h[e]?B["_"+e]||(B["_"+e]=h[e]):B[e]||(B[e]=h[e])})),v(T(B._durationTimeTemplates),(function(e){O=O.replace("_"+e+"_",B._durationTimeTemplates[e])}));var V=i.userLocale||e.locale(),z=i.useLeftUnits,W=i.usePlural,G=i.precision,H=i.forceLength,Y=i.useGrouping,q=i.trunc,K=i.useSignificantDigits&&G>0,X=K?i.precision:0,Q=X,J=i.minValue,Z=!1,$=i.maxValue,ee=!1,te=i.useToLocaleString,ne=i.groupingSeparator,re=i.decimalSeparator,ie=i.grouping;te=te&&(t||r);var ae=i.trim;p(ae)&&(ae=ae.join(" ")),null===ae&&(F||$||K)&&(ae="all"),null!==ae&&!0!==ae&&"left"!==ae&&"right"!==ae||(ae="large"),!1===ae&&(ae="");var oe=function(e){return e.test(ae)},se=/small/,ce=/both/,ue=/mid/,le=/^all|[^sm]all/,de=/final/,fe=F>0||R([/large/,ce,le],oe),he=R([se,ce,le],oe),pe=R([ue,le],oe),me=R([de,le],oe),ge=y(O.match(L),(function(e,t){var n=M(e);return"*"===e.slice(0,1)&&(e=e.slice(1),"escape"!==n&&"general"!==n&&U.push(n)),{index:t,length:e.length,text:"",token:"escape"===n?e.replace(D.escape,"$1"):e,type:"escape"===n||"general"===n?null:n}})),ve={index:0,length:0,token:"",text:"",type:null},ye=[];z&&ge.reverse(),v(ge,(function(e){if(e.type)return(ve.type||ve.text)&&ye.push(ve),void(ve=e);z?ve.text=e.token+ve.text:ve.text+=e.token})),(ve.type||ve.text)&&ye.push(ve),z&&ye.reverse();var be=E(a,w(_(b(ye,"type"))));if(!be.length)return b(ye,"text").join("");be=y(be,(function(e,t){var n,r=t+1===be.length,a=!t;n="years"===e||"months"===e?A.as(e):N.as(e);var o=Math.floor(n),s=n-o,c=g(ye,(function(t){return e===t.type}));return a&&$&&n>$&&(ee=!0),r&&J&&Math.abs(i.duration.as(e))<J&&(Z=!0),a&&null===H&&c.length>1&&(H=!0),N.subtract(o,e),A.subtract(o,e),{rawValue:n,wholeValue:o,decimalValue:r?s:0,isSmallest:r,isLargest:a,type:e,tokenLength:c.length}}));var _e=q?Math.floor:Math.round,we=function(e,t){var n=Math.pow(10,t);return _e(e*n)/n},Ee=!1,Se=!1,Ce=function(e,t){var n={useGrouping:Y,groupingSeparator:ne,decimalSeparator:re,grouping:ie,useToLocaleString:te};return K&&(X<=0?(e.rawValue=0,e.wholeValue=0,e.decimalValue=0):(n.maximumSignificantDigits=X,e.significantDigits=X)),ee&&!Se&&(e.isLargest?(e.wholeValue=$,e.decimalValue=0):(e.wholeValue=0,e.decimalValue=0)),Z&&!Se&&(e.isSmallest?(e.wholeValue=J,e.decimalValue=0):(e.wholeValue=0,e.decimalValue=0)),e.isSmallest||e.significantDigits&&e.significantDigits-e.wholeValue.toString().length<=0?G<0?e.value=we(e.wholeValue,G):0===G?e.value=_e(e.wholeValue+e.decimalValue):K?(e.value=q?we(e.rawValue,X-e.wholeValue.toString().length):e.rawValue,e.wholeValue&&(X-=e.wholeValue.toString().length)):(n.fractionDigits=G,e.value=q?e.wholeValue+we(e.decimalValue,G):e.wholeValue+e.decimalValue):K&&e.wholeValue?(e.value=Math.round(we(e.wholeValue,e.significantDigits-e.wholeValue.toString().length)),X-=e.wholeValue.toString().length):e.value=e.wholeValue,e.tokenLength>1&&(H||Ee)&&(n.minimumIntegerDigits=e.tokenLength,Se&&n.maximumSignificantDigits<e.tokenLength&&delete n.maximumSignificantDigits),!Ee&&(e.value>0||""===ae||g(U,e.type)||g(P,e.type))&&(Ee=!0),e.formattedValue=l(e.value,n,V),n.useGrouping=!1,n.decimalSeparator=".",e.formattedValueEn=l(e.value,n,"en"),2===e.tokenLength&&"milliseconds"===e.type&&(e.formattedValueMS=l(e.value,{minimumIntegerDigits:3,useGrouping:!1},"en").slice(0,2)),e};if((be=_(be=y(be,Ce))).length>1){var xe=function(e){return g(be,(function(t){return t.type===e}))},Te=function(e){var t=xe(e.type);t&&v(e.targets,(function(e){var n=xe(e.type);n&&parseInt(t.formattedValueEn,10)===e.value&&(t.rawValue=0,t.wholeValue=0,t.decimalValue=0,n.rawValue+=1,n.wholeValue+=1,n.decimalValue=0,n.formattedValueEn=n.wholeValue.toString(),Se=!0)}))};v(o,Te)}return Se&&(Ee=!1,X=Q,be=_(be=y(be,Ce))),!P||ee&&!i.trim?(fe&&(be=S(be,(function(e){return!e.isSmallest&&!e.wholeValue&&!g(U,e.type)}))),F&&be.length&&(be=be.slice(0,F)),he&&be.length>1&&(be=C(be,(function(e){return!e.wholeValue&&!g(U,e.type)&&!e.isLargest}))),pe&&(be=_(be=y(be,(function(e,t){return t>0&&t<be.length-1&&!e.wholeValue?null:e})))),!me||1!==be.length||be[0].wholeValue||!q&&be[0].isSmallest&&be[0].rawValue<J||(be=[])):be=_(be=y(be,(function(e){return g(P,(function(t){return e.type===t}))?e:null}))),j?be:(v(ye,(function(e){var t=k[e.type],n=g(be,(function(t){return t.type===e.type}));if(t&&n){var r=n.formattedValueEn.split(".");r[0]=parseInt(r[0],10),r[1]?r[1]=parseFloat("0."+r[1],10):r[1]=null;var i=B.durationPluralKey(t,r[0],r[1]),a=f(t,B),o=!1,c={};v(B._durationLabelTypes,(function(t){var n=g(a,(function(e){return e.type===t.type&&e.key===i}));n&&(c[n.type]=n.label,s(e.text,t.string)&&(e.text=e.text.replace(t.string,n.label),o=!0))})),W&&!o&&(a.sort(d),v(a,(function(t){return c[t.type]===t.label?!s(e.text,t.label)&&void 0:s(e.text,t.label)?(e.text=e.text.replace(t.label,c[t.type]),!1):void 0})))}})),(ye=y(ye,(function(e){if(!e.type)return e.text;var t=g(be,(function(t){return t.type===e.type}));if(!t)return"";var n="";return z&&(n+=e.text),(I&&ee||!I&&Z)&&(n+="< ",ee=!1,Z=!1),(I&&Z||!I&&ee)&&(n+="> ",ee=!1,Z=!1),I&&(t.value>0||""===ae||g(U,t.type)||g(P,t.type))&&(n+="-",I=!1),"milliseconds"===e.type&&t.formattedValueMS?n+=t.formattedValueMS:n+=t.formattedValue,z||(n+=e.text),n}))).join("").replace(/(,| |:|\.)*$/,"").replace(/^(,| |:|\.)*/,""))}function M(){var e=this.duration,t=function(t){return e._data[t]},n=g(this.types,t),r=function(e,t){for(var n=e.length;n-=1;)if(t(e[n]))return e[n]}(this.types,t);switch(n){case"milliseconds":return"S __";case"seconds":case"minutes":return"*_MS_";case"hours":return"_HMS_";case"days":if(n===r)return"d __";case"weeks":return n===r?"w __":(null===this.trim&&(this.trim="both"),"w __, d __, h __");case"months":if(n===r)return"M __";case"years":return n===r?"y __":(null===this.trim&&(this.trim="both"),"y __, M __, d __");default:return null===this.trim&&(this.trim="both"),"y __, d __, h __, m __, s __"}}function L(e){if(!e)throw"Moment Duration Format init cannot find moment instance.";e.duration.format=k,e.duration.fn.format=D,e.duration.fn.format.defaults={trim:null,stopTrim:null,largest:null,maxValue:null,minValue:null,precision:0,trunc:!1,forceLength:null,userLocale:null,usePlural:!0,useLeftUnits:!1,useGrouping:!0,useSignificantDigits:!1,template:M,useToLocaleString:!0,groupingSeparator:",",decimalSeparator:".",grouping:[3]},e.updateLocale("en",h)}var O=function(e,t,n){return e.toLocaleString(t,n)};t=function(){try{(0).toLocaleString("i")}catch(e){return"RangeError"===e.name}return!1}()&&A(O),n=t&&N(O);var P=function(e,t,n){if("undefined"!=typeof window&&window&&window.Intl&&window.Intl.NumberFormat)return window.Intl.NumberFormat(t,n).format(e)};return r=A(P),i=r&&N(P),L(e),L},i=[n(1)],void 0===(a="function"==typeof(r=s)?r.apply(t,i):r)||(e.exports=a),o&&(o.momentDurationFormatSetup=o.moment?s(o.moment):s)},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return C}));var r=n(2),i=n.n(r),a=n(0),o=n.n(a),s=n(1),c=n.n(s);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y(e);if(t){var i=y(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g(this,n)}}function g(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(5);var _=[o.a.string,o.a.number,o.a.array,o.a.object],w=[o.a.string,o.a.array],E=[o.a.object,o.a.bool],S=[o.a.string,o.a.bool],C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(n,e);var t=m(n);function n(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),b(v(r=t.call(this,e)),"setTimer",(function(){var e=r.props.interval;r.clearTimer(),n.pooledTimer||0===e||(r.timer=setInterval((function(){r.update(r.props)}),e))})),b(v(r),"getTitle",(function(){var e=r.props.titleFormat,t=n.getDatetime(r.props),i=e||n.globalFormat;return t.format(i)})),b(v(r),"clearTimer",(function(){!n.pooledTimer&&r.timer&&(clearInterval(r.timer),r.timer=null),n.pooledTimer&&!r.timer&&n.removePooledElement(v(r))})),n.globalMoment||(n.globalMoment=c.a),r.state={content:""},r.timer=null,r}return h(n,null,[{key:"startPooledTimer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e4;n.clearPooledTimer(),n.pooledTimer=setInterval((function(){n.pooledElements.forEach((function(e){0!==e.props.interval&&e.update()}))}),e)}},{key:"clearPooledTimer",value:function(){n.pooledTimer&&(clearInterval(n.pooledTimer),n.pooledTimer=null,n.pooledElements=[])}},{key:"pushPooledElement",value:function(e){e instanceof n?-1===n.pooledElements.indexOf(e)&&n.pooledElements.push(e):console.error("Element not an instance of Moment.")}},{key:"removePooledElement",value:function(e){var t=n.pooledElements.indexOf(e);-1!==t&&n.pooledElements.splice(t,1)}},{key:"getDatetime",value:function(e){var t=e.utc,r=e.unix,i=e.date,a=e.locale,o=e.parse,s=e.tz,c=e.local;i=i||e.children,o=o||n.globalParse,c=c||n.globalLocal,s=s||n.globalTimezone,a=n.globalLocale?n.globalLocale:a||n.globalMoment.locale();var u=null;return u=t?n.globalMoment.utc(i,o,a):r?n.globalMoment(1e3*i,o,a):n.globalMoment(i,o,a),s?u=u.tz(s):c&&(u=u.local()),u}},{key:"getContent",value:function(e){var t=e.fromNow,r=e.fromNowDuring,i=e.from,a=e.add,o=e.subtract,s=e.toNow,u=e.to,l=e.ago,d=e.calendar,f=e.diff,h=e.duration,p=e.durationFromNow,m=e.unit,g=e.decimal,v=e.trim,y=e.format;y=y||n.globalFormat;var b=n.getDatetime(e);a&&b.add(a),o&&b.subtract(o);var _=Boolean(r)&&-b.diff(c()())<r,w="";return w=!y||_||p||h?i?b.from(i,l):t||_?b.fromNow(l):u?b.to(u,l):s?b.toNow(l):d?b.calendar(null,d):f?b.diff(f,m,g):h?b.diff(h):p?c()().diff(b):b.toString():b.format(y),(h||p)&&(w=(w=c.a.duration(w)).format(y,{trim:v})),(n.globalFilter||e.filter)(w)}}]),h(n,[{key:"componentDidMount",value:function(){this.setTimer(),n.pooledTimer&&n.pushPooledElement(this)}},{key:"componentDidUpdate",value:function(e){var t=this.props.interval;e.interval!==t&&this.setTimer()}},{key:"componentWillUnmount",value:function(){this.clearTimer()}},{key:"update",value:function(e){var t=e||this.props,r=t.onChange,i=n.getContent(t);this.setState({content:i},(function(){r(i)}))}},{key:"render",value:function(){var e,t,r,a,o=this.props,s=o.withTitle,c=o.element,u=d(o,["withTitle","element"]),f=this.state.content,h=(e=u,t=n.propTypes,r=Object.keys(t),a=Object.assign({},e),Object.keys(a).filter((function(e){return-1!==r.indexOf(e)})).forEach((function(e){return delete a[e]})),a);return s&&(h.title=this.getTitle()),i.a.createElement(c||n.globalElement,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({dateTime:n.getDatetime(this.props)},h),f)}}],[{key:"getDerivedStateFromProps",value:function(e){return{content:n.getContent(e)}}}]),n}(i.a.Component);b(C,"propTypes",{element:o.a.any,date:o.a.oneOfType(_),parse:o.a.oneOfType(w),format:o.a.string,add:o.a.object,subtract:o.a.object,ago:o.a.bool,fromNow:o.a.bool,fromNowDuring:o.a.number,from:o.a.oneOfType(_),toNow:o.a.bool,to:o.a.oneOfType(_),calendar:o.a.oneOfType(E),unix:o.a.bool,utc:o.a.bool,local:o.a.bool,tz:o.a.string,withTitle:o.a.bool,titleFormat:o.a.string,locale:o.a.string,interval:o.a.number,diff:o.a.oneOfType(_),duration:o.a.oneOfType(_),durationFromNow:o.a.bool,trim:o.a.oneOfType(S),unit:o.a.string,decimal:o.a.bool,filter:o.a.func,onChange:o.a.func}),b(C,"defaultProps",{element:null,fromNow:!1,toNow:!1,calendar:!1,ago:!1,unix:!1,utc:!1,local:!1,unit:null,withTitle:!1,trim:!1,decimal:!1,titleFormat:"",interval:6e4,filter:function(e){return e},onChange:function(){}}),b(C,"globalMoment",null),b(C,"globalLocale",null),b(C,"globalLocal",null),b(C,"globalFormat",null),b(C,"globalParse",null),b(C,"globalFilter",null),b(C,"globalElement","time"),b(C,"globalTimezone",null),b(C,"pooledElements",[]),b(C,"pooledTimer",null)}]))},1774:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){o=[]},t.log=function(){0},t.handleBlur=u,t.handleFocus=l,t.markForFocusLater=function(){o.push(document.activeElement)},t.returnFocus=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=null;try{return void(0!==o.length&&(t=o.pop()).focus({preventScroll:e}))}catch(n){console.warn(["You tried to return focus to",t,"but it is not in the DOM anymore"].join(" "))}},t.popWithoutFocus=function(){o.length>0&&o.pop()},t.setupScopedFocus=function(e){s=e,window.addEventListener?(window.addEventListener("blur",u,!1),document.addEventListener("focus",l,!0)):(window.attachEvent("onBlur",u),document.attachEvent("onFocus",l))},t.teardownScopedFocus=function(){s=null,window.addEventListener?(window.removeEventListener("blur",u),document.removeEventListener("focus",l)):(window.detachEvent("onBlur",u),document.detachEvent("onFocus",l))};var r,i=n(4682),a=(r=i)&&r.__esModule?r:{default:r};var o=[],s=null,c=!1;function u(){c=!0}function l(){if(c){if(c=!1,!s)return;setTimeout((function(){s.contains(document.activeElement)||((0,a.default)(s)[0]||s).focus()}),0)}}},1794:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>rt});var r=n(2284);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}var o=n(364),s=n(4375),c=n(888);function u(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}var l=n(8435),d=n(8539),f=n(2058),h=n(6191),p=n(8726);function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function b(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(b=function(){return!!e})()}function _(e){var t=b();return function(){var n,i=y(e);if(t){var a=y(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"==(0,r.A)(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}(this,n)}}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var E=n(816);function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(0,E.A)(r.key),r)}}function C(e,t,n){return t&&S(e.prototype,t),n&&S(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var x=n(4467),T=function(){function e(){w(this,e),(0,x.A)(this,"priority",void 0),(0,x.A)(this,"subPriority",0)}return C(e,[{key:"validate",value:function(e,t){return!0}}]),e}(),R=function(e){v(n,e);var t=_(n);function n(e,r,i,a,o){var s;return w(this,n),(s=t.call(this)).value=e,s.validateValue=r,s.setValue=i,s.priority=a,o&&(s.subPriority=o),s}return C(n,[{key:"validate",value:function(e,t){return this.validateValue(e,this.value,t)}},{key:"set",value:function(e,t,n){return this.setValue(e,t,this.value,n)}}]),n}(T),I=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",10),(0,x.A)(m(e),"subPriority",-1),e}return C(n,[{key:"set",value:function(e,t){if(t.timestampIsSet)return e;var n=new Date(0);return n.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),n.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),n}}]),n}(T),N=function(){function e(){w(this,e),(0,x.A)(this,"incompatibleTokens",void 0),(0,x.A)(this,"priority",void 0),(0,x.A)(this,"subPriority",void 0)}return C(e,[{key:"run",value:function(e,t,n,r){var i=this.parse(e,t,n,r);return i?{setter:new R(i.value,this.validate,this.set,this.priority,this.subPriority),rest:i.rest}:null}},{key:"validate",value:function(e,t,n){return!0}}]),e}(),A=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",140),(0,x.A)(m(e),"incompatibleTokens",["R","u","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"G":case"GG":case"GGG":return n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"});case"GGGGG":return n.era(e,{width:"narrow"});default:return n.era(e,{width:"wide"})||n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"})}}},{key:"set",value:function(e,t,n){return t.era=n,e.setUTCFullYear(n,0,1),e.setUTCHours(0,0,0,0),e}}]),n}(N),k=n(5126),D=/^(1[0-2]|0?\d)/,M=/^(3[0-1]|[0-2]?\d)/,L=/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,O=/^(5[0-3]|[0-4]?\d)/,P=/^(2[0-3]|[0-1]?\d)/,j=/^(2[0-4]|[0-1]?\d)/,F=/^(1[0-1]|0?\d)/,U=/^(1[0-2]|0?\d)/,B=/^[0-5]?\d/,V=/^[0-5]?\d/,z=/^\d/,W=/^\d{1,2}/,G=/^\d{1,3}/,H=/^\d{1,4}/,Y=/^-?\d+/,q=/^-?\d/,K=/^-?\d{1,2}/,X=/^-?\d{1,3}/,Q=/^-?\d{1,4}/,J=/^([+-])(\d{2})(\d{2})?|Z/,Z=/^([+-])(\d{2})(\d{2})|Z/,$=/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,ee=/^([+-])(\d{2}):(\d{2})|Z/,te=/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/;function ne(e,t){return e?{value:t(e.value),rest:e.rest}:e}function re(e,t){var n=t.match(e);return n?{value:parseInt(n[0],10),rest:t.slice(n[0].length)}:null}function ie(e,t){var n=t.match(e);if(!n)return null;if("Z"===n[0])return{value:0,rest:t.slice(1)};var r="+"===n[1]?1:-1,i=n[2]?parseInt(n[2],10):0,a=n[3]?parseInt(n[3],10):0,o=n[5]?parseInt(n[5],10):0;return{value:r*(i*k.s0+a*k.Cg+o*k._m),rest:t.slice(n[0].length)}}function ae(e){return re(Y,e)}function oe(e,t){switch(e){case 1:return re(z,t);case 2:return re(W,t);case 3:return re(G,t);case 4:return re(H,t);default:return re(new RegExp("^\\d{1,"+e+"}"),t)}}function se(e,t){switch(e){case 1:return re(q,t);case 2:return re(K,t);case 3:return re(X,t);case 4:return re(Q,t);default:return re(new RegExp("^-?\\d{1,"+e+"}"),t)}}function ce(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;default:return 0}}function ue(e,t){var n,r=t>0,i=r?t:1-t;if(i<=50)n=e||100;else{var a=i+50;n=e+100*Math.floor(a/100)-(e>=a%100?100:0)}return r?n:1-n}function le(e){return e%400===0||e%4===0&&e%100!==0}var de=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",130),(0,x.A)(m(e),"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){var r=function(e){return{year:e,isTwoDigitYear:"yy"===t}};switch(t){case"y":return ne(oe(4,e),r);case"yo":return ne(n.ordinalNumber(e,{unit:"year"}),r);default:return ne(oe(t.length,e),r)}}},{key:"validate",value:function(e,t){return t.isTwoDigitYear||t.year>0}},{key:"set",value:function(e,t,n){var r=e.getUTCFullYear();if(n.isTwoDigitYear){var i=ue(n.year,r);return e.setUTCFullYear(i,0,1),e.setUTCHours(0,0,0,0),e}var a="era"in t&&1!==t.era?1-n.year:n.year;return e.setUTCFullYear(a,0,1),e.setUTCHours(0,0,0,0),e}}]),n}(N),fe=n(2637),he=n(7451),pe=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",130),(0,x.A)(m(e),"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){var r=function(e){return{year:e,isTwoDigitYear:"YY"===t}};switch(t){case"Y":return ne(oe(4,e),r);case"Yo":return ne(n.ordinalNumber(e,{unit:"year"}),r);default:return ne(oe(t.length,e),r)}}},{key:"validate",value:function(e,t){return t.isTwoDigitYear||t.year>0}},{key:"set",value:function(e,t,n,r){var i=(0,fe.A)(e,r);if(n.isTwoDigitYear){var a=ue(n.year,i);return e.setUTCFullYear(a,0,r.firstWeekContainsDate),e.setUTCHours(0,0,0,0),(0,he.A)(e,r)}var o="era"in t&&1!==t.era?1-n.year:n.year;return e.setUTCFullYear(o,0,r.firstWeekContainsDate),e.setUTCHours(0,0,0,0),(0,he.A)(e,r)}}]),n}(N),me=n(4960),ge=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",130),(0,x.A)(m(e),"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t){return se("R"===t?4:t.length,e)}},{key:"set",value:function(e,t,n){var r=new Date(0);return r.setUTCFullYear(n,0,4),r.setUTCHours(0,0,0,0),(0,me.A)(r)}}]),n}(N),ve=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",130),(0,x.A)(m(e),"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t){return se("u"===t?4:t.length,e)}},{key:"set",value:function(e,t,n){return e.setUTCFullYear(n,0,1),e.setUTCHours(0,0,0,0),e}}]),n}(N),ye=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",120),(0,x.A)(m(e),"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"Q":case"QQ":return oe(t.length,e);case"Qo":return n.ordinalNumber(e,{unit:"quarter"});case"QQQ":return n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(e,{width:"narrow",context:"formatting"});default:return n.quarter(e,{width:"wide",context:"formatting"})||n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=1&&t<=4}},{key:"set",value:function(e,t,n){return e.setUTCMonth(3*(n-1),1),e.setUTCHours(0,0,0,0),e}}]),n}(N),be=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",120),(0,x.A)(m(e),"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"q":case"qq":return oe(t.length,e);case"qo":return n.ordinalNumber(e,{unit:"quarter"});case"qqq":return n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(e,{width:"narrow",context:"standalone"});default:return n.quarter(e,{width:"wide",context:"standalone"})||n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(e,t){return t>=1&&t<=4}},{key:"set",value:function(e,t,n){return e.setUTCMonth(3*(n-1),1),e.setUTCHours(0,0,0,0),e}}]),n}(N),_e=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]),(0,x.A)(m(e),"priority",110),e}return C(n,[{key:"parse",value:function(e,t,n){var r=function(e){return e-1};switch(t){case"M":return ne(re(D,e),r);case"MM":return ne(oe(2,e),r);case"Mo":return ne(n.ordinalNumber(e,{unit:"month"}),r);case"MMM":return n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(e,{width:"narrow",context:"formatting"});default:return n.month(e,{width:"wide",context:"formatting"})||n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=11}},{key:"set",value:function(e,t,n){return e.setUTCMonth(n,1),e.setUTCHours(0,0,0,0),e}}]),n}(N),we=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",110),(0,x.A)(m(e),"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){var r=function(e){return e-1};switch(t){case"L":return ne(re(D,e),r);case"LL":return ne(oe(2,e),r);case"Lo":return ne(n.ordinalNumber(e,{unit:"month"}),r);case"LLL":return n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(e,{width:"narrow",context:"standalone"});default:return n.month(e,{width:"wide",context:"standalone"})||n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=11}},{key:"set",value:function(e,t,n){return e.setUTCMonth(n,1),e.setUTCHours(0,0,0,0),e}}]),n}(N),Ee=n(1209);var Se=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",100),(0,x.A)(m(e),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"w":return re(O,e);case"wo":return n.ordinalNumber(e,{unit:"week"});default:return oe(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=53}},{key:"set",value:function(e,t,n,r){return(0,he.A)(function(e,t,n){(0,p.A)(2,arguments);var r=(0,c.default)(e),i=(0,h.A)(t),a=(0,Ee.A)(r,n)-i;return r.setUTCDate(r.getUTCDate()-7*a),r}(e,n,r),r)}}]),n}(N),Ce=n(7532);var xe=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",100),(0,x.A)(m(e),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"I":return re(O,e);case"Io":return n.ordinalNumber(e,{unit:"week"});default:return oe(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=53}},{key:"set",value:function(e,t,n){return(0,me.A)(function(e,t){(0,p.A)(2,arguments);var n=(0,c.default)(e),r=(0,h.A)(t),i=(0,Ce.A)(n)-r;return n.setUTCDate(n.getUTCDate()-7*i),n}(e,n))}}]),n}(N),Te=[31,28,31,30,31,30,31,31,30,31,30,31],Re=[31,29,31,30,31,30,31,31,30,31,30,31],Ie=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",90),(0,x.A)(m(e),"subPriority",1),(0,x.A)(m(e),"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"d":return re(M,e);case"do":return n.ordinalNumber(e,{unit:"date"});default:return oe(t.length,e)}}},{key:"validate",value:function(e,t){var n=le(e.getUTCFullYear()),r=e.getUTCMonth();return n?t>=1&&t<=Re[r]:t>=1&&t<=Te[r]}},{key:"set",value:function(e,t,n){return e.setUTCDate(n),e.setUTCHours(0,0,0,0),e}}]),n}(N),Ne=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",90),(0,x.A)(m(e),"subpriority",1),(0,x.A)(m(e),"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"D":case"DD":return re(L,e);case"Do":return n.ordinalNumber(e,{unit:"date"});default:return oe(t.length,e)}}},{key:"validate",value:function(e,t){return le(e.getUTCFullYear())?t>=1&&t<=366:t>=1&&t<=365}},{key:"set",value:function(e,t,n){return e.setUTCMonth(0,n),e.setUTCHours(0,0,0,0),e}}]),n}(N),Ae=n(8171);function ke(e,t,n){var r,i,a,o,s,u,l,d;(0,p.A)(2,arguments);var f=(0,Ae.q)(),m=(0,h.A)(null!==(r=null!==(i=null!==(a=null!==(o=null===n||void 0===n?void 0:n.weekStartsOn)&&void 0!==o?o:null===n||void 0===n||null===(s=n.locale)||void 0===s||null===(u=s.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==a?a:f.weekStartsOn)&&void 0!==i?i:null===(l=f.locale)||void 0===l||null===(d=l.options)||void 0===d?void 0:d.weekStartsOn)&&void 0!==r?r:0);if(!(m>=0&&m<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=(0,c.default)(e),v=(0,h.A)(t),y=((v%7+7)%7<m?7:0)+v-g.getUTCDay();return g.setUTCDate(g.getUTCDate()+y),g}var De=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",90),(0,x.A)(m(e),"incompatibleTokens",["D","i","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"E":case"EE":case"EEE":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=6}},{key:"set",value:function(e,t,n,r){return(e=ke(e,n,r)).setUTCHours(0,0,0,0),e}}]),n}(N),Me=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",90),(0,x.A)(m(e),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n,r){var i=function(e){var t=7*Math.floor((e-1)/7);return(e+r.weekStartsOn+6)%7+t};switch(t){case"e":case"ee":return ne(oe(t.length,e),i);case"eo":return ne(n.ordinalNumber(e,{unit:"day"}),i);case"eee":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeeee":return n.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=6}},{key:"set",value:function(e,t,n,r){return(e=ke(e,n,r)).setUTCHours(0,0,0,0),e}}]),n}(N),Le=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",90),(0,x.A)(m(e),"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n,r){var i=function(e){var t=7*Math.floor((e-1)/7);return(e+r.weekStartsOn+6)%7+t};switch(t){case"c":case"cc":return ne(oe(t.length,e),i);case"co":return ne(n.ordinalNumber(e,{unit:"day"}),i);case"ccc":return n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"ccccc":return n.day(e,{width:"narrow",context:"standalone"});case"cccccc":return n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});default:return n.day(e,{width:"wide",context:"standalone"})||n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"})}}},{key:"validate",value:function(e,t){return t>=0&&t<=6}},{key:"set",value:function(e,t,n,r){return(e=ke(e,n,r)).setUTCHours(0,0,0,0),e}}]),n}(N);var Oe=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",90),(0,x.A)(m(e),"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){var r=function(e){return 0===e?7:e};switch(t){case"i":case"ii":return oe(t.length,e);case"io":return n.ordinalNumber(e,{unit:"day"});case"iii":return ne(n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),r);case"iiiii":return ne(n.day(e,{width:"narrow",context:"formatting"}),r);case"iiiiii":return ne(n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),r);default:return ne(n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),r)}}},{key:"validate",value:function(e,t){return t>=1&&t<=7}},{key:"set",value:function(e,t,n){return e=function(e,t){(0,p.A)(2,arguments);var n=(0,h.A)(t);n%7===0&&(n-=7);var r=(0,c.default)(e),i=((n%7+7)%7<1?7:0)+n-r.getUTCDay();return r.setUTCDate(r.getUTCDate()+i),r}(e,n),e.setUTCHours(0,0,0,0),e}}]),n}(N),Pe=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",80),(0,x.A)(m(e),"incompatibleTokens",["b","B","H","k","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(e,{width:"narrow",context:"formatting"});default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(e,t,n){return e.setUTCHours(ce(n),0,0,0),e}}]),n}(N),je=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",80),(0,x.A)(m(e),"incompatibleTokens",["a","B","H","k","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"b":case"bb":case"bbb":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(e,{width:"narrow",context:"formatting"});default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(e,t,n){return e.setUTCHours(ce(n),0,0,0),e}}]),n}(N),Fe=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",80),(0,x.A)(m(e),"incompatibleTokens",["a","b","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"B":case"BB":case"BBB":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(e,{width:"narrow",context:"formatting"});default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}},{key:"set",value:function(e,t,n){return e.setUTCHours(ce(n),0,0,0),e}}]),n}(N),Ue=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",70),(0,x.A)(m(e),"incompatibleTokens",["H","K","k","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"h":return re(U,e);case"ho":return n.ordinalNumber(e,{unit:"hour"});default:return oe(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=12}},{key:"set",value:function(e,t,n){var r=e.getUTCHours()>=12;return r&&n<12?e.setUTCHours(n+12,0,0,0):r||12!==n?e.setUTCHours(n,0,0,0):e.setUTCHours(0,0,0,0),e}}]),n}(N),Be=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",70),(0,x.A)(m(e),"incompatibleTokens",["a","b","h","K","k","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"H":return re(P,e);case"Ho":return n.ordinalNumber(e,{unit:"hour"});default:return oe(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=23}},{key:"set",value:function(e,t,n){return e.setUTCHours(n,0,0,0),e}}]),n}(N),Ve=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",70),(0,x.A)(m(e),"incompatibleTokens",["h","H","k","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"K":return re(F,e);case"Ko":return n.ordinalNumber(e,{unit:"hour"});default:return oe(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=11}},{key:"set",value:function(e,t,n){return e.getUTCHours()>=12&&n<12?e.setUTCHours(n+12,0,0,0):e.setUTCHours(n,0,0,0),e}}]),n}(N),ze=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",70),(0,x.A)(m(e),"incompatibleTokens",["a","b","h","H","K","t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"k":return re(j,e);case"ko":return n.ordinalNumber(e,{unit:"hour"});default:return oe(t.length,e)}}},{key:"validate",value:function(e,t){return t>=1&&t<=24}},{key:"set",value:function(e,t,n){var r=n<=24?n%24:n;return e.setUTCHours(r,0,0,0),e}}]),n}(N),We=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",60),(0,x.A)(m(e),"incompatibleTokens",["t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"m":return re(B,e);case"mo":return n.ordinalNumber(e,{unit:"minute"});default:return oe(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=59}},{key:"set",value:function(e,t,n){return e.setUTCMinutes(n,0,0),e}}]),n}(N),Ge=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",50),(0,x.A)(m(e),"incompatibleTokens",["t","T"]),e}return C(n,[{key:"parse",value:function(e,t,n){switch(t){case"s":return re(V,e);case"so":return n.ordinalNumber(e,{unit:"second"});default:return oe(t.length,e)}}},{key:"validate",value:function(e,t){return t>=0&&t<=59}},{key:"set",value:function(e,t,n){return e.setUTCSeconds(n,0),e}}]),n}(N),He=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",30),(0,x.A)(m(e),"incompatibleTokens",["t","T"]),e}return C(n,[{key:"parse",value:function(e,t){return ne(oe(t.length,e),(function(e){return Math.floor(e*Math.pow(10,3-t.length))}))}},{key:"set",value:function(e,t,n){return e.setUTCMilliseconds(n),e}}]),n}(N),Ye=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",10),(0,x.A)(m(e),"incompatibleTokens",["t","T","x"]),e}return C(n,[{key:"parse",value:function(e,t){switch(t){case"X":return ie(J,e);case"XX":return ie(Z,e);case"XXXX":return ie($,e);case"XXXXX":return ie(te,e);default:return ie(ee,e)}}},{key:"set",value:function(e,t,n){return t.timestampIsSet?e:new Date(e.getTime()-n)}}]),n}(N),qe=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",10),(0,x.A)(m(e),"incompatibleTokens",["t","T","X"]),e}return C(n,[{key:"parse",value:function(e,t){switch(t){case"x":return ie(J,e);case"xx":return ie(Z,e);case"xxxx":return ie($,e);case"xxxxx":return ie(te,e);default:return ie(ee,e)}}},{key:"set",value:function(e,t,n){return t.timestampIsSet?e:new Date(e.getTime()-n)}}]),n}(N),Ke=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",40),(0,x.A)(m(e),"incompatibleTokens","*"),e}return C(n,[{key:"parse",value:function(e){return ae(e)}},{key:"set",value:function(e,t,n){return[new Date(1e3*n),{timestampIsSet:!0}]}}]),n}(N),Xe=function(e){v(n,e);var t=_(n);function n(){var e;w(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,x.A)(m(e),"priority",20),(0,x.A)(m(e),"incompatibleTokens","*"),e}return C(n,[{key:"parse",value:function(e){return ae(e)}},{key:"set",value:function(e,t,n){return[new Date(n),{timestampIsSet:!0}]}}]),n}(N),Qe={G:new A,y:new de,Y:new pe,R:new ge,u:new ve,Q:new ye,q:new be,M:new _e,L:new we,w:new Se,I:new xe,d:new Ie,D:new Ne,E:new De,e:new Me,c:new Le,i:new Oe,a:new Pe,b:new je,B:new Fe,h:new Ue,H:new Be,K:new Ve,k:new ze,m:new We,s:new Ge,S:new He,X:new Ye,x:new qe,t:new Ke,T:new Xe},Je=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ze=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,$e=/^'([^]*?)'?$/,et=/''/g,tt=/\S/,nt=/[a-zA-Z]/;function rt(e,t,n,i){var m,g,v,y,b,_,w,E,S,C,x,T,R,N,A,k,D,M;(0,p.A)(3,arguments);var L=String(e),O=String(t),P=(0,Ae.q)(),j=null!==(m=null!==(g=null===i||void 0===i?void 0:i.locale)&&void 0!==g?g:P.locale)&&void 0!==m?m:o.A;if(!j.match)throw new RangeError("locale must contain match property");var F=(0,h.A)(null!==(v=null!==(y=null!==(b=null!==(_=null===i||void 0===i?void 0:i.firstWeekContainsDate)&&void 0!==_?_:null===i||void 0===i||null===(w=i.locale)||void 0===w||null===(E=w.options)||void 0===E?void 0:E.firstWeekContainsDate)&&void 0!==b?b:P.firstWeekContainsDate)&&void 0!==y?y:null===(S=P.locale)||void 0===S||null===(C=S.options)||void 0===C?void 0:C.firstWeekContainsDate)&&void 0!==v?v:1);if(!(F>=1&&F<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var U=(0,h.A)(null!==(x=null!==(T=null!==(R=null!==(N=null===i||void 0===i?void 0:i.weekStartsOn)&&void 0!==N?N:null===i||void 0===i||null===(A=i.locale)||void 0===A||null===(k=A.options)||void 0===k?void 0:k.weekStartsOn)&&void 0!==R?R:P.weekStartsOn)&&void 0!==T?T:null===(D=P.locale)||void 0===D||null===(M=D.options)||void 0===M?void 0:M.weekStartsOn)&&void 0!==x?x:0);if(!(U>=0&&U<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(""===O)return""===L?(0,c.default)(n):new Date(NaN);var B,V={firstWeekContainsDate:F,weekStartsOn:U,locale:j},z=[new I],W=O.match(Ze).map((function(e){var t=e[0];return t in l.A?(0,l.A[t])(e,j.formatLong):e})).join("").match(Je),G=[],H=a(W);try{var Y=function(){var t=B.value;null!==i&&void 0!==i&&i.useAdditionalWeekYearTokens||!(0,f.xM)(t)||(0,f.lJ)(t,O,e),null!==i&&void 0!==i&&i.useAdditionalDayOfYearTokens||!(0,f.ef)(t)||(0,f.lJ)(t,O,e);var n=t[0],r=Qe[n];if(r){var a=r.incompatibleTokens;if(Array.isArray(a)){var o=G.find((function(e){return a.includes(e.token)||e.token===n}));if(o)throw new RangeError("The format string mustn't contain `".concat(o.fullToken,"` and `").concat(t,"` at the same time"))}else if("*"===r.incompatibleTokens&&G.length>0)throw new RangeError("The format string mustn't contain `".concat(t,"` and any other token at the same time"));G.push({token:n,fullToken:t});var s=r.run(L,t,j.match,V);if(!s)return{v:new Date(NaN)};z.push(s.setter),L=s.rest}else{if(n.match(nt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+n+"`");if("''"===t?t="'":"'"===n&&(t=t.match($e)[1].replace(et,"'")),0!==L.indexOf(t))return{v:new Date(NaN)};L=L.slice(t.length)}};for(H.s();!(B=H.n()).done;){var q=Y();if("object"===(0,r.A)(q))return q.v}}catch(ne){H.e(ne)}finally{H.f()}if(L.length>0&&tt.test(L))return new Date(NaN);var K=z.map((function(e){return e.priority})).sort((function(e,t){return t-e})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return z.filter((function(t){return t.priority===e})).sort((function(e,t){return t.subPriority-e.subPriority}))})).map((function(e){return e[0]})),X=(0,c.default)(n);if(isNaN(X.getTime()))return new Date(NaN);var Q,J=(0,s.A)(X,(0,d.A)(X)),Z={},$=a(K);try{for($.s();!(Q=$.n()).done;){var ee=Q.value;if(!ee.validate(J,V))return new Date(NaN);var te=ee.set(J,Z,V);Array.isArray(te)?(J=te[0],u(Z,te[1])):J=te}}catch(ne){$.e(ne)}finally{$.f()}return J}},1806:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(6265),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,r.A)(t);return(0,i.default)(e,-n)}},1845:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){(0,i.A)(1,arguments);var t=(0,r.default)(e);return Math.floor(t.getMonth()/3)+1}},1899:function(e,t,n){!function(e,t,n,r,i,a,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w,E,S,C,x,T,R,I,N,A,k,D,M,L,O,P,j,F,U,B,V,z,W,G,H,Y,q,K,X,Q,J,Z,$,ee,te,ne,re,ie,ae,oe,se,ce,ue){"use strict";function le(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var de=le(t),fe=le(r),he=le(i),pe=le(a),me=le(o),ge=le(s),ve=le(c),ye=le(u),be=le(l),_e=le(d),we=le(f),Ee=le(h),Se=le(p),Ce=le(m),xe=le(g),Te=le(v),Re=le(y),Ie=le(b),Ne=le(_),Ae=le(w),ke=le(E),De=le(S),Me=le(C),Le=le(x),Oe=le(T),Pe=le(R),je=le(I),Fe=le(N),Ue=le(A),Be=le(k),Ve=le(D),ze=le(M),We=le(L),Ge=le(O),He=le(P),Ye=le(j),qe=le(F),Ke=le(U),Xe=le(B),Qe=le(V),Je=le(z),Ze=le(W),$e=le(G),et=le(H),tt=le(q),nt=le(K),rt=le(X),it=le(Q),at=le(J),ot=le(Z),st=le($),ct=le(ee),ut=le(te),lt=le(ne),dt=le(re),ft=le(ie),ht=le(ae),pt=le(oe),mt=le(se),gt=le(ue);function vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(n),!0).forEach((function(t){St(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function bt(e){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bt(e)}function _t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Dt(r.key),r)}}function Et(e,t,n){return t&&wt(e.prototype,t),n&&wt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function St(e,t,n){return(t=Dt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ct(){return Ct=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ct.apply(this,arguments)}function xt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rt(e,t)}function Tt(e){return Tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Tt(e)}function Rt(e,t){return Rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Rt(e,t)}function It(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Tt(e);if(t){var i=Tt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return It(e)}(this,n)}}function At(e){return function(e){if(Array.isArray(e))return kt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return kt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Dt(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var Mt=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Lt=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Ot={p:Lt,P:function(e,t){var n,r=e.match(/(P+)(p+)?/)||[],i=r[1],a=r[2];if(!a)return Mt(e,t);switch(i){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",Mt(i,t)).replace("{{time}}",Lt(a,t))}},Pt=12,jt=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;function Ft(e){var t=e?"string"==typeof e||e instanceof String?ht.default(e):dt.default(e):new Date;return Ut(t)?t:null}function Ut(e,t){return t=t||new Date("1/1/1000"),pe.default(e)&&!ut.default(e,t)}function Bt(e,t,n){if("en"===n)return me.default(e,t,{awareOfUnicodeTokens:!0});var r=tn(n);return n&&!r&&console.warn('A locale object was not found for the provided string ["'.concat(n,'"].')),!r&&en()&&tn(en())&&(r=tn(en())),me.default(e,t,{locale:r||null,awareOfUnicodeTokens:!0})}function Vt(e,t){var n=t.dateFormat,r=t.locale;return e&&Bt(e,Array.isArray(n)?n[0]:n,r)||""}function zt(e,t){var n=t.hour,r=void 0===n?0:n,i=t.minute,a=void 0===i?0:i,o=t.second,s=void 0===o?0:o;return Be.default(Ue.default(Fe.default(e,s),a),r)}function Wt(e,t,n){var r=tn(t||en());return Qe.default(e,{locale:r,weekStartsOn:n})}function Gt(e){return Je.default(e)}function Ht(e){return $e.default(e)}function Yt(e){return Ze.default(e)}function qt(){return Xe.default(Ft())}function Kt(e,t){return e&&t?ot.default(e,t):!e&&!t}function Xt(e,t){return e&&t?at.default(e,t):!e&&!t}function Qt(e,t){return e&&t?st.default(e,t):!e&&!t}function Jt(e,t){return e&&t?it.default(e,t):!e&&!t}function Zt(e,t){return e&&t?rt.default(e,t):!e&&!t}function $t(e,t,n){var r,i=Xe.default(t),a=et.default(n);try{r=lt.default(e,{start:i,end:a})}catch(e){r=!1}return r}function en(){return("undefined"!=typeof window?window:globalThis).__localeId__}function tn(e){if("string"==typeof e){var t="undefined"!=typeof window?window:globalThis;return t.__localeData__?t.__localeData__[e]:null}return e}function nn(e,t){return Bt(Ve.default(Ft(),e),"LLLL",t)}function rn(e,t){return Bt(Ve.default(Ft(),e),"LLL",t)}function an(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,r=t.maxDate,i=t.excludeDates,a=t.excludeDateIntervals,o=t.includeDates,s=t.includeDateIntervals,c=t.filterDate;return hn(e,{minDate:n,maxDate:r})||i&&i.some((function(t){return Jt(e,t)}))||a&&a.some((function(t){var n=t.start,r=t.end;return lt.default(e,{start:n,end:r})}))||o&&!o.some((function(t){return Jt(e,t)}))||s&&!s.some((function(t){var n=t.start,r=t.end;return lt.default(e,{start:n,end:r})}))||c&&!c(Ft(e))||!1}function on(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.excludeDates,r=t.excludeDateIntervals;return r&&r.length>0?r.some((function(t){var n=t.start,r=t.end;return lt.default(e,{start:n,end:r})})):n&&n.some((function(t){return Jt(e,t)}))||!1}function sn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,r=t.maxDate,i=t.excludeDates,a=t.includeDates,o=t.filterDate;return hn(e,{minDate:Je.default(n),maxDate:tt.default(r)})||i&&i.some((function(t){return Xt(e,t)}))||a&&!a.some((function(t){return Xt(e,t)}))||o&&!o(Ft(e))||!1}function cn(e,t,n,r){var i=Pe.default(e),a=Le.default(e),o=Pe.default(t),s=Le.default(t),c=Pe.default(r);return i===o&&i===c?a<=n&&n<=s:i<o?c===i&&a<=n||c===o&&s>=n||c<o&&c>i:void 0}function un(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,r=t.maxDate,i=t.excludeDates,a=t.includeDates,o=t.filterDate;return hn(e,{minDate:n,maxDate:r})||i&&i.some((function(t){return Qt(e,t)}))||a&&!a.some((function(t){return Qt(e,t)}))||o&&!o(Ft(e))||!1}function ln(e,t,n){if(!pe.default(t)||!pe.default(n))return!1;var r=Pe.default(t),i=Pe.default(n);return r<=e&&i>=e}function dn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,r=t.maxDate,i=t.excludeDates,a=t.includeDates,o=t.filterDate,s=new Date(e,0,1);return hn(s,{minDate:$e.default(n),maxDate:nt.default(r)})||i&&i.some((function(e){return Kt(s,e)}))||a&&!a.some((function(e){return Kt(s,e)}))||o&&!o(Ft(s))||!1}function fn(e,t,n,r){var i=Pe.default(e),a=Oe.default(e),o=Pe.default(t),s=Oe.default(t),c=Pe.default(r);return i===o&&i===c?a<=n&&n<=s:i<o?c===i&&a<=n||c===o&&s>=n||c<o&&c>i:void 0}function hn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,r=t.maxDate;return n&&Ye.default(e,n)<0||r&&Ye.default(e,r)>0}function pn(e,t){return t.some((function(t){return Ae.default(t)===Ae.default(e)&&Ne.default(t)===Ne.default(e)}))}function mn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.excludeTimes,r=t.includeTimes,i=t.filterTime;return n&&pn(e,n)||r&&!pn(e,r)||i&&!i(e)||!1}function gn(e,t){var n=t.minTime,r=t.maxTime;if(!n||!r)throw new Error("Both minTime and maxTime props required");var i,a=Ft(),o=Be.default(Ue.default(a,Ne.default(e)),Ae.default(e)),s=Be.default(Ue.default(a,Ne.default(n)),Ae.default(n)),c=Be.default(Ue.default(a,Ne.default(r)),Ae.default(r));try{i=!lt.default(o,{start:s,end:c})}catch(e){i=!1}return i}function vn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,r=t.includeDates,i=xe.default(e,1);return n&&qe.default(n,i)>0||r&&r.every((function(e){return qe.default(e,i)>0}))||!1}function yn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.maxDate,r=t.includeDates,i=_e.default(e,1);return n&&qe.default(i,n)>0||r&&r.every((function(e){return qe.default(i,e)>0}))||!1}function bn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,r=t.includeDates,i=Re.default(e,1);return n&&Ke.default(n,i)>0||r&&r.every((function(e){return Ke.default(e,i)>0}))||!1}function _n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.maxDate,r=t.includeDates,i=Ee.default(e,1);return n&&Ke.default(i,n)>0||r&&r.every((function(e){return Ke.default(i,e)>0}))||!1}function wn(e){var t=e.minDate,n=e.includeDates;if(n&&t){var r=n.filter((function(e){return Ye.default(e,t)>=0}));return Ge.default(r)}return n?Ge.default(n):t}function En(e){var t=e.maxDate,n=e.includeDates;if(n&&t){var r=n.filter((function(e){return Ye.default(e,t)<=0}));return He.default(r)}return n?He.default(n):t}function Sn(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react-datepicker__day--highlighted",n=new Map,r=0,i=e.length;r<i;r++){var a=e[r];if(he.default(a)){var o=Bt(a,"MM.dd.yyyy"),s=n.get(o)||[];s.includes(t)||(s.push(t),n.set(o,s))}else if("object"===bt(a)){var c=Object.keys(a),u=c[0],l=a[c[0]];if("string"==typeof u&&l.constructor===Array)for(var d=0,f=l.length;d<f;d++){var h=Bt(l[d],"MM.dd.yyyy"),p=n.get(h)||[];p.includes(u)||(p.push(u),n.set(h,p))}}}return n}function Cn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"react-datepicker__day--holidays",n=new Map;return e.forEach((function(e){var r=e.date,i=e.holidayName;if(he.default(r)){var a=Bt(r,"MM.dd.yyyy"),o=n.get(a)||{};if(!("className"in o)||o.className!==t||(s=o.holidayNames,c=[i],s.length!==c.length||!s.every((function(e,t){return e===c[t]})))){var s,c;o.className=t;var u=o.holidayNames;o.holidayNames=u?[].concat(At(u),[i]):[i],n.set(a,o)}}})),n}function xn(e,t,n,r,i){for(var a=i.length,o=[],s=0;s<a;s++){var c=ge.default(ve.default(e,Ae.default(i[s])),Ne.default(i[s])),u=ge.default(e,(n+1)*r);ct.default(c,t)&&ut.default(c,u)&&o.push(i[s])}return o}function Tn(e){return e<10?"0".concat(e):"".concat(e)}function Rn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pt,n=Math.ceil(Pe.default(e)/t)*t;return{startPeriod:n-(t-1),endPeriod:n}}function In(e){var t=e.getSeconds(),n=e.getMilliseconds();return dt.default(e.getTime()-1e3*t-n)}function Nn(e,t,n,r){for(var i=[],a=0;a<2*t+1;a++){var o=e+t-a,s=!0;n&&(s=Pe.default(n)<=o),r&&s&&(s=Pe.default(r)>=o),s&&i.push(o)}return i}var An=function(e){xt(r,e);var n=Nt(r);function r(e){var i;_t(this,r),St(It(i=n.call(this,e)),"renderOptions",(function(){var e=i.props.year,t=i.state.yearsList.map((function(t){return de.default.createElement("div",{className:e===t?"react-datepicker__year-option react-datepicker__year-option--selected_year":"react-datepicker__year-option",key:t,onClick:i.onChange.bind(It(i),t),"aria-selected":e===t?"true":void 0},e===t?de.default.createElement("span",{className:"react-datepicker__year-option--selected"},"\u2713"):"",t)})),n=i.props.minDate?Pe.default(i.props.minDate):null,r=i.props.maxDate?Pe.default(i.props.maxDate):null;return r&&i.state.yearsList.find((function(e){return e===r}))||t.unshift(de.default.createElement("div",{className:"react-datepicker__year-option",key:"upcoming",onClick:i.incrementYears},de.default.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-upcoming"}))),n&&i.state.yearsList.find((function(e){return e===n}))||t.push(de.default.createElement("div",{className:"react-datepicker__year-option",key:"previous",onClick:i.decrementYears},de.default.createElement("a",{className:"react-datepicker__navigation react-datepicker__navigation--years react-datepicker__navigation--years-previous"}))),t})),St(It(i),"onChange",(function(e){i.props.onChange(e)})),St(It(i),"handleClickOutside",(function(){i.props.onCancel()})),St(It(i),"shiftYears",(function(e){var t=i.state.yearsList.map((function(t){return t+e}));i.setState({yearsList:t})})),St(It(i),"incrementYears",(function(){return i.shiftYears(1)})),St(It(i),"decrementYears",(function(){return i.shiftYears(-1)}));var a=e.yearDropdownItemNumber,o=e.scrollableYearDropdown,s=a||(o?10:5);return i.state={yearsList:Nn(i.props.year,s,i.props.minDate,i.props.maxDate)},i.dropdownRef=t.createRef(),i}return Et(r,[{key:"componentDidMount",value:function(){var e=this.dropdownRef.current;if(e){var t=e.children?Array.from(e.children):null,n=t?t.find((function(e){return e.ariaSelected})):null;e.scrollTop=n?n.offsetTop+(n.clientHeight-e.clientHeight)/2:(e.scrollHeight-e.clientHeight)/2}}},{key:"render",value:function(){var e=fe.default({"react-datepicker__year-dropdown":!0,"react-datepicker__year-dropdown--scrollable":this.props.scrollableYearDropdown});return de.default.createElement("div",{className:e,ref:this.dropdownRef},this.renderOptions())}}]),r}(de.default.Component),kn=pt.default(An),Dn=function(e){xt(n,e);var t=Nt(n);function n(){var e;_t(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return St(It(e=t.call.apply(t,[this].concat(i))),"state",{dropdownVisible:!1}),St(It(e),"renderSelectOptions",(function(){for(var t=e.props.minDate?Pe.default(e.props.minDate):1900,n=e.props.maxDate?Pe.default(e.props.maxDate):2100,r=[],i=t;i<=n;i++)r.push(de.default.createElement("option",{key:i,value:i},i));return r})),St(It(e),"onSelectChange",(function(t){e.onChange(t.target.value)})),St(It(e),"renderSelectMode",(function(){return de.default.createElement("select",{value:e.props.year,className:"react-datepicker__year-select",onChange:e.onSelectChange},e.renderSelectOptions())})),St(It(e),"renderReadView",(function(t){return de.default.createElement("div",{key:"read",style:{visibility:t?"visible":"hidden"},className:"react-datepicker__year-read-view",onClick:function(t){return e.toggleDropdown(t)}},de.default.createElement("span",{className:"react-datepicker__year-read-view--down-arrow"}),de.default.createElement("span",{className:"react-datepicker__year-read-view--selected-year"},e.props.year))})),St(It(e),"renderDropdown",(function(){return de.default.createElement(kn,{key:"dropdown",year:e.props.year,onChange:e.onChange,onCancel:e.toggleDropdown,minDate:e.props.minDate,maxDate:e.props.maxDate,scrollableYearDropdown:e.props.scrollableYearDropdown,yearDropdownItemNumber:e.props.yearDropdownItemNumber})})),St(It(e),"renderScrollMode",(function(){var t=e.state.dropdownVisible,n=[e.renderReadView(!t)];return t&&n.unshift(e.renderDropdown()),n})),St(It(e),"onChange",(function(t){e.toggleDropdown(),t!==e.props.year&&e.props.onChange(t)})),St(It(e),"toggleDropdown",(function(t){e.setState({dropdownVisible:!e.state.dropdownVisible},(function(){e.props.adjustDateOnChange&&e.handleYearChange(e.props.date,t)}))})),St(It(e),"handleYearChange",(function(t,n){e.onSelect(t,n),e.setOpen()})),St(It(e),"onSelect",(function(t,n){e.props.onSelect&&e.props.onSelect(t,n)})),St(It(e),"setOpen",(function(){e.props.setOpen&&e.props.setOpen(!0)})),e}return Et(n,[{key:"render",value:function(){var e;switch(this.props.dropdownMode){case"scroll":e=this.renderScrollMode();break;case"select":e=this.renderSelectMode()}return de.default.createElement("div",{className:"react-datepicker__year-dropdown-container react-datepicker__year-dropdown-container--".concat(this.props.dropdownMode)},e)}}]),n}(de.default.Component),Mn=function(e){xt(n,e);var t=Nt(n);function n(){var e;_t(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return St(It(e=t.call.apply(t,[this].concat(i))),"isSelectedMonth",(function(t){return e.props.month===t})),St(It(e),"renderOptions",(function(){return e.props.monthNames.map((function(t,n){return de.default.createElement("div",{className:e.isSelectedMonth(n)?"react-datepicker__month-option react-datepicker__month-option--selected_month":"react-datepicker__month-option",key:t,onClick:e.onChange.bind(It(e),n),"aria-selected":e.isSelectedMonth(n)?"true":void 0},e.isSelectedMonth(n)?de.default.createElement("span",{className:"react-datepicker__month-option--selected"},"\u2713"):"",t)}))})),St(It(e),"onChange",(function(t){return e.props.onChange(t)})),St(It(e),"handleClickOutside",(function(){return e.props.onCancel()})),e}return Et(n,[{key:"render",value:function(){return de.default.createElement("div",{className:"react-datepicker__month-dropdown"},this.renderOptions())}}]),n}(de.default.Component),Ln=pt.default(Mn),On=function(e){xt(n,e);var t=Nt(n);function n(){var e;_t(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return St(It(e=t.call.apply(t,[this].concat(i))),"state",{dropdownVisible:!1}),St(It(e),"renderSelectOptions",(function(e){return e.map((function(e,t){return de.default.createElement("option",{key:t,value:t},e)}))})),St(It(e),"renderSelectMode",(function(t){return de.default.createElement("select",{value:e.props.month,className:"react-datepicker__month-select",onChange:function(t){return e.onChange(t.target.value)}},e.renderSelectOptions(t))})),St(It(e),"renderReadView",(function(t,n){return de.default.createElement("div",{key:"read",style:{visibility:t?"visible":"hidden"},className:"react-datepicker__month-read-view",onClick:e.toggleDropdown},de.default.createElement("span",{className:"react-datepicker__month-read-view--down-arrow"}),de.default.createElement("span",{className:"react-datepicker__month-read-view--selected-month"},n[e.props.month]))})),St(It(e),"renderDropdown",(function(t){return de.default.createElement(Ln,{key:"dropdown",month:e.props.month,monthNames:t,onChange:e.onChange,onCancel:e.toggleDropdown})})),St(It(e),"renderScrollMode",(function(t){var n=e.state.dropdownVisible,r=[e.renderReadView(!n,t)];return n&&r.unshift(e.renderDropdown(t)),r})),St(It(e),"onChange",(function(t){e.toggleDropdown(),t!==e.props.month&&e.props.onChange(t)})),St(It(e),"toggleDropdown",(function(){return e.setState({dropdownVisible:!e.state.dropdownVisible})})),e}return Et(n,[{key:"render",value:function(){var e,t=this,n=[0,1,2,3,4,5,6,7,8,9,10,11].map(this.props.useShortMonthInDropdown?function(e){return rn(e,t.props.locale)}:function(e){return nn(e,t.props.locale)});switch(this.props.dropdownMode){case"scroll":e=this.renderScrollMode(n);break;case"select":e=this.renderSelectMode(n)}return de.default.createElement("div",{className:"react-datepicker__month-dropdown-container react-datepicker__month-dropdown-container--".concat(this.props.dropdownMode)},e)}}]),n}(de.default.Component);function Pn(e,t){for(var n=[],r=Gt(e),i=Gt(t);!ct.default(r,i);)n.push(Ft(r)),r=_e.default(r,1);return n}var jn=function(e){xt(n,e);var t=Nt(n);function n(e){var r;return _t(this,n),St(It(r=t.call(this,e)),"renderOptions",(function(){return r.state.monthYearsList.map((function(e){var t=je.default(e),n=Kt(r.props.date,e)&&Xt(r.props.date,e);return de.default.createElement("div",{className:n?"react-datepicker__month-year-option--selected_month-year":"react-datepicker__month-year-option",key:t,onClick:r.onChange.bind(It(r),t),"aria-selected":n?"true":void 0},n?de.default.createElement("span",{className:"react-datepicker__month-year-option--selected"},"\u2713"):"",Bt(e,r.props.dateFormat,r.props.locale))}))})),St(It(r),"onChange",(function(e){return r.props.onChange(e)})),St(It(r),"handleClickOutside",(function(){r.props.onCancel()})),r.state={monthYearsList:Pn(r.props.minDate,r.props.maxDate)},r}return Et(n,[{key:"render",value:function(){var e=fe.default({"react-datepicker__month-year-dropdown":!0,"react-datepicker__month-year-dropdown--scrollable":this.props.scrollableMonthYearDropdown});return de.default.createElement("div",{className:e},this.renderOptions())}}]),n}(de.default.Component),Fn=pt.default(jn),Un=function(e){xt(n,e);var t=Nt(n);function n(){var e;_t(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return St(It(e=t.call.apply(t,[this].concat(i))),"state",{dropdownVisible:!1}),St(It(e),"renderSelectOptions",(function(){for(var t=Gt(e.props.minDate),n=Gt(e.props.maxDate),r=[];!ct.default(t,n);){var i=je.default(t);r.push(de.default.createElement("option",{key:i,value:i},Bt(t,e.props.dateFormat,e.props.locale))),t=_e.default(t,1)}return r})),St(It(e),"onSelectChange",(function(t){e.onChange(t.target.value)})),St(It(e),"renderSelectMode",(function(){return de.default.createElement("select",{value:je.default(Gt(e.props.date)),className:"react-datepicker__month-year-select",onChange:e.onSelectChange},e.renderSelectOptions())})),St(It(e),"renderReadView",(function(t){var n=Bt(e.props.date,e.props.dateFormat,e.props.locale);return de.default.createElement("div",{key:"read",style:{visibility:t?"visible":"hidden"},className:"react-datepicker__month-year-read-view",onClick:function(t){return e.toggleDropdown(t)}},de.default.createElement("span",{className:"react-datepicker__month-year-read-view--down-arrow"}),de.default.createElement("span",{className:"react-datepicker__month-year-read-view--selected-month-year"},n))})),St(It(e),"renderDropdown",(function(){return de.default.createElement(Fn,{key:"dropdown",date:e.props.date,dateFormat:e.props.dateFormat,onChange:e.onChange,onCancel:e.toggleDropdown,minDate:e.props.minDate,maxDate:e.props.maxDate,scrollableMonthYearDropdown:e.props.scrollableMonthYearDropdown,locale:e.props.locale})})),St(It(e),"renderScrollMode",(function(){var t=e.state.dropdownVisible,n=[e.renderReadView(!t)];return t&&n.unshift(e.renderDropdown()),n})),St(It(e),"onChange",(function(t){e.toggleDropdown();var n=Ft(parseInt(t));Kt(e.props.date,n)&&Xt(e.props.date,n)||e.props.onChange(n)})),St(It(e),"toggleDropdown",(function(){return e.setState({dropdownVisible:!e.state.dropdownVisible})})),e}return Et(n,[{key:"render",value:function(){var e;switch(this.props.dropdownMode){case"scroll":e=this.renderScrollMode();break;case"select":e=this.renderSelectMode()}return de.default.createElement("div",{className:"react-datepicker__month-year-dropdown-container react-datepicker__month-year-dropdown-container--".concat(this.props.dropdownMode)},e)}}]),n}(de.default.Component),Bn=function(e){xt(n,e);var t=Nt(n);function n(){var e;_t(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return St(It(e=t.call.apply(t,[this].concat(i))),"dayEl",de.default.createRef()),St(It(e),"handleClick",(function(t){!e.isDisabled()&&e.props.onClick&&e.props.onClick(t)})),St(It(e),"handleMouseEnter",(function(t){!e.isDisabled()&&e.props.onMouseEnter&&e.props.onMouseEnter(t)})),St(It(e),"handleOnKeyDown",(function(t){" "===t.key&&(t.preventDefault(),t.key="Enter"),e.props.handleOnKeyDown(t)})),St(It(e),"isSameDay",(function(t){return Jt(e.props.day,t)})),St(It(e),"isKeyboardSelected",(function(){return!e.props.disabledKeyboardNavigation&&!(e.isSameDay(e.props.selected)||e.isSameWeek(e.props.selected))&&(e.isSameDay(e.props.preSelection)||e.isSameWeek(e.props.preSelection))})),St(It(e),"isDisabled",(function(){return an(e.props.day,e.props)})),St(It(e),"isExcluded",(function(){return on(e.props.day,e.props)})),St(It(e),"isStartOfWeek",(function(){return Jt(e.props.day,Wt(e.props.day,e.props.locale,e.props.calendarStartDay))})),St(It(e),"isSameWeek",(function(t){return e.props.showWeekPicker&&Jt(t,Wt(e.props.day,e.props.locale,e.props.calendarStartDay))})),St(It(e),"getHighLightedClass",(function(){var t=e.props,n=t.day,r=t.highlightDates;if(!r)return!1;var i=Bt(n,"MM.dd.yyyy");return r.get(i)})),St(It(e),"getHolidaysClass",(function(){var t=e.props,n=t.day,r=t.holidays;if(!r)return!1;var i=Bt(n,"MM.dd.yyyy");return r.has(i)?[r.get(i).className]:void 0})),St(It(e),"isInRange",(function(){var t=e.props,n=t.day,r=t.startDate,i=t.endDate;return!(!r||!i)&&$t(n,r,i)})),St(It(e),"isInSelectingRange",(function(){var t,n=e.props,r=n.day,i=n.selectsStart,a=n.selectsEnd,o=n.selectsRange,s=n.selectsDisabledDaysInRange,c=n.startDate,u=n.endDate,l=null!==(t=e.props.selectingDate)&&void 0!==t?t:e.props.preSelection;return!(!(i||a||o)||!l||!s&&e.isDisabled())&&(i&&u&&(ut.default(l,u)||Zt(l,u))?$t(r,l,u):(a&&c&&(ct.default(l,c)||Zt(l,c))||!(!o||!c||u||!ct.default(l,c)&&!Zt(l,c)))&&$t(r,c,l))})),St(It(e),"isSelectingRangeStart",(function(){var t;if(!e.isInSelectingRange())return!1;var n=e.props,r=n.day,i=n.startDate,a=n.selectsStart,o=null!==(t=e.props.selectingDate)&&void 0!==t?t:e.props.preSelection;return Jt(r,a?o:i)})),St(It(e),"isSelectingRangeEnd",(function(){var t;if(!e.isInSelectingRange())return!1;var n=e.props,r=n.day,i=n.endDate,a=n.selectsEnd,o=n.selectsRange,s=null!==(t=e.props.selectingDate)&&void 0!==t?t:e.props.preSelection;return Jt(r,a||o?s:i)})),St(It(e),"isRangeStart",(function(){var t=e.props,n=t.day,r=t.startDate,i=t.endDate;return!(!r||!i)&&Jt(r,n)})),St(It(e),"isRangeEnd",(function(){var t=e.props,n=t.day,r=t.startDate,i=t.endDate;return!(!r||!i)&&Jt(i,n)})),St(It(e),"isWeekend",(function(){var t=ke.default(e.props.day);return 0===t||6===t})),St(It(e),"isAfterMonth",(function(){return void 0!==e.props.month&&(e.props.month+1)%12===Le.default(e.props.day)})),St(It(e),"isBeforeMonth",(function(){return void 0!==e.props.month&&(Le.default(e.props.day)+1)%12===e.props.month})),St(It(e),"isCurrentDay",(function(){return e.isSameDay(Ft())})),St(It(e),"isSelected",(function(){return e.isSameDay(e.props.selected)||e.isSameWeek(e.props.selected)})),St(It(e),"getClassNames",(function(t){var n,r=e.props.dayClassName?e.props.dayClassName(t):void 0;return fe.default("react-datepicker__day",r,"react-datepicker__day--"+Bt(e.props.day,"ddd",n),{"react-datepicker__day--disabled":e.isDisabled(),"react-datepicker__day--excluded":e.isExcluded(),"react-datepicker__day--selected":e.isSelected(),"react-datepicker__day--keyboard-selected":e.isKeyboardSelected(),"react-datepicker__day--range-start":e.isRangeStart(),"react-datepicker__day--range-end":e.isRangeEnd(),"react-datepicker__day--in-range":e.isInRange(),"react-datepicker__day--in-selecting-range":e.isInSelectingRange(),"react-datepicker__day--selecting-range-start":e.isSelectingRangeStart(),"react-datepicker__day--selecting-range-end":e.isSelectingRangeEnd(),"react-datepicker__day--today":e.isCurrentDay(),"react-datepicker__day--weekend":e.isWeekend(),"react-datepicker__day--outside-month":e.isAfterMonth()||e.isBeforeMonth()},e.getHighLightedClass("react-datepicker__day--highlighted"),e.getHolidaysClass())})),St(It(e),"getAriaLabel",(function(){var t=e.props,n=t.day,r=t.ariaLabelPrefixWhenEnabled,i=void 0===r?"Choose":r,a=t.ariaLabelPrefixWhenDisabled,o=void 0===a?"Not available":a,s=e.isDisabled()||e.isExcluded()?o:i;return"".concat(s," ").concat(Bt(n,"PPPP",e.props.locale))})),St(It(e),"getTitle",(function(){var t=e.props,n=t.day,r=t.holidays,i=void 0===r?new Map:r,a=Bt(n,"MM.dd.yyyy");return i.has(a)&&i.get(a).holidayNames.length>0?i.get(a).holidayNames.join(", "):""})),St(It(e),"getTabIndex",(function(t,n){var r=t||e.props.selected,i=n||e.props.preSelection;return(!e.props.showWeekPicker||!e.props.showWeekNumber&&e.isStartOfWeek())&&(e.isKeyboardSelected()||e.isSameDay(r)&&Jt(i,r))?0:-1})),St(It(e),"handleFocusDay",(function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=!1;0===e.getTabIndex()&&!n.isInputFocused&&e.isSameDay(e.props.preSelection)&&(document.activeElement&&document.activeElement!==document.body||(r=!0),e.props.inline&&!e.props.shouldFocusDayInline&&(r=!1),e.props.containerRef&&e.props.containerRef.current&&e.props.containerRef.current.contains(document.activeElement)&&document.activeElement.classList.contains("react-datepicker__day")&&(r=!0),e.props.monthShowsDuplicateDaysEnd&&e.isAfterMonth()&&(r=!1),e.props.monthShowsDuplicateDaysStart&&e.isBeforeMonth()&&(r=!1)),r&&(null===(t=e.dayEl.current)||void 0===t||t.focus({preventScroll:!0}))})),St(It(e),"renderDayContents",(function(){return e.props.monthShowsDuplicateDaysEnd&&e.isAfterMonth()||e.props.monthShowsDuplicateDaysStart&&e.isBeforeMonth()?null:e.props.renderDayContents?e.props.renderDayContents(De.default(e.props.day),e.props.day):De.default(e.props.day)})),St(It(e),"render",(function(){return de.default.createElement("div",{ref:e.dayEl,className:e.getClassNames(e.props.day),onKeyDown:e.handleOnKeyDown,onClick:e.handleClick,onMouseEnter:e.handleMouseEnter,tabIndex:e.getTabIndex(),"aria-label":e.getAriaLabel(),role:"option",title:e.getTitle(),"aria-disabled":e.isDisabled(),"aria-current":e.isCurrentDay()?"date":void 0,"aria-selected":e.isSelected()||e.isInRange()},e.renderDayContents(),""!==e.getTitle()&&de.default.createElement("span",{className:"holiday-overlay"},e.getTitle()))})),e}return Et(n,[{key:"componentDidMount",value:function(){this.handleFocusDay()}},{key:"componentDidUpdate",value:function(e){this.handleFocusDay(e)}}]),n}(de.default.Component),Vn=function(e){xt(n,e);var t=Nt(n);function n(){var e;_t(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return St(It(e=t.call.apply(t,[this].concat(i))),"weekNumberEl",de.default.createRef()),St(It(e),"handleClick",(function(t){e.props.onClick&&e.props.onClick(t)})),St(It(e),"handleOnKeyDown",(function(t){" "===t.key&&(t.preventDefault(),t.key="Enter"),e.props.handleOnKeyDown(t)})),St(It(e),"isKeyboardSelected",(function(){return!e.props.disabledKeyboardNavigation&&!Jt(e.props.date,e.props.selected)&&Jt(e.props.date,e.props.preSelection)})),St(It(e),"getTabIndex",(function(){return e.props.showWeekPicker&&e.props.showWeekNumber&&(e.isKeyboardSelected()||Jt(e.props.date,e.props.selected)&&Jt(e.props.preSelection,e.props.selected))?0:-1})),St(It(e),"handleFocusWeekNumber",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!1;0===e.getTabIndex()&&!t.isInputFocused&&Jt(e.props.date,e.props.preSelection)&&(document.activeElement&&document.activeElement!==document.body||(n=!0),e.props.inline&&!e.props.shouldFocusDayInline&&(n=!1),e.props.containerRef&&e.props.containerRef.current&&e.props.containerRef.current.contains(document.activeElement)&&document.activeElement&&document.activeElement.classList.contains("react-datepicker__week-number")&&(n=!0)),n&&e.weekNumberEl.current&&e.weekNumberEl.current.focus({preventScroll:!0})})),e}return Et(n,[{key:"componentDidMount",value:function(){this.handleFocusWeekNumber()}},{key:"componentDidUpdate",value:function(e){this.handleFocusWeekNumber(e)}},{key:"render",value:function(){var e=this.props,t=e.weekNumber,n=e.ariaLabelPrefix,r=void 0===n?"week ":n,i={"react-datepicker__week-number":!0,"react-datepicker__week-number--clickable":!!e.onClick,"react-datepicker__week-number--selected":Jt(this.props.date,this.props.selected),"react-datepicker__week-number--keyboard-selected":this.isKeyboardSelected()};return de.default.createElement("div",{ref:this.weekNumberEl,className:fe.default(i),"aria-label":"".concat(r," ").concat(this.props.weekNumber),onClick:this.handleClick,onKeyDown:this.handleOnKeyDown,tabIndex:this.getTabIndex()},t)}}],[{key:"defaultProps",get:function(){return{ariaLabelPrefix:"week "}}}]),n}(de.default.Component),zn=function(e){xt(n,e);var t=Nt(n);function n(){var e;_t(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return St(It(e=t.call.apply(t,[this].concat(i))),"handleDayClick",(function(t,n){e.props.onDayClick&&e.props.onDayClick(t,n)})),St(It(e),"handleDayMouseEnter",(function(t){e.props.onDayMouseEnter&&e.props.onDayMouseEnter(t)})),St(It(e),"handleWeekClick",(function(t,n,r){if("function"==typeof e.props.onWeekSelect&&e.props.onWeekSelect(t,n,r),e.props.showWeekPicker){var i=Wt(t,e.props.locale,e.props.calendarStartDay);e.handleDayClick(i,r)}e.props.shouldCloseOnSelect&&e.props.setOpen(!1)})),St(It(e),"formatWeekNumber",(function(t){return e.props.formatWeekNumber?e.props.formatWeekNumber(t):function(e,t){var n=t&&tn(t)||en()&&tn(en());return Me.default(e,n?{locale:n}:null)}(t)})),St(It(e),"renderDays",(function(){var t=Wt(e.props.day,e.props.locale,e.props.calendarStartDay),n=[],r=e.formatWeekNumber(t);if(e.props.showWeekNumber){var i=e.props.onWeekSelect||e.props.showWeekPicker?e.handleWeekClick.bind(It(e),t,r):void 0;n.push(de.default.createElement(Vn,{key:"W",weekNumber:r,date:t,onClick:i,selected:e.props.selected,preSelection:e.props.preSelection,ariaLabelPrefix:e.props.ariaLabelPrefix,showWeekPicker:e.props.showWeekPicker,showWeekNumber:e.props.showWeekNumber,disabledKeyboardNavigation:e.props.disabledKeyboardNavigation,handleOnKeyDown:e.props.handleOnKeyDown,isInputFocused:e.props.isInputFocused,containerRef:e.props.containerRef}))}return n.concat([0,1,2,3,4,5,6].map((function(n){var r=ye.default(t,n);return de.default.createElement(Bn,{ariaLabelPrefixWhenEnabled:e.props.chooseDayAriaLabelPrefix,ariaLabelPrefixWhenDisabled:e.props.disabledDayAriaLabelPrefix,key:r.valueOf(),day:r,month:e.props.month,onClick:e.handleDayClick.bind(It(e),r),onMouseEnter:e.handleDayMouseEnter.bind(It(e),r),minDate:e.props.minDate,maxDate:e.props.maxDate,excludeDates:e.props.excludeDates,excludeDateIntervals:e.props.excludeDateIntervals,includeDates:e.props.includeDates,includeDateIntervals:e.props.includeDateIntervals,highlightDates:e.props.highlightDates,holidays:e.props.holidays,selectingDate:e.props.selectingDate,filterDate:e.props.filterDate,preSelection:e.props.preSelection,selected:e.props.selected,selectsStart:e.props.selectsStart,selectsEnd:e.props.selectsEnd,selectsRange:e.props.selectsRange,showWeekPicker:e.props.showWeekPicker,showWeekNumber:e.props.showWeekNumber,selectsDisabledDaysInRange:e.props.selectsDisabledDaysInRange,startDate:e.props.startDate,endDate:e.props.endDate,dayClassName:e.props.dayClassName,renderDayContents:e.props.renderDayContents,disabledKeyboardNavigation:e.props.disabledKeyboardNavigation,handleOnKeyDown:e.props.handleOnKeyDown,isInputFocused:e.props.isInputFocused,containerRef:e.props.containerRef,inline:e.props.inline,shouldFocusDayInline:e.props.shouldFocusDayInline,monthShowsDuplicateDaysEnd:e.props.monthShowsDuplicateDaysEnd,monthShowsDuplicateDaysStart:e.props.monthShowsDuplicateDaysStart,locale:e.props.locale})})))})),St(It(e),"startOfWeek",(function(){return Wt(e.props.day,e.props.locale,e.props.calendarStartDay)})),St(It(e),"isKeyboardSelected",(function(){return!e.props.disabledKeyboardNavigation&&!Jt(e.startOfWeek(),e.props.selected)&&Jt(e.startOfWeek(),e.props.preSelection)})),e}return Et(n,[{key:"render",value:function(){var e={"react-datepicker__week":!0,"react-datepicker__week--selected":Jt(this.startOfWeek(),this.props.selected),"react-datepicker__week--keyboard-selected":this.isKeyboardSelected()};return de.default.createElement("div",{className:fe.default(e)},this.renderDays())}}],[{key:"defaultProps",get:function(){return{shouldCloseOnSelect:!0}}}]),n}(de.default.Component),Wn="two_columns",Gn="three_columns",Hn="four_columns",Yn=St(St(St({},Wn,{grid:[[0,1],[2,3],[4,5],[6,7],[8,9],[10,11]],verticalNavigationOffset:2}),Gn,{grid:[[0,1,2],[3,4,5],[6,7,8],[9,10,11]],verticalNavigationOffset:3}),Hn,{grid:[[0,1,2,3],[4,5,6,7],[8,9,10,11]],verticalNavigationOffset:4});function qn(e,t){return e?Hn:t?Wn:Gn}var Kn=function(e){xt(n,e);var t=Nt(n);function n(){var e;_t(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return St(It(e=t.call.apply(t,[this].concat(i))),"MONTH_REFS",At(Array(12)).map((function(){return de.default.createRef()}))),St(It(e),"QUARTER_REFS",At(Array(4)).map((function(){return de.default.createRef()}))),St(It(e),"isDisabled",(function(t){return an(t,e.props)})),St(It(e),"isExcluded",(function(t){return on(t,e.props)})),St(It(e),"handleDayClick",(function(t,n){e.props.onDayClick&&e.props.onDayClick(t,n,e.props.orderInDisplay)})),St(It(e),"handleDayMouseEnter",(function(t){e.props.onDayMouseEnter&&e.props.onDayMouseEnter(t)})),St(It(e),"handleMouseLeave",(function(){e.props.onMouseLeave&&e.props.onMouseLeave()})),St(It(e),"isRangeStartMonth",(function(t){var n=e.props,r=n.day,i=n.startDate,a=n.endDate;return!(!i||!a)&&Xt(Ve.default(r,t),i)})),St(It(e),"isRangeStartQuarter",(function(t){var n=e.props,r=n.day,i=n.startDate,a=n.endDate;return!(!i||!a)&&Qt(ze.default(r,t),i)})),St(It(e),"isRangeEndMonth",(function(t){var n=e.props,r=n.day,i=n.startDate,a=n.endDate;return!(!i||!a)&&Xt(Ve.default(r,t),a)})),St(It(e),"isRangeEndQuarter",(function(t){var n=e.props,r=n.day,i=n.startDate,a=n.endDate;return!(!i||!a)&&Qt(ze.default(r,t),a)})),St(It(e),"isInSelectingRangeMonth",(function(t){var n,r=e.props,i=r.day,a=r.selectsStart,o=r.selectsEnd,s=r.selectsRange,c=r.startDate,u=r.endDate,l=null!==(n=e.props.selectingDate)&&void 0!==n?n:e.props.preSelection;return!(!(a||o||s)||!l)&&(a&&u?cn(l,u,t,i):(o&&c||!(!s||!c||u))&&cn(c,l,t,i))})),St(It(e),"isSelectingMonthRangeStart",(function(t){var n;if(!e.isInSelectingRangeMonth(t))return!1;var r=e.props,i=r.day,a=r.startDate,o=r.selectsStart,s=Ve.default(i,t),c=null!==(n=e.props.selectingDate)&&void 0!==n?n:e.props.preSelection;return Xt(s,o?c:a)})),St(It(e),"isSelectingMonthRangeEnd",(function(t){var n;if(!e.isInSelectingRangeMonth(t))return!1;var r=e.props,i=r.day,a=r.endDate,o=r.selectsEnd,s=r.selectsRange,c=Ve.default(i,t),u=null!==(n=e.props.selectingDate)&&void 0!==n?n:e.props.preSelection;return Xt(c,o||s?u:a)})),St(It(e),"isInSelectingRangeQuarter",(function(t){var n,r=e.props,i=r.day,a=r.selectsStart,o=r.selectsEnd,s=r.selectsRange,c=r.startDate,u=r.endDate,l=null!==(n=e.props.selectingDate)&&void 0!==n?n:e.props.preSelection;return!(!(a||o||s)||!l)&&(a&&u?fn(l,u,t,i):(o&&c||!(!s||!c||u))&&fn(c,l,t,i))})),St(It(e),"isWeekInMonth",(function(t){var n=e.props.day,r=ye.default(t,6);return Xt(t,n)||Xt(r,n)})),St(It(e),"isCurrentMonth",(function(e,t){return Pe.default(e)===Pe.default(Ft())&&t===Le.default(Ft())})),St(It(e),"isCurrentQuarter",(function(e,t){return Pe.default(e)===Pe.default(Ft())&&t===Oe.default(Ft())})),St(It(e),"isSelectedMonth",(function(e,t,n){return Le.default(n)===t&&Pe.default(e)===Pe.default(n)})),St(It(e),"isSelectedQuarter",(function(e,t,n){return Oe.default(e)===t&&Pe.default(e)===Pe.default(n)})),St(It(e),"renderWeeks",(function(){for(var t=[],n=e.props.fixedHeight,r=0,i=!1,a=Wt(Gt(e.props.day),e.props.locale,e.props.calendarStartDay);t.push(de.default.createElement(zn,{ariaLabelPrefix:e.props.weekAriaLabelPrefix,chooseDayAriaLabelPrefix:e.props.chooseDayAriaLabelPrefix,disabledDayAriaLabelPrefix:e.props.disabledDayAriaLabelPrefix,key:r,day:a,month:Le.default(e.props.day),onDayClick:e.handleDayClick,onDayMouseEnter:e.handleDayMouseEnter,onWeekSelect:e.props.onWeekSelect,formatWeekNumber:e.props.formatWeekNumber,locale:e.props.locale,minDate:e.props.minDate,maxDate:e.props.maxDate,excludeDates:e.props.excludeDates,excludeDateIntervals:e.props.excludeDateIntervals,includeDates:e.props.includeDates,includeDateIntervals:e.props.includeDateIntervals,inline:e.props.inline,shouldFocusDayInline:e.props.shouldFocusDayInline,highlightDates:e.props.highlightDates,holidays:e.props.holidays,selectingDate:e.props.selectingDate,filterDate:e.props.filterDate,preSelection:e.props.preSelection,selected:e.props.selected,selectsStart:e.props.selectsStart,selectsEnd:e.props.selectsEnd,selectsRange:e.props.selectsRange,selectsDisabledDaysInRange:e.props.selectsDisabledDaysInRange,showWeekNumber:e.props.showWeekNumbers,showWeekPicker:e.props.showWeekPicker,startDate:e.props.startDate,endDate:e.props.endDate,dayClassName:e.props.dayClassName,setOpen:e.props.setOpen,shouldCloseOnSelect:e.props.shouldCloseOnSelect,disabledKeyboardNavigation:e.props.disabledKeyboardNavigation,renderDayContents:e.props.renderDayContents,handleOnKeyDown:e.props.handleOnKeyDown,isInputFocused:e.props.isInputFocused,containerRef:e.props.containerRef,calendarStartDay:e.props.calendarStartDay,monthShowsDuplicateDaysEnd:e.props.monthShowsDuplicateDaysEnd,monthShowsDuplicateDaysStart:e.props.monthShowsDuplicateDaysStart})),!i;){r++,a=be.default(a,1);var o=n&&r>=6,s=!n&&!e.isWeekInMonth(a);if(o||s){if(!e.props.peekNextMonth)break;i=!0}}return t})),St(It(e),"onMonthClick",(function(t,n){e.handleDayClick(Gt(Ve.default(e.props.day,n)),t)})),St(It(e),"onMonthMouseEnter",(function(t){e.handleDayMouseEnter(Gt(Ve.default(e.props.day,t)))})),St(It(e),"handleMonthNavigation",(function(t,n){e.isDisabled(n)||e.isExcluded(n)||(e.props.setPreSelection(n),e.MONTH_REFS[t].current&&e.MONTH_REFS[t].current.focus())})),St(It(e),"onMonthKeyDown",(function(t,n){var r=e.props,i=r.selected,a=r.preSelection,o=r.disabledKeyboardNavigation,s=r.showTwoColumnMonthYearPicker,c=r.showFourColumnMonthYearPicker,u=r.setPreSelection,l=t.key;if("Tab"!==l&&t.preventDefault(),!o){var d=qn(c,s),f=Yn[d].verticalNavigationOffset,h=Yn[d].grid;switch(l){case"Enter":e.onMonthClick(t,n),u(i);break;case"ArrowRight":e.handleMonthNavigation(11===n?0:n+1,_e.default(a,1));break;case"ArrowLeft":e.handleMonthNavigation(0===n?11:n-1,xe.default(a,1));break;case"ArrowUp":e.handleMonthNavigation(h[0].includes(n)?n+12-f:n-f,xe.default(a,f));break;case"ArrowDown":e.handleMonthNavigation(h[h.length-1].includes(n)?n-12+f:n+f,_e.default(a,f))}}})),St(It(e),"onQuarterClick",(function(t,n){e.handleDayClick(Yt(ze.default(e.props.day,n)),t)})),St(It(e),"onQuarterMouseEnter",(function(t){e.handleDayMouseEnter(Yt(ze.default(e.props.day,t)))})),St(It(e),"handleQuarterNavigation",(function(t,n){e.isDisabled(n)||e.isExcluded(n)||(e.props.setPreSelection(n),e.QUARTER_REFS[t-1].current&&e.QUARTER_REFS[t-1].current.focus())})),St(It(e),"onQuarterKeyDown",(function(t,n){var r=t.key;if(!e.props.disabledKeyboardNavigation)switch(r){case"Enter":e.onQuarterClick(t,n),e.props.setPreSelection(e.props.selected);break;case"ArrowRight":e.handleQuarterNavigation(4===n?1:n+1,we.default(e.props.preSelection,1));break;case"ArrowLeft":e.handleQuarterNavigation(1===n?4:n-1,Te.default(e.props.preSelection,1))}})),St(It(e),"getMonthClassNames",(function(t){var n=e.props,r=n.day,i=n.startDate,a=n.endDate,o=n.selected,s=n.minDate,c=n.maxDate,u=n.preSelection,l=n.monthClassName,d=n.excludeDates,f=n.includeDates,h=l?l(Ve.default(r,t)):void 0,p=Ve.default(r,t);return fe.default("react-datepicker__month-text","react-datepicker__month-".concat(t),h,{"react-datepicker__month-text--disabled":(s||c||d||f)&&sn(p,e.props),"react-datepicker__month-text--selected":e.isSelectedMonth(r,t,o),"react-datepicker__month-text--keyboard-selected":!e.props.disabledKeyboardNavigation&&Le.default(u)===t,"react-datepicker__month-text--in-selecting-range":e.isInSelectingRangeMonth(t),"react-datepicker__month-text--in-range":cn(i,a,t,r),"react-datepicker__month-text--range-start":e.isRangeStartMonth(t),"react-datepicker__month-text--range-end":e.isRangeEndMonth(t),"react-datepicker__month-text--selecting-range-start":e.isSelectingMonthRangeStart(t),"react-datepicker__month-text--selecting-range-end":e.isSelectingMonthRangeEnd(t),"react-datepicker__month-text--today":e.isCurrentMonth(r,t)})})),St(It(e),"getTabIndex",(function(t){var n=Le.default(e.props.preSelection);return e.props.disabledKeyboardNavigation||t!==n?"-1":"0"})),St(It(e),"getQuarterTabIndex",(function(t){var n=Oe.default(e.props.preSelection);return e.props.disabledKeyboardNavigation||t!==n?"-1":"0"})),St(It(e),"getAriaLabel",(function(t){var n=e.props,r=n.chooseDayAriaLabelPrefix,i=void 0===r?"Choose":r,a=n.disabledDayAriaLabelPrefix,o=void 0===a?"Not available":a,s=n.day,c=Ve.default(s,t),u=e.isDisabled(c)||e.isExcluded(c)?o:i;return"".concat(u," ").concat(Bt(c,"MMMM yyyy"))})),St(It(e),"getQuarterClassNames",(function(t){var n=e.props,r=n.day,i=n.startDate,a=n.endDate,o=n.selected,s=n.minDate,c=n.maxDate,u=n.preSelection,l=n.disabledKeyboardNavigation;return fe.default("react-datepicker__quarter-text","react-datepicker__quarter-".concat(t),{"react-datepicker__quarter-text--disabled":(s||c)&&un(ze.default(r,t),e.props),"react-datepicker__quarter-text--selected":e.isSelectedQuarter(r,t,o),"react-datepicker__quarter-text--keyboard-selected":!l&&Oe.default(u)===t,"react-datepicker__quarter-text--in-selecting-range":e.isInSelectingRangeQuarter(t),"react-datepicker__quarter-text--in-range":fn(i,a,t,r),"react-datepicker__quarter-text--range-start":e.isRangeStartQuarter(t),"react-datepicker__quarter-text--range-end":e.isRangeEndQuarter(t)})})),St(It(e),"getMonthContent",(function(t){var n=e.props,r=n.showFullMonthYearPicker,i=n.renderMonthContent,a=n.locale,o=n.day,s=rn(t,a),c=nn(t,a);return i?i(t,s,c,o):r?c:s})),St(It(e),"getQuarterContent",(function(t){var n=e.props,r=n.renderQuarterContent,i=function(e,t){return Bt(ze.default(Ft(),e),"QQQ",t)}(t,n.locale);return r?r(t,i):i})),St(It(e),"renderMonths",(function(){var t=e.props,n=t.showTwoColumnMonthYearPicker,r=t.showFourColumnMonthYearPicker,i=t.day,a=t.selected;return Yn[qn(r,n)].grid.map((function(t,n){return de.default.createElement("div",{className:"react-datepicker__month-wrapper",key:n},t.map((function(t,n){return de.default.createElement("div",{ref:e.MONTH_REFS[t],key:n,onClick:function(n){e.onMonthClick(n,t)},onKeyDown:function(n){e.onMonthKeyDown(n,t)},onMouseEnter:function(){return e.onMonthMouseEnter(t)},tabIndex:e.getTabIndex(t),className:e.getMonthClassNames(t),role:"option","aria-label":e.getAriaLabel(t),"aria-current":e.isCurrentMonth(i,t)?"date":void 0,"aria-selected":e.isSelectedMonth(i,t,a)},e.getMonthContent(t))})))}))})),St(It(e),"renderQuarters",(function(){var t=e.props,n=t.day,r=t.selected;return de.default.createElement("div",{className:"react-datepicker__quarter-wrapper"},[1,2,3,4].map((function(t,i){return de.default.createElement("div",{key:i,ref:e.QUARTER_REFS[i],role:"option",onClick:function(n){e.onQuarterClick(n,t)},onKeyDown:function(n){e.onQuarterKeyDown(n,t)},onMouseEnter:function(){return e.onQuarterMouseEnter(t)},className:e.getQuarterClassNames(t),"aria-selected":e.isSelectedQuarter(n,t,r),tabIndex:e.getQuarterTabIndex(t),"aria-current":e.isCurrentQuarter(n,t)?"date":void 0},e.getQuarterContent(t))})))})),St(It(e),"getClassNames",(function(){var t=e.props,n=t.selectingDate,r=t.selectsStart,i=t.selectsEnd,a=t.showMonthYearPicker,o=t.showQuarterYearPicker,s=t.showWeekPicker;return fe.default("react-datepicker__month",{"react-datepicker__month--selecting-range":n&&(r||i)},{"react-datepicker__monthPicker":a},{"react-datepicker__quarterPicker":o},{"react-datepicker__weekPicker":s})})),e}return Et(n,[{key:"render",value:function(){var e=this.props,t=e.showMonthYearPicker,n=e.showQuarterYearPicker,r=e.day,i=e.ariaLabelPrefix,a=void 0===i?"month ":i;return de.default.createElement("div",{className:this.getClassNames(),onMouseLeave:this.handleMouseLeave,"aria-label":"".concat(a," ").concat(Bt(r,"yyyy-MM")),role:"listbox"},t?this.renderMonths():n?this.renderQuarters():this.renderWeeks())}}]),n}(de.default.Component),Xn=function(e){xt(n,e);var t=Nt(n);function n(){var e;_t(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return St(It(e=t.call.apply(t,[this].concat(i))),"state",{height:null}),St(It(e),"scrollToTheSelectedTime",(function(){requestAnimationFrame((function(){e.list&&(e.list.scrollTop=e.centerLi&&n.calcCenterPosition(e.props.monthRef?e.props.monthRef.clientHeight-e.header.clientHeight:e.list.clientHeight,e.centerLi))}))})),St(It(e),"handleClick",(function(t){(e.props.minTime||e.props.maxTime)&&gn(t,e.props)||(e.props.excludeTimes||e.props.includeTimes||e.props.filterTime)&&mn(t,e.props)||e.props.onChange(t)})),St(It(e),"isSelectedTime",(function(t){return e.props.selected&&(n=t,In(e.props.selected).getTime()===In(n).getTime());var n})),St(It(e),"isDisabledTime",(function(t){return(e.props.minTime||e.props.maxTime)&&gn(t,e.props)||(e.props.excludeTimes||e.props.includeTimes||e.props.filterTime)&&mn(t,e.props)})),St(It(e),"liClasses",(function(t){var n=["react-datepicker__time-list-item",e.props.timeClassName?e.props.timeClassName(t):void 0];return e.isSelectedTime(t)&&n.push("react-datepicker__time-list-item--selected"),e.isDisabledTime(t)&&n.push("react-datepicker__time-list-item--disabled"),e.props.injectTimes&&(60*Ae.default(t)+Ne.default(t))%e.props.intervals!=0&&n.push("react-datepicker__time-list-item--injected"),n.join(" ")})),St(It(e),"handleOnKeyDown",(function(t,n){" "===t.key&&(t.preventDefault(),t.key="Enter"),"ArrowUp"!==t.key&&"ArrowLeft"!==t.key||!t.target.previousSibling||(t.preventDefault(),t.target.previousSibling.focus()),"ArrowDown"!==t.key&&"ArrowRight"!==t.key||!t.target.nextSibling||(t.preventDefault(),t.target.nextSibling.focus()),"Enter"===t.key&&e.handleClick(n),e.props.handleOnKeyDown(t)})),St(It(e),"renderTimes",(function(){for(var t,n=[],r=e.props.format?e.props.format:"p",i=e.props.intervals,a=e.props.selected||e.props.openToDate||Ft(),o=(t=a,Xe.default(t)),s=e.props.injectTimes&&e.props.injectTimes.sort((function(e,t){return e-t})),c=60*function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),24);return Math.round((+n-+t)/36e5)}(a),u=c/i,l=0;l<u;l++){var d=ge.default(o,l*i);if(n.push(d),s){var f=xn(o,d,l,i,s);n=n.concat(f)}}var h=n.reduce((function(e,t){return t.getTime()<=a.getTime()?t:e}),n[0]);return n.map((function(t,n){return de.default.createElement("li",{key:n,onClick:e.handleClick.bind(It(e),t),className:e.liClasses(t),ref:function(n){t===h&&(e.centerLi=n)},onKeyDown:function(n){e.handleOnKeyDown(n,t)},tabIndex:t===h?0:-1,role:"option","aria-selected":e.isSelectedTime(t)?"true":void 0,"aria-disabled":e.isDisabledTime(t)?"true":void 0},Bt(t,r,e.props.locale))}))})),e}return Et(n,[{key:"componentDidMount",value:function(){this.scrollToTheSelectedTime(),this.props.monthRef&&this.header&&this.setState({height:this.props.monthRef.clientHeight-this.header.clientHeight})}},{key:"render",value:function(){var e=this,t=this.state.height;return de.default.createElement("div",{className:"react-datepicker__time-container ".concat(this.props.todayButton?"react-datepicker__time-container--with-today-button":"")},de.default.createElement("div",{className:"react-datepicker__header react-datepicker__header--time ".concat(this.props.showTimeSelectOnly?"react-datepicker__header--time--only":""),ref:function(t){e.header=t}},de.default.createElement("div",{className:"react-datepicker-time__header"},this.props.timeCaption)),de.default.createElement("div",{className:"react-datepicker__time"},de.default.createElement("div",{className:"react-datepicker__time-box"},de.default.createElement("ul",{className:"react-datepicker__time-list",ref:function(t){e.list=t},style:t?{height:t}:{},role:"listbox","aria-label":this.props.timeCaption},this.renderTimes()))))}}],[{key:"defaultProps",get:function(){return{intervals:30,onTimeChange:function(){},todayButton:null,timeCaption:"Time"}}}]),n}(de.default.Component);St(Xn,"calcCenterPosition",(function(e,t){return t.offsetTop-(e/2-t.clientHeight/2)}));var Qn=function(e){xt(n,e);var t=Nt(n);function n(e){var r;return _t(this,n),St(It(r=t.call(this,e)),"YEAR_REFS",At(Array(r.props.yearItemNumber)).map((function(){return de.default.createRef()}))),St(It(r),"isDisabled",(function(e){return an(e,r.props)})),St(It(r),"isExcluded",(function(e){return on(e,r.props)})),St(It(r),"selectingDate",(function(){var e;return null!==(e=r.props.selectingDate)&&void 0!==e?e:r.props.preSelection})),St(It(r),"updateFocusOnPaginate",(function(e){var t=function(){this.YEAR_REFS[e].current.focus()}.bind(It(r));window.requestAnimationFrame(t)})),St(It(r),"handleYearClick",(function(e,t){r.props.onDayClick&&r.props.onDayClick(e,t)})),St(It(r),"handleYearNavigation",(function(e,t){var n=r.props,i=n.date,a=n.yearItemNumber,o=Rn(i,a).startPeriod;r.isDisabled(t)||r.isExcluded(t)||(r.props.setPreSelection(t),e-o==-1?r.updateFocusOnPaginate(a-1):e-o===a?r.updateFocusOnPaginate(0):r.YEAR_REFS[e-o].current.focus())})),St(It(r),"isSameDay",(function(e,t){return Jt(e,t)})),St(It(r),"isCurrentYear",(function(e){return e===Pe.default(Ft())})),St(It(r),"isRangeStart",(function(e){return r.props.startDate&&r.props.endDate&&Kt(We.default(Ft(),e),r.props.startDate)})),St(It(r),"isRangeEnd",(function(e){return r.props.startDate&&r.props.endDate&&Kt(We.default(Ft(),e),r.props.endDate)})),St(It(r),"isInRange",(function(e){return ln(e,r.props.startDate,r.props.endDate)})),St(It(r),"isInSelectingRange",(function(e){var t=r.props,n=t.selectsStart,i=t.selectsEnd,a=t.selectsRange,o=t.startDate,s=t.endDate;return!(!(n||i||a)||!r.selectingDate())&&(n&&s?ln(e,r.selectingDate(),s):(i&&o||!(!a||!o||s))&&ln(e,o,r.selectingDate()))})),St(It(r),"isSelectingRangeStart",(function(e){if(!r.isInSelectingRange(e))return!1;var t=r.props,n=t.startDate,i=t.selectsStart;return Kt(We.default(Ft(),e),i?r.selectingDate():n)})),St(It(r),"isSelectingRangeEnd",(function(e){if(!r.isInSelectingRange(e))return!1;var t=r.props,n=t.endDate,i=t.selectsEnd,a=t.selectsRange;return Kt(We.default(Ft(),e),i||a?r.selectingDate():n)})),St(It(r),"isKeyboardSelected",(function(e){var t=Ht(We.default(r.props.date,e));return!r.props.disabledKeyboardNavigation&&!r.props.inline&&!Jt(t,Ht(r.props.selected))&&Jt(t,Ht(r.props.preSelection))})),St(It(r),"onYearClick",(function(e,t){var n=r.props.date;r.handleYearClick(Ht(We.default(n,t)),e)})),St(It(r),"onYearKeyDown",(function(e,t){var n=e.key;if(!r.props.disabledKeyboardNavigation)switch(n){case"Enter":r.onYearClick(e,t),r.props.setPreSelection(r.props.selected);break;case"ArrowRight":r.handleYearNavigation(t+1,Ee.default(r.props.preSelection,1));break;case"ArrowLeft":r.handleYearNavigation(t-1,Re.default(r.props.preSelection,1))}})),St(It(r),"getYearClassNames",(function(e){var t=r.props,n=t.minDate,i=t.maxDate,a=t.selected,o=t.excludeDates,s=t.includeDates,c=t.filterDate;return fe.default("react-datepicker__year-text",{"react-datepicker__year-text--selected":e===Pe.default(a),"react-datepicker__year-text--disabled":(n||i||o||s||c)&&dn(e,r.props),"react-datepicker__year-text--keyboard-selected":r.isKeyboardSelected(e),"react-datepicker__year-text--range-start":r.isRangeStart(e),"react-datepicker__year-text--range-end":r.isRangeEnd(e),"react-datepicker__year-text--in-range":r.isInRange(e),"react-datepicker__year-text--in-selecting-range":r.isInSelectingRange(e),"react-datepicker__year-text--selecting-range-start":r.isSelectingRangeStart(e),"react-datepicker__year-text--selecting-range-end":r.isSelectingRangeEnd(e),"react-datepicker__year-text--today":r.isCurrentYear(e)})})),St(It(r),"getYearTabIndex",(function(e){return r.props.disabledKeyboardNavigation?"-1":e===Pe.default(r.props.preSelection)?"0":"-1"})),St(It(r),"getYearContainerClassNames",(function(){var e=r.props,t=e.selectingDate,n=e.selectsStart,i=e.selectsEnd,a=e.selectsRange;return fe.default("react-datepicker__year",{"react-datepicker__year--selecting-range":t&&(n||i||a)})})),St(It(r),"getYearContent",(function(e){return r.props.renderYearContent?r.props.renderYearContent(e):e})),r}return Et(n,[{key:"render",value:function(){for(var e=this,t=[],n=this.props,r=n.date,i=n.yearItemNumber,a=n.onYearMouseEnter,o=n.onYearMouseLeave,s=Rn(r,i),c=s.startPeriod,u=s.endPeriod,l=function(n){t.push(de.default.createElement("div",{ref:e.YEAR_REFS[n-c],onClick:function(t){e.onYearClick(t,n)},onKeyDown:function(t){e.onYearKeyDown(t,n)},tabIndex:e.getYearTabIndex(n),className:e.getYearClassNames(n),onMouseEnter:function(e){return a(e,n)},onMouseLeave:function(e){return o(e,n)},key:n,"aria-current":e.isCurrentYear(n)?"date":void 0},e.getYearContent(n)))},d=c;d<=u;d++)l(d);return de.default.createElement("div",{className:this.getYearContainerClassNames()},de.default.createElement("div",{className:"react-datepicker__year-wrapper",onMouseLeave:this.props.clearSelectingDate},t))}}]),n}(de.default.Component),Jn=function(e){xt(n,e);var t=Nt(n);function n(e){var r;return _t(this,n),St(It(r=t.call(this,e)),"onTimeChange",(function(e){r.setState({time:e});var t=r.props.date,n=t instanceof Date&&!isNaN(t)?t:new Date;n.setHours(e.split(":")[0]),n.setMinutes(e.split(":")[1]),r.props.onChange(n)})),St(It(r),"renderTimeInput",(function(){var e=r.state.time,t=r.props,n=t.date,i=t.timeString,a=t.customTimeInput;return a?de.default.cloneElement(a,{date:n,value:e,onChange:r.onTimeChange}):de.default.createElement("input",{type:"time",className:"react-datepicker-time__input",placeholder:"Time",name:"time-input",required:!0,value:e,onChange:function(e){r.onTimeChange(e.target.value||i)}})})),r.state={time:r.props.timeString},r}return Et(n,[{key:"render",value:function(){return de.default.createElement("div",{className:"react-datepicker__input-time-container"},de.default.createElement("div",{className:"react-datepicker-time__caption"},this.props.timeInputLabel),de.default.createElement("div",{className:"react-datepicker-time__input-container"},de.default.createElement("div",{className:"react-datepicker-time__input"},this.renderTimeInput())))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.timeString!==t.time?{time:e.timeString}:null}}]),n}(de.default.Component);function Zn(e){var t=e.className,n=e.children,r=e.showPopperArrow,i=e.arrowProps,a=void 0===i?{}:i;return de.default.createElement("div",{className:t},r&&de.default.createElement("div",Ct({className:"react-datepicker__triangle"},a)),n)}var $n=["react-datepicker__year-select","react-datepicker__month-select","react-datepicker__month-year-select"],er=function(e){xt(n,e);var t=Nt(n);function n(e){var r;return _t(this,n),St(It(r=t.call(this,e)),"handleClickOutside",(function(e){r.props.onClickOutside(e)})),St(It(r),"setClickOutsideRef",(function(){return r.containerRef.current})),St(It(r),"handleDropdownFocus",(function(e){(function(){var e=((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).className||"").split(/\s+/);return $n.some((function(t){return e.indexOf(t)>=0}))})(e.target)&&r.props.onDropdownFocus()})),St(It(r),"getDateInView",(function(){var e=r.props,t=e.preSelection,n=e.selected,i=e.openToDate,a=wn(r.props),o=En(r.props),s=Ft();return i||n||t||(a&&ut.default(s,a)?a:o&&ct.default(s,o)?o:s)})),St(It(r),"increaseMonth",(function(){r.setState((function(e){var t=e.date;return{date:_e.default(t,1)}}),(function(){return r.handleMonthChange(r.state.date)}))})),St(It(r),"decreaseMonth",(function(){r.setState((function(e){var t=e.date;return{date:xe.default(t,1)}}),(function(){return r.handleMonthChange(r.state.date)}))})),St(It(r),"handleDayClick",(function(e,t,n){r.props.onSelect(e,t,n),r.props.setPreSelection&&r.props.setPreSelection(e)})),St(It(r),"handleDayMouseEnter",(function(e){r.setState({selectingDate:e}),r.props.onDayMouseEnter&&r.props.onDayMouseEnter(e)})),St(It(r),"handleMonthMouseLeave",(function(){r.setState({selectingDate:null}),r.props.onMonthMouseLeave&&r.props.onMonthMouseLeave()})),St(It(r),"handleYearMouseEnter",(function(e,t){r.setState({selectingDate:We.default(Ft(),t)}),r.props.onYearMouseEnter&&r.props.onYearMouseEnter(e,t)})),St(It(r),"handleYearMouseLeave",(function(e,t){r.props.onYearMouseLeave&&r.props.onYearMouseLeave(e,t)})),St(It(r),"handleYearChange",(function(e){r.props.onYearChange&&(r.props.onYearChange(e),r.setState({isRenderAriaLiveMessage:!0})),r.props.adjustDateOnChange&&(r.props.onSelect&&r.props.onSelect(e),r.props.setOpen&&r.props.setOpen(!0)),r.props.setPreSelection&&r.props.setPreSelection(e)})),St(It(r),"handleMonthChange",(function(e){r.handleCustomMonthChange(e),r.props.adjustDateOnChange&&(r.props.onSelect&&r.props.onSelect(e),r.props.setOpen&&r.props.setOpen(!0)),r.props.setPreSelection&&r.props.setPreSelection(e)})),St(It(r),"handleCustomMonthChange",(function(e){r.props.onMonthChange&&(r.props.onMonthChange(e),r.setState({isRenderAriaLiveMessage:!0}))})),St(It(r),"handleMonthYearChange",(function(e){r.handleYearChange(e),r.handleMonthChange(e)})),St(It(r),"changeYear",(function(e){r.setState((function(t){var n=t.date;return{date:We.default(n,e)}}),(function(){return r.handleYearChange(r.state.date)}))})),St(It(r),"changeMonth",(function(e){r.setState((function(t){var n=t.date;return{date:Ve.default(n,e)}}),(function(){return r.handleMonthChange(r.state.date)}))})),St(It(r),"changeMonthYear",(function(e){r.setState((function(t){var n=t.date;return{date:We.default(Ve.default(n,Le.default(e)),Pe.default(e))}}),(function(){return r.handleMonthYearChange(r.state.date)}))})),St(It(r),"header",(function(){var e=Wt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.state.date,r.props.locale,r.props.calendarStartDay),t=[];return r.props.showWeekNumbers&&t.push(de.default.createElement("div",{key:"W",className:"react-datepicker__day-name"},r.props.weekLabel||"#")),t.concat([0,1,2,3,4,5,6].map((function(t){var n=ye.default(e,t),i=r.formatWeekday(n,r.props.locale),a=r.props.weekDayClassName?r.props.weekDayClassName(n):void 0;return de.default.createElement("div",{key:t,className:fe.default("react-datepicker__day-name",a)},i)})))})),St(It(r),"formatWeekday",(function(e,t){return r.props.formatWeekDay?function(e,t,n){return t(Bt(e,"EEEE",n))}(e,r.props.formatWeekDay,t):r.props.useWeekdaysShort?function(e,t){return Bt(e,"EEE",t)}(e,t):function(e,t){return Bt(e,"EEEEEE",t)}(e,t)})),St(It(r),"decreaseYear",(function(){r.setState((function(e){var t=e.date;return{date:Re.default(t,r.props.showYearPicker?r.props.yearItemNumber:1)}}),(function(){return r.handleYearChange(r.state.date)}))})),St(It(r),"clearSelectingDate",(function(){r.setState({selectingDate:null})})),St(It(r),"renderPreviousButton",(function(){if(!r.props.renderCustomHeader){var e;switch(!0){case r.props.showMonthYearPicker:e=bn(r.state.date,r.props);break;case r.props.showYearPicker:e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minDate,r=t.yearItemNumber,i=void 0===r?Pt:r,a=Rn(Ht(Re.default(e,i)),i).endPeriod,o=n&&Pe.default(n);return o&&o>a||!1}(r.state.date,r.props);break;default:e=vn(r.state.date,r.props)}if((r.props.forceShowMonthNavigation||r.props.showDisabledMonthNavigation||!e)&&!r.props.showTimeSelectOnly){var t=["react-datepicker__navigation","react-datepicker__navigation--previous"],n=r.decreaseMonth;(r.props.showMonthYearPicker||r.props.showQuarterYearPicker||r.props.showYearPicker)&&(n=r.decreaseYear),e&&r.props.showDisabledMonthNavigation&&(t.push("react-datepicker__navigation--previous--disabled"),n=null);var i=r.props.showMonthYearPicker||r.props.showQuarterYearPicker||r.props.showYearPicker,a=r.props,o=a.previousMonthButtonLabel,s=a.previousYearButtonLabel,c=r.props,u=c.previousMonthAriaLabel,l=void 0===u?"string"==typeof o?o:"Previous Month":u,d=c.previousYearAriaLabel,f=void 0===d?"string"==typeof s?s:"Previous Year":d;return de.default.createElement("button",{type:"button",className:t.join(" "),onClick:n,onKeyDown:r.props.handleOnKeyDown,"aria-label":i?f:l},de.default.createElement("span",{className:["react-datepicker__navigation-icon","react-datepicker__navigation-icon--previous"].join(" ")},i?r.props.previousYearButtonLabel:r.props.previousMonthButtonLabel))}}})),St(It(r),"increaseYear",(function(){r.setState((function(e){var t=e.date;return{date:Ee.default(t,r.props.showYearPicker?r.props.yearItemNumber:1)}}),(function(){return r.handleYearChange(r.state.date)}))})),St(It(r),"renderNextButton",(function(){if(!r.props.renderCustomHeader){var e;switch(!0){case r.props.showMonthYearPicker:e=_n(r.state.date,r.props);break;case r.props.showYearPicker:e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.maxDate,r=t.yearItemNumber,i=void 0===r?Pt:r,a=Rn(Ee.default(e,i),i).startPeriod,o=n&&Pe.default(n);return o&&o<a||!1}(r.state.date,r.props);break;default:e=yn(r.state.date,r.props)}if((r.props.forceShowMonthNavigation||r.props.showDisabledMonthNavigation||!e)&&!r.props.showTimeSelectOnly){var t=["react-datepicker__navigation","react-datepicker__navigation--next"];r.props.showTimeSelect&&t.push("react-datepicker__navigation--next--with-time"),r.props.todayButton&&t.push("react-datepicker__navigation--next--with-today-button");var n=r.increaseMonth;(r.props.showMonthYearPicker||r.props.showQuarterYearPicker||r.props.showYearPicker)&&(n=r.increaseYear),e&&r.props.showDisabledMonthNavigation&&(t.push("react-datepicker__navigation--next--disabled"),n=null);var i=r.props.showMonthYearPicker||r.props.showQuarterYearPicker||r.props.showYearPicker,a=r.props,o=a.nextMonthButtonLabel,s=a.nextYearButtonLabel,c=r.props,u=c.nextMonthAriaLabel,l=void 0===u?"string"==typeof o?o:"Next Month":u,d=c.nextYearAriaLabel,f=void 0===d?"string"==typeof s?s:"Next Year":d;return de.default.createElement("button",{type:"button",className:t.join(" "),onClick:n,onKeyDown:r.props.handleOnKeyDown,"aria-label":i?f:l},de.default.createElement("span",{className:["react-datepicker__navigation-icon","react-datepicker__navigation-icon--next"].join(" ")},i?r.props.nextYearButtonLabel:r.props.nextMonthButtonLabel))}}})),St(It(r),"renderCurrentMonth",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.state.date,t=["react-datepicker__current-month"];return r.props.showYearDropdown&&t.push("react-datepicker__current-month--hasYearDropdown"),r.props.showMonthDropdown&&t.push("react-datepicker__current-month--hasMonthDropdown"),r.props.showMonthYearDropdown&&t.push("react-datepicker__current-month--hasMonthYearDropdown"),de.default.createElement("div",{className:t.join(" ")},Bt(e,r.props.dateFormat,r.props.locale))})),St(It(r),"renderYearDropdown",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(r.props.showYearDropdown&&!e)return de.default.createElement(Dn,{adjustDateOnChange:r.props.adjustDateOnChange,date:r.state.date,onSelect:r.props.onSelect,setOpen:r.props.setOpen,dropdownMode:r.props.dropdownMode,onChange:r.changeYear,minDate:r.props.minDate,maxDate:r.props.maxDate,year:Pe.default(r.state.date),scrollableYearDropdown:r.props.scrollableYearDropdown,yearDropdownItemNumber:r.props.yearDropdownItemNumber})})),St(It(r),"renderMonthDropdown",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(r.props.showMonthDropdown&&!e)return de.default.createElement(On,{dropdownMode:r.props.dropdownMode,locale:r.props.locale,onChange:r.changeMonth,month:Le.default(r.state.date),useShortMonthInDropdown:r.props.useShortMonthInDropdown})})),St(It(r),"renderMonthYearDropdown",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(r.props.showMonthYearDropdown&&!e)return de.default.createElement(Un,{dropdownMode:r.props.dropdownMode,locale:r.props.locale,dateFormat:r.props.dateFormat,onChange:r.changeMonthYear,minDate:r.props.minDate,maxDate:r.props.maxDate,date:r.state.date,scrollableMonthYearDropdown:r.props.scrollableMonthYearDropdown})})),St(It(r),"handleTodayButtonClick",(function(e){r.props.onSelect(qt(),e),r.props.setPreSelection&&r.props.setPreSelection(qt())})),St(It(r),"renderTodayButton",(function(){if(r.props.todayButton&&!r.props.showTimeSelectOnly)return de.default.createElement("div",{className:"react-datepicker__today-button",onClick:function(e){return r.handleTodayButtonClick(e)}},r.props.todayButton)})),St(It(r),"renderDefaultHeader",(function(e){var t=e.monthDate,n=e.i;return de.default.createElement("div",{className:"react-datepicker__header ".concat(r.props.showTimeSelect?"react-datepicker__header--has-time-select":"")},r.renderCurrentMonth(t),de.default.createElement("div",{className:"react-datepicker__header__dropdown react-datepicker__header__dropdown--".concat(r.props.dropdownMode),onFocus:r.handleDropdownFocus},r.renderMonthDropdown(0!==n),r.renderMonthYearDropdown(0!==n),r.renderYearDropdown(0!==n)),de.default.createElement("div",{className:"react-datepicker__day-names"},r.header(t)))})),St(It(r),"renderCustomHeader",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.monthDate,n=e.i;if(r.props.showTimeSelect&&!r.state.monthContainer||r.props.showTimeSelectOnly)return null;var i=vn(r.state.date,r.props),a=yn(r.state.date,r.props),o=bn(r.state.date,r.props),s=_n(r.state.date,r.props),c=!r.props.showMonthYearPicker&&!r.props.showQuarterYearPicker&&!r.props.showYearPicker;return de.default.createElement("div",{className:"react-datepicker__header react-datepicker__header--custom",onFocus:r.props.onDropdownFocus},r.props.renderCustomHeader(yt(yt({},r.state),{},{customHeaderCount:n,monthDate:t,changeMonth:r.changeMonth,changeYear:r.changeYear,decreaseMonth:r.decreaseMonth,increaseMonth:r.increaseMonth,decreaseYear:r.decreaseYear,increaseYear:r.increaseYear,prevMonthButtonDisabled:i,nextMonthButtonDisabled:a,prevYearButtonDisabled:o,nextYearButtonDisabled:s})),c&&de.default.createElement("div",{className:"react-datepicker__day-names"},r.header(t)))})),St(It(r),"renderYearHeader",(function(){var e=r.state.date,t=r.props,n=t.showYearPicker,i=Rn(e,t.yearItemNumber),a=i.startPeriod,o=i.endPeriod;return de.default.createElement("div",{className:"react-datepicker__header react-datepicker-year-header"},n?"".concat(a," - ").concat(o):Pe.default(e))})),St(It(r),"renderHeader",(function(e){switch(!0){case void 0!==r.props.renderCustomHeader:return r.renderCustomHeader(e);case r.props.showMonthYearPicker||r.props.showQuarterYearPicker||r.props.showYearPicker:return r.renderYearHeader(e);default:return r.renderDefaultHeader(e)}})),St(It(r),"renderMonths",(function(){var e;if(!r.props.showTimeSelectOnly&&!r.props.showYearPicker){for(var t=[],n=r.props.showPreviousMonths?r.props.monthsShown-1:0,i=xe.default(r.state.date,n),a=null!==(e=r.props.monthSelectedIn)&&void 0!==e?e:n,o=0;o<r.props.monthsShown;++o){var s=o-a+n,c=_e.default(i,s),u="month-".concat(o),l=o<r.props.monthsShown-1,d=o>0;t.push(de.default.createElement("div",{key:u,ref:function(e){r.monthContainer=e},className:"react-datepicker__month-container"},r.renderHeader({monthDate:c,i:o}),de.default.createElement(Kn,{chooseDayAriaLabelPrefix:r.props.chooseDayAriaLabelPrefix,disabledDayAriaLabelPrefix:r.props.disabledDayAriaLabelPrefix,weekAriaLabelPrefix:r.props.weekAriaLabelPrefix,ariaLabelPrefix:r.props.monthAriaLabelPrefix,onChange:r.changeMonthYear,day:c,dayClassName:r.props.dayClassName,calendarStartDay:r.props.calendarStartDay,monthClassName:r.props.monthClassName,onDayClick:r.handleDayClick,handleOnKeyDown:r.props.handleOnDayKeyDown,onDayMouseEnter:r.handleDayMouseEnter,onMouseLeave:r.handleMonthMouseLeave,onWeekSelect:r.props.onWeekSelect,orderInDisplay:o,formatWeekNumber:r.props.formatWeekNumber,locale:r.props.locale,minDate:r.props.minDate,maxDate:r.props.maxDate,excludeDates:r.props.excludeDates,excludeDateIntervals:r.props.excludeDateIntervals,highlightDates:r.props.highlightDates,holidays:r.props.holidays,selectingDate:r.state.selectingDate,includeDates:r.props.includeDates,includeDateIntervals:r.props.includeDateIntervals,inline:r.props.inline,shouldFocusDayInline:r.props.shouldFocusDayInline,fixedHeight:r.props.fixedHeight,filterDate:r.props.filterDate,preSelection:r.props.preSelection,setPreSelection:r.props.setPreSelection,selected:r.props.selected,selectsStart:r.props.selectsStart,selectsEnd:r.props.selectsEnd,selectsRange:r.props.selectsRange,selectsDisabledDaysInRange:r.props.selectsDisabledDaysInRange,showWeekNumbers:r.props.showWeekNumbers,startDate:r.props.startDate,endDate:r.props.endDate,peekNextMonth:r.props.peekNextMonth,setOpen:r.props.setOpen,shouldCloseOnSelect:r.props.shouldCloseOnSelect,renderDayContents:r.props.renderDayContents,renderMonthContent:r.props.renderMonthContent,renderQuarterContent:r.props.renderQuarterContent,renderYearContent:r.props.renderYearContent,disabledKeyboardNavigation:r.props.disabledKeyboardNavigation,showMonthYearPicker:r.props.showMonthYearPicker,showFullMonthYearPicker:r.props.showFullMonthYearPicker,showTwoColumnMonthYearPicker:r.props.showTwoColumnMonthYearPicker,showFourColumnMonthYearPicker:r.props.showFourColumnMonthYearPicker,showYearPicker:r.props.showYearPicker,showQuarterYearPicker:r.props.showQuarterYearPicker,showWeekPicker:r.props.showWeekPicker,isInputFocused:r.props.isInputFocused,containerRef:r.containerRef,monthShowsDuplicateDaysEnd:l,monthShowsDuplicateDaysStart:d})))}return t}})),St(It(r),"renderYears",(function(){if(!r.props.showTimeSelectOnly)return r.props.showYearPicker?de.default.createElement("div",{className:"react-datepicker__year--container"},r.renderHeader(),de.default.createElement(Qn,Ct({onDayClick:r.handleDayClick,selectingDate:r.state.selectingDate,clearSelectingDate:r.clearSelectingDate,date:r.state.date},r.props,{onYearMouseEnter:r.handleYearMouseEnter,onYearMouseLeave:r.handleYearMouseLeave}))):void 0})),St(It(r),"renderTimeSection",(function(){if(r.props.showTimeSelect&&(r.state.monthContainer||r.props.showTimeSelectOnly))return de.default.createElement(Xn,{selected:r.props.selected,openToDate:r.props.openToDate,onChange:r.props.onTimeChange,timeClassName:r.props.timeClassName,format:r.props.timeFormat,includeTimes:r.props.includeTimes,intervals:r.props.timeIntervals,minTime:r.props.minTime,maxTime:r.props.maxTime,excludeTimes:r.props.excludeTimes,filterTime:r.props.filterTime,timeCaption:r.props.timeCaption,todayButton:r.props.todayButton,showMonthDropdown:r.props.showMonthDropdown,showMonthYearDropdown:r.props.showMonthYearDropdown,showYearDropdown:r.props.showYearDropdown,withPortal:r.props.withPortal,monthRef:r.state.monthContainer,injectTimes:r.props.injectTimes,locale:r.props.locale,handleOnKeyDown:r.props.handleOnKeyDown,showTimeSelectOnly:r.props.showTimeSelectOnly})})),St(It(r),"renderInputTimeSection",(function(){var e=new Date(r.props.selected),t=Ut(e)&&Boolean(r.props.selected)?"".concat(Tn(e.getHours()),":").concat(Tn(e.getMinutes())):"";if(r.props.showTimeInput)return de.default.createElement(Jn,{date:e,timeString:t,timeInputLabel:r.props.timeInputLabel,onChange:r.props.onTimeChange,customTimeInput:r.props.customTimeInput})})),St(It(r),"renderAriaLiveRegion",(function(){var e,t=Rn(r.state.date,r.props.yearItemNumber),n=t.startPeriod,i=t.endPeriod;return e=r.props.showYearPicker?"".concat(n," - ").concat(i):r.props.showMonthYearPicker||r.props.showQuarterYearPicker?Pe.default(r.state.date):"".concat(nn(Le.default(r.state.date),r.props.locale)," ").concat(Pe.default(r.state.date)),de.default.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},r.state.isRenderAriaLiveMessage&&e)})),St(It(r),"renderChildren",(function(){if(r.props.children)return de.default.createElement("div",{className:"react-datepicker__children-container"},r.props.children)})),r.containerRef=de.default.createRef(),r.state={date:r.getDateInView(),selectingDate:null,monthContainer:null,isRenderAriaLiveMessage:!1},r}return Et(n,[{key:"componentDidMount",value:function(){var e=this;this.props.showTimeSelect&&(this.assignMonthContainer=void e.setState({monthContainer:e.monthContainer}))}},{key:"componentDidUpdate",value:function(e){var t=this;if(!this.props.preSelection||Jt(this.props.preSelection,e.preSelection)&&this.props.monthSelectedIn===e.monthSelectedIn)this.props.openToDate&&!Jt(this.props.openToDate,e.openToDate)&&this.setState({date:this.props.openToDate});else{var n=!Xt(this.state.date,this.props.preSelection);this.setState({date:this.props.preSelection},(function(){return n&&t.handleCustomMonthChange(t.state.date)}))}}},{key:"render",value:function(){var e=this.props.container||Zn;return de.default.createElement("div",{style:{display:"contents"},ref:this.containerRef},de.default.createElement(e,{className:fe.default("react-datepicker",this.props.className,{"react-datepicker--time-only":this.props.showTimeSelectOnly}),showPopperArrow:this.props.showPopperArrow,arrowProps:this.props.arrowProps},this.renderAriaLiveRegion(),this.renderPreviousButton(),this.renderNextButton(),this.renderMonths(),this.renderYears(),this.renderTodayButton(),this.renderTimeSection(),this.renderInputTimeSection(),this.renderChildren()))}}],[{key:"defaultProps",get:function(){return{onDropdownFocus:function(){},monthsShown:1,forceShowMonthNavigation:!1,timeCaption:"Time",previousYearButtonLabel:"Previous Year",nextYearButtonLabel:"Next Year",previousMonthButtonLabel:"Previous Month",nextMonthButtonLabel:"Next Month",customTimeInput:null,yearItemNumber:Pt}}}]),n}(de.default.Component),tr=function(e){var t=e.icon,n=e.className,r=void 0===n?"":n,i=e.onClick,a="react-datepicker__calendar-icon";return de.default.isValidElement(t)?de.default.cloneElement(t,{className:"".concat(t.props.className||""," ").concat(a," ").concat(r),onClick:function(e){"function"==typeof t.props.onClick&&t.props.onClick(e),"function"==typeof i&&i(e)}}):"string"==typeof t?de.default.createElement("i",{className:"".concat(a," ").concat(t," ").concat(r),"aria-hidden":"true",onClick:i}):de.default.createElement("svg",{className:"".concat(a," ").concat(r),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",onClick:i},de.default.createElement("path",{d:"M96 32V64H48C21.5 64 0 85.5 0 112v48H448V112c0-26.5-21.5-48-48-48H352V32c0-17.7-14.3-32-32-32s-32 14.3-32 32V64H160V32c0-17.7-14.3-32-32-32S96 14.3 96 32zM448 192H0V464c0 26.5 21.5 48 48 48H400c26.5 0 48-21.5 48-48V192z"}))},nr=function(e){xt(n,e);var t=Nt(n);function n(e){var r;return _t(this,n),(r=t.call(this,e)).el=document.createElement("div"),r}return Et(n,[{key:"componentDidMount",value:function(){this.portalRoot=(this.props.portalHost||document).getElementById(this.props.portalId),this.portalRoot||(this.portalRoot=document.createElement("div"),this.portalRoot.setAttribute("id",this.props.portalId),(this.props.portalHost||document.body).appendChild(this.portalRoot)),this.portalRoot.appendChild(this.el)}},{key:"componentWillUnmount",value:function(){this.portalRoot.removeChild(this.el)}},{key:"render",value:function(){return mt.default.createPortal(this.props.children,this.el)}}]),n}(de.default.Component),rr=function(e){return!e.disabled&&-1!==e.tabIndex},ir=function(e){xt(n,e);var t=Nt(n);function n(e){var r;return _t(this,n),St(It(r=t.call(this,e)),"getTabChildren",(function(){return Array.prototype.slice.call(r.tabLoopRef.current.querySelectorAll("[tabindex], a, button, input, select, textarea"),1,-1).filter(rr)})),St(It(r),"handleFocusStart",(function(){var e=r.getTabChildren();e&&e.length>1&&e[e.length-1].focus()})),St(It(r),"handleFocusEnd",(function(){var e=r.getTabChildren();e&&e.length>1&&e[0].focus()})),r.tabLoopRef=de.default.createRef(),r}return Et(n,[{key:"render",value:function(){return this.props.enableTabLoop?de.default.createElement("div",{className:"react-datepicker__tab-loop",ref:this.tabLoopRef},de.default.createElement("div",{className:"react-datepicker__tab-loop__start",tabIndex:"0",onFocus:this.handleFocusStart}),this.props.children,de.default.createElement("div",{className:"react-datepicker__tab-loop__end",tabIndex:"0",onFocus:this.handleFocusEnd})):this.props.children}}],[{key:"defaultProps",get:function(){return{enableTabLoop:!0}}}]),n}(de.default.Component),ar=function(e){xt(n,e);var t=Nt(n);function n(){return _t(this,n),t.apply(this,arguments)}return Et(n,[{key:"render",value:function(){var e,t=this.props,n=t.className,r=t.wrapperClassName,i=t.hidePopper,a=t.popperComponent,o=t.popperModifiers,s=t.popperPlacement,c=t.popperProps,u=t.targetComponent,l=t.enableTabLoop,d=t.popperOnKeyDown,f=t.portalId,h=t.portalHost;if(!i){var p=fe.default("react-datepicker-popper",n);e=de.default.createElement(ce.Popper,Ct({modifiers:o,placement:s},c),(function(e){var t=e.ref,n=e.style,r=e.placement,i=e.arrowProps;return de.default.createElement(ir,{enableTabLoop:l},de.default.createElement("div",{ref:t,style:n,className:p,"data-placement":r,onKeyDown:d},de.default.cloneElement(a,{arrowProps:i})))}))}this.props.popperContainer&&(e=de.default.createElement(this.props.popperContainer,{},e)),f&&!i&&(e=de.default.createElement(nr,{portalId:f,portalHost:h},e));var m=fe.default("react-datepicker-wrapper",r);return de.default.createElement(ce.Manager,{className:"react-datepicker-manager"},de.default.createElement(ce.Reference,null,(function(e){var t=e.ref;return de.default.createElement("div",{ref:t,className:m},u)})),e)}}],[{key:"defaultProps",get:function(){return{hidePopper:!0,popperModifiers:[],popperProps:{},popperPlacement:"bottom-start"}}}]),n}(de.default.Component),or="react-datepicker-ignore-onclickoutside",sr=pt.default(er),cr="Date input not valid.",ur=function(e){xt(n,e);var t=Nt(n);function n(e){var r;return _t(this,n),St(It(r=t.call(this,e)),"getPreSelection",(function(){return r.props.openToDate?r.props.openToDate:r.props.selectsEnd&&r.props.startDate?r.props.startDate:r.props.selectsStart&&r.props.endDate?r.props.endDate:Ft()})),St(It(r),"modifyHolidays",(function(){var e;return null===(e=r.props.holidays)||void 0===e?void 0:e.reduce((function(e,t){var n=new Date(t.date);return pe.default(n)?[].concat(At(e),[yt(yt({},t),{},{date:n})]):e}),[])})),St(It(r),"calcInitialState",(function(){var e,t=r.getPreSelection(),n=wn(r.props),i=En(r.props),a=n&&ut.default(t,Xe.default(n))?n:i&&ct.default(t,et.default(i))?i:t;return{open:r.props.startOpen||!1,preventFocus:!1,preSelection:null!==(e=r.props.selectsRange?r.props.startDate:r.props.selected)&&void 0!==e?e:a,highlightDates:Sn(r.props.highlightDates),focused:!1,shouldFocusDayInline:!1,isRenderAriaLiveMessage:!1}})),St(It(r),"clearPreventFocusTimeout",(function(){r.preventFocusTimeout&&clearTimeout(r.preventFocusTimeout)})),St(It(r),"setFocus",(function(){r.input&&r.input.focus&&r.input.focus({preventScroll:!0})})),St(It(r),"setBlur",(function(){r.input&&r.input.blur&&r.input.blur(),r.cancelFocusInput()})),St(It(r),"setOpen",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r.setState({open:e,preSelection:e&&r.state.open?r.state.preSelection:r.calcInitialState().preSelection,lastPreSelectChange:dr},(function(){e||r.setState((function(e){return{focused:!!t&&e.focused}}),(function(){!t&&r.setBlur(),r.setState({inputValue:null})}))}))})),St(It(r),"inputOk",(function(){return he.default(r.state.preSelection)})),St(It(r),"isCalendarOpen",(function(){return void 0===r.props.open?r.state.open&&!r.props.disabled&&!r.props.readOnly:r.props.open})),St(It(r),"handleFocus",(function(e){r.state.preventFocus||(r.props.onFocus(e),r.props.preventOpenOnFocus||r.props.readOnly||r.setOpen(!0)),r.setState({focused:!0})})),St(It(r),"sendFocusBackToInput",(function(){r.preventFocusTimeout&&r.clearPreventFocusTimeout(),r.setState({preventFocus:!0},(function(){r.preventFocusTimeout=setTimeout((function(){r.setFocus(),r.setState({preventFocus:!1})}))}))})),St(It(r),"cancelFocusInput",(function(){clearTimeout(r.inputFocusTimeout),r.inputFocusTimeout=null})),St(It(r),"deferFocusInput",(function(){r.cancelFocusInput(),r.inputFocusTimeout=setTimeout((function(){return r.setFocus()}),1)})),St(It(r),"handleDropdownFocus",(function(){r.cancelFocusInput()})),St(It(r),"handleBlur",(function(e){(!r.state.open||r.props.withPortal||r.props.showTimeInput)&&r.props.onBlur(e),r.setState({focused:!1})})),St(It(r),"handleCalendarClickOutside",(function(e){r.props.inline||r.setOpen(!1),r.props.onClickOutside(e),r.props.withPortal&&e.preventDefault()})),St(It(r),"handleChange",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];if(!r.props.onChangeRaw||(r.props.onChangeRaw.apply(It(r),t),"function"==typeof i.isDefaultPrevented&&!i.isDefaultPrevented())){r.setState({inputValue:i.target.value,lastPreSelectChange:lr});var a,o,s,c,u,l,d,f,h=(a=i.target.value,o=r.props.dateFormat,s=r.props.locale,c=r.props.strictParsing,u=r.props.minDate,l=null,d=tn(s)||tn(en()),f=!0,Array.isArray(o)?(o.forEach((function(e){var t=ft.default(a,e,new Date,{locale:d});c&&(f=Ut(t,u)&&a===Bt(t,e,s)),Ut(t,u)&&f&&(l=t)})),l):(l=ft.default(a,o,new Date,{locale:d}),c?f=Ut(l)&&a===Bt(l,o,s):Ut(l)||(o=o.match(jt).map((function(e){var t=e[0];return"p"===t||"P"===t?d?(0,Ot[t])(e,d.formatLong):t:e})).join(""),a.length>0&&(l=ft.default(a,o.slice(0,a.length),new Date)),Ut(l)||(l=new Date(a))),Ut(l)&&f?l:null));r.props.showTimeSelectOnly&&r.props.selected&&h&&!Jt(h,r.props.selected)&&(h=gt.default(r.props.selected,{hours:Ae.default(h),minutes:Ne.default(h),seconds:Ie.default(h)})),!h&&i.target.value||(r.props.showWeekPicker&&(h=Wt(h,r.props.locale,r.props.calendarStartDay)),r.setSelected(h,i,!0))}})),St(It(r),"handleSelect",(function(e,t,n){if(r.props.shouldCloseOnSelect&&!r.props.showTimeSelect&&r.sendFocusBackToInput(),r.props.onChangeRaw&&r.props.onChangeRaw(t),r.props.showWeekPicker&&(e=Wt(e,r.props.locale,r.props.calendarStartDay)),r.setSelected(e,t,!1,n),r.props.showDateSelect&&r.setState({isRenderAriaLiveMessage:!0}),!r.props.shouldCloseOnSelect||r.props.showTimeSelect)r.setPreSelection(e);else if(!r.props.inline){r.props.selectsRange||r.setOpen(!1);var i=r.props,a=i.startDate,o=i.endDate;!a||o||ut.default(e,a)||r.setOpen(!1)}})),St(It(r),"setSelected",(function(e,t,n,i){var a=e;if(r.props.showYearPicker){if(null!==a&&dn(Pe.default(a),r.props))return}else if(r.props.showMonthYearPicker){if(null!==a&&sn(a,r.props))return}else if(null!==a&&an(a,r.props))return;var o=r.props,s=o.onChange,c=o.selectsRange,u=o.startDate,l=o.endDate;if(!Zt(r.props.selected,a)||r.props.allowSameDay||c)if(null!==a&&(!r.props.selected||n&&(r.props.showTimeSelect||r.props.showTimeSelectOnly||r.props.showTimeInput)||(a=zt(a,{hour:Ae.default(r.props.selected),minute:Ne.default(r.props.selected),second:Ie.default(r.props.selected)})),r.props.inline||r.setState({preSelection:a}),r.props.focusSelectedMonth||r.setState({monthSelectedIn:i})),c){var d=u&&l;u||l?u&&!l&&(ut.default(a,u)?s([a,null],t):s([u,a],t)):s([a,null],t),d&&s([a,null],t)}else s(a,t);n||(r.props.onSelect(a,t),r.setState({inputValue:null}))})),St(It(r),"setPreSelection",(function(e){var t=void 0!==r.props.minDate,n=void 0!==r.props.maxDate,i=!0;if(e){r.props.showWeekPicker&&(e=Wt(e,r.props.locale,r.props.calendarStartDay));var a=Xe.default(e);if(t&&n)i=$t(e,r.props.minDate,r.props.maxDate);else if(t){var o=Xe.default(r.props.minDate);i=ct.default(e,o)||Zt(a,o)}else if(n){var s=et.default(r.props.maxDate);i=ut.default(e,s)||Zt(a,s)}}i&&r.setState({preSelection:e})})),St(It(r),"toggleCalendar",(function(){r.setOpen(!r.state.open)})),St(It(r),"handleTimeChange",(function(e){var t=r.props.selected?r.props.selected:r.getPreSelection(),n=r.props.selected?e:zt(t,{hour:Ae.default(e),minute:Ne.default(e)});r.setState({preSelection:n}),r.props.onChange(n),r.props.shouldCloseOnSelect&&(r.sendFocusBackToInput(),r.setOpen(!1)),r.props.showTimeInput&&r.setOpen(!0),(r.props.showTimeSelectOnly||r.props.showTimeSelect)&&r.setState({isRenderAriaLiveMessage:!0}),r.setState({inputValue:null})})),St(It(r),"onInputClick",(function(){r.props.disabled||r.props.readOnly||r.setOpen(!0),r.props.onInputClick()})),St(It(r),"onInputKeyDown",(function(e){r.props.onKeyDown(e);var t=e.key;if(r.state.open||r.props.inline||r.props.preventOpenOnFocus){if(r.state.open){if("ArrowDown"===t||"ArrowUp"===t){e.preventDefault();var n=r.props.showWeekPicker&&r.props.showWeekNumbers?'.react-datepicker__week-number[tabindex="0"]':'.react-datepicker__day[tabindex="0"]',i=r.calendar.componentNode&&r.calendar.componentNode.querySelector(n);return void(i&&i.focus({preventScroll:!0}))}var a=Ft(r.state.preSelection);"Enter"===t?(e.preventDefault(),r.inputOk()&&r.state.lastPreSelectChange===dr?(r.handleSelect(a,e),!r.props.shouldCloseOnSelect&&r.setPreSelection(a)):r.setOpen(!1)):"Escape"===t?(e.preventDefault(),r.sendFocusBackToInput(),r.setOpen(!1)):"Tab"===t&&r.setOpen(!1),r.inputOk()||r.props.onInputError({code:1,msg:cr})}}else"ArrowDown"!==t&&"ArrowUp"!==t&&"Enter"!==t||r.onInputClick()})),St(It(r),"onPortalKeyDown",(function(e){"Escape"===e.key&&(e.preventDefault(),r.setState({preventFocus:!0},(function(){r.setOpen(!1),setTimeout((function(){r.setFocus(),r.setState({preventFocus:!1})}))})))})),St(It(r),"onDayKeyDown",(function(e){r.props.onKeyDown(e);var t=e.key,n=Ft(r.state.preSelection);if("Enter"===t)e.preventDefault(),r.handleSelect(n,e),!r.props.shouldCloseOnSelect&&r.setPreSelection(n);else if("Escape"===t)e.preventDefault(),r.setOpen(!1),r.inputOk()||r.props.onInputError({code:1,msg:cr});else if(!r.props.disabledKeyboardNavigation){var i;switch(t){case"ArrowLeft":i=r.props.showWeekPicker?Ce.default(n,1):Se.default(n,1);break;case"ArrowRight":i=r.props.showWeekPicker?be.default(n,1):ye.default(n,1);break;case"ArrowUp":i=Ce.default(n,1);break;case"ArrowDown":i=be.default(n,1);break;case"PageUp":i=xe.default(n,1);break;case"PageDown":i=_e.default(n,1);break;case"Home":i=Re.default(n,1);break;case"End":i=Ee.default(n,1);break;default:i=null}if(!i)return void(r.props.onInputError&&r.props.onInputError({code:1,msg:cr}));if(e.preventDefault(),r.setState({lastPreSelectChange:dr}),r.props.adjustDateOnChange&&r.setSelected(i),r.setPreSelection(i),r.props.inline){var a=Le.default(n),o=Le.default(i),s=Pe.default(n),c=Pe.default(i);a!==o||s!==c?r.setState({shouldFocusDayInline:!0}):r.setState({shouldFocusDayInline:!1})}}})),St(It(r),"onPopperKeyDown",(function(e){"Escape"===e.key&&(e.preventDefault(),r.sendFocusBackToInput())})),St(It(r),"onClearClick",(function(e){e&&e.preventDefault&&e.preventDefault(),r.sendFocusBackToInput(),r.props.selectsRange?r.props.onChange([null,null],e):r.props.onChange(null,e),r.setState({inputValue:null})})),St(It(r),"clear",(function(){r.onClearClick()})),St(It(r),"onScroll",(function(e){"boolean"==typeof r.props.closeOnScroll&&r.props.closeOnScroll?e.target!==document&&e.target!==document.documentElement&&e.target!==document.body||r.setOpen(!1):"function"==typeof r.props.closeOnScroll&&r.props.closeOnScroll(e)&&r.setOpen(!1)})),St(It(r),"renderCalendar",(function(){return r.props.inline||r.isCalendarOpen()?de.default.createElement(sr,{ref:function(e){r.calendar=e},locale:r.props.locale,calendarStartDay:r.props.calendarStartDay,chooseDayAriaLabelPrefix:r.props.chooseDayAriaLabelPrefix,disabledDayAriaLabelPrefix:r.props.disabledDayAriaLabelPrefix,weekAriaLabelPrefix:r.props.weekAriaLabelPrefix,monthAriaLabelPrefix:r.props.monthAriaLabelPrefix,adjustDateOnChange:r.props.adjustDateOnChange,setOpen:r.setOpen,shouldCloseOnSelect:r.props.shouldCloseOnSelect,dateFormat:r.props.dateFormatCalendar,useWeekdaysShort:r.props.useWeekdaysShort,formatWeekDay:r.props.formatWeekDay,dropdownMode:r.props.dropdownMode,selected:r.props.selected,preSelection:r.state.preSelection,onSelect:r.handleSelect,onWeekSelect:r.props.onWeekSelect,openToDate:r.props.openToDate,minDate:r.props.minDate,maxDate:r.props.maxDate,selectsStart:r.props.selectsStart,selectsEnd:r.props.selectsEnd,selectsRange:r.props.selectsRange,startDate:r.props.startDate,endDate:r.props.endDate,excludeDates:r.props.excludeDates,excludeDateIntervals:r.props.excludeDateIntervals,filterDate:r.props.filterDate,onClickOutside:r.handleCalendarClickOutside,formatWeekNumber:r.props.formatWeekNumber,highlightDates:r.state.highlightDates,holidays:Cn(r.modifyHolidays()),includeDates:r.props.includeDates,includeDateIntervals:r.props.includeDateIntervals,includeTimes:r.props.includeTimes,injectTimes:r.props.injectTimes,inline:r.props.inline,shouldFocusDayInline:r.state.shouldFocusDayInline,peekNextMonth:r.props.peekNextMonth,showMonthDropdown:r.props.showMonthDropdown,showPreviousMonths:r.props.showPreviousMonths,useShortMonthInDropdown:r.props.useShortMonthInDropdown,showMonthYearDropdown:r.props.showMonthYearDropdown,showWeekNumbers:r.props.showWeekNumbers,showYearDropdown:r.props.showYearDropdown,withPortal:r.props.withPortal,forceShowMonthNavigation:r.props.forceShowMonthNavigation,showDisabledMonthNavigation:r.props.showDisabledMonthNavigation,scrollableYearDropdown:r.props.scrollableYearDropdown,scrollableMonthYearDropdown:r.props.scrollableMonthYearDropdown,todayButton:r.props.todayButton,weekLabel:r.props.weekLabel,outsideClickIgnoreClass:or,fixedHeight:r.props.fixedHeight,monthsShown:r.props.monthsShown,monthSelectedIn:r.state.monthSelectedIn,onDropdownFocus:r.handleDropdownFocus,onMonthChange:r.props.onMonthChange,onYearChange:r.props.onYearChange,dayClassName:r.props.dayClassName,weekDayClassName:r.props.weekDayClassName,monthClassName:r.props.monthClassName,timeClassName:r.props.timeClassName,showDateSelect:r.props.showDateSelect,showTimeSelect:r.props.showTimeSelect,showTimeSelectOnly:r.props.showTimeSelectOnly,onTimeChange:r.handleTimeChange,timeFormat:r.props.timeFormat,timeIntervals:r.props.timeIntervals,minTime:r.props.minTime,maxTime:r.props.maxTime,excludeTimes:r.props.excludeTimes,filterTime:r.props.filterTime,timeCaption:r.props.timeCaption,className:r.props.calendarClassName,container:r.props.calendarContainer,yearItemNumber:r.props.yearItemNumber,yearDropdownItemNumber:r.props.yearDropdownItemNumber,previousMonthAriaLabel:r.props.previousMonthAriaLabel,previousMonthButtonLabel:r.props.previousMonthButtonLabel,nextMonthAriaLabel:r.props.nextMonthAriaLabel,nextMonthButtonLabel:r.props.nextMonthButtonLabel,previousYearAriaLabel:r.props.previousYearAriaLabel,previousYearButtonLabel:r.props.previousYearButtonLabel,nextYearAriaLabel:r.props.nextYearAriaLabel,nextYearButtonLabel:r.props.nextYearButtonLabel,timeInputLabel:r.props.timeInputLabel,disabledKeyboardNavigation:r.props.disabledKeyboardNavigation,renderCustomHeader:r.props.renderCustomHeader,popperProps:r.props.popperProps,renderDayContents:r.props.renderDayContents,renderMonthContent:r.props.renderMonthContent,renderQuarterContent:r.props.renderQuarterContent,renderYearContent:r.props.renderYearContent,onDayMouseEnter:r.props.onDayMouseEnter,onMonthMouseLeave:r.props.onMonthMouseLeave,onYearMouseEnter:r.props.onYearMouseEnter,onYearMouseLeave:r.props.onYearMouseLeave,selectsDisabledDaysInRange:r.props.selectsDisabledDaysInRange,showTimeInput:r.props.showTimeInput,showMonthYearPicker:r.props.showMonthYearPicker,showFullMonthYearPicker:r.props.showFullMonthYearPicker,showTwoColumnMonthYearPicker:r.props.showTwoColumnMonthYearPicker,showFourColumnMonthYearPicker:r.props.showFourColumnMonthYearPicker,showYearPicker:r.props.showYearPicker,showQuarterYearPicker:r.props.showQuarterYearPicker,showWeekPicker:r.props.showWeekPicker,showPopperArrow:r.props.showPopperArrow,excludeScrollbar:r.props.excludeScrollbar,handleOnKeyDown:r.props.onKeyDown,handleOnDayKeyDown:r.onDayKeyDown,isInputFocused:r.state.focused,customTimeInput:r.props.customTimeInput,setPreSelection:r.setPreSelection},r.props.children):null})),St(It(r),"renderAriaLiveRegion",(function(){var e,t=r.props,n=t.dateFormat,i=t.locale,a=r.props.showTimeInput||r.props.showTimeSelect?"PPPPp":"PPPP";return e=r.props.selectsRange?"Selected start date: ".concat(Vt(r.props.startDate,{dateFormat:a,locale:i}),". ").concat(r.props.endDate?"End date: "+Vt(r.props.endDate,{dateFormat:a,locale:i}):""):r.props.showTimeSelectOnly?"Selected time: ".concat(Vt(r.props.selected,{dateFormat:n,locale:i})):r.props.showYearPicker?"Selected year: ".concat(Vt(r.props.selected,{dateFormat:"yyyy",locale:i})):r.props.showMonthYearPicker?"Selected month: ".concat(Vt(r.props.selected,{dateFormat:"MMMM yyyy",locale:i})):r.props.showQuarterYearPicker?"Selected quarter: ".concat(Vt(r.props.selected,{dateFormat:"yyyy, QQQ",locale:i})):"Selected date: ".concat(Vt(r.props.selected,{dateFormat:a,locale:i})),de.default.createElement("span",{role:"alert","aria-live":"polite",className:"react-datepicker__aria-live"},e)})),St(It(r),"renderDateInput",(function(){var e,t=fe.default(r.props.className,St({},or,r.state.open)),n=r.props.customInput||de.default.createElement("input",{type:"text"}),i=r.props.customInputRef||"ref",a="string"==typeof r.props.value?r.props.value:"string"==typeof r.state.inputValue?r.state.inputValue:r.props.selectsRange?function(e,t,n){if(!e)return"";var r=Vt(e,n),i=t?Vt(t,n):"";return"".concat(r," - ").concat(i)}(r.props.startDate,r.props.endDate,r.props):Vt(r.props.selected,r.props);return de.default.cloneElement(n,(St(St(St(St(St(St(St(St(St(St(e={},i,(function(e){r.input=e})),"value",a),"onBlur",r.handleBlur),"onChange",r.handleChange),"onClick",r.onInputClick),"onFocus",r.handleFocus),"onKeyDown",r.onInputKeyDown),"id",r.props.id),"name",r.props.name),"form",r.props.form),St(St(St(St(St(St(St(St(St(St(e,"autoFocus",r.props.autoFocus),"placeholder",r.props.placeholderText),"disabled",r.props.disabled),"autoComplete",r.props.autoComplete),"className",fe.default(n.props.className,t)),"title",r.props.title),"readOnly",r.props.readOnly),"required",r.props.required),"tabIndex",r.props.tabIndex),"aria-describedby",r.props.ariaDescribedBy),St(St(St(e,"aria-invalid",r.props.ariaInvalid),"aria-labelledby",r.props.ariaLabelledBy),"aria-required",r.props.ariaRequired)))})),St(It(r),"renderClearButton",(function(){var e=r.props,t=e.isClearable,n=e.disabled,i=e.selected,a=e.startDate,o=e.endDate,s=e.clearButtonTitle,c=e.clearButtonClassName,u=void 0===c?"":c,l=e.ariaLabelClose,d=void 0===l?"Close":l;return!t||null==i&&null==a&&null==o?null:de.default.createElement("button",{type:"button",className:fe.default("react-datepicker__close-icon",u,{"react-datepicker__close-icon--disabled":n}),disabled:n,"aria-label":d,onClick:r.onClearClick,title:s,tabIndex:-1})})),r.state=r.calcInitialState(),r.preventFocusTimeout=null,r}return Et(n,[{key:"componentDidMount",value:function(){window.addEventListener("scroll",this.onScroll,!0)}},{key:"componentDidUpdate",value:function(e,t){var n,r;e.inline&&(n=e.selected,r=this.props.selected,n&&r?Le.default(n)!==Le.default(r)||Pe.default(n)!==Pe.default(r):n!==r)&&this.setPreSelection(this.props.selected),void 0!==this.state.monthSelectedIn&&e.monthsShown!==this.props.monthsShown&&this.setState({monthSelectedIn:0}),e.highlightDates!==this.props.highlightDates&&this.setState({highlightDates:Sn(this.props.highlightDates)}),t.focused||Zt(e.selected,this.props.selected)||this.setState({inputValue:null}),t.open!==this.state.open&&(!1===t.open&&!0===this.state.open&&this.props.onCalendarOpen(),!0===t.open&&!1===this.state.open&&this.props.onCalendarClose())}},{key:"componentWillUnmount",value:function(){this.clearPreventFocusTimeout(),window.removeEventListener("scroll",this.onScroll,!0)}},{key:"renderInputContainer",value:function(){var e=this.props,t=e.showIcon,n=e.icon,r=e.calendarIconClassname,i=e.toggleCalendarOnIconClick,a=this.state.open;return de.default.createElement("div",{className:"react-datepicker__input-container".concat(t?" react-datepicker__view-calendar-icon":"")},t&&de.default.createElement(tr,Ct({icon:n,className:"".concat(r," ").concat(a&&"react-datepicker-ignore-onclickoutside")},i?{onClick:this.toggleCalendar}:null)),this.state.isRenderAriaLiveMessage&&this.renderAriaLiveRegion(),this.renderDateInput(),this.renderClearButton())}},{key:"render",value:function(){var e=this.renderCalendar();if(this.props.inline)return e;if(this.props.withPortal){var t=this.state.open?de.default.createElement(ir,{enableTabLoop:this.props.enableTabLoop},de.default.createElement("div",{className:"react-datepicker__portal",tabIndex:-1,onKeyDown:this.onPortalKeyDown},e)):null;return this.state.open&&this.props.portalId&&(t=de.default.createElement(nr,{portalId:this.props.portalId,portalHost:this.props.portalHost},t)),de.default.createElement("div",null,this.renderInputContainer(),t)}return de.default.createElement(ar,{className:this.props.popperClassName,wrapperClassName:this.props.wrapperClassName,hidePopper:!this.isCalendarOpen(),portalId:this.props.portalId,portalHost:this.props.portalHost,popperModifiers:this.props.popperModifiers,targetComponent:this.renderInputContainer(),popperContainer:this.props.popperContainer,popperComponent:e,popperPlacement:this.props.popperPlacement,popperProps:this.props.popperProps,popperOnKeyDown:this.onPopperKeyDown,enableTabLoop:this.props.enableTabLoop})}}],[{key:"defaultProps",get:function(){return{allowSameDay:!1,dateFormat:"MM/dd/yyyy",dateFormatCalendar:"LLLL yyyy",onChange:function(){},disabled:!1,disabledKeyboardNavigation:!1,dropdownMode:"scroll",onFocus:function(){},onBlur:function(){},onKeyDown:function(){},onInputClick:function(){},onSelect:function(){},onClickOutside:function(){},onMonthChange:function(){},onCalendarOpen:function(){},onCalendarClose:function(){},preventOpenOnFocus:!1,onYearChange:function(){},onInputError:function(){},monthsShown:1,readOnly:!1,withPortal:!1,selectsDisabledDaysInRange:!1,shouldCloseOnSelect:!0,showTimeSelect:!1,showTimeInput:!1,showPreviousMonths:!1,showMonthYearPicker:!1,showFullMonthYearPicker:!1,showTwoColumnMonthYearPicker:!1,showFourColumnMonthYearPicker:!1,showYearPicker:!1,showQuarterYearPicker:!1,showWeekPicker:!1,strictParsing:!1,timeIntervals:30,timeCaption:"Time",previousMonthAriaLabel:"Previous Month",previousMonthButtonLabel:"Previous Month",nextMonthAriaLabel:"Next Month",nextMonthButtonLabel:"Next Month",previousYearAriaLabel:"Previous Year",previousYearButtonLabel:"Previous Year",nextYearAriaLabel:"Next Year",nextYearButtonLabel:"Next Year",timeInputLabel:"Time",enableTabLoop:!0,yearItemNumber:Pt,focusSelectedMonth:!1,showPopperArrow:!0,excludeScrollbar:!0,customTimeInput:null,calendarStartDay:void 0,toggleCalendarOnIconClick:!1}}}]),n}(de.default.Component),lr="input",dr="navigate";e.CalendarContainer=Zn,e.default=ur,e.getDefaultLocale=en,e.registerLocale=function(e,t){var n="undefined"!=typeof window?window:globalThis;n.__localeData__||(n.__localeData__={}),n.__localeData__[e]=t},e.setDefaultLocale=function(e){("undefined"!=typeof window?window:globalThis).__localeId__=e},Object.defineProperty(e,"__esModule",{value:!0})}(t,n(5043),n(5173),n(8139),n(9713),n(97),n(4860),n(9333),n(7487),n(5027),n(6265),n(2215),n(6337),n(8926),n(486),n(1806),n(5622),n(9436),n(8885),n(6340),n(7124),n(3306),n(743),n(9855),n(216),n(1551),n(1845),n(4974),n(8170),n(776),n(9952),n(7566),n(8224),n(8673),n(9730),n(9563),n(4489),n(9352),n(2672),n(7815),n(2312),n(618),n(7660),n(9566),n(3035),n(1251),n(2039),n(147),n(802),n(3515),n(1315),n(8643),n(6194),n(4561),n(9977),n(3274),n(2763),n(888),n(1794),n(4161),n(2547),n(7950),n(7099),n(2431))},2039:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n(8171),i=n(888),a=n(6191),o=n(8726);function s(e,t){var n,s,c,u,l,d,f,h;(0,o.A)(1,arguments);var p=(0,r.q)(),m=(0,a.A)(null!==(n=null!==(s=null!==(c=null!==(u=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==u?u:null===t||void 0===t||null===(l=t.locale)||void 0===l||null===(d=l.options)||void 0===d?void 0:d.weekStartsOn)&&void 0!==c?c:p.weekStartsOn)&&void 0!==s?s:null===(f=p.locale)||void 0===f||null===(h=f.options)||void 0===h?void 0:h.weekStartsOn)&&void 0!==n?n:0);if(!(m>=0&&m<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=(0,i.default)(e),v=g.getDay(),y=6+(v<m?-7:0)-(v-m);return g.setDate(g.getDate()+y),g.setHours(23,59,59,999),g}},2058:(e,t,n)=>{"use strict";n.d(t,{ef:()=>a,lJ:()=>s,xM:()=>o});var r=["D","DD"],i=["YY","YYYY"];function a(e){return-1!==r.indexOf(e)}function o(e){return-1!==i.indexOf(e)}function s(e,t,n){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}},2206:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,a.default)(e);if(!n.length)return void t.preventDefault();var r=void 0,i=t.shiftKey,s=n[0],c=n[n.length-1],u=o();if(e===u){if(!i)return;r=c}c!==u||i||(r=s);s===u&&i&&(r=c);if(r)return t.preventDefault(),void r.focus();var l=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent);if(null==l||"Chrome"==l[1]||null!=/\biPod\b|\biPad\b/g.exec(navigator.userAgent))return;var d=n.indexOf(u);d>-1&&(d+=i?-1:1);if("undefined"===typeof(r=n[d]))return t.preventDefault(),void(r=i?c:s).focus();t.preventDefault(),r.focus()};var r,i=n(4682),a=(r=i)&&r.__esModule?r:{default:r};function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return e.activeElement.shadowRoot?o(e.activeElement.shadowRoot):e.activeElement}e.exports=t.default},2215:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(888),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,i.default)(e),o=(0,r.A)(t);if(isNaN(o))return new Date(NaN);if(!o)return n;var s=n.getDate(),c=new Date(n.getTime());return c.setMonth(n.getMonth()+o+1,0),s>=c.getDate()?c:(n.setFullYear(c.getFullYear(),c.getMonth(),s),n)}},2284:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},2285:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"===typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var s,c=[],u=!1,l=-1;function d(){u&&s&&(u=!1,s.length?c=s.concat(c):l=-1,c.length&&f())}function f(){if(!u){var e=o(d);u=!0;for(var t=c.length;t;){for(s=c,c=[];++l<t;)s&&s[l].run();l=-1,t=c.length}s=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||u||o(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},2312:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){(0,i.A)(1,arguments);var t=(0,r.default)(e);return t.setHours(0,0,0,0),t}},2330:(e,t,n)=>{"use strict";var r=n(5043);var i="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},a=r.useState,o=r.useEffect,s=r.useLayoutEffect,c=r.useDebugValue;function u(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(r){return!0}}var l="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=a({inst:{value:n,getSnapshot:t}}),i=r[0].inst,l=r[1];return s((function(){i.value=n,i.getSnapshot=t,u(i)&&l({inst:i})}),[e,n,t]),o((function(){return u(i)&&l({inst:i}),e((function(){u(i)&&l({inst:i})}))}),[e]),c(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:l},2431:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n(2284),i=n(888),a=n(8224),o=n(6191),s=n(8726);function c(e,t){if((0,s.A)(2,arguments),"object"!==(0,r.A)(t)||null===t)throw new RangeError("values parameter must be an object");var n=(0,i.default)(e);return isNaN(n.getTime())?new Date(NaN):(null!=t.year&&n.setFullYear(t.year),null!=t.month&&(n=(0,a.default)(n,t.month)),null!=t.date&&n.setDate((0,o.A)(t.date)),null!=t.hours&&n.setHours((0,o.A)(t.hours)),null!=t.minutes&&n.setMinutes((0,o.A)(t.minutes)),null!=t.seconds&&n.setSeconds((0,o.A)(t.seconds)),null!=t.milliseconds&&n.setMilliseconds((0,o.A)(t.milliseconds)),n)}},2547:(e,t,n)=>{"use strict";n.r(t),n.d(t,{IGNORE_CLASS_NAME:()=>p,default:()=>g});var r=n(5043),i=n(7950);function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,n){return e===t||(e.correspondingElement?e.correspondingElement.classList.contains(n):e.classList.contains(n))}var c,u,l=(void 0===c&&(c=0),function(){return++c}),d={},f={},h=["touchstart","touchmove"],p="ignore-react-onclickoutside";function m(e,t){var n={};return-1!==h.indexOf(t)&&u&&(n.passive=!e.props.preventDefault),n}const g=function(e,t){var n,c,h=e.displayName||e.name||"Component";return c=n=function(n){var c,p;function g(e){var r;return(r=n.call(this,e)||this).__outsideClickHandler=function(e){if("function"!==typeof r.__clickOutsideHandlerProp){var t=r.getInstance();if("function"!==typeof t.props.handleClickOutside){if("function"!==typeof t.handleClickOutside)throw new Error("WrappedComponent: "+h+" lacks a handleClickOutside(event) function for processing outside click events.");t.handleClickOutside(e)}else t.props.handleClickOutside(e)}else r.__clickOutsideHandlerProp(e)},r.__getComponentNode=function(){var e=r.getInstance();return t&&"function"===typeof t.setClickOutsideRef?t.setClickOutsideRef()(e):"function"===typeof e.setClickOutsideRef?e.setClickOutsideRef():(0,i.findDOMNode)(e)},r.enableOnClickOutside=function(){if("undefined"!==typeof document&&!f[r._uid]){"undefined"===typeof u&&(u=function(){if("undefined"!==typeof window&&"function"===typeof window.addEventListener){var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}}),n=function(){};return window.addEventListener("testPassiveEventSupport",n,t),window.removeEventListener("testPassiveEventSupport",n,t),e}}()),f[r._uid]=!0;var e=r.props.eventTypes;e.forEach||(e=[e]),d[r._uid]=function(e){var t;null!==r.componentNode&&(r.initTimeStamp>e.timeStamp||(r.props.preventDefault&&e.preventDefault(),r.props.stopPropagation&&e.stopPropagation(),r.props.excludeScrollbar&&(t=e,document.documentElement.clientWidth<=t.clientX||document.documentElement.clientHeight<=t.clientY)||function(e,t,n){if(e===t)return!0;for(;e.parentNode||e.host;){if(e.parentNode&&s(e,t,n))return!0;e=e.parentNode||e.host}return e}(e.composed&&e.composedPath&&e.composedPath().shift()||e.target,r.componentNode,r.props.outsideClickIgnoreClass)===document&&r.__outsideClickHandler(e)))},e.forEach((function(e){document.addEventListener(e,d[r._uid],m(o(r),e))}))}},r.disableOnClickOutside=function(){delete f[r._uid];var e=d[r._uid];if(e&&"undefined"!==typeof document){var t=r.props.eventTypes;t.forEach||(t=[t]),t.forEach((function(t){return document.removeEventListener(t,e,m(o(r),t))})),delete d[r._uid]}},r.getRef=function(e){return r.instanceRef=e},r._uid=l(),r.initTimeStamp=performance.now(),r}p=n,(c=g).prototype=Object.create(p.prototype),c.prototype.constructor=c,a(c,p);var v=g.prototype;return v.getInstance=function(){if(e.prototype&&!e.prototype.isReactComponent)return this;var t=this.instanceRef;return t.getInstance?t.getInstance():t},v.componentDidMount=function(){if("undefined"!==typeof document&&document.createElement){var e=this.getInstance();if(t&&"function"===typeof t.handleClickOutside&&(this.__clickOutsideHandlerProp=t.handleClickOutside(e),"function"!==typeof this.__clickOutsideHandlerProp))throw new Error("WrappedComponent: "+h+" lacks a function for processing outside click events specified by the handleClickOutside config option.");this.componentNode=this.__getComponentNode(),this.props.disableOnClickOutside||this.enableOnClickOutside()}},v.componentDidUpdate=function(){this.componentNode=this.__getComponentNode()},v.componentWillUnmount=function(){this.disableOnClickOutside()},v.render=function(){var t=this.props;t.excludeScrollbar;var n=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(t,["excludeScrollbar"]);return e.prototype&&e.prototype.isReactComponent?n.ref=this.getRef:n.wrappedRef=this.getRef,n.disableOnClickOutside=this.disableOnClickOutside,n.enableOnClickOutside=this.enableOnClickOutside,(0,r.createElement)(e,n)},g}(r.Component),n.displayName="OnClickOutside("+h+")",n.defaultProps={eventTypes:["mousedown","touchstart"],excludeScrollbar:t&&t.excludeScrollbar||!1,outsideClickIgnoreClass:p,preventDefault:!1,stopPropagation:!1},n.getClass=function(){return e.getClass?e.getClass():e},c}},2550:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(6191),i=n(888),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,i.default)(e).getTime(),o=(0,r.A)(t);return new Date(n+o)}},2637:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(888),i=n(8726),a=n(7451),o=n(6191),s=n(8171);function c(e,t){var n,c,u,l,d,f,h,p;(0,i.A)(1,arguments);var m=(0,r.default)(e),g=m.getUTCFullYear(),v=(0,s.q)(),y=(0,o.A)(null!==(n=null!==(c=null!==(u=null!==(l=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==l?l:null===t||void 0===t||null===(d=t.locale)||void 0===d||null===(f=d.options)||void 0===f?void 0:f.firstWeekContainsDate)&&void 0!==u?u:v.firstWeekContainsDate)&&void 0!==c?c:null===(h=v.locale)||void 0===h||null===(p=h.options)||void 0===p?void 0:p.firstWeekContainsDate)&&void 0!==n?n:1);if(!(y>=1&&y<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var b=new Date(0);b.setUTCFullYear(g+1,0,y),b.setUTCHours(0,0,0,0);var _=(0,a.A)(b,t),w=new Date(0);w.setUTCFullYear(g,0,y),w.setUTCHours(0,0,0,0);var E=(0,a.A)(w,t);return m.getTime()>=_.getTime()?g+1:m.getTime()>=E.getTime()?g:g-1}},2672:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e,t){(0,i.A)(2,arguments);var n=(0,r.default)(e),a=(0,r.default)(t);return 12*(n.getFullYear()-a.getFullYear())+(n.getMonth()-a.getMonth())}},2706:(e,t,n)=>{"use strict";n(7358)},2730:(e,t,n)=>{"use strict";var r=n(5043),i=n(8853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function m(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(p,e)||!d.call(h,e)&&(f.test(e)?p[e]=!0:(h[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var _=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),E=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),R=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var P,j=Object.assign;function F(e){if(void 0===P)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||""}return"\n"+P+e}var U=!1;function B(e,t){if(!e||U)return"";U=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&"string"===typeof u.stack){for(var i=u.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s]){var c="\n"+i[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=o&&0<=s);break}}}finally{U=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function V(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function z(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case E:return"Portal";case x:return"Profiler";case C:return"StrictMode";case N:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:z(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return z(e(t))}catch(n){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return z(t);case 8:return t===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Y(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return j({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=G(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Z(e,t){J(e,t);var n=G(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+G(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return j({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:G(n)}}function ae(e,t){var n=G(t.value),r=G(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,le,de=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function fe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(he).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]}))}));var ve=j({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _e=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ee=null,Se=null,Ce=null;function xe(e){if(e=bi(e)){if("function"!==typeof Ee)throw Error(a(280));var t=e.stateNode;t&&(t=wi(t),Ee(e.stateNode,e.type,t))}}function Te(e){Se?Ce?Ce.push(e):Ce=[e]:Se=e}function Re(){if(Se){var e=Se,t=Ce;if(Ce=Se=null,xe(e),t)for(e=0;e<t.length;e++)xe(t[e])}}function Ie(e,t){return e(t)}function Ne(){}var Ae=!1;function ke(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Ie(e,t,n)}finally{Ae=!1,(null!==Se||null!==Ce)&&(Ne(),Re())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var r=wi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Me=!1;if(l)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Me=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(le){Me=!1}function Oe(e,t,n,r,i,a,o,s,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(l){this.onError(l)}}var Pe=!1,je=null,Fe=!1,Ue=null,Be={onError:function(e){Pe=!0,je=e}};function Ve(e,t,n,r,i,a,o,s,c){Pe=!1,je=null,Oe.apply(Be,arguments)}function ze(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ge(e){if(ze(e)!==e)throw Error(a(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=ze(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Ge(i),e;if(o===r)return Ge(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,c=i.child;c;){if(c===n){s=!0,n=i,r=o;break}if(c===r){s=!0,r=i,n=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===n){s=!0,n=o,r=i;break}if(c===r){s=!0,r=o,n=i;break}c=c.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?Ye(e):null}function Ye(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ye(e);if(null!==t)return t;e=e.sibling}return null}var qe=i.unstable_scheduleCallback,Ke=i.unstable_cancelCallback,Xe=i.unstable_shouldYield,Qe=i.unstable_requestPaint,Je=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ct|0)|0},st=Math.log,ct=Math.LN2;var ut=64,lt=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ft(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~i;0!==s?r=dt(s):0!==(a&=o)&&(r=dt(a))}else 0!==(o=n&~i)?r=dt(o):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-ot(t)),r|=e[n],t&=~i;return r}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ut;return 0===(4194240&(ut<<=1))&&(ut=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var bt=0;function _t(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,Et,St,Ct,xt,Tt=!1,Rt=[],It=null,Nt=null,At=null,kt=new Map,Dt=new Map,Mt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":Nt=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Pt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=bi(t))&&Et(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function jt(e){var t=yi(e.target);if(null!==t){var n=ze(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void xt(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bi(n))&&Et(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);_e=r,n.target.dispatchEvent(r),_e=null,t.shift()}return!0}function Ut(e,t,n){Ft(e)&&n.delete(t)}function Bt(){Tt=!1,null!==It&&Ft(It)&&(It=null),null!==Nt&&Ft(Nt)&&(Nt=null),null!==At&&Ft(At)&&(At=null),kt.forEach(Ut),Dt.forEach(Ut)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Bt)))}function zt(e){function t(t){return Vt(t,e)}if(0<Rt.length){Vt(Rt[0],e);for(var n=1;n<Rt.length;n++){var r=Rt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==It&&Vt(It,e),null!==Nt&&Vt(Nt,e),null!==At&&Vt(At,e),kt.forEach(t),Dt.forEach(t),n=0;n<Mt.length;n++)(r=Mt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Mt.length&&null===(n=Mt[0]).blockedOn;)jt(n),null===n.blockedOn&&Mt.shift()}var Wt=_.ReactCurrentBatchConfig,Gt=!0;function Ht(e,t,n,r){var i=bt,a=Wt.transition;Wt.transition=null;try{bt=1,qt(e,t,n,r)}finally{bt=i,Wt.transition=a}}function Yt(e,t,n,r){var i=bt,a=Wt.transition;Wt.transition=null;try{bt=4,qt(e,t,n,r)}finally{bt=i,Wt.transition=a}}function qt(e,t,n,r){if(Gt){var i=Xt(e,t,n,r);if(null===i)Gr(e,t,r,Kt,n),Ot(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return It=Pt(It,e,t,n,r,i),!0;case"dragenter":return Nt=Pt(Nt,e,t,n,r,i),!0;case"mouseover":return At=Pt(At,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return kt.set(a,Pt(kt.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Dt.set(a,Pt(Dt.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Lt.indexOf(e)){for(;null!==i;){var a=bi(i);if(null!==a&&wt(a),null===(a=Xt(e,t,n,r))&&Gr(e,t,r,Kt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else Gr(e,t,r,null,n)}}var Kt=null;function Xt(e,t,n,r){if(Kt=null,null!==(e=yi(e=we(r))))if(null===(t=ze(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Zt=null,$t=null;function en(){if($t)return $t;var e,t,n=Zt,r=n.length,i="value"in Jt?Jt.value:Jt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return j(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,cn,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=an(un),dn=j({},un,{view:0,detail:0}),fn=an(dn),hn=j({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(on=e.screenX-cn.screenX,sn=e.screenY-cn.screenY):sn=on=0,cn=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(hn),mn=an(j({},hn,{dataTransfer:0})),gn=an(j({},dn,{relatedTarget:0})),vn=an(j({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=j({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=an(yn),_n=an(j({},un,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},En={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function xn(){return Cn}var Tn=j({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?En[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rn=an(Tn),In=an(j({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Nn=an(j({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xn})),An=an(j({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=j({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=an(kn),Mn=[9,13,27,32],Ln=l&&"CompositionEvent"in window,On=null;l&&"documentMode"in document&&(On=document.documentMode);var Pn=l&&"TextEvent"in window&&!On,jn=l&&(!Ln||On&&8<On&&11>=On),Fn=String.fromCharCode(32),Un=!1;function Bn(e,t){switch(e){case"keyup":return-1!==Mn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var zn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function Hn(e,t,n,r){Te(r),0<(t=Yr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Yn=null,qn=null;function Kn(e){Fr(e,0)}function Xn(e){if(q(_i(e)))return e}function Qn(e,t){if("change"===e)return t}var Jn=!1;if(l){var Zn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Zn=$n}else Zn=!1;Jn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){Yn&&(Yn.detachEvent("onpropertychange",nr),qn=Yn=null)}function nr(e){if("value"===e.propertyName&&Xn(qn)){var t=[];Hn(t,qn,e,we(e)),ke(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),qn=n,(Yn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(qn)}function ar(e,t){if("click"===e)return Xn(t)}function or(e,t){if("input"===e||"change"===e)return Xn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cr(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!sr(e[i],t[i]))return!1}return!0}function ur(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=ur(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=ur(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function hr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=fr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&hr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=lr(n,a);var o=lr(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=l&&"documentMode"in document&&11>=document.documentMode,gr=null,vr=null,yr=null,br=!1;function _r(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==gr||gr!==K(r)||("selectionStart"in(r=gr)&&hr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&cr(yr,r)||(yr=r,0<(r=Yr(vr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Er={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},Sr={},Cr={};function xr(e){if(Sr[e])return Sr[e];if(!Er[e])return e;var t,n=Er[e];for(t in n)if(n.hasOwnProperty(t)&&t in Cr)return Sr[e]=n[t];return e}l&&(Cr=document.createElement("div").style,"AnimationEvent"in window||(delete Er.animationend.animation,delete Er.animationiteration.animation,delete Er.animationstart.animation),"TransitionEvent"in window||delete Er.transitionend.transition);var Tr=xr("animationend"),Rr=xr("animationiteration"),Ir=xr("animationstart"),Nr=xr("transitionend"),Ar=new Map,kr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(e,t){Ar.set(e,t),c(t,[e])}for(var Mr=0;Mr<kr.length;Mr++){var Lr=kr[Mr];Dr(Lr.toLowerCase(),"on"+(Lr[0].toUpperCase()+Lr.slice(1)))}Dr(Tr,"onAnimationEnd"),Dr(Rr,"onAnimationIteration"),Dr(Ir,"onAnimationStart"),Dr("dblclick","onDoubleClick"),Dr("focusin","onFocus"),Dr("focusout","onBlur"),Dr(Nr,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function jr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,s,c,u){if(Ve.apply(this,arguments),Pe){if(!Pe)throw Error(a(198));var l=je;Pe=!1,je=null,Fe||(Fe=!0,Ue=l)}}(r,t,void 0,e),e.currentTarget=null}function Fr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,u=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break e;jr(i,s,u),a=c}else for(o=0;o<r.length;o++){if(c=(s=r[o]).instance,u=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break e;jr(i,s,u),a=c}}}if(Fe)throw e=Ue,Fe=!1,Ue=null,e}function Ur(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble";n.has(r)||(Wr(t,e,2,!1),n.add(r))}function Br(e,t,n){var r=0;t&&(r|=4),Wr(n,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function zr(e){if(!e[Vr]){e[Vr]=!0,o.forEach((function(t){"selectionchange"!==t&&(Pr.has(t)||Br(t,!1,e),Br(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,Br("selectionchange",!1,t))}}function Wr(e,t,n,r){switch(Qt(t)){case 1:var i=Ht;break;case 4:i=Yt;break;default:i=qt}n=i.bind(null,t,n,e),i=void 0,!Me||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Gr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=yi(s)))return;if(5===(c=o.tag)||6===c){r=a=o;continue e}s=s.parentNode}}r=r.return}ke((function(){var r=a,i=we(n),o=[];e:{var s=Ar.get(e);if(void 0!==s){var c=ln,u=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Rn;break;case"focusin":u="focus",c=gn;break;case"focusout":u="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=Nn;break;case Tr:case Rr:case Ir:c=vn;break;case Nr:c=An;break;case"scroll":c=fn;break;case"wheel":c=Dn;break;case"copy":case"cut":case"paste":c=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=In}var l=0!==(4&t),d=!l&&"scroll"===e,f=l?null!==s?s+"Capture":null:s;l=[];for(var h,p=r;null!==p;){var m=(h=p).stateNode;if(5===h.tag&&null!==m&&(h=m,null!==f&&(null!=(m=De(p,f))&&l.push(Hr(p,m,h)))),d)break;p=p.return}0<l.length&&(s=new c(s,u,null,n,i),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===_e||!(u=n.relatedTarget||n.fromElement)||!yi(u)&&!u[pi])&&(c||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?yi(u):null)&&(u!==(d=ze(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(c=null,u=r),c!==u)){if(l=pn,m="onMouseLeave",f="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(l=In,m="onPointerLeave",f="onPointerEnter",p="pointer"),d=null==c?s:_i(c),h=null==u?s:_i(u),(s=new l(m,p+"leave",c,n,i)).target=d,s.relatedTarget=h,m=null,yi(i)===r&&((l=new l(f,p+"enter",u,n,i)).target=h,l.relatedTarget=d,m=l),d=m,c&&u)e:{for(f=u,p=0,h=l=c;h;h=qr(h))p++;for(h=0,m=f;m;m=qr(m))h++;for(;0<p-h;)l=qr(l),p--;for(;0<h-p;)f=qr(f),h--;for(;p--;){if(l===f||null!==f&&l===f.alternate)break e;l=qr(l),f=qr(f)}l=null}else l=null;null!==c&&Kr(o,s,c,l,!1),null!==u&&null!==d&&Kr(o,d,u,l,!0)}if("select"===(c=(s=r?_i(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var g=Qn;else if(Gn(s))if(Jn)g=or;else{g=ir;var v=rr}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ar);switch(g&&(g=g(e,r))?Hn(o,g,n,i):(v&&v(e,s,r),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&ee(s,"number",s.value)),v=r?_i(r):window,e){case"focusin":(Gn(v)||"true"===v.contentEditable)&&(gr=v,vr=r,yr=null);break;case"focusout":yr=vr=gr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,_r(o,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":_r(o,n,i)}var y;if(Ln)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else zn?Bn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(jn&&"ko"!==n.locale&&(zn||"onCompositionStart"!==b?"onCompositionEnd"===b&&zn&&(y=en()):(Zt="value"in(Jt=i)?Jt.value:Jt.textContent,zn=!0)),0<(v=Yr(r,b)).length&&(b=new _n(b,e,null,n,i),o.push({event:b,listeners:v}),y?b.data=y:null!==(y=Vn(n))&&(b.data=y))),(y=Pn?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Un=!0,Fn);case"textInput":return(e=t.data)===Fn&&Un?null:e;default:return null}}(e,n):function(e,t){if(zn)return"compositionend"===e||!Ln&&Bn(e,t)?(e=en(),$t=Zt=Jt=null,zn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Yr(r,"onBeforeInput")).length&&(i=new _n("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=y))}Fr(o,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Yr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=De(e,n))&&r.unshift(Hr(e,a,i)),null!=(a=De(e,t))&&r.push(Hr(e,a,i))),e=e.return}return r}function qr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,c=s.alternate,u=s.stateNode;if(null!==c&&c===r)break;5===s.tag&&null!==u&&(s=u,i?null!=(c=De(n,a))&&o.unshift(Hr(n,c,s)):i||null!=(c=De(n,a))&&o.push(Hr(n,c,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Xr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Xr,"\n").replace(Qr,"")}function Zr(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(a(425))}function $r(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,ai="function"===typeof Promise?Promise:void 0,oi="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ai?function(e){return ai.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout((function(){throw e}))}function ci(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void zt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);zt(t)}function ui(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function li(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),fi="__reactFiber$"+di,hi="__reactProps$"+di,pi="__reactContainer$"+di,mi="__reactEvents$"+di,gi="__reactListeners$"+di,vi="__reactHandles$"+di;function yi(e){var t=e[fi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[fi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=li(e);null!==e;){if(n=e[fi])return n;e=li(e)}return t}n=(e=n).parentNode}return null}function bi(e){return!(e=e[fi]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function _i(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function wi(e){return e[hi]||null}var Ei=[],Si=-1;function Ci(e){return{current:e}}function xi(e){0>Si||(e.current=Ei[Si],Ei[Si]=null,Si--)}function Ti(e,t){Si++,Ei[Si]=e.current,e.current=t}var Ri={},Ii=Ci(Ri),Ni=Ci(!1),Ai=Ri;function ki(e,t){var n=e.type.contextTypes;if(!n)return Ri;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Di(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Mi(){xi(Ni),xi(Ii)}function Li(e,t,n){if(Ii.current!==Ri)throw Error(a(168));Ti(Ii,t),Ti(Ni,n)}function Oi(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,W(e)||"Unknown",i));return j({},n,r)}function Pi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ri,Ai=Ii.current,Ti(Ii,e),Ti(Ni,Ni.current),!0}function ji(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=Oi(e,t,Ai),r.__reactInternalMemoizedMergedChildContext=e,xi(Ni),xi(Ii),Ti(Ii,e)):xi(Ni),Ti(Ni,n)}var Fi=null,Ui=!1,Bi=!1;function Vi(e){null===Fi?Fi=[e]:Fi.push(e)}function zi(){if(!Bi&&null!==Fi){Bi=!0;var e=0,t=bt;try{var n=Fi;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Fi=null,Ui=!1}catch(i){throw null!==Fi&&(Fi=Fi.slice(e+1)),qe($e,zi),i}finally{bt=t,Bi=!1}}return null}var Wi=[],Gi=0,Hi=null,Yi=0,qi=[],Ki=0,Xi=null,Qi=1,Ji="";function Zi(e,t){Wi[Gi++]=Yi,Wi[Gi++]=Hi,Hi=e,Yi=t}function $i(e,t,n){qi[Ki++]=Qi,qi[Ki++]=Ji,qi[Ki++]=Xi,Xi=e;var r=Qi;e=Ji;var i=32-ot(r)-1;r&=~(1<<i),n+=1;var a=32-ot(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Qi=1<<32-ot(t)+i|n<<i|r,Ji=a+e}else Qi=1<<a|n<<i|r,Ji=e}function ea(e){null!==e.return&&(Zi(e,1),$i(e,1,0))}function ta(e){for(;e===Hi;)Hi=Wi[--Gi],Wi[Gi]=null,Yi=Wi[--Gi],Wi[Gi]=null;for(;e===Xi;)Xi=qi[--Ki],qi[Ki]=null,Ji=qi[--Ki],qi[Ki]=null,Qi=qi[--Ki],qi[Ki]=null}var na=null,ra=null,ia=!1,aa=null;function oa(e,t){var n=ku(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ra=ui(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xi?{id:Qi,overflow:Ji}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=ku(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ra=null,!0);default:return!1}}function ca(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ua(e){if(ia){var t=ra;if(t){var n=t;if(!sa(e,t)){if(ca(e))throw Error(a(418));t=ui(n.nextSibling);var r=na;t&&sa(e,t)?oa(r,n):(e.flags=-4097&e.flags|2,ia=!1,na=e)}}else{if(ca(e))throw Error(a(418));e.flags=-4097&e.flags|2,ia=!1,na=e}}}function la(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function da(e){if(e!==na)return!1;if(!ia)return la(e),ia=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ra)){if(ca(e))throw fa(),Error(a(418));for(;t;)oa(e,t),t=ui(t.nextSibling)}if(la(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ra=ui(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ra=null}}else ra=na?ui(e.stateNode.nextSibling):null;return!0}function fa(){for(var e=ra;e;)e=ui(e.nextSibling)}function ha(){ra=na=null,ia=!1}function pa(e){null===aa?aa=[e]:aa.push(e)}var ma=_.ReactCurrentBatchConfig;function ga(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function va(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ya(e){return(0,e._init)(e._payload)}function ba(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Mu(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=ju(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function u(e,t,n,r){var a=n.type;return a===S?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===D&&ya(a)===t.type)?((r=i(t,n.props)).ref=ga(e,t,n),r.return=e,r):((r=Lu(n.type,n.key,n.props,null,e.mode,r)).ref=ga(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fu(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,a){return null===t||7!==t.tag?((t=Ou(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=ju(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Lu(t.type,t.key,t.props,null,e.mode,n)).ref=ga(e,null,t),n.return=e,n;case E:return(t=Fu(t,e.mode,n)).return=e,t;case D:return f(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Ou(t,e.mode,n,null)).return=e,t;va(e,t)}return null}function h(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===i?u(e,t,n,r):null;case E:return n.key===i?l(e,t,n,r):null;case D:return h(e,t,(i=n._init)(n._payload),r)}if(te(n)||O(n))return null!==i?null:d(e,t,n,r,null);va(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case E:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case D:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||O(r))return d(t,e=e.get(n)||null,r,i,null);va(t,r)}return null}function m(i,a,s,c){for(var u=null,l=null,d=a,m=a=0,g=null;null!==d&&m<s.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=h(i,d,s[m],c);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(i,d),a=o(v,a,m),null===l?u=v:l.sibling=v,l=v,d=g}if(m===s.length)return n(i,d),ia&&Zi(i,m),u;if(null===d){for(;m<s.length;m++)null!==(d=f(i,s[m],c))&&(a=o(d,a,m),null===l?u=d:l.sibling=d,l=d);return ia&&Zi(i,m),u}for(d=r(i,d);m<s.length;m++)null!==(g=p(d,i,m,s[m],c))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),a=o(g,a,m),null===l?u=g:l.sibling=g,l=g);return e&&d.forEach((function(e){return t(i,e)})),ia&&Zi(i,m),u}function g(i,s,c,u){var l=O(c);if("function"!==typeof l)throw Error(a(150));if(null==(c=l.call(c)))throw Error(a(151));for(var d=l=null,m=s,g=s=0,v=null,y=c.next();null!==m&&!y.done;g++,y=c.next()){m.index>g?(v=m,m=null):v=m.sibling;var b=h(i,m,y.value,u);if(null===b){null===m&&(m=v);break}e&&m&&null===b.alternate&&t(i,m),s=o(b,s,g),null===d?l=b:d.sibling=b,d=b,m=v}if(y.done)return n(i,m),ia&&Zi(i,g),l;if(null===m){for(;!y.done;g++,y=c.next())null!==(y=f(i,y.value,u))&&(s=o(y,s,g),null===d?l=y:d.sibling=y,d=y);return ia&&Zi(i,g),l}for(m=r(i,m);!y.done;g++,y=c.next())null!==(y=p(m,i,g,y.value,u))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),s=o(y,s,g),null===d?l=y:d.sibling=y,d=y);return e&&m.forEach((function(e){return t(i,e)})),ia&&Zi(i,g),l}return function e(r,a,o,c){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var u=o.key,l=a;null!==l;){if(l.key===u){if((u=o.type)===S){if(7===l.tag){n(r,l.sibling),(a=i(l,o.props.children)).return=r,r=a;break e}}else if(l.elementType===u||"object"===typeof u&&null!==u&&u.$$typeof===D&&ya(u)===l.type){n(r,l.sibling),(a=i(l,o.props)).ref=ga(r,l,o),a.return=r,r=a;break e}n(r,l);break}t(r,l),l=l.sibling}o.type===S?((a=Ou(o.props.children,r.mode,c,o.key)).return=r,r=a):((c=Lu(o.type,o.key,o.props,null,r.mode,c)).ref=ga(r,a,o),c.return=r,r=c)}return s(r);case E:e:{for(l=o.key;null!==a;){if(a.key===l){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(r,a.sibling),(a=i(a,o.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Fu(o,r.mode,c)).return=r,r=a}return s(r);case D:return e(r,a,(l=o._init)(o._payload),c)}if(te(o))return m(r,a,o,c);if(O(o))return g(r,a,o,c);va(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,o)).return=r,r=a):(n(r,a),(a=ju(o,r.mode,c)).return=r,r=a),s(r)):n(r,a)}}var _a=ba(!0),wa=ba(!1),Ea=Ci(null),Sa=null,Ca=null,xa=null;function Ta(){xa=Ca=Sa=null}function Ra(e){var t=Ea.current;xi(Ea),e._currentValue=t}function Ia(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Na(e,t){Sa=e,xa=Ca=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bs=!0),e.firstContext=null)}function Aa(e){var t=e._currentValue;if(xa!==e)if(e={context:e,memoizedValue:t,next:null},null===Ca){if(null===Sa)throw Error(a(308));Ca=e,Sa.dependencies={lanes:0,firstContext:e}}else Ca=Ca.next=e;return t}var ka=null;function Da(e){null===ka?ka=[e]:ka.push(e)}function Ma(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Da(t)):(n.next=i.next,i.next=n),t.interleaved=n,La(e,r)}function La(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Oa=!1;function Pa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ja(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ua(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ic)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,La(e,n)}return null===(i=r.interleaved)?(t.next=t,Da(r)):(t.next=i.next,i.next=t),r.interleaved=t,La(e,n)}function Ba(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Va(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function za(e,t,n,r){var i=e.updateQueue;Oa=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var c=s,u=c.next;c.next=null,null===o?a=u:o.next=u,o=c;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==o&&(null===s?l.firstBaseUpdate=u:s.next=u,l.lastBaseUpdate=c))}if(null!==a){var d=i.baseState;for(o=0,l=u=c=null,s=a;;){var f=s.lane,h=s.eventTime;if((r&f)===f){null!==l&&(l=l.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(f=t,h=n,m.tag){case 1:if("function"===typeof(p=m.payload)){d=p.call(h,d,f);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(f="function"===typeof(p=m.payload)?p.call(h,d,f):p)||void 0===f)break e;d=j({},d,f);break e;case 2:Oa=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(f=i.effects)?i.effects=[s]:f.push(s))}else h={eventTime:h,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(u=l=h,c=d):l=l.next=h,o|=f;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(f=s).next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}if(null===l&&(c=d),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=l,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);Pc|=o,e.lanes=o,e.memoizedState=d}}function Wa(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var Ga={},Ha=Ci(Ga),Ya=Ci(Ga),qa=Ci(Ga);function Ka(e){if(e===Ga)throw Error(a(174));return e}function Xa(e,t){switch(Ti(qa,t),Ti(Ya,e),Ti(Ha,Ga),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}xi(Ha),Ti(Ha,t)}function Qa(){xi(Ha),xi(Ya),xi(qa)}function Ja(e){Ka(qa.current);var t=Ka(Ha.current),n=ce(t,e.type);t!==n&&(Ti(Ya,e),Ti(Ha,n))}function Za(e){Ya.current===e&&(xi(Ha),xi(Ya))}var $a=Ci(0);function eo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var to=[];function no(){for(var e=0;e<to.length;e++)to[e]._workInProgressVersionPrimary=null;to.length=0}var ro=_.ReactCurrentDispatcher,io=_.ReactCurrentBatchConfig,ao=0,oo=null,so=null,co=null,uo=!1,lo=!1,fo=0,ho=0;function po(){throw Error(a(321))}function mo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function go(e,t,n,r,i,o){if(ao=o,oo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ro.current=null===e||null===e.memoizedState?$o:es,e=n(r,i),lo){o=0;do{if(lo=!1,fo=0,25<=o)throw Error(a(301));o+=1,co=so=null,t.updateQueue=null,ro.current=ts,e=n(r,i)}while(lo)}if(ro.current=Zo,t=null!==so&&null!==so.next,ao=0,co=so=oo=null,uo=!1,t)throw Error(a(300));return e}function vo(){var e=0!==fo;return fo=0,e}function yo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===co?oo.memoizedState=co=e:co=co.next=e,co}function bo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var t=null===co?oo.memoizedState:co.next;if(null!==t)co=t,so=e;else{if(null===e)throw Error(a(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===co?oo.memoizedState=co=e:co=co.next=e}return co}function _o(e,t){return"function"===typeof t?t(e):t}function wo(e){var t=bo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=so,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var c=s=null,u=null,l=o;do{var d=l.lane;if((ao&d)===d)null!==u&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var f={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===u?(c=u=f,s=r):u=u.next=f,oo.lanes|=d,Pc|=d}l=l.next}while(null!==l&&l!==o);null===u?s=r:u.next=c,sr(r,t.memoizedState)||(bs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=u,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{o=i.lane,oo.lanes|=o,Pc|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Eo(e){var t=bo(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);sr(o,t.memoizedState)||(bs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function So(){}function Co(e,t){var n=oo,r=bo(),i=t(),o=!sr(r.memoizedState,i);if(o&&(r.memoizedState=i,bs=!0),r=r.queue,Po(Ro.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==co&&1&co.memoizedState.tag){if(n.flags|=2048,ko(9,To.bind(null,n,r,i,t),void 0,null),null===Nc)throw Error(a(349));0!==(30&ao)||xo(n,t,i)}return i}function xo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function To(e,t,n,r){t.value=n,t.getSnapshot=r,Io(t)&&No(e)}function Ro(e,t,n){return n((function(){Io(t)&&No(e)}))}function Io(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function No(e){var t=La(e,1);null!==t&&nu(t,e,1,-1)}function Ao(e){var t=yo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_o,lastRenderedState:e},t.queue=e,e=e.dispatch=Ko.bind(null,oo,e),[t.memoizedState,e]}function ko(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Do(){return bo().memoizedState}function Mo(e,t,n,r){var i=yo();oo.flags|=e,i.memoizedState=ko(1|t,n,void 0,void 0===r?null:r)}function Lo(e,t,n,r){var i=bo();r=void 0===r?null:r;var a=void 0;if(null!==so){var o=so.memoizedState;if(a=o.destroy,null!==r&&mo(r,o.deps))return void(i.memoizedState=ko(t,n,a,r))}oo.flags|=e,i.memoizedState=ko(1|t,n,a,r)}function Oo(e,t){return Mo(8390656,8,e,t)}function Po(e,t){return Lo(2048,8,e,t)}function jo(e,t){return Lo(4,2,e,t)}function Fo(e,t){return Lo(4,4,e,t)}function Uo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Bo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Lo(4,4,Uo.bind(null,t,e),n)}function Vo(){}function zo(e,t){var n=bo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Wo(e,t){var n=bo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Go(e,t,n){return 0===(21&ao)?(e.baseState&&(e.baseState=!1,bs=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),oo.lanes|=n,Pc|=n,e.baseState=!0),t)}function Ho(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=io.transition;io.transition={};try{e(!1),t()}finally{bt=n,io.transition=r}}function Yo(){return bo().memoizedState}function qo(e,t,n){var r=tu(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Xo(e))Qo(t,n);else if(null!==(n=Ma(e,t,n,r))){nu(n,e,r,eu()),Jo(n,t,r)}}function Ko(e,t,n){var r=tu(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Xo(e))Qo(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,sr(s,o)){var c=t.interleaved;return null===c?(i.next=i,Da(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(u){}null!==(n=Ma(e,t,i,r))&&(nu(n,e,r,i=eu()),Jo(n,t,r))}}function Xo(e){var t=e.alternate;return e===oo||null!==t&&t===oo}function Qo(e,t){lo=uo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Jo(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Zo={readContext:Aa,useCallback:po,useContext:po,useEffect:po,useImperativeHandle:po,useInsertionEffect:po,useLayoutEffect:po,useMemo:po,useReducer:po,useRef:po,useState:po,useDebugValue:po,useDeferredValue:po,useTransition:po,useMutableSource:po,useSyncExternalStore:po,useId:po,unstable_isNewReconciler:!1},$o={readContext:Aa,useCallback:function(e,t){return yo().memoizedState=[e,void 0===t?null:t],e},useContext:Aa,useEffect:Oo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Mo(4194308,4,Uo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Mo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Mo(4,2,e,t)},useMemo:function(e,t){var n=yo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=yo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=qo.bind(null,oo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},yo().memoizedState=e},useState:Ao,useDebugValue:Vo,useDeferredValue:function(e){return yo().memoizedState=e},useTransition:function(){var e=Ao(!1),t=e[0];return e=Ho.bind(null,e[1]),yo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=oo,i=yo();if(ia){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Nc)throw Error(a(349));0!==(30&ao)||xo(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,Oo(Ro.bind(null,r,o,e),[e]),r.flags|=2048,ko(9,To.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=yo(),t=Nc.identifierPrefix;if(ia){var n=Ji;t=":"+t+"R"+(n=(Qi&~(1<<32-ot(Qi)-1)).toString(32)+n),0<(n=fo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ho++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Aa,useCallback:zo,useContext:Aa,useEffect:Po,useImperativeHandle:Bo,useInsertionEffect:jo,useLayoutEffect:Fo,useMemo:Wo,useReducer:wo,useRef:Do,useState:function(){return wo(_o)},useDebugValue:Vo,useDeferredValue:function(e){return Go(bo(),so.memoizedState,e)},useTransition:function(){return[wo(_o)[0],bo().memoizedState]},useMutableSource:So,useSyncExternalStore:Co,useId:Yo,unstable_isNewReconciler:!1},ts={readContext:Aa,useCallback:zo,useContext:Aa,useEffect:Po,useImperativeHandle:Bo,useInsertionEffect:jo,useLayoutEffect:Fo,useMemo:Wo,useReducer:Eo,useRef:Do,useState:function(){return Eo(_o)},useDebugValue:Vo,useDeferredValue:function(e){var t=bo();return null===so?t.memoizedState=e:Go(t,so.memoizedState,e)},useTransition:function(){return[Eo(_o)[0],bo().memoizedState]},useMutableSource:So,useSyncExternalStore:Co,useId:Yo,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=j({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:j({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var is={isMounted:function(e){return!!(e=e._reactInternals)&&ze(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=eu(),i=tu(e),a=Fa(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ua(e,a,i))&&(nu(t,e,i,r),Ba(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=eu(),i=tu(e),a=Fa(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ua(e,a,i))&&(nu(t,e,i,r),Ba(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=eu(),r=tu(e),i=Fa(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Ua(e,i,r))&&(nu(t,e,r,n),Ba(t,e,r))}};function as(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(i,a))}function os(e,t,n){var r=!1,i=Ri,a=t.contextType;return"object"===typeof a&&null!==a?a=Aa(a):(i=Di(t)?Ai:Ii.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?ki(e,i):Ri),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=is,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&is.enqueueReplaceState(t,t.state,null)}function cs(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Pa(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=Aa(a):(a=Di(t)?Ai:Ii.current,i.context=ki(e,a)),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(rs(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&is.enqueueReplaceState(i,i.state,null),za(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function us(e,t){try{var n="",r=t;do{n+=V(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i,digest:null}}function ls(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=Fa(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Gc||(Gc=!0,Hc=r),ds(0,t)},n}function ps(e,t,n){(n=Fa(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){ds(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof r&&(null===Yc?Yc=new Set([this]):Yc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new fs;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=xu.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Fa(-1,1)).tag=2,Ua(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var ys=_.ReactCurrentOwner,bs=!1;function _s(e,t,n,r){t.child=null===e?wa(t,null,n,r):_a(t,e.child,n,r)}function ws(e,t,n,r,i){n=n.render;var a=t.ref;return Na(t,i),r=go(e,t,n,r,a,i),n=vo(),null===e||bs?(ia&&n&&ea(t),t.flags|=1,_s(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Gs(e,t,i))}function Es(e,t,n,r,i){if(null===e){var a=n.type;return"function"!==typeof a||Du(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lu(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ss(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:cr)(o,r)&&e.ref===t.ref)return Gs(e,t,i)}return t.flags|=1,(e=Mu(a,r)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(cr(a,r)&&e.ref===t.ref){if(bs=!1,t.pendingProps=r=a,0===(e.lanes&i))return t.lanes=e.lanes,Gs(e,t,i);0!==(131072&e.flags)&&(bs=!0)}}return Ts(e,t,n,r,i)}function Cs(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ti(Mc,Dc),Dc|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ti(Mc,Dc),Dc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,Ti(Mc,Dc),Dc|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,Ti(Mc,Dc),Dc|=r;return _s(e,t,i,n),t.child}function xs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ts(e,t,n,r,i){var a=Di(n)?Ai:Ii.current;return a=ki(t,a),Na(t,i),n=go(e,t,n,r,a,i),r=vo(),null===e||bs?(ia&&r&&ea(t),t.flags|=1,_s(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Gs(e,t,i))}function Rs(e,t,n,r,i){if(Di(n)){var a=!0;Pi(t)}else a=!1;if(Na(t,i),null===t.stateNode)Ws(e,t),os(t,n,r),cs(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,u=n.contextType;"object"===typeof u&&null!==u?u=Aa(u):u=ki(t,u=Di(n)?Ai:Ii.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||c!==u)&&ss(t,o,r,u),Oa=!1;var f=t.memoizedState;o.state=f,za(t,r,o,i),c=t.memoizedState,s!==r||f!==c||Ni.current||Oa?("function"===typeof l&&(rs(t,n,l,r),c=t.memoizedState),(s=Oa||as(t,n,s,r,f,c,u))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=u,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,ja(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:ns(t.type,s),o.props=u,d=t.pendingProps,f=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=Aa(c):c=ki(t,c=Di(n)?Ai:Ii.current);var h=n.getDerivedStateFromProps;(l="function"===typeof h||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==d||f!==c)&&ss(t,o,r,c),Oa=!1,f=t.memoizedState,o.state=f,za(t,r,o,i);var p=t.memoizedState;s!==d||f!==p||Ni.current||Oa?("function"===typeof h&&(rs(t,n,h,r),p=t.memoizedState),(u=Oa||as(t,n,u,r,f,p,c)||!1)?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=c,r=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return Is(e,t,n,r,a,i)}function Is(e,t,n,r,i,a){xs(e,t);var o=0!==(128&t.flags);if(!r&&!o)return i&&ji(t,n,!1),Gs(e,t,a);r=t.stateNode,ys.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=_a(t,e.child,null,a),t.child=_a(t,null,s,a)):_s(e,t,s,a),t.memoizedState=r.state,i&&ji(t,n,!0),t.child}function Ns(e){var t=e.stateNode;t.pendingContext?Li(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Li(0,t.context,!1),Xa(e,t.containerInfo)}function As(e,t,n,r,i){return ha(),pa(i),t.flags|=256,_s(e,t,n,r),t.child}var ks,Ds,Ms,Ls,Os={dehydrated:null,treeContext:null,retryLane:0};function Ps(e){return{baseLanes:e,cachePool:null,transitions:null}}function js(e,t,n){var r,i=t.pendingProps,o=$a.current,s=!1,c=0!==(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ti($a,1&o),null===e)return ua(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=i.children,e=i.fallback,s?(i=t.mode,s=t.child,c={mode:"hidden",children:c},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=c):s=Pu(c,i,0,null),e=Ou(e,i,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ps(n),t.memoizedState=Os,e):Fs(t,c));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,i,o,s){if(n)return 256&t.flags?(t.flags&=-257,Us(e,t,s,r=ls(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=Pu({mode:"visible",children:r.children},i,0,null),(o=Ou(o,i,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&_a(t,e.child,null,s),t.child.memoizedState=Ps(s),t.memoizedState=Os,o);if(0===(1&t.mode))return Us(e,t,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var c=r.dgst;return r=c,Us(e,t,s,r=ls(o=Error(a(419)),r,void 0))}if(c=0!==(s&e.childLanes),bs||c){if(null!==(r=Nc)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==o.retryLane&&(o.retryLane=i,La(e,i),nu(r,e,i,-1))}return mu(),Us(e,t,s,r=ls(Error(a(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ru.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,ra=ui(i.nextSibling),na=t,ia=!0,aa=null,null!==e&&(qi[Ki++]=Qi,qi[Ki++]=Ji,qi[Ki++]=Xi,Qi=e.id,Ji=e.overflow,Xi=t),t=Fs(t,r.children),t.flags|=4096,t)}(e,t,c,i,r,o,n);if(s){s=i.fallback,c=t.mode,r=(o=e.child).sibling;var u={mode:"hidden",children:i.children};return 0===(1&c)&&t.child!==o?((i=t.child).childLanes=0,i.pendingProps=u,t.deletions=null):(i=Mu(o,u)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Mu(r,s):(s=Ou(s,c,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,c=null===(c=e.child.memoizedState)?Ps(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~n,t.memoizedState=Os,i}return e=(s=e.child).sibling,i=Mu(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Fs(e,t){return(t=Pu({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Us(e,t,n,r){return null!==r&&pa(r),_a(t,e.child,null,n),(e=Fs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ia(e.return,t,n)}function Vs(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function zs(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(_s(e,t,r.children,n),0!==(2&(r=$a.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bs(e,n,t);else if(19===e.tag)Bs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ti($a,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===eo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Vs(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===eo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Vs(t,!0,n,null,a);break;case"together":Vs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ws(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Gs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Pc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Mu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Mu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Hs(e,t){if(!ia)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ys(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function qs(e,t,n){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ys(t),null;case 1:case 17:return Di(t.type)&&Mi(),Ys(t),null;case 3:return r=t.stateNode,Qa(),xi(Ni),xi(Ii),no(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(da(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(ou(aa),aa=null))),Ds(e,t),Ys(t),null;case 5:Za(t);var i=Ka(qa.current);if(n=t.type,null!==e&&null!=t.stateNode)Ms(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Ys(t),null}if(e=Ka(Ha.current),da(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[fi]=t,r[hi]=o,e=0!==(1&t.mode),n){case"dialog":Ur("cancel",r),Ur("close",r);break;case"iframe":case"object":case"embed":Ur("load",r);break;case"video":case"audio":for(i=0;i<Or.length;i++)Ur(Or[i],r);break;case"source":Ur("error",r);break;case"img":case"image":case"link":Ur("error",r),Ur("load",r);break;case"details":Ur("toggle",r);break;case"input":Q(r,o),Ur("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Ur("invalid",r);break;case"textarea":ie(r,o),Ur("invalid",r)}for(var c in ye(n,o),i=null,o)if(o.hasOwnProperty(c)){var u=o[c];"children"===c?"string"===typeof u?r.textContent!==u&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,u,e),i=["children",u]):"number"===typeof u&&r.textContent!==""+u&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,u,e),i=["children",""+u]):s.hasOwnProperty(c)&&null!=u&&"onScroll"===c&&Ur("scroll",r)}switch(n){case"input":Y(r),$(r,o,!0);break;case"textarea":Y(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=$r)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[fi]=t,e[hi]=r,ks(e,t,!1,!1),t.stateNode=e;e:{switch(c=be(n,r),n){case"dialog":Ur("cancel",e),Ur("close",e),i=r;break;case"iframe":case"object":case"embed":Ur("load",e),i=r;break;case"video":case"audio":for(i=0;i<Or.length;i++)Ur(Or[i],e);i=r;break;case"source":Ur("error",e),i=r;break;case"img":case"image":case"link":Ur("error",e),Ur("load",e),i=r;break;case"details":Ur("toggle",e),i=r;break;case"input":Q(e,r),i=X(e,r),Ur("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=j({},r,{value:void 0}),Ur("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Ur("invalid",e)}for(o in ye(n,i),u=i)if(u.hasOwnProperty(o)){var l=u[o];"style"===o?ge(e,l):"dangerouslySetInnerHTML"===o?null!=(l=l?l.__html:void 0)&&de(e,l):"children"===o?"string"===typeof l?("textarea"!==n||""!==l)&&fe(e,l):"number"===typeof l&&fe(e,""+l):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=l&&"onScroll"===o&&Ur("scroll",e):null!=l&&b(e,o,l,c))}switch(n){case"input":Y(e),$(e,r,!1);break;case"textarea":Y(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+G(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ys(t),null;case 6:if(e&&null!=t.stateNode)Ls(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=Ka(qa.current),Ka(Ha.current),da(t)){if(r=t.stateNode,n=t.memoizedProps,r[fi]=t,(o=r.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[fi]=t,t.stateNode=r}return Ys(t),null;case 13:if(xi($a),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ia&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))fa(),ha(),t.flags|=98560,o=!1;else if(o=da(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[fi]=t}else ha(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ys(t),o=!1}else null!==aa&&(ou(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$a.current)?0===Lc&&(Lc=3):mu())),null!==t.updateQueue&&(t.flags|=4),Ys(t),null);case 4:return Qa(),Ds(e,t),null===e&&zr(t.stateNode.containerInfo),Ys(t),null;case 10:return Ra(t.type._context),Ys(t),null;case 19:if(xi($a),null===(o=t.memoizedState))return Ys(t),null;if(r=0!==(128&t.flags),null===(c=o.rendering))if(r)Hs(o,!1);else{if(0!==Lc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=eo(e))){for(t.flags|=128,Hs(o,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(c=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,e=c.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ti($a,1&$a.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>zc&&(t.flags|=128,r=!0,Hs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=eo(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Hs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!c.alternate&&!ia)return Ys(t),null}else 2*Je()-o.renderingStartTime>zc&&1073741824!==n&&(t.flags|=128,r=!0,Hs(o,!1),t.lanes=4194304);o.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=o.last)?n.sibling=c:t.child=c,o.last=c)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=$a.current,Ti($a,r?1&n|2:1&n),t):(Ys(t),null);case 22:case 23:return du(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Dc)&&(Ys(t),6&t.subtreeFlags&&(t.flags|=8192)):Ys(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Ks(e,t){switch(ta(t),t.tag){case 1:return Di(t.type)&&Mi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qa(),xi(Ni),xi(Ii),no(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Za(t),null;case 13:if(xi($a),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ha()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return xi($a),null;case 4:return Qa(),null;case 10:return Ra(t.type._context),null;case 22:case 23:return du(),null;default:return null}}ks=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(){},Ms=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Ka(Ha.current);var a,o=null;switch(n){case"input":i=X(e,i),r=X(e,r),o=[];break;case"select":i=j({},i,{value:void 0}),r=j({},r,{value:void 0}),o=[];break;case"textarea":i=re(e,i),r=re(e,r),o=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in ye(n,r),n=null,i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&null!=i[l])if("style"===l){var c=i[l];for(a in c)c.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var u=r[l];if(c=null!=i?i[l]:void 0,r.hasOwnProperty(l)&&u!==c&&(null!=u||null!=c))if("style"===l)if(c){for(a in c)!c.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&c[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(o||(o=[]),o.push(l,n)),n=u;else"dangerouslySetInnerHTML"===l?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(o=o||[]).push(l,u)):"children"===l?"string"!==typeof u&&"number"!==typeof u||(o=o||[]).push(l,""+u):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=u&&"onScroll"===l&&Ur("scroll",e),o||c===u||(o=[])):(o=o||[]).push(l,u))}n&&(o=o||[]).push("style",n);var l=o;(t.updateQueue=l)&&(t.flags|=4)}},Ls=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xs=!1,Qs=!1,Js="function"===typeof WeakSet?WeakSet:Set,Zs=null;function $s(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Cu(e,t,r)}else n.current=null}function ec(e,t,n){try{n()}catch(r){Cu(e,t,r)}}var tc=!1;function nc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&ec(t,n,a)}i=i.next}while(i!==r)}}function rc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ic(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ac(e){var t=e.alternate;null!==t&&(e.alternate=null,ac(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[fi],delete t[hi],delete t[mi],delete t[gi],delete t[vi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oc(e){return 5===e.tag||3===e.tag||4===e.tag}function sc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||oc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(cc(e,t,n),e=e.sibling;null!==e;)cc(e,t,n),e=e.sibling}function uc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(uc(e,t,n),e=e.sibling;null!==e;)uc(e,t,n),e=e.sibling}var lc=null,dc=!1;function fc(e,t,n){for(n=n.child;null!==n;)hc(e,t,n),n=n.sibling}function hc(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(it,n)}catch(s){}switch(n.tag){case 5:Qs||$s(n,t);case 6:var r=lc,i=dc;lc=null,fc(e,t,n),dc=i,null!==(lc=r)&&(dc?(e=lc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lc.removeChild(n.stateNode));break;case 18:null!==lc&&(dc?(e=lc,n=n.stateNode,8===e.nodeType?ci(e.parentNode,n):1===e.nodeType&&ci(e,n),zt(e)):ci(lc,n.stateNode));break;case 4:r=lc,i=dc,lc=n.stateNode.containerInfo,dc=!0,fc(e,t,n),lc=r,dc=i;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&ec(n,t,o),i=i.next}while(i!==r)}fc(e,t,n);break;case 1:if(!Qs&&($s(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Cu(n,t,s)}fc(e,t,n);break;case 21:fc(e,t,n);break;case 22:1&n.mode?(Qs=(r=Qs)||null!==n.memoizedState,fc(e,t,n),Qs=r):fc(e,t,n);break;default:fc(e,t,n)}}function pc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Js),t.forEach((function(t){var r=Iu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function mc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:lc=c.stateNode,dc=!1;break e;case 3:case 4:lc=c.stateNode.containerInfo,dc=!0;break e}c=c.return}if(null===lc)throw Error(a(160));hc(o,s,i),lc=null,dc=!1;var u=i.alternate;null!==u&&(u.return=null),i.return=null}catch(l){Cu(i,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gc(t,e),t=t.sibling}function gc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mc(t,e),vc(e),4&r){try{nc(3,e,e.return),rc(3,e)}catch(g){Cu(e,e.return,g)}try{nc(5,e,e.return)}catch(g){Cu(e,e.return,g)}}break;case 1:mc(t,e),vc(e),512&r&&null!==n&&$s(n,n.return);break;case 5:if(mc(t,e),vc(e),512&r&&null!==n&&$s(n,n.return),32&e.flags){var i=e.stateNode;try{fe(i,"")}catch(g){Cu(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,c=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===c&&"radio"===o.type&&null!=o.name&&J(i,o),be(c,s);var l=be(c,o);for(s=0;s<u.length;s+=2){var d=u[s],f=u[s+1];"style"===d?ge(i,f):"dangerouslySetInnerHTML"===d?de(i,f):"children"===d?fe(i,f):b(i,d,f,l)}switch(c){case"input":Z(i,o);break;case"textarea":ae(i,o);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(i,!!o.multiple,p,!1):h!==!!o.multiple&&(null!=o.defaultValue?ne(i,!!o.multiple,o.defaultValue,!0):ne(i,!!o.multiple,o.multiple?[]:"",!1))}i[hi]=o}catch(g){Cu(e,e.return,g)}}break;case 6:if(mc(t,e),vc(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(g){Cu(e,e.return,g)}}break;case 3:if(mc(t,e),vc(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{zt(t.containerInfo)}catch(g){Cu(e,e.return,g)}break;case 4:default:mc(t,e),vc(e);break;case 13:mc(t,e),vc(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(Vc=Je())),4&r&&pc(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Qs=(l=Qs)||d,mc(t,e),Qs=l):mc(t,e),vc(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!d&&0!==(1&e.mode))for(Zs=e,d=e.child;null!==d;){for(f=Zs=d;null!==Zs;){switch(p=(h=Zs).child,h.tag){case 0:case 11:case 14:case 15:nc(4,h,h.return);break;case 1:$s(h,h.return);var m=h.stateNode;if("function"===typeof m.componentWillUnmount){r=h,n=h.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Cu(r,n,g)}}break;case 5:$s(h,h.return);break;case 22:if(null!==h.memoizedState){wc(f);continue}}null!==p?(p.return=h,Zs=p):wc(f)}d=d.sibling}e:for(d=null,f=e;;){if(5===f.tag){if(null===d){d=f;try{i=f.stateNode,l?"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(c=f.stateNode,s=void 0!==(u=f.memoizedProps.style)&&null!==u&&u.hasOwnProperty("display")?u.display:null,c.style.display=me("display",s))}catch(g){Cu(e,e.return,g)}}}else if(6===f.tag){if(null===d)try{f.stateNode.nodeValue=l?"":f.memoizedProps}catch(g){Cu(e,e.return,g)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===e)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;null===f.sibling;){if(null===f.return||f.return===e)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:mc(t,e),vc(e),4&r&&pc(e);case 21:}}function vc(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(oc(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(fe(i,""),r.flags&=-33),uc(e,sc(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;cc(e,sc(e),o);break;default:throw Error(a(161))}}catch(s){Cu(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yc(e,t,n){Zs=e,bc(e,t,n)}function bc(e,t,n){for(var r=0!==(1&e.mode);null!==Zs;){var i=Zs,a=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||Xs;if(!o){var s=i.alternate,c=null!==s&&null!==s.memoizedState||Qs;s=Xs;var u=Qs;if(Xs=o,(Qs=c)&&!u)for(Zs=i;null!==Zs;)c=(o=Zs).child,22===o.tag&&null!==o.memoizedState?Ec(i):null!==c?(c.return=o,Zs=c):Ec(i);for(;null!==a;)Zs=a,bc(a,t,n),a=a.sibling;Zs=i,Xs=s,Qs=u}_c(e)}else 0!==(8772&i.subtreeFlags)&&null!==a?(a.return=i,Zs=a):_c(e)}}function _c(e){for(;null!==Zs;){var t=Zs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qs||rc(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qs)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Wa(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Wa(t,s,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var d=l.memoizedState;if(null!==d){var f=d.dehydrated;null!==f&&zt(f)}}}break;default:throw Error(a(163))}Qs||512&t.flags&&ic(t)}catch(h){Cu(t,t.return,h)}}if(t===e){Zs=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zs=n;break}Zs=t.return}}function wc(e){for(;null!==Zs;){var t=Zs;if(t===e){Zs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zs=n;break}Zs=t.return}}function Ec(e){for(;null!==Zs;){var t=Zs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rc(4,t)}catch(c){Cu(t,n,c)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(c){Cu(t,i,c)}}var a=t.return;try{ic(t)}catch(c){Cu(t,a,c)}break;case 5:var o=t.return;try{ic(t)}catch(c){Cu(t,o,c)}}}catch(c){Cu(t,t.return,c)}if(t===e){Zs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Zs=s;break}Zs=t.return}}var Sc,Cc=Math.ceil,xc=_.ReactCurrentDispatcher,Tc=_.ReactCurrentOwner,Rc=_.ReactCurrentBatchConfig,Ic=0,Nc=null,Ac=null,kc=0,Dc=0,Mc=Ci(0),Lc=0,Oc=null,Pc=0,jc=0,Fc=0,Uc=null,Bc=null,Vc=0,zc=1/0,Wc=null,Gc=!1,Hc=null,Yc=null,qc=!1,Kc=null,Xc=0,Qc=0,Jc=null,Zc=-1,$c=0;function eu(){return 0!==(6&Ic)?Je():-1!==Zc?Zc:Zc=Je()}function tu(e){return 0===(1&e.mode)?1:0!==(2&Ic)&&0!==kc?kc&-kc:null!==ma.transition?(0===$c&&($c=mt()),$c):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function nu(e,t,n,r){if(50<Qc)throw Qc=0,Jc=null,Error(a(185));vt(e,n,r),0!==(2&Ic)&&e===Nc||(e===Nc&&(0===(2&Ic)&&(jc|=n),4===Lc&&su(e,kc)),ru(e,r),1===n&&0===Ic&&0===(1&t.mode)&&(zc=Je()+500,Ui&&zi()))}function ru(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,c=i[o];-1===c?0!==(s&n)&&0===(s&r)||(i[o]=ht(s,t)):c<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=ft(e,e===Nc?kc:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Ui=!0,Vi(e)}(cu.bind(null,e)):Vi(cu.bind(null,e)),oi((function(){0===(6&Ic)&&zi()})),n=null;else{switch(_t(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Nu(n,iu.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function iu(e,t){if(Zc=-1,$c=0,0!==(6&Ic))throw Error(a(327));var n=e.callbackNode;if(Eu()&&e.callbackNode!==n)return null;var r=ft(e,e===Nc?kc:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gu(e,r);else{t=r;var i=Ic;Ic|=2;var o=pu();for(Nc===e&&kc===t||(Wc=null,zc=Je()+500,fu(e,t));;)try{yu();break}catch(c){hu(e,c)}Ta(),xc.current=o,Ic=i,null!==Ac?t=0:(Nc=null,kc=0,t=Lc)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=au(e,i))),1===t)throw n=Oc,fu(e,0),su(e,r),ru(e,Je()),n;if(6===t)su(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!sr(a(),i))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gu(e,r))&&(0!==(o=pt(e))&&(r=o,t=au(e,o))),1===t))throw n=Oc,fu(e,0),su(e,r),ru(e,Je()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:wu(e,Bc,Wc);break;case 3:if(su(e,r),(130023424&r)===r&&10<(t=Vc+500-Je())){if(0!==ft(e,0))break;if(((i=e.suspendedLanes)&r)!==r){eu(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(wu.bind(null,e,Bc,Wc),t);break}wu(e,Bc,Wc);break;case 4:if(su(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>i&&(i=s),r&=~o}if(r=i,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Cc(r/1960))-r)){e.timeoutHandle=ri(wu.bind(null,e,Bc,Wc),r);break}wu(e,Bc,Wc);break;default:throw Error(a(329))}}}return ru(e,Je()),e.callbackNode===n?iu.bind(null,e):null}function au(e,t){var n=Uc;return e.current.memoizedState.isDehydrated&&(fu(e,t).flags|=256),2!==(e=gu(e,t))&&(t=Bc,Bc=n,null!==t&&ou(t)),e}function ou(e){null===Bc?Bc=e:Bc.push.apply(Bc,e)}function su(e,t){for(t&=~Fc,t&=~jc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function cu(e){if(0!==(6&Ic))throw Error(a(327));Eu();var t=ft(e,0);if(0===(1&t))return ru(e,Je()),null;var n=gu(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=au(e,r))}if(1===n)throw n=Oc,fu(e,0),su(e,t),ru(e,Je()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wu(e,Bc,Wc),ru(e,Je()),null}function uu(e,t){var n=Ic;Ic|=1;try{return e(t)}finally{0===(Ic=n)&&(zc=Je()+500,Ui&&zi())}}function lu(e){null!==Kc&&0===Kc.tag&&0===(6&Ic)&&Eu();var t=Ic;Ic|=1;var n=Rc.transition,r=bt;try{if(Rc.transition=null,bt=1,e)return e()}finally{bt=r,Rc.transition=n,0===(6&(Ic=t))&&zi()}}function du(){Dc=Mc.current,xi(Mc)}function fu(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Ac)for(n=Ac.return;null!==n;){var r=n;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Mi();break;case 3:Qa(),xi(Ni),xi(Ii),no();break;case 5:Za(r);break;case 4:Qa();break;case 13:case 19:xi($a);break;case 10:Ra(r.type._context);break;case 22:case 23:du()}n=n.return}if(Nc=e,Ac=e=Mu(e.current,null),kc=Dc=t,Lc=0,Oc=null,Fc=jc=Pc=0,Bc=Uc=null,null!==ka){for(t=0;t<ka.length;t++)if(null!==(r=(n=ka[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var o=a.next;a.next=i,r.next=o}n.pending=r}ka=null}return e}function hu(e,t){for(;;){var n=Ac;try{if(Ta(),ro.current=Zo,uo){for(var r=oo.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}uo=!1}if(ao=0,co=so=oo=null,lo=!1,fo=0,Tc.current=null,null===n||null===n.return){Lc=1,Oc=t,Ac=null;break}e:{var o=e,s=n.return,c=n,u=t;if(t=kc,c.flags|=32768,null!==u&&"object"===typeof u&&"function"===typeof u.then){var l=u,d=c,f=d.tag;if(0===(1&d.mode)&&(0===f||11===f||15===f)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,vs(p,s,c,0,t),1&p.mode&&ms(o,l,t),u=l;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(u),t.updateQueue=g}else m.add(u);break e}if(0===(1&t)){ms(o,l,t),mu();break e}u=Error(a(426))}else if(ia&&1&c.mode){var v=gs(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vs(v,s,c,0,t),pa(us(u,c));break e}}o=u=us(u,c),4!==Lc&&(Lc=2),null===Uc?Uc=[o]:Uc.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Va(o,hs(0,u,t));break e;case 1:c=u;var y=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Yc||!Yc.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Va(o,ps(o,c,t));break e}}o=o.return}while(null!==o)}_u(n)}catch(_){t=_,Ac===n&&null!==n&&(Ac=n=n.return);continue}break}}function pu(){var e=xc.current;return xc.current=Zo,null===e?Zo:e}function mu(){0!==Lc&&3!==Lc&&2!==Lc||(Lc=4),null===Nc||0===(268435455&Pc)&&0===(268435455&jc)||su(Nc,kc)}function gu(e,t){var n=Ic;Ic|=2;var r=pu();for(Nc===e&&kc===t||(Wc=null,fu(e,t));;)try{vu();break}catch(i){hu(e,i)}if(Ta(),Ic=n,xc.current=r,null!==Ac)throw Error(a(261));return Nc=null,kc=0,Lc}function vu(){for(;null!==Ac;)bu(Ac)}function yu(){for(;null!==Ac&&!Xe();)bu(Ac)}function bu(e){var t=Sc(e.alternate,e,Dc);e.memoizedProps=e.pendingProps,null===t?_u(e):Ac=t,Tc.current=null}function _u(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=qs(n,t,Dc)))return void(Ac=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Ac=n);if(null===e)return Lc=6,void(Ac=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ac=t);Ac=t=e}while(null!==t);0===Lc&&(Lc=5)}function wu(e,t,n){var r=bt,i=Rc.transition;try{Rc.transition=null,bt=1,function(e,t,n,r){do{Eu()}while(null!==Kc);if(0!==(6&Ic))throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-ot(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,o),e===Nc&&(Ac=Nc=null,kc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||qc||(qc=!0,Nu(tt,(function(){return Eu(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Rc.transition,Rc.transition=null;var s=bt;bt=1;var c=Ic;Ic|=4,Tc.current=null,function(e,t){if(ei=Gt,hr(e=fr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(w){n=null;break e}var s=0,c=-1,u=-1,l=0,d=0,f=e,h=null;t:for(;;){for(var p;f!==n||0!==i&&3!==f.nodeType||(c=s+i),f!==o||0!==r&&3!==f.nodeType||(u=s+r),3===f.nodeType&&(s+=f.nodeValue.length),null!==(p=f.firstChild);)h=f,f=p;for(;;){if(f===e)break t;if(h===n&&++l===i&&(c=s),h===o&&++d===r&&(u=s),null!==(p=f.nextSibling))break;h=(f=h).parentNode}f=p}n=-1===c||-1===u?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Gt=!1,Zs=t;null!==Zs;)if(e=(t=Zs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zs=e;else for(;null!==Zs;){t=Zs;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:ns(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var _=t.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error(a(163))}}catch(w){Cu(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Zs=e;break}Zs=t.return}m=tc,tc=!1}(e,n),gc(n,e),pr(ti),Gt=!!ei,ti=ei=null,e.current=n,yc(n,e,i),Qe(),Ic=c,bt=s,Rc.transition=o}else e.current=n;if(qc&&(qc=!1,Kc=e,Xc=i),o=e.pendingLanes,0===o&&(Yc=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ru(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Gc)throw Gc=!1,e=Hc,Hc=null,e;0!==(1&Xc)&&0!==e.tag&&Eu(),o=e.pendingLanes,0!==(1&o)?e===Jc?Qc++:(Qc=0,Jc=e):Qc=0,zi()}(e,t,n,r)}finally{Rc.transition=i,bt=r}return null}function Eu(){if(null!==Kc){var e=_t(Xc),t=Rc.transition,n=bt;try{if(Rc.transition=null,bt=16>e?16:e,null===Kc)var r=!1;else{if(e=Kc,Kc=null,Xc=0,0!==(6&Ic))throw Error(a(331));var i=Ic;for(Ic|=4,Zs=e.current;null!==Zs;){var o=Zs,s=o.child;if(0!==(16&Zs.flags)){var c=o.deletions;if(null!==c){for(var u=0;u<c.length;u++){var l=c[u];for(Zs=l;null!==Zs;){var d=Zs;switch(d.tag){case 0:case 11:case 15:nc(8,d,o)}var f=d.child;if(null!==f)f.return=d,Zs=f;else for(;null!==Zs;){var h=(d=Zs).sibling,p=d.return;if(ac(d),d===l){Zs=null;break}if(null!==h){h.return=p,Zs=h;break}Zs=p}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Zs=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Zs=s;else e:for(;null!==Zs;){if(0!==(2048&(o=Zs).flags))switch(o.tag){case 0:case 11:case 15:nc(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,Zs=y;break e}Zs=o.return}}var b=e.current;for(Zs=b;null!==Zs;){var _=(s=Zs).child;if(0!==(2064&s.subtreeFlags)&&null!==_)_.return=s,Zs=_;else e:for(s=b;null!==Zs;){if(0!==(2048&(c=Zs).flags))try{switch(c.tag){case 0:case 11:case 15:rc(9,c)}}catch(E){Cu(c,c.return,E)}if(c===s){Zs=null;break e}var w=c.sibling;if(null!==w){w.return=c.return,Zs=w;break e}Zs=c.return}}if(Ic=i,zi(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(it,e)}catch(E){}r=!0}return r}finally{bt=n,Rc.transition=t}}return!1}function Su(e,t,n){e=Ua(e,t=hs(0,t=us(n,t),1),1),t=eu(),null!==e&&(vt(e,1,t),ru(e,t))}function Cu(e,t,n){if(3===e.tag)Su(e,e,n);else for(;null!==t;){if(3===t.tag){Su(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Yc||!Yc.has(r))){t=Ua(t,e=ps(t,e=us(n,e),1),1),e=eu(),null!==t&&(vt(t,1,e),ru(t,e));break}}t=t.return}}function xu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=eu(),e.pingedLanes|=e.suspendedLanes&n,Nc===e&&(kc&n)===n&&(4===Lc||3===Lc&&(130023424&kc)===kc&&500>Je()-Vc?fu(e,0):Fc|=n),ru(e,t)}function Tu(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=eu();null!==(e=La(e,t))&&(vt(e,t,n),ru(e,n))}function Ru(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tu(e,n)}function Iu(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Tu(e,n)}function Nu(e,t){return qe(e,t)}function Au(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ku(e,t,n,r){return new Au(e,t,n,r)}function Du(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Mu(e,t){var n=e.alternate;return null===n?((n=ku(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lu(e,t,n,r,i,o){var s=2;if(r=e,"function"===typeof e)Du(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Ou(n.children,i,o,t);case C:s=8,i|=8;break;case x:return(e=ku(12,n,t,2|i)).elementType=x,e.lanes=o,e;case N:return(e=ku(13,n,t,i)).elementType=N,e.lanes=o,e;case A:return(e=ku(19,n,t,i)).elementType=A,e.lanes=o,e;case M:return Pu(n,i,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:s=10;break e;case R:s=9;break e;case I:s=11;break e;case k:s=14;break e;case D:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=ku(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Ou(e,t,n,r){return(e=ku(7,e,r,t)).lanes=n,e}function Pu(e,t,n,r){return(e=ku(22,e,r,t)).elementType=M,e.lanes=n,e.stateNode={isHidden:!1},e}function ju(e,t,n){return(e=ku(6,e,null,t)).lanes=n,e}function Fu(e,t,n){return(t=ku(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uu(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Bu(e,t,n,r,i,a,o,s,c){return e=new Uu(e,t,n,s,c),1===t?(t=1,!0===a&&(t|=8)):t=0,a=ku(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pa(a),e}function Vu(e){if(!e)return Ri;e:{if(ze(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Di(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Di(n))return Oi(e,n,t)}return t}function zu(e,t,n,r,i,a,o,s,c){return(e=Bu(n,r,!0,e,0,a,0,s,c)).context=Vu(null),n=e.current,(a=Fa(r=eu(),i=tu(n))).callback=void 0!==t&&null!==t?t:null,Ua(n,a,i),e.current.lanes=i,vt(e,i,r),ru(e,r),e}function Wu(e,t,n,r){var i=t.current,a=eu(),o=tu(i);return n=Vu(n),null===t.context?t.context=n:t.pendingContext=n,(t=Fa(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ua(i,t,o))&&(nu(e,i,o,a),Ba(e,i,o)),o}function Gu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Yu(e,t){Hu(e,t),(e=e.alternate)&&Hu(e,t)}Sc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ni.current)bs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bs=!1,function(e,t,n){switch(t.tag){case 3:Ns(t),ha();break;case 5:Ja(t);break;case 1:Di(t.type)&&Pi(t);break;case 4:Xa(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ti(Ea,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ti($a,1&$a.current),t.flags|=128,null):0!==(n&t.child.childLanes)?js(e,t,n):(Ti($a,1&$a.current),null!==(e=Gs(e,t,n))?e.sibling:null);Ti($a,1&$a.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return zs(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ti($a,$a.current),r)break;return null;case 22:case 23:return t.lanes=0,Cs(e,t,n)}return Gs(e,t,n)}(e,t,n);bs=0!==(131072&e.flags)}else bs=!1,ia&&0!==(1048576&t.flags)&&$i(t,Yi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ws(e,t),e=t.pendingProps;var i=ki(t,Ii.current);Na(t,n),i=go(null,t,r,e,i,n);var o=vo();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Di(r)?(o=!0,Pi(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Pa(t),i.updater=is,t.stateNode=i,i._reactInternals=t,cs(t,r,e,n),t=Is(null,t,r,!0,o,n)):(t.tag=0,ia&&o&&ea(t),_s(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ws(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Du(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===I)return 11;if(e===k)return 14}return 2}(r),e=ns(r,e),i){case 0:t=Ts(null,t,r,e,n);break e;case 1:t=Rs(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=Es(null,t,r,ns(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ts(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 1:return r=t.type,i=t.pendingProps,Rs(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 3:e:{if(Ns(t),null===e)throw Error(a(387));r=t.pendingProps,i=(o=t.memoizedState).element,ja(e,t),za(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=As(e,t,r,n,i=us(Error(a(423)),t));break e}if(r!==i){t=As(e,t,r,n,i=us(Error(a(424)),t));break e}for(ra=ui(t.stateNode.containerInfo.firstChild),na=t,ia=!0,aa=null,n=wa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ha(),r===i){t=Gs(e,t,n);break e}_s(e,t,r,n)}t=t.child}return t;case 5:return Ja(t),null===e&&ua(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,ni(r,i)?s=null:null!==o&&ni(r,o)&&(t.flags|=32),xs(e,t),_s(e,t,s,n),t.child;case 6:return null===e&&ua(t),null;case 13:return js(e,t,n);case 4:return Xa(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=_a(t,null,r,n):_s(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,ws(e,t,r,i=t.elementType===r?i:ns(r,i),n);case 7:return _s(e,t,t.pendingProps,n),t.child;case 8:case 12:return _s(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value,Ti(Ea,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===i.children&&!Ni.current){t=Gs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var c=o.dependencies;if(null!==c){s=o.child;for(var u=c.firstContext;null!==u;){if(u.context===r){if(1===o.tag){(u=Fa(-1,n&-n)).tag=2;var l=o.updateQueue;if(null!==l){var d=(l=l.shared).pending;null===d?u.next=u:(u.next=d.next,d.next=u),l.pending=u}}o.lanes|=n,null!==(u=o.alternate)&&(u.lanes|=n),Ia(o.return,n,t),c.lanes|=n;break}u=u.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Ia(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}_s(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Na(t,n),r=r(i=Aa(i)),t.flags|=1,_s(e,t,r,n),t.child;case 14:return i=ns(r=t.type,t.pendingProps),Es(e,t,r,i=ns(r.type,i),n);case 15:return Ss(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:ns(r,i),Ws(e,t),t.tag=1,Di(r)?(e=!0,Pi(t)):e=!1,Na(t,n),os(t,r,i),cs(t,r,i,n),Is(null,t,r,!0,e,n);case 19:return zs(e,t,n);case 22:return Cs(e,t,n)}throw Error(a(156,t.tag))};var qu="function"===typeof reportError?reportError:function(e){console.error(e)};function Ku(e){this._internalRoot=e}function Xu(e){this._internalRoot=e}function Qu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Ju(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zu(){}function $u(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof i){var s=i;i=function(){var e=Gu(o);s.call(e)}}Wu(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"===typeof r){var a=r;r=function(){var e=Gu(o);a.call(e)}}var o=zu(t,r,e,0,null,!1,0,"",Zu);return e._reactRootContainer=o,e[pi]=o.current,zr(8===e.nodeType?e.parentNode:e),lu(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var s=r;r=function(){var e=Gu(c);s.call(e)}}var c=Bu(e,0,!1,null,0,!1,0,"",Zu);return e._reactRootContainer=c,e[pi]=c.current,zr(8===e.nodeType?e.parentNode:e),lu((function(){Wu(t,c,n,r)})),c}(n,t,e,i,r);return Gu(o)}Xu.prototype.render=Ku.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Wu(e,t,null,null)},Xu.prototype.unmount=Ku.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lu((function(){Wu(null,e,null,null)})),t[pi]=null}},Xu.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ct();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Mt.length&&0!==t&&t<Mt[n].priority;n++);Mt.splice(n,0,e),0===n&&jt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),ru(t,Je()),0===(6&Ic)&&(zc=Je()+500,zi()))}break;case 13:lu((function(){var t=La(e,1);if(null!==t){var n=eu();nu(t,e,1,n)}})),Yu(e,1)}},Et=function(e){if(13===e.tag){var t=La(e,134217728);if(null!==t)nu(t,e,134217728,eu());Yu(e,134217728)}},St=function(e){if(13===e.tag){var t=tu(e),n=La(e,t);if(null!==n)nu(n,e,t,eu());Yu(e,t)}},Ct=function(){return bt},xt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Ee=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=wi(r);if(!i)throw Error(a(90));q(r),Z(r,i)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ie=uu,Ne=lu;var el={usingClientEntryPoint:!1,Events:[bi,_i,wi,Te,Re,uu]},tl={findFiberByHostInstance:yi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nl={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rl.isDisabled&&rl.supportsFiber)try{it=rl.inject(nl),at=rl}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=el,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qu(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qu(e))throw Error(a(299));var n=!1,r="",i=qu;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Bu(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,zr(8===e.nodeType?e.parentNode:e),new Ku(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return lu(e)},t.hydrate=function(e,t,n){if(!Ju(t))throw Error(a(200));return $u(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qu(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",s=qu;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=zu(t,null,e,1,null!=n?n:null,i,0,o,s),e[pi]=t.current,zr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Xu(t)},t.render=function(e,t,n){if(!Ju(t))throw Error(a(200));return $u(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Ju(e))throw Error(a(40));return!!e._reactRootContainer&&(lu((function(){$u(null,null,e,!1,(function(){e._reactRootContainer=null,e[pi]=null}))})),!0)},t.unstable_batchedUpdates=uu,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Ju(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return $u(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},2763:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e,t){(0,i.A)(2,arguments);var n=(0,r.default)(e).getTime(),a=(0,r.default)(t.start).getTime(),o=(0,r.default)(t.end).getTime();if(!(a<=o))throw new RangeError("Invalid interval");return n>=a&&n<=o}},2959:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=function(){console.log("portalOpenInstances ----------"),console.log(r.openInstances.length),r.openInstances.forEach((function(e){return console.log(e)})),console.log("end portalOpenInstances ----------")},t.resetState=function(){r=new n};var n=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.register=function(e){-1===t.openInstances.indexOf(e)&&(t.openInstances.push(e),t.emit("register"))},this.deregister=function(e){var n=t.openInstances.indexOf(e);-1!==n&&(t.openInstances.splice(n,1),t.emit("deregister"))},this.subscribe=function(e){t.subscribers.push(e)},this.emit=function(e){t.subscribers.forEach((function(n){return n(e,t.openInstances.slice())}))},this.openInstances=[],this.subscribers=[]},r=new n;t.default=r},2963:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(5765),a=(r=i)&&r.__esModule?r:{default:r};t.default=a.default,e.exports=t.default},3035:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){(0,i.A)(1,arguments);var t=(0,r.default)(e),n=new Date(0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n}},3218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},3274:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e,t){(0,i.A)(2,arguments);var n=(0,r.default)(e),a=(0,r.default)(t);return n.getTime()<a.getTime()}},3306:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){return(0,i.A)(1,arguments),(0,r.default)(e).getHours()}},3367:()=>{},3515:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e,t){(0,i.A)(2,arguments);var n=(0,r.default)(e),a=(0,r.default)(t);return n.getTime()===a.getTime()}},3763:(e,t,n)=>{"use strict";e.exports=n(4983)},4161:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(5126),i=n(8726),a=n(6191);function o(e,t){var n;(0,i.A)(1,arguments);var o=(0,a.A)(null!==(n=null===t||void 0===t?void 0:t.additionalDigits)&&void 0!==n?n:2);if(2!==o&&1!==o&&0!==o)throw new RangeError("additionalDigits must be 0, 1 or 2");if("string"!==typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var m,g=function(e){var t,n={},r=e.split(s.dateTimeDelimiter);if(r.length>2)return n;/:/.test(r[0])?t=r[0]:(n.date=r[0],t=r[1],s.timeZoneDelimiter.test(n.date)&&(n.date=e.split(s.timeZoneDelimiter)[0],t=e.substr(n.date.length,e.length)));if(t){var i=s.timezone.exec(t);i?(n.time=t.replace(i[1],""),n.timezone=i[1]):n.time=t}return n}(e);if(g.date){var v=function(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(n);if(!r)return{year:NaN,restDateString:""};var i=r[1]?parseInt(r[1]):null,a=r[2]?parseInt(r[2]):null;return{year:null===a?i:100*a,restDateString:e.slice((r[1]||r[2]).length)}}(g.date,o);m=function(e,t){if(null===t)return new Date(NaN);var n=e.match(c);if(!n)return new Date(NaN);var r=!!n[4],i=d(n[1]),a=d(n[2])-1,o=d(n[3]),s=d(n[4]),u=d(n[5])-1;if(r)return function(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}(0,s,u)?function(e,t,n){var r=new Date(0);r.setUTCFullYear(e,0,4);var i=r.getUTCDay()||7,a=7*(t-1)+n+1-i;return r.setUTCDate(r.getUTCDate()+a),r}(t,s,u):new Date(NaN);var l=new Date(0);return function(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(h[t]||(p(e)?29:28))}(t,a,o)&&function(e,t){return t>=1&&t<=(p(e)?366:365)}(t,i)?(l.setUTCFullYear(t,a,Math.max(i,o)),l):new Date(NaN)}(v.restDateString,v.year)}if(!m||isNaN(m.getTime()))return new Date(NaN);var y,b=m.getTime(),_=0;if(g.time&&(_=function(e){var t=e.match(u);if(!t)return NaN;var n=f(t[1]),i=f(t[2]),a=f(t[3]);if(!function(e,t,n){if(24===e)return 0===t&&0===n;return n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}(n,i,a))return NaN;return n*r.s0+i*r.Cg+1e3*a}(g.time),isNaN(_)))return new Date(NaN);if(!g.timezone){var w=new Date(b+_),E=new Date(0);return E.setFullYear(w.getUTCFullYear(),w.getUTCMonth(),w.getUTCDate()),E.setHours(w.getUTCHours(),w.getUTCMinutes(),w.getUTCSeconds(),w.getUTCMilliseconds()),E}return y=function(e){if("Z"===e)return 0;var t=e.match(l);if(!t)return 0;var n="+"===t[1]?-1:1,i=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;if(!function(e,t){return t>=0&&t<=59}(0,a))return NaN;return n*(i*r.s0+a*r.Cg)}(g.timezone),isNaN(y)?new Date(NaN):new Date(b+_+y)}var s={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},c=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,u=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,l=/^([+-])(\d{2})(?::?(\d{2}))?$/;function d(e){return e?parseInt(e):1}function f(e){return e&&parseFloat(e.replace(",","."))||0}var h=[31,null,31,30,31,30,31,31,30,31,30,31];function p(e){return e%400===0||e%4===0&&e%100!==0}},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),h=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var _=b.prototype=new y;_.constructor=b,m(_,v.prototype),_.isPureReactComponent=!0;var w=Array.isArray,E=Object.prototype.hasOwnProperty,S={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function x(e,t,r){var i,a={},o=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)E.call(t,i)&&!C.hasOwnProperty(i)&&(a[i]=t[i]);var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];a.children=u}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===a[i]&&(a[i]=c[i]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:S.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var R=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function N(e,t,i,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return o=o(c=e),e=""===a?"."+I(c,0):a,w(o)?(i="",null!=e&&(i=e.replace(R,"$&/")+"/"),N(o,t,i,"",(function(e){return e}))):null!=o&&(T(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(R,"$&/")+"/")+e)),t.push(o)),1;if(c=0,a=""===a?".":a+":",w(e))for(var u=0;u<e.length;u++){var l=a+I(s=e[u],u);c+=N(s,t,i,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),u=0;!(s=e.next()).done;)c+=N(s=s.value,t,i,l=a+I(s,u++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function A(e,t,n){if(null==e)return e;var r=[],i=0;return N(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function k(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},M={transition:null},L={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:M,ReactCurrentOwner:S};function O(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=i,t.Profiler=o,t.PureComponent=b,t.StrictMode=a,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.act=O,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)E.call(t,u)&&!C.hasOwnProperty(u)&&(i[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){c=Array(u);for(var l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}return{$$typeof:n,type:e.type,key:a,ref:o,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=x,t.createFactory=function(e){var t=x.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},t.unstable_act=O,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},4375:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(2550),i=n(8726),a=n(6191);function o(e,t){(0,i.A)(2,arguments);var n=(0,a.A)(t);return(0,r.A)(e,-n)}},4391:(e,t,n)=>{"use strict";var r=n(7950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4467:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(816);function i(e,t,n){return(t=(0,r.A)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},4489:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(2284),i=n(888),a=n(8726);function o(e){var t,n;if((0,a.A)(1,arguments),e&&"function"===typeof e.forEach)t=e;else{if("object"!==(0,r.A)(e)||null===e)return new Date(NaN);t=Array.prototype.slice.call(e)}return t.forEach((function(e){var t=(0,i.default)(e);(void 0===n||n<t||isNaN(Number(t)))&&(n=t)})),n||new Date(NaN)}},4561:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(9566),i=n(8726);function a(e,t){(0,i.A)(2,arguments);var n=(0,r.default)(e),a=(0,r.default)(t);return n.getTime()===a.getTime()}},4682:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){var n=[].slice.call(t.querySelectorAll("*"),0).reduce((function(t,n){return t.concat(n.shadowRoot?e(n.shadowRoot):[n])}),[]);return n.filter(s)};var n="none",r="contents",i=/^(input|select|textarea|button|object|iframe)$/;function a(e){var t=e.offsetWidth<=0&&e.offsetHeight<=0;if(t&&!e.innerHTML)return!0;try{var i=window.getComputedStyle(e),a=i.getPropertyValue("display");return t?a!==r&&function(e,t){return"visible"!==t.getPropertyValue("overflow")||e.scrollWidth<=0&&e.scrollHeight<=0}(e,i):a===n}catch(o){return console.warn("Failed to inspect element style"),!1}}function o(e,t){var n=e.nodeName.toLowerCase();return(i.test(n)&&!e.disabled||"a"===n&&e.href||t)&&function(e){for(var t=e,n=e.getRootNode&&e.getRootNode();t&&t!==document.body;){if(n&&t===n&&(t=n.host.parentNode),a(t))return!1;t=t.parentNode}return!0}(e)}function s(e){var t=e.getAttribute("tabindex");null===t&&(t=void 0);var n=isNaN(t);return(n||t>=0)&&o(e,!n)}e.exports=t.default},4841:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){var e=document.getElementsByTagName("html")[0];for(var t in n)i(e,n[t]);var a=document.body;for(var o in r)i(a,r[o]);n={},r={}},t.log=function(){0};var n={},r={};function i(e,t){e.classList.remove(t)}t.add=function(e,t){return i=e.classList,a="html"==e.nodeName.toLowerCase()?n:r,void t.split(" ").forEach((function(e){!function(e,t){e[t]||(e[t]=0),e[t]+=1}(a,e),i.add(e)}));var i,a},t.remove=function(e,t){return i=e.classList,a="html"==e.nodeName.toLowerCase()?n:r,void t.split(" ").forEach((function(e){!function(e,t){e[t]&&(e[t]-=1)}(a,e),0===a[e]&&i.remove(e)}));var i,a}},4860:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>L});var r=n(97),i=n(4375),a=n(888),o=n(8726);var s=n(7532),c=n(7780),u=n(1209),l=n(2637);function d(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}const f={y:function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return d("yy"===t?r%100:r,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):d(n+1,2)},d:function(e,t){return d(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return d(e.getUTCHours()%12||12,t.length)},H:function(e,t){return d(e.getUTCHours(),t.length)},m:function(e,t){return d(e.getUTCMinutes(),t.length)},s:function(e,t){return d(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,r=e.getUTCMilliseconds();return d(Math.floor(r*Math.pow(10,n-3)),t.length)}};var h="midnight",p="noon",m="morning",g="afternoon",v="evening",y="night";function b(e,t){var n=e>0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),a=r%60;if(0===a)return n+String(i);var o=t||"";return n+String(i)+o+d(a,2)}function _(e,t){return e%60===0?(e>0?"-":"+")+d(Math.abs(e)/60,2):w(e,t)}function w(e,t){var n=t||"",r=e>0?"-":"+",i=Math.abs(e);return r+d(Math.floor(i/60),2)+n+d(i%60,2)}const E={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return f.y(e,t)},Y:function(e,t,n,r){var i=(0,l.A)(e,r),a=i>0?i:1-i;return"YY"===t?d(a%100,2):"Yo"===t?n.ordinalNumber(a,{unit:"year"}):d(a,t.length)},R:function(e,t){return d((0,c.A)(e),t.length)},u:function(e,t){return d(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return d(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return d(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return f.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return d(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var i=(0,u.A)(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):d(i,t.length)},I:function(e,t,n){var r=(0,s.A)(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):d(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):f.d(e,t)},D:function(e,t,n){var r=function(e){(0,o.A)(1,arguments);var t=(0,a.default)(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=n-t.getTime();return Math.floor(r/864e5)+1}(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):d(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return d(a,2);case"eo":return n.ordinalNumber(a,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return d(a,t.length);case"co":return n.ordinalNumber(a,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return d(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,i=e.getUTCHours();switch(r=12===i?p:0===i?h:i/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,i=e.getUTCHours();switch(r=i>=17?v:i>=12?g:i>=4?m:y,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return f.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):f.H(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):d(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):d(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):f.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):f.s(e,t)},S:function(e,t){return f.S(e,t)},X:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();if(0===i)return"Z";switch(t){case"X":return _(i);case"XXXX":case"XX":return w(i);default:return w(i,":")}},x:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return _(i);case"xxxx":case"xx":return w(i);default:return w(i,":")}},O:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+b(i,":");default:return"GMT"+w(i,":")}},z:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+b(i,":");default:return"GMT"+w(i,":")}},t:function(e,t,n,r){var i=r._originalDate||e;return d(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,n,r){return d((r._originalDate||e).getTime(),t.length)}};var S=n(8435),C=n(8539),x=n(2058),T=n(6191),R=n(8171),I=n(364),N=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,A=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,k=/^'([^]*?)'?$/,D=/''/g,M=/[a-zA-Z]/;function L(e,t,n){var s,c,u,l,d,f,h,p,m,g,v,y,b,_,w,L,O,P;(0,o.A)(2,arguments);var j=String(t),F=(0,R.q)(),U=null!==(s=null!==(c=null===n||void 0===n?void 0:n.locale)&&void 0!==c?c:F.locale)&&void 0!==s?s:I.A,B=(0,T.A)(null!==(u=null!==(l=null!==(d=null!==(f=null===n||void 0===n?void 0:n.firstWeekContainsDate)&&void 0!==f?f:null===n||void 0===n||null===(h=n.locale)||void 0===h||null===(p=h.options)||void 0===p?void 0:p.firstWeekContainsDate)&&void 0!==d?d:F.firstWeekContainsDate)&&void 0!==l?l:null===(m=F.locale)||void 0===m||null===(g=m.options)||void 0===g?void 0:g.firstWeekContainsDate)&&void 0!==u?u:1);if(!(B>=1&&B<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var V=(0,T.A)(null!==(v=null!==(y=null!==(b=null!==(_=null===n||void 0===n?void 0:n.weekStartsOn)&&void 0!==_?_:null===n||void 0===n||null===(w=n.locale)||void 0===w||null===(L=w.options)||void 0===L?void 0:L.weekStartsOn)&&void 0!==b?b:F.weekStartsOn)&&void 0!==y?y:null===(O=F.locale)||void 0===O||null===(P=O.options)||void 0===P?void 0:P.weekStartsOn)&&void 0!==v?v:0);if(!(V>=0&&V<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!U.localize)throw new RangeError("locale must contain localize property");if(!U.formatLong)throw new RangeError("locale must contain formatLong property");var z=(0,a.default)(e);if(!(0,r.default)(z))throw new RangeError("Invalid time value");var W=(0,C.A)(z),G=(0,i.A)(z,W),H={firstWeekContainsDate:B,weekStartsOn:V,locale:U,_originalDate:z};return j.match(A).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,S.A[t])(e,U.formatLong):e})).join("").match(N).map((function(r){if("''"===r)return"'";var i=r[0];if("'"===i)return function(e){var t=e.match(k);if(!t)return e;return t[1].replace(D,"'")}(r);var a=E[i];if(a)return null!==n&&void 0!==n&&n.useAdditionalWeekYearTokens||!(0,x.xM)(r)||(0,x.lJ)(r,t,String(e)),null!==n&&void 0!==n&&n.useAdditionalDayOfYearTokens||!(0,x.ef)(r)||(0,x.lJ)(r,t,String(e)),a(G,r,U.localize,H);if(i.match(M))throw new RangeError("Format string contains an unescaped latin alphabet character `"+i+"`");return r})).join("")}},4872:function(e,t,n){e.exports=function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e),i=n(t);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function c(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)),r}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};for(var n,r={},i=Object.keys(e),a=0;a<i.length;a++)n=i[a],0<=t.indexOf(n)||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),a=0;a<i.length;a++)n=i[a],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(t){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var e,r,i=l(t);return!(r=n?(e=l(this).constructor,Reflect.construct(i,arguments,e)):i.apply(this,arguments))||"object"!=typeof r&&"function"!=typeof r?h(this):r}}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}(e,t)||g(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){return new Promise((function(n,r){var i,a=new Image;a.onload=function(){return n(a)},a.onerror=r,0==(null!==(i=e)&&!!i.match(/^\s*data:([a-z]+\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\-._~:@/?%\s]*\s*$/i))&&t&&(a.crossOrigin=t),a.src=e}))}var b,_=!("undefined"==typeof window||"undefined"==typeof navigator||!("ontouchstart"in window||0<navigator.msMaxTouchPoints)),w="undefined"!=typeof File,E={touch:{react:{down:"onTouchStart",mouseDown:"onMouseDown",drag:"onTouchMove",move:"onTouchMove",mouseMove:"onMouseMove",up:"onTouchEnd",mouseUp:"onMouseUp"},native:{down:"touchstart",mouseDown:"mousedown",drag:"touchmove",move:"touchmove",mouseMove:"mousemove",up:"touchend",mouseUp:"mouseup"}},desktop:{react:{down:"onMouseDown",drag:"onDragOver",move:"onMouseMove",up:"onMouseUp"},native:{down:"mousedown",drag:"dragStart",move:"mousemove",up:"mouseup"}}},S=_?E.touch:E.desktop,C="undefined"!=typeof window&&window.devicePixelRatio?window.devicePixelRatio:1,x={x:.5,y:.5},T=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(c,i.default.Component);var e,t,n,r=p(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),o(h(t=r.call(this,e)),"state",{drag:!1,my:null,mx:null,image:x}),o(h(t),"handleImageReady",(function(e){var n=t.getInitialSize(e.width,e.height);n.resource=e,n.x=.5,n.y=.5,n.backgroundColor=t.props.backgroundColor,t.setState({drag:!1,image:n},t.props.onImageReady),t.props.onLoadSuccess(n)})),o(h(t),"clearImage",(function(){t.canvas.getContext("2d").clearRect(0,0,t.canvas.width,t.canvas.height),t.setState({image:x})})),o(h(t),"handleMouseDown",(function(e){(e=e||window.event).preventDefault(),t.setState({drag:!0,mx:null,my:null})})),o(h(t),"handleMouseUp",(function(){t.state.drag&&(t.setState({drag:!1}),t.props.onMouseUp())})),o(h(t),"handleMouseMove",(function(e){var n,r,i,a,o,s,c,l,d,f,h,p,m,g,v,y;e=e||window.event,!1!==t.state.drag&&(e.preventDefault(),i={mx:n=e.targetTouches?e.targetTouches[0].pageX:e.clientX,my:r=e.targetTouches?e.targetTouches[0].pageY:e.clientY},y=t.props.rotate,y=(y%=360)<0?y+360:y,t.state.mx&&t.state.my&&(a=t.state.mx-n,o=t.state.my-r,s=t.state.image.width*t.props.scale,c=t.state.image.height*t.props.scale,d=(l=t.getCroppingRect()).x,f=l.y,d*=s,f*=c,h=function(e){return e*(Math.PI/180)},p=Math.cos(h(y)),g=f+-a*(m=Math.sin(h(y)))+o*p,v={x:(d+a*p+o*m)/s+1/t.props.scale*t.getXScale()/2,y:g/c+1/t.props.scale*t.getYScale()/2},t.props.onPositionChange(v),i.image=u(u({},t.state.image),v)),t.setState(i),t.props.onMouseMove(e))})),o(h(t),"setCanvas",(function(e){t.canvas=e})),t.canvas=null,t}return e=c,(t=[{key:"componentDidMount",value:function(){this.props.disableHiDPIScaling&&(C=1);var e,t,n=this.canvas.getContext("2d");this.props.image&&this.loadImage(this.props.image),this.paint(n),document&&(e=!!function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){e=!1}return e}()&&{passive:!1},t=S.native,document.addEventListener(t.move,this.handleMouseMove,e),document.addEventListener(t.up,this.handleMouseUp,e),_&&(document.addEventListener(t.mouseMove,this.handleMouseMove,e),document.addEventListener(t.mouseUp,this.handleMouseUp,e)))}},{key:"componentDidUpdate",value:function(e,t){this.props.image&&this.props.image!==e.image||this.props.width!==e.width||this.props.height!==e.height||this.props.backgroundColor!==e.backgroundColor?this.loadImage(this.props.image):this.props.image||t.image===x||this.clearImage();var n=this.canvas.getContext("2d");n.clearRect(0,0,this.canvas.width,this.canvas.height),this.paint(n),this.paintImage(n,this.state.image,this.props.border),e.image===this.props.image&&e.width===this.props.width&&e.height===this.props.height&&e.position===this.props.position&&e.scale===this.props.scale&&e.rotate===this.props.rotate&&t.my===this.state.my&&t.mx===this.state.mx&&t.image.x===this.state.image.x&&t.image.y===this.state.image.y&&t.backgroundColor===this.state.backgroundColor||this.props.onImageChange()}},{key:"componentWillUnmount",value:function(){var e;document&&(e=S.native,document.removeEventListener(e.move,this.handleMouseMove,!1),document.removeEventListener(e.up,this.handleMouseUp,!1),_&&(document.removeEventListener(e.mouseMove,this.handleMouseMove,!1),document.removeEventListener(e.mouseUp,this.handleMouseUp,!1)))}},{key:"isVertical",value:function(){return!this.props.disableCanvasRotation&&this.props.rotate%180!=0}},{key:"getBorders",value:function(e){var t=0<arguments.length&&void 0!==e?e:this.props.border;return Array.isArray(t)?t:[t,t]}},{key:"getDimensions",value:function(){var e=this.props,t=e.width,n=e.height,r=e.rotate,i=e.border,a={},o=m(this.getBorders(i),2),s=o[0],c=o[1],u=t,l=n;return this.isVertical()?(a.width=l,a.height=u):(a.width=u,a.height=l),a.width+=2*s,a.height+=2*c,{canvas:a,rotate:r,width:t,height:n,border:i}}},{key:"getImage",value:function(){var e=this.getCroppingRect(),t=this.state.image;e.x*=t.resource.width,e.y*=t.resource.height,e.width*=t.resource.width,e.height*=t.resource.height;var n=document.createElement("canvas");this.isVertical()?(n.width=e.height,n.height=e.width):(n.width=e.width,n.height=e.height);var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),r.rotate(this.props.rotate*Math.PI/180),r.translate(-n.width/2,-n.height/2),this.isVertical()&&r.translate((n.width-n.height)/2,(n.height-n.width)/2),t.backgroundColor&&(r.fillStyle=t.backgroundColor,r.fillRect(-e.x,-e.y,t.resource.width,t.resource.height)),r.drawImage(t.resource,-e.x,-e.y),n}},{key:"getImageScaledToCanvas",value:function(){var e=this.getDimensions(),t=e.width,n=e.height,r=document.createElement("canvas");return this.isVertical()?(r.width=n,r.height=t):(r.width=t,r.height=n),this.paintImage(r.getContext("2d"),this.state.image,0,1),r}},{key:"getXScale",value:function(){var e=this.props.width/this.props.height,t=this.state.image.width/this.state.image.height;return Math.min(1,e/t)}},{key:"getYScale",value:function(){var e=this.props.height/this.props.width,t=this.state.image.height/this.state.image.width;return Math.min(1,e/t)}},{key:"getCroppingRect",value:function(){var e=this.props.position||{x:this.state.image.x,y:this.state.image.y},t=1/this.props.scale*this.getXScale(),n=1/this.props.scale*this.getYScale(),r={x:e.x-t/2,y:e.y-n/2,width:t,height:n},i=0,a=1-r.width,o=0,s=1-r.height;return(this.props.disableBoundaryChecks||1<t||1<n)&&(i=-r.width,o=-r.height,s=a=1),u(u({},r),{},{x:Math.max(i,Math.min(r.x,a)),y:Math.max(o,Math.min(r.y,s))})}},{key:"loadImage",value:function(e){var t;w&&e instanceof File?this.loadingImage=(t=e,new Promise((function(e,n){var r=new FileReader;r.onload=function(t){try{var r=y(t.target.result);e(r)}catch(t){n(t)}},r.readAsDataURL(t)})).then(this.handleImageReady).catch(this.props.onLoadFailure)):"string"==typeof e&&(this.loadingImage=y(e,this.props.crossOrigin).then(this.handleImageReady).catch(this.props.onLoadFailure))}},{key:"getInitialSize",value:function(e,t){var n,r,i=this.getDimensions();return t/e<i.height/i.width?r=e*((n=this.getDimensions().height)/t):n=t*((r=this.getDimensions().width)/e),{height:n,width:r}}},{key:"paintImage",value:function(e,t,n,r){var i,a=3<arguments.length&&void 0!==r?r:C;t.resource&&(i=this.calculatePosition(t,n),e.save(),e.translate(e.canvas.width/2,e.canvas.height/2),e.rotate(this.props.rotate*Math.PI/180),e.translate(-e.canvas.width/2,-e.canvas.height/2),this.isVertical()&&e.translate((e.canvas.width-e.canvas.height)/2,(e.canvas.height-e.canvas.width)/2),e.scale(a,a),e.globalCompositeOperation="destination-over",e.drawImage(t.resource,i.x,i.y,i.width,i.height),t.backgroundColor&&(e.fillStyle=t.backgroundColor,e.fillRect(i.x,i.y,i.width,i.height)),e.restore())}},{key:"calculatePosition",value:function(e,t){e=e||this.state.image;var n=m(this.getBorders(t),2),r=n[0],i=n[1],a=this.getCroppingRect(),o=e.width*this.props.scale,s=e.height*this.props.scale,c=-a.x*o,u=-a.y*s;return this.isVertical()?(c+=i,u+=r):(c+=r,u+=i),{x:c,y:u,height:s,width:o}}},{key:"paint",value:function(e){e.save(),e.scale(C,C),e.translate(0,0),e.fillStyle="rgba("+this.props.color.slice(0,4).join(",")+")";var t,n,r,i,a,o,s,c,u=this.props.borderRadius,l=this.getDimensions(),d=m(this.getBorders(l.border),2),f=d[0],h=d[1],p=l.canvas.height,g=l.canvas.width;u=Math.max(u,0),u=Math.min(u,g/2-f,p/2-h),e.beginPath(),t=e,i=g-2*(n=f),a=p-2*(r=h),0===(o=u)?t.rect(n,r,i,a):(s=i-o,c=a-o,t.translate(n,r),t.arc(o,o,o,Math.PI,1.5*Math.PI),t.lineTo(s,0),t.arc(s,o,o,1.5*Math.PI,2*Math.PI),t.lineTo(i,c),t.arc(s,c,o,2*Math.PI,.5*Math.PI),t.lineTo(o,a),t.arc(o,c,o,.5*Math.PI,Math.PI),t.translate(-n,-r)),e.rect(g,0,-g,p),e.fill("evenodd"),e.restore()}},{key:"render",value:function(){var e=this.props,t=(e.scale,e.rotate,e.image,e.border,e.borderRadius,e.width,e.height,e.position,e.color,e.backgroundColor,e.style),n=(e.crossOrigin,e.onLoadFailure,e.onLoadSuccess,e.onImageReady,e.onImageChange,e.onMouseUp,e.onMouseMove,e.onPositionChange,e.disableBoundaryChecks,e.disableHiDPIScaling,e.disableCanvasRotation,f(e,["scale","rotate","image","border","borderRadius","width","height","position","color","backgroundColor","style","crossOrigin","onLoadFailure","onLoadSuccess","onImageReady","onImageChange","onMouseUp","onMouseMove","onPositionChange","disableBoundaryChecks","disableHiDPIScaling","disableCanvasRotation"])),r=this.getDimensions(),a={width:r.canvas.width,height:r.canvas.height,cursor:this.state.drag?"grabbing":"grab",touchAction:"none"},o={width:r.canvas.width*C,height:r.canvas.height*C,style:u(u({},a),t)};return o[S.react.down]=this.handleMouseDown,_&&(o[S.react.mouseDown]=this.handleMouseDown),i.default.createElement("canvas",s({ref:this.setCanvas},o,n))}}])&&a(e.prototype,t),n&&a(e,n),c}();return o(T,"propTypes",{scale:r.default.number,rotate:r.default.number,image:r.default.oneOfType([r.default.string].concat(function(e){if(Array.isArray(e))return v(e)}(b=w?[r.default.instanceOf(File)]:[])||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(b)||g(b)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),border:r.default.oneOfType([r.default.number,r.default.arrayOf(r.default.number)]),borderRadius:r.default.number,width:r.default.number,height:r.default.number,position:r.default.shape({x:r.default.number,y:r.default.number}),color:r.default.arrayOf(r.default.number),backgroundColor:r.default.string,crossOrigin:r.default.oneOf(["","anonymous","use-credentials"]),onLoadFailure:r.default.func,onLoadSuccess:r.default.func,onImageReady:r.default.func,onImageChange:r.default.func,onMouseUp:r.default.func,onMouseMove:r.default.func,onPositionChange:r.default.func,disableBoundaryChecks:r.default.bool,disableHiDPIScaling:r.default.bool,disableCanvasRotation:r.default.bool}),o(T,"defaultProps",{scale:1,rotate:0,border:25,borderRadius:0,width:200,height:200,color:[0,0,0,.5],onLoadFailure:function(){},onLoadSuccess:function(){},onImageReady:function(){},onImageChange:function(){},onMouseUp:function(){},onMouseMove:function(){},onPositionChange:function(){},disableBoundaryChecks:!1,disableHiDPIScaling:!1,disableCanvasRotation:!0}),T}(n(5173),n(5043))},4960:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(888),i=n(8726);function a(e){(0,i.A)(1,arguments);var t=(0,r.default)(e),n=t.getUTCDay(),a=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-a),t.setUTCHours(0,0,0,0),t}},4974:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){return(0,i.A)(1,arguments),(0,r.default)(e).getFullYear()}},4983:(e,t)=>{"use strict";var n="function"===typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,c=n?Symbol.for("react.provider"):60109,u=n?Symbol.for("react.context"):60110,l=n?Symbol.for("react.async_mode"):60111,d=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,p=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,v=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,_=n?Symbol.for("react.scope"):60119;function w(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case l:case d:case a:case s:case o:case h:return e;default:switch(e=e&&e.$$typeof){case u:case f:case g:case m:case c:return e;default:return t}}case i:return t}}}function E(e){return w(e)===d}t.AsyncMode=l,t.ConcurrentMode=d,t.ContextConsumer=u,t.ContextProvider=c,t.Element=r,t.ForwardRef=f,t.Fragment=a,t.Lazy=g,t.Memo=m,t.Portal=i,t.Profiler=s,t.StrictMode=o,t.Suspense=h,t.isAsyncMode=function(e){return E(e)||w(e)===l},t.isConcurrentMode=E,t.isContextConsumer=function(e){return w(e)===u},t.isContextProvider=function(e){return w(e)===c},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return w(e)===f},t.isFragment=function(e){return w(e)===a},t.isLazy=function(e){return w(e)===g},t.isMemo=function(e){return w(e)===m},t.isPortal=function(e){return w(e)===i},t.isProfiler=function(e){return w(e)===s},t.isStrictMode=function(e){return w(e)===o},t.isSuspense=function(e){return w(e)===h},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===a||e===d||e===s||e===o||e===h||e===p||"object"===typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===c||e.$$typeof===u||e.$$typeof===f||e.$$typeof===y||e.$$typeof===b||e.$$typeof===_||e.$$typeof===v)},t.typeOf=w},5027:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(888),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,i.default)(e),o=(0,r.A)(t);return isNaN(o)?new Date(NaN):o?(n.setDate(n.getDate()+o),n):n}},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},5126:(e,t,n)=>{"use strict";n.d(t,{Cg:()=>r,_m:()=>a,s0:()=>i});Math.pow(10,8);var r=6e4,i=36e5,a=1e3},5173:(e,t,n)=>{e.exports=n(1497)()},5484:(e,t,n)=>{"use strict";function r(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!==e&&void 0!==e&&this.setState(e)}function i(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!==n&&void 0!==n?n:null}.bind(this))}function a(e,t){try{var n=this.props,r=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,r)}finally{this.props=n,this.state=r}}function o(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!==typeof e.getDerivedStateFromProps&&"function"!==typeof t.getSnapshotBeforeUpdate)return e;var n=null,o=null,s=null;if("function"===typeof t.componentWillMount?n="componentWillMount":"function"===typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"===typeof t.componentWillReceiveProps?o="componentWillReceiveProps":"function"===typeof t.UNSAFE_componentWillReceiveProps&&(o="UNSAFE_componentWillReceiveProps"),"function"===typeof t.componentWillUpdate?s="componentWillUpdate":"function"===typeof t.UNSAFE_componentWillUpdate&&(s="UNSAFE_componentWillUpdate"),null!==n||null!==o||null!==s){var c=e.displayName||e.name,u="function"===typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+c+" uses "+u+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==o?"\n  "+o:"")+(null!==s?"\n  "+s:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"===typeof e.getDerivedStateFromProps&&(t.componentWillMount=r,t.componentWillReceiveProps=i),"function"===typeof t.getSnapshotBeforeUpdate){if("function"!==typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=a;var l=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var r=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;l.call(this,e,t,r)}}return e}n.r(t),n.d(t,{polyfill:()=>o}),r.__suppressDeprecationWarning=!0,i.__suppressDeprecationWarning=!0,a.__suppressDeprecationWarning=!0},5622:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(2215),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,r.A)(t);return(0,i.default)(e,-n)}},5765:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bodyOpenClassName=t.portalClassName=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(5043),o=p(a),s=p(n(7950)),c=p(n(5173)),u=p(n(1439)),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(6619)),d=n(8821),f=p(d),h=n(5484);function p(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var g=t.portalClassName="ReactModalPortal",v=t.bodyOpenClassName="ReactModal__Body--open",y=d.canUseDOM&&void 0!==s.default.createPortal,b=function(e){return document.createElement(e)},_=function(){return y?s.default.createPortal:s.default.unstable_renderSubtreeIntoContainer};function w(e){return e()}var E=function(e){function t(){var e,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,c=Array(a),l=0;l<a;l++)c[l]=arguments[l];return n=i=m(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),i.removePortal=function(){!y&&s.default.unmountComponentAtNode(i.node);var e=w(i.props.parentSelector);e&&e.contains(i.node)?e.removeChild(i.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},i.portalRef=function(e){i.portal=e},i.renderPortal=function(e){var n=_()(i,o.default.createElement(u.default,r({defaultStyles:t.defaultStyles},e)),i.node);i.portalRef(n)},m(i,n)}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentDidMount",value:function(){d.canUseDOM&&(y||(this.node=b("div")),this.node.className=this.props.portalClassName,w(this.props.parentSelector).appendChild(this.node),!y&&this.renderPortal(this.props))}},{key:"getSnapshotBeforeUpdate",value:function(e){return{prevParent:w(e.parentSelector),nextParent:w(this.props.parentSelector)}}},{key:"componentDidUpdate",value:function(e,t,n){if(d.canUseDOM){var r=this.props,i=r.isOpen,a=r.portalClassName;e.portalClassName!==a&&(this.node.className=a);var o=n.prevParent,s=n.nextParent;s!==o&&(o.removeChild(this.node),s.appendChild(this.node)),(e.isOpen||i)&&!y&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(d.canUseDOM&&this.node&&this.portal){var e=this.portal.state,t=Date.now(),n=e.isOpen&&this.props.closeTimeoutMS&&(e.closesAt||t+this.props.closeTimeoutMS);n?(e.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,n-t)):this.removePortal()}}},{key:"render",value:function(){return d.canUseDOM&&y?(!this.node&&y&&(this.node=b("div")),_()(o.default.createElement(u.default,r({ref:this.portalRef,defaultStyles:t.defaultStyles},this.props)),this.node)):null}}],[{key:"setAppElement",value:function(e){l.setElement(e)}}]),t}(a.Component);E.propTypes={isOpen:c.default.bool.isRequired,style:c.default.shape({content:c.default.object,overlay:c.default.object}),portalClassName:c.default.string,bodyOpenClassName:c.default.string,htmlOpenClassName:c.default.string,className:c.default.oneOfType([c.default.string,c.default.shape({base:c.default.string.isRequired,afterOpen:c.default.string.isRequired,beforeClose:c.default.string.isRequired})]),overlayClassName:c.default.oneOfType([c.default.string,c.default.shape({base:c.default.string.isRequired,afterOpen:c.default.string.isRequired,beforeClose:c.default.string.isRequired})]),appElement:c.default.oneOfType([c.default.instanceOf(f.default),c.default.instanceOf(d.SafeHTMLCollection),c.default.instanceOf(d.SafeNodeList),c.default.arrayOf(c.default.instanceOf(f.default))]),onAfterOpen:c.default.func,onRequestClose:c.default.func,closeTimeoutMS:c.default.number,ariaHideApp:c.default.bool,shouldFocusAfterRender:c.default.bool,shouldCloseOnOverlayClick:c.default.bool,shouldReturnFocusAfterClose:c.default.bool,preventScroll:c.default.bool,parentSelector:c.default.func,aria:c.default.object,data:c.default.object,role:c.default.string,contentLabel:c.default.string,shouldCloseOnEsc:c.default.bool,overlayRef:c.default.func,contentRef:c.default.func,id:c.default.string,overlayElement:c.default.func,contentElement:c.default.func},E.defaultProps={isOpen:!1,portalClassName:g,bodyOpenClassName:v,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(e,t){return o.default.createElement("div",e,t)},contentElement:function(e,t){return o.default.createElement("div",e,t)}},E.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}},(0,h.polyfill)(E),t.default=E},6062:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){for(var e=[o,s],t=0;t<e.length;t++){var n=e[t];n&&(n.parentNode&&n.parentNode.removeChild(n))}o=s=null,c=[]},t.log=function(){console.log("bodyTrap ----------"),console.log(c.length);for(var e=[o,s],t=0;t<e.length;t++){var n=e[t]||{};console.log(n.nodeName,n.className,n.id)}console.log("edn bodyTrap ----------")};var r,i=n(2959),a=(r=i)&&r.__esModule?r:{default:r};var o=void 0,s=void 0,c=[];function u(){0!==c.length&&c[c.length-1].focusContent()}a.default.subscribe((function(e,t){o||s||((o=document.createElement("div")).setAttribute("data-react-modal-body-trap",""),o.style.position="absolute",o.style.opacity="0",o.setAttribute("tabindex","0"),o.addEventListener("focus",u),(s=o.cloneNode()).addEventListener("focus",u)),(c=t).length>0?(document.body.firstChild!==o&&document.body.insertBefore(o,document.body.firstChild),document.body.lastChild!==s&&document.body.appendChild(s)):(o.parentElement&&o.parentElement.removeChild(o),s.parentElement&&s.parentElement.removeChild(s))}))},6178:function(e,t,n){(e=n.nmd(e)).exports=function(){"use strict";var t,n;function r(){return t.apply(null,arguments)}function i(e){t=e}function a(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function o(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(s(e,t))return!1;return!0}function u(e){return void 0===e}function l(e){return"number"===typeof e||"[object Number]"===Object.prototype.toString.call(e)}function d(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function f(e,t){var n,r=[],i=e.length;for(n=0;n<i;++n)r.push(t(e[n],n));return r}function h(e,t){for(var n in t)s(t,n)&&(e[n]=t[n]);return s(t,"toString")&&(e.toString=t.toString),s(t,"valueOf")&&(e.valueOf=t.valueOf),e}function p(e,t,n,r){return Kn(e,t,n,r,!0).utc()}function m(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function g(e){return null==e._pf&&(e._pf=m()),e._pf}function v(e){var t=null,r=!1,i=e._d&&!isNaN(e._d.getTime());return i&&(t=g(e),r=n.call(t.parsedDateParts,(function(e){return null!=e})),i=t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&r),e._strict&&(i=i&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour)),null!=Object.isFrozen&&Object.isFrozen(e)?i:(e._isValid=i,e._isValid)}function y(e){var t=p(NaN);return null!=e?h(g(t),e):g(t).userInvalidated=!0,t}n=Array.prototype.some?Array.prototype.some:function(e){var t,n=Object(this),r=n.length>>>0;for(t=0;t<r;t++)if(t in n&&e.call(this,n[t],t,n))return!0;return!1};var b=r.momentProperties=[],_=!1;function w(e,t){var n,r,i,a=b.length;if(u(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),u(t._i)||(e._i=t._i),u(t._f)||(e._f=t._f),u(t._l)||(e._l=t._l),u(t._strict)||(e._strict=t._strict),u(t._tzm)||(e._tzm=t._tzm),u(t._isUTC)||(e._isUTC=t._isUTC),u(t._offset)||(e._offset=t._offset),u(t._pf)||(e._pf=g(t)),u(t._locale)||(e._locale=t._locale),a>0)for(n=0;n<a;n++)u(i=t[r=b[n]])||(e[r]=i);return e}function E(e){w(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===_&&(_=!0,r.updateOffset(this),_=!1)}function S(e){return e instanceof E||null!=e&&null!=e._isAMomentObject}function C(e){!1===r.suppressDeprecationWarnings&&"undefined"!==typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function x(e,t){var n=!0;return h((function(){if(null!=r.deprecationHandler&&r.deprecationHandler(null,e),n){var i,a,o,c=[],u=arguments.length;for(a=0;a<u;a++){if(i="","object"===typeof arguments[a]){for(o in i+="\n["+a+"] ",arguments[0])s(arguments[0],o)&&(i+=o+": "+arguments[0][o]+", ");i=i.slice(0,-2)}else i=arguments[a];c.push(i)}C(e+"\nArguments: "+Array.prototype.slice.call(c).join("")+"\n"+(new Error).stack),n=!1}return t.apply(this,arguments)}),t)}var T,R={};function I(e,t){null!=r.deprecationHandler&&r.deprecationHandler(e,t),R[e]||(C(t),R[e]=!0)}function N(e){return"undefined"!==typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function A(e){var t,n;for(n in e)s(e,n)&&(N(t=e[n])?this[n]=t:this["_"+n]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function k(e,t){var n,r=h({},e);for(n in t)s(t,n)&&(o(e[n])&&o(t[n])?(r[n]={},h(r[n],e[n]),h(r[n],t[n])):null!=t[n]?r[n]=t[n]:delete r[n]);for(n in e)s(e,n)&&!s(t,n)&&o(e[n])&&(r[n]=h({},r[n]));return r}function D(e){null!=e&&this.set(e)}r.suppressDeprecationWarnings=!1,r.deprecationHandler=null,T=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)s(e,t)&&n.push(t);return n};var M={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function L(e,t,n){var r=this._calendar[e]||this._calendar.sameElse;return N(r)?r.call(t,n):r}function O(e,t,n){var r=""+Math.abs(e),i=t-r.length;return(e>=0?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+r}var P=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,j=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,F={},U={};function B(e,t,n,r){var i=r;"string"===typeof r&&(i=function(){return this[r]()}),e&&(U[e]=i),t&&(U[t[0]]=function(){return O(i.apply(this,arguments),t[1],t[2])}),n&&(U[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function V(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function z(e){var t,n,r=e.match(P);for(t=0,n=r.length;t<n;t++)U[r[t]]?r[t]=U[r[t]]:r[t]=V(r[t]);return function(t){var i,a="";for(i=0;i<n;i++)a+=N(r[i])?r[i].call(t,e):r[i];return a}}function W(e,t){return e.isValid()?(t=G(t,e.localeData()),F[t]=F[t]||z(t),F[t](e)):e.localeData().invalidDate()}function G(e,t){var n=5;function r(e){return t.longDateFormat(e)||e}for(j.lastIndex=0;n>=0&&j.test(e);)e=e.replace(j,r),j.lastIndex=0,n-=1;return e}var H={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function Y(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.match(P).map((function(e){return"MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e})).join(""),this._longDateFormat[e])}var q="Invalid date";function K(){return this._invalidDate}var X="%d",Q=/\d{1,2}/;function J(e){return this._ordinal.replace("%d",e)}var Z={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function $(e,t,n,r){var i=this._relativeTime[n];return N(i)?i(e,t,n,r):i.replace(/%d/i,e)}function ee(e,t){var n=this._relativeTime[e>0?"future":"past"];return N(n)?n(t):n.replace(/%s/i,t)}var te={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function ne(e){return"string"===typeof e?te[e]||te[e.toLowerCase()]:void 0}function re(e){var t,n,r={};for(n in e)s(e,n)&&(t=ne(n))&&(r[t]=e[n]);return r}var ie={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function ae(e){var t,n=[];for(t in e)s(e,t)&&n.push({unit:t,priority:ie[t]});return n.sort((function(e,t){return e.priority-t.priority})),n}var oe,se=/\d/,ce=/\d\d/,ue=/\d{3}/,le=/\d{4}/,de=/[+-]?\d{6}/,fe=/\d\d?/,he=/\d\d\d\d?/,pe=/\d\d\d\d\d\d?/,me=/\d{1,3}/,ge=/\d{1,4}/,ve=/[+-]?\d{1,6}/,ye=/\d+/,be=/[+-]?\d+/,_e=/Z|[+-]\d\d:?\d\d/gi,we=/Z|[+-]\d\d(?::?\d\d)?/gi,Ee=/[+-]?\d+(\.\d{1,3})?/,Se=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Ce=/^[1-9]\d?/,xe=/^([1-9]\d|\d)/;function Te(e,t,n){oe[e]=N(t)?t:function(e,r){return e&&n?n:t}}function Re(e,t){return s(oe,e)?oe[e](t._strict,t._locale):new RegExp(Ie(e))}function Ie(e){return Ne(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,(function(e,t,n,r,i){return t||n||r||i})))}function Ne(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Ae(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function ke(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=Ae(t)),n}oe={};var De={};function Me(e,t){var n,r,i=t;for("string"===typeof e&&(e=[e]),l(t)&&(i=function(e,n){n[t]=ke(e)}),r=e.length,n=0;n<r;n++)De[e[n]]=i}function Le(e,t){Me(e,(function(e,n,r,i){r._w=r._w||{},t(e,r._w,r,i)}))}function Oe(e,t,n){null!=t&&s(De,e)&&De[e](t,n._a,n,e)}function Pe(e){return e%4===0&&e%100!==0||e%400===0}var je=0,Fe=1,Ue=2,Be=3,Ve=4,ze=5,We=6,Ge=7,He=8;function Ye(e){return Pe(e)?366:365}B("Y",0,0,(function(){var e=this.year();return e<=9999?O(e,4):"+"+e})),B(0,["YY",2],0,(function(){return this.year()%100})),B(0,["YYYY",4],0,"year"),B(0,["YYYYY",5],0,"year"),B(0,["YYYYYY",6,!0],0,"year"),Te("Y",be),Te("YY",fe,ce),Te("YYYY",ge,le),Te("YYYYY",ve,de),Te("YYYYYY",ve,de),Me(["YYYYY","YYYYYY"],je),Me("YYYY",(function(e,t){t[je]=2===e.length?r.parseTwoDigitYear(e):ke(e)})),Me("YY",(function(e,t){t[je]=r.parseTwoDigitYear(e)})),Me("Y",(function(e,t){t[je]=parseInt(e,10)})),r.parseTwoDigitYear=function(e){return ke(e)+(ke(e)>68?1900:2e3)};var qe,Ke=Qe("FullYear",!0);function Xe(){return Pe(this.year())}function Qe(e,t){return function(n){return null!=n?(Ze(this,e,n),r.updateOffset(this,t),this):Je(this,e)}}function Je(e,t){if(!e.isValid())return NaN;var n=e._d,r=e._isUTC;switch(t){case"Milliseconds":return r?n.getUTCMilliseconds():n.getMilliseconds();case"Seconds":return r?n.getUTCSeconds():n.getSeconds();case"Minutes":return r?n.getUTCMinutes():n.getMinutes();case"Hours":return r?n.getUTCHours():n.getHours();case"Date":return r?n.getUTCDate():n.getDate();case"Day":return r?n.getUTCDay():n.getDay();case"Month":return r?n.getUTCMonth():n.getMonth();case"FullYear":return r?n.getUTCFullYear():n.getFullYear();default:return NaN}}function Ze(e,t,n){var r,i,a,o,s;if(e.isValid()&&!isNaN(n)){switch(r=e._d,i=e._isUTC,t){case"Milliseconds":return void(i?r.setUTCMilliseconds(n):r.setMilliseconds(n));case"Seconds":return void(i?r.setUTCSeconds(n):r.setSeconds(n));case"Minutes":return void(i?r.setUTCMinutes(n):r.setMinutes(n));case"Hours":return void(i?r.setUTCHours(n):r.setHours(n));case"Date":return void(i?r.setUTCDate(n):r.setDate(n));case"FullYear":break;default:return}a=n,o=e.month(),s=29!==(s=e.date())||1!==o||Pe(a)?s:28,i?r.setUTCFullYear(a,o,s):r.setFullYear(a,o,s)}}function $e(e){return N(this[e=ne(e)])?this[e]():this}function et(e,t){if("object"===typeof e){var n,r=ae(e=re(e)),i=r.length;for(n=0;n<i;n++)this[r[n].unit](e[r[n].unit])}else if(N(this[e=ne(e)]))return this[e](t);return this}function tt(e,t){return(e%t+t)%t}function nt(e,t){if(isNaN(e)||isNaN(t))return NaN;var n=tt(t,12);return e+=(t-n)/12,1===n?Pe(e)?29:28:31-n%7%2}qe=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},B("M",["MM",2],"Mo",(function(){return this.month()+1})),B("MMM",0,0,(function(e){return this.localeData().monthsShort(this,e)})),B("MMMM",0,0,(function(e){return this.localeData().months(this,e)})),Te("M",fe,Ce),Te("MM",fe,ce),Te("MMM",(function(e,t){return t.monthsShortRegex(e)})),Te("MMMM",(function(e,t){return t.monthsRegex(e)})),Me(["M","MM"],(function(e,t){t[Fe]=ke(e)-1})),Me(["MMM","MMMM"],(function(e,t,n,r){var i=n._locale.monthsParse(e,r,n._strict);null!=i?t[Fe]=i:g(n).invalidMonth=e}));var rt="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),it="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),at=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,ot=Se,st=Se;function ct(e,t){return e?a(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||at).test(t)?"format":"standalone"][e.month()]:a(this._months)?this._months:this._months.standalone}function ut(e,t){return e?a(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[at.test(t)?"format":"standalone"][e.month()]:a(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function lt(e,t,n){var r,i,a,o=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)a=p([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(a,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(a,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=qe.call(this._shortMonthsParse,o))?i:null:-1!==(i=qe.call(this._longMonthsParse,o))?i:null:"MMM"===t?-1!==(i=qe.call(this._shortMonthsParse,o))||-1!==(i=qe.call(this._longMonthsParse,o))?i:null:-1!==(i=qe.call(this._longMonthsParse,o))||-1!==(i=qe.call(this._shortMonthsParse,o))?i:null}function dt(e,t,n){var r,i,a;if(this._monthsParseExact)return lt.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(i=p([2e3,r]),n&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[r]||(a="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[r]=new RegExp(a.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[r].test(e))return r;if(n&&"MMM"===t&&this._shortMonthsParse[r].test(e))return r;if(!n&&this._monthsParse[r].test(e))return r}}function ft(e,t){if(!e.isValid())return e;if("string"===typeof t)if(/^\d+$/.test(t))t=ke(t);else if(!l(t=e.localeData().monthsParse(t)))return e;var n=t,r=e.date();return r=r<29?r:Math.min(r,nt(e.year(),n)),e._isUTC?e._d.setUTCMonth(n,r):e._d.setMonth(n,r),e}function ht(e){return null!=e?(ft(this,e),r.updateOffset(this,!0),this):Je(this,"Month")}function pt(){return nt(this.year(),this.month())}function mt(e){return this._monthsParseExact?(s(this,"_monthsRegex")||vt.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(s(this,"_monthsShortRegex")||(this._monthsShortRegex=ot),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)}function gt(e){return this._monthsParseExact?(s(this,"_monthsRegex")||vt.call(this),e?this._monthsStrictRegex:this._monthsRegex):(s(this,"_monthsRegex")||(this._monthsRegex=st),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)}function vt(){function e(e,t){return t.length-e.length}var t,n,r,i,a=[],o=[],s=[];for(t=0;t<12;t++)n=p([2e3,t]),r=Ne(this.monthsShort(n,"")),i=Ne(this.months(n,"")),a.push(r),o.push(i),s.push(i),s.push(r);a.sort(e),o.sort(e),s.sort(e),this._monthsRegex=new RegExp("^("+s.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+a.join("|")+")","i")}function yt(e,t,n,r,i,a,o){var s;return e<100&&e>=0?(s=new Date(e+400,t,n,r,i,a,o),isFinite(s.getFullYear())&&s.setFullYear(e)):s=new Date(e,t,n,r,i,a,o),s}function bt(e){var t,n;return e<100&&e>=0?((n=Array.prototype.slice.call(arguments))[0]=e+400,t=new Date(Date.UTC.apply(null,n)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function _t(e,t,n){var r=7+t-n;return-(7+bt(e,0,r).getUTCDay()-t)%7+r-1}function wt(e,t,n,r,i){var a,o,s=1+7*(t-1)+(7+n-r)%7+_t(e,r,i);return s<=0?o=Ye(a=e-1)+s:s>Ye(e)?(a=e+1,o=s-Ye(e)):(a=e,o=s),{year:a,dayOfYear:o}}function Et(e,t,n){var r,i,a=_t(e.year(),t,n),o=Math.floor((e.dayOfYear()-a-1)/7)+1;return o<1?r=o+St(i=e.year()-1,t,n):o>St(e.year(),t,n)?(r=o-St(e.year(),t,n),i=e.year()+1):(i=e.year(),r=o),{week:r,year:i}}function St(e,t,n){var r=_t(e,t,n),i=_t(e+1,t,n);return(Ye(e)-r+i)/7}function Ct(e){return Et(e,this._week.dow,this._week.doy).week}B("w",["ww",2],"wo","week"),B("W",["WW",2],"Wo","isoWeek"),Te("w",fe,Ce),Te("ww",fe,ce),Te("W",fe,Ce),Te("WW",fe,ce),Le(["w","ww","W","WW"],(function(e,t,n,r){t[r.substr(0,1)]=ke(e)}));var xt={dow:0,doy:6};function Tt(){return this._week.dow}function Rt(){return this._week.doy}function It(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")}function Nt(e){var t=Et(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")}function At(e,t){return"string"!==typeof e?e:isNaN(e)?"number"===typeof(e=t.weekdaysParse(e))?e:null:parseInt(e,10)}function kt(e,t){return"string"===typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}function Dt(e,t){return e.slice(t,7).concat(e.slice(0,t))}B("d",0,"do","day"),B("dd",0,0,(function(e){return this.localeData().weekdaysMin(this,e)})),B("ddd",0,0,(function(e){return this.localeData().weekdaysShort(this,e)})),B("dddd",0,0,(function(e){return this.localeData().weekdays(this,e)})),B("e",0,0,"weekday"),B("E",0,0,"isoWeekday"),Te("d",fe),Te("e",fe),Te("E",fe),Te("dd",(function(e,t){return t.weekdaysMinRegex(e)})),Te("ddd",(function(e,t){return t.weekdaysShortRegex(e)})),Te("dddd",(function(e,t){return t.weekdaysRegex(e)})),Le(["dd","ddd","dddd"],(function(e,t,n,r){var i=n._locale.weekdaysParse(e,r,n._strict);null!=i?t.d=i:g(n).invalidWeekday=e})),Le(["d","e","E"],(function(e,t,n,r){t[r]=ke(e)}));var Mt="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Lt="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Ot="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Pt=Se,jt=Se,Ft=Se;function Ut(e,t){var n=a(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"];return!0===e?Dt(n,this._week.dow):e?n[e.day()]:n}function Bt(e){return!0===e?Dt(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort}function Vt(e){return!0===e?Dt(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin}function zt(e,t,n){var r,i,a,o=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)a=p([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(a,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(a,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(a,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=qe.call(this._weekdaysParse,o))?i:null:"ddd"===t?-1!==(i=qe.call(this._shortWeekdaysParse,o))?i:null:-1!==(i=qe.call(this._minWeekdaysParse,o))?i:null:"dddd"===t?-1!==(i=qe.call(this._weekdaysParse,o))||-1!==(i=qe.call(this._shortWeekdaysParse,o))||-1!==(i=qe.call(this._minWeekdaysParse,o))?i:null:"ddd"===t?-1!==(i=qe.call(this._shortWeekdaysParse,o))||-1!==(i=qe.call(this._weekdaysParse,o))||-1!==(i=qe.call(this._minWeekdaysParse,o))?i:null:-1!==(i=qe.call(this._minWeekdaysParse,o))||-1!==(i=qe.call(this._weekdaysParse,o))||-1!==(i=qe.call(this._shortWeekdaysParse,o))?i:null}function Wt(e,t,n){var r,i,a;if(this._weekdaysParseExact)return zt.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(i=p([2e3,1]).day(r),n&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[r]||(a="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[r]=new RegExp(a.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[r].test(e))return r;if(n&&"ddd"===t&&this._shortWeekdaysParse[r].test(e))return r;if(n&&"dd"===t&&this._minWeekdaysParse[r].test(e))return r;if(!n&&this._weekdaysParse[r].test(e))return r}}function Gt(e){if(!this.isValid())return null!=e?this:NaN;var t=Je(this,"Day");return null!=e?(e=At(e,this.localeData()),this.add(e-t,"d")):t}function Ht(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")}function Yt(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=kt(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7}function qt(e){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||Qt.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(s(this,"_weekdaysRegex")||(this._weekdaysRegex=Pt),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)}function Kt(e){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||Qt.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(s(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=jt),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Xt(e){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||Qt.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(s(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Ft),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Qt(){function e(e,t){return t.length-e.length}var t,n,r,i,a,o=[],s=[],c=[],u=[];for(t=0;t<7;t++)n=p([2e3,1]).day(t),r=Ne(this.weekdaysMin(n,"")),i=Ne(this.weekdaysShort(n,"")),a=Ne(this.weekdays(n,"")),o.push(r),s.push(i),c.push(a),u.push(r),u.push(i),u.push(a);o.sort(e),s.sort(e),c.sort(e),u.sort(e),this._weekdaysRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+o.join("|")+")","i")}function Jt(){return this.hours()%12||12}function Zt(){return this.hours()||24}function $t(e,t){B(e,0,0,(function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)}))}function en(e,t){return t._meridiemParse}function tn(e){return"p"===(e+"").toLowerCase().charAt(0)}B("H",["HH",2],0,"hour"),B("h",["hh",2],0,Jt),B("k",["kk",2],0,Zt),B("hmm",0,0,(function(){return""+Jt.apply(this)+O(this.minutes(),2)})),B("hmmss",0,0,(function(){return""+Jt.apply(this)+O(this.minutes(),2)+O(this.seconds(),2)})),B("Hmm",0,0,(function(){return""+this.hours()+O(this.minutes(),2)})),B("Hmmss",0,0,(function(){return""+this.hours()+O(this.minutes(),2)+O(this.seconds(),2)})),$t("a",!0),$t("A",!1),Te("a",en),Te("A",en),Te("H",fe,xe),Te("h",fe,Ce),Te("k",fe,Ce),Te("HH",fe,ce),Te("hh",fe,ce),Te("kk",fe,ce),Te("hmm",he),Te("hmmss",pe),Te("Hmm",he),Te("Hmmss",pe),Me(["H","HH"],Be),Me(["k","kk"],(function(e,t,n){var r=ke(e);t[Be]=24===r?0:r})),Me(["a","A"],(function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e})),Me(["h","hh"],(function(e,t,n){t[Be]=ke(e),g(n).bigHour=!0})),Me("hmm",(function(e,t,n){var r=e.length-2;t[Be]=ke(e.substr(0,r)),t[Ve]=ke(e.substr(r)),g(n).bigHour=!0})),Me("hmmss",(function(e,t,n){var r=e.length-4,i=e.length-2;t[Be]=ke(e.substr(0,r)),t[Ve]=ke(e.substr(r,2)),t[ze]=ke(e.substr(i)),g(n).bigHour=!0})),Me("Hmm",(function(e,t,n){var r=e.length-2;t[Be]=ke(e.substr(0,r)),t[Ve]=ke(e.substr(r))})),Me("Hmmss",(function(e,t,n){var r=e.length-4,i=e.length-2;t[Be]=ke(e.substr(0,r)),t[Ve]=ke(e.substr(r,2)),t[ze]=ke(e.substr(i))}));var nn=/[ap]\.?m?\.?/i,rn=Qe("Hours",!0);function an(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"}var on,sn={calendar:M,longDateFormat:H,invalidDate:q,ordinal:X,dayOfMonthOrdinalParse:Q,relativeTime:Z,months:rt,monthsShort:it,week:xt,weekdays:Mt,weekdaysMin:Ot,weekdaysShort:Lt,meridiemParse:nn},cn={},un={};function ln(e,t){var n,r=Math.min(e.length,t.length);for(n=0;n<r;n+=1)if(e[n]!==t[n])return n;return r}function dn(e){return e?e.toLowerCase().replace("_","-"):e}function fn(e){for(var t,n,r,i,a=0;a<e.length;){for(t=(i=dn(e[a]).split("-")).length,n=(n=dn(e[a+1]))?n.split("-"):null;t>0;){if(r=pn(i.slice(0,t).join("-")))return r;if(n&&n.length>=t&&ln(i,n)>=t-1)break;t--}a++}return on}function hn(e){return!(!e||!e.match("^[^/\\\\]*$"))}function pn(t){var n=null;if(void 0===cn[t]&&e&&e.exports&&hn(t))try{n=on._abbr,Object(function(){var e=new Error("Cannot find module 'undefined'");throw e.code="MODULE_NOT_FOUND",e}()),mn(n)}catch(r){cn[t]=null}return cn[t]}function mn(e,t){var n;return e&&((n=u(t)?yn(e):gn(e,t))?on=n:"undefined"!==typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),on._abbr}function gn(e,t){if(null!==t){var n,r=sn;if(t.abbr=e,null!=cn[e])I("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),r=cn[e]._config;else if(null!=t.parentLocale)if(null!=cn[t.parentLocale])r=cn[t.parentLocale]._config;else{if(null==(n=pn(t.parentLocale)))return un[t.parentLocale]||(un[t.parentLocale]=[]),un[t.parentLocale].push({name:e,config:t}),null;r=n._config}return cn[e]=new D(k(r,t)),un[e]&&un[e].forEach((function(e){gn(e.name,e.config)})),mn(e),cn[e]}return delete cn[e],null}function vn(e,t){if(null!=t){var n,r,i=sn;null!=cn[e]&&null!=cn[e].parentLocale?cn[e].set(k(cn[e]._config,t)):(null!=(r=pn(e))&&(i=r._config),t=k(i,t),null==r&&(t.abbr=e),(n=new D(t)).parentLocale=cn[e],cn[e]=n),mn(e)}else null!=cn[e]&&(null!=cn[e].parentLocale?(cn[e]=cn[e].parentLocale,e===mn()&&mn(e)):null!=cn[e]&&delete cn[e]);return cn[e]}function yn(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return on;if(!a(e)){if(t=pn(e))return t;e=[e]}return fn(e)}function bn(){return T(cn)}function _n(e){var t,n=e._a;return n&&-2===g(e).overflow&&(t=n[Fe]<0||n[Fe]>11?Fe:n[Ue]<1||n[Ue]>nt(n[je],n[Fe])?Ue:n[Be]<0||n[Be]>24||24===n[Be]&&(0!==n[Ve]||0!==n[ze]||0!==n[We])?Be:n[Ve]<0||n[Ve]>59?Ve:n[ze]<0||n[ze]>59?ze:n[We]<0||n[We]>999?We:-1,g(e)._overflowDayOfYear&&(t<je||t>Ue)&&(t=Ue),g(e)._overflowWeeks&&-1===t&&(t=Ge),g(e)._overflowWeekday&&-1===t&&(t=He),g(e).overflow=t),e}var wn=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,En=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Sn=/Z|[+-]\d\d(?::?\d\d)?/,Cn=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],xn=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Tn=/^\/?Date\((-?\d+)/i,Rn=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,In={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Nn(e){var t,n,r,i,a,o,s=e._i,c=wn.exec(s)||En.exec(s),u=Cn.length,l=xn.length;if(c){for(g(e).iso=!0,t=0,n=u;t<n;t++)if(Cn[t][1].exec(c[1])){i=Cn[t][0],r=!1!==Cn[t][2];break}if(null==i)return void(e._isValid=!1);if(c[3]){for(t=0,n=l;t<n;t++)if(xn[t][1].exec(c[3])){a=(c[2]||" ")+xn[t][0];break}if(null==a)return void(e._isValid=!1)}if(!r&&null!=a)return void(e._isValid=!1);if(c[4]){if(!Sn.exec(c[4]))return void(e._isValid=!1);o="Z"}e._f=i+(a||"")+(o||""),Vn(e)}else e._isValid=!1}function An(e,t,n,r,i,a){var o=[kn(e),it.indexOf(t),parseInt(n,10),parseInt(r,10),parseInt(i,10)];return a&&o.push(parseInt(a,10)),o}function kn(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}function Dn(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Mn(e,t,n){return!e||Lt.indexOf(e)===new Date(t[0],t[1],t[2]).getDay()||(g(n).weekdayMismatch=!0,n._isValid=!1,!1)}function Ln(e,t,n){if(e)return In[e];if(t)return 0;var r=parseInt(n,10),i=r%100;return(r-i)/100*60+i}function On(e){var t,n=Rn.exec(Dn(e._i));if(n){if(t=An(n[4],n[3],n[2],n[5],n[6],n[7]),!Mn(n[1],t,e))return;e._a=t,e._tzm=Ln(n[8],n[9],n[10]),e._d=bt.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),g(e).rfc2822=!0}else e._isValid=!1}function Pn(e){var t=Tn.exec(e._i);null===t?(Nn(e),!1===e._isValid&&(delete e._isValid,On(e),!1===e._isValid&&(delete e._isValid,e._strict?e._isValid=!1:r.createFromInputFallback(e)))):e._d=new Date(+t[1])}function jn(e,t,n){return null!=e?e:null!=t?t:n}function Fn(e){var t=new Date(r.now());return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function Un(e){var t,n,r,i,a,o=[];if(!e._d){for(r=Fn(e),e._w&&null==e._a[Ue]&&null==e._a[Fe]&&Bn(e),null!=e._dayOfYear&&(a=jn(e._a[je],r[je]),(e._dayOfYear>Ye(a)||0===e._dayOfYear)&&(g(e)._overflowDayOfYear=!0),n=bt(a,0,e._dayOfYear),e._a[Fe]=n.getUTCMonth(),e._a[Ue]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=o[t]=r[t];for(;t<7;t++)e._a[t]=o[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[Be]&&0===e._a[Ve]&&0===e._a[ze]&&0===e._a[We]&&(e._nextDay=!0,e._a[Be]=0),e._d=(e._useUTC?bt:yt).apply(null,o),i=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[Be]=24),e._w&&"undefined"!==typeof e._w.d&&e._w.d!==i&&(g(e).weekdayMismatch=!0)}}function Bn(e){var t,n,r,i,a,o,s,c,u;null!=(t=e._w).GG||null!=t.W||null!=t.E?(a=1,o=4,n=jn(t.GG,e._a[je],Et(Xn(),1,4).year),r=jn(t.W,1),((i=jn(t.E,1))<1||i>7)&&(c=!0)):(a=e._locale._week.dow,o=e._locale._week.doy,u=Et(Xn(),a,o),n=jn(t.gg,e._a[je],u.year),r=jn(t.w,u.week),null!=t.d?((i=t.d)<0||i>6)&&(c=!0):null!=t.e?(i=t.e+a,(t.e<0||t.e>6)&&(c=!0)):i=a),r<1||r>St(n,a,o)?g(e)._overflowWeeks=!0:null!=c?g(e)._overflowWeekday=!0:(s=wt(n,r,i,a,o),e._a[je]=s.year,e._dayOfYear=s.dayOfYear)}function Vn(e){if(e._f!==r.ISO_8601)if(e._f!==r.RFC_2822){e._a=[],g(e).empty=!0;var t,n,i,a,o,s,c,u=""+e._i,l=u.length,d=0;for(c=(i=G(e._f,e._locale).match(P)||[]).length,t=0;t<c;t++)a=i[t],(n=(u.match(Re(a,e))||[])[0])&&((o=u.substr(0,u.indexOf(n))).length>0&&g(e).unusedInput.push(o),u=u.slice(u.indexOf(n)+n.length),d+=n.length),U[a]?(n?g(e).empty=!1:g(e).unusedTokens.push(a),Oe(a,n,e)):e._strict&&!n&&g(e).unusedTokens.push(a);g(e).charsLeftOver=l-d,u.length>0&&g(e).unusedInput.push(u),e._a[Be]<=12&&!0===g(e).bigHour&&e._a[Be]>0&&(g(e).bigHour=void 0),g(e).parsedDateParts=e._a.slice(0),g(e).meridiem=e._meridiem,e._a[Be]=zn(e._locale,e._a[Be],e._meridiem),null!==(s=g(e).era)&&(e._a[je]=e._locale.erasConvertYear(s,e._a[je])),Un(e),_n(e)}else On(e);else Nn(e)}function zn(e,t,n){var r;return null==n?t:null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?((r=e.isPM(n))&&t<12&&(t+=12),r||12!==t||(t=0),t):t}function Wn(e){var t,n,r,i,a,o,s=!1,c=e._f.length;if(0===c)return g(e).invalidFormat=!0,void(e._d=new Date(NaN));for(i=0;i<c;i++)a=0,o=!1,t=w({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],Vn(t),v(t)&&(o=!0),a+=g(t).charsLeftOver,a+=10*g(t).unusedTokens.length,g(t).score=a,s?a<r&&(r=a,n=t):(null==r||a<r||o)&&(r=a,n=t,o&&(s=!0));h(e,n||t)}function Gn(e){if(!e._d){var t=re(e._i),n=void 0===t.day?t.date:t.day;e._a=f([t.year,t.month,n,t.hour,t.minute,t.second,t.millisecond],(function(e){return e&&parseInt(e,10)})),Un(e)}}function Hn(e){var t=new E(_n(Yn(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function Yn(e){var t=e._i,n=e._f;return e._locale=e._locale||yn(e._l),null===t||void 0===n&&""===t?y({nullInput:!0}):("string"===typeof t&&(e._i=t=e._locale.preparse(t)),S(t)?new E(_n(t)):(d(t)?e._d=t:a(n)?Wn(e):n?Vn(e):qn(e),v(e)||(e._d=null),e))}function qn(e){var t=e._i;u(t)?e._d=new Date(r.now()):d(t)?e._d=new Date(t.valueOf()):"string"===typeof t?Pn(e):a(t)?(e._a=f(t.slice(0),(function(e){return parseInt(e,10)})),Un(e)):o(t)?Gn(e):l(t)?e._d=new Date(t):r.createFromInputFallback(e)}function Kn(e,t,n,r,i){var s={};return!0!==t&&!1!==t||(r=t,t=void 0),!0!==n&&!1!==n||(r=n,n=void 0),(o(e)&&c(e)||a(e)&&0===e.length)&&(e=void 0),s._isAMomentObject=!0,s._useUTC=s._isUTC=i,s._l=n,s._i=e,s._f=t,s._strict=r,Hn(s)}function Xn(e,t,n,r){return Kn(e,t,n,r,!1)}r.createFromInputFallback=x("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",(function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))})),r.ISO_8601=function(){},r.RFC_2822=function(){};var Qn=x("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=Xn.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:y()})),Jn=x("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=Xn.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:y()}));function Zn(e,t){var n,r;if(1===t.length&&a(t[0])&&(t=t[0]),!t.length)return Xn();for(n=t[0],r=1;r<t.length;++r)t[r].isValid()&&!t[r][e](n)||(n=t[r]);return n}function $n(){return Zn("isBefore",[].slice.call(arguments,0))}function er(){return Zn("isAfter",[].slice.call(arguments,0))}var tr=function(){return Date.now?Date.now():+new Date},nr=["year","quarter","month","week","day","hour","minute","second","millisecond"];function rr(e){var t,n,r=!1,i=nr.length;for(t in e)if(s(e,t)&&(-1===qe.call(nr,t)||null!=e[t]&&isNaN(e[t])))return!1;for(n=0;n<i;++n)if(e[nr[n]]){if(r)return!1;parseFloat(e[nr[n]])!==ke(e[nr[n]])&&(r=!0)}return!0}function ir(){return this._isValid}function ar(){return Ir(NaN)}function or(e){var t=re(e),n=t.year||0,r=t.quarter||0,i=t.month||0,a=t.week||t.isoWeek||0,o=t.day||0,s=t.hour||0,c=t.minute||0,u=t.second||0,l=t.millisecond||0;this._isValid=rr(t),this._milliseconds=+l+1e3*u+6e4*c+1e3*s*60*60,this._days=+o+7*a,this._months=+i+3*r+12*n,this._data={},this._locale=yn(),this._bubble()}function sr(e){return e instanceof or}function cr(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function ur(e,t,n){var r,i=Math.min(e.length,t.length),a=Math.abs(e.length-t.length),o=0;for(r=0;r<i;r++)(n&&e[r]!==t[r]||!n&&ke(e[r])!==ke(t[r]))&&o++;return o+a}function lr(e,t){B(e,0,0,(function(){var e=this.utcOffset(),n="+";return e<0&&(e=-e,n="-"),n+O(~~(e/60),2)+t+O(~~e%60,2)}))}lr("Z",":"),lr("ZZ",""),Te("Z",we),Te("ZZ",we),Me(["Z","ZZ"],(function(e,t,n){n._useUTC=!0,n._tzm=fr(we,e)}));var dr=/([\+\-]|\d\d)/gi;function fr(e,t){var n,r,i=(t||"").match(e);return null===i?null:0===(r=60*(n=((i[i.length-1]||[])+"").match(dr)||["-",0,0])[1]+ke(n[2]))?0:"+"===n[0]?r:-r}function hr(e,t){var n,i;return t._isUTC?(n=t.clone(),i=(S(e)||d(e)?e.valueOf():Xn(e).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+i),r.updateOffset(n,!1),n):Xn(e).local()}function pr(e){return-Math.round(e._d.getTimezoneOffset())}function mr(e,t,n){var i,a=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"===typeof e){if(null===(e=fr(we,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(i=pr(this)),this._offset=e,this._isUTC=!0,null!=i&&this.add(i,"m"),a!==e&&(!t||this._changeInProgress?Mr(this,Ir(e-a,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,r.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?a:pr(this)}function gr(e,t){return null!=e?("string"!==typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}function vr(e){return this.utcOffset(0,e)}function yr(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(pr(this),"m")),this}function br(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"===typeof this._i){var e=fr(_e,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this}function _r(e){return!!this.isValid()&&(e=e?Xn(e).utcOffset():0,(this.utcOffset()-e)%60===0)}function wr(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Er(){if(!u(this._isDSTShifted))return this._isDSTShifted;var e,t={};return w(t,this),(t=Yn(t))._a?(e=t._isUTC?p(t._a):Xn(t._a),this._isDSTShifted=this.isValid()&&ur(t._a,e.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function Sr(){return!!this.isValid()&&!this._isUTC}function Cr(){return!!this.isValid()&&this._isUTC}function xr(){return!!this.isValid()&&this._isUTC&&0===this._offset}r.updateOffset=function(){};var Tr=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Rr=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Ir(e,t){var n,r,i,a=e,o=null;return sr(e)?a={ms:e._milliseconds,d:e._days,M:e._months}:l(e)||!isNaN(+e)?(a={},t?a[t]=+e:a.milliseconds=+e):(o=Tr.exec(e))?(n="-"===o[1]?-1:1,a={y:0,d:ke(o[Ue])*n,h:ke(o[Be])*n,m:ke(o[Ve])*n,s:ke(o[ze])*n,ms:ke(cr(1e3*o[We]))*n}):(o=Rr.exec(e))?(n="-"===o[1]?-1:1,a={y:Nr(o[2],n),M:Nr(o[3],n),w:Nr(o[4],n),d:Nr(o[5],n),h:Nr(o[6],n),m:Nr(o[7],n),s:Nr(o[8],n)}):null==a?a={}:"object"===typeof a&&("from"in a||"to"in a)&&(i=kr(Xn(a.from),Xn(a.to)),(a={}).ms=i.milliseconds,a.M=i.months),r=new or(a),sr(e)&&s(e,"_locale")&&(r._locale=e._locale),sr(e)&&s(e,"_isValid")&&(r._isValid=e._isValid),r}function Nr(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Ar(e,t){var n={};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function kr(e,t){var n;return e.isValid()&&t.isValid()?(t=hr(t,e),e.isBefore(t)?n=Ar(e,t):((n=Ar(t,e)).milliseconds=-n.milliseconds,n.months=-n.months),n):{milliseconds:0,months:0}}function Dr(e,t){return function(n,r){var i;return null===r||isNaN(+r)||(I(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),i=n,n=r,r=i),Mr(this,Ir(n,r),e),this}}function Mr(e,t,n,i){var a=t._milliseconds,o=cr(t._days),s=cr(t._months);e.isValid()&&(i=null==i||i,s&&ft(e,Je(e,"Month")+s*n),o&&Ze(e,"Date",Je(e,"Date")+o*n),a&&e._d.setTime(e._d.valueOf()+a*n),i&&r.updateOffset(e,o||s))}Ir.fn=or.prototype,Ir.invalid=ar;var Lr=Dr(1,"add"),Or=Dr(-1,"subtract");function Pr(e){return"string"===typeof e||e instanceof String}function jr(e){return S(e)||d(e)||Pr(e)||l(e)||Ur(e)||Fr(e)||null===e||void 0===e}function Fr(e){var t,n,r=o(e)&&!c(e),i=!1,a=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],u=a.length;for(t=0;t<u;t+=1)n=a[t],i=i||s(e,n);return r&&i}function Ur(e){var t=a(e),n=!1;return t&&(n=0===e.filter((function(t){return!l(t)&&Pr(e)})).length),t&&n}function Br(e){var t,n,r=o(e)&&!c(e),i=!1,a=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"];for(t=0;t<a.length;t+=1)n=a[t],i=i||s(e,n);return r&&i}function Vr(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"}function zr(e,t){1===arguments.length&&(arguments[0]?jr(arguments[0])?(e=arguments[0],t=void 0):Br(arguments[0])&&(t=arguments[0],e=void 0):(e=void 0,t=void 0));var n=e||Xn(),i=hr(n,this).startOf("day"),a=r.calendarFormat(this,i)||"sameElse",o=t&&(N(t[a])?t[a].call(this,n):t[a]);return this.format(o||this.localeData().calendar(a,this,Xn(n)))}function Wr(){return new E(this)}function Gr(e,t){var n=S(e)?e:Xn(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=ne(t)||"millisecond")?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())}function Hr(e,t){var n=S(e)?e:Xn(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=ne(t)||"millisecond")?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())}function Yr(e,t,n,r){var i=S(e)?e:Xn(e),a=S(t)?t:Xn(t);return!!(this.isValid()&&i.isValid()&&a.isValid())&&("("===(r=r||"()")[0]?this.isAfter(i,n):!this.isBefore(i,n))&&(")"===r[1]?this.isBefore(a,n):!this.isAfter(a,n))}function qr(e,t){var n,r=S(e)?e:Xn(e);return!(!this.isValid()||!r.isValid())&&("millisecond"===(t=ne(t)||"millisecond")?this.valueOf()===r.valueOf():(n=r.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))}function Kr(e,t){return this.isSame(e,t)||this.isAfter(e,t)}function Xr(e,t){return this.isSame(e,t)||this.isBefore(e,t)}function Qr(e,t,n){var r,i,a;if(!this.isValid())return NaN;if(!(r=hr(e,this)).isValid())return NaN;switch(i=6e4*(r.utcOffset()-this.utcOffset()),t=ne(t)){case"year":a=Jr(this,r)/12;break;case"month":a=Jr(this,r);break;case"quarter":a=Jr(this,r)/3;break;case"second":a=(this-r)/1e3;break;case"minute":a=(this-r)/6e4;break;case"hour":a=(this-r)/36e5;break;case"day":a=(this-r-i)/864e5;break;case"week":a=(this-r-i)/6048e5;break;default:a=this-r}return n?a:Ae(a)}function Jr(e,t){if(e.date()<t.date())return-Jr(t,e);var n=12*(t.year()-e.year())+(t.month()-e.month()),r=e.clone().add(n,"months");return-(n+(t-r<0?(t-r)/(r-e.clone().add(n-1,"months")):(t-r)/(e.clone().add(n+1,"months")-r)))||0}function Zr(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function $r(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||n.year()>9999?W(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):N(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",W(n,"Z")):W(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function ei(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e,t,n,r,i="moment",a="";return this.isLocal()||(i=0===this.utcOffset()?"moment.utc":"moment.parseZone",a="Z"),e="["+i+'("]',t=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",n="-MM-DD[T]HH:mm:ss.SSS",r=a+'[")]',this.format(e+t+n+r)}function ti(e){e||(e=this.isUtc()?r.defaultFormatUtc:r.defaultFormat);var t=W(this,e);return this.localeData().postformat(t)}function ni(e,t){return this.isValid()&&(S(e)&&e.isValid()||Xn(e).isValid())?Ir({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function ri(e){return this.from(Xn(),e)}function ii(e,t){return this.isValid()&&(S(e)&&e.isValid()||Xn(e).isValid())?Ir({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function ai(e){return this.to(Xn(),e)}function oi(e){var t;return void 0===e?this._locale._abbr:(null!=(t=yn(e))&&(this._locale=t),this)}r.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",r.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var si=x("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",(function(e){return void 0===e?this.localeData():this.locale(e)}));function ci(){return this._locale}var ui=1e3,li=60*ui,di=60*li,fi=3506328*di;function hi(e,t){return(e%t+t)%t}function pi(e,t,n){return e<100&&e>=0?new Date(e+400,t,n)-fi:new Date(e,t,n).valueOf()}function mi(e,t,n){return e<100&&e>=0?Date.UTC(e+400,t,n)-fi:Date.UTC(e,t,n)}function gi(e){var t,n;if(void 0===(e=ne(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?mi:pi,e){case"year":t=n(this.year(),0,1);break;case"quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case"month":t=n(this.year(),this.month(),1);break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=n(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=hi(t+(this._isUTC?0:this.utcOffset()*li),di);break;case"minute":t=this._d.valueOf(),t-=hi(t,li);break;case"second":t=this._d.valueOf(),t-=hi(t,ui)}return this._d.setTime(t),r.updateOffset(this,!0),this}function vi(e){var t,n;if(void 0===(e=ne(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?mi:pi,e){case"year":t=n(this.year()+1,0,1)-1;break;case"quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=n(this.year(),this.month()+1,1)-1;break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=di-hi(t+(this._isUTC?0:this.utcOffset()*li),di)-1;break;case"minute":t=this._d.valueOf(),t+=li-hi(t,li)-1;break;case"second":t=this._d.valueOf(),t+=ui-hi(t,ui)-1}return this._d.setTime(t),r.updateOffset(this,!0),this}function yi(){return this._d.valueOf()-6e4*(this._offset||0)}function bi(){return Math.floor(this.valueOf()/1e3)}function _i(){return new Date(this.valueOf())}function wi(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function Ei(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function Si(){return this.isValid()?this.toISOString():null}function Ci(){return v(this)}function xi(){return h({},g(this))}function Ti(){return g(this).overflow}function Ri(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function Ii(e,t){var n,i,a,o=this._eras||yn("en")._eras;for(n=0,i=o.length;n<i;++n)switch("string"===typeof o[n].since&&(a=r(o[n].since).startOf("day"),o[n].since=a.valueOf()),typeof o[n].until){case"undefined":o[n].until=1/0;break;case"string":a=r(o[n].until).startOf("day").valueOf(),o[n].until=a.valueOf()}return o}function Ni(e,t,n){var r,i,a,o,s,c=this.eras();for(e=e.toUpperCase(),r=0,i=c.length;r<i;++r)if(a=c[r].name.toUpperCase(),o=c[r].abbr.toUpperCase(),s=c[r].narrow.toUpperCase(),n)switch(t){case"N":case"NN":case"NNN":if(o===e)return c[r];break;case"NNNN":if(a===e)return c[r];break;case"NNNNN":if(s===e)return c[r]}else if([a,o,s].indexOf(e)>=0)return c[r]}function Ai(e,t){var n=e.since<=e.until?1:-1;return void 0===t?r(e.since).year():r(e.since).year()+(t-e.offset)*n}function ki(){var e,t,n,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),r[e].since<=n&&n<=r[e].until)return r[e].name;if(r[e].until<=n&&n<=r[e].since)return r[e].name}return""}function Di(){var e,t,n,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),r[e].since<=n&&n<=r[e].until)return r[e].narrow;if(r[e].until<=n&&n<=r[e].since)return r[e].narrow}return""}function Mi(){var e,t,n,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e){if(n=this.clone().startOf("day").valueOf(),r[e].since<=n&&n<=r[e].until)return r[e].abbr;if(r[e].until<=n&&n<=r[e].since)return r[e].abbr}return""}function Li(){var e,t,n,i,a=this.localeData().eras();for(e=0,t=a.length;e<t;++e)if(n=a[e].since<=a[e].until?1:-1,i=this.clone().startOf("day").valueOf(),a[e].since<=i&&i<=a[e].until||a[e].until<=i&&i<=a[e].since)return(this.year()-r(a[e].since).year())*n+a[e].offset;return this.year()}function Oi(e){return s(this,"_erasNameRegex")||zi.call(this),e?this._erasNameRegex:this._erasRegex}function Pi(e){return s(this,"_erasAbbrRegex")||zi.call(this),e?this._erasAbbrRegex:this._erasRegex}function ji(e){return s(this,"_erasNarrowRegex")||zi.call(this),e?this._erasNarrowRegex:this._erasRegex}function Fi(e,t){return t.erasAbbrRegex(e)}function Ui(e,t){return t.erasNameRegex(e)}function Bi(e,t){return t.erasNarrowRegex(e)}function Vi(e,t){return t._eraYearOrdinalRegex||ye}function zi(){var e,t,n,r,i,a=[],o=[],s=[],c=[],u=this.eras();for(e=0,t=u.length;e<t;++e)n=Ne(u[e].name),r=Ne(u[e].abbr),i=Ne(u[e].narrow),o.push(n),a.push(r),s.push(i),c.push(n),c.push(r),c.push(i);this._erasRegex=new RegExp("^("+c.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+o.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+a.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+s.join("|")+")","i")}function Wi(e,t){B(0,[e,e.length],0,t)}function Gi(e){return Qi.call(this,e,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function Hi(e){return Qi.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function Yi(){return St(this.year(),1,4)}function qi(){return St(this.isoWeekYear(),1,4)}function Ki(){var e=this.localeData()._week;return St(this.year(),e.dow,e.doy)}function Xi(){var e=this.localeData()._week;return St(this.weekYear(),e.dow,e.doy)}function Qi(e,t,n,r,i){var a;return null==e?Et(this,r,i).year:(t>(a=St(e,r,i))&&(t=a),Ji.call(this,e,t,n,r,i))}function Ji(e,t,n,r,i){var a=wt(e,t,n,r,i),o=bt(a.year,0,a.dayOfYear);return this.year(o.getUTCFullYear()),this.month(o.getUTCMonth()),this.date(o.getUTCDate()),this}function Zi(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)}B("N",0,0,"eraAbbr"),B("NN",0,0,"eraAbbr"),B("NNN",0,0,"eraAbbr"),B("NNNN",0,0,"eraName"),B("NNNNN",0,0,"eraNarrow"),B("y",["y",1],"yo","eraYear"),B("y",["yy",2],0,"eraYear"),B("y",["yyy",3],0,"eraYear"),B("y",["yyyy",4],0,"eraYear"),Te("N",Fi),Te("NN",Fi),Te("NNN",Fi),Te("NNNN",Ui),Te("NNNNN",Bi),Me(["N","NN","NNN","NNNN","NNNNN"],(function(e,t,n,r){var i=n._locale.erasParse(e,r,n._strict);i?g(n).era=i:g(n).invalidEra=e})),Te("y",ye),Te("yy",ye),Te("yyy",ye),Te("yyyy",ye),Te("yo",Vi),Me(["y","yy","yyy","yyyy"],je),Me(["yo"],(function(e,t,n,r){var i;n._locale._eraYearOrdinalRegex&&(i=e.match(n._locale._eraYearOrdinalRegex)),n._locale.eraYearOrdinalParse?t[je]=n._locale.eraYearOrdinalParse(e,i):t[je]=parseInt(e,10)})),B(0,["gg",2],0,(function(){return this.weekYear()%100})),B(0,["GG",2],0,(function(){return this.isoWeekYear()%100})),Wi("gggg","weekYear"),Wi("ggggg","weekYear"),Wi("GGGG","isoWeekYear"),Wi("GGGGG","isoWeekYear"),Te("G",be),Te("g",be),Te("GG",fe,ce),Te("gg",fe,ce),Te("GGGG",ge,le),Te("gggg",ge,le),Te("GGGGG",ve,de),Te("ggggg",ve,de),Le(["gggg","ggggg","GGGG","GGGGG"],(function(e,t,n,r){t[r.substr(0,2)]=ke(e)})),Le(["gg","GG"],(function(e,t,n,i){t[i]=r.parseTwoDigitYear(e)})),B("Q",0,"Qo","quarter"),Te("Q",se),Me("Q",(function(e,t){t[Fe]=3*(ke(e)-1)})),B("D",["DD",2],"Do","date"),Te("D",fe,Ce),Te("DD",fe,ce),Te("Do",(function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient})),Me(["D","DD"],Ue),Me("Do",(function(e,t){t[Ue]=ke(e.match(fe)[0])}));var $i=Qe("Date",!0);function ea(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")}B("DDD",["DDDD",3],"DDDo","dayOfYear"),Te("DDD",me),Te("DDDD",ue),Me(["DDD","DDDD"],(function(e,t,n){n._dayOfYear=ke(e)})),B("m",["mm",2],0,"minute"),Te("m",fe,xe),Te("mm",fe,ce),Me(["m","mm"],Ve);var ta=Qe("Minutes",!1);B("s",["ss",2],0,"second"),Te("s",fe,xe),Te("ss",fe,ce),Me(["s","ss"],ze);var na,ra,ia=Qe("Seconds",!1);for(B("S",0,0,(function(){return~~(this.millisecond()/100)})),B(0,["SS",2],0,(function(){return~~(this.millisecond()/10)})),B(0,["SSS",3],0,"millisecond"),B(0,["SSSS",4],0,(function(){return 10*this.millisecond()})),B(0,["SSSSS",5],0,(function(){return 100*this.millisecond()})),B(0,["SSSSSS",6],0,(function(){return 1e3*this.millisecond()})),B(0,["SSSSSSS",7],0,(function(){return 1e4*this.millisecond()})),B(0,["SSSSSSSS",8],0,(function(){return 1e5*this.millisecond()})),B(0,["SSSSSSSSS",9],0,(function(){return 1e6*this.millisecond()})),Te("S",me,se),Te("SS",me,ce),Te("SSS",me,ue),na="SSSS";na.length<=9;na+="S")Te(na,ye);function aa(e,t){t[We]=ke(1e3*("0."+e))}for(na="S";na.length<=9;na+="S")Me(na,aa);function oa(){return this._isUTC?"UTC":""}function sa(){return this._isUTC?"Coordinated Universal Time":""}ra=Qe("Milliseconds",!1),B("z",0,0,"zoneAbbr"),B("zz",0,0,"zoneName");var ca=E.prototype;function ua(e){return Xn(1e3*e)}function la(){return Xn.apply(null,arguments).parseZone()}function da(e){return e}ca.add=Lr,ca.calendar=zr,ca.clone=Wr,ca.diff=Qr,ca.endOf=vi,ca.format=ti,ca.from=ni,ca.fromNow=ri,ca.to=ii,ca.toNow=ai,ca.get=$e,ca.invalidAt=Ti,ca.isAfter=Gr,ca.isBefore=Hr,ca.isBetween=Yr,ca.isSame=qr,ca.isSameOrAfter=Kr,ca.isSameOrBefore=Xr,ca.isValid=Ci,ca.lang=si,ca.locale=oi,ca.localeData=ci,ca.max=Jn,ca.min=Qn,ca.parsingFlags=xi,ca.set=et,ca.startOf=gi,ca.subtract=Or,ca.toArray=wi,ca.toObject=Ei,ca.toDate=_i,ca.toISOString=$r,ca.inspect=ei,"undefined"!==typeof Symbol&&null!=Symbol.for&&(ca[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),ca.toJSON=Si,ca.toString=Zr,ca.unix=bi,ca.valueOf=yi,ca.creationData=Ri,ca.eraName=ki,ca.eraNarrow=Di,ca.eraAbbr=Mi,ca.eraYear=Li,ca.year=Ke,ca.isLeapYear=Xe,ca.weekYear=Gi,ca.isoWeekYear=Hi,ca.quarter=ca.quarters=Zi,ca.month=ht,ca.daysInMonth=pt,ca.week=ca.weeks=It,ca.isoWeek=ca.isoWeeks=Nt,ca.weeksInYear=Ki,ca.weeksInWeekYear=Xi,ca.isoWeeksInYear=Yi,ca.isoWeeksInISOWeekYear=qi,ca.date=$i,ca.day=ca.days=Gt,ca.weekday=Ht,ca.isoWeekday=Yt,ca.dayOfYear=ea,ca.hour=ca.hours=rn,ca.minute=ca.minutes=ta,ca.second=ca.seconds=ia,ca.millisecond=ca.milliseconds=ra,ca.utcOffset=mr,ca.utc=vr,ca.local=yr,ca.parseZone=br,ca.hasAlignedHourOffset=_r,ca.isDST=wr,ca.isLocal=Sr,ca.isUtcOffset=Cr,ca.isUtc=xr,ca.isUTC=xr,ca.zoneAbbr=oa,ca.zoneName=sa,ca.dates=x("dates accessor is deprecated. Use date instead.",$i),ca.months=x("months accessor is deprecated. Use month instead",ht),ca.years=x("years accessor is deprecated. Use year instead",Ke),ca.zone=x("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",gr),ca.isDSTShifted=x("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Er);var fa=D.prototype;function ha(e,t,n,r){var i=yn(),a=p().set(r,t);return i[n](a,e)}function pa(e,t,n){if(l(e)&&(t=e,e=void 0),e=e||"",null!=t)return ha(e,t,n,"month");var r,i=[];for(r=0;r<12;r++)i[r]=ha(e,r,n,"month");return i}function ma(e,t,n,r){"boolean"===typeof e?(l(t)&&(n=t,t=void 0),t=t||""):(n=t=e,e=!1,l(t)&&(n=t,t=void 0),t=t||"");var i,a=yn(),o=e?a._week.dow:0,s=[];if(null!=n)return ha(t,(n+o)%7,r,"day");for(i=0;i<7;i++)s[i]=ha(t,(i+o)%7,r,"day");return s}function ga(e,t){return pa(e,t,"months")}function va(e,t){return pa(e,t,"monthsShort")}function ya(e,t,n){return ma(e,t,n,"weekdays")}function ba(e,t,n){return ma(e,t,n,"weekdaysShort")}function _a(e,t,n){return ma(e,t,n,"weekdaysMin")}fa.calendar=L,fa.longDateFormat=Y,fa.invalidDate=K,fa.ordinal=J,fa.preparse=da,fa.postformat=da,fa.relativeTime=$,fa.pastFuture=ee,fa.set=A,fa.eras=Ii,fa.erasParse=Ni,fa.erasConvertYear=Ai,fa.erasAbbrRegex=Pi,fa.erasNameRegex=Oi,fa.erasNarrowRegex=ji,fa.months=ct,fa.monthsShort=ut,fa.monthsParse=dt,fa.monthsRegex=gt,fa.monthsShortRegex=mt,fa.week=Ct,fa.firstDayOfYear=Rt,fa.firstDayOfWeek=Tt,fa.weekdays=Ut,fa.weekdaysMin=Vt,fa.weekdaysShort=Bt,fa.weekdaysParse=Wt,fa.weekdaysRegex=qt,fa.weekdaysShortRegex=Kt,fa.weekdaysMinRegex=Xt,fa.isPM=tn,fa.meridiem=an,mn("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===ke(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),r.lang=x("moment.lang is deprecated. Use moment.locale instead.",mn),r.langData=x("moment.langData is deprecated. Use moment.localeData instead.",yn);var wa=Math.abs;function Ea(){var e=this._data;return this._milliseconds=wa(this._milliseconds),this._days=wa(this._days),this._months=wa(this._months),e.milliseconds=wa(e.milliseconds),e.seconds=wa(e.seconds),e.minutes=wa(e.minutes),e.hours=wa(e.hours),e.months=wa(e.months),e.years=wa(e.years),this}function Sa(e,t,n,r){var i=Ir(t,n);return e._milliseconds+=r*i._milliseconds,e._days+=r*i._days,e._months+=r*i._months,e._bubble()}function Ca(e,t){return Sa(this,e,t,1)}function xa(e,t){return Sa(this,e,t,-1)}function Ta(e){return e<0?Math.floor(e):Math.ceil(e)}function Ra(){var e,t,n,r,i,a=this._milliseconds,o=this._days,s=this._months,c=this._data;return a>=0&&o>=0&&s>=0||a<=0&&o<=0&&s<=0||(a+=864e5*Ta(Na(s)+o),o=0,s=0),c.milliseconds=a%1e3,e=Ae(a/1e3),c.seconds=e%60,t=Ae(e/60),c.minutes=t%60,n=Ae(t/60),c.hours=n%24,o+=Ae(n/24),s+=i=Ae(Ia(o)),o-=Ta(Na(i)),r=Ae(s/12),s%=12,c.days=o,c.months=s,c.years=r,this}function Ia(e){return 4800*e/146097}function Na(e){return 146097*e/4800}function Aa(e){if(!this.isValid())return NaN;var t,n,r=this._milliseconds;if("month"===(e=ne(e))||"quarter"===e||"year"===e)switch(t=this._days+r/864e5,n=this._months+Ia(t),e){case"month":return n;case"quarter":return n/3;case"year":return n/12}else switch(t=this._days+Math.round(Na(this._months)),e){case"week":return t/7+r/6048e5;case"day":return t+r/864e5;case"hour":return 24*t+r/36e5;case"minute":return 1440*t+r/6e4;case"second":return 86400*t+r/1e3;case"millisecond":return Math.floor(864e5*t)+r;default:throw new Error("Unknown unit "+e)}}function ka(e){return function(){return this.as(e)}}var Da=ka("ms"),Ma=ka("s"),La=ka("m"),Oa=ka("h"),Pa=ka("d"),ja=ka("w"),Fa=ka("M"),Ua=ka("Q"),Ba=ka("y"),Va=Da;function za(){return Ir(this)}function Wa(e){return e=ne(e),this.isValid()?this[e+"s"]():NaN}function Ga(e){return function(){return this.isValid()?this._data[e]:NaN}}var Ha=Ga("milliseconds"),Ya=Ga("seconds"),qa=Ga("minutes"),Ka=Ga("hours"),Xa=Ga("days"),Qa=Ga("months"),Ja=Ga("years");function Za(){return Ae(this.days()/7)}var $a=Math.round,eo={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function to(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function no(e,t,n,r){var i=Ir(e).abs(),a=$a(i.as("s")),o=$a(i.as("m")),s=$a(i.as("h")),c=$a(i.as("d")),u=$a(i.as("M")),l=$a(i.as("w")),d=$a(i.as("y")),f=a<=n.ss&&["s",a]||a<n.s&&["ss",a]||o<=1&&["m"]||o<n.m&&["mm",o]||s<=1&&["h"]||s<n.h&&["hh",s]||c<=1&&["d"]||c<n.d&&["dd",c];return null!=n.w&&(f=f||l<=1&&["w"]||l<n.w&&["ww",l]),(f=f||u<=1&&["M"]||u<n.M&&["MM",u]||d<=1&&["y"]||["yy",d])[2]=t,f[3]=+e>0,f[4]=r,to.apply(null,f)}function ro(e){return void 0===e?$a:"function"===typeof e&&($a=e,!0)}function io(e,t){return void 0!==eo[e]&&(void 0===t?eo[e]:(eo[e]=t,"s"===e&&(eo.ss=t-1),!0))}function ao(e,t){if(!this.isValid())return this.localeData().invalidDate();var n,r,i=!1,a=eo;return"object"===typeof e&&(t=e,e=!1),"boolean"===typeof e&&(i=e),"object"===typeof t&&(a=Object.assign({},eo,t),null!=t.s&&null==t.ss&&(a.ss=t.s-1)),r=no(this,!i,a,n=this.localeData()),i&&(r=n.pastFuture(+this,r)),n.postformat(r)}var oo=Math.abs;function so(e){return(e>0)-(e<0)||+e}function co(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n,r,i,a,o,s,c=oo(this._milliseconds)/1e3,u=oo(this._days),l=oo(this._months),d=this.asSeconds();return d?(e=Ae(c/60),t=Ae(e/60),c%=60,e%=60,n=Ae(l/12),l%=12,r=c?c.toFixed(3).replace(/\.?0+$/,""):"",i=d<0?"-":"",a=so(this._months)!==so(d)?"-":"",o=so(this._days)!==so(d)?"-":"",s=so(this._milliseconds)!==so(d)?"-":"",i+"P"+(n?a+n+"Y":"")+(l?a+l+"M":"")+(u?o+u+"D":"")+(t||e||c?"T":"")+(t?s+t+"H":"")+(e?s+e+"M":"")+(c?s+r+"S":"")):"P0D"}var uo=or.prototype;return uo.isValid=ir,uo.abs=Ea,uo.add=Ca,uo.subtract=xa,uo.as=Aa,uo.asMilliseconds=Da,uo.asSeconds=Ma,uo.asMinutes=La,uo.asHours=Oa,uo.asDays=Pa,uo.asWeeks=ja,uo.asMonths=Fa,uo.asQuarters=Ua,uo.asYears=Ba,uo.valueOf=Va,uo._bubble=Ra,uo.clone=za,uo.get=Wa,uo.milliseconds=Ha,uo.seconds=Ya,uo.minutes=qa,uo.hours=Ka,uo.days=Xa,uo.weeks=Za,uo.months=Qa,uo.years=Ja,uo.humanize=ao,uo.toISOString=co,uo.toString=co,uo.toJSON=co,uo.locale=oi,uo.localeData=ci,uo.toIsoString=x("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",co),uo.lang=si,B("X",0,0,"unix"),B("x",0,0,"valueOf"),Te("x",be),Te("X",Ee),Me("X",(function(e,t,n){n._d=new Date(1e3*parseFloat(e))})),Me("x",(function(e,t,n){n._d=new Date(ke(e))})),r.version="2.30.1",i(Xn),r.fn=ca,r.min=$n,r.max=er,r.now=tr,r.utc=p,r.unix=ua,r.months=ga,r.isDate=d,r.locale=mn,r.invalid=y,r.duration=Ir,r.isMoment=S,r.weekdays=ya,r.parseZone=la,r.localeData=yn,r.isDuration=sr,r.monthsShort=va,r.weekdaysMin=_a,r.defineLocale=gn,r.updateLocale=vn,r.locales=bn,r.weekdaysShort=ba,r.normalizeUnits=ne,r.relativeTimeRounding=ro,r.relativeTimeThreshold=io,r.calendarFormat=Vr,r.prototype=ca,r.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},r}()},6191:(e,t,n)=>{"use strict";function r(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}n.d(t,{A:()=>r})},6194:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e,t){(0,i.A)(2,arguments);var n=(0,r.default)(e),a=(0,r.default)(t);return n.getFullYear()===a.getFullYear()}},6265:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(5027),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=7*(0,r.A)(t);return(0,i.default)(e,n)}},6337:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(2215),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=3*(0,r.A)(t);return(0,i.default)(e,n)}},6340:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){return(0,i.A)(1,arguments),(0,r.default)(e).getSeconds()}},6366:e=>{var t="undefined"!==typeof Element,n="function"===typeof Map,r="function"===typeof Set,i="function"===typeof ArrayBuffer&&!!ArrayBuffer.isView;function a(e,o){if(e===o)return!0;if(e&&o&&"object"==typeof e&&"object"==typeof o){if(e.constructor!==o.constructor)return!1;var s,c,u,l;if(Array.isArray(e)){if((s=e.length)!=o.length)return!1;for(c=s;0!==c--;)if(!a(e[c],o[c]))return!1;return!0}if(n&&e instanceof Map&&o instanceof Map){if(e.size!==o.size)return!1;for(l=e.entries();!(c=l.next()).done;)if(!o.has(c.value[0]))return!1;for(l=e.entries();!(c=l.next()).done;)if(!a(c.value[1],o.get(c.value[0])))return!1;return!0}if(r&&e instanceof Set&&o instanceof Set){if(e.size!==o.size)return!1;for(l=e.entries();!(c=l.next()).done;)if(!o.has(c.value[0]))return!1;return!0}if(i&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(o)){if((s=e.length)!=o.length)return!1;for(c=s;0!==c--;)if(e[c]!==o[c])return!1;return!0}if(e.constructor===RegExp)return e.source===o.source&&e.flags===o.flags;if(e.valueOf!==Object.prototype.valueOf&&"function"===typeof e.valueOf&&"function"===typeof o.valueOf)return e.valueOf()===o.valueOf();if(e.toString!==Object.prototype.toString&&"function"===typeof e.toString&&"function"===typeof o.toString)return e.toString()===o.toString();if((s=(u=Object.keys(e)).length)!==Object.keys(o).length)return!1;for(c=s;0!==c--;)if(!Object.prototype.hasOwnProperty.call(o,u[c]))return!1;if(t&&e instanceof Element)return!1;for(c=s;0!==c--;)if(("_owner"!==u[c]&&"__v"!==u[c]&&"__o"!==u[c]||!e.$$typeof)&&!a(e[u[c]],o[u[c]]))return!1;return!0}return e!==e&&o!==o}e.exports=function(e,t){try{return a(e,t)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}}},6440:e=>{"use strict";var t=function(){};e.exports=t},6496:(e,t,n)=>{"use strict";var r,i=n(9989);i.canUseDOM&&(r=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("","")),e.exports=function(e,t){if(!i.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,a=n in document;if(!a){var o=document.createElement("div");o.setAttribute(n,"return;"),a="function"===typeof o[n]}return!a&&r&&"wheel"===e&&(a=document.implementation.hasFeature("Events.wheel","3.0")),a}},6619:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetState=function(){s&&(s.removeAttribute?s.removeAttribute("aria-hidden"):null!=s.length?s.forEach((function(e){return e.removeAttribute("aria-hidden")})):document.querySelectorAll(s).forEach((function(e){return e.removeAttribute("aria-hidden")})));s=null},t.log=function(){0},t.assertNodeList=c,t.setElement=function(e){var t=e;if("string"===typeof t&&o.canUseDOM){var n=document.querySelectorAll(t);c(n,t),t=n}return s=t||s},t.validateElement=u,t.hide=function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=u(e)[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.setAttribute("aria-hidden","true")}}catch(o){n=!0,r=o}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}},t.show=function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=u(e)[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.removeAttribute("aria-hidden")}}catch(o){n=!0,r=o}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}},t.documentNotReadyOrSSRTesting=function(){s=null};var r,i=n(6440),a=(r=i)&&r.__esModule?r:{default:r},o=n(8821);var s=null;function c(e,t){if(!e||!e.length)throw new Error("react-modal: No elements were found for selector "+t+".")}function u(e){var t=e||s;return t?Array.isArray(t)||t instanceof HTMLCollection||t instanceof NodeList?t:[t]:((0,a.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}},7099:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Manager:()=>o,Popper:()=>Me,Reference:()=>Pe,usePopper:()=>Ne});var r=n(5043),i=r.createContext(),a=r.createContext();function o(e){var t=e.children,n=r.useState(null),o=n[0],s=n[1],c=r.useRef(!1);r.useEffect((function(){return function(){c.current=!0}}),[]);var u=r.useCallback((function(e){c.current||s(e)}),[]);return r.createElement(i.Provider,{value:o},r.createElement(a.Provider,{value:u},t))}var s=function(e){return Array.isArray(e)?e[0]:e},c=function(e){if("function"===typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.apply(void 0,n)}},u=function(e,t){if("function"===typeof e)return c(e,t);null!=e&&(e.current=t)},l=function(e){return e.reduce((function(e,t){var n=t[0],r=t[1];return e[n]=r,e}),{})},d="undefined"!==typeof window&&window.document&&window.document.createElement?r.useLayoutEffect:r.useEffect,f=n(7950);function h(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function p(e){return e instanceof h(e).Element||e instanceof Element}function m(e){return e instanceof h(e).HTMLElement||e instanceof HTMLElement}function g(e){return"undefined"!==typeof ShadowRoot&&(e instanceof h(e).ShadowRoot||e instanceof ShadowRoot)}var v=Math.max,y=Math.min,b=Math.round;function _(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function w(){return!/^((?!chrome|android).)*safari/i.test(_())}function E(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=e.getBoundingClientRect(),i=1,a=1;t&&m(e)&&(i=e.offsetWidth>0&&b(r.width)/e.offsetWidth||1,a=e.offsetHeight>0&&b(r.height)/e.offsetHeight||1);var o=(p(e)?h(e):window).visualViewport,s=!w()&&n,c=(r.left+(s&&o?o.offsetLeft:0))/i,u=(r.top+(s&&o?o.offsetTop:0))/a,l=r.width/i,d=r.height/a;return{width:l,height:d,top:u,right:c+l,bottom:u+d,left:c,x:c,y:u}}function S(e){var t=h(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function C(e){return e?(e.nodeName||"").toLowerCase():null}function x(e){return((p(e)?e.ownerDocument:e.document)||window.document).documentElement}function T(e){return E(x(e)).left+S(e).scrollLeft}function R(e){return h(e).getComputedStyle(e)}function I(e){var t=R(e),n=t.overflow,r=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function N(e,t,n){void 0===n&&(n=!1);var r=m(t),i=m(t)&&function(e){var t=e.getBoundingClientRect(),n=b(t.width)/e.offsetWidth||1,r=b(t.height)/e.offsetHeight||1;return 1!==n||1!==r}(t),a=x(t),o=E(e,i,n),s={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(r||!r&&!n)&&(("body"!==C(t)||I(a))&&(s=function(e){return e!==h(e)&&m(e)?{scrollLeft:(t=e).scrollLeft,scrollTop:t.scrollTop}:S(e);var t}(t)),m(t)?((c=E(t,!0)).x+=t.clientLeft,c.y+=t.clientTop):a&&(c.x=T(a))),{x:o.left+s.scrollLeft-c.x,y:o.top+s.scrollTop-c.y,width:o.width,height:o.height}}function A(e){var t=E(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function k(e){return"html"===C(e)?e:e.assignedSlot||e.parentNode||(g(e)?e.host:null)||x(e)}function D(e){return["html","body","#document"].indexOf(C(e))>=0?e.ownerDocument.body:m(e)&&I(e)?e:D(k(e))}function M(e,t){var n;void 0===t&&(t=[]);var r=D(e),i=r===(null==(n=e.ownerDocument)?void 0:n.body),a=h(r),o=i?[a].concat(a.visualViewport||[],I(r)?r:[]):r,s=t.concat(o);return i?s:s.concat(M(k(o)))}function L(e){return["table","td","th"].indexOf(C(e))>=0}function O(e){return m(e)&&"fixed"!==R(e).position?e.offsetParent:null}function P(e){for(var t=h(e),n=O(e);n&&L(n)&&"static"===R(n).position;)n=O(n);return n&&("html"===C(n)||"body"===C(n)&&"static"===R(n).position)?t:n||function(e){var t=/firefox/i.test(_());if(/Trident/i.test(_())&&m(e)&&"fixed"===R(e).position)return null;var n=k(e);for(g(n)&&(n=n.host);m(n)&&["html","body"].indexOf(C(n))<0;){var r=R(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(e)||t}var j="top",F="bottom",U="right",B="left",V="auto",z=[j,F,U,B],W="start",G="end",H="viewport",Y="popper",q=z.reduce((function(e,t){return e.concat([t+"-"+W,t+"-"+G])}),[]),K=[].concat(z,[V]).reduce((function(e,t){return e.concat([t,t+"-"+W,t+"-"+G])}),[]),X=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Q(e){var t=new Map,n=new Set,r=[];function i(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var r=t.get(e);r&&i(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||i(e)})),r}function J(e){var t;return function(){return t||(t=new Promise((function(n){Promise.resolve().then((function(){t=void 0,n(e())}))}))),t}}var Z={placement:"bottom",modifiers:[],strategy:"absolute"};function $(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"===typeof e.getBoundingClientRect)}))}function ee(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,i=t.defaultOptions,a=void 0===i?Z:i;return function(e,t,n){void 0===n&&(n=a);var i={placement:"bottom",orderedModifiers:[],options:Object.assign({},Z,a),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},o=[],s=!1,c={state:i,setOptions:function(n){var s="function"===typeof n?n(i.options):n;u(),i.options=Object.assign({},a,i.options,s),i.scrollParents={reference:p(e)?M(e):e.contextElement?M(e.contextElement):[],popper:M(t)};var l=function(e){var t=Q(e);return X.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}(function(e){var t=e.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}([].concat(r,i.options.modifiers)));return i.orderedModifiers=l.filter((function(e){return e.enabled})),i.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,a=e.effect;if("function"===typeof a){var s=a({state:i,name:t,instance:c,options:r}),u=function(){};o.push(s||u)}})),c.update()},forceUpdate:function(){if(!s){var e=i.elements,t=e.reference,n=e.popper;if($(t,n)){i.rects={reference:N(t,P(n),"fixed"===i.options.strategy),popper:A(n)},i.reset=!1,i.placement=i.options.placement,i.orderedModifiers.forEach((function(e){return i.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<i.orderedModifiers.length;r++)if(!0!==i.reset){var a=i.orderedModifiers[r],o=a.fn,u=a.options,l=void 0===u?{}:u,d=a.name;"function"===typeof o&&(i=o({state:i,options:l,name:d,instance:c})||i)}else i.reset=!1,r=-1}}},update:J((function(){return new Promise((function(e){c.forceUpdate(),e(i)}))})),destroy:function(){u(),s=!0}};if(!$(e,t))return c;function u(){o.forEach((function(e){return e()})),o=[]}return c.setOptions(n).then((function(e){!s&&n.onFirstUpdate&&n.onFirstUpdate(e)})),c}}var te={passive:!0};function ne(e){return e.split("-")[0]}function re(e){return e.split("-")[1]}function ie(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function ae(e){var t,n=e.reference,r=e.element,i=e.placement,a=i?ne(i):null,o=i?re(i):null,s=n.x+n.width/2-r.width/2,c=n.y+n.height/2-r.height/2;switch(a){case j:t={x:s,y:n.y-r.height};break;case F:t={x:s,y:n.y+n.height};break;case U:t={x:n.x+n.width,y:c};break;case B:t={x:n.x-r.width,y:c};break;default:t={x:n.x,y:n.y}}var u=a?ie(a):null;if(null!=u){var l="y"===u?"height":"width";switch(o){case W:t[u]=t[u]-(n[l]/2-r[l]/2);break;case G:t[u]=t[u]+(n[l]/2-r[l]/2)}}return t}var oe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function se(e){var t,n=e.popper,r=e.popperRect,i=e.placement,a=e.variation,o=e.offsets,s=e.position,c=e.gpuAcceleration,u=e.adaptive,l=e.roundOffsets,d=e.isFixed,f=o.x,p=void 0===f?0:f,m=o.y,g=void 0===m?0:m,v="function"===typeof l?l({x:p,y:g}):{x:p,y:g};p=v.x,g=v.y;var y=o.hasOwnProperty("x"),_=o.hasOwnProperty("y"),w=B,E=j,S=window;if(u){var C=P(n),T="clientHeight",I="clientWidth";if(C===h(n)&&"static"!==R(C=x(n)).position&&"absolute"===s&&(T="scrollHeight",I="scrollWidth"),i===j||(i===B||i===U)&&a===G)E=F,g-=(d&&C===S&&S.visualViewport?S.visualViewport.height:C[T])-r.height,g*=c?1:-1;if(i===B||(i===j||i===F)&&a===G)w=U,p-=(d&&C===S&&S.visualViewport?S.visualViewport.width:C[I])-r.width,p*=c?1:-1}var N,A=Object.assign({position:s},u&&oe),k=!0===l?function(e,t){var n=e.x,r=e.y,i=t.devicePixelRatio||1;return{x:b(n*i)/i||0,y:b(r*i)/i||0}}({x:p,y:g},h(n)):{x:p,y:g};return p=k.x,g=k.y,c?Object.assign({},A,((N={})[E]=_?"0":"",N[w]=y?"0":"",N.transform=(S.devicePixelRatio||1)<=1?"translate("+p+"px, "+g+"px)":"translate3d("+p+"px, "+g+"px, 0)",N)):Object.assign({},A,((t={})[E]=_?g+"px":"",t[w]=y?p+"px":"",t.transform="",t))}const ce={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.offset,a=void 0===i?[0,0]:i,o=K.reduce((function(e,n){return e[n]=function(e,t,n){var r=ne(e),i=[B,j].indexOf(r)>=0?-1:1,a="function"===typeof n?n(Object.assign({},t,{placement:e})):n,o=a[0],s=a[1];return o=o||0,s=(s||0)*i,[B,U].indexOf(r)>=0?{x:s,y:o}:{x:o,y:s}}(n,t.rects,a),e}),{}),s=o[t.placement],c=s.x,u=s.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=u),t.modifiersData[r]=o}};var ue={left:"right",right:"left",bottom:"top",top:"bottom"};function le(e){return e.replace(/left|right|bottom|top/g,(function(e){return ue[e]}))}var de={start:"end",end:"start"};function fe(e){return e.replace(/start|end/g,(function(e){return de[e]}))}function he(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&g(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function pe(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function me(e,t,n){return t===H?pe(function(e,t){var n=h(e),r=x(e),i=n.visualViewport,a=r.clientWidth,o=r.clientHeight,s=0,c=0;if(i){a=i.width,o=i.height;var u=w();(u||!u&&"fixed"===t)&&(s=i.offsetLeft,c=i.offsetTop)}return{width:a,height:o,x:s+T(e),y:c}}(e,n)):p(t)?function(e,t){var n=E(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):pe(function(e){var t,n=x(e),r=S(e),i=null==(t=e.ownerDocument)?void 0:t.body,a=v(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=v(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-r.scrollLeft+T(e),c=-r.scrollTop;return"rtl"===R(i||n).direction&&(s+=v(n.clientWidth,i?i.clientWidth:0)-a),{width:a,height:o,x:s,y:c}}(x(e)))}function ge(e,t,n,r){var i="clippingParents"===t?function(e){var t=M(k(e)),n=["absolute","fixed"].indexOf(R(e).position)>=0&&m(e)?P(e):e;return p(n)?t.filter((function(e){return p(e)&&he(e,n)&&"body"!==C(e)})):[]}(e):[].concat(t),a=[].concat(i,[n]),o=a[0],s=a.reduce((function(t,n){var i=me(e,n,r);return t.top=v(i.top,t.top),t.right=y(i.right,t.right),t.bottom=y(i.bottom,t.bottom),t.left=v(i.left,t.left),t}),me(e,o,r));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function ve(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function ye(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}function be(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=void 0===r?e.placement:r,a=n.strategy,o=void 0===a?e.strategy:a,s=n.boundary,c=void 0===s?"clippingParents":s,u=n.rootBoundary,l=void 0===u?H:u,d=n.elementContext,f=void 0===d?Y:d,h=n.altBoundary,m=void 0!==h&&h,g=n.padding,v=void 0===g?0:g,y=ve("number"!==typeof v?v:ye(v,z)),b=f===Y?"reference":Y,_=e.rects.popper,w=e.elements[m?b:f],S=ge(p(w)?w:w.contextElement||x(e.elements.popper),c,l,o),C=E(e.elements.reference),T=ae({reference:C,element:_,strategy:"absolute",placement:i}),R=pe(Object.assign({},_,T)),I=f===Y?R:C,N={top:S.top-I.top+y.top,bottom:I.bottom-S.bottom+y.bottom,left:S.left-I.left+y.left,right:I.right-S.right+y.right},A=e.modifiersData.offset;if(f===Y&&A){var k=A[i];Object.keys(N).forEach((function(e){var t=[U,F].indexOf(e)>=0?1:-1,n=[j,F].indexOf(e)>=0?"y":"x";N[e]+=k[n]*t}))}return N}function _e(e,t,n){return v(e,y(t,n))}const we={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.mainAxis,a=void 0===i||i,o=n.altAxis,s=void 0!==o&&o,c=n.boundary,u=n.rootBoundary,l=n.altBoundary,d=n.padding,f=n.tether,h=void 0===f||f,p=n.tetherOffset,m=void 0===p?0:p,g=be(t,{boundary:c,rootBoundary:u,padding:d,altBoundary:l}),b=ne(t.placement),_=re(t.placement),w=!_,E=ie(b),S="x"===E?"y":"x",C=t.modifiersData.popperOffsets,x=t.rects.reference,T=t.rects.popper,R="function"===typeof m?m(Object.assign({},t.rects,{placement:t.placement})):m,I="number"===typeof R?{mainAxis:R,altAxis:R}:Object.assign({mainAxis:0,altAxis:0},R),N=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,k={x:0,y:0};if(C){if(a){var D,M="y"===E?j:B,L="y"===E?F:U,O="y"===E?"height":"width",V=C[E],z=V+g[M],G=V-g[L],H=h?-T[O]/2:0,Y=_===W?x[O]:T[O],q=_===W?-T[O]:-x[O],K=t.elements.arrow,X=h&&K?A(K):{width:0,height:0},Q=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},J=Q[M],Z=Q[L],$=_e(0,x[O],X[O]),ee=w?x[O]/2-H-$-J-I.mainAxis:Y-$-J-I.mainAxis,te=w?-x[O]/2+H+$+Z+I.mainAxis:q+$+Z+I.mainAxis,ae=t.elements.arrow&&P(t.elements.arrow),oe=ae?"y"===E?ae.clientTop||0:ae.clientLeft||0:0,se=null!=(D=null==N?void 0:N[E])?D:0,ce=V+te-se,ue=_e(h?y(z,V+ee-se-oe):z,V,h?v(G,ce):G);C[E]=ue,k[E]=ue-V}if(s){var le,de="x"===E?j:B,fe="x"===E?F:U,he=C[S],pe="y"===S?"height":"width",me=he+g[de],ge=he-g[fe],ve=-1!==[j,B].indexOf(b),ye=null!=(le=null==N?void 0:N[S])?le:0,we=ve?me:he-x[pe]-T[pe]-ye+I.altAxis,Ee=ve?he+x[pe]+T[pe]-ye-I.altAxis:ge,Se=h&&ve?function(e,t,n){var r=_e(e,t,n);return r>n?n:r}(we,he,Ee):_e(h?we:me,he,h?Ee:ge);C[S]=Se,k[S]=Se-he}t.modifiersData[r]=k}},requiresIfExists:["offset"]};const Ee={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,r=e.name,i=e.options,a=n.elements.arrow,o=n.modifiersData.popperOffsets,s=ne(n.placement),c=ie(s),u=[B,U].indexOf(s)>=0?"height":"width";if(a&&o){var l=function(e,t){return ve("number"!==typeof(e="function"===typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:ye(e,z))}(i.padding,n),d=A(a),f="y"===c?j:B,h="y"===c?F:U,p=n.rects.reference[u]+n.rects.reference[c]-o[c]-n.rects.popper[u],m=o[c]-n.rects.reference[c],g=P(a),v=g?"y"===c?g.clientHeight||0:g.clientWidth||0:0,y=p/2-m/2,b=l[f],_=v-d[u]-l[h],w=v/2-d[u]/2+y,E=_e(b,w,_),S=c;n.modifiersData[r]=((t={})[S]=E,t.centerOffset=E-w,t)}},effect:function(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!==typeof r||(r=t.elements.popper.querySelector(r)))&&he(t.elements.popper,r)&&(t.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Se(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function Ce(e){return[j,U,F,B].some((function(t){return e[t]>=0}))}var xe=ee({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,a=void 0===i||i,o=r.resize,s=void 0===o||o,c=h(t.elements.popper),u=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&u.forEach((function(e){e.addEventListener("scroll",n.update,te)})),s&&c.addEventListener("resize",n.update,te),function(){a&&u.forEach((function(e){e.removeEventListener("scroll",n.update,te)})),s&&c.removeEventListener("resize",n.update,te)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=ae({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=void 0===r||r,a=n.adaptive,o=void 0===a||a,s=n.roundOffsets,c=void 0===s||s,u={placement:ne(t.placement),variation:re(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,se(Object.assign({},u,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,se(Object.assign({},u,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},i=t.elements[e];m(i)&&C(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(e){var t=r[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],i=t.attributes[e]||{},a=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});m(r)&&C(r)&&(Object.assign(r.style,a),Object.keys(i).forEach((function(e){r.removeAttribute(e)})))}))}},requires:["computeStyles"]},ce,{name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var i=n.mainAxis,a=void 0===i||i,o=n.altAxis,s=void 0===o||o,c=n.fallbackPlacements,u=n.padding,l=n.boundary,d=n.rootBoundary,f=n.altBoundary,h=n.flipVariations,p=void 0===h||h,m=n.allowedAutoPlacements,g=t.options.placement,v=ne(g),y=c||(v===g||!p?[le(g)]:function(e){if(ne(e)===V)return[];var t=le(e);return[fe(e),t,fe(t)]}(g)),b=[g].concat(y).reduce((function(e,n){return e.concat(ne(n)===V?function(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=n.boundary,a=n.rootBoundary,o=n.padding,s=n.flipVariations,c=n.allowedAutoPlacements,u=void 0===c?K:c,l=re(r),d=l?s?q:q.filter((function(e){return re(e)===l})):z,f=d.filter((function(e){return u.indexOf(e)>=0}));0===f.length&&(f=d);var h=f.reduce((function(t,n){return t[n]=be(e,{placement:n,boundary:i,rootBoundary:a,padding:o})[ne(n)],t}),{});return Object.keys(h).sort((function(e,t){return h[e]-h[t]}))}(t,{placement:n,boundary:l,rootBoundary:d,padding:u,flipVariations:p,allowedAutoPlacements:m}):n)}),[]),_=t.rects.reference,w=t.rects.popper,E=new Map,S=!0,C=b[0],x=0;x<b.length;x++){var T=b[x],R=ne(T),I=re(T)===W,N=[j,F].indexOf(R)>=0,A=N?"width":"height",k=be(t,{placement:T,boundary:l,rootBoundary:d,altBoundary:f,padding:u}),D=N?I?U:B:I?F:j;_[A]>w[A]&&(D=le(D));var M=le(D),L=[];if(a&&L.push(k[R]<=0),s&&L.push(k[D]<=0,k[M]<=0),L.every((function(e){return e}))){C=T,S=!1;break}E.set(T,L)}if(S)for(var O=function(e){var t=b.find((function(t){var n=E.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return C=t,"break"},P=p?3:1;P>0;P--){if("break"===O(P))break}t.placement!==C&&(t.modifiersData[r]._skip=!0,t.placement=C,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},we,Ee,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,r=t.rects.reference,i=t.rects.popper,a=t.modifiersData.preventOverflow,o=be(t,{elementContext:"reference"}),s=be(t,{altBoundary:!0}),c=Se(o,r),u=Se(s,i,a),l=Ce(c),d=Ce(u);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:u,isReferenceHidden:l,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":l,"data-popper-escaped":d})}}]}),Te=n(6366),Re=n.n(Te),Ie=[],Ne=function(e,t,n){void 0===n&&(n={});var i=r.useRef(null),a={onFirstUpdate:n.onFirstUpdate,placement:n.placement||"bottom",strategy:n.strategy||"absolute",modifiers:n.modifiers||Ie},o=r.useState({styles:{popper:{position:a.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),s=o[0],c=o[1],u=r.useMemo((function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(e){var t=e.state,n=Object.keys(t.elements);f.flushSync((function(){c({styles:l(n.map((function(e){return[e,t.styles[e]||{}]}))),attributes:l(n.map((function(e){return[e,t.attributes[e]]})))})}))},requires:["computeStyles"]}}),[]),h=r.useMemo((function(){var e={onFirstUpdate:a.onFirstUpdate,placement:a.placement,strategy:a.strategy,modifiers:[].concat(a.modifiers,[u,{name:"applyStyles",enabled:!1}])};return Re()(i.current,e)?i.current||e:(i.current=e,e)}),[a.onFirstUpdate,a.placement,a.strategy,a.modifiers,u]),p=r.useRef();return d((function(){p.current&&p.current.setOptions(h)}),[h]),d((function(){if(null!=e&&null!=t){var r=(n.createPopper||xe)(e,t,h);return p.current=r,function(){r.destroy(),p.current=null}}}),[e,t,n.createPopper]),{state:p.current?p.current.state:null,styles:s.styles,attributes:s.attributes,update:p.current?p.current.update:null,forceUpdate:p.current?p.current.forceUpdate:null}},Ae=function(){},ke=function(){return Promise.resolve(null)},De=[];function Me(e){var t=e.placement,n=void 0===t?"bottom":t,a=e.strategy,o=void 0===a?"absolute":a,c=e.modifiers,l=void 0===c?De:c,d=e.referenceElement,f=e.onFirstUpdate,h=e.innerRef,p=e.children,m=r.useContext(i),g=r.useState(null),v=g[0],y=g[1],b=r.useState(null),_=b[0],w=b[1];r.useEffect((function(){u(h,v)}),[h,v]);var E=r.useMemo((function(){return{placement:n,strategy:o,onFirstUpdate:f,modifiers:[].concat(l,[{name:"arrow",enabled:null!=_,options:{element:_}}])}}),[n,o,f,l,_]),S=Ne(d||m,v,E),C=S.state,x=S.styles,T=S.forceUpdate,R=S.update,I=r.useMemo((function(){return{ref:y,style:x.popper,placement:C?C.placement:n,hasPopperEscaped:C&&C.modifiersData.hide?C.modifiersData.hide.hasPopperEscaped:null,isReferenceHidden:C&&C.modifiersData.hide?C.modifiersData.hide.isReferenceHidden:null,arrowProps:{style:x.arrow,ref:w},forceUpdate:T||Ae,update:R||ke}}),[y,w,n,C,x,R,T]);return s(p)(I)}var Le=n(6440),Oe=n.n(Le);function Pe(e){var t=e.children,n=e.innerRef,i=r.useContext(a),o=r.useCallback((function(e){u(n,e),c(i,e)}),[n,i]);return r.useEffect((function(){return function(){return u(n,null)}}),[]),r.useEffect((function(){Oe()(Boolean(i),"`Reference` should not be used outside of a `Manager` component.")}),[i]),s(t)({ref:o})}},7124:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){return(0,i.A)(1,arguments),(0,r.default)(e).getMinutes()}},7184:()=>{},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var s=2*(r+1)-1,c=e[s],u=s+1,l=e[u];if(0>a(c,n))u<i&&0>a(l,c)?(e[r]=l,e[u]=n,r=u):(e[r]=c,e[s]=n,r=s);else{if(!(u<i&&0>a(l,n)))break e;e[r]=l,e[u]=n,r=u}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var u=[],l=[],d=1,f=null,h=3,p=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function _(e){for(var t=r(l);null!==t;){if(null===t.callback)i(l);else{if(!(t.startTime<=e))break;i(l),t.sortIndex=t.expirationTime,n(u,t)}t=r(l)}}function w(e){if(g=!1,_(e),!m)if(null!==r(u))m=!0,M(E);else{var t=r(l);null!==t&&L(w,t.startTime-e)}}function E(e,n){m=!1,g&&(g=!1,y(T),T=-1),p=!0;var a=h;try{for(_(n),f=r(u);null!==f&&(!(f.expirationTime>n)||e&&!N());){var o=f.callback;if("function"===typeof o){f.callback=null,h=f.priorityLevel;var s=o(f.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?f.callback=s:f===r(u)&&i(u),_(n)}else i(u);f=r(u)}if(null!==f)var c=!0;else{var d=r(l);null!==d&&L(w,d.startTime-n),c=!1}return c}finally{f=null,h=a,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,C=!1,x=null,T=-1,R=5,I=-1;function N(){return!(t.unstable_now()-I<R)}function A(){if(null!==x){var e=t.unstable_now();I=e;var n=!0;try{n=x(!0,e)}finally{n?S():(C=!1,x=null)}}else C=!1}if("function"===typeof b)S=function(){b(A)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,D=k.port2;k.port1.onmessage=A,S=function(){D.postMessage(null)}}else S=function(){v(A,0)};function M(e){x=e,C||(C=!0,S())}function L(e,n){T=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,M(E))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return r(u)},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},t.unstable_scheduleCallback=function(e,i,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(l,e),null===r(u)&&e===r(l)&&(g?(y(T),T=-1):g=!0,L(w,a-o))):(e.sortIndex=s,n(u,e),m||p||(m=!0,M(E))),e},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}},7318:()=>{},7358:(e,t)=>{"use strict";var n,r=Symbol.for("react.element"),i=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),u=Symbol.for("react.context"),l=Symbol.for("react.server_context"),d=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.offscreen");function v(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case a:case s:case o:case f:case h:return e;default:switch(e=e&&e.$$typeof){case l:case u:case d:case m:case p:case c:return e;default:return t}}case i:return t}}}n=Symbol.for("react.module.reference")},7396:(e,t,n)=>{var r;!function(){"use strict";var i=!("undefined"===typeof window||!window.document||!window.document.createElement),a={canUseDOM:i,canUseWorkers:"undefined"!==typeof Worker,canUseEventListeners:i&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:i&&!!window.screen};void 0===(r=function(){return a}.call(t,n,t,e))||(e.exports=r)}()},7451:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(888),i=n(8726),a=n(6191),o=n(8171);function s(e,t){var n,s,c,u,l,d,f,h;(0,i.A)(1,arguments);var p=(0,o.q)(),m=(0,a.A)(null!==(n=null!==(s=null!==(c=null!==(u=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==u?u:null===t||void 0===t||null===(l=t.locale)||void 0===l||null===(d=l.options)||void 0===d?void 0:d.weekStartsOn)&&void 0!==c?c:p.weekStartsOn)&&void 0!==s?s:null===(f=p.locale)||void 0===f||null===(h=f.options)||void 0===h?void 0:h.weekStartsOn)&&void 0!==n?n:0);if(!(m>=0&&m<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var g=(0,r.default)(e),v=g.getUTCDay(),y=(v<m?7:0)+v-m;return g.setUTCDate(g.getUTCDate()-y),g.setUTCHours(0,0,0,0),g}},7487:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n(6191),i=n(2550),a=n(8726),o=36e5;function s(e,t){(0,a.A)(2,arguments);var n=(0,r.A)(t);return(0,i.A)(e,n*o)}},7531:()=>{},7532:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(888),i=n(4960),a=n(7780),o=n(8726);var s=6048e5;function c(e){(0,o.A)(1,arguments);var t=(0,r.default)(e),n=(0,i.A)(t).getTime()-function(e){(0,o.A)(1,arguments);var t=(0,a.A)(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),(0,i.A)(n)}(t).getTime();return Math.round(n/s)+1}},7566:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(888),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,i.default)(e),o=(0,r.A)(t);return n.setHours(o),n}},7660:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){(0,i.A)(1,arguments);var t=(0,r.default)(e);return t.setDate(1),t.setHours(0,0,0,0),t}},7780:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(888),i=n(8726),a=n(4960);function o(e){(0,i.A)(1,arguments);var t=(0,r.default)(e),n=t.getUTCFullYear(),o=new Date(0);o.setUTCFullYear(n+1,0,4),o.setUTCHours(0,0,0,0);var s=(0,a.A)(o),c=new Date(0);c.setUTCFullYear(n,0,4),c.setUTCHours(0,0,0,0);var u=(0,a.A)(c);return t.getTime()>=s.getTime()?n+1:t.getTime()>=u.getTime()?n:n-1}},7815:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e,t){(0,i.A)(2,arguments);var n=(0,r.default)(e),a=(0,r.default)(t);return n.getFullYear()-a.getFullYear()}},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},8139:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function i(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=o(e,a(n)))}return e}function a(e){if("string"===typeof e||"number"===typeof e)return e;if("object"!==typeof e)return"";if(Array.isArray(e))return i.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=o(t,n));return t}function o(e,t){return t?e?e+" "+t:e+t:e}e.exports?(i.default=i,e.exports=i):void 0===(n=function(){return i}.apply(t,[]))||(e.exports=n)}()},8170:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){return(0,i.A)(1,arguments),(0,r.default)(e).getTime()}},8171:(e,t,n)=>{"use strict";n.d(t,{q:()=>i});var r={};function i(){return r}},8224:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(888),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,i.default)(e),o=(0,r.A)(t),s=n.getFullYear(),c=n.getDate(),u=new Date(0);u.setFullYear(s,o,15),u.setHours(0,0,0,0);var l=function(e){(0,a.A)(1,arguments);var t=(0,i.default)(e),n=t.getFullYear(),r=t.getMonth(),o=new Date(0);return o.setFullYear(n,r+1,0),o.setHours(0,0,0,0),o.getDate()}(u);return n.setMonth(o,Math.min(c,l)),n}},8435:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},i=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}};const a={p:i,P:function(e,t){var n,a=e.match(/(P+)(p+)?/)||[],o=a[1],s=a[2];if(!s)return r(e,t);switch(o){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",r(o,t)).replace("{{time}}",i(s,t))}}},8443:(e,t,n)=>{"use strict";e.exports=n(9717)},8539:(e,t,n)=>{"use strict";function r(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}n.d(t,{A:()=>r})},8613:function(e,t){var n;!function(t,n){"use strict";"object"===typeof e.exports?e.exports=t.document?n(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return n(e)}:n(t)}("undefined"!==typeof window?window:this,(function(r,i){"use strict";var a=[],o=Object.getPrototypeOf,s=a.slice,c=a.flat?function(e){return a.flat.call(e)}:function(e){return a.concat.apply([],e)},u=a.push,l=a.indexOf,d={},f=d.toString,h=d.hasOwnProperty,p=h.toString,m=p.call(Object),g={},v=function(e){return"function"===typeof e&&"number"!==typeof e.nodeType&&"function"!==typeof e.item},y=function(e){return null!=e&&e===e.window},b=r.document,_={type:!0,src:!0,nonce:!0,noModule:!0};function w(e,t,n){var r,i,a=(n=n||b).createElement("script");if(a.text=e,t)for(r in _)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&a.setAttribute(r,i);n.head.appendChild(a).parentNode.removeChild(a)}function E(e){return null==e?e+"":"object"===typeof e||"function"===typeof e?d[f.call(e)]||"object":typeof e}var S="3.7.1",C=/HTML$/i,x=function(e,t){return new x.fn.init(e,t)};function T(e){var t=!!e&&"length"in e&&e.length,n=E(e);return!v(e)&&!y(e)&&("array"===n||0===t||"number"===typeof t&&t>0&&t-1 in e)}function R(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}x.fn=x.prototype={jquery:S,constructor:x,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=x.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return x.each(this,e)},map:function(e){return this.pushStack(x.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(x.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(x.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:a.sort,splice:a.splice},x.extend=x.fn.extend=function(){var e,t,n,r,i,a,o=arguments[0]||{},s=1,c=arguments.length,u=!1;for("boolean"===typeof o&&(u=o,o=arguments[s]||{},s++),"object"===typeof o||v(o)||(o={}),s===c&&(o=this,s--);s<c;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&o!==r&&(u&&r&&(x.isPlainObject(r)||(i=Array.isArray(r)))?(n=o[t],a=i&&!Array.isArray(n)?[]:i||x.isPlainObject(n)?n:{},i=!1,o[t]=x.extend(u,a,r)):void 0!==r&&(o[t]=r));return o},x.extend({expando:"jQuery"+(S+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==f.call(e))&&(!(t=o(e))||"function"===typeof(n=h.call(t,"constructor")&&t.constructor)&&p.call(n)===m)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){w(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(T(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},text:function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r++];)n+=x.text(t);return 1===i||11===i?e.textContent:9===i?e.documentElement.textContent:3===i||4===i?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&(T(Object(e))?x.merge(n,"string"===typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:l.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!C.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,a=e.length,o=!n;i<a;i++)!t(e[i],i)!==o&&r.push(e[i]);return r},map:function(e,t,n){var r,i,a=0,o=[];if(T(e))for(r=e.length;a<r;a++)null!=(i=t(e[a],a,n))&&o.push(i);else for(a in e)null!=(i=t(e[a],a,n))&&o.push(i);return c(o)},guid:1,support:g}),"function"===typeof Symbol&&(x.fn[Symbol.iterator]=a[Symbol.iterator]),x.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){d["[object "+t+"]"]=t.toLowerCase()}));var I=a.pop,N=a.sort,A=a.splice,k="[\\x20\\t\\r\\n\\f]",D=new RegExp("^"+k+"+|((?:^|[^\\\\])(?:\\\\.)*)"+k+"+$","g");x.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var M=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function L(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}x.escapeSelector=function(e){return(e+"").replace(M,L)};var O=b,P=u;!function(){var e,t,n,i,o,c,u,d,f,p,m=P,v=x.expando,y=0,b=0,_=ee(),w=ee(),E=ee(),S=ee(),C=function(e,t){return e===t&&(o=!0),0},T="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="(?:\\\\[\\da-fA-F]{1,6}"+k+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",L="\\["+k+"*("+M+")(?:"+k+"*([*^$|!~]?=)"+k+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+k+"*\\]",j=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+L+")*)|.*)\\)|)",F=new RegExp(k+"+","g"),U=new RegExp("^"+k+"*,"+k+"*"),B=new RegExp("^"+k+"*([>+~]|"+k+")"+k+"*"),V=new RegExp(k+"|>"),z=new RegExp(j),W=new RegExp("^"+M+"$"),G={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+L),PSEUDO:new RegExp("^"+j),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+k+"*(even|odd|(([+-]|)(\\d*)n|)"+k+"*(?:([+-]|)"+k+"*(\\d+)|))"+k+"*\\)|)","i"),bool:new RegExp("^(?:"+T+")$","i"),needsContext:new RegExp("^"+k+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+k+"*((?:-\\d)?\\d*)"+k+"*\\)|)(?=[^-]|$)","i")},H=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,K=/[+~]/,X=new RegExp("\\\\[\\da-fA-F]{1,6}"+k+"?|\\\\([^\\r\\n\\f])","g"),Q=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},J=function(){ce()},Z=fe((function(e){return!0===e.disabled&&R(e,"fieldset")}),{dir:"parentNode",next:"legend"});try{m.apply(a=s.call(O.childNodes),O.childNodes),a[O.childNodes.length].nodeType}catch(be){m={apply:function(e,t){P.apply(e,s.call(t))},call:function(e){P.apply(e,s.call(arguments,1))}}}function $(e,t,n,r){var i,a,o,s,u,l,h,p=t&&t.ownerDocument,y=t?t.nodeType:9;if(n=n||[],"string"!==typeof e||!e||1!==y&&9!==y&&11!==y)return n;if(!r&&(ce(t),t=t||c,d)){if(11!==y&&(u=q.exec(e)))if(i=u[1]){if(9===y){if(!(o=t.getElementById(i)))return n;if(o.id===i)return m.call(n,o),n}else if(p&&(o=p.getElementById(i))&&$.contains(t,o)&&o.id===i)return m.call(n,o),n}else{if(u[2])return m.apply(n,t.getElementsByTagName(e)),n;if((i=u[3])&&t.getElementsByClassName)return m.apply(n,t.getElementsByClassName(i)),n}if(!S[e+" "]&&(!f||!f.test(e))){if(h=e,p=t,1===y&&(V.test(e)||B.test(e))){for((p=K.test(e)&&se(t.parentNode)||t)==t&&g.scope||((s=t.getAttribute("id"))?s=x.escapeSelector(s):t.setAttribute("id",s=v)),a=(l=le(e)).length;a--;)l[a]=(s?"#"+s:":scope")+" "+de(l[a]);h=l.join(",")}try{return m.apply(n,p.querySelectorAll(h)),n}catch(b){S(e,!0)}finally{s===v&&t.removeAttribute("id")}}}return ye(e.replace(D,"$1"),t,n,r)}function ee(){var e=[];return function n(r,i){return e.push(r+" ")>t.cacheLength&&delete n[e.shift()],n[r+" "]=i}}function te(e){return e[v]=!0,e}function ne(e){var t=c.createElement("fieldset");try{return!!e(t)}catch(be){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function re(e){return function(t){return R(t,"input")&&t.type===e}}function ie(e){return function(t){return(R(t,"input")||R(t,"button"))&&t.type===e}}function ae(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&Z(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function oe(e){return te((function(t){return t=+t,te((function(n,r){for(var i,a=e([],n.length,t),o=a.length;o--;)n[i=a[o]]&&(n[i]=!(r[i]=n[i]))}))}))}function se(e){return e&&"undefined"!==typeof e.getElementsByTagName&&e}function ce(e){var n,r=e?e.ownerDocument||e:O;return r!=c&&9===r.nodeType&&r.documentElement?(u=(c=r).documentElement,d=!x.isXMLDoc(c),p=u.matches||u.webkitMatchesSelector||u.msMatchesSelector,u.msMatchesSelector&&O!=c&&(n=c.defaultView)&&n.top!==n&&n.addEventListener("unload",J),g.getById=ne((function(e){return u.appendChild(e).id=x.expando,!c.getElementsByName||!c.getElementsByName(x.expando).length})),g.disconnectedMatch=ne((function(e){return p.call(e,"*")})),g.scope=ne((function(){return c.querySelectorAll(":scope")})),g.cssHas=ne((function(){try{return c.querySelector(":has(*,:jqfake)"),!1}catch(be){return!0}})),g.getById?(t.filter.ID=function(e){var t=e.replace(X,Q);return function(e){return e.getAttribute("id")===t}},t.find.ID=function(e,t){if("undefined"!==typeof t.getElementById&&d){var n=t.getElementById(e);return n?[n]:[]}}):(t.filter.ID=function(e){var t=e.replace(X,Q);return function(e){var n="undefined"!==typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},t.find.ID=function(e,t){if("undefined"!==typeof t.getElementById&&d){var n,r,i,a=t.getElementById(e);if(a){if((n=a.getAttributeNode("id"))&&n.value===e)return[a];for(i=t.getElementsByName(e),r=0;a=i[r++];)if((n=a.getAttributeNode("id"))&&n.value===e)return[a]}return[]}}),t.find.TAG=function(e,t){return"undefined"!==typeof t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},t.find.CLASS=function(e,t){if("undefined"!==typeof t.getElementsByClassName&&d)return t.getElementsByClassName(e)},f=[],ne((function(e){var t;u.appendChild(e).innerHTML="<a id='"+v+"' href='' disabled='disabled'></a><select id='"+v+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||f.push("\\["+k+"*(?:value|"+T+")"),e.querySelectorAll("[id~="+v+"-]").length||f.push("~="),e.querySelectorAll("a#"+v+"+*").length||f.push(".#.+[+~]"),e.querySelectorAll(":checked").length||f.push(":checked"),(t=c.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),u.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&f.push(":enabled",":disabled"),(t=c.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||f.push("\\["+k+"*name"+k+"*="+k+"*(?:''|\"\")")})),g.cssHas||f.push(":has"),f=f.length&&new RegExp(f.join("|")),C=function(e,t){if(e===t)return o=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!g.sortDetached&&t.compareDocumentPosition(e)===n?e===c||e.ownerDocument==O&&$.contains(O,e)?-1:t===c||t.ownerDocument==O&&$.contains(O,t)?1:i?l.call(i,e)-l.call(i,t):0:4&n?-1:1)},c):c}for(e in $.matches=function(e,t){return $(e,null,null,t)},$.matchesSelector=function(e,t){if(ce(e),d&&!S[t+" "]&&(!f||!f.test(t)))try{var n=p.call(e,t);if(n||g.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(be){S(t,!0)}return $(t,c,null,[e]).length>0},$.contains=function(e,t){return(e.ownerDocument||e)!=c&&ce(e),x.contains(e,t)},$.attr=function(e,n){(e.ownerDocument||e)!=c&&ce(e);var r=t.attrHandle[n.toLowerCase()],i=r&&h.call(t.attrHandle,n.toLowerCase())?r(e,n,!d):void 0;return void 0!==i?i:e.getAttribute(n)},$.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},x.uniqueSort=function(e){var t,n=[],r=0,a=0;if(o=!g.sortStable,i=!g.sortStable&&s.call(e,0),N.call(e,C),o){for(;t=e[a++];)t===e[a]&&(r=n.push(a));for(;r--;)A.call(e,n[r],1)}return i=null,e},x.fn.uniqueSort=function(){return this.pushStack(x.uniqueSort(s.apply(this)))},t=x.expr={cacheLength:50,createPseudo:te,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(X,Q),e[3]=(e[3]||e[4]||e[5]||"").replace(X,Q),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||$.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&$.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&z.test(n)&&(t=le(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(X,Q).toLowerCase();return"*"===e?function(){return!0}:function(e){return R(e,t)}},CLASS:function(e){var t=_[e+" "];return t||(t=new RegExp("(^|"+k+")"+e+"("+k+"|$)"))&&_(e,(function(e){return t.test("string"===typeof e.className&&e.className||"undefined"!==typeof e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(r){var i=$.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(F," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var a="nth"!==e.slice(0,3),o="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,c){var u,l,d,f,h,p=a!==o?"nextSibling":"previousSibling",m=t.parentNode,g=s&&t.nodeName.toLowerCase(),b=!c&&!s,_=!1;if(m){if(a){for(;p;){for(d=t;d=d[p];)if(s?R(d,g):1===d.nodeType)return!1;h=p="only"===e&&!h&&"nextSibling"}return!0}if(h=[o?m.firstChild:m.lastChild],o&&b){for(_=(f=(u=(l=m[v]||(m[v]={}))[e]||[])[0]===y&&u[1])&&u[2],d=f&&m.childNodes[f];d=++f&&d&&d[p]||(_=f=0)||h.pop();)if(1===d.nodeType&&++_&&d===t){l[e]=[y,f,_];break}}else if(b&&(_=f=(u=(l=t[v]||(t[v]={}))[e]||[])[0]===y&&u[1]),!1===_)for(;(d=++f&&d&&d[p]||(_=f=0)||h.pop())&&(!(s?R(d,g):1===d.nodeType)||!++_||(b&&((l=d[v]||(d[v]={}))[e]=[y,_]),d!==t)););return(_-=i)===r||_%r===0&&_/r>=0}}},PSEUDO:function(e,n){var r,i=t.pseudos[e]||t.setFilters[e.toLowerCase()]||$.error("unsupported pseudo: "+e);return i[v]?i(n):i.length>1?(r=[e,e,"",n],t.setFilters.hasOwnProperty(e.toLowerCase())?te((function(e,t){for(var r,a=i(e,n),o=a.length;o--;)e[r=l.call(e,a[o])]=!(t[r]=a[o])})):function(e){return i(e,0,r)}):i}},pseudos:{not:te((function(e){var t=[],n=[],r=ve(e.replace(D,"$1"));return r[v]?te((function(e,t,n,i){for(var a,o=r(e,null,i,[]),s=e.length;s--;)(a=o[s])&&(e[s]=!(t[s]=a))})):function(e,i,a){return t[0]=e,r(t,null,a,n),t[0]=null,!n.pop()}})),has:te((function(e){return function(t){return $(e,t).length>0}})),contains:te((function(e){return e=e.replace(X,Q),function(t){return(t.textContent||x.text(t)).indexOf(e)>-1}})),lang:te((function(e){return W.test(e||"")||$.error("unsupported lang: "+e),e=e.replace(X,Q).toLowerCase(),function(t){var n;do{if(n=d?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=r.location&&r.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===u},focus:function(e){return e===function(){try{return c.activeElement}catch(e){}}()&&c.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:ae(!1),disabled:ae(!0),checked:function(e){return R(e,"input")&&!!e.checked||R(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!t.pseudos.empty(e)},header:function(e){return Y.test(e.nodeName)},input:function(e){return H.test(e.nodeName)},button:function(e){return R(e,"input")&&"button"===e.type||R(e,"button")},text:function(e){var t;return R(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:oe((function(){return[0]})),last:oe((function(e,t){return[t-1]})),eq:oe((function(e,t,n){return[n<0?n+t:n]})),even:oe((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:oe((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:oe((function(e,t,n){var r;for(r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:oe((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}},t.pseudos.nth=t.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})t.pseudos[e]=re(e);for(e in{submit:!0,reset:!0})t.pseudos[e]=ie(e);function ue(){}function le(e,n){var r,i,a,o,s,c,u,l=w[e+" "];if(l)return n?0:l.slice(0);for(s=e,c=[],u=t.preFilter;s;){for(o in r&&!(i=U.exec(s))||(i&&(s=s.slice(i[0].length)||s),c.push(a=[])),r=!1,(i=B.exec(s))&&(r=i.shift(),a.push({value:r,type:i[0].replace(D," ")}),s=s.slice(r.length)),t.filter)!(i=G[o].exec(s))||u[o]&&!(i=u[o](i))||(r=i.shift(),a.push({value:r,type:o,matches:i}),s=s.slice(r.length));if(!r)break}return n?s.length:s?$.error(e):w(e,c).slice(0)}function de(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function fe(e,t,n){var r=t.dir,i=t.next,a=i||r,o=n&&"parentNode"===a,s=b++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i);return!1}:function(t,n,c){var u,l,d=[y,s];if(c){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(l=t[v]||(t[v]={}),i&&R(t,i))t=t[r]||t;else{if((u=l[a])&&u[0]===y&&u[1]===s)return d[2]=u[2];if(l[a]=d,d[2]=e(t,n,c))return!0}return!1}}function he(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function pe(e,t,n,r,i){for(var a,o=[],s=0,c=e.length,u=null!=t;s<c;s++)(a=e[s])&&(n&&!n(a,r,i)||(o.push(a),u&&t.push(s)));return o}function me(e,t,n,r,i,a){return r&&!r[v]&&(r=me(r)),i&&!i[v]&&(i=me(i,a)),te((function(a,o,s,c){var u,d,f,h,p=[],g=[],v=o.length,y=a||function(e,t,n){for(var r=0,i=t.length;r<i;r++)$(e,t[r],n);return n}(t||"*",s.nodeType?[s]:s,[]),b=!e||!a&&t?y:pe(y,p,e,s,c);if(n?n(b,h=i||(a?e:v||r)?[]:o,s,c):h=b,r)for(u=pe(h,g),r(u,[],s,c),d=u.length;d--;)(f=u[d])&&(h[g[d]]=!(b[g[d]]=f));if(a){if(i||e){if(i){for(u=[],d=h.length;d--;)(f=h[d])&&u.push(b[d]=f);i(null,h=[],u,c)}for(d=h.length;d--;)(f=h[d])&&(u=i?l.call(a,f):p[d])>-1&&(a[u]=!(o[u]=f))}}else h=pe(h===o?h.splice(v,h.length):h),i?i(null,o,h,c):m.apply(o,h)}))}function ge(e){for(var r,i,a,o=e.length,s=t.relative[e[0].type],c=s||t.relative[" "],u=s?1:0,d=fe((function(e){return e===r}),c,!0),f=fe((function(e){return l.call(r,e)>-1}),c,!0),h=[function(e,t,i){var a=!s&&(i||t!=n)||((r=t).nodeType?d(e,t,i):f(e,t,i));return r=null,a}];u<o;u++)if(i=t.relative[e[u].type])h=[fe(he(h),i)];else{if((i=t.filter[e[u].type].apply(null,e[u].matches))[v]){for(a=++u;a<o&&!t.relative[e[a].type];a++);return me(u>1&&he(h),u>1&&de(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(D,"$1"),i,u<a&&ge(e.slice(u,a)),a<o&&ge(e=e.slice(a)),a<o&&de(e))}h.push(i)}return he(h)}function ve(e,r){var i,a=[],o=[],s=E[e+" "];if(!s){for(r||(r=le(e)),i=r.length;i--;)(s=ge(r[i]))[v]?a.push(s):o.push(s);s=E(e,function(e,r){var i=r.length>0,a=e.length>0,o=function(o,s,u,l,f){var h,p,g,v=0,b="0",_=o&&[],w=[],E=n,S=o||a&&t.find.TAG("*",f),C=y+=null==E?1:Math.random()||.1,T=S.length;for(f&&(n=s==c||s||f);b!==T&&null!=(h=S[b]);b++){if(a&&h){for(p=0,s||h.ownerDocument==c||(ce(h),u=!d);g=e[p++];)if(g(h,s||c,u)){m.call(l,h);break}f&&(y=C)}i&&((h=!g&&h)&&v--,o&&_.push(h))}if(v+=b,i&&b!==v){for(p=0;g=r[p++];)g(_,w,s,u);if(o){if(v>0)for(;b--;)_[b]||w[b]||(w[b]=I.call(l));w=pe(w)}m.apply(l,w),f&&!o&&w.length>0&&v+r.length>1&&x.uniqueSort(l)}return f&&(y=C,n=E),_};return i?te(o):o}(o,a)),s.selector=e}return s}function ye(e,n,r,i){var a,o,s,c,u,l="function"===typeof e&&e,f=!i&&le(e=l.selector||e);if(r=r||[],1===f.length){if((o=f[0]=f[0].slice(0)).length>2&&"ID"===(s=o[0]).type&&9===n.nodeType&&d&&t.relative[o[1].type]){if(!(n=(t.find.ID(s.matches[0].replace(X,Q),n)||[])[0]))return r;l&&(n=n.parentNode),e=e.slice(o.shift().value.length)}for(a=G.needsContext.test(e)?0:o.length;a--&&(s=o[a],!t.relative[c=s.type]);)if((u=t.find[c])&&(i=u(s.matches[0].replace(X,Q),K.test(o[0].type)&&se(n.parentNode)||n))){if(o.splice(a,1),!(e=i.length&&de(o)))return m.apply(r,i),r;break}}return(l||ve(e,f))(i,n,!d,r,!n||K.test(e)&&se(n.parentNode)||n),r}ue.prototype=t.filters=t.pseudos,t.setFilters=new ue,g.sortStable=v.split("").sort(C).join("")===v,ce(),g.sortDetached=ne((function(e){return 1&e.compareDocumentPosition(c.createElement("fieldset"))})),x.find=$,x.expr[":"]=x.expr.pseudos,x.unique=x.uniqueSort,$.compile=ve,$.select=ye,$.setDocument=ce,$.tokenize=le,$.escape=x.escapeSelector,$.getText=x.text,$.isXML=x.isXMLDoc,$.selectors=x.expr,$.support=x.support,$.uniqueSort=x.uniqueSort}();var j=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&x(e).is(n))break;r.push(e)}return r},F=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},U=x.expr.match.needsContext,B=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function V(e,t,n){return v(t)?x.grep(e,(function(e,r){return!!t.call(e,r,e)!==n})):t.nodeType?x.grep(e,(function(e){return e===t!==n})):"string"!==typeof t?x.grep(e,(function(e){return l.call(t,e)>-1!==n})):x.filter(t,e,n)}x.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?x.find.matchesSelector(r,e)?[r]:[]:x.find.matches(e,x.grep(t,(function(e){return 1===e.nodeType})))},x.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!==typeof e)return this.pushStack(x(e).filter((function(){for(t=0;t<r;t++)if(x.contains(i[t],this))return!0})));for(n=this.pushStack([]),t=0;t<r;t++)x.find(e,i[t],n);return r>1?x.uniqueSort(n):n},filter:function(e){return this.pushStack(V(this,e||[],!1))},not:function(e){return this.pushStack(V(this,e||[],!0))},is:function(e){return!!V(this,"string"===typeof e&&U.test(e)?x(e):e||[],!1).length}});var z,W=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(x.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||z,"string"===typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:W.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof x?t[0]:t,x.merge(this,x.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:b,!0)),B.test(r[1])&&x.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=b.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(x):x.makeArray(e,this)}).prototype=x.fn,z=x(b);var G=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function Y(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}x.fn.extend({has:function(e){var t=x(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(x.contains(this,t[e]))return!0}))},closest:function(e,t){var n,r=0,i=this.length,a=[],o="string"!==typeof e&&x(e);if(!U.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&x.find.matchesSelector(n,e))){a.push(n);break}return this.pushStack(a.length>1?x.uniqueSort(a):a)},index:function(e){return e?"string"===typeof e?l.call(x(e),this[0]):l.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(x.uniqueSort(x.merge(this.get(),x(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),x.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return j(e,"parentNode")},parentsUntil:function(e,t,n){return j(e,"parentNode",n)},next:function(e){return Y(e,"nextSibling")},prev:function(e){return Y(e,"previousSibling")},nextAll:function(e){return j(e,"nextSibling")},prevAll:function(e){return j(e,"previousSibling")},nextUntil:function(e,t,n){return j(e,"nextSibling",n)},prevUntil:function(e,t,n){return j(e,"previousSibling",n)},siblings:function(e){return F((e.parentNode||{}).firstChild,e)},children:function(e){return F(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(R(e,"template")&&(e=e.content||e),x.merge([],e.childNodes))}},(function(e,t){x.fn[e]=function(n,r){var i=x.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"===typeof r&&(i=x.filter(r,i)),this.length>1&&(H[e]||x.uniqueSort(i),G.test(e)&&i.reverse()),this.pushStack(i)}}));var q=/[^\x20\t\r\n\f]+/g;function K(e){return e}function X(e){throw e}function Q(e,t,n,r){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(n):e&&v(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}x.Callbacks=function(e){e="string"===typeof e?function(e){var t={};return x.each(e.match(q)||[],(function(e,n){t[n]=!0})),t}(e):x.extend({},e);var t,n,r,i,a=[],o=[],s=-1,c=function(){for(i=i||e.once,r=t=!0;o.length;s=-1)for(n=o.shift();++s<a.length;)!1===a[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=a.length,n=!1);e.memory||(n=!1),t=!1,i&&(a=n?[]:"")},u={add:function(){return a&&(n&&!t&&(s=a.length-1,o.push(n)),function t(n){x.each(n,(function(n,r){v(r)?e.unique&&u.has(r)||a.push(r):r&&r.length&&"string"!==E(r)&&t(r)}))}(arguments),n&&!t&&c()),this},remove:function(){return x.each(arguments,(function(e,t){for(var n;(n=x.inArray(t,a,n))>-1;)a.splice(n,1),n<=s&&s--})),this},has:function(e){return e?x.inArray(e,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return i=o=[],a=n="",this},disabled:function(){return!a},lock:function(){return i=o=[],n||t||(a=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],o.push(n),t||c()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},x.extend({Deferred:function(e){var t=[["notify","progress",x.Callbacks("memory"),x.Callbacks("memory"),2],["resolve","done",x.Callbacks("once memory"),x.Callbacks("once memory"),0,"resolved"],["reject","fail",x.Callbacks("once memory"),x.Callbacks("once memory"),1,"rejected"]],n="pending",i={state:function(){return n},always:function(){return a.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return x.Deferred((function(n){x.each(t,(function(t,r){var i=v(e[r[4]])&&e[r[4]];a[r[1]]((function(){var e=i&&i.apply(this,arguments);e&&v(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[r[0]+"With"](this,i?[e]:arguments)}))})),e=null})).promise()},then:function(e,n,i){var a=0;function o(e,t,n,i){return function(){var s=this,c=arguments,u=function(){var r,u;if(!(e<a)){if((r=n.apply(s,c))===t.promise())throw new TypeError("Thenable self-resolution");u=r&&("object"===typeof r||"function"===typeof r)&&r.then,v(u)?i?u.call(r,o(a,t,K,i),o(a,t,X,i)):(a++,u.call(r,o(a,t,K,i),o(a,t,X,i),o(a,t,K,t.notifyWith))):(n!==K&&(s=void 0,c=[r]),(i||t.resolveWith)(s,c))}},l=i?u:function(){try{u()}catch(r){x.Deferred.exceptionHook&&x.Deferred.exceptionHook(r,l.error),e+1>=a&&(n!==X&&(s=void 0,c=[r]),t.rejectWith(s,c))}};e?l():(x.Deferred.getErrorHook?l.error=x.Deferred.getErrorHook():x.Deferred.getStackHook&&(l.error=x.Deferred.getStackHook()),r.setTimeout(l))}}return x.Deferred((function(r){t[0][3].add(o(0,r,v(i)?i:K,r.notifyWith)),t[1][3].add(o(0,r,v(e)?e:K)),t[2][3].add(o(0,r,v(n)?n:X))})).promise()},promise:function(e){return null!=e?x.extend(e,i):i}},a={};return x.each(t,(function(e,r){var o=r[2],s=r[5];i[r[1]]=o.add,s&&o.add((function(){n=s}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),o.add(r[3].fire),a[r[0]]=function(){return a[r[0]+"With"](this===a?void 0:this,arguments),this},a[r[0]+"With"]=o.fireWith})),i.promise(a),e&&e.call(a,a),a},when:function(e){var t=arguments.length,n=t,r=Array(n),i=s.call(arguments),a=x.Deferred(),o=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?s.call(arguments):n,--t||a.resolveWith(r,i)}};if(t<=1&&(Q(e,a.done(o(n)).resolve,a.reject,!t),"pending"===a.state()||v(i[n]&&i[n].then)))return a.then();for(;n--;)Q(i[n],o(n),a.reject);return a.promise()}});var J=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;x.Deferred.exceptionHook=function(e,t){r.console&&r.console.warn&&e&&J.test(e.name)&&r.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},x.readyException=function(e){r.setTimeout((function(){throw e}))};var Z=x.Deferred();function $(){b.removeEventListener("DOMContentLoaded",$),r.removeEventListener("load",$),x.ready()}x.fn.ready=function(e){return Z.then(e).catch((function(e){x.readyException(e)})),this},x.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--x.readyWait:x.isReady)||(x.isReady=!0,!0!==e&&--x.readyWait>0||Z.resolveWith(b,[x]))}}),x.ready.then=Z.then,"complete"===b.readyState||"loading"!==b.readyState&&!b.documentElement.doScroll?r.setTimeout(x.ready):(b.addEventListener("DOMContentLoaded",$),r.addEventListener("load",$));var ee=function(e,t,n,r,i,a,o){var s=0,c=e.length,u=null==n;if("object"===E(n))for(s in i=!0,n)ee(e,t,s,n[s],!0,a,o);else if(void 0!==r&&(i=!0,v(r)||(o=!0),u&&(o?(t.call(e,r),t=null):(u=t,t=function(e,t,n){return u.call(x(e),n)})),t))for(;s<c;s++)t(e[s],n,o?r:r.call(e[s],s,t(e[s],n)));return i?e:u?t.call(e):c?t(e[0],n):a},te=/^-ms-/,ne=/-([a-z])/g;function re(e,t){return t.toUpperCase()}function ie(e){return e.replace(te,"ms-").replace(ne,re)}var ae=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function oe(){this.expando=x.expando+oe.uid++}oe.uid=1,oe.prototype={cache:function(e){var t=e[this.expando];return t||(t={},ae(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"===typeof t)i[ie(t)]=n;else for(r in t)i[ie(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][ie(t)]},access:function(e,t,n){return void 0===t||t&&"string"===typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(ie):(t=ie(t))in r?[t]:t.match(q)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||x.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!x.isEmptyObject(t)}};var se=new oe,ce=new oe,ue=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,le=/[A-Z]/g;function de(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(le,"-$&").toLowerCase(),"string"===typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:ue.test(e)?JSON.parse(e):e)}(n)}catch(i){}ce.set(e,t,n)}else n=void 0;return n}x.extend({hasData:function(e){return ce.hasData(e)||se.hasData(e)},data:function(e,t,n){return ce.access(e,t,n)},removeData:function(e,t){ce.remove(e,t)},_data:function(e,t,n){return se.access(e,t,n)},_removeData:function(e,t){se.remove(e,t)}}),x.fn.extend({data:function(e,t){var n,r,i,a=this[0],o=a&&a.attributes;if(void 0===e){if(this.length&&(i=ce.get(a),1===a.nodeType&&!se.get(a,"hasDataAttrs"))){for(n=o.length;n--;)o[n]&&0===(r=o[n].name).indexOf("data-")&&(r=ie(r.slice(5)),de(a,r,i[r]));se.set(a,"hasDataAttrs",!0)}return i}return"object"===typeof e?this.each((function(){ce.set(this,e)})):ee(this,(function(t){var n;if(a&&void 0===t)return void 0!==(n=ce.get(a,e))||void 0!==(n=de(a,e))?n:void 0;this.each((function(){ce.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){ce.remove(this,e)}))}}),x.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=se.get(e,t),n&&(!r||Array.isArray(n)?r=se.access(e,t,x.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=x.queue(e,t),r=n.length,i=n.shift(),a=x._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete a.stop,i.call(e,(function(){x.dequeue(e,t)}),a)),!r&&a&&a.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return se.get(e,n)||se.access(e,n,{empty:x.Callbacks("once memory").add((function(){se.remove(e,[t+"queue",n])}))})}}),x.fn.extend({queue:function(e,t){var n=2;return"string"!==typeof e&&(t=e,e="fx",n--),arguments.length<n?x.queue(this[0],e):void 0===t?this:this.each((function(){var n=x.queue(this,e,t);x._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&x.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){x.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=x.Deferred(),a=this,o=this.length,s=function(){--r||i.resolveWith(a,[a])};for("string"!==typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(n=se.get(a[o],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var fe=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,he=new RegExp("^(?:([+-])=|)("+fe+")([a-z%]*)$","i"),pe=["Top","Right","Bottom","Left"],me=b.documentElement,ge=function(e){return x.contains(e.ownerDocument,e)},ve={composed:!0};me.getRootNode&&(ge=function(e){return x.contains(e.ownerDocument,e)||e.getRootNode(ve)===e.ownerDocument});var ye=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ge(e)&&"none"===x.css(e,"display")};function be(e,t,n,r){var i,a,o=20,s=r?function(){return r.cur()}:function(){return x.css(e,t,"")},c=s(),u=n&&n[3]||(x.cssNumber[t]?"":"px"),l=e.nodeType&&(x.cssNumber[t]||"px"!==u&&+c)&&he.exec(x.css(e,t));if(l&&l[3]!==u){for(c/=2,u=u||l[3],l=+c||1;o--;)x.style(e,t,l+u),(1-a)*(1-(a=s()/c||.5))<=0&&(o=0),l/=a;l*=2,x.style(e,t,l+u),n=n||[]}return n&&(l=+l||+c||0,i=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=u,r.start=l,r.end=i)),i}var _e={};function we(e){var t,n=e.ownerDocument,r=e.nodeName,i=_e[r];return i||(t=n.body.appendChild(n.createElement(r)),i=x.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),_e[r]=i,i)}function Ee(e,t){for(var n,r,i=[],a=0,o=e.length;a<o;a++)(r=e[a]).style&&(n=r.style.display,t?("none"===n&&(i[a]=se.get(r,"display")||null,i[a]||(r.style.display="")),""===r.style.display&&ye(r)&&(i[a]=we(r))):"none"!==n&&(i[a]="none",se.set(r,"display",n)));for(a=0;a<o;a++)null!=i[a]&&(e[a].style.display=i[a]);return e}x.fn.extend({show:function(){return Ee(this,!0)},hide:function(){return Ee(this)},toggle:function(e){return"boolean"===typeof e?e?this.show():this.hide():this.each((function(){ye(this)?x(this).show():x(this).hide()}))}});var Se=/^(?:checkbox|radio)$/i,Ce=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,xe=/^$|^module$|\/(?:java|ecma)script/i;!function(){var e=b.createDocumentFragment().appendChild(b.createElement("div")),t=b.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),g.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",g.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue,e.innerHTML="<option></option>",g.option=!!e.lastChild}();var Te={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Re(e,t){var n;return n="undefined"!==typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!==typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&R(e,t)?x.merge([e],n):n}function Ie(e,t){for(var n=0,r=e.length;n<r;n++)se.set(e[n],"globalEval",!t||se.get(t[n],"globalEval"))}Te.tbody=Te.tfoot=Te.colgroup=Te.caption=Te.thead,Te.th=Te.td,g.option||(Te.optgroup=Te.option=[1,"<select multiple='multiple'>","</select>"]);var Ne=/<|&#?\w+;/;function Ae(e,t,n,r,i){for(var a,o,s,c,u,l,d=t.createDocumentFragment(),f=[],h=0,p=e.length;h<p;h++)if((a=e[h])||0===a)if("object"===E(a))x.merge(f,a.nodeType?[a]:a);else if(Ne.test(a)){for(o=o||d.appendChild(t.createElement("div")),s=(Ce.exec(a)||["",""])[1].toLowerCase(),c=Te[s]||Te._default,o.innerHTML=c[1]+x.htmlPrefilter(a)+c[2],l=c[0];l--;)o=o.lastChild;x.merge(f,o.childNodes),(o=d.firstChild).textContent=""}else f.push(t.createTextNode(a));for(d.textContent="",h=0;a=f[h++];)if(r&&x.inArray(a,r)>-1)i&&i.push(a);else if(u=ge(a),o=Re(d.appendChild(a),"script"),u&&Ie(o),n)for(l=0;a=o[l++];)xe.test(a.type||"")&&n.push(a);return d}var ke=/^([^.]*)(?:\.(.+)|)/;function De(){return!0}function Me(){return!1}function Le(e,t,n,r,i,a){var o,s;if("object"===typeof t){for(s in"string"!==typeof n&&(r=r||n,n=void 0),t)Le(e,s,n,r,t[s],a);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"===typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Me;else if(!i)return e;return 1===a&&(o=i,i=function(e){return x().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=x.guid++)),e.each((function(){x.event.add(this,t,i,r,n)}))}function Oe(e,t,n){n?(se.set(e,t,!1),x.event.add(e,t,{namespace:!1,handler:function(e){var n,r=se.get(this,t);if(1&e.isTrigger&&this[t]){if(r)(x.event.special[t]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),se.set(this,t,r),this[t](),n=se.get(this,t),se.set(this,t,!1),r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n}else r&&(se.set(this,t,x.event.trigger(r[0],r.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=De)}})):void 0===se.get(e,t)&&x.event.add(e,t,De)}x.event={global:{},add:function(e,t,n,r,i){var a,o,s,c,u,l,d,f,h,p,m,g=se.get(e);if(ae(e))for(n.handler&&(n=(a=n).handler,i=a.selector),i&&x.find.matchesSelector(me,i),n.guid||(n.guid=x.guid++),(c=g.events)||(c=g.events=Object.create(null)),(o=g.handle)||(o=g.handle=function(t){return"undefined"!==typeof x&&x.event.triggered!==t.type?x.event.dispatch.apply(e,arguments):void 0}),u=(t=(t||"").match(q)||[""]).length;u--;)h=m=(s=ke.exec(t[u])||[])[1],p=(s[2]||"").split(".").sort(),h&&(d=x.event.special[h]||{},h=(i?d.delegateType:d.bindType)||h,d=x.event.special[h]||{},l=x.extend({type:h,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&x.expr.match.needsContext.test(i),namespace:p.join(".")},a),(f=c[h])||((f=c[h]=[]).delegateCount=0,d.setup&&!1!==d.setup.call(e,r,p,o)||e.addEventListener&&e.addEventListener(h,o)),d.add&&(d.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?f.splice(f.delegateCount++,0,l):f.push(l),x.event.global[h]=!0)},remove:function(e,t,n,r,i){var a,o,s,c,u,l,d,f,h,p,m,g=se.hasData(e)&&se.get(e);if(g&&(c=g.events)){for(u=(t=(t||"").match(q)||[""]).length;u--;)if(h=m=(s=ke.exec(t[u])||[])[1],p=(s[2]||"").split(".").sort(),h){for(d=x.event.special[h]||{},f=c[h=(r?d.delegateType:d.bindType)||h]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=a=f.length;a--;)l=f[a],!i&&m!==l.origType||n&&n.guid!==l.guid||s&&!s.test(l.namespace)||r&&r!==l.selector&&("**"!==r||!l.selector)||(f.splice(a,1),l.selector&&f.delegateCount--,d.remove&&d.remove.call(e,l));o&&!f.length&&(d.teardown&&!1!==d.teardown.call(e,p,g.handle)||x.removeEvent(e,h,g.handle),delete c[h])}else for(h in c)x.event.remove(e,h+t[u],n,r,!0);x.isEmptyObject(c)&&se.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,a,o,s=new Array(arguments.length),c=x.event.fix(e),u=(se.get(this,"events")||Object.create(null))[c.type]||[],l=x.event.special[c.type]||{};for(s[0]=c,t=1;t<arguments.length;t++)s[t]=arguments[t];if(c.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,c)){for(o=x.event.handlers.call(this,c,u),t=0;(i=o[t++])&&!c.isPropagationStopped();)for(c.currentTarget=i.elem,n=0;(a=i.handlers[n++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==a.namespace&&!c.rnamespace.test(a.namespace)||(c.handleObj=a,c.data=a.data,void 0!==(r=((x.event.special[a.origType]||{}).handle||a.handler).apply(i.elem,s))&&!1===(c.result=r)&&(c.preventDefault(),c.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,c),c.result}},handlers:function(e,t){var n,r,i,a,o,s=[],c=t.delegateCount,u=e.target;if(c&&u.nodeType&&!("click"===e.type&&e.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==e.type||!0!==u.disabled)){for(a=[],o={},n=0;n<c;n++)void 0===o[i=(r=t[n]).selector+" "]&&(o[i]=r.needsContext?x(i,this).index(u)>-1:x.find(i,this,null,[u]).length),o[i]&&a.push(r);a.length&&s.push({elem:u,handlers:a})}return u=this,c<t.length&&s.push({elem:u,handlers:t.slice(c)}),s},addProp:function(e,t){Object.defineProperty(x.Event.prototype,e,{enumerable:!0,configurable:!0,get:v(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[x.expando]?e:new x.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return Se.test(t.type)&&t.click&&R(t,"input")&&Oe(t,"click",!0),!1},trigger:function(e){var t=this||e;return Se.test(t.type)&&t.click&&R(t,"input")&&Oe(t,"click"),!0},_default:function(e){var t=e.target;return Se.test(t.type)&&t.click&&R(t,"input")&&se.get(t,"click")||R(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},x.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},x.Event=function(e,t){if(!(this instanceof x.Event))return new x.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?De:Me,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&x.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[x.expando]=!0},x.Event.prototype={constructor:x.Event,isDefaultPrevented:Me,isPropagationStopped:Me,isImmediatePropagationStopped:Me,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=De,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=De,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=De,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},x.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},x.event.addProp),x.each({focus:"focusin",blur:"focusout"},(function(e,t){function n(e){if(b.documentMode){var n=se.get(this,"handle"),r=x.event.fix(e);r.type="focusin"===e.type?"focus":"blur",r.isSimulated=!0,n(e),r.target===r.currentTarget&&n(r)}else x.event.simulate(t,e.target,x.event.fix(e))}x.event.special[e]={setup:function(){var r;if(Oe(this,e,!0),!b.documentMode)return!1;(r=se.get(this,t))||this.addEventListener(t,n),se.set(this,t,(r||0)+1)},trigger:function(){return Oe(this,e),!0},teardown:function(){var e;if(!b.documentMode)return!1;(e=se.get(this,t)-1)?se.set(this,t,e):(this.removeEventListener(t,n),se.remove(this,t))},_default:function(t){return se.get(t.target,e)},delegateType:t},x.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,i=b.documentMode?this:r,a=se.get(i,t);a||(b.documentMode?this.addEventListener(t,n):r.addEventListener(e,n,!0)),se.set(i,t,(a||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,i=b.documentMode?this:r,a=se.get(i,t)-1;a?se.set(i,t,a):(b.documentMode?this.removeEventListener(t,n):r.removeEventListener(e,n,!0),se.remove(i,t))}}})),x.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){x.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,i=e.handleObj;return r&&(r===this||x.contains(this,r))||(e.type=i.origType,n=i.handler.apply(this,arguments),e.type=t),n}}})),x.fn.extend({on:function(e,t,n,r){return Le(this,e,t,n,r)},one:function(e,t,n,r){return Le(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,x(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"===typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!==typeof t||(n=t,t=void 0),!1===n&&(n=Me),this.each((function(){x.event.remove(this,e,n,t)}))}});var Pe=/<script|<style|<link/i,je=/checked\s*(?:[^=]|=\s*.checked.)/i,Fe=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Ue(e,t){return R(e,"table")&&R(11!==t.nodeType?t:t.firstChild,"tr")&&x(e).children("tbody")[0]||e}function Be(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Ve(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function ze(e,t){var n,r,i,a,o,s;if(1===t.nodeType){if(se.hasData(e)&&(s=se.get(e).events))for(i in se.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)x.event.add(t,i,s[i][n]);ce.hasData(e)&&(a=ce.access(e),o=x.extend({},a),ce.set(t,o))}}function We(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Se.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function Ge(e,t,n,r){t=c(t);var i,a,o,s,u,l,d=0,f=e.length,h=f-1,p=t[0],m=v(p);if(m||f>1&&"string"===typeof p&&!g.checkClone&&je.test(p))return e.each((function(i){var a=e.eq(i);m&&(t[0]=p.call(this,i,a.html())),Ge(a,t,n,r)}));if(f&&(a=(i=Ae(t,e[0].ownerDocument,!1,e,r)).firstChild,1===i.childNodes.length&&(i=a),a||r)){for(s=(o=x.map(Re(i,"script"),Be)).length;d<f;d++)u=i,d!==h&&(u=x.clone(u,!0,!0),s&&x.merge(o,Re(u,"script"))),n.call(e[d],u,d);if(s)for(l=o[o.length-1].ownerDocument,x.map(o,Ve),d=0;d<s;d++)u=o[d],xe.test(u.type||"")&&!se.access(u,"globalEval")&&x.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?x._evalUrl&&!u.noModule&&x._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):w(u.textContent.replace(Fe,""),u,l))}return e}function He(e,t,n){for(var r,i=t?x.filter(t,e):e,a=0;null!=(r=i[a]);a++)n||1!==r.nodeType||x.cleanData(Re(r)),r.parentNode&&(n&&ge(r)&&Ie(Re(r,"script")),r.parentNode.removeChild(r));return e}x.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,a,o,s=e.cloneNode(!0),c=ge(e);if(!g.noCloneChecked&&(1===e.nodeType||11===e.nodeType)&&!x.isXMLDoc(e))for(o=Re(s),r=0,i=(a=Re(e)).length;r<i;r++)We(a[r],o[r]);if(t)if(n)for(a=a||Re(e),o=o||Re(s),r=0,i=a.length;r<i;r++)ze(a[r],o[r]);else ze(e,s);return(o=Re(s,"script")).length>0&&Ie(o,!c&&Re(e,"script")),s},cleanData:function(e){for(var t,n,r,i=x.event.special,a=0;void 0!==(n=e[a]);a++)if(ae(n)){if(t=n[se.expando]){if(t.events)for(r in t.events)i[r]?x.event.remove(n,r):x.removeEvent(n,r,t.handle);n[se.expando]=void 0}n[ce.expando]&&(n[ce.expando]=void 0)}}}),x.fn.extend({detach:function(e){return He(this,e,!0)},remove:function(e){return He(this,e)},text:function(e){return ee(this,(function(e){return void 0===e?x.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return Ge(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ue(this,e).appendChild(e)}))},prepend:function(){return Ge(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ue(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return Ge(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return Ge(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(x.cleanData(Re(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return x.clone(this,e,t)}))},html:function(e){return ee(this,(function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"===typeof e&&!Pe.test(e)&&!Te[(Ce.exec(e)||["",""])[1].toLowerCase()]){e=x.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(x.cleanData(Re(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return Ge(this,arguments,(function(t){var n=this.parentNode;x.inArray(this,e)<0&&(x.cleanData(Re(this)),n&&n.replaceChild(t,this))}),e)}}),x.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){x.fn[e]=function(e){for(var n,r=[],i=x(e),a=i.length-1,o=0;o<=a;o++)n=o===a?this:this.clone(!0),x(i[o])[t](n),u.apply(r,n.get());return this.pushStack(r)}}));var Ye=new RegExp("^("+fe+")(?!px)[a-z%]+$","i"),qe=/^--/,Ke=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=r),t.getComputedStyle(e)},Xe=function(e,t,n){var r,i,a={};for(i in t)a[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=a[i];return r},Qe=new RegExp(pe.join("|"),"i");function Je(e,t,n){var r,i,a,o,s=qe.test(t),c=e.style;return(n=n||Ke(e))&&(o=n.getPropertyValue(t)||n[t],s&&o&&(o=o.replace(D,"$1")||void 0),""!==o||ge(e)||(o=x.style(e,t)),!g.pixelBoxStyles()&&Ye.test(o)&&Qe.test(t)&&(r=c.width,i=c.minWidth,a=c.maxWidth,c.minWidth=c.maxWidth=c.width=o,o=n.width,c.width=r,c.minWidth=i,c.maxWidth=a)),void 0!==o?o+"":o}function Ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",me.appendChild(u).appendChild(l);var e=r.getComputedStyle(l);n="1%"!==e.top,c=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),i=36===t(e.width),l.style.position="absolute",a=12===t(l.offsetWidth/3),me.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,i,a,o,s,c,u=b.createElement("div"),l=b.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",g.clearCloneStyle="content-box"===l.style.backgroundClip,x.extend(g,{boxSizingReliable:function(){return e(),i},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),c},scrollboxSize:function(){return e(),a},reliableTrDimensions:function(){var e,t,n,i;return null==s&&(e=b.createElement("table"),t=b.createElement("tr"),n=b.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="box-sizing:content-box;border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",me.appendChild(e).appendChild(t).appendChild(n),i=r.getComputedStyle(t),s=parseInt(i.height,10)+parseInt(i.borderTopWidth,10)+parseInt(i.borderBottomWidth,10)===t.offsetHeight,me.removeChild(e)),s}}))}();var $e=["Webkit","Moz","ms"],et=b.createElement("div").style,tt={};function nt(e){var t=x.cssProps[e]||tt[e];return t||(e in et?e:tt[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=$e.length;n--;)if((e=$e[n]+t)in et)return e}(e)||e)}var rt=/^(none|table(?!-c[ea]).+)/,it={position:"absolute",visibility:"hidden",display:"block"},at={letterSpacing:"0",fontWeight:"400"};function ot(e,t,n){var r=he.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function st(e,t,n,r,i,a){var o="width"===t?1:0,s=0,c=0,u=0;if(n===(r?"border":"content"))return 0;for(;o<4;o+=2)"margin"===n&&(u+=x.css(e,n+pe[o],!0,i)),r?("content"===n&&(c-=x.css(e,"padding"+pe[o],!0,i)),"margin"!==n&&(c-=x.css(e,"border"+pe[o]+"Width",!0,i))):(c+=x.css(e,"padding"+pe[o],!0,i),"padding"!==n?c+=x.css(e,"border"+pe[o]+"Width",!0,i):s+=x.css(e,"border"+pe[o]+"Width",!0,i));return!r&&a>=0&&(c+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-a-c-s-.5))||0),c+u}function ct(e,t,n){var r=Ke(e),i=(!g.boxSizingReliable()||n)&&"border-box"===x.css(e,"boxSizing",!1,r),a=i,o=Je(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Ye.test(o)){if(!n)return o;o="auto"}return(!g.boxSizingReliable()&&i||!g.reliableTrDimensions()&&R(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===x.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===x.css(e,"boxSizing",!1,r),(a=s in e)&&(o=e[s])),(o=parseFloat(o)||0)+st(e,t,n||(i?"border":"content"),a,r,o)+"px"}function ut(e,t,n,r,i){return new ut.prototype.init(e,t,n,r,i)}x.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Je(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,a,o,s=ie(t),c=qe.test(t),u=e.style;if(c||(t=nt(s)),o=x.cssHooks[t]||x.cssHooks[s],void 0===n)return o&&"get"in o&&void 0!==(i=o.get(e,!1,r))?i:u[t];"string"===(a=typeof n)&&(i=he.exec(n))&&i[1]&&(n=be(e,t,i),a="number"),null!=n&&n===n&&("number"!==a||c||(n+=i&&i[3]||(x.cssNumber[s]?"":"px")),g.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),o&&"set"in o&&void 0===(n=o.set(e,n,r))||(c?u.setProperty(t,n):u[t]=n))}},css:function(e,t,n,r){var i,a,o,s=ie(t);return qe.test(t)||(t=nt(s)),(o=x.cssHooks[t]||x.cssHooks[s])&&"get"in o&&(i=o.get(e,!0,n)),void 0===i&&(i=Je(e,t,r)),"normal"===i&&t in at&&(i=at[t]),""===n||n?(a=parseFloat(i),!0===n||isFinite(a)?a||0:i):i}}),x.each(["height","width"],(function(e,t){x.cssHooks[t]={get:function(e,n,r){if(n)return!rt.test(x.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ct(e,t,r):Xe(e,it,(function(){return ct(e,t,r)}))},set:function(e,n,r){var i,a=Ke(e),o=!g.scrollboxSize()&&"absolute"===a.position,s=(o||r)&&"border-box"===x.css(e,"boxSizing",!1,a),c=r?st(e,t,r,s,a):0;return s&&o&&(c-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(a[t])-st(e,t,"border",!1,a)-.5)),c&&(i=he.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=x.css(e,t)),ot(0,n,c)}}})),x.cssHooks.marginLeft=Ze(g.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Je(e,"marginLeft"))||e.getBoundingClientRect().left-Xe(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),x.each({margin:"",padding:"",border:"Width"},(function(e,t){x.cssHooks[e+t]={expand:function(n){for(var r=0,i={},a="string"===typeof n?n.split(" "):[n];r<4;r++)i[e+pe[r]+t]=a[r]||a[r-2]||a[0];return i}},"margin"!==e&&(x.cssHooks[e+t].set=ot)})),x.fn.extend({css:function(e,t){return ee(this,(function(e,t,n){var r,i,a={},o=0;if(Array.isArray(t)){for(r=Ke(e),i=t.length;o<i;o++)a[t[o]]=x.css(e,t[o],!1,r);return a}return void 0!==n?x.style(e,t,n):x.css(e,t)}),e,t,arguments.length>1)}}),x.Tween=ut,ut.prototype={constructor:ut,init:function(e,t,n,r,i,a){this.elem=e,this.prop=n,this.easing=i||x.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=a||(x.cssNumber[n]?"":"px")},cur:function(){var e=ut.propHooks[this.prop];return e&&e.get?e.get(this):ut.propHooks._default.get(this)},run:function(e){var t,n=ut.propHooks[this.prop];return this.options.duration?this.pos=t=x.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):ut.propHooks._default.set(this),this}},ut.prototype.init.prototype=ut.prototype,ut.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=x.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){x.fx.step[e.prop]?x.fx.step[e.prop](e):1!==e.elem.nodeType||!x.cssHooks[e.prop]&&null==e.elem.style[nt(e.prop)]?e.elem[e.prop]=e.now:x.style(e.elem,e.prop,e.now+e.unit)}}},ut.propHooks.scrollTop=ut.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},x.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},x.fx=ut.prototype.init,x.fx.step={};var lt,dt,ft=/^(?:toggle|show|hide)$/,ht=/queueHooks$/;function pt(){dt&&(!1===b.hidden&&r.requestAnimationFrame?r.requestAnimationFrame(pt):r.setTimeout(pt,x.fx.interval),x.fx.tick())}function mt(){return r.setTimeout((function(){lt=void 0})),lt=Date.now()}function gt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=pe[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function vt(e,t,n){for(var r,i=(yt.tweeners[t]||[]).concat(yt.tweeners["*"]),a=0,o=i.length;a<o;a++)if(r=i[a].call(n,t,e))return r}function yt(e,t,n){var r,i,a=0,o=yt.prefilters.length,s=x.Deferred().always((function(){delete c.elem})),c=function(){if(i)return!1;for(var t=lt||mt(),n=Math.max(0,u.startTime+u.duration-t),r=1-(n/u.duration||0),a=0,o=u.tweens.length;a<o;a++)u.tweens[a].run(r);return s.notifyWith(e,[u,r,n]),r<1&&o?n:(o||s.notifyWith(e,[u,1,0]),s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:x.extend({},t),opts:x.extend(!0,{specialEasing:{},easing:x.easing._default},n),originalProperties:t,originalOptions:n,startTime:lt||mt(),duration:n.duration,tweens:[],createTween:function(t,n){var r=x.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)u.tweens[n].run(1);return t?(s.notifyWith(e,[u,1,0]),s.resolveWith(e,[u,t])):s.rejectWith(e,[u,t]),this}}),l=u.props;for(!function(e,t){var n,r,i,a,o;for(n in e)if(i=t[r=ie(n)],a=e[n],Array.isArray(a)&&(i=a[1],a=e[n]=a[0]),n!==r&&(e[r]=a,delete e[n]),(o=x.cssHooks[r])&&"expand"in o)for(n in a=o.expand(a),delete e[r],a)n in e||(e[n]=a[n],t[n]=i);else t[r]=i}(l,u.opts.specialEasing);a<o;a++)if(r=yt.prefilters[a].call(u,e,l,u.opts))return v(r.stop)&&(x._queueHooks(u.elem,u.opts.queue).stop=r.stop.bind(r)),r;return x.map(l,vt,u),v(u.opts.start)&&u.opts.start.call(e,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),x.fx.timer(x.extend(c,{elem:e,anim:u,queue:u.opts.queue})),u}x.Animation=x.extend(yt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return be(n.elem,e,he.exec(t),n),n}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(q);for(var n,r=0,i=e.length;r<i;r++)n=e[r],yt.tweeners[n]=yt.tweeners[n]||[],yt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,a,o,s,c,u,l,d="width"in t||"height"in t,f=this,h={},p=e.style,m=e.nodeType&&ye(e),g=se.get(e,"fxshow");for(r in n.queue||(null==(o=x._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,s=o.empty.fire,o.empty.fire=function(){o.unqueued||s()}),o.unqueued++,f.always((function(){f.always((function(){o.unqueued--,x.queue(e,"fx").length||o.empty.fire()}))}))),t)if(i=t[r],ft.test(i)){if(delete t[r],a=a||"toggle"===i,i===(m?"hide":"show")){if("show"!==i||!g||void 0===g[r])continue;m=!0}h[r]=g&&g[r]||x.style(e,r)}if((c=!x.isEmptyObject(t))||!x.isEmptyObject(h))for(r in d&&1===e.nodeType&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],null==(u=g&&g.display)&&(u=se.get(e,"display")),"none"===(l=x.css(e,"display"))&&(u?l=u:(Ee([e],!0),u=e.style.display||u,l=x.css(e,"display"),Ee([e]))),("inline"===l||"inline-block"===l&&null!=u)&&"none"===x.css(e,"float")&&(c||(f.done((function(){p.display=u})),null==u&&(l=p.display,u="none"===l?"":l)),p.display="inline-block")),n.overflow&&(p.overflow="hidden",f.always((function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}))),c=!1,h)c||(g?"hidden"in g&&(m=g.hidden):g=se.access(e,"fxshow",{display:u}),a&&(g.hidden=!m),m&&Ee([e],!0),f.done((function(){for(r in m||Ee([e]),se.remove(e,"fxshow"),h)x.style(e,r,h[r])}))),c=vt(m?g[r]:0,r,f),r in g||(g[r]=c.start,m&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?yt.prefilters.unshift(e):yt.prefilters.push(e)}}),x.speed=function(e,t,n){var r=e&&"object"===typeof e?x.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return x.fx.off?r.duration=0:"number"!==typeof r.duration&&(r.duration in x.fx.speeds?r.duration=x.fx.speeds[r.duration]:r.duration=x.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){v(r.old)&&r.old.call(this),r.queue&&x.dequeue(this,r.queue)},r},x.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ye).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=x.isEmptyObject(e),a=x.speed(t,n,r),o=function(){var t=yt(this,x.extend({},e),a);(i||se.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||!1===a.queue?this.each(o):this.queue(a.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!==typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,i=null!=e&&e+"queueHooks",a=x.timers,o=se.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&ht.test(i)&&r(o[i]);for(i=a.length;i--;)a[i].elem!==this||null!=e&&a[i].queue!==e||(a[i].anim.stop(n),t=!1,a.splice(i,1));!t&&n||x.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,n=se.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],a=x.timers,o=r?r.length:0;for(n.finish=!0,x.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=a.length;t--;)a[t].elem===this&&a[t].queue===e&&(a[t].anim.stop(!0),a.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish}))}}),x.each(["toggle","show","hide"],(function(e,t){var n=x.fn[t];x.fn[t]=function(e,r,i){return null==e||"boolean"===typeof e?n.apply(this,arguments):this.animate(gt(t,!0),e,r,i)}})),x.each({slideDown:gt("show"),slideUp:gt("hide"),slideToggle:gt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){x.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}})),x.timers=[],x.fx.tick=function(){var e,t=0,n=x.timers;for(lt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||x.fx.stop(),lt=void 0},x.fx.timer=function(e){x.timers.push(e),x.fx.start()},x.fx.interval=13,x.fx.start=function(){dt||(dt=!0,pt())},x.fx.stop=function(){dt=null},x.fx.speeds={slow:600,fast:200,_default:400},x.fn.delay=function(e,t){return e=x.fx&&x.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,n){var i=r.setTimeout(t,e);n.stop=function(){r.clearTimeout(i)}}))},function(){var e=b.createElement("input"),t=b.createElement("select").appendChild(b.createElement("option"));e.type="checkbox",g.checkOn=""!==e.value,g.optSelected=t.selected,(e=b.createElement("input")).value="t",e.type="radio",g.radioValue="t"===e.value}();var bt,_t=x.expr.attrHandle;x.fn.extend({attr:function(e,t){return ee(this,x.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){x.removeAttr(this,e)}))}}),x.extend({attr:function(e,t,n){var r,i,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return"undefined"===typeof e.getAttribute?x.prop(e,t,n):(1===a&&x.isXMLDoc(e)||(i=x.attrHooks[t.toLowerCase()]||(x.expr.match.bool.test(t)?bt:void 0)),void 0!==n?null===n?void x.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=x.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!g.radioValue&&"radio"===t&&R(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(q);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),bt={set:function(e,t,n){return!1===t?x.removeAttr(e,n):e.setAttribute(n,n),n}},x.each(x.expr.match.bool.source.match(/\w+/g),(function(e,t){var n=_t[t]||x.find.attr;_t[t]=function(e,t,r){var i,a,o=t.toLowerCase();return r||(a=_t[o],_t[o]=i,i=null!=n(e,t,r)?o:null,_t[o]=a),i}}));var wt=/^(?:input|select|textarea|button)$/i,Et=/^(?:a|area)$/i;function St(e){return(e.match(q)||[]).join(" ")}function Ct(e){return e.getAttribute&&e.getAttribute("class")||""}function xt(e){return Array.isArray(e)?e:"string"===typeof e&&e.match(q)||[]}x.fn.extend({prop:function(e,t){return ee(this,x.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[x.propFix[e]||e]}))}}),x.extend({prop:function(e,t,n){var r,i,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return 1===a&&x.isXMLDoc(e)||(t=x.propFix[t]||t,i=x.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=x.find.attr(e,"tabindex");return t?parseInt(t,10):wt.test(e.nodeName)||Et.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),g.optSelected||(x.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),x.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){x.propFix[this.toLowerCase()]=this})),x.fn.extend({addClass:function(e){var t,n,r,i,a,o;return v(e)?this.each((function(t){x(this).addClass(e.call(this,t,Ct(this)))})):(t=xt(e)).length?this.each((function(){if(r=Ct(this),n=1===this.nodeType&&" "+St(r)+" "){for(a=0;a<t.length;a++)i=t[a],n.indexOf(" "+i+" ")<0&&(n+=i+" ");o=St(n),r!==o&&this.setAttribute("class",o)}})):this},removeClass:function(e){var t,n,r,i,a,o;return v(e)?this.each((function(t){x(this).removeClass(e.call(this,t,Ct(this)))})):arguments.length?(t=xt(e)).length?this.each((function(){if(r=Ct(this),n=1===this.nodeType&&" "+St(r)+" "){for(a=0;a<t.length;a++)for(i=t[a];n.indexOf(" "+i+" ")>-1;)n=n.replace(" "+i+" "," ");o=St(n),r!==o&&this.setAttribute("class",o)}})):this:this.attr("class","")},toggleClass:function(e,t){var n,r,i,a,o=typeof e,s="string"===o||Array.isArray(e);return v(e)?this.each((function(n){x(this).toggleClass(e.call(this,n,Ct(this),t),t)})):"boolean"===typeof t&&s?t?this.addClass(e):this.removeClass(e):(n=xt(e),this.each((function(){if(s)for(a=x(this),i=0;i<n.length;i++)r=n[i],a.hasClass(r)?a.removeClass(r):a.addClass(r);else void 0!==e&&"boolean"!==o||((r=Ct(this))&&se.set(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===e?"":se.get(this,"__className__")||""))})))},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+St(Ct(n))+" ").indexOf(t)>-1)return!0;return!1}});var Tt=/\r/g;x.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=v(e),this.each((function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,x(this).val()):e)?i="":"number"===typeof i?i+="":Array.isArray(i)&&(i=x.map(i,(function(e){return null==e?"":e+""}))),(t=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))}))):i?(t=x.valHooks[i.type]||x.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"===typeof(n=i.value)?n.replace(Tt,""):null==n?"":n:void 0}}),x.extend({valHooks:{option:{get:function(e){var t=x.find.attr(e,"value");return null!=t?t:St(x.text(e))}},select:{get:function(e){var t,n,r,i=e.options,a=e.selectedIndex,o="select-one"===e.type,s=o?null:[],c=o?a+1:i.length;for(r=a<0?c:o?a:0;r<c;r++)if(((n=i[r]).selected||r===a)&&!n.disabled&&(!n.parentNode.disabled||!R(n.parentNode,"optgroup"))){if(t=x(n).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,a=x.makeArray(t),o=i.length;o--;)((r=i[o]).selected=x.inArray(x.valHooks.option.get(r),a)>-1)&&(n=!0);return n||(e.selectedIndex=-1),a}}}}),x.each(["radio","checkbox"],(function(){x.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=x.inArray(x(e).val(),t)>-1}},g.checkOn||(x.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}));var Rt=r.location,It={guid:Date.now()},Nt=/\?/;x.parseXML=function(e){var t,n;if(!e||"string"!==typeof e)return null;try{t=(new r.DOMParser).parseFromString(e,"text/xml")}catch(i){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||x.error("Invalid XML: "+(n?x.map(n.childNodes,(function(e){return e.textContent})).join("\n"):e)),t};var At=/^(?:focusinfocus|focusoutblur)$/,kt=function(e){e.stopPropagation()};x.extend(x.event,{trigger:function(e,t,n,i){var a,o,s,c,u,l,d,f,p=[n||b],m=h.call(e,"type")?e.type:e,g=h.call(e,"namespace")?e.namespace.split("."):[];if(o=f=s=n=n||b,3!==n.nodeType&&8!==n.nodeType&&!At.test(m+x.event.triggered)&&(m.indexOf(".")>-1&&(g=m.split("."),m=g.shift(),g.sort()),u=m.indexOf(":")<0&&"on"+m,(e=e[x.expando]?e:new x.Event(m,"object"===typeof e&&e)).isTrigger=i?2:3,e.namespace=g.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:x.makeArray(t,[e]),d=x.event.special[m]||{},i||!d.trigger||!1!==d.trigger.apply(n,t))){if(!i&&!d.noBubble&&!y(n)){for(c=d.delegateType||m,At.test(c+m)||(o=o.parentNode);o;o=o.parentNode)p.push(o),s=o;s===(n.ownerDocument||b)&&p.push(s.defaultView||s.parentWindow||r)}for(a=0;(o=p[a++])&&!e.isPropagationStopped();)f=o,e.type=a>1?c:d.bindType||m,(l=(se.get(o,"events")||Object.create(null))[e.type]&&se.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&ae(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=m,i||e.isDefaultPrevented()||d._default&&!1!==d._default.apply(p.pop(),t)||!ae(n)||u&&v(n[m])&&!y(n)&&((s=n[u])&&(n[u]=null),x.event.triggered=m,e.isPropagationStopped()&&f.addEventListener(m,kt),n[m](),e.isPropagationStopped()&&f.removeEventListener(m,kt),x.event.triggered=void 0,s&&(n[u]=s)),e.result}},simulate:function(e,t,n){var r=x.extend(new x.Event,n,{type:e,isSimulated:!0});x.event.trigger(r,null,t)}}),x.fn.extend({trigger:function(e,t){return this.each((function(){x.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return x.event.trigger(e,t,n,!0)}});var Dt=/\[\]$/,Mt=/\r?\n/g,Lt=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;function Pt(e,t,n,r){var i;if(Array.isArray(t))x.each(t,(function(t,i){n||Dt.test(e)?r(e,i):Pt(e+"["+("object"===typeof i&&null!=i?t:"")+"]",i,n,r)}));else if(n||"object"!==E(t))r(e,t);else for(i in t)Pt(e+"["+i+"]",t[i],n,r)}x.param=function(e,t){var n,r=[],i=function(e,t){var n=v(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!x.isPlainObject(e))x.each(e,(function(){i(this.name,this.value)}));else for(n in e)Pt(n,e[n],t,i);return r.join("&")},x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=x.prop(this,"elements");return e?x.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!x(this).is(":disabled")&&Ot.test(this.nodeName)&&!Lt.test(e)&&(this.checked||!Se.test(e))})).map((function(e,t){var n=x(this).val();return null==n?null:Array.isArray(n)?x.map(n,(function(e){return{name:t.name,value:e.replace(Mt,"\r\n")}})):{name:t.name,value:n.replace(Mt,"\r\n")}})).get()}});var jt=/%20/g,Ft=/#.*$/,Ut=/([?&])_=[^&]*/,Bt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Vt=/^(?:GET|HEAD)$/,zt=/^\/\//,Wt={},Gt={},Ht="*/".concat("*"),Yt=b.createElement("a");function qt(e){return function(t,n){"string"!==typeof t&&(n=t,t="*");var r,i=0,a=t.toLowerCase().match(q)||[];if(v(n))for(;r=a[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Kt(e,t,n,r){var i={},a=e===Gt;function o(s){var c;return i[s]=!0,x.each(e[s]||[],(function(e,s){var u=s(t,n,r);return"string"!==typeof u||a||i[u]?a?!(c=u):void 0:(t.dataTypes.unshift(u),o(u),!1)})),c}return o(t.dataTypes[0])||!i["*"]&&o("*")}function Xt(e,t){var n,r,i=x.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&x.extend(!0,e,r),e}Yt.href=Rt.href,x.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Rt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Rt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ht,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Xt(Xt(e,x.ajaxSettings),t):Xt(x.ajaxSettings,e)},ajaxPrefilter:qt(Wt),ajaxTransport:qt(Gt),ajax:function(e,t){"object"===typeof e&&(t=e,e=void 0),t=t||{};var n,i,a,o,s,c,u,l,d,f,h=x.ajaxSetup({},t),p=h.context||h,m=h.context&&(p.nodeType||p.jquery)?x(p):x.event,g=x.Deferred(),v=x.Callbacks("once memory"),y=h.statusCode||{},_={},w={},E="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(u){if(!o)for(o={};t=Bt.exec(a);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return u?a:null},setRequestHeader:function(e,t){return null==u&&(e=w[e.toLowerCase()]=w[e.toLowerCase()]||e,_[e]=t),this},overrideMimeType:function(e){return null==u&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(u)S.always(e[S.status]);else for(t in e)y[t]=[y[t],e[t]];return this},abort:function(e){var t=e||E;return n&&n.abort(t),C(0,t),this}};if(g.promise(S),h.url=((e||h.url||Rt.href)+"").replace(zt,Rt.protocol+"//"),h.type=t.method||t.type||h.method||h.type,h.dataTypes=(h.dataType||"*").toLowerCase().match(q)||[""],null==h.crossDomain){c=b.createElement("a");try{c.href=h.url,c.href=c.href,h.crossDomain=Yt.protocol+"//"+Yt.host!==c.protocol+"//"+c.host}catch(T){h.crossDomain=!0}}if(h.data&&h.processData&&"string"!==typeof h.data&&(h.data=x.param(h.data,h.traditional)),Kt(Wt,h,t,S),u)return S;for(d in(l=x.event&&h.global)&&0===x.active++&&x.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Vt.test(h.type),i=h.url.replace(Ft,""),h.hasContent?h.data&&h.processData&&0===(h.contentType||"").indexOf("application/x-www-form-urlencoded")&&(h.data=h.data.replace(jt,"+")):(f=h.url.slice(i.length),h.data&&(h.processData||"string"===typeof h.data)&&(i+=(Nt.test(i)?"&":"?")+h.data,delete h.data),!1===h.cache&&(i=i.replace(Ut,"$1"),f=(Nt.test(i)?"&":"?")+"_="+It.guid+++f),h.url=i+f),h.ifModified&&(x.lastModified[i]&&S.setRequestHeader("If-Modified-Since",x.lastModified[i]),x.etag[i]&&S.setRequestHeader("If-None-Match",x.etag[i])),(h.data&&h.hasContent&&!1!==h.contentType||t.contentType)&&S.setRequestHeader("Content-Type",h.contentType),S.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+Ht+"; q=0.01":""):h.accepts["*"]),h.headers)S.setRequestHeader(d,h.headers[d]);if(h.beforeSend&&(!1===h.beforeSend.call(p,S,h)||u))return S.abort();if(E="abort",v.add(h.complete),S.done(h.success),S.fail(h.error),n=Kt(Gt,h,t,S)){if(S.readyState=1,l&&m.trigger("ajaxSend",[S,h]),u)return S;h.async&&h.timeout>0&&(s=r.setTimeout((function(){S.abort("timeout")}),h.timeout));try{u=!1,n.send(_,C)}catch(T){if(u)throw T;C(-1,T)}}else C(-1,"No Transport");function C(e,t,o,c){var d,f,b,_,w,E=t;u||(u=!0,s&&r.clearTimeout(s),n=void 0,a=c||"",S.readyState=e>0?4:0,d=e>=200&&e<300||304===e,o&&(_=function(e,t,n){for(var r,i,a,o,s=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){c.unshift(i);break}if(c[0]in n)a=c[0];else{for(i in n){if(!c[0]||e.converters[i+" "+c[0]]){a=i;break}o||(o=i)}a=a||o}if(a)return a!==c[0]&&c.unshift(a),n[a]}(h,S,o)),!d&&x.inArray("script",h.dataTypes)>-1&&x.inArray("json",h.dataTypes)<0&&(h.converters["text script"]=function(){}),_=function(e,t,n,r){var i,a,o,s,c,u={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)u[o.toLowerCase()]=e.converters[o];for(a=l.shift();a;)if(e.responseFields[a]&&(n[e.responseFields[a]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=a,a=l.shift())if("*"===a)a=c;else if("*"!==c&&c!==a){if(!(o=u[c+" "+a]||u["* "+a]))for(i in u)if((s=i.split(" "))[1]===a&&(o=u[c+" "+s[0]]||u["* "+s[0]])){!0===o?o=u[i]:!0!==u[i]&&(a=s[0],l.unshift(s[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(T){return{state:"parsererror",error:o?T:"No conversion from "+c+" to "+a}}}return{state:"success",data:t}}(h,_,S,d),d?(h.ifModified&&((w=S.getResponseHeader("Last-Modified"))&&(x.lastModified[i]=w),(w=S.getResponseHeader("etag"))&&(x.etag[i]=w)),204===e||"HEAD"===h.type?E="nocontent":304===e?E="notmodified":(E=_.state,f=_.data,d=!(b=_.error))):(b=E,!e&&E||(E="error",e<0&&(e=0))),S.status=e,S.statusText=(t||E)+"",d?g.resolveWith(p,[f,E,S]):g.rejectWith(p,[S,E,b]),S.statusCode(y),y=void 0,l&&m.trigger(d?"ajaxSuccess":"ajaxError",[S,h,d?f:b]),v.fireWith(p,[S,E]),l&&(m.trigger("ajaxComplete",[S,h]),--x.active||x.event.trigger("ajaxStop")))}return S},getJSON:function(e,t,n){return x.get(e,t,n,"json")},getScript:function(e,t){return x.get(e,void 0,t,"script")}}),x.each(["get","post"],(function(e,t){x[t]=function(e,n,r,i){return v(n)&&(i=i||r,r=n,n=void 0),x.ajax(x.extend({url:e,type:t,dataType:i,data:n,success:r},x.isPlainObject(e)&&e))}})),x.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),x._evalUrl=function(e,t,n){return x.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){x.globalEval(e,t,n)}})},x.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=x(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return v(e)?this.each((function(t){x(this).wrapInner(e.call(this,t))})):this.each((function(){var t=x(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=v(e);return this.each((function(n){x(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){x(this).replaceWith(this.childNodes)})),this}}),x.expr.pseudos.hidden=function(e){return!x.expr.pseudos.visible(e)},x.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},x.ajaxSettings.xhr=function(){try{return new r.XMLHttpRequest}catch(e){}};var Qt={0:200,1223:204},Jt=x.ajaxSettings.xhr();g.cors=!!Jt&&"withCredentials"in Jt,g.ajax=Jt=!!Jt,x.ajaxTransport((function(e){var t,n;if(g.cors||Jt&&!e.crossDomain)return{send:function(i,a){var o,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)s[o]=e.xhrFields[o];for(o in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)s.setRequestHeader(o,i[o]);t=function(e){return function(){t&&(t=n=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!==typeof s.status?a(0,"error"):a(s.status,s.statusText):a(Qt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!==typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=t(),n=s.onerror=s.ontimeout=t("error"),void 0!==s.onabort?s.onabort=n:s.onreadystatechange=function(){4===s.readyState&&r.setTimeout((function(){t&&n()}))},t=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(c){if(t)throw c}},abort:function(){t&&t()}}})),x.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),x.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return x.globalEval(e),e}}}),x.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),x.ajaxTransport("script",(function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(r,i){t=x("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),b.head.appendChild(t[0])},abort:function(){n&&n()}}}));var Zt=[],$t=/(=)\?(?=&|$)|\?\?/;x.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Zt.pop()||x.expando+"_"+It.guid++;return this[e]=!0,e}}),x.ajaxPrefilter("json jsonp",(function(e,t,n){var i,a,o,s=!1!==e.jsonp&&($t.test(e.url)?"url":"string"===typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&$t.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return i=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace($t,"$1"+i):!1!==e.jsonp&&(e.url+=(Nt.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return o||x.error(i+" was not called"),o[0]},e.dataTypes[0]="json",a=r[i],r[i]=function(){o=arguments},n.always((function(){void 0===a?x(r).removeProp(i):r[i]=a,e[i]&&(e.jsonpCallback=t.jsonpCallback,Zt.push(i)),o&&v(a)&&a(o[0]),o=a=void 0})),"script"})),g.createHTMLDocument=function(){var e=b.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),x.parseHTML=function(e,t,n){return"string"!==typeof e?[]:("boolean"===typeof t&&(n=t,t=!1),t||(g.createHTMLDocument?((r=(t=b.implementation.createHTMLDocument("")).createElement("base")).href=b.location.href,t.head.appendChild(r)):t=b),a=!n&&[],(i=B.exec(e))?[t.createElement(i[1])]:(i=Ae([e],t,a),a&&a.length&&x(a).remove(),x.merge([],i.childNodes)));var r,i,a},x.fn.load=function(e,t,n){var r,i,a,o=this,s=e.indexOf(" ");return s>-1&&(r=St(e.slice(s)),e=e.slice(0,s)),v(t)?(n=t,t=void 0):t&&"object"===typeof t&&(i="POST"),o.length>0&&x.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done((function(e){a=arguments,o.html(r?x("<div>").append(x.parseHTML(e)).find(r):e)})).always(n&&function(e,t){o.each((function(){n.apply(this,a||[e.responseText,t,e])}))}),this},x.expr.pseudos.animated=function(e){return x.grep(x.timers,(function(t){return e===t.elem})).length},x.offset={setOffset:function(e,t,n){var r,i,a,o,s,c,u=x.css(e,"position"),l=x(e),d={};"static"===u&&(e.style.position="relative"),s=l.offset(),a=x.css(e,"top"),c=x.css(e,"left"),("absolute"===u||"fixed"===u)&&(a+c).indexOf("auto")>-1?(o=(r=l.position()).top,i=r.left):(o=parseFloat(a)||0,i=parseFloat(c)||0),v(t)&&(t=t.call(e,n,x.extend({},s))),null!=t.top&&(d.top=t.top-s.top+o),null!=t.left&&(d.left=t.left-s.left+i),"using"in t?t.using.call(e,d):l.css(d)}},x.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){x.offset.setOffset(this,e,t)}));var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===x.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===x.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=x(e).offset()).top+=x.css(e,"borderTopWidth",!0),i.left+=x.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-x.css(r,"marginTop",!0),left:t.left-i.left-x.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===x.css(e,"position");)e=e.offsetParent;return e||me}))}}),x.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var n="pageYOffset"===t;x.fn[e]=function(r){return ee(this,(function(e,r,i){var a;if(y(e)?a=e:9===e.nodeType&&(a=e.defaultView),void 0===i)return a?a[t]:e[r];a?a.scrollTo(n?a.pageXOffset:i,n?i:a.pageYOffset):e[r]=i}),e,r,arguments.length)}})),x.each(["top","left"],(function(e,t){x.cssHooks[t]=Ze(g.pixelPosition,(function(e,n){if(n)return n=Je(e,t),Ye.test(n)?x(e).position()[t]+"px":n}))})),x.each({Height:"height",Width:"width"},(function(e,t){x.each({padding:"inner"+e,content:t,"":"outer"+e},(function(n,r){x.fn[r]=function(i,a){var o=arguments.length&&(n||"boolean"!==typeof i),s=n||(!0===i||!0===a?"margin":"border");return ee(this,(function(t,n,i){var a;return y(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(a=t.documentElement,Math.max(t.body["scroll"+e],a["scroll"+e],t.body["offset"+e],a["offset"+e],a["client"+e])):void 0===i?x.css(t,n,s):x.style(t,n,i,s)}),t,o?i:void 0,o)}}))})),x.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){x.fn[t]=function(e){return this.on(t,e)}})),x.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.on("mouseenter",e).on("mouseleave",t||e)}}),x.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){x.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var en=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;x.proxy=function(e,t){var n,r,i;if("string"===typeof t&&(n=e[t],t=e,e=n),v(e))return r=s.call(arguments,2),i=function(){return e.apply(t||this,r.concat(s.call(arguments)))},i.guid=e.guid=e.guid||x.guid++,i},x.holdReady=function(e){e?x.readyWait++:x.ready(!0)},x.isArray=Array.isArray,x.parseJSON=JSON.parse,x.nodeName=R,x.isFunction=v,x.isWindow=y,x.camelCase=ie,x.type=E,x.now=Date.now,x.isNumeric=function(e){var t=x.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},x.trim=function(e){return null==e?"":(e+"").replace(en,"$1")},void 0===(n=function(){return x}.apply(t,[]))||(e.exports=n);var tn=r.jQuery,nn=r.$;return x.noConflict=function(e){return r.$===x&&(r.$=nn),e&&r.jQuery===x&&(r.jQuery=tn),x},"undefined"===typeof i&&(r.jQuery=r.$=x),x}))},8643:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e,t){(0,i.A)(2,arguments);var n=(0,r.default)(e),a=(0,r.default)(t);return n.getFullYear()===a.getFullYear()&&n.getMonth()===a.getMonth()}},8673:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n(6191),i=n(888),a=n(8224),o=n(8726);function s(e,t){(0,o.A)(2,arguments);var n=(0,i.default)(e),s=(0,r.A)(t)-(Math.floor(n.getMonth()/3)+1);return(0,a.default)(n,n.getMonth()+3*s)}},8726:(e,t,n)=>{"use strict";function r(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}n.d(t,{A:()=>r})},8821:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canUseDOM=t.SafeNodeList=t.SafeHTMLCollection=void 0;var r,i=n(7396);var a=((r=i)&&r.__esModule?r:{default:r}).default,o=a.canUseDOM?window.HTMLElement:{};t.SafeHTMLCollection=a.canUseDOM?window.HTMLCollection:{},t.SafeNodeList=a.canUseDOM?window.NodeList:{},t.canUseDOM=a.canUseDOM;t.default=o},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},8885:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(8926),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,r.A)(t);return(0,i.default)(e,-n)}},8926:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(2215),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,r.A)(t);return(0,i.default)(e,12*n)}},9333:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n(6191),i=n(2550),a=n(8726),o=6e4;function s(e,t){(0,a.A)(2,arguments);var n=(0,r.A)(t);return(0,i.A)(e,n*o)}},9352:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var r=n(8539),i=n(2312),a=n(8726),o=864e5;function s(e,t){(0,a.A)(2,arguments);var n=(0,i.default)(e),s=(0,i.default)(t),c=n.getTime()-(0,r.A)(n),u=s.getTime()-(0,r.A)(s);return Math.round((c-u)/o)}},9392:(e,t,n)=>{"use strict";var r=n(1218),i=n(6496);function a(e){var t=0,n=0,r=0,i=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=10*t,i=10*n,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||i)&&e.deltaMode&&(1==e.deltaMode?(r*=40,i*=40):(r*=800,i*=800)),r&&!t&&(t=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:i}}a.getEventType=function(){return r.firefox()?"DOMMouseScroll":i("wheel")?"wheel":"mousewheel"},e.exports=a},9436:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(6337),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,r.A)(t);return(0,i.default)(e,-n)}},9461:(e,t,n)=>{"use strict";e.exports=n(2330)},9563:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(2284),i=n(888),a=n(8726);function o(e){var t,n;if((0,a.A)(1,arguments),e&&"function"===typeof e.forEach)t=e;else{if("object"!==(0,r.A)(e)||null===e)return new Date(NaN);t=Array.prototype.slice.call(e)}return t.forEach((function(e){var t=(0,i.default)(e);(void 0===n||n>t||isNaN(t.getDate()))&&(n=t)})),n||new Date(NaN)}},9566:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){(0,i.A)(1,arguments);var t=(0,r.default)(e),n=t.getMonth(),a=n-n%3;return t.setMonth(a,1),t.setHours(0,0,0,0),t}},9713:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(2284),i=n(8726);function a(e){return(0,i.A)(1,arguments),e instanceof Date||"object"===(0,r.A)(e)&&"[object Date]"===Object.prototype.toString.call(e)}},9717:(e,t,n)=>{"use strict";var r=n(5043),i=n(9461);var a="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},o=i.useSyncExternalStore,s=r.useRef,c=r.useEffect,u=r.useMemo,l=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var d=s(null);if(null===d.current){var f={hasValue:!1,value:null};d.current=f}else f=d.current;d=u((function(){function e(e){if(!c){if(c=!0,o=e,e=r(e),void 0!==i&&f.hasValue){var t=f.value;if(i(t,e))return s=t}return s=e}if(t=s,a(o,e))return t;var n=r(e);return void 0!==i&&i(t,n)?(o=e,t):(o=e,s=n)}var o,s,c=!1,u=void 0===n?null:n;return[function(){return e(t())},null===u?void 0:function(){return e(u())}]}),[t,n,r,i]);var h=o(e,d[0],d[1]);return c((function(){f.hasValue=!0,f.value=h}),[h]),l(h),h}},9730:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(888),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,i.default)(e),o=(0,r.A)(t);return isNaN(n.getTime())?new Date(NaN):(n.setFullYear(o),n)}},9855:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e){return(0,i.A)(1,arguments),(0,r.default)(e).getDate()}},9952:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(6191),i=n(888),a=n(8726);function o(e,t){(0,a.A)(2,arguments);var n=(0,i.default)(e),o=(0,r.A)(t);return n.setMinutes(o),n}},9977:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(888),i=n(8726);function a(e,t){(0,i.A)(2,arguments);var n=(0,r.default)(e),a=(0,r.default)(t);return n.getTime()>a.getTime()}},9989:e=>{"use strict";var t=!("undefined"===typeof window||!window.document||!window.document.createElement),n={canUseDOM:t,canUseWorkers:"undefined"!==typeof Worker,canUseEventListeners:t&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:t&&!!window.screen,isInWorker:!t};e.exports=n}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>o[e]=()=>r[e]));return o.default=()=>r,n.d(a,o),a}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+".2561a46d.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="Connect:";n.l=(r,i,a,o)=>{if(e[r])e[r].push(i);else{var s,c;if(void 0!==a)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var d=u[l];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+a){s=d;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+a),s.src=r),e[r]=[i];var f=(t,n)=>{s.onerror=s.onload=null,clearTimeout(h);var i=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(n))),t)return t(n)},h=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),c&&document.head.appendChild(s)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/",(()=>{var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var a=new Promise(((n,r)=>i=e[t]=[n,r]));r.push(i[2]=a);var o=n.p+n.u(t),s=new Error;n.l(o,(r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var a=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",s.name="ChunkLoadError",s.type=a,s.request=o,i[1](s)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,a,o=r[0],s=r[1],c=r[2],u=0;if(o.some((t=>0!==e[t]))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(c)c(n)}for(t&&t(r);u<o.length;u++)a=o[u],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.webpackChunkConnect=self.webpackChunkConnect||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{hasBrowserEnv:()=>Hr,hasStandardBrowserEnv:()=>qr,hasStandardBrowserWebWorkerEnv:()=>Kr,navigator:()=>Yr,origin:()=>Xr});var t={};n.r(t),n.d(t,{Decoder:()=>Bo,Encoder:()=>Fo,PacketType:()=>jo,protocol:()=>Po});var r={};n.r(r),n.d(r,{AnchorPosition:()=>xL,DrawBox:()=>DL,DrawBoxOptions:()=>kL,DrawTextField:()=>AL,DrawTextFieldOptions:()=>NL});var i={};n.r(i),n.d(i,{DrawFaceLandmarks:()=>UO,DrawFaceLandmarksOptions:()=>FO,drawContour:()=>pO,drawDetections:()=>yO,drawFaceExpressions:()=>MO,drawFaceLandmarks:()=>BO});var a=n(5043),o=n.t(a,2),s=n(4391);function c(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var u=n(4467);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,u.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(n=f(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}const h=function(){for(var e,t,n=0,r="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=f(e))&&(r&&(r+=" "),r+=t);return r},p=["theme","type","isLoading"];!function(e){if(!e||"undefined"==typeof document)return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}(':root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}\n');var m=e=>"number"==typeof e&&!isNaN(e),g=e=>"string"==typeof e,v=e=>"function"==typeof e,y=e=>g(e)||v(e)?e:null,b=(e,t)=>!1===e||m(e)&&e>0?e:t,_=e=>(0,a.isValidElement)(e)||g(e)||v(e)||m(e);function w(e){let{enter:t,exit:n,appendPosition:r=!1,collapse:i=!0,collapseDuration:o=300}=e;return function(e){let{children:s,position:c,preventExitTransition:u,done:l,nodeRef:d,isIn:f,playToast:h}=e,p=r?"".concat(t,"--").concat(c):t,m=r?"".concat(n,"--").concat(c):n,g=(0,a.useRef)(0);return(0,a.useLayoutEffect)((()=>{let e=d.current,t=p.split(" "),n=r=>{r.target===d.current&&(h(),e.removeEventListener("animationend",n),e.removeEventListener("animationcancel",n),0===g.current&&"animationcancel"!==r.type&&e.classList.remove(...t))};e.classList.add(...t),e.addEventListener("animationend",n),e.addEventListener("animationcancel",n)}),[]),(0,a.useEffect)((()=>{let e=d.current,t=()=>{e.removeEventListener("animationend",t),i?function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,{scrollHeight:r,style:i}=e;requestAnimationFrame((()=>{i.minHeight="initial",i.height=r+"px",i.transition="all ".concat(n,"ms"),requestAnimationFrame((()=>{i.height="0",i.padding="0",i.margin="0",setTimeout(t,n)}))}))}(e,l,o):l()};f||(u?t():(g.current=1,e.className+=" ".concat(m),e.addEventListener("animationend",t)))}),[f]),a.createElement(a.Fragment,null,s)}}function E(e,t){return{content:S(e.content,e.props),containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,reason:e.removalReason,status:t}}function S(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,a.isValidElement)(e)&&!g(e.type)?(0,a.cloneElement)(e,{closeToast:t.closeToast,toastProps:t,data:t.data,isPaused:n}):v(e)?e({closeToast:t.closeToast,toastProps:t,data:t.data,isPaused:n}):e}function C(e){let{delay:t,isRunning:n,closeToast:r,type:i="default",hide:o,className:s,controlledProgress:c,progress:u,rtl:l,isIn:f,theme:p}=e,m=o||c&&0===u,g={animationDuration:"".concat(t,"ms"),animationPlayState:n?"running":"paused"};c&&(g.transform="scaleX(".concat(u,")"));let y=h("Toastify__progress-bar",c?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated","Toastify__progress-bar-theme--".concat(p),"Toastify__progress-bar--".concat(i),{"Toastify__progress-bar--rtl":l}),b=v(s)?s({rtl:l,type:i,defaultClassName:y}):h(y,s),_={[c&&u>=1?"onTransitionEnd":"onAnimationEnd"]:c&&u<1?null:()=>{f&&r()}};return a.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":m},a.createElement("div",{className:"Toastify__progress-bar--bg Toastify__progress-bar-theme--".concat(p," Toastify__progress-bar--").concat(i)}),a.createElement("div",d({role:"progressbar","aria-hidden":m?"true":"false","aria-label":"notification timer",className:b,style:g},_)))}var x=1,T=()=>"".concat(x++);function R(e,t,n){let r=1,i=0,a=[],o=[],s=t,c=new Map,u=new Set,l=()=>{o=Array.from(c.values()),u.forEach((e=>e()))},f=e=>{var t,n;null==(n=null==(t=e.props)?void 0:t.onClose)||n.call(t,e.removalReason),e.isActive=!1},h=e=>{if(null==e)c.forEach(f);else{let t=c.get(e);t&&f(t)}l()},p=e=>{var t,r;let{toastId:i,updateId:a}=e.props,o=null==a;e.staleId&&c.delete(e.staleId),e.isActive=!0,c.set(i,e),l(),n(E(e,o?"added":"updated")),o&&(null==(r=(t=e.props).onOpen)||r.call(t))};return{id:e,props:s,observe:e=>(u.add(e),()=>u.delete(e)),toggle:(e,t)=>{c.forEach((n=>{var r;(null==t||t===n.props.toastId)&&(null==(r=n.toggle)||r.call(n,e))}))},removeToast:h,toasts:c,clearQueue:()=>{i-=a.length,a=[]},buildToast:(t,o)=>{if((t=>{let{containerId:n,toastId:r,updateId:i}=t,a=n?n!==e:1!==e,o=c.has(r)&&null==i;return a||o})(o))return;let{toastId:u,updateId:f,data:g,staleId:v,delay:w}=o,S=null==f;S&&i++;let C=d(d(d({},s),{},{style:s.toastStyle,key:r++},Object.fromEntries(Object.entries(o).filter((e=>{let[t,n]=e;return null!=n})))),{},{toastId:u,updateId:f,data:g,isIn:!1,className:y(o.className||s.toastClassName),progressClassName:y(o.progressClassName||s.progressClassName),autoClose:!o.isLoading&&b(o.autoClose,s.autoClose),closeToast(e){c.get(u).removalReason=e,h(u)},deleteToast(){let e=c.get(u);if(null!=e){if(n(E(e,"removed")),c.delete(u),i--,i<0&&(i=0),a.length>0)return void p(a.shift());l()}}});C.closeButton=s.closeButton,!1===o.closeButton||_(o.closeButton)?C.closeButton=o.closeButton:!0===o.closeButton&&(C.closeButton=!_(s.closeButton)||s.closeButton);let x={content:t,props:C,staleId:v};s.limit&&s.limit>0&&i>s.limit&&S?a.push(x):m(w)?setTimeout((()=>{p(x)}),w):p(x)},setProps(e){s=e},setToggle:(e,t)=>{let n=c.get(e);n&&(n.toggle=t)},isToastActive:e=>{var t;return null==(t=c.get(e))?void 0:t.isActive},getSnapshot:()=>o}}var I=new Map,N=[],A=new Set,k=e=>A.forEach((t=>t(e))),D=()=>I.size>0;function M(e,t){var n;if(t)return!(null==(n=I.get(t))||!n.isToastActive(e));let r=!1;return I.forEach((t=>{t.isToastActive(e)&&(r=!0)})),r}function L(e){if(D()){if(null==e||(e=>g(e)||m(e))(e))I.forEach((t=>{t.removeToast(e)}));else if(e&&("containerId"in e||"id"in e)){let t=I.get(e.containerId);t?t.removeToast(e.id):I.forEach((t=>{t.removeToast(e.id)}))}}else N=N.filter((t=>null!=e&&t.options.toastId!==e))}function O(e,t){_(e)&&(D()||N.push({content:e,options:t}),I.forEach((n=>{n.buildToast(e,t)})))}function P(e,t){I.forEach((n=>{(null==t||null==t||!t.containerId||(null==t?void 0:t.containerId)===n.id)&&n.toggle(e,null==t?void 0:t.id)}))}function j(e){let t=e.containerId||1;return{subscribe(n){let r=R(t,e,k);I.set(t,r);let i=r.observe(n);return N.forEach((e=>O(e.content,e.options))),N=[],()=>{i(),I.delete(t)}},setProps(e){var n;null==(n=I.get(t))||n.setProps(e)},getSnapshot(){var e;return null==(e=I.get(t))?void 0:e.getSnapshot()}}}function F(e){return e&&(g(e.toastId)||m(e.toastId))?e.toastId:T()}function U(e,t){return O(e,t),t.toastId}function B(e,t){return d(d({},t),{},{type:t&&t.type||e,toastId:F(t)})}function V(e){return(t,n)=>U(t,B(e,n))}function z(e,t){return U(e,B("default",t))}function W(e){let[t,n]=(0,a.useState)(!1),[r,i]=(0,a.useState)(!1),o=(0,a.useRef)(null),s=(0,a.useRef)({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:c,pauseOnHover:u,closeToast:l,onClick:d,closeOnClick:f}=e;function h(){n(!0)}function p(){n(!1)}function m(n){let r=o.current;if(s.canDrag&&r){s.didMove=!0,t&&p(),"x"===e.draggableDirection?s.delta=n.clientX-s.start:s.delta=n.clientY-s.start,s.start!==n.clientX&&(s.canCloseOnClick=!1);let i="x"===e.draggableDirection?"".concat(s.delta,"px, var(--y)"):"0, calc(".concat(s.delta,"px + var(--y))");r.style.transform="translate3d(".concat(i,",0)"),r.style.opacity="".concat(1-Math.abs(s.delta/s.removalDistance))}}function g(){document.removeEventListener("pointermove",m),document.removeEventListener("pointerup",g);let t=o.current;if(s.canDrag&&s.didMove&&t){if(s.canDrag=!1,Math.abs(s.delta)>s.removalDistance)return i(!0),e.closeToast(!0),void e.collapseAll();t.style.transition="transform 0.2s, opacity 0.2s",t.style.removeProperty("transform"),t.style.removeProperty("opacity")}}(function(e){var t;null==(t=I.get(e.containerId||1))||t.setToggle(e.id,e.fn)})({id:e.toastId,containerId:e.containerId,fn:n}),(0,a.useEffect)((()=>{if(e.pauseOnFocusLoss)return document.hasFocus()||p(),window.addEventListener("focus",h),window.addEventListener("blur",p),()=>{window.removeEventListener("focus",h),window.removeEventListener("blur",p)}}),[e.pauseOnFocusLoss]);let v={onPointerDown:function(t){if(!0===e.draggable||e.draggable===t.pointerType){s.didMove=!1,document.addEventListener("pointermove",m),document.addEventListener("pointerup",g);let n=o.current;s.canCloseOnClick=!0,s.canDrag=!0,n.style.transition="none","x"===e.draggableDirection?(s.start=t.clientX,s.removalDistance=n.offsetWidth*(e.draggablePercent/100)):(s.start=t.clientY,s.removalDistance=n.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent)/100)}},onPointerUp:function(t){let{top:n,bottom:r,left:i,right:a}=o.current.getBoundingClientRect();"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&t.clientX>=i&&t.clientX<=a&&t.clientY>=n&&t.clientY<=r?p():h()}};return c&&u&&(v.onMouseEnter=p,e.stacked||(v.onMouseLeave=h)),f&&(v.onClick=e=>{d&&d(e),s.canCloseOnClick&&l(!0)}),{playToast:h,pauseToast:p,isRunning:t,preventExitTransition:r,toastRef:o,eventHandlers:v}}z.loading=(e,t)=>U(e,B("default",d({isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1},t))),z.promise=function(e,t,n){let r,{pending:i,error:a,success:o}=t;i&&(r=g(i)?z.loading(i,n):z.loading(i.render,d(d({},n),i)));let s={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},c=(e,t,i)=>{if(null==t)return void z.dismiss(r);let a=d(d(d({type:e},s),n),{},{data:i}),o=g(t)?{render:t}:t;return r?z.update(r,d(d({},a),o)):z(o.render,d(d({},a),o)),i},u=v(e)?e():e;return u.then((e=>c("success",o,e))).catch((e=>c("error",a,e))),u},z.success=V("success"),z.info=V("info"),z.error=V("error"),z.warning=V("warning"),z.warn=z.warning,z.dark=(e,t)=>U(e,B("default",d({theme:"dark"},t))),z.dismiss=function(e){L(e)},z.clearWaitingQueue=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};I.forEach((t=>{t.props.limit&&(!e.containerId||t.id===e.containerId)&&t.clearQueue()}))},z.isActive=M,z.update=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=((e,t)=>{let{containerId:n}=t;var r;return null==(r=I.get(n||1))?void 0:r.toasts.get(e)})(e,t);if(n){let{props:r,content:i}=n,a=d(d(d({delay:100},r),t),{},{toastId:t.toastId||e,updateId:T()});a.toastId!==e&&(a.staleId=e);let o=a.render||i;delete a.render,U(o,a)}},z.done=e=>{z.update(e,{progress:1})},z.onChange=function(e){return A.add(e),()=>{A.delete(e)}},z.play=e=>P(!0,e),z.pause=e=>P(!1,e);var G="undefined"!=typeof window?a.useLayoutEffect:a.useEffect,H=e=>{let{theme:t,type:n,isLoading:r}=e,i=c(e,p);return a.createElement("svg",d({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===t?"currentColor":"var(--toastify-icon-color-".concat(n,")")},i))};var Y={info:function(e){return a.createElement(H,d({},e),a.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return a.createElement(H,d({},e),a.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return a.createElement(H,d({},e),a.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return a.createElement(H,d({},e),a.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return a.createElement("div",{className:"Toastify__spinner"})}};function q(e){let{theme:t,type:n,isLoading:r,icon:i}=e,o=null,s={theme:t,type:n};return!1===i||(v(i)?o=i(d(d({},s),{},{isLoading:r})):(0,a.isValidElement)(i)?o=(0,a.cloneElement)(i,s):r?o=Y.spinner():(e=>e in Y)(n)&&(o=Y[n](s))),o}var K,X=e=>{let{isRunning:t,preventExitTransition:n,toastRef:r,eventHandlers:i,playToast:o}=W(e),{closeButton:s,children:c,autoClose:u,onClick:l,type:f,hideProgressBar:p,closeToast:m,transition:g,position:y,className:b,style:_,progressClassName:w,updateId:E,role:x,progress:T,rtl:R,toastId:I,deleteToast:N,isIn:A,isLoading:k,closeOnClick:D,theme:M,ariaLabel:L}=e,O=h("Toastify__toast","Toastify__toast-theme--".concat(M),"Toastify__toast--".concat(f),{"Toastify__toast--rtl":R},{"Toastify__toast--close-on-click":D}),P=v(b)?b({rtl:R,position:y,type:f,defaultClassName:O}):h(O,b),j=q(e),F=!!T||!u,U={closeToast:m,type:f,theme:M},B=null;return!1===s||(B=v(s)?s(U):(0,a.isValidElement)(s)?(0,a.cloneElement)(s,U):function(e){let{closeToast:t,theme:n,ariaLabel:r="close"}=e;return a.createElement("button",{className:"Toastify__close-button Toastify__close-button--".concat(n),type:"button",onClick:e=>{e.stopPropagation(),t(!0)},"aria-label":r},a.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},a.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}(U)),a.createElement(g,{isIn:A,done:N,position:y,preventExitTransition:n,nodeRef:r,playToast:o},a.createElement("div",d(d({id:I,tabIndex:0,onClick:l,"data-in":A,className:P},i),{},{style:_,ref:r},A&&{role:x,"aria-label":L}),null!=j&&a.createElement("div",{className:h("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!k})},j),S(c,e,!t),B,!e.customProgressBar&&a.createElement(C,d(d({},E&&!F?{key:"p-".concat(E)}:{}),{},{rtl:R,theme:M,delay:u,isRunning:t,isIn:A,closeToast:m,hide:p,type:f,className:w,controlledProgress:F,progress:T||0}))))},Q=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{enter:"Toastify--animate Toastify__".concat(e,"-enter"),exit:"Toastify--animate Toastify__".concat(e,"-exit"),appendPosition:t}},J=w(Q("bounce",!0)),Z=(w(Q("slide",!0)),w(Q("zoom")),w(Q("flip")),{position:"top-right",transition:J,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:e=>e.altKey&&"KeyT"===e.code});function $(e){let t=d(d({},Z),e),n=e.stacked,[r,i]=(0,a.useState)(!0),o=(0,a.useRef)(null),{getToastToRender:s,isToastActive:c,count:u}=function(e){var t;let{subscribe:n,getSnapshot:r,setProps:i}=(0,a.useRef)(j(e)).current;i(e);let o=null==(t=(0,a.useSyncExternalStore)(n,r,r))?void 0:t.slice();return{getToastToRender:function(t){if(!o)return[];let n=new Map;return e.newestOnTop&&o.reverse(),o.forEach((e=>{let{position:t}=e.props;n.has(t)||n.set(t,[]),n.get(t).push(e)})),Array.from(n,(e=>t(e[0],e[1])))},isToastActive:M,count:null==o?void 0:o.length}}(t),{className:l,style:f,rtl:p,containerId:m,hotKeys:g}=t;function b(e){let t=h("Toastify__toast-container","Toastify__toast-container--".concat(e),{"Toastify__toast-container--rtl":p});return v(l)?l({position:e,rtl:p,defaultClassName:t}):h(t,y(l))}function _(){n&&(i(!0),z.play())}return G((()=>{var e;if(n){let n=o.current.querySelectorAll('[data-in="true"]'),i=12,a=null==(e=t.position)?void 0:e.includes("top"),s=0,c=0;Array.from(n).reverse().forEach(((e,t)=>{let n=e;n.classList.add("Toastify__toast--stacked"),t>0&&(n.dataset.collapsed="".concat(r)),n.dataset.pos||(n.dataset.pos=a?"top":"bot");let o=s*(r?.2:1)+(r?0:i*t);n.style.setProperty("--y","".concat(a?o:-1*o,"px")),n.style.setProperty("--g","".concat(i)),n.style.setProperty("--s","".concat(1-(r?c:0))),s+=n.offsetHeight,c+=.025}))}}),[r,u,n]),(0,a.useEffect)((()=>{function e(e){var t;let n=o.current;g(e)&&(null==(t=n.querySelector('[tabIndex="0"]'))||t.focus(),i(!1),z.pause()),"Escape"===e.key&&(document.activeElement===n||null!=n&&n.contains(document.activeElement))&&(i(!0),z.play())}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[g]),a.createElement("section",{ref:o,className:"Toastify",id:m,onMouseEnter:()=>{n&&(i(!1),z.pause())},onMouseLeave:_,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":t["aria-label"]},s(((e,t)=>{let r=t.length?d({},f):d(d({},f),{},{pointerEvents:"none"});return a.createElement("div",{tabIndex:-1,className:b(e),"data-stacked":n,style:r,key:"c-".concat(e)},t.map((e=>{let{content:t,props:r}=e;return a.createElement(X,d(d({},r),{},{stacked:n,collapseAll:_,isIn:c(r.toastId,r.containerId),key:"t-".concat(r.key)}),t)})))})))}function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ee.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(K||(K={}));const te="popstate";function ne(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function re(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(Vc){}}}function ie(e,t){return{usr:e.state,key:e.key,idx:t}}function ae(e,t,n,r){return void 0===n&&(n=null),ee({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?se(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function oe(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function se(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function ce(e,t,n,r){void 0===r&&(r={});let{window:i=document.defaultView,v5Compat:a=!1}=r,o=i.history,s=K.Pop,c=null,u=l();function l(){return(o.state||{idx:null}).idx}function d(){s=K.Pop;let e=l(),t=null==e?null:e-u;u=e,c&&c({action:s,location:h.location,delta:t})}function f(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,n="string"===typeof e?e:oe(e);return n=n.replace(/ $/,"%20"),ne(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==u&&(u=0,o.replaceState(ee({},o.state,{idx:u}),""));let h={get action(){return s},get location(){return e(i,o)},listen(e){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(te,d),c=e,()=>{i.removeEventListener(te,d),c=null}},createHref:e=>t(i,e),createURL:f,encodeLocation(e){let t=f(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){s=K.Push;let r=ae(h.location,e,t);n&&n(r,e),u=l()+1;let d=ie(r,u),f=h.createHref(r);try{o.pushState(d,"",f)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;i.location.assign(f)}a&&c&&c({action:s,location:h.location,delta:1})},replace:function(e,t){s=K.Replace;let r=ae(h.location,e,t);n&&n(r,e),u=l();let i=ie(r,u),d=h.createHref(r);o.replaceState(i,"",d),a&&c&&c({action:s,location:h.location,delta:0})},go:e=>o.go(e)};return h}var ue;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(ue||(ue={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function le(e,t,n){return void 0===n&&(n="/"),de(e,t,n,!1)}function de(e,t,n,r){let i=xe(("string"===typeof t?se(t):t).pathname||"/",n);if(null==i)return null;let a=fe(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(a);let o=null;for(let s=0;null==o&&s<a.length;++s){let e=Ce(i);o=Ee(a[s],e,r)}return o}function fe(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(e,i,a)=>{let o={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};o.relativePath.startsWith("/")&&(ne(o.relativePath.startsWith(r),'Absolute route path "'+o.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(r.length));let s=Ae([r,o.relativePath]),c=n.concat(o);e.children&&e.children.length>0&&(ne(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),fe(e.children,t,c,s)),(null!=e.path||e.index)&&t.push({path:s,score:we(s,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of he(e.path))i(e,t,r);else i(e,t)})),t}function he(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),a=n.replace(/\?$/,"");if(0===r.length)return i?[a,""]:[a];let o=he(r.join("/")),s=[];return s.push(...o.map((e=>""===e?a:[a,e].join("/")))),i&&s.push(...o),s.map((t=>e.startsWith("/")&&""===t?"/":t))}const pe=/^:[\w-]+$/,me=3,ge=2,ve=1,ye=10,be=-2,_e=e=>"*"===e;function we(e,t){let n=e.split("/"),r=n.length;return n.some(_e)&&(r+=be),t&&(r+=ge),n.filter((e=>!_e(e))).reduce(((e,t)=>e+(pe.test(t)?me:""===t?ve:ye)),r)}function Ee(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,i={},a="/",o=[];for(let s=0;s<r.length;++s){let e=r[s],c=s===r.length-1,u="/"===a?t:t.slice(a.length)||"/",l=Se({path:e.relativePath,caseSensitive:e.caseSensitive,end:c},u),d=e.route;if(!l&&c&&n&&!r[r.length-1].route.index&&(l=Se({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},u)),!l)return null;Object.assign(i,l.params),o.push({params:i,pathname:Ae([a,l.pathname]),pathnameBase:ke(Ae([a,l.pathnameBase])),route:d}),"/"!==l.pathnameBase&&(a=Ae([a,l.pathnameBase]))}return o}function Se(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);re("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let a=new RegExp(i,t?void 0:"i");return[a,r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),s=i.slice(1),c=r.reduce(((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=s[n]||"";o=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const c=s[n];return e[r]=i&&!c?void 0:(c||"").replace(/%2F/g,"/"),e}),{});return{params:c,pathname:a,pathnameBase:o,pattern:e}}function Ce(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return re(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function xe(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function Te(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function Re(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function Ie(e,t){let n=Re(e);return t?n.map(((e,t)=>t===n.length-1?e.pathname:e.pathnameBase)):n.map((e=>e.pathnameBase))}function Ne(e,t,n,r){let i;void 0===r&&(r=!1),"string"===typeof e?i=se(e):(i=ee({},e),ne(!i.pathname||!i.pathname.includes("?"),Te("?","pathname","search",i)),ne(!i.pathname||!i.pathname.includes("#"),Te("#","pathname","hash",i)),ne(!i.search||!i.search.includes("#"),Te("#","search","hash",i)));let a,o=""===e||""===i.pathname,s=o?"/":i.pathname;if(null==s)a=n;else{let e=t.length-1;if(!r&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}a=e>=0?t[e]:"/"}let c=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:i=""}="string"===typeof e?se(e):e,a=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:a,search:De(r),hash:Me(i)}}(i,a),u=s&&"/"!==s&&s.endsWith("/"),l=(o||"."===s)&&n.endsWith("/");return c.pathname.endsWith("/")||!u&&!l||(c.pathname+="/"),c}const Ae=e=>e.join("/").replace(/\/\/+/g,"/"),ke=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),De=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",Me=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function Le(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const Oe=["post","put","patch","delete"],Pe=(new Set(Oe),["get",...Oe]);new Set(Pe),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function je(){return je=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},je.apply(this,arguments)}const Fe=a.createContext(null);const Ue=a.createContext(null);const Be=a.createContext(null);const Ve=a.createContext(null);const ze=a.createContext({outlet:null,matches:[],isDataRoute:!1});const We=a.createContext(null);function Ge(){return null!=a.useContext(Ve)}function He(){return Ge()||ne(!1),a.useContext(Ve).location}function Ye(e){a.useContext(Be).static||a.useLayoutEffect(e)}function qe(){let{isDataRoute:e}=a.useContext(ze);return e?function(){let{router:e}=at(rt.UseNavigateStable),t=st(it.UseNavigateStable),n=a.useRef(!1);Ye((()=>{n.current=!0}));let r=a.useCallback((function(r,i){void 0===i&&(i={}),n.current&&("number"===typeof r?e.navigate(r):e.navigate(r,je({fromRouteId:t},i)))}),[e,t]);return r}():function(){Ge()||ne(!1);let e=a.useContext(Fe),{basename:t,future:n,navigator:r}=a.useContext(Be),{matches:i}=a.useContext(ze),{pathname:o}=He(),s=JSON.stringify(Ie(i,n.v7_relativeSplatPath)),c=a.useRef(!1);Ye((()=>{c.current=!0}));let u=a.useCallback((function(n,i){if(void 0===i&&(i={}),!c.current)return;if("number"===typeof n)return void r.go(n);let a=Ne(n,JSON.parse(s),o,"path"===i.relative);null==e&&"/"!==t&&(a.pathname="/"===a.pathname?t:Ae([t,a.pathname])),(i.replace?r.replace:r.push)(a,i.state,i)}),[t,r,s,o,e]);return u}()}const Ke=a.createContext(null);function Xe(){let{matches:e}=a.useContext(ze),t=e[e.length-1];return t?t.params:{}}function Qe(e,t){let{relative:n}=void 0===t?{}:t,{future:r}=a.useContext(Be),{matches:i}=a.useContext(ze),{pathname:o}=He(),s=JSON.stringify(Ie(i,r.v7_relativeSplatPath));return a.useMemo((()=>Ne(e,JSON.parse(s),o,"path"===n)),[e,s,o,n])}function Je(e,t,n,r){Ge()||ne(!1);let{navigator:i}=a.useContext(Be),{matches:o}=a.useContext(ze),s=o[o.length-1],c=s?s.params:{},u=(s&&s.pathname,s?s.pathnameBase:"/");s&&s.route;let l,d=He();if(t){var f;let e="string"===typeof t?se(t):t;"/"===u||(null==(f=e.pathname)?void 0:f.startsWith(u))||ne(!1),l=e}else l=d;let h=l.pathname||"/",p=h;if("/"!==u){let e=u.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(e.length).join("/")}let m=le(e,{pathname:p});let g=nt(m&&m.map((e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:Ae([u,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:Ae([u,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),o,n,r);return t&&g?a.createElement(Ve.Provider,{value:{location:je({pathname:"/",search:"",hash:"",state:null,key:"default"},l),navigationType:K.Pop}},g):g}function Ze(){let e=function(){var e;let t=a.useContext(We),n=ot(it.UseRouteError),r=st(it.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=Le(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r};return a.createElement(a.Fragment,null,a.createElement("h2",null,"Unexpected Application Error!"),a.createElement("h3",{style:{fontStyle:"italic"}},t),n?a.createElement("pre",{style:i},n):null,null)}const $e=a.createElement(Ze,null);class et extends a.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?a.createElement(ze.Provider,{value:this.props.routeContext},a.createElement(We.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function tt(e){let{routeContext:t,match:n,children:r}=e,i=a.useContext(Fe);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),a.createElement(ze.Provider,{value:t},r)}function nt(e,t,n,r){var i;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var o;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(o=r)&&o.v7_partialHydration&&0===t.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let s=e,c=null==(i=n)?void 0:i.errors;if(null!=c){let e=s.findIndex((e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id])));e>=0||ne(!1),s=s.slice(0,Math.min(s.length,e+1))}let u=!1,l=-1;if(n&&r&&r.v7_partialHydration)for(let a=0;a<s.length;a++){let e=s[a];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(l=a),e.route.id){let{loaderData:t,errors:r}=n,i=e.route.loader&&void 0===t[e.route.id]&&(!r||void 0===r[e.route.id]);if(e.route.lazy||i){u=!0,s=l>=0?s.slice(0,l+1):[s[0]];break}}}return s.reduceRight(((e,r,i)=>{let o,d=!1,f=null,h=null;var p;n&&(o=c&&r.route.id?c[r.route.id]:void 0,f=r.route.errorElement||$e,u&&(l<0&&0===i?(p="route-fallback",!1||ct[p]||(ct[p]=!0),d=!0,h=null):l===i&&(d=!0,h=r.route.hydrateFallbackElement||null)));let m=t.concat(s.slice(0,i+1)),g=()=>{let t;return t=o?f:d?h:r.route.Component?a.createElement(r.route.Component,null):r.route.element?r.route.element:e,a.createElement(tt,{match:r,routeContext:{outlet:e,matches:m,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===i)?a.createElement(et,{location:n.location,revalidation:n.revalidation,component:f,error:o,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var rt=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(rt||{}),it=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(it||{});function at(e){let t=a.useContext(Fe);return t||ne(!1),t}function ot(e){let t=a.useContext(Ue);return t||ne(!1),t}function st(e){let t=function(){let e=a.useContext(ze);return e||ne(!1),e}(),n=t.matches[t.matches.length-1];return n.route.id||ne(!1),n.route.id}const ct={};function ut(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}o.startTransition;function lt(e){return function(e){let t=a.useContext(ze).outlet;return t?a.createElement(Ke.Provider,{value:e},t):t}(e.context)}function dt(e){ne(!1)}function ft(e){let{basename:t="/",children:n=null,location:r,navigationType:i=K.Pop,navigator:o,static:s=!1,future:c}=e;Ge()&&ne(!1);let u=t.replace(/^\/*/,"/"),l=a.useMemo((()=>({basename:u,navigator:o,static:s,future:je({v7_relativeSplatPath:!1},c)})),[u,c,o,s]);"string"===typeof r&&(r=se(r));let{pathname:d="/",search:f="",hash:h="",state:p=null,key:m="default"}=r,g=a.useMemo((()=>{let e=xe(d,u);return null==e?null:{location:{pathname:e,search:f,hash:h,state:p,key:m},navigationType:i}}),[u,d,f,h,p,m,i]);return null==g?null:a.createElement(Be.Provider,{value:l},a.createElement(Ve.Provider,{children:n,value:g}))}function ht(e){let{children:t,location:n}=e;return Je(pt(t),n)}new Promise((()=>{}));a.Component;function pt(e,t){void 0===t&&(t=[]);let n=[];return a.Children.forEach(e,((e,r)=>{if(!a.isValidElement(e))return;let i=[...t,r];if(e.type===a.Fragment)return void n.push.apply(n,pt(e.props.children,i));e.type!==dt&&ne(!1),e.props.index&&e.props.children&&ne(!1);let o={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=pt(e.props.children,i)),n.push(o)})),n}var mt=n(7950),gt=n.t(mt,2);function vt(){return vt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vt.apply(this,arguments)}function yt(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const bt=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],_t=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"];try{window.__reactRouterVersion="6"}catch(Vc){}const wt=a.createContext({isTransitioning:!1});new Map;const Et=o.startTransition;gt.flushSync,o.useId;function St(e){let{basename:t,children:n,future:r,window:i}=e,o=a.useRef();var s;null==o.current&&(o.current=(void 0===(s={window:i,v5Compat:!0})&&(s={}),ce((function(e,t){let{pathname:n,search:r,hash:i}=e.location;return ae("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:oe(t)}),null,s)));let c=o.current,[u,l]=a.useState({action:c.action,location:c.location}),{v7_startTransition:d}=r||{},f=a.useCallback((e=>{d&&Et?Et((()=>l(e))):l(e)}),[l,d]);return a.useLayoutEffect((()=>c.listen(f)),[c,f]),a.useEffect((()=>ut(r)),[r]),a.createElement(ft,{basename:t,children:n,location:u.location,navigationType:u.action,navigator:c,future:r})}const Ct="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,xt=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Tt=a.forwardRef((function(e,t){let n,{onClick:r,relative:i,reloadDocument:o,replace:s,state:c,target:u,to:l,preventScrollReset:d,viewTransition:f}=e,h=yt(e,bt),{basename:p}=a.useContext(Be),m=!1;if("string"===typeof l&&xt.test(l)&&(n=l,Ct))try{let e=new URL(window.location.href),t=l.startsWith("//")?new URL(e.protocol+l):new URL(l),n=xe(t.pathname,p);t.origin===e.origin&&null!=n?l=n+t.search+t.hash:m=!0}catch(Vc){}let g=function(e,t){let{relative:n}=void 0===t?{}:t;Ge()||ne(!1);let{basename:r,navigator:i}=a.useContext(Be),{hash:o,pathname:s,search:c}=Qe(e,{relative:n}),u=s;return"/"!==r&&(u="/"===s?r:Ae([r,s])),i.createHref({pathname:u,search:c,hash:o})}(l,{relative:i}),v=function(e,t){let{target:n,replace:r,state:i,preventScrollReset:o,relative:s,viewTransition:c}=void 0===t?{}:t,u=qe(),l=He(),d=Qe(e,{relative:s});return a.useCallback((t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==r?r:oe(l)===oe(d);u(e,{replace:n,state:i,preventScrollReset:o,relative:s,viewTransition:c})}}),[l,u,d,r,i,n,e,o,s,c])}(l,{replace:s,state:c,target:u,preventScrollReset:d,relative:i,viewTransition:f});return a.createElement("a",vt({},h,{href:n||g,onClick:m||o?r:function(e){r&&r(e),e.defaultPrevented||v(e)},ref:t,target:u}))}));const Rt=a.forwardRef((function(e,t){let{"aria-current":n="page",caseSensitive:r=!1,className:i="",end:o=!1,style:s,to:c,viewTransition:u,children:l}=e,d=yt(e,_t),f=Qe(c,{relative:d.relative}),h=He(),p=a.useContext(Ue),{navigator:m,basename:g}=a.useContext(Be),v=null!=p&&function(e,t){void 0===t&&(t={});let n=a.useContext(wt);null==n&&ne(!1);let{basename:r}=At(It.useViewTransitionState),i=Qe(e,{relative:t.relative});if(!n.isTransitioning)return!1;let o=xe(n.currentLocation.pathname,r)||n.currentLocation.pathname,s=xe(n.nextLocation.pathname,r)||n.nextLocation.pathname;return null!=Se(i.pathname,s)||null!=Se(i.pathname,o)}(f)&&!0===u,y=m.encodeLocation?m.encodeLocation(f).pathname:f.pathname,b=h.pathname,_=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;r||(b=b.toLowerCase(),_=_?_.toLowerCase():null,y=y.toLowerCase()),_&&g&&(_=xe(_,g)||_);const w="/"!==y&&y.endsWith("/")?y.length-1:y.length;let E,S=b===y||!o&&b.startsWith(y)&&"/"===b.charAt(w),C=null!=_&&(_===y||!o&&_.startsWith(y)&&"/"===_.charAt(y.length)),x={isActive:S,isPending:C,isTransitioning:v},T=S?n:void 0;E="function"===typeof i?i(x):[i,S?"active":null,C?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let R="function"===typeof s?s(x):s;return a.createElement(Tt,vt({},d,{"aria-current":T,className:E,ref:t,style:R,to:c,viewTransition:u}),"function"===typeof l?l(x):l)}));var It,Nt;function At(e){let t=a.useContext(Fe);return t||ne(!1),t}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(It||(It={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Nt||(Nt={}));var kt=n(579);const Dt=e=>{let{type:t="info",title:n,message:r,avatar:i,link:o,icon:s,showAvatar:c=!0,showIcon:u=!0,closeToast:l,toastProps:d}=e;const f=(0,a.useRef)(null),h=()=>{if(s)return s;switch(t){case"success":return(0,kt.jsx)("i",{className:"fas fa-check-circle"});case"error":return(0,kt.jsx)("i",{className:"fas fa-exclamation-circle"});case"warning":return(0,kt.jsx)("i",{className:"fas fa-exclamation-triangle"});default:return(0,kt.jsx)("i",{className:"fas fa-info-circle"})}};(0,a.useEffect)((()=>{if(f.current&&null!==d&&void 0!==d&&d.autoClose){const e=d.autoClose;f.current.style.setProperty("--progress-duration","".concat(e,"ms"))}}),[d]);const p=()=>(0,kt.jsxs)("div",{className:"custom-toast custom-toast--".concat(t),children:[(0,kt.jsx)("button",{className:"custom-toast__close-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),l&&l()},"aria-label":"Close",children:"\xd7"}),(0,kt.jsxs)("div",{className:"custom-toast__content",children:[u&&!c&&(0,kt.jsx)("div",{className:"custom-toast__icon",children:h()}),(0,kt.jsxs)("div",{className:"custom-toast__body",children:[c&&i&&(0,kt.jsx)("div",{className:"custom-toast__avatar",children:(0,kt.jsx)("img",{src:i,alt:"Avatar"})}),(0,kt.jsxs)("div",{className:"custom-toast__text",children:[n&&(0,kt.jsx)("div",{className:"custom-toast__title",children:n}),(0,kt.jsx)("div",{className:"custom-toast__message",children:r})]})]})]}),(0,kt.jsx)("div",{ref:f,className:"custom-toast__progress-bar custom-toast__progress-bar--".concat(t)})]});return o?(0,kt.jsx)(Tt,{to:o,className:"custom-toast__link",children:(0,kt.jsx)(p,{})}):(0,kt.jsx)(p,{})},Mt=["closeToast"],Lt=["closeToast"],Ot=["closeToast"],Pt={position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!1,draggable:!0,progress:void 0,className:"custom-toast-notification",bodyClassName:"custom-toast-body",progressClassName:"custom-toast-progress",icon:!1,pauseOnFocusLoss:!1},jt=(e,t)=>{"number"===typeof t&&t>0&&setTimeout((()=>{try{z.dismiss(e)}catch(vu){}}),t+50)},Ft=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{title:n,avatar:r,link:i,autoClose:a=5e3}=t,o=z.success((t=>{let{closeToast:o}=t,s=c(t,Mt);return(0,kt.jsx)(Dt,{type:"success",title:n,message:e,avatar:r,link:i,showAvatar:!!r,closeToast:o,toastProps:d(d({},s),{},{autoClose:a})})}),d(d({},Pt),{},{autoClose:a,className:"custom-toast-success"}));jt(o,a)},Ut=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{autoClose:a=5e3}=i,o=z.info((i=>{let{closeToast:o}=i,s=c(i,Lt);return(0,kt.jsx)(Dt,{type:"info",title:t,message:e,avatar:n,link:r,showAvatar:!0,showIcon:!1,closeToast:o,toastProps:d(d({},s),{},{autoClose:a})})}),d(d({},Pt),{},{autoClose:a,className:"custom-toast-message"}));jt(o,a)},Bt=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{autoClose:a=5e3}=i,o=z.success((i=>{let{closeToast:o}=i,s=c(i,Ot);return(0,kt.jsx)(Dt,{type:"success",title:t,message:e,avatar:n,link:r,showAvatar:!0,showIcon:!0,closeToast:o,toastProps:d(d({},s),{},{autoClose:a})})}),d(d({},Pt),{},{autoClose:a,className:"custom-toast-profile-update"}));jt(o,a)},Vt=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{autoClose:i=5e3}=r,a=z.success((0,kt.jsx)(Dt,{type:"success",title:"Video Saved",message:"".concat(e," saved to videos"),avatar:t,link:n,showAvatar:!0,showIcon:!0}),d(d({},Pt),{},{autoClose:i,className:"custom-toast-video-saved"}));jt(a,i)};var zt=n(8139),Wt=n.n(zt);const Gt=["xxl","xl","lg","md","sm","xs"],Ht="xs",Yt=a.createContext({prefixes:{},breakpoints:Gt,minBreakpoint:Ht}),{Consumer:qt,Provider:Kt}=Yt;function Xt(e,t){const{prefixes:n}=(0,a.useContext)(Yt);return e||n[t]||t}function Qt(){const{breakpoints:e}=(0,a.useContext)(Yt);return e}function Jt(){const{minBreakpoint:e}=(0,a.useContext)(Yt);return e}const Zt=["bsPrefix","fluid","as","className"],$t=a.forwardRef(((e,t)=>{let{bsPrefix:n,fluid:r=!1,as:i="div",className:a}=e,o=c(e,Zt);const s=Xt(n,"container"),u="string"===typeof r?"-".concat(r):"-fluid";return(0,kt.jsx)(i,d(d({ref:t},o),{},{className:Wt()(a,r?"".concat(s).concat(u):s)}))}));$t.displayName="Container";const en=$t,tn=["bsPrefix","className","as"],nn=a.forwardRef(((e,t)=>{let{bsPrefix:n,className:r,as:i="div"}=e,a=c(e,tn);const o=Xt(n,"row"),s=Qt(),u=Jt(),l="".concat(o,"-cols"),f=[];return s.forEach((e=>{const t=a[e];let n;delete a[e],null!=t&&"object"===typeof t?({cols:n}=t):n=t;const r=e!==u?"-".concat(e):"";null!=n&&f.push("".concat(l).concat(r,"-").concat(n))})),(0,kt.jsx)(i,d(d({ref:t},a),{},{className:Wt()(r,o,...f)}))}));nn.displayName="Row";const rn=nn,an=["as","bsPrefix","className"],on=["className"];const sn=a.forwardRef(((e,t)=>{const[n,{as:r="div",bsPrefix:i,spans:a}]=function(e){let{as:t,bsPrefix:n,className:r}=e,i=c(e,an);n=Xt(n,"col");const a=Qt(),o=Jt(),s=[],u=[];return a.forEach((e=>{const t=i[e];let r,a,c;delete i[e],"object"===typeof t&&null!=t?({span:r,offset:a,order:c}=t):r=t;const l=e!==o?"-".concat(e):"";r&&s.push(!0===r?"".concat(n).concat(l):"".concat(n).concat(l,"-").concat(r)),null!=c&&u.push("order".concat(l,"-").concat(c)),null!=a&&u.push("offset".concat(l,"-").concat(a))})),[d(d({},i),{},{className:Wt()(r,...s,...u)}),{as:t,bsPrefix:n,spans:s}]}(e),{className:o}=n,s=c(n,on);return(0,kt.jsx)(r,d(d({},s),{},{ref:t,className:Wt()(o,!a.length&&i)}))}));sn.displayName="Col";const cn=sn;var un=n(9461),ln=n(8443);let dn=function(e){e()};const fn=()=>dn,hn=Symbol.for("react-redux-context"),pn="undefined"!==typeof globalThis?globalThis:{};function mn(){var e;if(!a.createContext)return{};const t=null!=(e=pn[hn])?e:pn[hn]=new Map;let n=t.get(a.createContext);return n||(n=a.createContext(null),t.set(a.createContext,n)),n}const gn=mn();function vn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gn;return function(){return(0,a.useContext)(e)}}const yn=vn();let bn=()=>{throw new Error("uSES not initialized!")};const _n=(e,t)=>e===t;function wn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gn;const t=e===gn?yn:vn(e);return function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{equalityFn:r=_n,stabilityCheck:i,noopCheck:o}="function"===typeof n?{equalityFn:n}:n;const{store:s,subscription:c,getServerState:u,stabilityCheck:l,noopCheck:d}=t(),f=((0,a.useRef)(!0),(0,a.useCallback)({[e.name]:t=>e(t)}[e.name],[e,l,i])),h=bn(c.addNestedSub,s.getState,u||s.getState,f,r);return(0,a.useDebugValue)(h),h}}const En=wn();n(219),n(2706);const Sn={notify(){},get:()=>[]};function Cn(e,t){let n,r=Sn,i=0,a=!1;function o(){u.onStateChange&&u.onStateChange()}function s(){i++,n||(n=t?t.addNestedSub(o):e.subscribe(o),r=function(){const e=fn();let t=null,n=null;return{clear(){t=null,n=null},notify(){e((()=>{let e=t;for(;e;)e.callback(),e=e.next}))},get(){let e=[],n=t;for(;n;)e.push(n),n=n.next;return e},subscribe(e){let r=!0,i=n={callback:e,next:null,prev:n};return i.prev?i.prev.next=i:t=i,function(){r&&null!==t&&(r=!1,i.next?i.next.prev=i.prev:n=i.prev,i.prev?i.prev.next=i.next:t=i.next)}}}}())}function c(){i--,n&&0===i&&(n(),n=void 0,r.clear(),r=Sn)}const u={addNestedSub:function(e){s();const t=r.subscribe(e);let n=!1;return()=>{n||(n=!0,t(),c())}},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:o,isSubscribed:function(){return a},trySubscribe:function(){a||(a=!0,s())},tryUnsubscribe:function(){a&&(a=!1,c())},getListeners:()=>r};return u}const xn=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement)?a.useLayoutEffect:a.useEffect;let Tn=null;const Rn=function(e){let{store:t,context:n,children:r,serverState:i,stabilityCheck:o="once",noopCheck:s="once"}=e;const c=a.useMemo((()=>{const e=Cn(t);return{store:t,subscription:e,getServerState:i?()=>i:void 0,stabilityCheck:o,noopCheck:s}}),[t,i,o,s]),u=a.useMemo((()=>t.getState()),[t]);xn((()=>{const{subscription:e}=c;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),u!==t.getState()&&e.notifyNestedSubs(),()=>{e.tryUnsubscribe(),e.onStateChange=void 0}}),[c,u]);const l=n||gn;return a.createElement(l.Provider,{value:c},r)};function In(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gn;const t=e===gn?yn:vn(e);return function(){const{store:e}=t();return e}}const Nn=In();function An(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gn;const t=e===gn?Nn:In(e);return function(){return t().dispatch}}const kn=An();var Dn;(e=>{bn=e})(ln.useSyncExternalStoreWithSelector),(e=>{Tn=e})(un.useSyncExternalStore),Dn=mt.unstable_batchedUpdates,dn=Dn;var Mn=n(2963),Ln=n.n(Mn),On=n(8613),Pn=n.n(On);Ln().setAppElement("#root");const jn=(e,t)=>{let{children:n,title:r,style:i,isOpen:o,onRequestClose:s,id:c,onClose:u,isFullscreen:l}=e;var f=(e=>{const[t,n]=(0,a.useState)(window.matchMedia(e).matches);return(0,a.useEffect)((()=>{const t=window.matchMedia(e),r=e=>n(e.matches);return t.addEventListener("change",r),()=>t.removeEventListener("change",r)}),[e]),t})("(max-width: 768px)");const h={content:l?d({top:"0",left:"0",right:"0",bottom:"0",marginRight:"0",transform:"none",backgroundColor:"rgb(36,37,38)",zIndex:"99",maxHeight:"100vh",width:"100vw",height:"100vh",padding:"0",border:"none",borderRadius:"0"},i):d(d({top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",backgroundColor:"rgb(36,37,38)",zIndex:"99",maxHeight:"100%"},i),{},{width:f?"95%":"600px"}),overlay:{backgroundColor:"rgba(0,0,0,0.8)",zIndex:"999"}};return(0,kt.jsx)("div",{children:(0,kt.jsx)(Ln(),{shouldCloseOnOverlayClick:!0,shouldCloseOnEsc:!0,style:h,isOpen:o,onRequestClose:s,id:c||"profile-modal",className:l?"fullscreen-modal":"",children:n})})},Fn=(e,t)=>{const n=new Image;n.src=e,n.onload=()=>t(!0),n.onerror=()=>t(!1)};const Un=e=>{let{profilePic:t,profile:n,active:r,hasStory:i}=e;const[o,s]=(0,a.useState)(!1);let c=qe();var u=n;(0,a.useEffect)((()=>{Fn(t,s)}),[t]);let l=(0,a.useCallback)((e=>{c("/".concat(e.currentTarget.dataset.id))}),[]);return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{className:"user-profile-img-container",children:[r&&(0,kt.jsx)("div",{className:"active-icon active"}),(0,kt.jsx)("div",{className:"user-profile-img ".concat(1==i?"has-story":""),children:o?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{"data-id":u,onClick:l,children:(0,kt.jsx)("img",{src:t,alt:""})})}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{"data-id":u,onClick:l,children:[" ",(0,kt.jsx)("img",{src:"https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png",alt:""})]})})})]})})};function Bn(e,t){return function(){return e.apply(t,arguments)}}const{toString:Vn}=Object.prototype,{getPrototypeOf:zn}=Object,{iterator:Wn,toStringTag:Gn}=Symbol,Hn=(e=>t=>{const n=Vn.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Yn=e=>(e=e.toLowerCase(),t=>Hn(t)===e),qn=e=>t=>typeof t===e,{isArray:Kn}=Array,Xn=qn("undefined");const Qn=Yn("ArrayBuffer");const Jn=qn("string"),Zn=qn("function"),$n=qn("number"),er=e=>null!==e&&"object"===typeof e,tr=e=>{if("object"!==Hn(e))return!1;const t=zn(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Gn in e)&&!(Wn in e)},nr=Yn("Date"),rr=Yn("File"),ir=Yn("Blob"),ar=Yn("FileList"),or=Yn("URLSearchParams"),[sr,cr,ur,lr]=["ReadableStream","Request","Response","Headers"].map(Yn);function dr(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),Kn(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),a=r.length;let o;for(n=0;n<a;n++)o=r[n],t.call(null,e[o],o,e)}}function fr(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const hr="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,pr=e=>!Xn(e)&&e!==hr;const mr=(gr="undefined"!==typeof Uint8Array&&zn(Uint8Array),e=>gr&&e instanceof gr);var gr;const vr=Yn("HTMLFormElement"),yr=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),br=Yn("RegExp"),_r=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};dr(n,((n,i)=>{let a;!1!==(a=t(n,i,e))&&(r[i]=a||n)})),Object.defineProperties(e,r)};const wr=Yn("AsyncFunction"),Er=(Sr="function"===typeof setImmediate,Cr=Zn(hr.postMessage),Sr?setImmediate:Cr?((e,t)=>(hr.addEventListener("message",(n=>{let{source:r,data:i}=n;r===hr&&i===e&&t.length&&t.shift()()}),!1),n=>{t.push(n),hr.postMessage(e,"*")}))("axios@".concat(Math.random()),[]):e=>setTimeout(e));var Sr,Cr;const xr="undefined"!==typeof queueMicrotask?queueMicrotask.bind(hr):"undefined"!==typeof process&&process.nextTick||Er,Tr={isArray:Kn,isArrayBuffer:Qn,isBuffer:function(e){return null!==e&&!Xn(e)&&null!==e.constructor&&!Xn(e.constructor)&&Zn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||Zn(e.append)&&("formdata"===(t=Hn(e))||"object"===t&&Zn(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Qn(e.buffer),t},isString:Jn,isNumber:$n,isBoolean:e=>!0===e||!1===e,isObject:er,isPlainObject:tr,isReadableStream:sr,isRequest:cr,isResponse:ur,isHeaders:lr,isUndefined:Xn,isDate:nr,isFile:rr,isBlob:ir,isRegExp:br,isFunction:Zn,isStream:e=>er(e)&&Zn(e.pipe),isURLSearchParams:or,isTypedArray:mr,isFileList:ar,forEach:dr,merge:function e(){const{caseless:t}=pr(this)&&this||{},n={},r=(r,i)=>{const a=t&&fr(n,i)||i;tr(n[a])&&tr(r)?n[a]=e(n[a],r):tr(r)?n[a]=e({},r):Kn(r)?n[a]=r.slice():n[a]=r};for(let i=0,a=arguments.length;i<a;i++)arguments[i]&&dr(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return dr(t,((t,r)=>{n&&Zn(t)?e[r]=Bn(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,a,o;const s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)o=i[a],r&&!r(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==n&&zn(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Hn,kindOfTest:Yn,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(Kn(e))return e;let t=e.length;if(!$n(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Wn]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:vr,hasOwnProperty:yr,hasOwnProp:yr,reduceDescriptors:_r,freezeMethods:e=>{_r(e,((t,n)=>{if(Zn(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];Zn(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return Kn(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:fr,global:hr,isContextDefined:pr,isSpecCompliantForm:function(e){return!!(e&&Zn(e.append)&&"FormData"===e[Gn]&&e[Wn])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(er(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=Kn(e)?[]:{};return dr(e,((e,t)=>{const a=n(e,r+1);!Xn(a)&&(i[t]=a)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:wr,isThenable:e=>e&&(er(e)||Zn(e))&&Zn(e.then)&&Zn(e.catch),setImmediate:Er,asap:xr,isIterable:e=>null!=e&&Zn(e[Wn])};function Rr(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}Tr.inherits(Rr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Tr.toJSONObject(this.config),code:this.code,status:this.status}}});const Ir=Rr.prototype,Nr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{Nr[e]={value:e}})),Object.defineProperties(Rr,Nr),Object.defineProperty(Ir,"isAxiosError",{value:!0}),Rr.from=(e,t,n,r,i,a)=>{const o=Object.create(Ir);return Tr.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),Rr.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,a&&Object.assign(o,a),o};const Ar=Rr;function kr(e){return Tr.isPlainObject(e)||Tr.isArray(e)}function Dr(e){return Tr.endsWith(e,"[]")?e.slice(0,-2):e}function Mr(e,t,n){return e?e.concat(t).map((function(e,t){return e=Dr(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const Lr=Tr.toFlatObject(Tr,{},null,(function(e){return/^is[A-Z]/.test(e)}));const Or=function(e,t,n){if(!Tr.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Tr.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!Tr.isUndefined(t[e])}))).metaTokens,i=n.visitor||u,a=n.dots,o=n.indexes,s=(n.Blob||"undefined"!==typeof Blob&&Blob)&&Tr.isSpecCompliantForm(t);if(!Tr.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(Tr.isDate(e))return e.toISOString();if(!s&&Tr.isBlob(e))throw new Ar("Blob is not supported. Use a Buffer instead.");return Tr.isArrayBuffer(e)||Tr.isTypedArray(e)?s&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,i){let s=e;if(e&&!i&&"object"===typeof e)if(Tr.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(Tr.isArray(e)&&function(e){return Tr.isArray(e)&&!e.some(kr)}(e)||(Tr.isFileList(e)||Tr.endsWith(n,"[]"))&&(s=Tr.toArray(e)))return n=Dr(n),s.forEach((function(e,r){!Tr.isUndefined(e)&&null!==e&&t.append(!0===o?Mr([n],r,a):null===o?n:n+"[]",c(e))})),!1;return!!kr(e)||(t.append(Mr(i,n,a),c(e)),!1)}const l=[],d=Object.assign(Lr,{defaultVisitor:u,convertValue:c,isVisitable:kr});if(!Tr.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!Tr.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),Tr.forEach(n,(function(n,a){!0===(!(Tr.isUndefined(n)||null===n)&&i.call(t,n,Tr.isString(a)?a.trim():a,r,d))&&e(n,r?r.concat(a):[a])})),l.pop()}}(e),t};function Pr(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function jr(e,t){this._pairs=[],e&&Or(e,this,t)}const Fr=jr.prototype;Fr.append=function(e,t){this._pairs.push([e,t])},Fr.toString=function(e){const t=e?function(t){return e.call(this,t,Pr)}:Pr;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const Ur=jr;function Br(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Vr(e,t,n){if(!t)return e;const r=n&&n.encode||Br;Tr.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let a;if(a=i?i(t,n):Tr.isURLSearchParams(t)?t.toString():new Ur(t,n).toString(r),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}const zr=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Tr.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},Wr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Gr={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Ur,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},Hr="undefined"!==typeof window&&"undefined"!==typeof document,Yr="object"===typeof navigator&&navigator||void 0,qr=Hr&&(!Yr||["ReactNative","NativeScript","NS"].indexOf(Yr.product)<0),Kr="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,Xr=Hr&&window.location.href||"http://localhost",Qr=d(d({},e),Gr);const Jr=function(e){function t(e,n,r,i){let a=e[i++];if("__proto__"===a)return!0;const o=Number.isFinite(+a),s=i>=e.length;if(a=!a&&Tr.isArray(r)?r.length:a,s)return Tr.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!o;r[a]&&Tr.isObject(r[a])||(r[a]=[]);return t(e,n,r[a],i)&&Tr.isArray(r[a])&&(r[a]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let a;for(r=0;r<i;r++)a=n[r],t[a]=e[a];return t}(r[a])),!o}if(Tr.isFormData(e)&&Tr.isFunction(e.entries)){const n={};return Tr.forEachEntry(e,((e,r)=>{t(function(e){return Tr.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null};const Zr={transitional:Wr,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Tr.isObject(e);i&&Tr.isHTMLForm(e)&&(e=new FormData(e));if(Tr.isFormData(e))return r?JSON.stringify(Jr(e)):e;if(Tr.isArrayBuffer(e)||Tr.isBuffer(e)||Tr.isStream(e)||Tr.isFile(e)||Tr.isBlob(e)||Tr.isReadableStream(e))return e;if(Tr.isArrayBufferView(e))return e.buffer;if(Tr.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Or(e,new Qr.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return Qr.isNode&&Tr.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=Tr.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Or(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(Tr.isString(e))try{return(t||JSON.parse)(e),Tr.trim(e)}catch(Vc){if("SyntaxError"!==Vc.name)throw Vc}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||Zr.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(Tr.isResponse(e)||Tr.isReadableStream(e))return e;if(e&&Tr.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(Vc){if(n){if("SyntaxError"===Vc.name)throw Ar.from(Vc,Ar.ERR_BAD_RESPONSE,this,null,this.response);throw Vc}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qr.classes.FormData,Blob:Qr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Tr.forEach(["delete","get","head","post","put","patch"],(e=>{Zr.headers[e]={}}));const $r=Zr,ei=Tr.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ti=Symbol("internals");function ni(e){return e&&String(e).trim().toLowerCase()}function ri(e){return!1===e||null==e?e:Tr.isArray(e)?e.map(ri):String(e)}function ii(e,t,n,r,i){return Tr.isFunction(r)?r.call(this,t,n):(i&&(t=n),Tr.isString(t)?Tr.isString(r)?-1!==t.indexOf(r):Tr.isRegExp(r)?r.test(t):void 0:void 0)}class ai{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=ni(t);if(!i)throw new Error("header name must be a non-empty string");const a=Tr.findKey(r,i);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=ri(e))}const a=(e,t)=>Tr.forEach(e,((e,n)=>i(e,n,t)));if(Tr.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(Tr.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))a((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&ei[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t);else if(Tr.isObject(e)&&Tr.isIterable(e)){let n,r,i={};for(const t of e){if(!Tr.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[r=t[0]]=(n=i[r])?Tr.isArray(n)?[...n,t[1]]:[n,t[1]]:t[1]}a(i,t)}else null!=e&&i(t,e,n);return this}get(e,t){if(e=ni(e)){const n=Tr.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(Tr.isFunction(t))return t.call(this,e,n);if(Tr.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ni(e)){const n=Tr.findKey(this,e);return!(!n||void 0===this[n]||t&&!ii(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=ni(e)){const i=Tr.findKey(n,e);!i||t&&!ii(0,n[i],i,t)||(delete n[i],r=!0)}}return Tr.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!ii(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return Tr.forEach(this,((r,i)=>{const a=Tr.findKey(n,i);if(a)return t[a]=ri(r),void delete t[i];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):String(i).trim();o!==i&&delete t[i],t[o]=ri(r),n[o]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return Tr.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&Tr.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[ti]=this[ti]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=ni(e);t[r]||(!function(e,t){const n=Tr.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return Tr.isArray(e)?e.forEach(r):r(e),this}}ai.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Tr.reduceDescriptors(ai.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),Tr.freezeMethods(ai);const oi=ai;function si(e,t){const n=this||$r,r=t||n,i=oi.from(r.headers);let a=r.data;return Tr.forEach(e,(function(e){a=e.call(n,a,i.normalize(),t?t.status:void 0)})),i.normalize(),a}function ci(e){return!(!e||!e.__CANCEL__)}function ui(e,t,n){Ar.call(this,null==e?"canceled":e,Ar.ERR_CANCELED,t,n),this.name="CanceledError"}Tr.inherits(ui,Ar,{__CANCEL__:!0});const li=ui;function di(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Ar("Request failed with status code "+n.status,[Ar.ERR_BAD_REQUEST,Ar.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const fi=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,a=0,o=0;return t=void 0!==t?t:1e3,function(s){const c=Date.now(),u=r[o];i||(i=c),n[a]=s,r[a]=c;let l=o,d=0;for(;l!==a;)d+=n[l++],l%=e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),c-i<t)return;const f=u&&c-u;return f?Math.round(1e3*d/f):void 0}};const hi=function(e,t){let n,r,i=0,a=1e3/t;const o=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=a,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-i;for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];t>=a?o(c,e):(n=c,r||(r=setTimeout((()=>{r=null,o(n)}),a-t)))},()=>n&&o(n)]},pi=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const i=fi(50,250);return hi((n=>{const a=n.loaded,o=n.lengthComputable?n.total:void 0,s=a-r,c=i(s);r=a;e({loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:c||void 0,estimated:c&&o&&a<=o?(o-a)/c:void 0,event:n,lengthComputable:null!=o,[t?"download":"upload"]:!0})}),n)},mi=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},gi=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Tr.asap((()=>e(...n)))},vi=Qr.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,Qr.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(Qr.origin),Qr.navigator&&/(msie|trident)/i.test(Qr.navigator.userAgent)):()=>!0,yi=Qr.hasStandardBrowserEnv?{write(e,t,n,r,i,a){const o=[e+"="+encodeURIComponent(t)];Tr.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Tr.isString(r)&&o.push("path="+r),Tr.isString(i)&&o.push("domain="+i),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function bi(e,t,n){let r=!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t);return e&&(r||0==n)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const _i=e=>e instanceof oi?d({},e):e;function wi(e,t){t=t||{};const n={};function r(e,t,n,r){return Tr.isPlainObject(e)&&Tr.isPlainObject(t)?Tr.merge.call({caseless:r},e,t):Tr.isPlainObject(t)?Tr.merge({},t):Tr.isArray(t)?t.slice():t}function i(e,t,n,i){return Tr.isUndefined(t)?Tr.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function a(e,t){if(!Tr.isUndefined(t))return r(void 0,t)}function o(e,t){return Tr.isUndefined(t)?Tr.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,a){return a in t?r(n,i):a in e?r(void 0,n):void 0}const c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(e,t,n)=>i(_i(e),_i(t),0,!0)};return Tr.forEach(Object.keys(Object.assign({},e,t)),(function(r){const a=c[r]||i,o=a(e[r],t[r],r);Tr.isUndefined(o)&&a!==s||(n[r]=o)})),n}const Ei=e=>{const t=wi({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:a,xsrfCookieName:o,headers:s,auth:c}=t;if(t.headers=s=oi.from(s),t.url=Vr(bi(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&s.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),Tr.isFormData(r))if(Qr.hasStandardBrowserEnv||Qr.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(n=s.getContentType())){const[e,...t]=n?n.split(";").map((e=>e.trim())).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(Qr.hasStandardBrowserEnv&&(i&&Tr.isFunction(i)&&(i=i(t)),i||!1!==i&&vi(t.url))){const e=a&&o&&yi.read(o);e&&s.set(a,e)}return t},Si="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){const r=Ei(e);let i=r.data;const a=oi.from(r.headers).normalize();let o,s,c,u,l,{responseType:d,onUploadProgress:f,onDownloadProgress:h}=r;function p(){u&&u(),l&&l(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let m=new XMLHttpRequest;function g(){if(!m)return;const r=oi.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());di((function(e){t(e),p()}),(function(e){n(e),p()}),{data:d&&"text"!==d&&"json"!==d?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:r,config:e,request:m}),m=null}m.open(r.method.toUpperCase(),r.url,!0),m.timeout=r.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(g)},m.onabort=function(){m&&(n(new Ar("Request aborted",Ar.ECONNABORTED,e,m)),m=null)},m.onerror=function(){n(new Ar("Network Error",Ar.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const i=r.transitional||Wr;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new Ar(t,i.clarifyTimeoutError?Ar.ETIMEDOUT:Ar.ECONNABORTED,e,m)),m=null},void 0===i&&a.setContentType(null),"setRequestHeader"in m&&Tr.forEach(a.toJSON(),(function(e,t){m.setRequestHeader(t,e)})),Tr.isUndefined(r.withCredentials)||(m.withCredentials=!!r.withCredentials),d&&"json"!==d&&(m.responseType=r.responseType),h&&([c,l]=pi(h,!0),m.addEventListener("progress",c)),f&&m.upload&&([s,u]=pi(f),m.upload.addEventListener("progress",s),m.upload.addEventListener("loadend",u)),(r.cancelToken||r.signal)&&(o=t=>{m&&(n(!t||t.type?new li(null,e,m):t),m.abort(),m=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);v&&-1===Qr.protocols.indexOf(v)?n(new Ar("Unsupported protocol "+v+":",Ar.ERR_BAD_REQUEST,e)):m.send(i||null)}))},Ci=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,o();const t=e instanceof Error?e:this.reason;r.abort(t instanceof Ar?t:new li(t instanceof Error?t.message:t))}};let a=t&&setTimeout((()=>{a=null,i(new Ar("timeout ".concat(t," of ms exceeded"),Ar.ETIMEDOUT))}),t);const o=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)})),e=null)};e.forEach((e=>e.addEventListener("abort",i)));const{signal:s}=r;return s.unsubscribe=()=>Tr.asap(o),s}};function xi(e,t){this.v=e,this.k=t}function Ti(e){return function(){return new Ri(e.apply(this,arguments))}}function Ri(e){var t,n;function r(t,n){try{var a=e[t](n),o=a.value,s=o instanceof xi;Promise.resolve(s?o.v:o).then((function(n){if(s){var c="return"===t?"return":"next";if(!o.k||n.done)return r(c,n);n=e[c](n).value}i(a.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise((function(a,o){var s={key:e,arg:i,resolve:a,reject:o,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function Ii(e){return new xi(e,0)}function Ni(e){var t={},n=!1;function r(t,r){return n=!0,r=new Promise((function(n){n(e[t](r))})),{done:!1,value:new xi(r,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}function Ai(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new ki(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function ki(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return ki=function(e){this.s=e,this.n=e.next},ki.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new ki(e)}Ri.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Ri.prototype.next=function(e){return this._invoke("next",e)},Ri.prototype.throw=function(e){return this._invoke("throw",e)},Ri.prototype.return=function(e){return this._invoke("return",e)};const Di=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},Mi=function(){var e=Ti((function*(e,t){var n,r=!1,i=!1;try{for(var a,o=Ai(Li(e));r=!(a=yield Ii(o.next())).done;r=!1){const e=a.value;yield*Ni(Ai(Di(e,t)))}}catch(s){i=!0,n=s}finally{try{r&&null!=o.return&&(yield Ii(o.return()))}finally{if(i)throw n}}}));return function(t,n){return e.apply(this,arguments)}}(),Li=function(){var e=Ti((function*(e){if(e[Symbol.asyncIterator])return void(yield*Ni(Ai(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield Ii(t.read());if(e)break;yield n}}finally{yield Ii(t.cancel())}}));return function(t){return e.apply(this,arguments)}}(),Oi=(e,t,n,r)=>{const i=Mi(e,t);let a,o=0,s=e=>{a||(a=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return s(),void e.close();let a=r.byteLength;if(n){let e=o+=a;n(e)}e.enqueue(new Uint8Array(r))}catch(t){throw s(t),t}},cancel:e=>(s(e),i.return())},{highWaterMark:2})},Pi="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,ji=Pi&&"function"===typeof ReadableStream,Fi=Pi&&("function"===typeof TextEncoder?(Ui=new TextEncoder,e=>Ui.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var Ui;const Bi=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(Vc){return!1}},Vi=ji&&Bi((()=>{let e=!1;const t=new Request(Qr.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),zi=ji&&Bi((()=>Tr.isReadableStream(new Response("").body))),Wi={stream:zi&&(e=>e.body)};var Gi;Pi&&(Gi=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!Wi[e]&&(Wi[e]=Tr.isFunction(Gi[e])?t=>t[e]():(t,n)=>{throw new Ar("Response type '".concat(e,"' is not supported"),Ar.ERR_NOT_SUPPORT,n)})})));const Hi=async(e,t)=>{const n=Tr.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(Tr.isBlob(e))return e.size;if(Tr.isSpecCompliantForm(e)){const t=new Request(Qr.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Tr.isArrayBufferView(e)||Tr.isArrayBuffer(e)?e.byteLength:(Tr.isURLSearchParams(e)&&(e+=""),Tr.isString(e)?(await Fi(e)).byteLength:void 0)})(t):n},Yi=Pi&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:a,timeout:o,onDownloadProgress:s,onUploadProgress:c,responseType:u,headers:l,withCredentials:f="same-origin",fetchOptions:h}=Ei(e);u=u?(u+"").toLowerCase():"text";let p,m=Ci([i,a&&a.toAbortSignal()],o);const g=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let v;try{if(c&&Vi&&"get"!==n&&"head"!==n&&0!==(v=await Hi(l,r))){let e,n=new Request(t,{method:"POST",body:r,duplex:"half"});if(Tr.isFormData(r)&&(e=n.headers.get("content-type"))&&l.setContentType(e),n.body){const[e,t]=mi(v,pi(gi(c)));r=Oi(n.body,65536,e,t)}}Tr.isString(f)||(f=f?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,d(d({},h),{},{signal:m,method:n.toUpperCase(),headers:l.normalize().toJSON(),body:r,duplex:"half",credentials:i?f:void 0}));let a=await fetch(p);const o=zi&&("stream"===u||"response"===u);if(zi&&(s||o&&g)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=a[t]}));const t=Tr.toFiniteNumber(a.headers.get("content-length")),[n,r]=s&&mi(t,pi(gi(s),!0))||[];a=new Response(Oi(a.body,65536,n,(()=>{r&&r(),g&&g()})),e)}u=u||"text";let y=await Wi[Tr.findKey(Wi,u)||"text"](a,e);return!o&&g&&g(),await new Promise(((t,n)=>{di(t,n,{data:y,headers:oi.from(a.headers),status:a.status,statusText:a.statusText,config:e,request:p})}))}catch(y){if(g&&g(),y&&"TypeError"===y.name&&/Load failed|fetch/i.test(y.message))throw Object.assign(new Ar("Network Error",Ar.ERR_NETWORK,e,p),{cause:y.cause||y});throw Ar.from(y,y&&y.code,e,p)}}),qi={http:null,xhr:Si,fetch:Yi};Tr.forEach(qi,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(Vc){}Object.defineProperty(e,"adapterName",{value:t})}}));const Ki=e=>"- ".concat(e),Xi=e=>Tr.isFunction(e)||null===e||!1===e,Qi=e=>{e=Tr.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let a=0;a<t;a++){let t;if(n=e[a],r=n,!Xi(n)&&(r=qi[(t=String(n)).toLowerCase()],void 0===r))throw new Ar("Unknown adapter '".concat(t,"'"));if(r)break;i[t||"#"+a]=r}if(!r){const e=Object.entries(i).map((e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));let n=t?e.length>1?"since :\n"+e.map(Ki).join("\n"):" "+Ki(e[0]):"as no adapter specified";throw new Ar("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return r};function Ji(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new li(null,e)}function Zi(e){Ji(e),e.headers=oi.from(e.headers),e.data=si.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Qi(e.adapter||$r.adapter)(e).then((function(t){return Ji(e),t.data=si.call(e,e.transformResponse,t),t.headers=oi.from(t.headers),t}),(function(t){return ci(t)||(Ji(e),t&&t.response&&(t.response.data=si.call(e,e.transformResponse,t.response),t.response.headers=oi.from(t.response.headers))),Promise.reject(t)}))}const $i="1.9.0",ea={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{ea[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const ta={};ea.transitional=function(e,t,n){function r(e,t){return"[Axios v1.9.0] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,a)=>{if(!1===e)throw new Ar(r(i," has been removed"+(t?" in "+t:"")),Ar.ERR_DEPRECATED);return t&&!ta[i]&&(ta[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,a)}},ea.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};const na={assertOptions:function(e,t,n){if("object"!==typeof e)throw new Ar("options must be an object",Ar.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const a=r[i],o=t[a];if(o){const t=e[a],n=void 0===t||o(t,a,e);if(!0!==n)throw new Ar("option "+a+" must be "+n,Ar.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Ar("Unknown option "+a,Ar.ERR_BAD_OPTION)}},validators:ea},ra=na.validators;class ia{constructor(e){this.defaults=e||{},this.interceptors={request:new zr,response:new zr}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{n.stack?t&&!String(n.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(n.stack+="\n"+t):n.stack=t}catch(Vc){}}throw n}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=wi(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&na.assertOptions(n,{silentJSONParsing:ra.transitional(ra.boolean),forcedJSONParsing:ra.transitional(ra.boolean),clarifyTimeoutError:ra.transitional(ra.boolean)},!1),null!=r&&(Tr.isFunction(r)?t.paramsSerializer={serialize:r}:na.assertOptions(r,{encode:ra.function,serialize:ra.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),na.assertOptions(t,{baseUrl:ra.spelling("baseURL"),withXsrfToken:ra.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&Tr.merge(i.common,i[t.method]);i&&Tr.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=oi.concat(a,i);const o=[];let s=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));const c=[];let u;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let l,d=0;if(!s){const e=[Zi.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,c),l=e.length,u=Promise.resolve(t);d<l;)u=u.then(e[d++],e[d++]);return u}l=o.length;let f=t;for(d=0;d<l;){const e=o[d++],t=o[d++];try{f=e(f)}catch(h){t.call(this,h);break}}try{u=Zi.call(this,f)}catch(h){return Promise.reject(h)}for(d=0,l=c.length;d<l;)u=u.then(c[d++],c[d++]);return u}getUri(e){return Vr(bi((e=wi(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}Tr.forEach(["delete","get","head","options"],(function(e){ia.prototype[e]=function(t,n){return this.request(wi(n||{},{method:e,url:t,data:(n||{}).data}))}})),Tr.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(wi(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}ia.prototype[e]=t(),ia.prototype[e+"Form"]=t(!0)}));const aa=ia;class oa{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new li(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;const t=new oa((function(t){e=t}));return{token:t,cancel:e}}}const sa=oa;const ca={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ca).forEach((e=>{let[t,n]=e;ca[n]=t}));const ua=ca;const la=function e(t){const n=new aa(t),r=Bn(aa.prototype.request,n);return Tr.extend(r,aa.prototype,n,{allOwnKeys:!0}),Tr.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(wi(t,n))},r}($r);la.Axios=aa,la.CanceledError=li,la.CancelToken=sa,la.isCancel=ci,la.VERSION=$i,la.toFormData=Or,la.AxiosError=Ar,la.Cancel=la.CanceledError,la.all=function(e){return Promise.all(e)},la.spread=function(e){return function(t){return e.apply(null,t)}},la.isAxiosError=function(e){return Tr.isObject(e)&&!0===e.isAxiosError},la.mergeConfig=wi,la.AxiosHeaders=oi,la.formToJSON=e=>Jr(Tr.isHTMLForm(e)?new FormData(e):e),la.getAdapter=Qi,la.HttpStatusCode=ua,la.default=la;const da=la;let fa=localStorage.getItem("user")||"{}",ha=JSON.parse(fa).accessToken;const pa=da.create({baseURL:"https://connect-server-y1ku.onrender.com/api/",headers:{Authorization:"".concat(ha),"User-Agent":"MyCustomUserAgent","Access-Control-Allow-Origin":"*"}}),ma="LOAD_POSTS",ga="ADD_POST",va=e=>({type:ga,payload:e});const ya=e=>{let{setPosts:t=null}=e,n=En((e=>e.profile)),r=n._id,i=kn(),[o,s]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),l=e=>{s(!0)},f=()=>{s(!1)};const h={caption:"",attachments:null,urls:null,location:"",feelings:""};let[p,m]=(0,a.useState)(h),[g,v]=(0,a.useState)(!1);const[y,b]=(0,a.useState)(!1);(0,a.useEffect)((()=>{pa.get("/profile/hasStory",{params:{profileId:r}}).then((e=>{if(200==e.status){let t=e.data.hasStory;"yes"==t&&b(!0),"no"==t&&b(!1)}}))}),[p]);var _=(e=>{const[t,n]=(0,a.useState)(window.matchMedia(e).matches);return(0,a.useEffect)((()=>{const t=window.matchMedia(e),r=e=>n(e.matches);return t.addEventListener("change",r),()=>t.removeEventListener("change",r)}),[e]),t})("(max-width: 768px)");let w=n.user&&n.user.firstName+" "+n.user.surname||"",E="What's On Your Mind "+w+"?",S=(0,a.useCallback)((e=>{let t=e.target.value,n=e.target.name;0==g&&"caption"==n&&v("caption"),m((e=>d(d({},e),{},{[n]:t})))}),[p]),C=(0,a.useCallback)((e=>{let t=e.currentTarget;m(d(d({},p),{},{urls:"https://res.cloudinary.com/dz88yjerw/image/upload/v1743092084/i5lcu63atrbkpcy6oqam.gif"})),Pn()(t).parents(".cpm-attachment-upload").slideUp(),Pn()(t).parents(".cpm-attachment-upload").siblings(".cpm-attachment-preview").slideDown();let n=e.target.files[0];x(n.type,n)}),[p]),x=async(e,t)=>{u(!0);try{let i=e.split("/")[0];switch(v(i),i){case"image":let e=new FormData;e.append("image",t),e.append("type","image/png");let a=await pa.post("/upload/",e,{headers:{"content-type":"multipart/form-data"}});if(200==a.status){u(!1);var n=a.data.secure_url;m((e=>d(d({},e),{},{urls:n,type:i})))}break;case"video":let o=new FormData;o.append("attachment",t),o.append("type","video/mp4");let s=await pa.post("/upload/video",o,{headers:{"content-type":"multipart/form-data"}});if(200==s.status){var r=s.data.secure_url;u(!1),m((e=>d(d({},e),{},{type:i,urls:r})))}}}catch(i){console.log("Error uploading attachment:",i),u(!1)}},T=(0,a.useCallback)((async e=>{e.preventDefault(),s(!1);try{switch(p.type){case"image":e.target.classList.add("added");let n=new FormData;n.append("caption",p.caption),n.append("photos",p.urls),n.append("feelings",p.feelings),n.append("location",p.location);let r=await pa.post("/post/create/",n,{headers:{"content-type":"multipart/form-data"}});200===r.status&&(i(va(r.data.post)),m(h),t&&t((e=>[r.data.post,...e])),s(!1));break;case"video":e.target.classList.add("added");let a=new FormData;a.append("caption",p.caption),a.append("photos",p.urls),a.append("feelings",p.feelings),a.append("location",p.location);let o=await pa.post("/post/create/",a,{headers:{"content-type":"multipart/form-data"}});200===o.status&&(m(h),i(va(o.data.post)),t&&t((e=>[o.data.post,...e])),s(!1));break;default:let c=new FormData;c.append("caption",p.caption),c.append("photos",p.urls),c.append("feelings",p.feelings),c.append("location",p.location);let u=await pa.post("/post/create/",c,{headers:{"content-type":"multipart/form-data"}});200===u.status&&(m(h),i(va(u.data.post)),t&&t((e=>[u.data.post,...e])),s(!1))}}catch(n){console.log("Error creating post:",n)}}),[p]);return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{className:"nf-create-post",children:[(0,kt.jsxs)("div",{className:"top",children:[(0,kt.jsx)("div",{className:"profile-pic",children:(0,kt.jsx)(Un,{profilePic:n.profilePic,hasStory:y,profile:n._id})}),(0,kt.jsx)("div",{onClick:l,className:"cp-field",children:(0,kt.jsx)("input",{readOnly:!0,placeholder:E,className:"cp-input"})})]}),(0,kt.jsx)("div",{className:"bottom",children:(0,kt.jsxs)("ul",{onClick:l,className:"button-container",children:[(0,kt.jsxs)("li",{className:"photo-button",children:[(0,kt.jsx)("div",{className:"button-icon"}),(0,kt.jsx)("div",{className:"button-text",children:"Photo/video"})]}),(0,kt.jsxs)("li",{className:"live-button",children:[(0,kt.jsx)("div",{className:"button-icon"}),(0,kt.jsx)("div",{className:"button-text",children:"Live Video"})]})]})}),(0,kt.jsxs)(jn,{isOpen:o,id:"create-post-modal",onRequestClose:f,title:"Create A Post",style:{width:_?"95%":"600px"},children:[(0,kt.jsxs)("div",{className:"modal-header",children:[(0,kt.jsx)("div",{className:"modal-title",children:"Create a Post"}),(0,kt.jsx)("div",{onClick:f,className:"modal-close-btn",children:(0,kt.jsx)("i",{className:"far fa-times"})})]}),(0,kt.jsx)("div",{className:"modal-body",children:(0,kt.jsxs)("div",{className:"cp-modal-container",children:[(0,kt.jsxs)("div",{className:"cpm-header",children:[(0,kt.jsx)("div",{className:"cpm-profilePic",children:(0,kt.jsx)(Un,{profilePic:n.profilePic,hasStory:y,profile:n._id})}),(0,kt.jsx)("div",{className:"cpm-username",children:(0,kt.jsx)("h3",{children:w})}),(0,kt.jsx)("div",{className:"cpm-feelings-container ml-2",children:(0,kt.jsxs)("select",{name:"feelings",onChange:S.bind(void 0),className:"form-control",children:[(0,kt.jsx)("option",{value:"0",children:"Select Feelings"}),(0,kt.jsx)("option",{value:"funny",children:"Funny"}),(0,kt.jsx)("option",{value:"lovely",children:"Lovely"}),(0,kt.jsx)("option",{value:"sad",children:"Sad"})]})}),(0,kt.jsx)("div",{className:"cpm-location-container",children:(0,kt.jsx)("input",{type:"text",name:"location",onChange:S,className:"form-control",placeholder:"Location...."})})]}),(0,kt.jsxs)("form",{className:"cpm-form",onSubmit:e=>{e.preventDefault()},children:[(0,kt.jsx)("div",{className:"cpm-form-text",children:(0,kt.jsx)("textarea",{name:"caption",onChange:S,placeholder:E,className:"cpm-form-text-input",value:p.caption})}),(0,kt.jsxs)("div",{className:"cpm-attachment-control",children:[(0,kt.jsxs)("div",{className:"cpm-attachment-preview",children:["video"===p.type&&(0,kt.jsx)("video",{style:{width:"100%"},src:p.urls}),"image"===p.type&&(0,kt.jsx)("img",{src:p.urls&&p.urls,alt:"attachment preview"})]}),(0,kt.jsxs)("div",{className:"cpm-attachment-upload",children:[(0,kt.jsxs)("div",{className:"cpm-attachment-upload-overlay",children:[(0,kt.jsx)("span",{className:"plus-icon"}),(0,kt.jsx)("span",{className:"overlay-text",children:"Add Photos/Videos"})]}),(0,kt.jsx)("input",{onChange:C,name:"photos_vidoes",type:"file"})]})]}),(0,kt.jsxs)("div",{className:"cpm-attachment",children:[(0,kt.jsx)("span",{className:"cpm-button-text",children:"Add to your post"}),(0,kt.jsx)("div",{className:"post-meta-buttons",children:(0,kt.jsx)("div",{onClick:e=>{let t=e.currentTarget;Pn()(t).parents(".cpm-attachment").siblings(".cpm-attachment-control").slideToggle()},className:"attachment-button-file"})})]}),(0,kt.jsx)("div",{className:"cpm-submit-button",children:(0,kt.jsxs)("button",{onClick:T.bind(void 0),className:"button",disabled:c,type:"submit",children:["  ",1==c?"Media Uploading....":"Post Now","  "]})})]})]})})]})]})})};const ba=e=>{let{children:t,style:n,className:r}=e;return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)("div",{style:d({zIndex:"999",position:"absolute",boxShadow:"1px #888",display:"none",padding:"10px"},n),className:r,children:t})})};const _a=()=>{let e=En((e=>e.profile)),t=qe();const n="/"+JSON.parse(localStorage.getItem("user")||"{}").profile+"/";let r=(0,a.useCallback)((e=>{t(n)}),[Date.now()]);return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)("div",{id:"left-sidebar",className:"text-left",children:(0,kt.jsxs)("ul",{className:"ls-nav-menu",children:[(0,kt.jsx)("li",{children:(0,kt.jsx)("div",{onClick:r,className:"text-decoration-none",children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"ls-profile-img",children:(0,kt.jsx)(Un,{profilePic:e.profilePic,profile:e._id})}),(0,kt.jsxs)("div",{className:"ls-text user-name",children:[e.user&&e.user.firstName," ",e.user&&e.user.surname]})]})})}),(0,kt.jsx)("li",{children:(0,kt.jsx)(Tt,{to:"/friends/",className:"text-decoration-none",children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"ls-icon lsi-friends"}),(0,kt.jsx)("div",{className:"ls-text",children:"Find Friends"})]})})}),(0,kt.jsx)("li",{children:(0,kt.jsx)(Tt,{to:"/downloads/",className:"text-decoration-none",children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"ls-icon lsi-downloads"}),(0,kt.jsx)("div",{className:"ls-text",children:"Saved Videos"})]})})}),(0,kt.jsx)("li",{children:(0,kt.jsx)(Tt,{to:"/downloads/",className:"text-decoration-none",children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"ls-icon lsi-group"}),(0,kt.jsx)("div",{className:"ls-text",children:"Group"})]})})}),(0,kt.jsx)("li",{children:(0,kt.jsx)(Tt,{to:"/watch/",className:"text-decoration-none",children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"ls-icon lsi-watch"}),(0,kt.jsx)("div",{className:"ls-text",children:"Watch"})]})})}),(0,kt.jsx)("li",{children:(0,kt.jsx)(Tt,{to:"/marketplace/",className:"text-decoration-none",children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"ls-icon lsi-mp"}),(0,kt.jsx)("div",{className:"ls-text",children:"Marketplace"})]})})}),(0,kt.jsx)("li",{children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"ls-icon lsi-memo"}),(0,kt.jsx)("div",{className:"ls-text",children:"Memories"})]})}),(0,kt.jsx)("li",{children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"lsi-star"}),(0,kt.jsx)("div",{className:"ls-text",children:"Favourites"})]})}),(0,kt.jsx)("li",{children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"ls-icon lsi-pages"}),(0,kt.jsx)("div",{className:"ls-text",children:"Pages"})]})}),(0,kt.jsx)("li",{children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"ls-icon lsi-saved"}),(0,kt.jsx)("div",{className:"ls-text",children:"Saved"})]})}),(0,kt.jsx)("li",{children:(0,kt.jsxs)("div",{className:"ls-nav-menu-item",children:[(0,kt.jsx)("div",{className:"lsi-card"}),(0,kt.jsx)("div",{className:"ls-text",children:"Orders & Payments"})]})})]})})})},wa=()=>{const[e,t]=(0,a.useState)(window.matchMedia("(max-width: 768px)").matches);return(0,a.useEffect)((()=>{const e=window.matchMedia("(max-width: 768px)"),n=e=>t(e.matches);return e.addEventListener("change",n),()=>e.removeEventListener("change",n)}),[]),e};const Ea=()=>{let[e,t]=(0,a.useState)([]),[n,r]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1),[s,c]=(0,a.useState)(!1),[u,l]=(0,a.useState)(""),d=He(),f=wa(),h=qe();(0,a.useEffect)((()=>{c(!1)}),[d]);let p=e=>{c(!s)},m=()=>(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)("div",{onClick:p,className:"header-mm-button",style:{lineHeight:1},children:(0,kt.jsx)("i",{className:"fa fa-bars"})})});let g=()=>{f||(Pn()(".header-search-icon, .header-logo").hide(),Pn()(".header-search-back-container").fadeIn("slow"),Pn()(".header-search-icon, .header-logo-container").animate({left:"-10px",opacity:0},"fast"),Pn()("#header-search").css({width:"100%",display:"block"}))},v=(0,a.useCallback)((e=>{h(e.currentTarget.dataset.url)}),[]);function y(e){return e.split(/\s+/).slice(0,4).join(" ")}return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{className:"header-left",children:[(0,kt.jsx)("div",{className:"header-logo-container",children:(0,kt.jsx)(Tt,{to:"/",children:(0,kt.jsx)("img",{className:"header-logo",src:"https://programmerikram.com/wp-content/uploads/2025/05/ics_logo.png",alt:"logo"})})}),(0,kt.jsxs)("div",{className:"header-mobile-menu-button-container",children:[f&&(0,kt.jsx)(m,{}),s&&(0,kt.jsx)(ba,{className:"header-mm-dropdown",style:{top:"100%",left:0,width:"300px",zIndex:"999999",display:"block"},children:(0,kt.jsx)(_a,{})})]}),(0,kt.jsx)("div",{className:"header-search-back-container",children:(0,kt.jsx)("i",{onClick:e=>{o(!1)},className:"fal fa-arrow-left header-search-back-icon"})}),(0,kt.jsxs)("div",{className:"header-search-container ".concat(1==i?"active-mobile":""),children:[(0,kt.jsx)("i",{className:"fal fa-search header-search-icon",onClick:(e=>{f&&(o(!i),g())}).bind(void 0)}),(0,kt.jsx)("input",{value:u,onChange:e=>{l(e.target.value)},onBlur:()=>{if(f||(Pn()(".header-search-back-container").hide(),Pn()(".header-search-icon, .header-logo-container").animate({left:"0",opacity:1},"fast"),Pn()(".header-search-icon, .header-logo").fadeIn(),Pn()("#header-search").css({width:"auto",display:"block"})),u.length>0)return r(!0);r(!1)},onFocus:g,onKeyUp:(async e=>{if(u.length>0){let e=await pa.get("search/",{params:{input:u}});200===e.status&&(console.log("data",e.data),t(e.data),r(null!==e.data.users||null!==e.data.posts||null!==e.data.videos))}else t([]),r(!1)}).bind(void 0),id:"header-search",type:"search",placeholder:"Search ICS"}),n&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"header-search-results",children:[e.users.length>0&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"search-results-user",children:[(0,kt.jsx)("h3",{className:"search-result-title",children:"Users"}),(0,kt.jsx)("ul",{className:"search-results-list-container",children:e.users&&e.users.map(((e,t)=>(0,kt.jsx)("li",{className:"search-result-item",onClick:()=>{r(!1),o(!1)},children:(0,kt.jsxs)("div",{className:"item-container","data-url":"/".concat(e._id),onClick:v.bind(void 0),children:[(0,kt.jsx)("div",{className:"user-profile-pic",children:(0,kt.jsx)(Un,{profilePic:e.profilePic,profile:e._id})}),(0,kt.jsx)("div",{className:"user-details",children:e.fullName})]})},t)))})]})}),e.videos.length>0&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"search-results-videos",children:[(0,kt.jsx)("h3",{className:"search-result-title",children:"Videos"}),(0,kt.jsx)("ul",{className:"search-results-list-container",children:e.videos&&e.videos.map(((e,t)=>(0,kt.jsx)("li",{className:"search-result-item",onClick:()=>{r(!1),o(!1)},children:(0,kt.jsxs)("div",{className:"item-container","data-url":"/watch/".concat(e._id),onClick:v.bind(void 0),children:[(0,kt.jsx)("div",{className:"user-profile-pic",children:(0,kt.jsx)(Un,{profilePic:e.author.profilePic,profile:e.author._id})}),(0,kt.jsx)("div",{className:"user-details fs-6",children:y(e.caption)})]})},t)))})]})}),e.posts.length>0&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"search-results-posts",children:[(0,kt.jsx)("h3",{className:"search-result-title",children:"Posts"}),(0,kt.jsx)("ul",{className:"search-results-list-container",children:e.posts&&e.posts.map(((e,t)=>(0,kt.jsx)("li",{className:"search-result-item",onClick:()=>{r(!1),o(!1)},children:(0,kt.jsxs)("div",{className:"item-container","data-url":"/post/".concat(e._id),onClick:v.bind(void 0),children:[(0,kt.jsx)("div",{className:"user-profile-pic",children:(0,kt.jsx)(Un,{profilePic:e.author.profilePic,profile:e.author._id})}),(0,kt.jsx)("div",{className:"user-details",children:y(e.caption)})]})},t)))})]})})]})})]})]})})};const Sa=()=>{let e=He(),t=e=>{let t=e.currentTarget;Pn()(t).siblings().removeClass("active"),Pn()(t).addClass("active"),Pn()(".header-nav-menu-item").children().children().removeClass("primary-color fas"),Pn()(".header-nav-menu-item").children().children().addClass("fal"),Pn()(e.currentTarget).children().children().addClass("primary-color fas"),Pn()(e.currentTarget).children().children().removeClass("fal")};return(0,a.useEffect)((()=>{Pn()(".header-nav-menu-item.active").siblings().removeClass("active"),Pn()(".header-nav-menu-item.active").siblings().find("i").removeClass("primary-color"),Pn()(".header-nav-menu-item.active").siblings().find("i").removeClass("fas"),Pn()(".header-nav-menu-item.active").siblings().find("i").addClass("fal")}),[e]),(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)("div",{className:"header-nav-menu-container",children:(0,kt.jsxs)("ul",{className:"header-nav-menu",children:[(0,kt.jsx)(Rt,{to:"/",exact:"true",onClick:t,className:"header-nav-menu-item",title:"Home",children:(0,kt.jsx)("div",{className:"header-nav-menu-icon",children:(0,kt.jsx)("i",{className:"fal fa-home-alt "})})}),(0,kt.jsx)(Rt,{to:"/friends",onClick:t,className:"header-nav-menu-item",title:"Friends",children:(0,kt.jsx)("div",{className:"header-nav-menu-icon",children:(0,kt.jsx)("i",{className:"fal fa-user-friends "})})}),(0,kt.jsx)(Rt,{to:"/watch",onClick:t,className:"header-nav-menu-item",title:"Videos",children:(0,kt.jsx)("div",{className:"header-nav-menu-icon",children:(0,kt.jsx)("i",{className:"fal fa-play-circle"})})}),(0,kt.jsx)(Rt,{to:"/message",onClick:t,className:"header-nav-menu-item",title:"Marketplace",children:(0,kt.jsx)("div",{className:"header-nav-menu-icon",children:(0,kt.jsx)("i",{className:"fal fa-envelope"})})}),(0,kt.jsx)(Rt,{to:"/downloads",onClick:t,className:"header-nav-menu-item",title:"Story",children:(0,kt.jsx)("div",{className:"header-nav-menu-icon",children:(0,kt.jsx)("i",{className:"fas fa-download"})})})]})})})};var Ca=n(1747),xa=n.n(Ca);const Ta=Object.create(null);Ta.open="0",Ta.close="1",Ta.ping="2",Ta.pong="3",Ta.message="4",Ta.upgrade="5",Ta.noop="6";const Ra=Object.create(null);Object.keys(Ta).forEach((e=>{Ra[Ta[e]]=e}));const Ia={type:"error",data:"parser error"},Na="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Aa="function"===typeof ArrayBuffer,ka=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Da=(e,t,n)=>{let{type:r,data:i}=e;return Na&&i instanceof Blob?t?n(i):Ma(i,n):Aa&&(i instanceof ArrayBuffer||ka(i))?t?n(i):Ma(new Blob([i]),n):n(Ta[r]+(i||""))},Ma=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function La(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Oa;const Pa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ja="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let n=0;n<64;n++)ja[Pa.charCodeAt(n)]=n;const Fa="function"===typeof ArrayBuffer,Ua=(e,t)=>{if("string"!==typeof e)return{type:"message",data:Va(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:Ba(e.substring(1),t)};return Ra[n]?e.length>1?{type:Ra[n],data:e.substring(1)}:{type:Ra[n]}:Ia},Ba=(e,t)=>{if(Fa){const n=(e=>{let t,n,r,i,a,o=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const u=new ArrayBuffer(o),l=new Uint8Array(u);for(t=0;t<s;t+=4)n=ja[e.charCodeAt(t)],r=ja[e.charCodeAt(t+1)],i=ja[e.charCodeAt(t+2)],a=ja[e.charCodeAt(t+3)],l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|i>>2,l[c++]=(3&i)<<6|63&a;return u})(e);return Va(n,t)}return{base64:!0,data:e}},Va=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,za=String.fromCharCode(30);function Wa(){return new TransformStream({transform(e,t){!function(e,t){Na&&e.data instanceof Blob?e.data.arrayBuffer().then(La).then(t):Aa&&(e.data instanceof ArrayBuffer||ka(e.data))?t(La(e.data)):Da(e,!1,(e=>{Oa||(Oa=new TextEncoder),t(Oa.encode(e))}))}(e,(n=>{const r=n.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const e=new DataView(i.buffer);e.setUint8(0,126),e.setUint16(1,r)}else{i=new Uint8Array(9);const e=new DataView(i.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(r))}e.data&&"string"!==typeof e.data&&(i[0]|=128),t.enqueue(i),t.enqueue(n)}))}})}let Ga;function Ha(e){return e.reduce(((e,t)=>e+t.length),0)}function Ya(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let r=0;for(let i=0;i<t;i++)n[i]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function qa(e){if(e)return function(e){for(var t in qa.prototype)e[t]=qa.prototype[t];return e}(e)}qa.prototype.on=qa.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},qa.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},qa.prototype.off=qa.prototype.removeListener=qa.prototype.removeAllListeners=qa.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},qa.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t)}return this},qa.prototype.emitReserved=qa.prototype.emit,qa.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},qa.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Ka="function"===typeof Promise&&"function"===typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Xa="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function Qa(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const Ja=Xa.setTimeout,Za=Xa.clearTimeout;function $a(e,t){t.useNativeTimers?(e.setTimeoutFn=Ja.bind(Xa),e.clearTimeoutFn=Za.bind(Xa)):(e.setTimeoutFn=Xa.setTimeout.bind(Xa),e.clearTimeoutFn=Xa.clearTimeout.bind(Xa))}function eo(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class to extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class no extends qa{constructor(e){super(),this.writable=!1,$a(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new to(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Ua(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}class ro extends no{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(za),r=[];for(let i=0;i<n.length;i++){const e=Ua(n[i],t);if(r.push(e),"error"===e.type)break}return r})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,r=new Array(n);let i=0;e.forEach(((e,a)=>{Da(e,!1,(e=>{r[a]=e,++i===n&&t(r.join(za))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=eo()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let io=!1;try{io="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(K$){}const ao=io;function oo(){}class so extends ro{constructor(e){if(super(e),"undefined"!==typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}class co extends qa{constructor(e,t,n){super(),this.createRequest=e,$a(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=void 0!==n.data?n.data:null,this._create()}_create(){var e;const t=Qa(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(Vc){}if("POST"===this._method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Vc){}try{n.setRequestHeader("Accept","*/*")}catch(Vc){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(n.getResponseHeader("set-cookie"))),4===n.readyState&&(200===n.status||1223===n.status?this._onLoad():this.setTimeoutFn((()=>{this._onError("number"===typeof n.status?n.status:0)}),0))},n.send(this._data)}catch(Vc){return void this.setTimeoutFn((()=>{this._onError(Vc)}),0)}"undefined"!==typeof document&&(this._index=co.requestsCount++,co.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if("undefined"!==typeof this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=oo,e)try{this._xhr.abort()}catch(Vc){}"undefined"!==typeof document&&delete co.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(co.requestsCount=0,co.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",uo);else if("function"===typeof addEventListener){addEventListener("onpagehide"in Xa?"pagehide":"unload",uo,!1)}function uo(){for(let e in co.requests)co.requests.hasOwnProperty(e)&&co.requests[e].abort()}const lo=function(){const e=fo({xdomain:!1});return e&&null!==e.responseType}();function fo(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||ao))return new XMLHttpRequest}catch(Vc){}if(!t)try{return new(Xa[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(Vc){}}const ho="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class po extends no{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=ho?{}:Qa(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(K$){return this.emitReserved("error",K$)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;Da(n,this.supportsBinary,(e=>{try{this.doWrite(n,e)}catch(Vc){}r&&Ka((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){"undefined"!==typeof this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=eo()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const mo=Xa.WebSocket||Xa.MozWebSocket;const go={websocket:class extends po{createSocket(e,t,n){return ho?new mo(e,t,n):t?new mo(e,t):new mo(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends no{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(K$){return this.emitReserved("error",K$)}this._transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this._transport.ready.then((()=>{this._transport.createBidirectionalStream().then((e=>{const t=function(e,t){Ga||(Ga=new TextDecoder);const n=[];let r=0,i=-1,a=!1;return new TransformStream({transform(o,s){for(n.push(o);;){if(0===r){if(Ha(n)<1)break;const e=Ya(n,1);a=128===(128&e[0]),i=127&e[0],r=i<126?3:126===i?1:2}else if(1===r){if(Ha(n)<2)break;const e=Ya(n,2);i=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),r=3}else if(2===r){if(Ha(n)<8)break;const e=Ya(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),a=t.getUint32(0);if(a>Math.pow(2,21)-1){s.enqueue(Ia);break}i=a*Math.pow(2,32)+t.getUint32(4),r=3}else{if(Ha(n)<i)break;const e=Ya(n,i);s.enqueue(Ua(a?e:Ga.decode(e),t)),r=0}if(0===i||i>e){s.enqueue(Ia);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),r=Wa();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const i=()=>{n.read().then((e=>{let{done:t,value:n}=e;t||(this.onPacket(n),i())})).catch((e=>{}))};i();const a={type:"open"};this.query.sid&&(a.data='{"sid":"'.concat(this.query.sid,'"}')),this._writer.write(a).then((()=>this.onOpen()))}))}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;this._writer.write(n).then((()=>{r&&Ka((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends so{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=lo&&!t}request(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd},this.opts),new co(fo,this.uri(),e)}}},vo=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,yo=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function bo(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let i=vo.exec(e||""),a={},o=14;for(;o--;)a[yo[o]]=i[o]||"";return-1!=n&&-1!=r&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1);"/"==t.slice(-1)&&r.splice(r.length-1,1);return r}(0,a.path),a.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(n[t]=r)})),n}(0,a.query),a}const _o="function"===typeof addEventListener&&"function"===typeof removeEventListener,wo=[];_o&&addEventListener("offline",(()=>{wo.forEach((e=>e()))}),!1);class Eo extends qa{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"===typeof e&&(t=e,e=null),e){const n=bo(e);t.hostname=n.host,t.secure="https"===n.protocol||"wss"===n.protocol,t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=bo(t.host).host);$a(this,t),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach((e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e})),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"===typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let r=0,i=n.length;r<i;r++){let e=n[r].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),_o&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},wo.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);const e=this.opts.rememberUpgrade&&Eo.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(e=>this._onClose("transport close",e)))}onOpen(){this.readyState="open",Eo.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn((()=>{this._onClose("ping timeout")}),e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(e+="string"===typeof(t=r)?function(e){let t=0,n=0;for(let r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this._maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Ka((()=>{this._onClose("ping timeout")}),this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,r){if("function"===typeof t&&(r=t,t=void 0),"function"===typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const i={type:e,data:t,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}_onError(e){if(Eo.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),_o&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=wo.indexOf(this._offlineEventListener);-1!==e&&wo.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Eo.protocol=4;class So extends Eo{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;Eo.priorWebsocketSuccess=!1;const r=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Eo.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function i(){n||(n=!0,u(),t.close(),t=null)}const a=e=>{const n=new Error("probe error: "+e);n.transport=t.name,i(),this.emitReserved("upgradeError",n)};function o(){a("transport closed")}function s(){a("socket closed")}function c(e){t&&e.name!==t.name&&i()}const u=()=>{t.removeListener("open",r),t.removeListener("error",a),t.removeListener("close",o),this.off("close",s),this.off("upgrading",c)};t.once("open",r),t.once("error",a),t.once("close",o),this.once("close",s),this.once("upgrading",c),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{n||t.open()}),200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}class Co extends So{constructor(e){const t="object"===typeof e?e:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(!t.transports||t.transports&&"string"===typeof t.transports[0])&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map((e=>go[e])).filter((e=>!!e))),super(e,t)}}const xo="function"===typeof ArrayBuffer,To=Object.prototype.toString,Ro="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===To.call(Blob),Io="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===To.call(File);function No(e){return xo&&(e instanceof ArrayBuffer||(e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||Ro&&e instanceof Blob||Io&&e instanceof File}function Ao(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(Ao(e[t]))return!0;return!1}if(No(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return Ao(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Ao(e[n]))return!0;return!1}function ko(e){const t=[],n=e.data,r=e;return r.data=Do(n,t),r.attachments=t.length,{packet:r,buffers:t}}function Do(e,t){if(!e)return e;if(No(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=Do(e[r],t);return n}if("object"===typeof e&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=Do(e[r],t));return n}return e}function Mo(e,t){return e.data=Lo(e.data,t),delete e.attachments,e}function Lo(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Lo(e[n],t);else if("object"===typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Lo(e[n],t));return e}const Oo=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Po=5;var jo;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(jo||(jo={}));class Fo{constructor(e){this.replacer=e}encode(e){return e.type!==jo.EVENT&&e.type!==jo.ACK||!Ao(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===jo.EVENT?jo.BINARY_EVENT:jo.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==jo.BINARY_EVENT&&e.type!==jo.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ko(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}function Uo(e){return"[object Object]"===Object.prototype.toString.call(e)}class Bo extends qa{constructor(e){super(),this.reviver=e}add(e){let t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===jo.BINARY_EVENT;n||t.type===jo.BINARY_ACK?(t.type=n?jo.EVENT:jo.ACK,this.reconstructor=new Vo(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!No(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===jo[n.type])throw new Error("unknown packet type "+n.type);if(n.type===jo.BINARY_EVENT||n.type===jo.BINARY_ACK){const r=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(r,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===e.charAt(t+1)){const r=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(r,t)}else n.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(!Bo.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(Vc){return!1}}static isPayloadValid(e,t){switch(e){case jo.CONNECT:return Uo(t);case jo.DISCONNECT:return void 0===t;case jo.CONNECT_ERROR:return"string"===typeof t||Uo(t);case jo.EVENT:case jo.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===Oo.indexOf(t[0]));case jo.ACK:case jo.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Vo{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Mo(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function zo(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Wo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Go extends qa{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[zo(e,"open",this.onopen.bind(this)),zo(e,"packet",this.onpacket.bind(this)),zo(e,"error",this.onerror.bind(this)),zo(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}emit(e){var t,n,r;if(Wo.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];if(a.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(a),this;const s={type:jo.EVENT,data:a,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"===typeof a[a.length-1]){const e=this.ids++,t=a.pop();this._registerAckCallback(e,t),s.id=e}const c=null===(n=null===(t=this.io.engine)||void 0===t?void 0:t.transport)||void 0===n?void 0:n.writable,u=this.connected&&!(null===(r=this.io.engine)||void 0===r?void 0:r._hasPingExpired());return this.flags.volatile&&!c||(u?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(e,t){var n,r=this;const i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const a=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),i),o=function(){r.io.clearTimeoutFn(a);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(r,n)};o.withError=!0,this.acks[e]=o}emitWithAck(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Promise(((t,r)=>{const i=(e,n)=>e?r(e):t(n);i.withError=!0,n.push(i),this.emit(e,...n)}))}_addToQueue(e){var t=this;let n;"function"===typeof e[e.length-1]&&(n=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((function(e){if(r!==t._queue[0])return;if(null!==e)r.tryCount>t._opts.retries&&(t._queue.shift(),n&&n(e));else if(t._queue.shift(),n){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];n(null,...a)}return r.pending=!1,t._drainQueue()})),this._queue.push(r),this._drainQueue()}_drainQueue(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:jo.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((e=>{if(!this.sendBuffer.some((t=>String(t.id)===e))){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}}))}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case jo.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case jo.EVENT:case jo.BINARY_EVENT:this.onevent(e);break;case jo.ACK:case jo.BINARY_ACK:this.onack(e);break;case jo.DISCONNECT:this.ondisconnect();break;case jo.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];t.packet({type:jo.ACK,id:e,data:i})}}}onack(e){const t=this.acks[e.id];"function"===typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:jo.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Ho(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ho.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Ho.prototype.reset=function(){this.attempts=0},Ho.prototype.setMin=function(e){this.ms=e},Ho.prototype.setMax=function(e){this.max=e},Ho.prototype.setJitter=function(e){this.jitter=e};class Yo extends qa{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&"object"===typeof e&&(n=e,e=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,$a(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=n.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Ho({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=e;const i=n.parser||t;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Co(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=zo(t,"open",(function(){n.onopen(),e&&e()})),i=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},a=zo(t,"error",i);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn((()=>{r(),i(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(r),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(zo(e,"ping",this.onping.bind(this)),zo(e,"data",this.ondata.bind(this)),zo(e,"error",this.onerror.bind(this)),zo(e,"close",this.onclose.bind(this)),zo(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(Vc){this.onclose("parse error",Vc)}}ondecoded(e){Ka((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Go(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t){if(this.nsps[n].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const qo={};function Ko(e,t){"object"===typeof e&&(t=e,e=void 0);const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!==typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof n?n.protocol+"//"+e:"https://"+e),r=bo(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+t,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),r=n.source,i=n.id,a=n.path,o=qo[i]&&a in qo[i].nsps;let s;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?s=new Yo(r,t):(qo[i]||(qo[i]=new Yo(r,t)),s=qo[i]),n.query&&!t.query&&(t.query=n.queryKey),s.socket(n.path,t)}Object.assign(Ko,{Manager:Yo,Socket:Go,io:Ko,connect:Ko});let Xo=localStorage.getItem("user")||"{}",Qo=JSON.parse(Xo);const Jo=Ko.connect("https://connect-server-y1ku.onrender.com",{query:{profile:Qo.profile}}),Zo=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsx)("li",{className:"message-list-item",children:(0,kt.jsx)("div",{className:"skeleton-card mb-0 p-1 border-0",children:(0,kt.jsxs)("div",{className:"skeleton-header mb-0",children:[(0,kt.jsx)("div",{className:"skeleton-avatar"}),(0,kt.jsxs)("div",{className:"skeleton-lines",children:[(0,kt.jsx)("div",{className:"skeleton-line short"}),(0,kt.jsx)("div",{className:"skeleton-line medium"})]})]})})},t)))};const $o=JSON.parse(localStorage.getItem("user")||"{}").profile,es=()=>{const[e,t]=(0,a.useState)([]),[n,r]=(0,a.useState)({}),[i,o]=(0,a.useState)([]),[s,c]=(0,a.useState)(!1),u=(0,a.useRef)();let l=Xe(),d=En((e=>e.profile))._id,f=En((e=>e.message)),h=qe();(0,a.useEffect)((()=>{if(0!=f.length)return f&&f.forEach(((n,i)=>{var a;n&&n.person&&n.person._id&&(r(n.person),o(n.messages),Jo.emit("is_active",{profileId:null===n||void 0===n||null===(a=n.person)||void 0===a?void 0:a._id,myId:$o}),Jo.on("is_active",((n,r,i)=>{if(!0===n&&!e.includes(i))return t([...e,i])})))})),()=>Jo.off("is_active")}),[f]),(0,a.useEffect)((()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);let p=(0,a.useCallback)((async e=>{}),[]),m=(0,a.useCallback)((async e=>{c(!s)}),[]),g=(0,a.useCallback)((e=>{h("/message/".concat(e.currentTarget.dataset.id))}),[]),v=()=>(0,kt.jsx)("div",{className:"header-message-option-menu",style:{position:"relative",display:"inline-block"},ref:u,children:s&&(0,kt.jsx)("div",{style:{position:"absolute",top:"15px",right:"0",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:1e17,width:"200px"},children:(0,kt.jsxs)("ul",{className:"message-option-menu",style:{listStyle:"none",margin:0,padding:"8px 0"},children:[(0,kt.jsx)("li",{onClick:p,style:{padding:"8px 16px",cursor:"pointer"},children:"Mark All As Read"}),(0,kt.jsx)("li",{style:{padding:"8px 16px",cursor:"pointer"},children:(0,kt.jsx)(Tt,{to:"/settings/message",children:"Message Settings"})})]})})});return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{className:"left-sidebar-container",children:[(0,kt.jsxs)("div",{className:"message-leftside-header",children:[(0,kt.jsx)("h2",{className:"message-leftside-title",children:"Chats"}),(0,kt.jsx)("div",{className:"message-sidebar-header-menu",children:(0,kt.jsxs)("div",{onClick:m,className:"header-menu-icons",children:[(0,kt.jsx)("i",{className:"far fa-ellipsis-h"}),s&&(0,kt.jsx)(v,{})]})})]}),(0,kt.jsx)("div",{className:"message-list-container",children:(0,kt.jsx)("ul",{className:"message-list",children:f.length>0?f.filter((e=>e&&e.person&&e.person._id)).map(((t,n)=>{var r,i,a;let o=t.person,s=t.messages||[],c=(null===o||void 0===o?void 0:o.fullName)||(null!==o&&void 0!==o&&o.user?"".concat((null===o||void 0===o||null===(r=o.user)||void 0===r?void 0:r.firstName)||""," ").concat((null===o||void 0===o||null===(i=o.user)||void 0===i?void 0:i.surname)||"").trim():""),u=!s[0]||(!(!s[0].isSeen||s[0].receiverId!=d)||s[0].isSeen);e.includes(o._id);return(0,kt.jsx)("div",{style:{textDecoration:"none"},"data-id":o._id,onClick:g.bind(void 0),children:(0,kt.jsxs)("li",{className:"message-list-item ".concat(u?"message-seen":"message-unseen"," ").concat(o._id==l.profile?"active":""),children:[(0,kt.jsx)("div",{className:"user-profilePic",children:(0,kt.jsx)(Un,{profilePic:o.profilePic,profile:o._id,active:o.isActive})}),(0,kt.jsxs)("div",{className:"user-data",children:[(0,kt.jsx)("h4",{className:"message-author-name",children:c}),(0,kt.jsxs)("p",{className:"last-message-data",children:[(0,kt.jsxs)("span",{className:"last-message",children:[(f=s&&(null===(a=s[0])||void 0===a?void 0:a.message)||"",h=45,f.length>h?f.slice(0,h)+"...":f)," "]}),s&&s.length>0?(0,kt.jsxs)("span",{className:"last-msg-time",children:["| ",(0,kt.jsx)(xa(),{fromNow:!0,children:s&&s[0].timestamp})]}):(0,kt.jsx)(kt.Fragment,{})]})]})]})},n);var f,h})):(0,kt.jsx)(Zo,{count:5})})})]})})},ts="ADD_NOTIFICATION",ns="ADD_NOTIFICATIONS",rs="VIEW_NOTIFICATION",is="VIEW_NOTIFICATIONS",as=function(e){return{type:ns,payload:e,reset:arguments.length>1&&void 0!==arguments[1]&&arguments[1]}};const os="/"+JSON.parse(localStorage.getItem("user")||"{}").profile+"/";const ss=e=>{let{dispatch:t,useSelector:n}=e,r=n((e=>e.profile)),i=n((e=>e.option)),o=n((e=>e.notification)),s=n((e=>e.message)),[c,u]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),[f,h]=(0,a.useState)(!1),[p,m]=(0,a.useState)(0),[g,v]=(0,a.useState)(0),y=He(),[b,_]=(0,a.useState)("https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png"),w=qe();const[E,S]=(0,a.useState)(!1),C=(0,a.useRef)(null);let x={maxHeight:i.bodyHeight-i.headerHeight-100+"px",overflowY:"scroll"};(0,a.useEffect)((()=>{null!==r&&void 0!==r&&r.profilePic&&_(r.profilePic)}),[r]),(0,a.useEffect)((()=>{u(!1),d(!1),h(!1)}),[y]),(0,a.useEffect)((()=>{let e=o.filter((e=>!1===e.isSeen));m(e.length)}),[o]),(0,a.useEffect)((()=>{if(!s||!r._id)return;let e=s.filter((e=>!!(e&&e.messages&&e.messages.length>0&&!1===e.messages[0].isSeen&&e.messages[0].receiverId===r._id)));v(e.length)}),[s,r._id]);let T=(0,a.useCallback)((async e=>{let n=e.currentTarget.dataset.id;200===(await pa.post("/notification/view",{notificationId:n})).status&&t({type:rs,payload:n})}),[t]),R=(0,a.useCallback)((async()=>{S(!0!==E)}),[E]),I=(0,a.useCallback)((async e=>{let n=o.filter((e=>!1===e.isSeen));console.log(n),n.map((async(e,n)=>{200===(await pa.post("/notification/viewall",{profile:r._id})).status&&t({type:is})}))}),[t,r._id,o]),N=(0,a.useCallback)((async e=>{200===(await pa.post("/notification/deleteall",{profile:r._id})).status&&(t(as([],!0)),h(!1))}),[t,r._id]);(0,a.useEffect)((()=>{const e=e=>{C.current&&!C.current.contains(e.target)&&S(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);let A=(0,a.useCallback)((e=>{w(os)}),[w]),k=()=>(0,kt.jsx)("div",{className:"header-notification-option-menu",style:{position:"relative",display:"inline-block"},ref:C,children:E&&(0,kt.jsx)("div",{style:{position:"absolute",top:"20px",right:"0",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:1e17,width:"200px"},children:(0,kt.jsxs)("ul",{className:"notification-option-menu",style:{listStyle:"none",margin:0,padding:"8px 0"},children:[(0,kt.jsx)("li",{onClick:I,style:{padding:"8px 16px",cursor:"pointer"},children:"Mark All As Read"}),(0,kt.jsx)("li",{onClick:N,style:{padding:"8px 16px",cursor:"pointer"},children:"Delete All"}),(0,kt.jsx)("li",{style:{padding:"8px 16px",cursor:"pointer"},children:(0,kt.jsx)(Tt,{to:"/settings/notification",children:"Notification Setting"})})]})})});return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)("div",{className:"header-quick-menu-container",children:(0,kt.jsxs)("ul",{className:"header-quick-menu",children:[(0,kt.jsx)("li",{onClick:e=>{u(!c),d(!1),h(!1)},className:"header-quick-menu-item ".concat(c?"active":""),title:"Message",children:(0,kt.jsxs)("div",{className:"header-quick-menu-icon",children:[(0,kt.jsx)("i",{className:"far fa-comment-alt-lines"}),g>0&&(0,kt.jsx)("span",{className:"hr-counter-badge",children:(0,kt.jsx)("span",{className:"counter",children:g})})]})}),c&&(0,kt.jsx)(ba,{style:{right:"50%",zIndex:9999999999999,transform:"translateX(50%)",top:"101%",width:"300px",backgroundColor:"#242526",borderRadius:"5px",display:"block",boxShadow:"0px 0px 2px 0px rgba(255,255,255,0.3)"},className:"hr-mega-menu",children:(0,kt.jsx)(es,{})}),(0,kt.jsx)("li",{onClick:()=>{h(!f),d(!1),u(!1)},className:"header-quick-menu-item ".concat(f?"active":""),title:"",children:(0,kt.jsxs)("div",{className:"header-quick-menu-icon",children:[(0,kt.jsx)("i",{className:"far fa-bell"}),p>0&&(0,kt.jsx)("span",{className:"hr-counter-badge",children:(0,kt.jsx)("span",{className:"counter",children:p})})]})}),f&&(0,kt.jsx)(ba,{style:{right:"50%",zIndex:999999999999,transform:"translateX(50%)",top:"101%",width:"300px",backgroundColor:"#242526",borderRadius:"5px",display:"block",boxShadow:"0px 0px 2px 0px rgba(255,255,255,0.3)"},className:"hr-mega-menu",children:(0,kt.jsx)("div",{className:"hr-mm-container",children:o.length>0?(0,kt.jsxs)("div",{className:"hr-notification-menu-container",children:[(0,kt.jsxs)("div",{className:"notification-leftside-header",children:[(0,kt.jsx)("h2",{className:"notification-leftside-title",children:"Notifications"}),(0,kt.jsx)("div",{className:"notification-sidebar-header-menu",children:(0,kt.jsxs)("div",{onClick:R,className:"header-menu-icons",children:[(0,kt.jsx)("i",{className:"far fa-ellipsis-h"}),E&&(0,kt.jsx)(k,{})]})})]}),(0,kt.jsx)("ul",{className:"hr-notification-menu",style:x,children:o.map(((e,t)=>(0,kt.jsx)("li",{className:"hr-notification-item ".concat(!1===e.isSeen&&"unseen"),"data-id":e._id,onClick:T.bind(void 0),children:(0,kt.jsx)(Tt,{to:e.link||"",children:(0,kt.jsxs)("div",{className:"hr-notification-row align-items-center",children:[(0,kt.jsx)("div",{className:"hr-notification-col-2",children:(0,kt.jsx)("div",{className:"hr-notification-icon-container",children:(0,kt.jsx)("img",{className:"hr-notification-icon",src:e.icon,alt:"Notification Icon"})})}),(0,kt.jsxs)("div",{className:"hr-notification-col-10",children:[" ",(0,kt.jsxs)("p",{className:"hr-notification-text",children:[e.text," . ",(0,kt.jsx)(xa(),{fromNow:!0,children:e.timestamp})]})]})]})})},t)))})]}):(0,kt.jsx)("p",{className:"text-muted text-center mb-0",children:"No Notification Found"})})}),(0,kt.jsx)("li",{onClick:()=>{d(!l),u(!1),h(!1)},className:"header-quick-menu-item item-profile",title:"",children:(0,kt.jsx)("div",{className:"profile-pic",children:(0,kt.jsx)("img",{src:b,alt:""})})}),l&&(0,kt.jsx)(ba,{style:{right:"50%",transform:"translateX(50%)",top:"101%",width:"300px",backgroundColor:"#242526",borderRadius:"5px",display:"block",boxShadow:"0px 0px 2px 0px rgba(255,255,255,0.3)"},className:"hr-mega-menu",children:(0,kt.jsxs)("div",{className:"hr-mm-container",children:[(0,kt.jsx)("div",{onClick:A,children:(0,kt.jsxs)("div",{className:"all-profiles",children:[r&&(0,kt.jsx)(Un,{profilePic:b}),(0,kt.jsxs)("span",{className:"text-capitalize",children:[" ",r.fullName?r.fullName:r.user&&r.user.firstName+" "+r.user.surname," "]})]})}),(0,kt.jsxs)("div",{className:"profile-menus",children:[(0,kt.jsxs)(Tt,{to:"/settings",className:"profile-menu-item",children:[(0,kt.jsx)("div",{className:"menu-item-icon",children:(0,kt.jsx)("i",{className:"fa fa-cog"})}),(0,kt.jsx)("span",{className:"menu-item-name",children:"Settings"})]}),(0,kt.jsxs)(Tt,{onClick:e=>{localStorage.removeItem("user"),window.location.reload()},to:"#",className:"profile-menu-item",children:[(0,kt.jsx)("div",{className:"menu-item-icon",children:(0,kt.jsx)("i",{className:"fa fa-sign-out-alt"})}),(0,kt.jsx)("span",{className:"menu-item-name",children:"LogOut"})]})]})]})})]})})})},cs="SET_HEADER_HEIGHT",us="SET_BODY_HEIGHT",ls="SET_LOADING",ds=e=>({type:ls,payload:e}),fs=()=>{const e=kn();He(),En((e=>e.profile)),Xe();let t=(0,a.useRef)(null);const[n,r]=(0,a.useState)(null),i={dispatch:e,useSelector:En};(0,a.useEffect)((()=>{e((e=>({type:cs,payload:e}))(n))}),[n,e]);let[o,s]=(0,a.useState)(window.matchMedia("(max-width: 768px)").matches);return(0,a.useEffect)((()=>{var e;(Pn()(window).on("scroll",(e=>{if(window.pageYOffset>100){Pn()("#header").addClass("sticky-header");let e=Pn()("#header").height();Pn()("#main-container").css("padding-top",e)}else Pn()("#header").removeClass("sticky-header"),Pn()("#main-container").css("padding-top",0)})),t.current)&&r(null===(e=t.current)||void 0===e?void 0:e.offsetHeight);window.matchMedia("(max-width:768px)").addEventListener("change",(e=>{s(e.matches)}))}),[]),(0,kt.jsxs)(a.Fragment,{children:[(0,kt.jsx)("header",{ref:t,className:"header",id:"header",children:(0,kt.jsx)(en,{className:"header-container",fluid:"xxl",children:(0,kt.jsxs)(rn,{children:[(0,kt.jsx)(cn,{className:"d-flex align-items-center",children:(0,kt.jsx)(Ea,{})}),!o&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(cn,{className:"header-middle",md:6,xs:2,children:(0,kt.jsx)(Sa,{})})}),(0,kt.jsx)(cn,{className:"header-right d-flex justify-content-end align-items-center",children:(0,kt.jsx)(ss,d({},i))})]})})}),(0,kt.jsx)(lt,{})]})};for(var hs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ps=new Map,ms=0;ms<64;ms++){var gs=ms.toString(2);gs="0".repeat(6-gs.length)+gs,ps.set(hs.charCodeAt(ms),gs)}function vs(e){try{if("string"!=typeof e||3!==e.split(".").length)return null;var t=function(e){for(var t,n="",r=e.length,i=0;i<r;i++)t=e[i],n+=String.fromCodePoint(t>251&&t<254&&i+5<r?1073741824*(t-252)+(e[++i]-128<<24)+(e[++i]-128<<18)+(e[++i]-128<<12)+(e[++i]-128<<6)+e[++i]-128:t>247&&t<252&&i+4<r?(t-248<<24)+(e[++i]-128<<18)+(e[++i]-128<<12)+(e[++i]-128<<6)+e[++i]-128:t>239&&t<248&&i+3<r?(t-240<<18)+(e[++i]-128<<12)+(e[++i]-128<<6)+e[++i]-128:t>223&&t<240&&i+2<r?(t-224<<12)+(e[++i]-128<<6)+e[++i]-128:t>191&&t<224&&i+1<r?(t-192<<6)+e[++i]-128:t);return n}(function(e){for(var t="",n=0;n<e.length;n++)t+=ps.get(e.charCodeAt(n));t=t.slice(0,t.length-t.length%8);for(var r=[],i=0;i<t.length/8;i++)r.push(t.slice(8*i,8*i+8));return r}(e.split(".")[1].replaceAll("=","").replaceAll("-","+").replaceAll("_","/")).map((function(e){return parseInt(e,2)})));return JSON.parse(t)}catch(e){return console.error("There was an error decoding token: ",e),null}}function ys(e){var t=(0,a.useState)(!1),n=t[0],r=t[1],i=(0,a.useState)(null),o=i[0],s=i[1];(0,a.useEffect)((function(){c(e)}),[e]);var c=function(e){s(vs(e)),r(function(e){var t=vs(e),n=!0;if(t&&t.exp){var r=new Date(0);r.setUTCSeconds(t.exp),n=r.valueOf()<(new Date).valueOf()}return n}(e))};return{isExpired:n,decodedToken:o,reEvaluateToken:c}}const bs=localStorage.getItem("user")||"{}",_s=JSON.parse(bs),ws=e=>{let{children:t}=e,n=En((e=>e.auth)),r=qe(),i=He();const{isExpired:o}=ys((null===n||void 0===n?void 0:n.token)||_s.accessToken)||!1;return(0,a.useEffect)((()=>{o&&r("/login")}),[_s,i,o]),(0,a.useEffect)((()=>{null!==n&&void 0!==n&&n.token&&(n.token||r("/login"))}),[n]),(0,kt.jsx)(kt.Fragment,{children:t})},Es=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsx)("li",{className:"rs-nav-menu-item",children:(0,kt.jsx)("div",{className:"skeleton-card mb-0 p-1 border-0",children:(0,kt.jsxs)("div",{className:"skeleton-header mb-0",children:[(0,kt.jsx)("div",{className:"skeleton-avatar"}),(0,kt.jsx)("div",{className:"skeleton-lines",children:(0,kt.jsx)("div",{className:"skeleton-line medium"})})]})})},t)))};const Ss=()=>{Xe();let e=qe(),t=localStorage.getItem("user")?localStorage.getItem("user"):"{}",{profile:n}=JSON.parse(t),r=En((e=>e.profile)),[i,o]=(0,a.useState)([]);const[s,c]=(0,a.useState)([]);(0,a.useEffect)((()=>(r.friends&&r.friends.map(((e,t)=>(Jo.emit("is_active",{profileId:e._id,myId:r._id}),Jo.on("is_active",((e,t,n)=>{if(1==e&&!s.includes(n))return c([...s,n])})),()=>Jo.off("is_active")))),()=>Jo.off("is_active"))),[r,setTimeout((()=>!0)),[2e3]]),(0,a.useEffect)((()=>{o(r.friends)}),[r]);let u=t=>{let n=t.currentTarget.dataset.profile;e("/message/"+n)};return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{id:"right-sidebar",className:"text-left",children:[(0,kt.jsx)("h3",{className:"rs-nav-title",children:"Contacts"}),(0,kt.jsx)("ul",{className:"rs-nav-menu",children:i&&i.length>1?i.map(((e,t)=>{s.includes(e._id);return(0,kt.jsx)("li",{children:(0,kt.jsxs)("div",{className:"rs-nav-menu-item","data-profile":e._id,onClick:u.bind(void 0),children:[(0,kt.jsxs)("div",{className:"rs-profile-img-container",children:[(0,kt.jsx)("div",{className:"active-icon"}),(0,kt.jsx)("div",{className:"rs-profile-img",children:(0,kt.jsx)(Un,{profilePic:"".concat(e.profilePic),profile:e._id,active:e.isActive})})]}),(0,kt.jsx)("div",{className:"rs-text user-name",children:e.fullName?e.fullName:e.user.firstName+" "+e.user.surname})]})},t)})):(0,kt.jsx)(Es,{count:10})})]})})},Cs=e=>{let{item:t,myProfile:n,setReplies:r,comment:i,replies:o,isEditMode:s}=e,c=n._id,[u,l]=(0,a.useState)(!1),[f,h]=(0,a.useState)(null===t||void 0===t?void 0:t.reacts.length),[p,m]=(0,a.useState)(!1),[g,v]=(0,a.useState)({body:null,attachment:null});return(0,kt.jsxs)("div",{className:"reply-container",children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:t.author.profilePic,profile:t.author._id})}),(0,kt.jsxs)("div",{className:"comment-info",children:[(0,kt.jsxs)("div",{className:"comment-box",children:[(0,kt.jsxs)("div",{className:"name-comment",children:[(0,kt.jsx)("div",{className:"author-name",children:(0,kt.jsx)(Tt,{to:"/".concat(t.author._id),children:t.author.fullName})}),(0,kt.jsx)("p",{className:"comment-text",children:t.body})]}),(t.author._id==c||s)&&(0,kt.jsxs)("div",{className:"options-icon",onClick:(e=>{l(!u)}).bind(void 0),children:[(0,kt.jsx)("i",{className:"far fa-ellipsis-h"}),(0,kt.jsx)("div",{className:"options-container ".concat(u&&"open"),children:(0,kt.jsx)("button",{"data-id":t._id,onClick:(async e=>{let t=e.currentTarget.dataset.id;200===(await pa.post("/comment/deleteReply",{replyId:t})).status&&Pn()(e.target).parents(".reply-container").remove()}).bind(void 0),className:"comment-option text-danger",children:"Delete Reply"})})]})]}),(0,kt.jsxs)("div",{className:"comment-react",children:[(0,kt.jsxs)("div",{className:"like button ".concat(t.reacts.includes(c)&&"reacted"),onClick:(async e=>{let t=e.target.dataset.id;if(Pn()(e.target).hasClass("reacted")){200==(await pa.post("/comment/reply/removeReact",{replyId:t,myId:c})).status&&(h(f-1),Pn()(e.target).removeClass("reacted"))}else{200===(await pa.post("/comment/reply/addReact",{replyId:t,myId:c})).status&&(h(f+1),Pn()(e.target).addClass("reacted"))}}).bind(void 0),"data-id":t._id,children:["Like ","".concat(f>0?"(".concat(f,")"):"")]}),(0,kt.jsx)("div",{className:"reply button",onClick:(e=>{m(!p)}).bind(void 0),"data-id":t._id,children:"Reply"}),(0,kt.jsx)("div",{className:"comment-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:t.createdAt})})]}),p&&(0,kt.jsx)("div",{className:"new-reply",children:(0,kt.jsxs)("div",{className:"comment-field",children:[(0,kt.jsx)("input",{onKeyUp:async e=>{if(e.preventDefault(),13===e.keyCode){let e=i._id;if(g){let t=await pa.post("/comment/addReply",{replyMsg:g.body,authorId:n._id,commentId:e});if(200===t.status){m(!1);let e=t.data;r((t=>[...t,e]))}}}},onChange:(async e=>{v((t=>d(d({},t),{},{body:e.target.value})))}).bind(void 0),className:"field-comment-text",type:"text","data-reply":t._id,placeholder:"Reply to ".concat(t.author.fullName)}),(0,kt.jsx)("div",{onClick:(async e=>{let t=i._id;if(g){let e=await pa.post("/comment/addReply",{replyMsg:g.body,authorId:n._id,commentId:t});if(200===e.status){m(!1);let t=e.data._id;r((e=>[...e,t]))}}}).bind(void 0),"data-reply":t._id,className:"comment-attachment",children:(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-paper-plane"})})})]})})]})]})},xs=e=>{let{comment:t,postData:n,myProfile:r,isEditMode:i}=e,o=r._id,[s,c]=(0,a.useState)(0),[u,l]=(0,a.useState)(!1),[f,h]=(0,a.useState)(!1),[p,m]=(0,a.useState)(null===t||void 0===t?void 0:t.replies),[g,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)(t.body),[_,w]=(0,a.useState)({body:null,attachment:null});const E=n;(0,a.useEffect)((()=>{c(t.reacts.length||0),l(t.reacts.includes(o))}),[t]);let S=(0,a.useCallback)((e=>{b(e.target.value)}),[]),C=(0,a.useCallback)((async e=>{let n=await pa.post("comment/updateComment",{commentId:t._id,body:y});200==n.status&&(b(n.data.body),v(!1))})),x=(0,a.useCallback)((e=>{v(!g)}),[]);return null==t.author?(0,kt.jsx)(kt.Fragment,{}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"comment-container comment-id-".concat(t._id),children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:t.author.profilePic,profile:t.author._id})}),(0,kt.jsxs)("div",{className:"comment-info",children:[(0,kt.jsxs)("div",{className:"comment-box",children:[(0,kt.jsxs)("div",{className:"name-comment",children:[(0,kt.jsx)("div",{className:"author-name",children:(0,kt.jsx)(Tt,{to:"/".concat(t.author._id),children:t.author.user.firstName+" "+t.author.user.surname})}),(0,kt.jsx)("p",{className:"comment-text",children:g?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"comment-editor",children:[(0,kt.jsx)("textarea",{onChange:S.bind(void 0),className:"form-control w-100",value:y}),(0,kt.jsx)("button",{onClick:C.bind(void 0),className:"btn btn-primary mt-2",children:"Update"})]})}):(0,kt.jsx)(kt.Fragment,{children:y})}),t.attachment&&(0,kt.jsx)("div",{className:"comment-attachment-container",children:(0,kt.jsx)("img",{src:t.attachment,alt:"attachment"})})]}),t.author._id==r._id||i?(0,kt.jsxs)("div",{onClick:e=>{Pn()(e.currentTarget).children(".options-container").hasClass("open")?Pn()(e.currentTarget).children(".options-container").removeClass("open"):Pn()(e.currentTarget).children(".options-container").addClass("open")},className:"options-icon",children:[(0,kt.jsx)("i",{className:"far fa-ellipsis-h"}),(0,kt.jsxs)("div",{className:"options-container",children:[(0,kt.jsx)("button",{dataid:t._id,onClick:x.bind(void 0),className:"comment-option text-primary",children:"Edit Comment"}),(0,kt.jsx)("button",{dataid:t._id,onClick:(async e=>{try{let t=Pn()(e.currentTarget).attr("dataid"),n=E._id;Pn()(e.currentTarget).parents(".comment-container").remove(),(await pa.post("/comment/deleteComment",{commentId:t,postId:n})).status}catch(t){console.log(t)}}).bind(void 0),className:"comment-option text-danger",children:"Delete Comment"})]})]}):""]}),(0,kt.jsxs)("div",{className:"comment-react",children:[(0,kt.jsxs)("div",{className:"like button ".concat(u?"reacted":""),onClick:(async e=>{let t=e.currentTarget.dataset.id;if(Pn()(e.currentTarget).hasClass("reacted")){200==(await pa.post("/comment/removeReact",{commentId:t,reactorId:o})).status&&(Pn()(e.target).removeClass("reacted"),c((e=>e-1)))}else{200==(await pa.post("/comment/addReact",{commentId:t,reactorId:o})).status&&(c((e=>e+1)),Pn()(e.target).addClass("reacted"))}}).bind(void 0),"data-id":t._id,children:["Like ","".concat(s>0?"("+s+")":"")]}),(0,kt.jsx)("div",{className:"reply button","data-id":t._id,onClick:(async e=>{h(!f)}).bind(void 0),children:"Reply"}),(0,kt.jsx)("div",{className:"comment-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:t.createdAt})})]}),f&&(0,kt.jsx)("div",{className:"new-reply",children:(0,kt.jsxs)("div",{className:"comment-field",children:[(0,kt.jsx)("input",{onKeyUp:async e=>{if(e.preventDefault(),13===e.keyCode){let t=e.currentTarget.dataset.comment;if(_){let e=await pa.post("/comment/addReply",{replyMsg:_.body,authorId:r._id,commentId:t});if(200==e.status){h(!1);let t=e.data;m((e=>[...e,t]))}}}},onChange:(async e=>{w((t=>d(d({},t),{},{body:e.target.value})))}).bind(void 0),className:"field-comment-text",type:"text","data-comment":t._id,placeholder:"Reply to ".concat(t.author.displayName||t.author.user.surname)}),(0,kt.jsx)("div",{onClick:(async e=>{let t=e.currentTarget.dataset.comment;if(_){let e=await pa.post("/comment/addReply",{replyMsg:_.body,authorId:r._id,commentId:t});if(200==e.status){h(!1);let t=e.data;m((e=>[...e,t]))}}}).bind(void 0),"data-comment":t._id,className:"comment-attachment",children:(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-paper-plane"})})})]})}),p.map(((e,n)=>(0,kt.jsx)(Cs,{isEditMode:i,setReplies:m,replies:p,comment:t,item:e,myProfile:r},n)))]})]})})};const Ts=e=>{let{post:t,authProfilePicture:n,authProfile:r,myProfile:i,setAllComments:o,allComments:s=[],commentState:c,isEditMode:u}=e;i._id;const l=He();let[f,h]=(0,a.useState)(l.pathname.includes("/".concat(((null===t||void 0===t?void 0:t._id)||"").toString())));(0,a.useEffect)((()=>{h(l.pathname.includes("/".concat(((null===t||void 0===t?void 0:t._id)||"").toString())))}),[[],l]);let[p,m]=(0,a.useState)(null),[g,v]=(0,a.useState)({body:null,attachment:null});return(0,kt.jsxs)(a.Fragment,{children:[(0,kt.jsxs)("div",{className:"comments",children:[s.slice(f?-s.length-1:-3).map(((e,n)=>e&&(0,kt.jsx)(xs,{isEditMode:u,comment:e,postData:t,myProfile:i},n))),(null===t||void 0===t?void 0:t.comments.length)>3&&!f&&(0,kt.jsxs)("div",{className:"more-comment-button",children:[" ",(0,kt.jsx)(Tt,{to:"/post/".concat(t._id),children:"View more comments"})]})]}),(0,kt.jsxs)("div",{className:"new-comment",children:[(0,kt.jsx)("div",{className:"user-pp",children:(0,kt.jsx)(Un,{profilePic:n,profile:r})}),(0,kt.jsxs)("div",{className:"comment-field",children:[(0,kt.jsx)("input",{onKeyUp:async e=>{if(e.preventDefault(),13===e.keyCode)try{e.target.value="";let n=new FormData;n.append("body",null==g.body?"":g.body),n.append("attachment",null==p?"":p),n.append("post",t._id);let r=await pa.post("/comment/addComment",{body:g.body,attachment:p,post:t._id.toString()}),a={body:g.body,author:i,post:t._id,reacts:[],replies:[]};if(o((e=>[...e,a])),200===r.status){r.data.author=i,v([]),c((e=>e+1))}}catch(n){console.log(n)}},onChange:async e=>{v((t=>d(d({},t),{},{body:e.target.value})))},className:"field-comment-text",type:"text",placeholder:"Write a Public Comment"}),(0,kt.jsxs)("div",{onClick:async e=>{let t=e.currentTarget;Pn()(t).children("input").trigger("click")},className:"comment-attachment",children:[(0,kt.jsx)("input",{onChange:async e=>{v((e=>d(d({},e),{},{attachment:"https://programmerikram.com/wp-content/uploads/2025/03/loading.gif"})));let t=new FormData;t.append("image",e.target.files[0]);let n=await pa.post("/upload/",t,{headers:{"content-type":"multipart/form-data"}});n&&setTimeout((()=>{let e=n.data.secure_url;m(e),v((t=>d(d({},t),{},{attachment:e})))}),1e3)},className:"attachment",type:"file"}),(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-camera"})})]})]})]}),(0,kt.jsx)("div",{className:"comment-attachment-preview",children:g.attachment&&(0,kt.jsx)("img",{alt:"comment attachment",src:g.attachment})})]})};var Rs=n(917);const Is=e=>{let{count:t=1,style:n}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsx)("div",{className:"pp-skleton-container",style:{backgroundColor:"gray"},children:(0,kt.jsx)("div",{style:{padding:0},className:"skeleton-card no-border",children:(0,kt.jsx)("div",{style:{padding:0},className:"skeleton-main"})})},t)))},Ns=e=>{try{return new URL(e),!0}catch(K$){return!1}},As="https://programmerikram.com/wp-content/uploads/2025/03/like-icon.svg",ks="https://programmerikram.com/wp-content/uploads/2025/03/love-icon.svg",Ds="https://programmerikram.com/wp-content/uploads/2025/03/haha-icon.svg";const Ms=e=>{let{data:t,postContainer:n,index:r}=e,i=t||{},o=En((e=>e.profile)),s=o._id,c=null===i||void 0===i?void 0:i.author._id,[u,l]=(0,a.useState)(i.reacts.length),[d,f]=(0,a.useState)(i.shares.length),[h,p]=(0,a.useState)(i.comments.length),[m,g]=(0,a.useState)(i.comments),[v,y]=(0,a.useState)(!1),[b,_]=(0,a.useState)(!1),[w,E]=(0,a.useState)(!1),[S,C]=(0,a.useState)(""),[x,T]=(0,a.useState)([]),[R,I]=(0,a.useState)(!1),[N,A]=(0,a.useState)(!1);const[k,D]=(0,a.useState)(!1);let M=wa(),L=qe(),O=(0,a.useRef)([]),P=(0,a.useRef)(),j=kn();(0,a.useEffect)((()=>(Jo.emit("is_active",{profileId:c,myId:s}),Jo.on("is_active",((e,t,n)=>{n===s&&y(e)})),()=>Jo.off("is_active"))),[o]);var F=s===c;i.author.profilePic;(0,a.useEffect)((()=>{let e=[];i.reacts.map((t=>{if(t.profile){switch(t.type){case"like":e.includes("like")||e.push("like");break;case"love":e.includes("love")||e.push("love");break;case"haha":e.includes("haha")||e.push("haha")}t.profile===s&&(_(t.type),E(!0))}})),T(e)}),[]);let U=i.photos,B=i.type||"post";(0,a.useEffect)((()=>{Fn(U,D)}),[U]);let V=async e=>{let t=e.currentTarget;F?(0,Rs.ZX)({title:"Confirm Action",message:"Are you sure you want to delete this post?",buttons:[{label:"Yes",onClick:async()=>{let e=await pa.post("/post/delete",{postId:i._id,authorId:i.author._id});200===e.status?(Pn()(t).parents(".nf-post").css({"min-height":"0px",padding:"10px"}),Pn()(t).parents(".nf-post").html('<p class="fs-6 mb-0 text-center text-danger">'+e.data.message+"</p>")):alert("Failed to delete post")}},{label:"No",onClick:()=>{}}]}):Pn()(t).parents(".nf-post").hide()},z=async function(){if(l((e=>e-1)),_(!1),200===(await pa.post("/react/removeReact",{id:i._id,postType:"post",reactor:s})).status)return E(!1),!0;l((e=>e+1))},W=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"post";if(w||l((e=>e+1)),T([...x,e]),_(e),200===(await pa.post("/react/addReact",{id:i._id,postType:t,reactType:e})).status)return E(!0),!0;l(i.reacts),T([...x]),_(!1)},G=async e=>{let t=e.currentTarget;Pn()(t).parent().hasClass("reacted")?(z("post"),Pn()(t).parent().removeClass("reacted")):(W("like","post",t),Pn()(t).parent().addClass("reacted"))},H=async e=>{let t=e.currentTarget;Pn()(t).parents(".post-react-container").css("visibility","hidden"),Pn()(t).hasClass("reacted")?(z("post"),Pn()(t).removeClass("reacted")):(W("like","post",t),Pn()(t).addClass("reacted"),Pn()(e.currentTarget).siblings().removeClass("reacted")),setTimeout((()=>{Pn()(t).parents(".post-react-container").css("visibility","visible")}),500)},Y=e=>{let t=e.currentTarget;Pn()(t).parents(".post-react-container").css("visibility","hidden"),Pn()(e.currentTarget).hasClass("reacted")?(z("post"),Pn()(e.currentTarget).removeClass("reacted")):(W("love","post"),Pn()(e.currentTarget).siblings().removeClass("reacted"),Pn()(e.currentTarget).addClass("reacted")),setTimeout((()=>{Pn()(t).parents(".post-react-container").css("visibility","visible")}),500)},q=e=>{let t=e.currentTarget;Pn()(t).parents(".post-react-container").css("visibility","hidden"),Pn()(e.currentTarget).hasClass("reacted")?(z(),Pn()(e.currentTarget).removeClass("reacted")):(W("haha","post",t),Pn()(e.currentTarget).siblings().removeClass("reacted"),Pn()(e.currentTarget).addClass("reacted")),setTimeout((()=>{Pn()(t).parents(".post-react-container").css("visibility","visible")}),500)},K=e=>{let t=e.currentTarget;Pn()(t).children(".post-react-container").css("visibility","visible")},X=e=>{let t=e.currentTarget;Pn()(t).parents(".footer").find(".field-comment-text").focus()},Q=e=>{I(!0)},J=()=>{I(!1)},Z=(0,a.useCallback)((async e=>{e.preventDefault();let t=await pa.post("post/share",{postId:i._id,caption:S});200==t.status&&(f((e=>e+1)),j(va(t.data.post)),I(!1))}),[j]),$=En((e=>e.profile.profilePic)),ee=En((e=>e.profile._id)),te=e=>{L("/post/".concat(i._id))},ne=(0,a.useCallback)((e=>{L("/post/".concat(i._id,"/edit"))}),[]),re="".concat(i.author.profilePic),ie=(0,a.useRef)(null);(0,a.useEffect)((()=>{const e=e=>{ie.current&&!ie.current.contains(e.target)&&A(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);let ae=(0,a.useCallback)((e=>{A(!N)}),[]);const oe=(0,a.useRef)(new Set);(0,a.useEffect)((()=>{const e=new IntersectionObserver(((e,t)=>{e.forEach((e=>{const n=Number(e.target.dataset.index);var r;e.isIntersecting&&!oe.current.has(n)&&(oe.current.add(n),r=e.target.dataset.id,Jo.emit("viewPost",{visitorId:s,postId:r}),t.unobserve(e.target))}))}),{root:n.current,threshold:.5});return O.current.forEach((t=>t&&e.observe(t))),()=>{e.disconnect()}}),[]);let se=()=>{var e,t,n,a,s,c,l,f,v,y,_,w,E,T,I;return"share"===B?(0,kt.jsxs)("div",{"data-id":i._id,ref:e=>O.current[r]=e,"data-index":r,className:"share-nf-post nf-post",children:[(0,kt.jsxs)("div",{className:"header",children:[(0,kt.jsx)("div",{className:"reason",children:(0,kt.jsxs)("span",{className:"",children:[(0,kt.jsx)("b",{children:(0,kt.jsx)(Tt,{to:"/".concat(i.author._id),children:i.author.fullName})})," Shared ",(0,kt.jsxs)("b",{children:[(0,kt.jsxs)(Tt,{to:"/".concat(null===i||void 0===i||null===(e=i.parentPost)||void 0===e||null===(t=e.author)||void 0===t?void 0:t._id),children:[null===i||void 0===i||null===(n=i.parentPost)||void 0===n||null===(a=n.author)||void 0===a?void 0:a.fullName,"'s"]})," "]}),(0,kt.jsx)("span",{className:"text-capitalize",children:null===i||void 0===i||null===(s=i.parentPost)||void 0===s?void 0:s.type})]})}),(0,kt.jsxs)("div",{className:"author-info",children:[(0,kt.jsxs)("div",{className:"left",children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:i.author.profilePic,profile:i.author._id,active:i.author.isActive})}),(0,kt.jsxs)("div",{className:"post-nd-container",children:[(0,kt.jsx)(Tt,{to:"/"+i.author._id,children:(0,kt.jsx)("h4",{className:"author-name",children:i.author.fullName})}),(0,kt.jsx)("span",{className:"post-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:i.createdAt})})]})]}),(0,kt.jsxs)("div",{className:"right",children:[(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("button",{onClick:ae.bind(void 0),className:"post-three-dot",children:(0,kt.jsx)("i",{className:"far fa-ellipsis-h"})}),N&&(0,kt.jsx)("div",{className:"post-option-menu",ref:ie,children:(0,kt.jsxs)("ul",{children:[F&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("li",{onClick:ne,children:"Edit Post"}),(0,kt.jsx)("li",{children:"Edit Audience"})]}),(0,kt.jsx)("li",{children:"Report This Post"})]})})]}),(0,kt.jsxs)("button",{onClick:V.bind(void 0),className:"post-close",children:[" ",(0,kt.jsx)("i",{className:"far fa-times"})]})]})]})]}),(0,kt.jsxs)("div",{ref:P,"data-id":i._id,className:"body",children:[(0,kt.jsx)("p",{className:"caption",children:i.caption}),(0,kt.jsxs)("div",{className:"nf-post ".concat(B," m-3 border overflow-hidden"),children:[(0,kt.jsxs)("div",{className:"header",children:["profilePic"===B&&(0,kt.jsxs)("div",{className:"reason",children:[(0,kt.jsx)("span",{className:"d-none",children:(0,kt.jsx)("b",{children:"Shared a photos"})}),(0,kt.jsx)("span",{children:"Updated Profile Picture"})]}),(0,kt.jsxs)("div",{className:"author-info",children:[(0,kt.jsxs)("div",{className:"left",children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:null===i||void 0===i||null===(c=i.parentPost)||void 0===c||null===(l=c.author)||void 0===l?void 0:l.profilePic,profile:null===i||void 0===i||null===(f=i.parentPost)||void 0===f||null===(v=f.author)||void 0===v?void 0:v._id,active:null===i||void 0===i||null===(y=i.parentPost)||void 0===y||null===(_=y.author)||void 0===_?void 0:_.isActive})}),(0,kt.jsxs)("div",{className:"post-nd-container",children:[(0,kt.jsxs)(Tt,{to:"/"+i.author._id,children:[(0,kt.jsx)("h4",{className:"author-name",children:null===i||void 0===i||null===(w=i.parentPost)||void 0===w||null===(E=w.author)||void 0===E?void 0:E.fullName}),i.feelings&&(0,kt.jsxs)("span",{className:"post-feelings",children:[" ",(0,kt.jsx)("small",{className:"text-lowercase text-secondary",children:"is felling"})," ",i.feelings||""]}),i.location&&(0,kt.jsxs)("span",{className:"post-location",children:[" ",(0,kt.jsx)("small",{className:"text-lowercase text-secondary",children:" at"})," ",i.location||""]})]}),(0,kt.jsx)("span",{className:"post-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:null===i||void 0===i||null===(T=i.parentPost)||void 0===T?void 0:T.createdAt})})]})]}),(0,kt.jsx)("div",{className:"right"})]})]}),(0,kt.jsxs)("div",{className:"body",children:[(0,kt.jsx)("p",{className:"caption",children:null===i||void 0===i||null===(I=i.parentPost)||void 0===I?void 0:I.caption}),k&&Ns(U)?(0,kt.jsxs)(kt.Fragment,{children:[" ",(0,kt.jsx)("div",{className:"attachment",children:(0,kt.jsx)(Tt,{to:"/post/".concat(i._id),children:(0,kt.jsx)("img",{src:U,alt:"post"})})})]}):(0,kt.jsx)(kt.Fragment,{children:Ns(U)&&(0,kt.jsx)(Is,{})})]})]})]}),(0,kt.jsxs)("div",{className:"footer",children:[(0,kt.jsxs)("div",{className:"react-count",children:[(0,kt.jsxs)("div",{className:"reacts",children:[x.includes("like")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:As,alt:"like"}),"  "]}):(0,kt.jsx)("span",{}),x.includes("love")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:ks,alt:"love"})," "]}):(0,kt.jsx)("span",{}),x.includes("haha")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:Ds,alt:"love"})," "]}):(0,kt.jsx)("span",{}),(0,kt.jsxs)("span",{className:"text",children:[i.reacts&&u," ",u>1?"Reacts":"React"]})]}),(0,kt.jsxs)("div",{className:"comment-share",children:[(0,kt.jsxs)("div",{className:"comment",children:[(0,kt.jsx)("div",{className:"text",children:i.comments&&h}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})})]}),(0,kt.jsxs)("div",{className:"shares",children:[(0,kt.jsx)("div",{className:"text",children:i.shares&&d}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"fa fa-share"})})]})]})]}),(0,kt.jsx)("div",{className:"like-comment-share",children:(0,kt.jsxs)("div",{className:"buttons-container",children:[(0,kt.jsxs)("div",{className:"react-buttons button ".concat(b?"reacted":""),children:[(0,kt.jsxs)("div",{onClick:G,onMouseOver:K,className:"react-like ".concat(1==b?"reacted":""),children:[(0,kt.jsxs)("span",{className:"react-icon",datatype:b||"",children:["haha"==b?(0,kt.jsx)("img",{src:Ds,alt:"haha"}):(0,kt.jsx)("span",{}),"love"==b?(0,kt.jsx)("img",{src:ks,alt:"love"}):(0,kt.jsx)("span",{}),0==b||"like"==b?(0,kt.jsx)("img",{src:As,alt:"like"}):(0,kt.jsx)("span",{})]}),(0,kt.jsx)("span",{className:"text text-capitalize",children:b||"like"})]}),(0,kt.jsxs)("div",{className:"post-react-container",children:[(0,kt.jsx)("div",{className:"react react-like ".concat("like"==b?"reacted":""),onClick:H,id:"postReactLike",title:"Like",children:(0,kt.jsx)("img",{src:As,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-love ".concat("love"==b?"reacted":""),onClick:Y,id:"postReactLove",title:"Love",children:(0,kt.jsx)("img",{src:ks,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-haha ".concat("haha"==b?"reacted":""),onClick:q,id:"postReactHaha",title:"Haha",children:(0,kt.jsx)("img",{src:Ds,alt:"haha"})})]})]}),(0,kt.jsxs)("div",{onClick:X,className:"comment button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})}),(0,kt.jsx)("span",{className:"text",children:"Comment"})]}),!F&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{onClick:Q,className:"share button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-share"})}),(0,kt.jsx)("span",{className:"text",children:"Share"})]}),(0,kt.jsxs)(jn,{title:"Share Post",style:{width:M?"95%":"600px",top:"50%"},isOpen:R,onRequestClose:J,id:"cp-view-modal",children:[(0,kt.jsxs)("div",{className:"modal-header",children:[(0,kt.jsx)("div",{}),(0,kt.jsx)("div",{onClick:J,className:"modal-close-btn text-danger",children:(0,kt.jsx)("i",{className:"far fa-times"})})]}),(0,kt.jsx)("div",{className:"modal-body",children:(0,kt.jsxs)("div",{className:"share-post-container",children:[(0,kt.jsxs)("div",{className:"share-post-header",children:[(0,kt.jsxs)("div",{className:"row",children:[(0,kt.jsx)("div",{className:"col-1",children:(0,kt.jsx)(Un,{profilePic:o.profilePic})}),(0,kt.jsx)("div",{className:"col-3",children:(0,kt.jsx)("h3",{children:o.fullName})})]}),(0,kt.jsx)("div",{className:"row",children:(0,kt.jsxs)("div",{className:"col",children:["You're Sharing ",i.author.fullName||"Someone","'s Post"]})})]}),(0,kt.jsxs)("div",{className:"share-post-body my-3",children:[(0,kt.jsx)("textarea",{className:"form-control",rows:"3",placeholder:"What's On Your Mind?",onChange:e=>C(e.target.value),value:S}),(0,kt.jsx)("div",{className:"share-post-button text-end mt-2",children:(0,kt.jsx)("button",{className:"btn btn-primary",onClick:Z.bind(void 0),children:"Share Now"})})]}),(0,kt.jsx)("div",{className:"share-post-footer"})]})})]})]})]})}),(0,kt.jsx)(Ts,{post:i,commentState:p,allComments:m,setAllComments:g,myProfile:o,authProfile:ee,authProfilePicture:$})]})]}):(0,kt.jsxs)("div",{"data-id":i._id,ref:e=>O.current[r]=e,"data-index":r,className:"nf-post ".concat(B),children:[(0,kt.jsxs)("div",{className:"header",children:["profilePic"===B&&(0,kt.jsxs)("div",{className:"reason",children:[(0,kt.jsxs)("span",{className:"d-none",children:[(0,kt.jsx)("b",{children:"A bitch"})," commented."]}),(0,kt.jsx)("span",{children:"Updated Profile Picture"})]}),(0,kt.jsxs)("div",{className:"author-info",children:[(0,kt.jsxs)("div",{className:"left",children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:re,profile:i.author._id,active:i.author.isActive})}),(0,kt.jsxs)("div",{className:"post-nd-container",children:[(0,kt.jsxs)("h4",{className:"author-name",onClick:te.bind(void 0),children:[(0,kt.jsx)(Tt,{to:"/"+i.author._id,children:i.author.fullName}),i.feelings&&(0,kt.jsxs)("span",{className:"post-feelings",children:[" ",(0,kt.jsx)("small",{className:"text-lowercase text-secondary",children:"is felling"})," ",i.feelings||""]}),i.location&&(0,kt.jsxs)("span",{className:"post-location",children:[" ",(0,kt.jsx)("small",{className:"text-lowercase text-secondary",children:" at"})," ",i.location||""]})]}),(0,kt.jsx)("span",{className:"post-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:i.createdAt})})]})]}),(0,kt.jsxs)("div",{className:"right",children:[(0,kt.jsx)("button",{onClick:ae.bind(void 0),className:"post-three-dot",children:(0,kt.jsx)("i",{className:"far fa-ellipsis-h"})}),N&&(0,kt.jsx)("div",{className:"post-option-menu",ref:ie,children:(0,kt.jsxs)("ul",{children:[F&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("li",{onClick:ne,children:"Edit Post"}),(0,kt.jsx)("li",{children:"Edit Audience"})]}),(0,kt.jsx)("li",{children:"Report This Post"})]})}),(0,kt.jsxs)("button",{onClick:V.bind(void 0),className:"post-close",children:[" ",(0,kt.jsx)("i",{className:"far fa-times"})]})]})]})]}),(0,kt.jsxs)("div",{ref:P,"data-id":i._id,className:"body",children:[(0,kt.jsx)("p",{className:"caption",children:i.caption}),k&&Ns(U)?(0,kt.jsxs)(kt.Fragment,{children:[" ",(0,kt.jsx)("div",{className:"attachment",children:(0,kt.jsx)(Tt,{to:"/post/".concat(i._id),children:(0,kt.jsx)("img",{src:U,alt:"post"})})})]}):(0,kt.jsx)(kt.Fragment,{children:Ns(U)&&(0,kt.jsx)(Is,{})})]}),(0,kt.jsxs)("div",{className:"footer",children:[(0,kt.jsxs)("div",{className:"react-count",children:[(0,kt.jsxs)("div",{className:"reacts",children:[x.includes("like")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:As,alt:"like"}),"  "]}):(0,kt.jsx)("span",{}),x.includes("love")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:ks,alt:"love"})," "]}):(0,kt.jsx)("span",{}),x.includes("haha")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:Ds,alt:"love"})," "]}):(0,kt.jsx)("span",{}),(0,kt.jsxs)("span",{className:"text",children:[i.reacts&&u," ",u>1?"Reacts":"React"]})]}),(0,kt.jsxs)("div",{className:"comment-share",children:[(0,kt.jsxs)("div",{className:"comment",children:[(0,kt.jsx)("div",{className:"text",children:i.comments&&h}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})})]}),(0,kt.jsxs)("div",{className:"shares",children:[(0,kt.jsx)("div",{className:"text",children:i.shares&&d}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"fa fa-share"})})]})]})]}),(0,kt.jsx)("div",{className:"like-comment-share",children:(0,kt.jsxs)("div",{className:"buttons-container",children:[(0,kt.jsxs)("div",{className:"react-buttons button ".concat(b?"reacted":""),children:[(0,kt.jsxs)("div",{onClick:G,onMouseOver:K,className:"react-like ".concat(1==b?"reacted":""),children:[(0,kt.jsxs)("span",{className:"react-icon",datatype:b||"",children:["haha"==b?(0,kt.jsx)("img",{src:Ds,alt:"haha"}):(0,kt.jsx)("span",{}),"love"==b?(0,kt.jsx)("img",{src:ks,alt:"love"}):(0,kt.jsx)("span",{}),0==b||"like"==b?(0,kt.jsx)("img",{src:As,alt:"like"}):(0,kt.jsx)("span",{})]}),(0,kt.jsx)("span",{className:"text text-capitalize",children:b||"like"})]}),(0,kt.jsxs)("div",{className:"post-react-container",children:[(0,kt.jsx)("div",{className:"react react-like ".concat("like"==b?"reacted":""),onClick:H,id:"postReactLike",title:"Like",children:(0,kt.jsx)("img",{src:As,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-love ".concat("love"==b?"reacted":""),onClick:Y,id:"postReactLove",title:"Love",children:(0,kt.jsx)("img",{src:ks,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-haha ".concat("haha"==b?"reacted":""),onClick:q,id:"postReactHaha",title:"Haha",children:(0,kt.jsx)("img",{src:Ds,alt:"haha"})})]})]}),(0,kt.jsxs)("div",{onClick:X,className:"comment button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})}),(0,kt.jsx)("span",{className:"text",children:"Comment"})]}),(0,kt.jsxs)("div",{onClick:Q,className:"share button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-share"})}),(0,kt.jsx)("span",{className:"text",children:"Share"})]}),(0,kt.jsxs)(jn,{title:"Share Post",style:{width:M?"95%":"600px",top:"50%"},isOpen:R,onRequestClose:J,id:"cp-view-modal",children:[(0,kt.jsx)("div",{className:"modal",children:(0,kt.jsxs)("div",{className:"modal-header",children:[(0,kt.jsx)("h3",{className:"modal-title"}),(0,kt.jsx)("div",{className:"modal-close-btn",children:(0,kt.jsx)("i",{className:"far fa-times"})})]})}),(0,kt.jsxs)("div",{className:"share-post-container",children:[(0,kt.jsxs)("div",{className:"share-post-header",children:[(0,kt.jsxs)("div",{className:"row",children:[(0,kt.jsx)("div",{className:"col-1",children:(0,kt.jsx)(Un,{profilePic:o.profilePic})}),(0,kt.jsx)("div",{className:"col-3",children:(0,kt.jsx)("h3",{children:o.fullName})})]}),(0,kt.jsx)("div",{className:"row",children:(0,kt.jsxs)("div",{className:"col",children:["Your Sharing ",i.author.fullName||"Someone","'s Post"]})})]}),(0,kt.jsxs)("div",{className:"share-post-body my-3",children:[(0,kt.jsx)("textarea",{className:"form-control",onChange:e=>C(e.target.value),value:S}),(0,kt.jsx)("div",{className:"share-post-button text-end mt-2",children:(0,kt.jsx)("button",{className:"btn btn-primary",onClick:Z,children:"Share Now"})})]}),(0,kt.jsx)("div",{className:"share-post-footer"})]})]})]})}),(0,kt.jsx)(Ts,{post:i,commentState:p,allComments:m,setAllComments:g,myProfile:o,authProfile:ee,authProfilePicture:$})]})]})};return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(se,{})})};const Ls=e=>{var t;let n=e.data||{};null===n||void 0===n||null===(t=n.author)||void 0===t||t._id;const[r,i]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{i(!0)}),[]),(0,kt.jsx)(kt.Fragment,{children:null==n?(0,kt.jsx)("p",{children:"No Story Found"}):(0,kt.jsx)("div",{className:"nf-story",style:{backgroundImage:n.bgColor},children:(0,kt.jsxs)(Tt,{to:"/story/".concat(n._id),children:[(0,kt.jsx)("div",{className:"nf-story-pp-container",children:(0,kt.jsx)(Un,{profile:n.author._id,hasStory:r,checkStory:"no",profilePic:n.author.profilePic})}),(0,kt.jsx)("div",{className:"nf-story-image-container",children:(0,kt.jsx)("img",{src:n.image,className:"nf-story-image",alt:"Story"})})]})})})},Os=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsxs)("div",{className:"skeleton-card",children:[(0,kt.jsxs)("div",{className:"skeleton-header",children:[(0,kt.jsx)("div",{className:"skeleton-avatar"}),(0,kt.jsxs)("div",{className:"skeleton-lines",children:[(0,kt.jsx)("div",{className:"skeleton-line short"}),(0,kt.jsx)("div",{className:"skeleton-line medium"})]})]}),(0,kt.jsx)("div",{className:"skeleton-main"}),(0,kt.jsxs)("div",{className:"skeleton-footer",children:[(0,kt.jsx)("div",{className:"skeleton-line small button"}),(0,kt.jsx)("div",{className:"skeleton-line small button"}),(0,kt.jsx)("div",{className:"skeleton-line small button"})]})]},t)))},Ps=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsx)("div",{className:"nf-story",children:(0,kt.jsxs)("div",{className:"skeleton-card",style:{margin:"0px",marginRight:"20px",padding:"5px",maxWidth:"150px",height:"100%",float:"left"},children:[(0,kt.jsxs)("div",{className:"skeleton-header",style:{margin:0},children:[(0,kt.jsx)("div",{className:"skeleton-avatar"}),(0,kt.jsx)("div",{className:"skeleton-lines mt-2",children:(0,kt.jsx)("div",{className:"skeleton-line medium"})})]}),(0,kt.jsx)("div",{className:"skeleton-main",style:{height:"150px"}})]})},t)))};const js=()=>{let e=kn(),t=(0,a.useRef)(),n=(0,a.useRef)();function r(e){t.current.scrollBy({left:-300,behavior:"smooth"})}function i(e){t.current.scrollBy({left:300,behavior:"smooth"})}let[o,s]=(0,a.useState)(window.matchMedia("(max-width: 768px)").matches);const[c,u]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!0);let[f,h]=(0,a.useState)([]),[p,m]=(0,a.useState)([]),[g,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)(0),_=(En((e=>e.profile)),En((e=>e.post))),w=async()=>{if(!1===l)return;let t=await pa.get("/post/newsFeed/",{params:{pageNumber:y+1}});if(200===t.status){e((n=[...t.data.posts]||[],{type:ma,payload:n})),b(y+1);let r=t.data.hasNewPost;d(r),u(!1)}var n;let r=await pa.get("/story/");200===r.status&&m(r.data),e(ds(!1))};return(0,a.useEffect)((()=>{window.addEventListener("scroll",(()=>{(window.scrollY+window.innerHeight)/document.body.scrollHeight>=.8&&0==c&&u(!0)}))}),[]),(0,a.useEffect)((()=>{c&&l&&w()}),[c]),(0,a.useEffect)((()=>{e(ds(!1)),window.matchMedia("(max-width:768px)").addEventListener("change",(e=>{s(e.matches)})),d(!0),u(!0)}),[]),(0,a.useEffect)((()=>{if(_.length>0){let e=Math.floor(_.length/3);b(e)}}),[_]),(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)("div",{id:"home",className:"home-page",children:(0,kt.jsx)(en,{fluid:!0,children:(0,kt.jsxs)(rn,{children:[(0,kt.jsx)(cn,{md:"3",children:!o&&(0,kt.jsx)(_a,{})}),(0,kt.jsxs)(cn,{md:"6",children:[(0,kt.jsx)(ya,{setNewsFeed:h}),(0,kt.jsxs)("div",{id:"newsfeed-container",className:"newsfeed-container",children:[p.length>0?(0,kt.jsxs)("div",{id:"nf-story-container",children:[(0,kt.jsx)("div",{ref:t,className:"nf-story-overflow-container",children:p.map(((e,t)=>(0,kt.jsx)(Ls,{data:e},t)))}),(0,kt.jsx)("div",{className:"nf-story-arrow-left",onClick:r.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-chevron-left"})}),(0,kt.jsx)("div",{className:"nf-story-arrow-right",onClick:i.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]}):(0,kt.jsxs)("div",{id:"nf-story-container",children:[(0,kt.jsx)("div",{ref:t,className:"nf-story-overflow-container",children:(0,kt.jsx)(Ps,{count:7})}),(0,kt.jsx)("div",{className:"nf-story-arrow-left",onClick:r.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-chevron-left"})}),(0,kt.jsx)("div",{className:"nf-story-arrow-right",onClick:i.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]}),(0,kt.jsxs)("div",{id:"nf-post-container",ref:n,children:[_.length>0?_.map(((e,t)=>(0,kt.jsx)(Ms,{index:_.indexOf(e),postContainer:n,data:e},t))):(0,kt.jsx)(Os,{count:3}),(0,kt.jsx)(Os,{count:1})]})]})]}),(0,kt.jsx)(cn,{md:"3",children:!o&&(0,kt.jsx)(Ss,{})})]})})})})},Fs=e=>{const t=qe();let n=En((e=>e.profile)),r=e.profileData,i=e.isAuth,o=e.isFriend,s=r.friendReqs&&r.friendReqs.includes(n._id),c=n.friendReqs&&n.friendReqs.includes(r._id),u=s||c,[l,f]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[m,g]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!0),[b,_]=(0,a.useState)({photo:null,uploadedUrl:!1}),w=(e=>{const[t,n]=(0,a.useState)(window.matchMedia(e).matches);return(0,a.useEffect)((()=>{const t=window.matchMedia(e),r=e=>n(e.matches);return t.addEventListener("change",r),()=>t.removeEventListener("change",r)}),[e]),t})("(max-width: 768px)"),E=r.user&&r.user.firstName+" "+r.user.surname;(0,a.useEffect)((()=>{y(!0)}),[v]);let S=e=>{t("/message/".concat(r._id))},C=()=>{f(!1)};return(0,kt.jsx)(a.Fragment,{children:i?(0,kt.jsxs)("div",{className:"profile-buttons",children:[(0,kt.jsxs)("div",{className:"highligh-btn button add-story",onClick:async()=>{f(!0)},children:[(0,kt.jsx)("i",{className:"fas fa-plus-circle"}),(0,kt.jsx)("span",{children:"Add to story"})]}),(0,kt.jsxs)(jn,{isOpen:l,id:"create-post-modal",onRequestClose:C,title:"Create A Post",style:{width:w?"95%":"600px"},children:[(0,kt.jsxs)("div",{className:"modal-header",children:[(0,kt.jsx)("div",{className:"modal-title",children:"Add to Story"}),(0,kt.jsx)("div",{onClick:C.bind(void 0),className:"modal-close-btn",children:(0,kt.jsx)("i",{className:"far fa-times"})})]}),(0,kt.jsx)("div",{className:"modal-body",children:(0,kt.jsxs)("div",{className:"cp-modal-container",children:[(0,kt.jsxs)("div",{className:"cpm-header",children:[(0,kt.jsx)("div",{className:"cpm-profilePic",children:(0,kt.jsx)(Un,{profilePic:r.profilePic,profile:r._id})}),(0,kt.jsx)("div",{className:"cpm-username",children:(0,kt.jsx)("h3",{children:E})})]}),(0,kt.jsxs)("form",{className:"cpm-form",onSubmit:e=>{e.preventDefault()},children:[(0,kt.jsxs)("div",{className:"cpm-attachment-control",children:[(0,kt.jsx)("div",{className:"cpm-attachment-preview",children:(0,kt.jsx)("img",{src:b.url||"",alt:"attachment preview"})}),(0,kt.jsxs)("div",{className:"cpm-attachment-upload",children:[(0,kt.jsxs)("div",{className:"cpm-attachment-upload-overlay",children:[(0,kt.jsx)("span",{className:"plus-icon"}),(0,kt.jsx)("span",{className:"overlay-text",children:"Add Photos/Videos"})]}),(0,kt.jsx)("input",{onChange:(async e=>{let t=e.currentTarget,n=e.target.files;var r=URL.createObjectURL(n[0]);_((e=>d(d({},e),{},{photo:n[0],url:r}))),Pn()(t).parents(".cpm-attachment-upload").slideUp(),Pn()(t).parents(".cpm-attachment-upload").siblings(".cpm-attachment-preview").slideDown();let i=new FormData;i.append("image",n[0]),p(!0);let a=await pa.post("/upload/",i,{headers:{"content-type":"multipart/form-data"}});if(200==a.status){let e=a.data.secure_url;if(e){const t=new Image;t.crossOrigin="Anonymous",t.src=e,t.onload=()=>{const e=document.createElement("canvas"),n=e.getContext("2d");e.width=t.width,e.height=t.height,n.drawImage(t,0,0,e.width,e.height);let r=n.getImageData(0,0,e.width,e.height).data,i=0,a=0,o=0,s=0;for(let t=0;t<r.length;t+=4)i+=r[t],a+=r[t+1],o+=r[t+2],s++;i=Math.floor(i/s),a=Math.floor(a/s),o=Math.floor(o/s);const c="linear-gradient(135deg, rgb(".concat(i,", ").concat(a,", ").concat(o,") 0%, rgba(").concat(i-30,", ").concat(a-30,", ").concat(o-30,", 0.8) 100%)");g(c)},p(!1),y(!1),_((t=>d(d({},t),{},{uploadedUrl:e,bgColors:m})))}}}).bind(void 0),name:"photos",type:"file"})]})]}),(0,kt.jsxs)("div",{className:"cpm-attachment",children:[(0,kt.jsx)("span",{className:"cpm-button-text",children:"Add Image to your story"}),(0,kt.jsx)("div",{className:"post-meta-buttons",children:(0,kt.jsx)("div",{onClick:e=>{let t=e.currentTarget;Pn()(t).parents(".cpm-attachment").siblings(".cpm-attachment-control").slideToggle()},className:"attachment-button-file"})})]}),(0,kt.jsx)("div",{className:"cpm-submit-button",children:(0,kt.jsxs)("button",{className:"button",onClick:(async e=>{if(e.preventDefault(),f(!1),!e.target.classList.containers("added")&&0!=b.uploadedUrl&&0!=m)try{e.target.classList.add("added"),200===(await pa.post("/story/create/",{image:b.uploadedUrl,storyBg:m})).status&&f(!1)}catch(t){console.log(t)}}).bind(void 0),type:"submit",children:[" ",h?"Uploading ... ":"Add to your story"]})})]})]})})]}),(0,kt.jsxs)("div",{onClick:()=>t("/settings"),className:"normal-btn button edit-profile",children:[(0,kt.jsx)("i",{className:"fas fa-pen"}),(0,kt.jsx)("span",{children:"Edit Profile"})]})]}):o?(0,kt.jsxs)("div",{className:"profile-buttons",children:[(0,kt.jsxs)("div",{onClick:e=>{let t=e.currentTarget;Pn()(t).children(".friend-options-menu").toggleClass("hide")},className:"button normal-btn  friend",children:[(0,kt.jsx)("i",{className:"fas fa-user-check"}),(0,kt.jsx)("span",{children:"Friend"}),(0,kt.jsx)("div",{className:"friend-options-menu hide",children:(0,kt.jsxs)("div",{onClick:async e=>{try{let t=e.currentTarget;pa.post("/friend/removeFriend",{profile:r._id});Pn()(t).parents(".friend").hide()}catch(t){console.log(t)}},className:"friend-options-menu-item",children:[(0,kt.jsx)("div",{className:"menu-item-icon",children:(0,kt.jsx)("i",{className:"fas fa-user-times"})}),(0,kt.jsx)("div",{className:"menu-item-text",children:"Remove Friend"})]})})]}),(0,kt.jsxs)("div",{onClick:S,className:"highligh-btn button message-button",children:[(0,kt.jsx)("i",{className:"fas fa-comment-dots"}),(0,kt.jsx)("span",{children:"Message"})]})]}):u?s?(0,kt.jsxs)("div",{className:"profile-buttons",children:[(0,kt.jsxs)("div",{onClick:async e=>{try{let t=e.currentTarget;if(!Pn()(t).hasClass("removed")){await pa.post("/friend/removeRequest",{profile:r._id});Pn()(t).addClass("removed"),Pn()(t).children("span").text("Request Cenceled")}}catch(t){console.log(t)}},className:"normal-btn button cencel-friend",children:[(0,kt.jsx)("i",{className:"fas fa-user-check"}),(0,kt.jsx)("span",{children:"Cencel Request"})]}),(0,kt.jsxs)("div",{onClick:S,className:"highligh-btn button message-button",children:[(0,kt.jsx)("i",{className:"fas fa-comment-dots"}),(0,kt.jsx)("span",{children:"Message"})]})]}):(0,kt.jsxs)("div",{className:"profile-buttons",children:[(0,kt.jsxs)("div",{onClick:async e=>{try{let t=e.currentTarget;if(!Pn()(t).hasClass("accepted")){await pa.post("/friend/reqAccept",{profile:r._id});Pn()(t).children("span").text("Accepted"),Pn()(t).addClass("Friend Accepted")}}catch(t){console.log(t)}},className:"highligh-btn button confirm-friend",children:[(0,kt.jsx)("i",{className:"fas fa-user-check"}),(0,kt.jsx)("span",{children:"Confirm Request"})]}),(0,kt.jsxs)("div",{onClick:S,className:"normal-btn button message-button",children:[(0,kt.jsx)("i",{className:"fas fa-comment-dots"}),(0,kt.jsx)("span",{children:"Message"})]})]}):(0,kt.jsxs)("div",{className:"profile-buttons",children:[(0,kt.jsxs)("div",{onClick:e=>{let t=e.currentTarget;Pn()(t).hasClass("sent")||pa.post("/friend/sendRequest/",{profile:r._id}).then((e=>{Pn()(t).children("span").text("Request Sent"),Pn()(t).addClass("sent")})).catch((e=>{console.log(e)}))},className:"highligh-btn button add-friend",children:[(0,kt.jsx)("i",{className:"fas fa-user-check"}),(0,kt.jsx)("span",{children:"Add Friend"})]}),(0,kt.jsxs)("div",{onClick:S,className:"normal-btn button message-button",children:[(0,kt.jsx)("i",{className:"fas fa-comment-dots"}),(0,kt.jsx)("span",{children:"Message"})]})]})})};var Us=function(e,t){return Us=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Us(e,t)};function Bs(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Us(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Vs=function(){return Vs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Vs.apply(this,arguments)};Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var zs=n(1185),Ws=n.n(zs);function Gs(e,t,n,r,i){void 0===i&&(i=0);var a=Js(t.width,t.height,i),o=a.width,s=a.height;return{x:Hs(e.x,o,n.width,r),y:Hs(e.y,s,n.height,r)}}function Hs(e,t,n,r){var i=t*r/2-n/2;return Zs(e,-i,i)}function Ys(e,t){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function qs(e,t){return 180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI}function Ks(e,t){return Math.min(e,Math.max(0,t))}function Xs(e,t){return t}function Qs(e,t){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}function Js(e,t,n){var r=n*Math.PI/180;return{width:Math.abs(Math.cos(r)*e)+Math.abs(Math.sin(r)*t),height:Math.abs(Math.sin(r)*e)+Math.abs(Math.cos(r)*t)}}function Zs(e,t,n){return Math.min(Math.max(e,t),n)}function $s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter((function(e){return"string"===typeof e&&e.length>0})).join(" ").trim()}var ec=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.cropperRef=a.createRef(),n.imageRef=a.createRef(),n.videoRef=a.createRef(),n.containerPosition={x:0,y:0},n.containerRef=null,n.styleRef=null,n.containerRect=null,n.mediaSize={width:0,height:0,naturalWidth:0,naturalHeight:0},n.dragStartPosition={x:0,y:0},n.dragStartCrop={x:0,y:0},n.gestureZoomStart=0,n.gestureRotationStart=0,n.isTouching=!1,n.lastPinchDistance=0,n.lastPinchRotation=0,n.rafDragTimeout=null,n.rafPinchTimeout=null,n.wheelTimer=null,n.currentDoc="undefined"!==typeof document?document:null,n.currentWindow="undefined"!==typeof window?window:null,n.resizeObserver=null,n.state={cropSize:null,hasWheelJustStarted:!1,mediaObjectFit:void 0},n.initResizeObserver=function(){if("undefined"!==typeof window.ResizeObserver&&n.containerRef){var e=!0;n.resizeObserver=new window.ResizeObserver((function(t){e?e=!1:n.computeSizes()})),n.resizeObserver.observe(n.containerRef)}},n.preventZoomSafari=function(e){return e.preventDefault()},n.cleanEvents=function(){n.currentDoc&&(n.currentDoc.removeEventListener("mousemove",n.onMouseMove),n.currentDoc.removeEventListener("mouseup",n.onDragStopped),n.currentDoc.removeEventListener("touchmove",n.onTouchMove),n.currentDoc.removeEventListener("touchend",n.onDragStopped),n.currentDoc.removeEventListener("gesturechange",n.onGestureChange),n.currentDoc.removeEventListener("gestureend",n.onGestureEnd),n.currentDoc.removeEventListener("scroll",n.onScroll))},n.clearScrollEvent=function(){n.containerRef&&n.containerRef.removeEventListener("wheel",n.onWheel),n.wheelTimer&&clearTimeout(n.wheelTimer)},n.onMediaLoad=function(){var e=n.computeSizes();e&&(n.emitCropData(),n.setInitialCrop(e)),n.props.onMediaLoaded&&n.props.onMediaLoaded(n.mediaSize)},n.setInitialCrop=function(e){if(n.props.initialCroppedAreaPercentages){var t=function(e,t,n,r,i,a){var o=Js(t.width,t.height,n),s=Zs(r.width/o.width*(100/e.width),i,a);return{crop:{x:s*o.width/2-r.width/2-o.width*s*(e.x/100),y:s*o.height/2-r.height/2-o.height*s*(e.y/100)},zoom:s}}(n.props.initialCroppedAreaPercentages,n.mediaSize,n.props.rotation,e,n.props.minZoom,n.props.maxZoom),r=t.crop,i=t.zoom;n.props.onCropChange(r),n.props.onZoomChange&&n.props.onZoomChange(i)}else if(n.props.initialCroppedAreaPixels){var a=function(e,t,n,r,i,a){void 0===n&&(n=0);var o=Js(t.naturalWidth,t.naturalHeight,n),s=Zs(function(e,t,n){var r=function(e){return e.width>e.height?e.width/e.naturalWidth:e.height/e.naturalHeight}(t);return n.height>n.width?n.height/(e.height*r):n.width/(e.width*r)}(e,t,r),i,a),c=r.height>r.width?r.height/e.height:r.width/e.width;return{crop:{x:((o.width-e.width)/2-e.x)*c,y:((o.height-e.height)/2-e.y)*c},zoom:s}}(n.props.initialCroppedAreaPixels,n.mediaSize,n.props.rotation,e,n.props.minZoom,n.props.maxZoom);r=a.crop,i=a.zoom;n.props.onCropChange(r),n.props.onZoomChange&&n.props.onZoomChange(i)}},n.computeSizes=function(){var e,t,r,i,a,o,s=n.imageRef.current||n.videoRef.current;if(s&&n.containerRef){n.containerRect=n.containerRef.getBoundingClientRect(),n.saveContainerPosition();var c=n.containerRect.width/n.containerRect.height,u=(null===(e=n.imageRef.current)||void 0===e?void 0:e.naturalWidth)||(null===(t=n.videoRef.current)||void 0===t?void 0:t.videoWidth)||0,l=(null===(r=n.imageRef.current)||void 0===r?void 0:r.naturalHeight)||(null===(i=n.videoRef.current)||void 0===i?void 0:i.videoHeight)||0,d=u/l,f=void 0;if(s.offsetWidth<u||s.offsetHeight<l)switch(n.state.mediaObjectFit){default:case"contain":f=c>d?{width:n.containerRect.height*d,height:n.containerRect.height}:{width:n.containerRect.width,height:n.containerRect.width/d};break;case"horizontal-cover":f={width:n.containerRect.width,height:n.containerRect.width/d};break;case"vertical-cover":f={width:n.containerRect.height*d,height:n.containerRect.height}}else f={width:s.offsetWidth,height:s.offsetHeight};n.mediaSize=Vs(Vs({},f),{naturalWidth:u,naturalHeight:l}),n.props.setMediaSize&&n.props.setMediaSize(n.mediaSize);var h=n.props.cropSize?n.props.cropSize:function(e,t,n,r,i,a){void 0===a&&(a=0);var o=Js(e,t,a),s=o.width,c=o.height,u=Math.min(s,n),l=Math.min(c,r);return u>l*i?{width:l*i,height:l}:{width:u,height:u/i}}(n.mediaSize.width,n.mediaSize.height,n.containerRect.width,n.containerRect.height,n.props.aspect,n.props.rotation);return(null===(a=n.state.cropSize)||void 0===a?void 0:a.height)===h.height&&(null===(o=n.state.cropSize)||void 0===o?void 0:o.width)===h.width||n.props.onCropSizeChange&&n.props.onCropSizeChange(h),n.setState({cropSize:h},n.recomputeCropPosition),n.props.setCropSize&&n.props.setCropSize(h),h}},n.saveContainerPosition=function(){if(n.containerRef){var e=n.containerRef.getBoundingClientRect();n.containerPosition={x:e.left,y:e.top}}},n.onMouseDown=function(e){n.currentDoc&&(e.preventDefault(),n.currentDoc.addEventListener("mousemove",n.onMouseMove),n.currentDoc.addEventListener("mouseup",n.onDragStopped),n.saveContainerPosition(),n.onDragStart(t.getMousePoint(e)))},n.onMouseMove=function(e){return n.onDrag(t.getMousePoint(e))},n.onScroll=function(e){n.currentDoc&&(e.preventDefault(),n.saveContainerPosition())},n.onTouchStart=function(e){n.currentDoc&&(n.isTouching=!0,n.props.onTouchRequest&&!n.props.onTouchRequest(e)||(n.currentDoc.addEventListener("touchmove",n.onTouchMove,{passive:!1}),n.currentDoc.addEventListener("touchend",n.onDragStopped),n.saveContainerPosition(),2===e.touches.length?n.onPinchStart(e):1===e.touches.length&&n.onDragStart(t.getTouchPoint(e.touches[0]))))},n.onTouchMove=function(e){e.preventDefault(),2===e.touches.length?n.onPinchMove(e):1===e.touches.length&&n.onDrag(t.getTouchPoint(e.touches[0]))},n.onGestureStart=function(e){n.currentDoc&&(e.preventDefault(),n.currentDoc.addEventListener("gesturechange",n.onGestureChange),n.currentDoc.addEventListener("gestureend",n.onGestureEnd),n.gestureZoomStart=n.props.zoom,n.gestureRotationStart=n.props.rotation)},n.onGestureChange=function(e){if(e.preventDefault(),!n.isTouching){var r=t.getMousePoint(e),i=n.gestureZoomStart-1+e.scale;if(n.setNewZoom(i,r,{shouldUpdatePosition:!0}),n.props.onRotationChange){var a=n.gestureRotationStart+e.rotation;n.props.onRotationChange(a)}}},n.onGestureEnd=function(e){n.cleanEvents()},n.onDragStart=function(e){var t,r,i=e.x,a=e.y;n.dragStartPosition={x:i,y:a},n.dragStartCrop=Vs({},n.props.crop),null===(r=(t=n.props).onInteractionStart)||void 0===r||r.call(t)},n.onDrag=function(e){var t=e.x,r=e.y;n.currentWindow&&(n.rafDragTimeout&&n.currentWindow.cancelAnimationFrame(n.rafDragTimeout),n.rafDragTimeout=n.currentWindow.requestAnimationFrame((function(){if(n.state.cropSize&&void 0!==t&&void 0!==r){var e=t-n.dragStartPosition.x,i=r-n.dragStartPosition.y,a={x:n.dragStartCrop.x+e,y:n.dragStartCrop.y+i},o=n.props.restrictPosition?Gs(a,n.mediaSize,n.state.cropSize,n.props.zoom,n.props.rotation):a;n.props.onCropChange(o)}})))},n.onDragStopped=function(){var e,t;n.isTouching=!1,n.cleanEvents(),n.emitCropData(),null===(t=(e=n.props).onInteractionEnd)||void 0===t||t.call(e)},n.onWheel=function(e){if(n.currentWindow&&(!n.props.onWheelRequest||n.props.onWheelRequest(e))){e.preventDefault();var r=t.getMousePoint(e),i=Ws()(e).pixelY,a=n.props.zoom-i*n.props.zoomSpeed/200;n.setNewZoom(a,r,{shouldUpdatePosition:!0}),n.state.hasWheelJustStarted||n.setState({hasWheelJustStarted:!0},(function(){var e,t;return null===(t=(e=n.props).onInteractionStart)||void 0===t?void 0:t.call(e)})),n.wheelTimer&&clearTimeout(n.wheelTimer),n.wheelTimer=n.currentWindow.setTimeout((function(){return n.setState({hasWheelJustStarted:!1},(function(){var e,t;return null===(t=(e=n.props).onInteractionEnd)||void 0===t?void 0:t.call(e)}))}),250)}},n.getPointOnContainer=function(e,t){var r=e.x,i=e.y;if(!n.containerRect)throw new Error("The Cropper is not mounted");return{x:n.containerRect.width/2-(r-t.x),y:n.containerRect.height/2-(i-t.y)}},n.getPointOnMedia=function(e){var t=e.x,r=e.y,i=n.props,a=i.crop,o=i.zoom;return{x:(t+a.x)/o,y:(r+a.y)/o}},n.setNewZoom=function(e,t,r){var i=(void 0===r?{}:r).shouldUpdatePosition,a=void 0===i||i;if(n.state.cropSize&&n.props.onZoomChange){var o=Zs(e,n.props.minZoom,n.props.maxZoom);if(a){var s=n.getPointOnContainer(t,n.containerPosition),c=n.getPointOnMedia(s),u={x:c.x*o-s.x,y:c.y*o-s.y},l=n.props.restrictPosition?Gs(u,n.mediaSize,n.state.cropSize,o,n.props.rotation):u;n.props.onCropChange(l)}n.props.onZoomChange(o)}},n.getCropData=function(){return n.state.cropSize?function(e,t,n,r,i,a,o){void 0===a&&(a=0),void 0===o&&(o=!0);var s=o?Ks:Xs,c=Js(t.width,t.height,a),u=Js(t.naturalWidth,t.naturalHeight,a),l={x:s(100,((c.width-n.width/i)/2-e.x/i)/c.width*100),y:s(100,((c.height-n.height/i)/2-e.y/i)/c.height*100),width:s(100,n.width/c.width*100/i),height:s(100,n.height/c.height*100/i)},d=Math.round(s(u.width,l.width*u.width/100)),f=Math.round(s(u.height,l.height*u.height/100)),h=u.width>=u.height*r?{width:Math.round(f*r),height:f}:{width:d,height:Math.round(d/r)};return{croppedAreaPercentages:l,croppedAreaPixels:Vs(Vs({},h),{x:Math.round(s(u.width-h.width,l.x*u.width/100)),y:Math.round(s(u.height-h.height,l.y*u.height/100))})}}(n.props.restrictPosition?Gs(n.props.crop,n.mediaSize,n.state.cropSize,n.props.zoom,n.props.rotation):n.props.crop,n.mediaSize,n.state.cropSize,n.getAspect(),n.props.zoom,n.props.rotation,n.props.restrictPosition):null},n.emitCropData=function(){var e=n.getCropData();if(e){var t=e.croppedAreaPercentages,r=e.croppedAreaPixels;n.props.onCropComplete&&n.props.onCropComplete(t,r),n.props.onCropAreaChange&&n.props.onCropAreaChange(t,r)}},n.emitCropAreaChange=function(){var e=n.getCropData();if(e){var t=e.croppedAreaPercentages,r=e.croppedAreaPixels;n.props.onCropAreaChange&&n.props.onCropAreaChange(t,r)}},n.recomputeCropPosition=function(){if(n.state.cropSize){var e=n.props.restrictPosition?Gs(n.props.crop,n.mediaSize,n.state.cropSize,n.props.zoom,n.props.rotation):n.props.crop;n.props.onCropChange(e),n.emitCropData()}},n.onKeyDown=function(e){var t,r,i=n.props,a=i.crop,o=i.onCropChange,s=i.keyboardStep,c=i.zoom,u=i.rotation,l=s;if(n.state.cropSize){e.shiftKey&&(l*=.2);var d=Vs({},a);switch(e.key){case"ArrowUp":d.y-=l,e.preventDefault();break;case"ArrowDown":d.y+=l,e.preventDefault();break;case"ArrowLeft":d.x-=l,e.preventDefault();break;case"ArrowRight":d.x+=l,e.preventDefault();break;default:return}n.props.restrictPosition&&(d=Gs(d,n.mediaSize,n.state.cropSize,c,u)),e.repeat||null===(r=(t=n.props).onInteractionStart)||void 0===r||r.call(t),o(d)}},n.onKeyUp=function(e){var t,r;switch(e.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":e.preventDefault();break;default:return}n.emitCropData(),null===(r=(t=n.props).onInteractionEnd)||void 0===r||r.call(t)},n}return Bs(t,e),t.prototype.componentDidMount=function(){this.currentDoc&&this.currentWindow&&(this.containerRef&&(this.containerRef.ownerDocument&&(this.currentDoc=this.containerRef.ownerDocument),this.currentDoc.defaultView&&(this.currentWindow=this.currentDoc.defaultView),this.initResizeObserver(),"undefined"===typeof window.ResizeObserver&&this.currentWindow.addEventListener("resize",this.computeSizes),this.props.zoomWithScroll&&this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}),this.containerRef.addEventListener("gesturestart",this.onGestureStart)),this.currentDoc.addEventListener("scroll",this.onScroll),this.props.disableAutomaticStylesInjection||(this.styleRef=this.currentDoc.createElement("style"),this.styleRef.setAttribute("type","text/css"),this.props.nonce&&this.styleRef.setAttribute("nonce",this.props.nonce),this.styleRef.innerHTML=".reactEasyCrop_Container {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: hidden;\n  user-select: none;\n  touch-action: none;\n  cursor: move;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.reactEasyCrop_Image,\n.reactEasyCrop_Video {\n  will-change: transform; /* this improves performances and prevent painting issues on iOS Chrome */\n}\n\n.reactEasyCrop_Contain {\n  max-width: 100%;\n  max-height: 100%;\n  margin: auto;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n}\n.reactEasyCrop_Cover_Horizontal {\n  width: 100%;\n  height: auto;\n}\n.reactEasyCrop_Cover_Vertical {\n  width: auto;\n  height: 100%;\n}\n\n.reactEasyCrop_CropArea {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  border: 1px solid rgba(255, 255, 255, 0.5);\n  box-sizing: border-box;\n  box-shadow: 0 0 0 9999em;\n  color: rgba(0, 0, 0, 0.5);\n  overflow: hidden;\n}\n\n.reactEasyCrop_CropAreaRound {\n  border-radius: 50%;\n}\n\n.reactEasyCrop_CropAreaGrid::before {\n  content: ' ';\n  box-sizing: border-box;\n  position: absolute;\n  border: 1px solid rgba(255, 255, 255, 0.5);\n  top: 0;\n  bottom: 0;\n  left: 33.33%;\n  right: 33.33%;\n  border-top: 0;\n  border-bottom: 0;\n}\n\n.reactEasyCrop_CropAreaGrid::after {\n  content: ' ';\n  box-sizing: border-box;\n  position: absolute;\n  border: 1px solid rgba(255, 255, 255, 0.5);\n  top: 33.33%;\n  bottom: 33.33%;\n  left: 0;\n  right: 0;\n  border-left: 0;\n  border-right: 0;\n}\n",this.currentDoc.head.appendChild(this.styleRef)),this.imageRef.current&&this.imageRef.current.complete&&this.onMediaLoad(),this.props.setImageRef&&this.props.setImageRef(this.imageRef),this.props.setVideoRef&&this.props.setVideoRef(this.videoRef),this.props.setCropperRef&&this.props.setCropperRef(this.cropperRef))},t.prototype.componentWillUnmount=function(){var e,t;this.currentDoc&&this.currentWindow&&("undefined"===typeof window.ResizeObserver&&this.currentWindow.removeEventListener("resize",this.computeSizes),null===(e=this.resizeObserver)||void 0===e||e.disconnect(),this.containerRef&&this.containerRef.removeEventListener("gesturestart",this.preventZoomSafari),this.styleRef&&(null===(t=this.styleRef.parentNode)||void 0===t||t.removeChild(this.styleRef)),this.cleanEvents(),this.props.zoomWithScroll&&this.clearScrollEvent())},t.prototype.componentDidUpdate=function(e){var t,n,r,i,a,o,s,c,u;e.rotation!==this.props.rotation?(this.computeSizes(),this.recomputeCropPosition()):e.aspect!==this.props.aspect||e.objectFit!==this.props.objectFit?this.computeSizes():e.zoom!==this.props.zoom?this.recomputeCropPosition():(null===(t=e.cropSize)||void 0===t?void 0:t.height)!==(null===(n=this.props.cropSize)||void 0===n?void 0:n.height)||(null===(r=e.cropSize)||void 0===r?void 0:r.width)!==(null===(i=this.props.cropSize)||void 0===i?void 0:i.width)?this.computeSizes():(null===(a=e.crop)||void 0===a?void 0:a.x)===(null===(o=this.props.crop)||void 0===o?void 0:o.x)&&(null===(s=e.crop)||void 0===s?void 0:s.y)===(null===(c=this.props.crop)||void 0===c?void 0:c.y)||this.emitCropAreaChange(),e.zoomWithScroll!==this.props.zoomWithScroll&&this.containerRef&&(this.props.zoomWithScroll?this.containerRef.addEventListener("wheel",this.onWheel,{passive:!1}):this.clearScrollEvent()),e.video!==this.props.video&&(null===(u=this.videoRef.current)||void 0===u||u.load());var l=this.getObjectFit();l!==this.state.mediaObjectFit&&this.setState({mediaObjectFit:l},this.computeSizes)},t.prototype.getAspect=function(){var e=this.props,t=e.cropSize,n=e.aspect;return t?t.width/t.height:n},t.prototype.getObjectFit=function(){var e,t,n,r;if("cover"===this.props.objectFit){if((this.imageRef.current||this.videoRef.current)&&this.containerRef){this.containerRect=this.containerRef.getBoundingClientRect();var i=this.containerRect.width/this.containerRect.height;return((null===(e=this.imageRef.current)||void 0===e?void 0:e.naturalWidth)||(null===(t=this.videoRef.current)||void 0===t?void 0:t.videoWidth)||0)/((null===(n=this.imageRef.current)||void 0===n?void 0:n.naturalHeight)||(null===(r=this.videoRef.current)||void 0===r?void 0:r.videoHeight)||0)<i?"horizontal-cover":"vertical-cover"}return"horizontal-cover"}return this.props.objectFit},t.prototype.onPinchStart=function(e){var n=t.getTouchPoint(e.touches[0]),r=t.getTouchPoint(e.touches[1]);this.lastPinchDistance=Ys(n,r),this.lastPinchRotation=qs(n,r),this.onDragStart(Qs(n,r))},t.prototype.onPinchMove=function(e){var n=this;if(this.currentDoc&&this.currentWindow){var r=t.getTouchPoint(e.touches[0]),i=t.getTouchPoint(e.touches[1]),a=Qs(r,i);this.onDrag(a),this.rafPinchTimeout&&this.currentWindow.cancelAnimationFrame(this.rafPinchTimeout),this.rafPinchTimeout=this.currentWindow.requestAnimationFrame((function(){var e=Ys(r,i),t=n.props.zoom*(e/n.lastPinchDistance);n.setNewZoom(t,a,{shouldUpdatePosition:!1}),n.lastPinchDistance=e;var o=qs(r,i),s=n.props.rotation+(o-n.lastPinchRotation);n.props.onRotationChange&&n.props.onRotationChange(s),n.lastPinchRotation=o}))}},t.prototype.render=function(){var e,t=this,n=this.props,r=n.image,i=n.video,o=n.mediaProps,s=n.cropperProps,c=n.transform,u=n.crop,l=u.x,d=u.y,f=n.rotation,h=n.zoom,p=n.cropShape,m=n.showGrid,g=n.style,v=g.containerStyle,y=g.cropAreaStyle,b=g.mediaStyle,_=n.classes,w=_.containerClassName,E=_.cropAreaClassName,S=_.mediaClassName,C=null!==(e=this.state.mediaObjectFit)&&void 0!==e?e:this.getObjectFit();return a.createElement("div",{onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,ref:function(e){return t.containerRef=e},"data-testid":"container",style:v,className:$s("reactEasyCrop_Container",w)},r?a.createElement("img",Vs({alt:"",className:$s("reactEasyCrop_Image","contain"===C&&"reactEasyCrop_Contain","horizontal-cover"===C&&"reactEasyCrop_Cover_Horizontal","vertical-cover"===C&&"reactEasyCrop_Cover_Vertical",S)},o,{src:r,ref:this.imageRef,style:Vs(Vs({},b),{transform:c||"translate(".concat(l,"px, ").concat(d,"px) rotate(").concat(f,"deg) scale(").concat(h,")")}),onLoad:this.onMediaLoad})):i&&a.createElement("video",Vs({autoPlay:!0,playsInline:!0,loop:!0,muted:!0,className:$s("reactEasyCrop_Video","contain"===C&&"reactEasyCrop_Contain","horizontal-cover"===C&&"reactEasyCrop_Cover_Horizontal","vertical-cover"===C&&"reactEasyCrop_Cover_Vertical",S)},o,{ref:this.videoRef,onLoadedMetadata:this.onMediaLoad,style:Vs(Vs({},b),{transform:c||"translate(".concat(l,"px, ").concat(d,"px) rotate(").concat(f,"deg) scale(").concat(h,")")}),controls:!1}),(Array.isArray(i)?i:[{src:i}]).map((function(e){return a.createElement("source",Vs({key:e.src},e))}))),this.state.cropSize&&a.createElement("div",Vs({ref:this.cropperRef,style:Vs(Vs({},y),{width:this.state.cropSize.width,height:this.state.cropSize.height}),tabIndex:0,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,"data-testid":"cropper",className:$s("reactEasyCrop_CropArea","round"===p&&"reactEasyCrop_CropAreaRound",m&&"reactEasyCrop_CropAreaGrid",E)},s)))},t.defaultProps={zoom:1,rotation:0,aspect:4/3,maxZoom:3,minZoom:1,cropShape:"rect",objectFit:"contain",showGrid:!0,style:{},classes:{},mediaProps:{},cropperProps:{},zoomSpeed:1,restrictPosition:!0,zoomWithScroll:!0,keyboardStep:1},t.getMousePoint=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},t.getTouchPoint=function(e){return{x:Number(e.clientX),y:Number(e.clientY)}},t}(a.Component);const tc=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsx)("div",{className:"skeleton-card no-border",children:(0,kt.jsx)("div",{className:"skeleton-main"})},t)))};const nc=e=>{let{profileData:t}=e;Xe();const[n,r]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1),[s,c]=(0,a.useState)(!1),[u,l]=(0,a.useState)(!1),[d,f]=(0,a.useState)(!1),[h,p]=(0,a.useState)(t.profilePic||""),[m,g]=(0,a.useState)(null),[v,y]=(0,a.useState)(null),[b,_]=(0,a.useState)({x:0,y:0}),[w,E]=(0,a.useState)(null),[S,C]=(0,a.useState)(1);let x=En((e=>e.profile));(0,a.useEffect)((()=>{p(""),f(!1)}),[On.param]),(0,a.useEffect)((()=>{t&&(f(!1),(e=>{const t=new Image;t.src=e,t.onload=()=>f(!0),t.onerror=()=>f(!1)})(t.coverPic))}),[t,On.param]),(0,a.useEffect)((()=>{1==d&&p(t.coverPic)}),[d]);const T=(e=>{const[t,n]=(0,a.useState)(window.matchMedia(e).matches);return(0,a.useEffect)((()=>{const t=window.matchMedia(e),r=e=>n(e.matches);return t.addEventListener("change",r),()=>t.removeEventListener("change",r)}),[e]),t})("(max-width: 768px)");let R=()=>{l(!1)};var I={fontSize:T?"18px":"30px"};const N=(0,a.useCallback)(((e,t)=>{E(t)}),[]),A=(0,a.useCallback)((async()=>{if(m)try{const i=await(e=URL.createObjectURL(m),t=w,n=1430,r=450,new Promise(((i,a)=>{const o=new Image;o.src=e,o.onload=()=>{const e=document.createElement("canvas");e.width=n,e.height=r,e.getContext("2d").drawImage(o,t.x,t.y,t.width,t.height,0,0,n,r),e.toBlob((e=>{if(!e)return void a(new Error("Canvas is empty"));const t=URL.createObjectURL(e);i(t)}),"image/jpeg")},o.onerror=a})));if(i)return y(i),!0}catch(Vc){console.error(Vc)}var e,t,n,r}),[m&&URL.createObjectURL(m),w]);let k=x._id===t._id;return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{className:"cover-photo-container",children:[d?(0,kt.jsx)("img",{onClick:()=>{l(!0)},className:"cover-photo",src:h,alt:"cover"}):(0,kt.jsx)(tc,{count:1}),k&&(0,kt.jsxs)("div",{className:"upload-cover-photo",onClick:()=>{r(!0)},children:[(0,kt.jsx)("i",{className:"fa fa-camera-alt"}),(0,kt.jsx)("span",{children:"Upload Cover Photo"})]}),(0,kt.jsxs)(jn,{title:"View Cover Photo",style:{width:T?"95%":"600px",top:"50%"},isOpen:u,onRequestClose:R,id:"cp-view-modal",children:[(0,kt.jsxs)("div",{className:"modal-header",children:[(0,kt.jsx)("div",{className:"modal-title",style:I,children:" View Profile Picture"}),(0,kt.jsx)("div",{onClick:R,className:"modal-close-btn",children:(0,kt.jsx)("i",{className:"far fa-times"})})]}),(0,kt.jsx)("div",{className:"modal-body text-center",children:(0,kt.jsx)("img",{src:h,className:"w-100",alt:"Cover Pic View"})})]}),(0,kt.jsxs)(jn,{title:"Upload Cover Photo",style:{width:"500px",top:"20%",top:"50%"},isOpen:n,onRequestClose:()=>{r(!1)},id:"cp-upload-modal",children:[(0,kt.jsxs)("div",{className:"modal-header",children:[(0,kt.jsx)("div",{className:"modal-title",children:"Upload Cover Photo"}),(0,kt.jsx)("div",{onClick:()=>{r(!1)},className:"modal-close-btn",children:(0,kt.jsx)("i",{className:"far fa-times"})})]}),(0,kt.jsxs)("div",{className:"modal-body",children:[(0,kt.jsx)("div",{className:"modal-upload-preview",children:m&&(0,kt.jsx)(ec,{image:URL.createObjectURL(m),crop:b,zoom:S,aspect:1430/450,onCropChange:_,onZoomChange:C,onCropComplete:N})}),(0,kt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!h)return A(),(async()=>{c(!1),o(!0);let e=new FormData;e.append("image",m);let t=await pa.post("/upload",e,{headers:{"content-type":"multipart/form-data"}});if(200===t.status){let e=t.data.secure_url;o(!1),p(e)}})(),!0;try{if(h){o(!0);let e=new FormData;e.append("coverPicUrl",h),e.append("profile",t._id),200===(await pa.post("/profile/update/coverPic",e,{headers:{"content-type":"multipart/form-data"}})).status&&(r(!1),window.location.reload())}}catch(n){console.log(n)}},children:[(0,kt.jsx)("input",{name:"cover_pic",onChange:(async e=>{g(e.target.files[0]||""),c(!0)}).bind(void 0),className:"cp-upload-input",type:"file"}),(0,kt.jsx)("button",{type:"submit",className:"cp-upload-button",children:i?"Uploading...":s?"Crop":"Update Cover Picture"})]})]})]})]})})};var rc=n(4872),ic=n.n(rc);const ac=e=>{let{profileData:t}=e,{profile:n}=Xe(),r=En((e=>e.profile));const[i,o]=(0,a.useState)(!1),[s,c]=(0,a.useState)(!1),[u,l]=(0,a.useState)(),[d,f]=(0,a.useState)(t.profilePic),[h,p]=(0,a.useState)(t.profilePic),[m,g]=(0,a.useState)(!1),[v,y]=(0,a.useState)("");(0,a.useEffect)((()=>{pa.get("/profile/hasStory?profileId="+n).then((e=>{200==e.status&&g(e.data.hasStory)}))}),[n]),(0,a.useEffect)((()=>{f(t?Ns(t.profilePic)?t.profilePic:"":"https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png")}),[t]),(0,a.useEffect)((e=>{d&&Fn(d,p)}),[d]);let b="";let _=()=>{o(!1)},w=e=>{c(!1)},E=r._id===t._id;var S=(e=>{const[t,n]=(0,a.useState)(window.matchMedia(e).matches);return(0,a.useEffect)((()=>{const t=window.matchMedia(e),r=e=>n(e.matches);return t.addEventListener("change",r),()=>t.removeEventListener("change",r)}),[e]),t})("(max-width: 768px)"),C={fontSize:S?"18px":"30px"};return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{className:"profile-pic",children:[(0,kt.jsx)("div",{className:"profilePic-container ".concat("yes"==m?"has-story":""),onClick:()=>{c(!0)},children:h?(0,kt.jsx)("img",{src:d,alt:""}):(0,kt.jsx)(Is,{})}),E&&(0,kt.jsx)("div",{onClick:e=>{o(!0)},className:"upload-profile-pic",children:(0,kt.jsx)("i",{className:"fa fa-camera-alt"})}),(0,kt.jsxs)(jn,{title:"View Profile Picture",style:{width:S?"95%":"600px",top:"50%"},isOpen:s,onRequestClose:w,id:"pp-view-modal",children:[(0,kt.jsxs)("div",{className:"modal-header",children:[(0,kt.jsx)("div",{className:"modal-title",style:C,children:" View Profile Picture"}),(0,kt.jsx)("div",{onClick:w,className:"modal-close-btn",children:(0,kt.jsx)("i",{className:"far fa-times"})})]}),(0,kt.jsx)("div",{className:"modal-body text-center",children:(0,kt.jsx)("img",{src:t.profilePic,className:"w-100",alt:"Ikram"})})]}),(0,kt.jsxs)(jn,{title:"Upload Profile Pics",style:{width:"600px",maxWidth:"95%",top:"50%"},isOpen:i,onRequestClose:_,id:"pp-upload-modal",children:[(0,kt.jsxs)("div",{className:"modal-header",children:[(0,kt.jsx)("div",{className:"modal-title",children:" Upload Profile Picture"}),(0,kt.jsx)("div",{onClick:_,className:"modal-close-btn",children:(0,kt.jsx)("i",{className:"far fa-times"})})]}),(0,kt.jsx)("div",{className:"modal-body",children:(0,kt.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),o(!1);try{b.getImageScaledToCanvas().toBlob((async e=>{let n=new File([e],"".concat(t._id,".png"),{type:e.type,lastModified:(new Date).getTime()}),r=new FormData;r.append("image",n);let i=await pa.post("/upload",r,{headers:{"Content-Type":"multipart/form-data"}});if(200===i.status){let e=i.data.secure_url,t=new FormData;t.append("profilePicUrl",e),t.append("type","profilePic"),t.append("caption",v),200===(await pa.post("/profile/update/profilePic",t,{headers:{"Content-Type":"multipart/form-data"}})).status&&window.location.reload()}}))}catch(n){console.log(n)}},children:[(0,kt.jsx)("textarea",{onChange:(e=>{y(e.target.value)}).bind(void 0),placeholder:"What's in your Mind?",name:"caption",className:"post-caption",value:v}),u&&(0,kt.jsx)(ic(),{ref:e=>{b=e},image:URL.createObjectURL(u),width:450,height:450,border:50,borderRadius:300,color:[0,0,0,.5],scale:1.1,rotate:0,style:{margin:"auto",marginBottom:"20px",maxWidth:"100%",height:"100%",width:"100%"}}),(0,kt.jsx)("input",{onChange:e=>{l(e.target.files[0])},name:"profilePic",className:"pp-upload-input",type:"file"}),(0,kt.jsx)("button",{className:"pp-upload-button",type:"submit",children:"Upload"})]})})]})]})})};const oc=e=>{let t=Xe(),n=kn(),r=En((e=>e.profile))||{},i=r._id,[o,s]=(0,a.useState)(t.profile===i||t.profile==r.username),[c,u]=(0,a.useState)(o?d({},r):{});(0,a.useEffect)((()=>{s(t.profile===i),r.friends&&r.friends.filter((e=>{e._id===t.profile&&f(!0)}))}),[r]);let[l,f]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(!o){n(ds(!0));try{pa.post("/profile",{profile:t.profile}).then((e=>{200===e.status&&(u(e.data),n(ds(!1)))})).catch((e=>{console.log(e)}))}catch(e){console(e)}}}),[t]);let h="/"+c._id+"/";const p=()=>(0,kt.jsxs)("div",{className:"animate-pulse flex flex-col items-center space-y-4",children:[(0,kt.jsx)("div",{className:"w-24 h-24 rounded-full bg-gray-300"}),(0,kt.jsx)("div",{className:"w-40 h-6 bg-gray-300 rounded"}),(0,kt.jsx)("div",{className:"w-60 h-4 bg-gray-300 rounded"})]});let m=e=>{Pn()(e.currentTarget).siblings().removeClass("active")};return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{id:"profile",children:[(0,kt.jsxs)("div",{className:"profile-header",children:[c?(0,kt.jsx)(nc,{profileData:c}):(0,kt.jsx)(p,{}),(0,kt.jsxs)("div",{className:"profile-info-container",children:[(0,kt.jsx)(ac,{profileData:c}),(0,kt.jsxs)("div",{className:"profile-info",children:[(0,kt.jsxs)("div",{className:"profile-name",children:[(0,kt.jsxs)("h3",{className:"full-name",children:[c.user&&c.user.firstName," ",c.user&&c.user.surname," ",(null===c||void 0===c?void 0:c.nickname)&&(0,kt.jsxs)("span",{className:"nickname",children:["(",c.nickname,")"]})]}),(0,kt.jsx)("div",{className:"friends-count",children:(0,kt.jsxs)(Tt,{className:"text-decoration-none",to:"/".concat(c._id,"/friends"),children:[c.friends&&c.friends.length," Friends"]})})]}),(0,kt.jsx)(Fs,{profileData:c,isAuth:o,isFriend:l})]})]}),(0,kt.jsxs)("div",{className:"profile-info-tab-navigator",children:[(0,kt.jsx)("div",{className:"header-nav-menu",children:(0,kt.jsxs)("div",{className:"header-nav-menu-container",children:[(0,kt.jsx)(Rt,{to:h,onClick:m,className:"header-nav-menu-item",children:"Posts"}),(0,kt.jsx)(Rt,{to:h+"about",onClick:m,className:"header-nav-menu-item",children:"About"}),(0,kt.jsx)(Rt,{to:h+"friends",onClick:m,className:"header-nav-menu-item",children:" Friends"}),(0,kt.jsx)(Rt,{to:h+"images",onClick:m,className:"header-nav-menu-item",children:"Images"}),(0,kt.jsx)(Rt,{to:h+"videos",onClick:m,className:"header-nav-menu-item",children:"Videos"})]})}),(0,kt.jsx)("div",{className:"options-menu",children:(0,kt.jsx)("i",{className:"fa fa-ellipsis-h"})})]})]}),(0,kt.jsx)("div",{className:"profile-content-container",children:(0,kt.jsx)(lt,{})})]})})};const sc=()=>{let e=En((e=>e.profile));return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{id:"friends",children:[(0,kt.jsxs)("div",{className:"friends-sidebar",children:[(0,kt.jsx)("h4",{className:"page-title",children:"Friends"}),(0,kt.jsxs)("div",{className:"friends-sidebar-menu",children:[(0,kt.jsxs)(Rt,{to:"/friends/",className:"friends-sidebar-menu-item",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"fas fa-user-friends"})}),(0,kt.jsx)("span",{className:"text",children:"Home"})]}),(0,kt.jsxs)(Rt,{to:"/friends/requests",className:"friends-sidebar-menu-item",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"fas fa-user-edit"})}),(0,kt.jsx)("span",{className:"text",children:"Friend Requests"})]}),(0,kt.jsxs)(Rt,{to:"/friends/suggestions",className:"friends-sidebar-menu-item",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"fas fa-user-plus"})}),(0,kt.jsx)("span",{className:"text",children:"Suggestions"})]}),(0,kt.jsxs)(Rt,{to:"/".concat(e?e._id:"","/friends"),className:"friends-sidebar-menu-item",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"fas fa-users"})}),(0,kt.jsx)("span",{className:"text",children:"All Freinds"})]})]})]}),(0,kt.jsx)("div",{className:"friends-content",children:(0,kt.jsx)(lt,{})})]})})},cc=e=>{let{item:t,myProfile:n,setReplies:r,comment:i,replies:o}=e,s=n._id,[c,u]=(0,a.useState)(!1),[l,f]=(0,a.useState)(t.reacts.length),[h,p]=(0,a.useState)(!1),[m,g]=(0,a.useState)({body:null,attachment:null});return(0,kt.jsxs)("div",{className:"reply-container",children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:t.author.profilePic,profile:t.author._id})}),(0,kt.jsxs)("div",{className:"comment-info",children:[(0,kt.jsxs)("div",{className:"comment-box",children:[(0,kt.jsxs)("div",{className:"name-comment",children:[(0,kt.jsx)("div",{className:"author-name",children:(0,kt.jsx)(Tt,{to:"/".concat(t.author._id),children:t.author.fullName})}),(0,kt.jsx)("p",{className:"comment-text",children:t.body})]}),t.author._id==s&&(0,kt.jsxs)("div",{className:"options-icon",onClick:(e=>{u(!c)}).bind(void 0),children:[(0,kt.jsx)("i",{className:"far fa-ellipsis-h"}),(0,kt.jsx)("div",{className:"options-container ".concat(c&&"open"),children:(0,kt.jsx)("button",{"data-id":t._id,onClick:(async e=>{let t=e.currentTarget.dataset.id;200==(await pa.post("/comment/deleteReply",{replyId:t})).status&&Pn()(e.target).parents(".reply-container").remove()}).bind(void 0),className:"comment-option text-danger",children:"Delete Reply"})})]})]}),(0,kt.jsxs)("div",{className:"comment-react",children:[(0,kt.jsxs)("div",{className:"like button ".concat(t.reacts.includes(s)&&"reacted"),onClick:(async e=>{let t=e.target.dataset.id;if(Pn()(e.target).hasClass("reacted")){200==(await pa.post("/comment/reply/removeReact",{replyId:t,myId:s})).status&&(f(l-1),Pn()(e.target).removeClass("reacted"))}else{200==(await pa.post("/comment/reply/addReact",{replyId:t,myId:s})).status&&(f(l+1),Pn()(e.target).addClass("reacted"))}}).bind(void 0),"data-id":t._id,children:["Like ","".concat(l>0?"(".concat(l,")"):"")]}),(0,kt.jsx)("div",{className:"reply button",onClick:(e=>{p(!h)}).bind(void 0),"data-id":t._id,children:"Reply"}),(0,kt.jsx)("div",{className:"comment-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:t.createdAt})})]}),h&&(0,kt.jsx)("div",{className:"new-reply",children:(0,kt.jsxs)("div",{className:"comment-field",children:[(0,kt.jsx)("input",{onKeyUp:async e=>{if(e.preventDefault(),13===e.keyCode){let e=i._id;if(m){let t=await pa.post("/comment/addReply",{replyMsg:m.body,authorId:n._id,commentId:e});if(200==t.status){p(!1);let e=t.data;r((t=>[...t,e]))}}}},onChange:(async e=>{g((t=>d(d({},t),{},{body:e.target.value})))}).bind(void 0),className:"field-comment-text",type:"text","data-reply":t._id,placeholder:"Reply to ".concat(t.author.fullName)}),(0,kt.jsx)("div",{onClick:(async e=>{let t=i._id;if(m){let e=await pa.post("/comment/addReply",{replyMsg:m.body,authorId:n._id,commentId:t});if(200==e.status){p(!1);let t=e.data._id;r((e=>[...e,t]))}}}).bind(void 0),"data-reply":t._id,className:"comment-attachment",children:(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-paper-plane"})})})]})})]})]})},uc=e=>{var t;let n=e.watch||{},r=e.myProfile?e.myProfile:{},i=r._id,[o,s]=(0,a.useState)(e.comment),[c,u]=(0,a.useState)(0),[l,f]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[m,g]=(0,a.useState)(null===(t=e.comment)||void 0===t?void 0:t.replies),[v,y]=(0,a.useState)({body:null,attachment:null});(0,a.useEffect)((()=>{s(e.comment),u(e.comment.reacts.length||0),f(e.comment.reacts.includes(i))}),[e]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"comment-container comment-id-".concat(o._id),children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:o.author.profilePic,profile:o.author._id})}),(0,kt.jsxs)("div",{className:"comment-info",children:[(0,kt.jsxs)("div",{className:"comment-box",children:[(0,kt.jsxs)("div",{className:"name-comment",children:[(0,kt.jsx)("div",{className:"author-name",children:(0,kt.jsx)(Tt,{to:"/".concat(o.author._id),children:o.author.user.firstName+" "+o.author.user.surname})}),(0,kt.jsx)("p",{className:"comment-text",children:o.body}),o.attachment&&(0,kt.jsx)("div",{className:"comment-attachment-container",children:(0,kt.jsx)("img",{src:o.attachment,alt:"attachment"})})]}),o.author._id==r._id?(0,kt.jsxs)("div",{onClick:e=>{Pn()(e.currentTarget).children(".options-container").hasClass("open")?Pn()(e.currentTarget).children(".options-container").removeClass("open"):Pn()(e.currentTarget).children(".options-container").addClass("open")},className:"options-icon",children:[(0,kt.jsx)("i",{className:"far fa-ellipsis-h"}),(0,kt.jsx)("div",{className:"options-container",children:(0,kt.jsx)("button",{dataid:o._id,onClick:(async e=>{try{let t=Pn()(e.currentTarget).attr("dataid"),i=n._id;Pn()(e.currentTarget).parents(".comment-container").remove();let a=await pa.post("/comment/deleteComment",{commentId:t,watchId:i});if(200===a.status){a.data.author=r}}catch(t){console.log(t)}}).bind(void 0),className:"comment-option text-danger",children:"Delete Comment"})})]}):""]}),(0,kt.jsxs)("div",{className:"comment-react",children:[(0,kt.jsxs)("div",{className:"like button ".concat(l?"reacted":""),onClick:(async e=>{let t=e.currentTarget.dataset.id;if(Pn()(e.currentTarget).hasClass("reacted")){200==(await pa.post("/comment/removeReact",{commentId:t,reactorId:i})).status&&(Pn()(e.target).removeClass("reacted"),u((e=>e-1)))}else{200==(await pa.post("/comment/addReact",{commentId:t,reactorId:i})).status&&(u((e=>e+1)),Pn()(e.target).addClass("reacted"))}}).bind(void 0),"data-id":o._id,children:["Like ","".concat(c>0?"("+c+")":"")]}),(0,kt.jsx)("div",{className:"reply button","data-id":o._id,onClick:(async e=>{p(!h)}).bind(void 0),children:"Reply"}),(0,kt.jsx)("div",{className:"comment-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:o.createdAt})})]}),h&&(0,kt.jsx)("div",{className:"new-reply",children:(0,kt.jsxs)("div",{className:"comment-field",children:[(0,kt.jsx)("input",{onKeyUp:async e=>{if(e.preventDefault(),13===e.keyCode){let t=e.currentTarget.dataset.comment;if(v){let e=await pa.post("/comment/addReply",{replyMsg:v.body,authorId:r._id,commentId:t});if(200==e.status){p(!1);let t=e.data;g((e=>[...e,t]))}}}},onChange:(async e=>{y((t=>d(d({},t),{},{body:e.target.value})))}).bind(void 0),className:"field-comment-text",type:"text","data-comment":o._id,placeholder:"Reply to ".concat(o.author.fullName)}),(0,kt.jsx)("div",{onClick:(async e=>{let t=e.currentTarget.dataset.comment;if(v){let e=await pa.post("/comment/addReply",{replyMsg:v.body,authorId:r._id,commentId:t});if(200==e.status){p(!1);let t=e.data;g((e=>[...e,t]))}}}).bind(void 0),"data-comment":o._id,className:"comment-attachment",children:(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-paper-plane"})})})]})}),m.map(((e,t)=>(0,kt.jsx)(cc,{setReplies:g,replies:m,comment:o,item:e,myProfile:r},t)))]})]})})};const lc=e=>{let t=e.watch||{},n=e.authProfilePicture,r=e.authProfile,i=e.myProfile?e.myProfile:{},[o,s]=(i._id,(0,a.useState)(t.comments)),[c,u]=(0,a.useState)(null),[l,f]=(0,a.useState)({body:null,attachment:null});return(0,kt.jsxs)(a.Fragment,{children:[(0,kt.jsxs)("div",{className:"comments",children:[o&&o.map(((e,n)=>e&&(0,kt.jsx)(uc,{comment:e,watch:t,myProfile:i},n))),t.comments.length>o.length&&(0,kt.jsx)("div",{className:"more-comment-button",children:" View more comments"})]}),(0,kt.jsxs)("div",{className:"new-comment",children:[(0,kt.jsx)("div",{className:"user-pp",children:(0,kt.jsx)(Un,{profilePic:n,profile:r})}),(0,kt.jsxs)("div",{className:"comment-field",children:[(0,kt.jsx)("input",{onKeyUp:async n=>{if(n.preventDefault(),13===n.keyCode)try{n.target.value="";let r=new FormData;r.append("body",null==l.body?"":l.body),r.append("attachment",null==c?"":c),r.append("watch",t._id);let a=await pa.post("/comment/addComment",{body:l.body,attachment:c,watch:t._id.toString()});if(200===a.status){let t=a.data;t.author=i;let n=t;s((t=>{[...t].slice(-3);let r=[...t,n];return f([]),e.commentState((e=>e+1)),r}))}}catch(r){console.log(r)}},onChange:async e=>{f((t=>d(d({},t),{},{body:e.target.value})))},className:"field-comment-text",type:"text",placeholder:"Write a Public Comment"}),(0,kt.jsxs)("div",{onClick:async e=>{let t=e.currentTarget;Pn()(t).children("input").trigger("click")},className:"comment-attachment",children:[(0,kt.jsx)("input",{onChange:async e=>{f((e=>d(d({},e),{},{attachment:"https://programmerikram.com/wp-content/uploads/2025/03/loading.gif"})));let t=new FormData;t.append("image",e.target.files[0]);let n=await pa.post("/upload/",t,{headers:{"content-type":"multipart/form-data"}});n&&setTimeout((()=>{let e=n.data.secure_url;u(e),f((t=>d(d({},t),{},{attachment:e})))}),1e3)},className:"attachment",type:"file"}),(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-camera"})})]})]})]}),(0,kt.jsx)("div",{className:"comment-attachment-preview",children:l.attachment&&(0,kt.jsx)("img",{alt:"comment attachment",src:l.attachment})})]})},dc=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsxs)("div",{className:"skeleton-card",children:[(0,kt.jsxs)("div",{className:"skeleton-header",children:[(0,kt.jsx)("div",{className:"skeleton-avatar"}),(0,kt.jsxs)("div",{className:"skeleton-lines",children:[(0,kt.jsx)("div",{className:"skeleton-line short"}),(0,kt.jsx)("div",{className:"skeleton-line medium"})]})]}),(0,kt.jsx)("div",{className:"skeleton-main"}),(0,kt.jsxs)("div",{className:"skeleton-footer",children:[(0,kt.jsx)("div",{className:"skeleton-line small button"}),(0,kt.jsx)("div",{className:"skeleton-line small button"}),(0,kt.jsx)("div",{className:"skeleton-line small button"})]})]},t)))},fc=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsx)("div",{className:"skeleton-card no-border",children:(0,kt.jsx)("div",{className:"skeleton-main"})},t)))},hc=e=>{const t=indexedDB.open("savedVideoDb",2);t.onupgradeneeded=()=>{const e=t.result;e.objectStoreNames.contains("videos")||e.createObjectStore("videos",{keyPath:"id"})},t.onsuccess=()=>{e(t.result)},t.onerror=()=>{console.error("Failed to open IndexedDB"),e(null)}},pc=async(e,t,n)=>{const r=await fetch(t),i=await r.blob();hc((t=>{if(!t)return;const r=t.transaction("videos","readwrite");r.objectStore("videos").put({id:e,blob:i,metadata:n}),r.oncomplete=()=>{console.log('Video "'.concat(e,'" saved with metadata')),Vt(n.caption||"Video",n.author.profilePic,"/downloads/".concat(n._id))}}))},mc=(e,t)=>{hc((n=>{if(!n)return t(!1);const r=n.transaction("videos","readwrite").objectStore("videos").delete(e);r.onsuccess=()=>{console.log('Video with id "'.concat(e,'" deleted')),t&&t(!0)},r.onerror=()=>{console.error('Failed to delete video with id "'.concat(e,'"')),t&&t(!1)}}))},gc="https://programmerikram.com/wp-content/uploads/2025/03/like-icon.svg",vc="https://programmerikram.com/wp-content/uploads/2025/03/love-icon.svg",yc="https://programmerikram.com/wp-content/uploads/2025/03/haha-icon.svg",bc=e=>{let{watch:t}=e,n=En((e=>e.profile)),r=n._id,[i,o]=(0,a.useState)(t.reacts.length),[s,c]=(0,a.useState)(t.shares.length),[u,l]=(0,a.useState)(t.comments.length),[d,f]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[m,g]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!1),[b,_]=(0,a.useState)([]);const[w,E]=(0,a.useState)(!1),[S,C]=(0,a.useState)(t.videoUrl),x=(0,a.useRef)(null),T=(0,a.useRef)(null);(0,a.useEffect)((()=>{null!==t&&void 0!==t&&t.thumbnail&&Fn(t.thumbnail,y)}),[t]),(0,a.useEffect)((()=>(Jo.emit("is_active",{profileId:"",myId:r}),Jo.on("is_active",((e,t,n)=>{n===r&&f(e)})),()=>Jo.off("is_active"))),[n]),(0,a.useEffect)((()=>{C(t.videoUrl)}),[t]);var R=""===r;(0,a.useEffect)((()=>{let e=[];t.reacts.map((t=>{if(t.profile){switch(t.type){case"like":e.includes("like")||e.push("like");break;case"love":e.includes("love")||e.push("love");break;case"haha":e.includes("haha")||e.push("haha")}t.profile===r&&g(t.type)}})),_(e)}),[]);let I=t.type||"watch",N=async function(){o((e=>e-1));let e=await pa.post("/react/removeReact",{id:t._id,watchType:"watch"});return 200===e.status&&(o(e.data.reacts.length),g(""),!0)},A=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"watch";o((e=>e+1));let r=await pa.post("/react/addReact",{id:t._id,watchType:n,reactType:e});return 200===r.status&&(o(r.data.reacts.length),_([...b,e]),g(e),!0)},k=En((e=>e.profile.profilePic)),D=En((e=>e.profile._id)),M="".concat(null===t||void 0===t?void 0:t.author.profilePic);(0,a.useEffect)((()=>{window.addEventListener("scroll",(()=>{(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(null==e)return;return e.getBoundingClientRect().top<=t})(null===T||void 0===T?void 0:T.current)&&(document.querySelectorAll(".watch-video").forEach((e=>{e.pause()})),null!==x.current&&x.current.play())}))}),[]);let L=(0,a.useCallback)((e=>{null!==t&&void 0!==t&&t.videoUrl&&pc(t._id,t.videoUrl,t)}),[t]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{ref:T,className:"nf-watch ".concat(I),children:[(0,kt.jsxs)("div",{className:"header",children:["profilePic"===I&&(0,kt.jsxs)("div",{className:"reason",children:[(0,kt.jsxs)("span",{className:"d-none",children:[(0,kt.jsx)("b",{children:"A bitch"})," commented."]}),(0,kt.jsx)("span",{children:"Updated Profile Picture"})]}),(0,kt.jsxs)("div",{className:"author-info",children:[(0,kt.jsxs)("div",{className:"left",children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:M,profile:t.author._id,active:t.author.isActive})}),(0,kt.jsxs)("div",{className:"watch-nd-container",children:[(0,kt.jsx)(Tt,{to:"/"+t.author._id,children:(0,kt.jsx)("h4",{className:"author-name",children:t.author.user.firstName+" "+t.author.user.surname})}),(0,kt.jsx)("span",{className:"watch-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:t.createdAt})})]})]}),(0,kt.jsxs)("div",{className:"right",children:[(0,kt.jsx)("button",{onClick:L,className:"watch-three-dot",children:(0,kt.jsx)("i",{className:"fas fa-download"})}),R&&(0,kt.jsx)("button",{className:"watch-three-dot",children:(0,kt.jsx)("i",{className:"far fa-ellipsis-h"})}),(0,kt.jsxs)("button",{onClick:(async e=>{let n=e.currentTarget;R?(0,Rs.ZX)({title:"Confirm Action",message:"Are you sure you want to delete this watch?",buttons:[{label:"Yes",onClick:async()=>{let e=await pa.watch("/watch/delete",{watchId:t._id,authorId:t.author._id});200===e.status?(Pn()(n).parents(".nf-watch").css({"min-height":"0px",padding:"10px"}),Pn()(n).parents(".nf-watch").html('<p class="fs-6 mb-0 text-center text-danger">'+e.data.message+"</p>")):alert("Failed to delete watch")}},{label:"No",onClick:()=>{}}]}):Pn()(n).parents(".nf-watch").hide()}).bind(void 0),className:"watch-close",children:[" ",(0,kt.jsx)("i",{className:"far fa-times"})]})]})]})]}),(0,kt.jsxs)("div",{className:"body",children:[(0,kt.jsx)("p",{className:"caption",children:t.caption}),!(null!==t&&void 0!==t&&t.thumbnail)&&S&&(0,kt.jsx)("div",{className:"attachment",children:(0,kt.jsx)(Tt,{to:"/watch/".concat(t._id),children:(0,kt.jsx)("video",{id:"watch-".concat(t._id),ref:x,className:"w-100 watch-video",controls:!0,src:"".concat(S)})})})||(0,kt.jsx)(kt.Fragment,{children:!(null!==t&&void 0!==t&&t.thumbnail)&&!S&&(0,kt.jsx)(fc,{})}),null!==t&&void 0!==t&&t.thumbnail&&v&&!h?(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{className:"attachment",children:(0,kt.jsx)(Tt,{to:"/watch/".concat(t._id),children:(0,kt.jsx)("img",{className:"w-100",onClick:()=>{p(!0)},src:t.thumbnail,alt:""})})})," "]}):(0,kt.jsx)(kt.Fragment,{children:!(null!==t&&void 0!==t&&t.thumbnail)&&!S&&(0,kt.jsx)(fc,{})})]}),(0,kt.jsxs)("div",{className:"footer",children:[(0,kt.jsxs)("div",{className:"react-count",children:[(0,kt.jsxs)("div",{className:"reacts",children:[b.includes("like")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:gc,alt:"like"}),"  "]}):(0,kt.jsx)("span",{}),b.includes("love")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:vc,alt:"love"})," "]}):(0,kt.jsx)("span",{}),b.includes("haha")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:yc,alt:"love"})," "]}):(0,kt.jsx)("span",{}),(0,kt.jsxs)("span",{className:"text",children:[t.reacts&&i," ",i>1?"Reacts":"React"]})]}),(0,kt.jsxs)("div",{className:"comment-share",children:[(0,kt.jsxs)("div",{className:"comment",children:[(0,kt.jsx)("div",{className:"text",children:t.comments&&u}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})})]}),(0,kt.jsxs)("div",{className:"shares",children:[(0,kt.jsx)("div",{className:"text",children:t.shares&&s}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"fa fa-share"})})]})]})]}),(0,kt.jsx)("div",{className:"like-comment-share",children:(0,kt.jsxs)("div",{className:"buttons-container",children:[(0,kt.jsxs)("div",{className:"react-buttons button ".concat(m?"reacted":""),children:[(0,kt.jsxs)("div",{onClick:async e=>{let t=e.currentTarget;Pn()(t).parent().hasClass("reacted")?(N("watch"),Pn()(t).parent().removeClass("reacted")):(A("like","watch",t),Pn()(t).parent().addClass("reacted"))},onMouseOver:e=>{let t=e.currentTarget;Pn()(t).children(".watch-react-container").css("visibility","visible")},className:"react-like ".concat(1==m?"reacted":""),children:[(0,kt.jsxs)("span",{className:"react-icon",datatype:m||"",children:["haha"==m?(0,kt.jsx)("img",{src:yc,alt:"haha"}):(0,kt.jsx)("span",{}),"love"==m?(0,kt.jsx)("img",{src:vc,alt:"love"}):(0,kt.jsx)("span",{}),0==m||"like"==m?(0,kt.jsx)("img",{src:gc,alt:"like"}):(0,kt.jsx)("span",{})]}),(0,kt.jsx)("span",{className:"text text-capitalize",children:m||"like"})]}),(0,kt.jsxs)("div",{className:"watch-react-container",children:[(0,kt.jsx)("div",{className:"react react-like ".concat("like"==m?"reacted":""),onClick:async e=>{let t=e.currentTarget;Pn()(t).parents(".watch-react-container").css("visibility","hidden"),Pn()(t).hasClass("reacted")?(N("watch"),Pn()(t).removeClass("reacted")):(A("like","watch",t),Pn()(t).addClass("reacted"),Pn()(e.currentTarget).siblings().removeClass("reacted")),setTimeout((()=>{Pn()(t).parents(".watch-react-container").css("visibility","visible")}),500)},id:"watchReactLike",title:"Like",children:(0,kt.jsx)("img",{src:gc,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-love ".concat("love"==m?"reacted":""),onClick:e=>{let t=e.currentTarget;Pn()(t).parents(".watch-react-container").css("visibility","hidden"),Pn()(e.currentTarget).hasClass("reacted")?(N("watch"),Pn()(e.currentTarget).removeClass("reacted")):(A("love","watch"),Pn()(e.currentTarget).siblings().removeClass("reacted"),Pn()(e.currentTarget).addClass("reacted")),setTimeout((()=>{Pn()(t).parents(".watch-react-container").css("visibility","visible")}),500)},id:"watchReactLove",title:"Love",children:(0,kt.jsx)("img",{src:vc,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-haha ".concat("haha"==m?"reacted":""),onClick:e=>{let t=e.currentTarget;Pn()(t).parents(".watch-react-container").css("visibility","hidden"),Pn()(e.currentTarget).hasClass("reacted")?(N(),Pn()(e.currentTarget).removeClass("reacted")):(A("haha","watch",t),Pn()(e.currentTarget).siblings().removeClass("reacted"),Pn()(e.currentTarget).addClass("reacted")),setTimeout((()=>{Pn()(t).parents(".watch-react-container").css("visibility","visible")}),500)},id:"watchReactHaha",title:"Haha",children:(0,kt.jsx)("img",{src:yc,alt:"haha"})})]})]}),(0,kt.jsxs)("div",{onClick:e=>{let t=e.currentTarget;Pn()(t).parents(".footer").find(".field-comment-text").focus()},className:"comment button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})}),(0,kt.jsx)("span",{className:"text",children:"Comment"})]}),(0,kt.jsxs)("div",{onClick:e=>{},className:"share button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-share"})}),(0,kt.jsx)("span",{className:"text",children:"Share"})]})]})}),(0,kt.jsx)(lc,{watch:t,commentState:l,myProfile:n,authProfile:D,authProfilePicture:k})]})]})})},_c=()=>{let e=En((e=>e.profile))._id,t=wa();const[n,r]=(0,a.useState)([]);return(0,a.useEffect)((()=>{(async()=>{let t=await pa.get("watch/related",{params:{profile_id:e}});200===t.status&&r(t.data)})()}),[]),(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)("div",{className:"container my-3",children:(0,kt.jsxs)("div",{className:"row",children:[(0,kt.jsx)("div",{className:"col-md-3",children:!t&&(0,kt.jsx)(_a,{})}),(0,kt.jsx)("div",{className:"col-md-6",children:n.length>0?n.map(((e,t)=>(0,kt.jsx)(bc,{watch:e,type:"watch"},t))):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(dc,{count:3})})}),(0,kt.jsx)("div",{className:"col-md-3",children:!t&&(0,kt.jsx)(Ss,{})})]})})})};const wc=()=>(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)("h2",{children:"Marketplace"})});const Ec=()=>(0,kt.jsx)(a.Fragment,{}),Sc=()=>(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"yt-download-page",children:(0,kt.jsx)("div",{className:"container my-3",children:(0,kt.jsx)("div",{className:"row",children:(0,kt.jsx)("div",{className:"col",children:(0,kt.jsx)("h1",{children:"Yt Downloader"})})})})})});var Cc=n(6178),xc=n.n(Cc);let Tc=e=>{const t=xc()(e);xc()();return t.format("DD/MM/YY hh:mm A")};const Rc=e=>{var t,n,r,i,o,s,c,u,l,d;let{index:f,msg:h,friendProfile:p,isActive:m,messages:g,setReplyData:v,setIsReplying:y,setIsPreview:b,isPreview:_,msgListRef:w,isMsgLoading:E}=e,S=En((e=>e.profile))._id,C=p._id,[x,T]=(h.reacts.includes(S)||h.reacts.includes(S),(0,a.useState)(h.reacts.includes(S))),[R,I]=(0,a.useState)(!1),[N,A]=(0,a.useState)(h.reacts.includes(C)),[k,D]=(0,a.useState)(!1),[M,L]=(0,a.useState)(!1),[O,P]=(0,a.useState)(!h||void 0!==(null===h||void 0===h?void 0:h.parent));(0,a.useEffect)((()=>{var e,t;(Ns(h.attachment)&&Fn(h.attachment,D),Ns(null===h||void 0===h||null===(e=h.parent)||void 0===e?void 0:e.attachment))&&Fn(null===h||void 0===h||null===(t=h.parent)||void 0===t?void 0:t.attachment,L)}),[h]),(0,a.useEffect)((()=>{}),[k]),(0,a.useEffect)((()=>(Jo.on("messageReacted",(e=>{h._id===e&&A(!0)})),Jo.on("messageReactRemoved",(e=>{h._id===e&&A(!1)})),()=>{Jo.off("messageReacted"),Jo.off("messageReactRemoved")}))),(0,a.useEffect)((()=>{var e;null!==h&&void 0!==h&&null!==(e=h.parent)&&void 0!==e&&e._id&&P(!0)}),[]);let j=async e=>{let t=Pn()(e.currentTarget).data("id");Jo.emit("deleteMessage",t)},F=async e=>{let t=Pn()(e.currentTarget).data("id");if(x){200==(await pa.post("/message/removeReact",{messageId:t,myId:S})).status&&T(!1)}else{200==(await pa.post("/message/addReact",{messageId:t,myId:S})).status&&T(!0)}},U=async e=>{let t=Pn()(e.currentTarget).data("id");y(!0),b(!0),v({messageId:t,body:h.message})},B=async e=>{Jo.emit("speak_message",{msgId:Pn()(e.currentTarget).data("id"),friendId:C})},V=async e=>{let t=e.currentTarget.dataset.parent;document.querySelectorAll("#chatMessageList .chat-message-container .chat-message").forEach(((e,t)=>{e.style.border="unset"}));let n=document.querySelector("#chatMessageList .chat-message-container.message-id-".concat(t," .chat-message"));null!==n&&(n.scrollIntoView({behavior:"smooth"}),n.style.border="2px solid #29B1A9",I(!0));let r=new CustomEvent("scroll",{bubbles:!0,cancelable:!0}),i=setInterval((()=>{R&&(n=document.querySelector("#chatMessageList .chat-message-container.message-id-".concat(t," .chat-message")),n.scrollIntoView({behavior:"smooth"}),n.style.border="2px solid #29B1A9",clearInterval(i)),null==n?0==E&&(w.current.scrollTop=10,w.current.dispatchEvent(r),n=document.querySelector("#chatMessageList .chat-message-container.message-id-".concat(t," .chat-message"))):(n=document.querySelector("#chatMessageList .chat-message-container.message-id-".concat(t," .chat-message")),n&&(I(!0),clearInterval(i),n.scrollIntoView({behavior:"smooth"}),n.style.border="2px solid #29B1A9"))}),1500)};return(0,kt.jsx)(kt.Fragment,{children:h.senderId!==S?(0,kt.jsxs)("div",{className:"chat-message-container message-receive message-id-".concat(h._id," ").concat(!0===x||1==N?"message-reacted":""),"data-toggle":"tooltip",title:Tc(h.timestamp),children:[(0,kt.jsx)("div",{className:"chat-message-profilePic",children:(0,kt.jsx)(Un,{profilePic:"".concat(p.profilePic),profile:p._id,active:p.isActive})}),(0,kt.jsxs)("div",{className:"chat-message ".concat(Ns(g.attachment)&&"has-attachment"),children:[(0,kt.jsxs)("div",{className:"chat-message-options",children:[(0,kt.jsx)("button",{type:"button","data-id":h._id,className:"chat-message-option like ".concat(1==x?"reacted":""),onClick:F.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-thumbs-up"})}),(0,kt.jsx)("button",{type:"button","data-id":h._id,className:"chat-message-option reply",onClick:U.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-reply"})}),(0,kt.jsx)("button",{type:"button","data-id":h._id,className:"chat-message-option share",onClick:B.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-speaker"})}),(0,kt.jsx)("button",{type:"button","data-id":h._id,className:"chat-message-option delete",onClick:j.bind(h),children:(0,kt.jsx)("i",{className:"fa fa-trash"})})]}),void 0===(null===h||void 0===h?void 0:h.parent)||null===(null===h||void 0===h?void 0:h.parent)?(0,kt.jsx)(kt.Fragment,{}):(0,kt.jsxs)("p",{onClick:V.bind(void 0),"data-parent":null===h||void 0===h||null===(t=h.parent)||void 0===t?void 0:t._id,className:"parent-message-container ".concat(Ns(null===h||void 0===h||null===(n=h.parent)||void 0===n?void 0:n.attachment)&&"has-attachment"),children:[(0,kt.jsx)("span",{children:null===h||void 0===h||null===(r=h.parent)||void 0===r?void 0:r.message}),1==M?(0,kt.jsx)("div",{className:"message-attachment-container",children:(0,kt.jsx)("img",{src:null===h||void 0===h||null===(i=h.parent)||void 0===i?void 0:i.attachment,alt:"Message Attchment",className:"message-attachment"})}):Ns(null===h||void 0===h||null===(o=h.parent)||void 0===o?void 0:o.attachment)&&(0,kt.jsx)(Is,{style:{minWidth:"300px"}})]}),(0,kt.jsx)("div",{className:"message-container mb-0",children:(0,kt.jsx)("span",{children:h.message})}),1==k?(0,kt.jsx)("div",{className:"message-attachment-container",children:(0,kt.jsx)("img",{src:h.attachment,alt:"",className:"message-attachment"})}):Ns(h.attachment)&&(0,kt.jsx)(Is,{style:{minWidth:"300px"}}),(0,kt.jsx)("span",{className:"message-react",children:(0,kt.jsx)("i",{children:"\ud83d\udc4d"})})]}),(0,kt.jsx)("div",{className:"chat-message-seen-status d-none",children:"Seen"})]},f):(0,kt.jsxs)("div",{className:"chat-message-container message-sent message-id-".concat(h._id," ").concat(!0===x||1==N?"message-reacted":""),"data-toggle":"tooltip",title:Tc(h.timestamp),children:[(0,kt.jsxs)("div",{className:"chat-message ".concat(Ns(g.attachment)&&"has-attachment"),children:[(0,kt.jsxs)("div",{className:"chat-message-options",children:[(0,kt.jsx)("button",{type:"button","data-id":h._id,className:"chat-message-option like ".concat(1==x?"reacted":""),onClick:F.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-thumbs-up"})}),(0,kt.jsx)("button",{type:"button","data-id":h._id,className:"chat-message-option reply",onClick:U.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-reply"})}),(0,kt.jsx)("button",{type:"button","data-id":h._id,className:"chat-message-option share speaker",onClick:B.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-speaker"})}),(0,kt.jsx)("button",{type:"button","data-id":h._id,className:"chat-message-option delete",onClick:j.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-trash"})})]}),void 0===(null===h||void 0===h?void 0:h.parent)||null===(null===h||void 0===h?void 0:h.parent)?(0,kt.jsx)(kt.Fragment,{}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("p",{onClick:V.bind(void 0),"data-parent":null===h||void 0===h||null===(s=h.parent)||void 0===s?void 0:s._id,className:"parent-message-container ".concat(Ns(null===h||void 0===h||null===(c=h.parent)||void 0===c?void 0:c.attachment)&&"has-attachment"),children:[(0,kt.jsx)("span",{children:null===h||void 0===h||null===(u=h.parent)||void 0===u?void 0:u.message}),1==M?(0,kt.jsx)("div",{className:"message-attachment-container",children:(0,kt.jsx)("img",{src:null===h||void 0===h||null===(l=h.parent)||void 0===l?void 0:l.attachment,alt:"",className:"message-attachment"})}):Ns(null===h||void 0===h||null===(d=h.parent)||void 0===d?void 0:d.attachment)&&(0,kt.jsx)(Is,{style:{minWidth:"400px",width:"400px"}})]})}),(0,kt.jsx)("div",{className:"message-container mb-0",children:(0,kt.jsx)("span",{children:h.message})}),1==k?(0,kt.jsx)("div",{className:"message-attachment-container",children:(0,kt.jsx)("img",{src:h.attachment,alt:"Message Attchment",className:"message-attachment"})}):Ns(h.attachment)&&(0,kt.jsx)(Is,{style:{minWidth:"300px"}}),(0,kt.jsx)("span",{className:"message-react",children:(0,kt.jsx)("i",{children:"\ud83d\udc4d"})})]}),(0,kt.jsx)("div",{className:"chat-message-seen-status ".concat(h.isSeen?"message-seen":"message-unseen"),children:(0,kt.jsx)("img",{src:p.profilePic,alt:"Seen"})})]},f)})},Ic="ADD_MESSAGES",Nc="NEW_MESSAGE",Ac="SEEN_MESSAGE",kc=function(e){return{type:Ic,payload:e,reset:arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},Dc=e=>({type:Nc,payload:e}),Mc=e=>({type:Ac,payload:{contactId:e}});var Lc=function(e,t){return Lc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},Lc(e,t)};function Oc(e,t){function n(){this.constructor=e}Lc(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Pc=function(){return Pc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Pc.apply(this,arguments)};function jc(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(Vc){a(Vc)}}function s(e){try{c(r.throw(e))}catch(Vc){a(Vc)}}function c(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function Fc(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(Vc){a=[6,Vc],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function Uc(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}var Bc=function(e,t){return(Bc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function Vc(e,t){function n(){this.constructor=e}Bc(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var zc=function(){return(zc=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Wc(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function Gc(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var Hc=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t=Yc(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],i=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,i)}))}},e}();function Yc(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,n[0],n[1]),n.join("=")})),t}var qc=null;function Kc(e){qc=e}Object.freeze({Environment:Hc,getQueryParams:Yc,get ENV(){return qc},setEnvironmentGlobal:Kc});function Xc(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function Qc(e,t,n){return Math.max(e,Math.min(t,n))}function Jc(e){return e%2==0?e:e+1}function Zc(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function $c(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function eu(e,t,n){void 0===n&&(n=""),$c(iu(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function tu(e){$c(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function nu(e,t){if(void 0===t&&(t=[]),null==t&&(t=[]),Array.isArray(e)||bu(e))for(var n=0;n<e.length;++n)nu(e[n],t);else t.push(e);return t}function ru(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function iu(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function au(e){return e%1==0}function ou(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function su(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function cu(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function uu(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var a=0,o=function(){if(e())r();else{var s=t(++a);null!=n&&a>=n?i():setTimeout(o,s)}};o()}))}function lu(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function du(e,t){var n=t.length;return $c((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),$c(e.every((function(e){return au(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function fu(e,t){for(var n=[],r=[],i=null==t?null:du(t,e).sort(),a=0,o=0;o<e.length;++o){if(null!=i){if(i[a]===o&&1!==e[o])throw new Error("Can't squeeze axis "+o+" since its dim '"+e[o]+"' is not 1");(null==i[a]||i[a]>o)&&1===e[o]&&(n.push(e[o]),r.push(o)),i[a]<=o&&a++}1!==e[o]&&(n.push(e[o]),r.push(o))}return{newShape:n,keptDims:r}}function hu(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function pu(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function mu(e,t,n){if("float32"===t)for(var r=0;r<e.length;r++){var i=e[r];if(isNaN(i)||!isFinite(i))throw Error("The result of the '"+n+"' is "+i+".")}}function gu(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function vu(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function yu(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function bu(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function _u(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function wu(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=2*e.length})),t}function Eu(e){return"string"==typeof e||e instanceof String}function Su(e){return"boolean"==typeof e}function Cu(e){return"number"==typeof e}function xu(e){return Array.isArray(e)?xu(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Cu(e)?"float32":Eu(e)?"string":Su(e)?"bool":"float32"}function Tu(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Ru(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Iu(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Nu(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=nu(e)),n&&gu(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}function Au(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var i=new Array;if(1===n.length)for(var a=n[0],o=0;o<a;o++)i[o]=r[t+o];else{a=n[0];var s=n.slice(1),c=s.reduce((function(e,t){return e*t}));for(o=0;o<a;o++)i[o]=e(t+o*c,s,r)}return i}(0,e,t)}function ku(e,t){for(var n=Du(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Du(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function Mu(){if("undefined"!=typeof performance)return performance.now();if("undefined"!=typeof process){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function Lu(e){e.forEach((function(t){$c(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function Ou(e,t){return qc.platform.fetch(e,t)}Object.freeze({shuffle:Xc,clamp:Qc,nearestLargerEven:Jc,sum:Zc,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},assert:$c,assertShapesMatch:eu,assertNonNull:tu,flatten:nu,sizeFromShape:ru,isScalarShape:function(e){return 0===e.length},arraysEqual:iu,isInt:au,tanh:ou,sizeToSquarishShape:su,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return Xc(t),t},rightPad:cu,repeatedTry:uu,inferFromImplicitShape:lu,parseAxisParam:du,squeezeShape:fu,getTypedArrayFromDType:hu,getArrayFromDType:pu,checkComputationForErrors:mu,checkConversionForErrors:gu,isValidDtype:vu,hasEncodingLoss:yu,isTypedArray:bu,bytesPerElement:_u,bytesFromStringArray:wu,isString:Eu,isBoolean:Su,isNumber:Cu,inferDtype:xu,isFunction:Tu,nearestDivisor:Ru,computeStrides:Iu,toTypedArray:Nu,toNestedArray:Au,makeOnesTypedArray:ku,makeZerosTypedArray:Du,now:Mu,assertNonNegativeIntegerDimensions:Lu,fetch:Ou});var Pu=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new ju)}return e.prototype.profileKernel=function(e,t){var n,r=this,i=this.backendTimer.time((function(){n=t()}));return(Array.isArray(n)?n:[n]).forEach((function(t){var n=t.dataSync();mu(n,t.dtype,e),i.then((function(i){var a="";null!=i.getExtraProfileInfo&&(a=i.getExtraProfileInfo()),r.logger.logKernelProfile(e,t,n,i.kernelMs,a)}))})),n},e}(),ju=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,i){var a=cu(r+"ms",9),o=cu(e,25),s=t.rank,c=t.size,u=cu(t.shape.toString(),14);console.log("%c"+o+"\t%c"+a+"\t%c"+s+"D "+u+"\t%c"+c+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green")},e}();function Fu(e,t,n){return cu(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":Eu(e)?"'"+e+"'":"bool"===n?Uu(e):parseFloat(e.toFixed(7)).toString(),t)}function Uu(e){return 0===e?"false":"true"}function Bu(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Vu=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=ru(e),null!=n){var i=n.length;$c(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||pu(t,this.size),this.strides=Iu(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),$c(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(n);this.values[i]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,i=e;r<i.length;r++){var a=i[r];if(a<0||a>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],c=0;c<e.length-1;++c)s+=this.strides[c]*e[c];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Hu.make(this.shape,{values:this.values},this.dtype)},e}(),zu=null,Wu=null,Gu=null,Hu=function(){function e(e,t,n,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ru(e),this.strides=Iu(e),this.dataId=null!=r?r:{},this.id=zu().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",zu().registerTensor(this,i),null!=n&&zu().write(i,this.dataId,n)}return e.make=function(t,n,r,i){return new e(t,r,n.values,n.dataId,i)},e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),$c(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),this.reshape([e,t,n,r,i])},e.prototype.asType=function(e){return this.throwIfDisposed(),Wu.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return Wc(this,void 0,void 0,(function(){var e;return Gc(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Wu.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return Wu.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return Wc(this,void 0,void 0,(function(){var e;return Gc(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Au(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return Au(this.shape,this.dataSync())},e.prototype.data=function(){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(e){return this.throwIfDisposed(),[2,zu().read(this.dataId)]}))}))},e.prototype.dataSync=function(){return this.throwIfDisposed(),zu().readSync(this.dataId)},e.prototype.dispose=function(){this.isDisposed||(zu().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),Wu.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),Wu.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),Wu.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),Wu.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),Wu.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),Wu.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),Wu.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var i=Iu(t),a=function(e,t,n,r){var i=ru(t),a=r[r.length-1],o=new Array(a).fill(0),s=t.length,c="complex64"===n?Bu(e):e;if(s>1)for(var u=0;u<i/a;u++)for(var l=u*a,d=0;d<a;d++)o[d]=Math.max(o[d],Fu(c[l+d],0,n).length);return o}(e,t,n,i),o=t.length,s=function e(t,n,r,i,a,o){void 0===o&&(o=!0);var s="complex64"===r?2:1,c=n[0],u=n.length;if(0===u)return"complex64"===r?[Fu(Bu(t)[0],0,r)]:"bool"===r?[Uu(t[0])]:[t[0].toString()];if(1===u){if(c>20){var l=3*s,d=Array.from(t.slice(0,l)),f=Array.from(t.slice(c-3*s,c));return"complex64"===r&&(d=Bu(d),f=Bu(f)),["["+d.map((function(e,t){return Fu(e,a[t],r)})).join(", ")+", ..., "+f.map((function(e,t){return Fu(e,a[c-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?Bu(t):Array.from(t)).map((function(e,t){return Fu(e,a[t],r)})).join(", ")+"]"]}var h=n.slice(1),p=i.slice(1),m=i[0]*s,g=[];if(c>20){for(var v=0;v<3;v++){var y=(b=v*m)+m;g.push.apply(g,e(t.slice(b,y),h,r,p,a,!1))}for(g.push("..."),v=c-3;v<c;v++)y=(b=v*m)+m,g.push.apply(g,e(t.slice(b,y),h,r,p,a,v===c-1))}else for(v=0;v<c;v++){var b;y=(b=v*m)+m,g.push.apply(g,e(t.slice(b,y),h,r,p,a,v===c-1))}var _=2===u?",":"";for(g[0]="["+g[0]+_,v=1;v<g.length-1;v++)g[v]=" "+g[v]+_;var w=",\n";for(v=2;v<u;v++)w+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(o?"":w),g}(e,t,n,i,a),c=["Tensor"];return r&&(c.push("  dtype: "+n),c.push("  rank: "+o),c.push("  shape: ["+t+"]"),c.push("  values:")),c.push(s.map((function(e){return"    "+e})).join("\n")),c.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),Wu.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),Wu.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),Wu.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),Wu.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),Wu.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),Wu.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),Wu.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),Wu.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),Wu.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),Wu.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),Wu.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),Wu.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),Gu("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,r,n)},e.prototype.batchNorm=function(e,t,n,r,i){return void 0===i&&(i=.001),this.throwIfDisposed(),Wu.batchNorm(this,e,t,n,r,i)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Wu.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Wu.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Wu.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Wu.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Wu.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Wu.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Wu.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Wu.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),Wu.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),Wu.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),Wu.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),Wu.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),Wu.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),Wu.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),Wu.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),Wu.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),Wu.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),Wu.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),Wu.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),Wu.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),Wu.div(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),Wu.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),Wu.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),Wu.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Wu.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),Wu.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Wu.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),Wu.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),Wu.modStrict(this,e)},e.prototype.squaredDifference=function(e){return this.throwIfDisposed(),Wu.squaredDifference(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Wu.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),Wu.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),Wu.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Wu.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),Wu.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),Wu.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),Wu.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),Wu.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),Wu.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Wu.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),Wu.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Wu.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Wu.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Wu.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Wu.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),Wu.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),Wu.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),Wu.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),Wu.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),Wu.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),Wu.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),Wu.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),Wu.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),Wu.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),Wu.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),Wu.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),Wu.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),Wu.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),Wu.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),Wu.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),Wu.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),Wu.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),Wu.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),Wu.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),Wu.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Wu.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),Wu.relu(this)},e.prototype.elu=function(){return this.throwIfDisposed(),Wu.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),Wu.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),Wu.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),Wu.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),Wu.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),Wu.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),Wu.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),Wu.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),Wu.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),Wu.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),Wu.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),Wu.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),Wu.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),Wu.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),Wu.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),Wu.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),Wu.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),Wu.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),Wu.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),Wu.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),Wu.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),Wu.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),Wu.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),Wu.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),Wu.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),Wu.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),Wu.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),Wu.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,a){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),Wu.conv1d(this,e,t,n,r,i,a)},e.prototype.conv2d=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),Wu.conv2d(this,e,t,n,r,i,a)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),Wu.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),Wu.depthwiseConv2d(this,e,t,n,r,i,a)},e.prototype.separableConv2d=function(e,t,n,r,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),Wu.separableConv2d(this,e,t,n,r,i,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Wu.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Wu.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),Wu.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),Wu.pool(this,e,t,n,r,i)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),Yu.variable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Wu.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Wu.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Wu.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),Wu.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),Wu.stridedSlice(this,e,t,n,r,i,a,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Wu.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),Wu.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),Wu.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),Wu.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),Wu.spectral.irfft(this)},e}();Object.defineProperty(Hu,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var Yu=function(e){function t(t,n,r){void 0===n&&(n=!0);var i=e.call(this,t.shape,t.dtype,null,t.dataId)||this;i.trainable=n,i.name=r,null==i.name&&(i.name=zu().nextVariableId().toString());try{zu().registerVariable(i)}catch(e){throw zu().disposeTensor(i),e}return i}return Vc(t,e),t.variable=function(e,n,r,i){return void 0===n&&(n=!0),null!=i&&i!==e.dtype&&(e=e.asType(i)),new t(e,n,r)},t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!iu(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");zu().disposeTensor(this),this.dataId=e.dataId,zu().registerTensor(this)},t.prototype.dispose=function(){zu().disposeVariable(this),this.isDisposedInternal=!0},t}(Hu);Object.defineProperty(Yu,Symbol.hasInstance,{value:function(e){return e instanceof Hu&&null!=e.assign&&e.assign instanceof Function}});var qu,Ku,Xu,Qu,Ju;Yu.variable;!function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(qu||(qu={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ku||(Ku={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Xu||(Xu={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Qu||(Qu={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Ju||(Ju={}));var Zu={float32:Qu,int32:Ku,bool:Xu,complex64:Ju};function $u(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Zu[e][t]}function el(e){return $u(e,"int32")}function tl(e,t){if(e.dtype===t.dtype)return[e,t];var n=$u(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function nl(e,t){$c(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function rl(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof Hu)n.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,a=t;for(var o in a){var s=a[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:tl,assertTypesMatch:nl,isTensorInList:function(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return!0;return!1},getTensorsInContainer:rl});var il,al=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),ol=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new al}return e.prototype.ready=function(){return Wc(this,void 0,void 0,(function(){var e,t,n;return Gc(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return Wc(this,void 0,void 0,(function(){var t,n,r;return Gc(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.profiler=new Pu(this.backendInstance),[2,!0]}}))}))},e.prototype.initializeBackend=function(e){var t=this,n=sl.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return!(i<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),i=r.success,a=r.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){this.write(e,t,this.readSync(t))},e.prototype.tidy=function(e,t){var n,r=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=Hu.make(e.shape,{dataId:e.dataId},e.dtype);return this.addTapeNode([e],t,(function(e){return[e.toFloat()]})),t},e.prototype.runKernel=function(e,t,n){var r,i=this,a=[],o=this.isTapeOn(),s=null!=this.state.activeScope?this.state.activeScope.name:"",c=function(e){o&&(a=e.map((function(e){return i.keep(i.clone(e))})))},u=this.state.numBytes,l=this.state.numTensors;if(this.scopedRun((function(){return i.state.kernelDepth++}),(function(){return i.state.kernelDepth--}),(function(){r=i.ENV.getBool("DEBUG")?i.profiler.profileKernel(s,(function(){return e(i.backend,c)})):e(i.backend,c)})),o){var d={id:this.state.nextTapeNodeId++,name:s,inputs:t,outputs:Array.isArray(r)?r:[r],saved:a};null!=n&&(d.gradient=function(e){return n(e,a)}),this.state.activeTape.push(d)}return this.state.profiling&&this.state.activeProfile.kernels.push({name:s,bytesAdded:this.state.numBytes-u,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-l,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShape:Array.isArray(r)?r.map((function(e){return e.shape})):r.shape}),r},e.prototype.registerTensor=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*_u(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:null!=t?t:this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r,null!=t?t.register(e.dataId,e.shape,e.dtype):this.backend.register(e.dataId,e.shape,e.dtype)}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Yu||this.track(e)},e.prototype.registerVariable=function(e){if(null!=this.state.registeredVariables[e.name])throw new Error("Variable with name "+e.name+" was already registered");this.state.registeredVariables[e.name]=e},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return Wc(this,void 0,void 0,(function(){var t,n;return Gc(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n){var r={};e.forEach((function(e,t){r[t]=e}));var i={id:this.state.nextTapeNodeId++,name:this.state.activeScope.name,inputs:r,outputs:[t],gradient:function(e){var t=n(e),r={};return t.forEach((function(e,t){r[t]=function(){return e}})),r}};this.state.activeTape.push(i)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=rl(e),r=new Set(n.map((function(e){return e.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var i=this;if(void 0===r&&(r=!1),$c(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",e)}));$c(a instanceof Hu,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},i={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var o=(p=e[a]).inputs;for(var s in o){for(var c=o[s],u=!1,l=0;l<t.length;l++)if(r[c.id]){p.outputs.forEach((function(e){return r[e.id]=!0})),u=!0,i[p.id]=!0;break}if(u)break}}var d={};d[n.id]=!0;var f={};for(a=e.length-1;a>=0;a--)for(o=(p=e[a]).inputs,l=0;l<p.outputs.length;l++)if(d[p.outputs[l].id]){for(var s in o)d[o[s].id]=!0,f[p.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var p;if(i[(p=e[a]).id]&&f[p.id]){var m={};for(var s in p.inputs){var g=p.inputs[s];r[g.id]&&(m[s]=g)}var v=Object.assign({},p);v.inputs=m,v.outputs=p.outputs,h.push(v)}}return h}(this.state.activeTape,t,a);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,s={};s[a.id]=null==n?(r=ku(ru(e=a.shape),"float32"),Hu.make(e,{values:r})):n,function(e,t,n){for(var r=function(r){var i=t[r],a=[];if(i.outputs.forEach((function(t){var n=e[t.id];if(null!=n)a.push(n);else{var r=Hu.make(t.shape,{values:Du(t.size,t.dtype)},t.dtype);a.push(r)}})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.name+".");var o=i.gradient(1===i.outputs.length?a[0]:a),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var r=n((function(){return o[t]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+i.name+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=i.inputs[t];if(!iu(r.shape,a.shape))throw new Error("Error in gradient for op "+i.name+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var c in i.inputs)s(c)},i=t.length-1;i>=0;i--)r(i)}(s,o,(function(e){return i.tidy(e)}));var c=t.map((function(e){return s[e.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(e){for(var t in e.saved)e.saved[t].dispose()})),i.state.activeTape=null),{value:a,grads:c}}))},e.prototype.customGrad=function(e){var t=this;return $c(Tu(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];$c(r.every((function(e){return e instanceof Hu})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(e,t){a[t]=e})),t.runKernel((function(t,i){return $c((n=e.apply(void 0,r.concat([i]))).value instanceof Hu,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),$c(Tu(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(e,t){var i=n.gradFunc(e,t),a=Array.isArray(i)?i:[i];$c(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),$c(a.every((function(e){return e instanceof Hu})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}},e.prototype.write=function(e,t,n){var r=this.state.tensorInfo.get(t),i=r.backend;if(e=e||this.backend,"string"===r.dtype){var a=wu(n);this.state.numBytes+=a-r.bytes,r.bytes=a}e!==i&&(i.disposeData(t),r.backend=e,e.register(t,r.shape,r.dtype)),e.write(t,n)},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},e.prototype.time=function(e){return Wc(this,void 0,void 0,(function(){var t,n;return Gc(this,(function(r){switch(r.label){case 0:return t=Mu(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=Mu()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new al,this.registry)this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),sl=function(){var e=function(){if(null==il){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}il=e}return il}();if(null==e._tfengine){var t=new Hc(e);e._tfengine=new ol(t)}return Kc(e._tfengine.ENV),zu=function(){return e._tfengine},e._tfengine}();function cl(){return"undefined"!=typeof window||"undefined"!=typeof WorkerGlobalScope}qc.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),qc.registerFlag("IS_BROWSER",(function(){return cl()})),qc.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),qc.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),qc.registerFlag("PROD",(function(){return!1})),qc.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return qc.getBool("DEBUG")})),qc.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),qc.registerFlag("IS_TEST",(function(){return!1}));var ul={},ll={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function dl(e,t){ul[e]=t}function fl(e){e in ul||(ul[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete ul[e]}),!1),1===e?t.getContext("webgl",ll)||t.getContext("experimental-webgl",ll):t.getContext("webgl2",ll)}(e));var t=ul[e];return t.isContextLost()?(delete ul[e],fl(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),ul[e])}function hl(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+ml(e,t))}(e),r}function pl(e){return!!(qc.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function ml(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function gl(e,t,n){return Ul(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function vl(e,t,n){var r=Ul(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(hl(e,t,(function(){return e.shaderSource(r,n)})),hl(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function yl(e,t,n){var r=Ul(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(hl(e,t,(function(){return e.shaderSource(r,n)})),hl(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=wl.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],i=e.split("\n"),a=i.length.toString().length+2,o=i.map((function(e,t){return cu((t+1).toString(),a)+e})),s=0,c=0;c<o.length;c++)s=Math.max(o[c].length,s);var u=o.slice(0,r-1),l=o.slice(r-1,r),d=o.slice(r);console.log(u.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+cu(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var bl,_l,wl=/ERROR: [0-9]+:([0-9]+):/g;function El(e,t){return Ul(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function Sl(e,t,n){if(hl(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Cl(e,t,n){if(hl(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function xl(e,t,n){var r=Ul(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return hl(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),hl(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function Tl(e,t,n){var r=Ul(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return hl(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),hl(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function Rl(e,t){return Ul(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function Il(e,t){var n=qc.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function Nl(e,t){return Ul(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function Al(e,t,n,r,i,a,o,s){var c=e.getAttribLocation(n,r);return-1!==c&&(hl(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,i)})),hl(e,t,(function(){return e.vertexAttribPointer(c,a,e.FLOAT,!1,o,s)})),hl(e,t,(function(){return e.enableVertexAttribArray(c)})),!0)}function kl(e,t,n,r){Bl(e,r),hl(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),hl(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function Dl(e,t,n,r){return Ul(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function Ml(e,t,n){return e.getUniformLocation(t,n)}function Ll(e,t,n,r,i,a){hl(e,t,(function(){return kl(e,t,r,a)})),hl(e,t,(function(){return e.uniform1i(i,a)}))}function Ol(e,t,n,r){hl(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),hl(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function Pl(e,t,n){hl(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),hl(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function jl(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Fl(e,t))}function Fl(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Ul(e,t,n,r){var i=hl(e,t,(function(){return n()}));if(null==i)throw new Error(r);return i}function Bl(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Vl(e,t){return void 0===t&&(t=2),ru(e.slice(0,e.length-t))}function zl(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Wl(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Vl(e)].concat(zl(e))),t}function Gl(e,t){var n;void 0===t&&(t=!1);var r=qc.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?Jc(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var i=fu(e);e=i.newShape}var a=ru(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=Vl(e),s=2,c=2;return e.length&&(s=(n=zl(e))[0],c=n[1]),su(a=o*(s/2)*(c/2)).map((function(e){return 2*e}))}return su(a)}function Hl(e){return e%2==0}function Yl(e,t){if(iu(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Hl(n)&&Hl(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Hl(e[0])&&Hl(t[0])}function ql(e){if(null==bl){var t=fl(e);bl=t.getParameter(t.MAX_TEXTURE_SIZE)}return bl}function Kl(e){if(null==_l){var t=fl(e);_l=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,_l)}function Xl(e){if(0===e)return 0;var t=fl(e);return Ql(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Ql(t,"EXT_disjoint_timer_query")?1:0}function Ql(e,t){return null!=e.getExtension(t)}function Jl(e){try{if(null!=fl(e))return!0}catch(e){return!1}return!1}function Zl(e){if(0===e)return!1;var t=fl(e);if(1===e){if(!Ql(t,"OES_texture_float"))return!1}else if(!Ql(t,"EXT_color_buffer_float"))return!1;return ed(t,e)}function $l(e){if(0===e)return!1;var t=fl(e);if(1===e){if(!Ql(t,"OES_texture_float"))return!1;if(!Ql(t,"WEBGL_color_buffer_float"))return!1}else if(!Ql(t,"EXT_color_buffer_float"))return!1;return ed(t,e)}function ed(e,t){var n=e.createFramebuffer(),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var i=2===t?e.RGBA32F:e.RGBA;e.texImage2D(e.TEXTURE_2D,0,i,1,1,0,e.RGBA,e.FLOAT,null),e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(n),a}function td(e){return 2===e&&null!=fl(e).fenceSync}var nd=Object.freeze({callAndCheck:hl,canBeRepresented:pl,getWebGLErrorMessage:ml,getExtensionOrThrow:gl,createVertexShader:vl,createFragmentShader:yl,createProgram:El,linkProgram:Sl,validateProgram:Cl,createStaticVertexBuffer:xl,createStaticIndexBuffer:Tl,getNumChannels:function(){return 2===qc.getNumber("WEBGL_VERSION")?1:4},createTexture:Rl,validateTextureSize:Il,createFramebuffer:Nl,bindVertexBufferToProgramAttribute:Al,bindTextureUnit:kl,unbindTextureUnit:function(e,t,n){Bl(e,n),hl(e,t,(function(){return e.activeTexture(e.TEXTURE0+n)})),hl(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:Dl,getProgramUniformLocation:Ml,bindTextureToProgramUniformSampler:Ll,bindCanvasToFramebuffer:function(e,t){hl(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),hl(e,t,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),hl(e,t,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:Ol,unbindColorTextureFromFramebuffer:Pl,validateFramebuffer:jl,getFramebufferErrorMessage:Fl,getBatchDim:Vl,getRowsCols:zl,getShapeAs3D:Wl,getTextureShapeFromLogicalShape:Gl,isReshapeFree:Yl,get MAX_TEXTURE_SIZE(){return bl},get MAX_TEXTURES_IN_SHADER(){return _l},getWebGLMaxTextureSize:ql,getMaxTexturesInShader:Kl,getWebGLDisjointQueryTimerVersion:Xl,isWebGLVersionEnabled:Jl,isRenderToFloatTextureEnabled:Zl,isDownloadFloatTextureEnabled:$l,isWebGLFenceEnabled:td});function rd(e){qc.getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function id(e,t){return sl.tidy(e,t)}function ad(e){rl(e).forEach((function(e){return e.dispose()}))}function od(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];qc.getBool("IS_TEST")||console.warn.apply(console,e)}function sd(e){var t=e;if(bu(e))return[e.length];if(!Array.isArray(e))return[];for(var n=[];Array.isArray(t)||bu(t);)n.push(t.length),t=t[0];return Array.isArray(e)&&qc.getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||bu(t)){$c(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),$c(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var i=n.slice(1),a=0;a<t.length;++a)e(t[a],i,r.concat(a))}else $c(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,n,[]),n}function cd(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function ud(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof Hu)return cd(r,e.dtype,t,n),e;var i=xu(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),cd(r,i,t,n),null==e||!bu(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=sd(e);bu(e)||Array.isArray(e)||(e=[e]);var s="string"!==i?Nu(e,i,qc.getBool("DEBUG")):nu(e);return Hu.make(o,{values:s},i)}function ld(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return ud(e,t+"["+r+"]",n)}),r)}function dd(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function fd(e,t,n){for(var r=e.length+t.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}function hd(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map((function(t){return e[t]}))]}function pd(e,t){return fd(e,t.map((function(e){return 1})),t)}function md(e,t,n){$c(dd(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function gd(e,t){if(dd(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function vd(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function yd(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function bd(e,t){var n=e[0].length;e.forEach((function(e,t){$c(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),$c(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,i){for(var a=0;a<n;a++)$c(a===t||e[a]===r[a],(function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."}))}))}function _d(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function wd(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];sl.startScope(n);try{var i=r.apply(void 0,e);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),sl.endScope(i),i}catch(e){throw sl.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}qc.registerFlag("HAS_WEBGL",(function(){return qc.getNumber("WEBGL_VERSION")>0})),qc.registerFlag("WEBGL_VERSION",(function(){return Jl(2)?2:Jl(1)?1:0})),qc.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===qc.get("WEBGL_VERSION")})),qc.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),qc.registerFlag("WEBGL_PACK",(function(){return qc.getBool("HAS_WEBGL")})),qc.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return qc.getBool("WEBGL_PACK")})),qc.registerFlag("WEBGL_PACK_CLIP",(function(){return qc.getBool("WEBGL_PACK")})),qc.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),qc.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return qc.getBool("WEBGL_PACK")})),qc.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return qc.getBool("WEBGL_PACK")})),qc.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return qc.getBool("WEBGL_PACK")})),qc.registerFlag("WEBGL_PACK_REDUCE",(function(){return qc.getBool("WEBGL_PACK")})),qc.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return qc.getBool("WEBGL_PACK")})),qc.registerFlag("WEBGL_CONV_IM2COL",(function(){return qc.getBool("WEBGL_PACK")})),qc.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return ql(qc.getNumber("WEBGL_VERSION"))})),qc.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Kl(qc.getNumber("WEBGL_VERSION"))})),qc.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=qc.getNumber("WEBGL_VERSION");return 0===e?0:Xl(e)})),qc.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),qc.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return Zl(qc.getNumber("WEBGL_VERSION"))})),qc.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return $l(qc.getNumber("WEBGL_VERSION"))})),qc.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return td(qc.getNumber("WEBGL_VERSION"))})),qc.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return qc.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),Gu=rd;var Ed=wd({complex_:function(e,t){var n=ud(e,"real","complex"),r=ud(t,"imag","complex");return eu(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),sl.runKernel((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),Sd=wd({real_:function(e){var t=ud(e,"input","real");return sl.runKernel((function(e){return e.real(t)}),{$input:t})}}),Cd=wd({imag_:function(e){var t=ud(e,"input","imag");return sl.runKernel((function(e){return e.imag(t)}),{$input:t})}});function xd(e,t,n){return Td(e,t,sd(e),n)}function Td(e,t,n,r){if(null==r&&(r=xu(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!bu(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Lu(t);var i=ru(t),a=ru(n);$c(i===a,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+a}));for(var o=0;o<n.length;++o){var s=n[o],c=o!==n.length-1||s!==ru(t.slice(o));$c(n[o]===t[o]||!c,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return bu(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Nu(e,r,qc.getBool("DEBUG")):nu(e),Hu.make(t,{values:e},r)}function Rd(e,t){if((bu(e)||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return Td(e,[],[],t)}function Id(e,t){tu(e);var n=sd(e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Td(e,null,n,t)}function Nd(e,t,n){if(tu(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=sd(e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Td(e,t,r,n)}function Ad(e,t,n){if(tu(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=sd(e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Td(e,t,r,n)}function kd(e,t,n){if(tu(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=sd(e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Td(e,t,r,n)}function Dd(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Dd(e,"float32"),r=Md(e,"float32");return Ed(n,r)}var i=ku(ru(e),t);return Hu.make(e,{values:i},t)}function Md(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Md(e,"float32"),r=Md(e,"float32");return Ed(n,r)}var i=Du(ru(e),t);return Hu.make(e,{values:i},t)}function Ld(e,t,n){return sl.runKernel((function(r){return r.fill(e,t,n)}),{})}function Od(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Md([0],r);var i=Du(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+n;return Id(i,r)}var Pd=wd({onesLike_:function(e){var t=ud(e,"x","onesLike");if("complex64"===t.dtype){var n=Pd(Sd(t)),r=jd(Cd(t));return Ed(n,r)}return sl.runKernel((function(e){return e.onesLike(t)}),{$x:t},(function(e,t){return{$x:function(){return jd(e)}}}))}}),jd=wd({zerosLike_:function(e){var t=ud(e,"x","zerosLike");return sl.runKernel((function(e){return e.zerosLike(t)}),{$x:t},(function(e,t){return{$x:function(){return jd(e)}}}))}}),Fd=wd({concat_:function(e,t){void 0===t&&(t=0),$c(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=ld(e,"tensors","concat");t=du(t,n[0].shape)[0];var r=_d(n.map((function(e){return e.shape})),t);if(0===ru(r))return xd([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var i=n.map((function(e){return e.shape}));bd(i,t);var a=n;return sl.runKernel((function(e){return e.concat(n,t)}),a,(function(e){var n=i.map((function(e){return e[t]}));return Wd(e,n,t).map((function(e){return function(){return e}}))}))}}),Ud=wd({concat1d_:function(e){return Fd(e,0)}}),Bd=wd({concat2d_:function(e,t){return Fd(e,t)}}),Vd=wd({concat3d_:function(e,t){return Fd(e,t)}}),zd=wd({concat4d_:function(e,t){return Fd(e,t)}}),Wd=wd({split_:function(e,t,n){void 0===n&&(n=0);var r,i=ud(e,"x","split");return n=du(n,i.shape)[0],"number"==typeof t?($c(i.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(i.shape[n]/t)):($c(i.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),sl.runKernel((function(e){return e.split(i,r,n)}),{$x:i},(function(e){return{$x:function(){return Fd(e,n)}}}))}});function Gd(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var Hd=Gd((function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var i=new n(e),a=t&&t.state,o=i.next;return o.int32=function(){return 4294967296*i.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,a&&("object"==typeof a&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.alea=i}(0,e)})),Yd=Gd((function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var i=new n(e),a=t&&t.state,o=function(){return(i.next()>>>0)/4294967296};return o.double=function(){do{var e=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=i.next,o.quick=o,a&&("object"==typeof a&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.xor128=i}(0,e)})),qd=Gd((function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var i=new n(e),a=t&&t.state,o=function(){return(i.next()>>>0)/4294967296};return o.double=function(){do{var e=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=i.next,o.quick=o,a&&("object"==typeof a&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)})),Kd=Gd((function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var i=new n(e),a=t&&t.state,o=function(){return(i.next()>>>0)/4294967296};return o.double=function(){do{var e=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=i.next,o.quick=o,a&&(a.x&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)})),Xd=Gd((function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),i=0,a=-32;a<c;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(o=o+1640531527|0,i=0==(n=s[127&a]^=r+o)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=o,e.X=s,e.i=i}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var i=new n(e),a=t&&t.state,o=function(){return(i.next()>>>0)/4294967296};return o.double=function(){do{var e=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=i.next,o.quick=o,a&&(a.X&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)})),Qd=Gd((function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var i=new n(e),a=t&&t.state,o=function(){return(i.next()>>>0)/4294967296};return o.double=function(){do{var e=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=i.next,o.quick=o,a&&("object"==typeof a&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.tychei=i}(0,e)})),Jd=Gd((function(e){!function(t,r){var i,a=this,o=256,s="random",c=r.pow(o,6),u=r.pow(2,52),l=2*u,d=255;function f(e,n,d){var f=[],v=m(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,g(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),g(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,g(t)]}}():e,3),f),y=new h(f),b=function(){for(var e=y.g(6),t=c,n=0;e<u;)e=(e+n)*o,t*=o,n=y.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,m(g(y.S),t),(n.pass||d||function(e,t,n,i){return i&&(i.S&&p(i,y),e.state=function(){return p(y,{})}),n?(r[s]=e,t):e})(b,v,"global"in n?n.global:this==r,n.state)}function h(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=d&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=d&i+1],n=n*o+s[d&(s[i]=s[a=d&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var n,r=e+"",i=0;i<r.length;)t[d&i]=d&(n^=19*t[d&i])+r.charCodeAt(i++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=f,m(r.random(),t),e.exports){e.exports=f;try{i=n(Object(function(){var e=new Error("Cannot find module 'crypto'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(e){}}}([],Math)}));Jd.alea=Hd,Jd.xor128=Yd,Jd.xorwow=qd,Jd.xorshift7=Kd,Jd.xor4096=Xd,Jd.tychei=Qd;var Zd=Jd.alea,$d=function(){function e(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Zd(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var i=void 0,a=void 0,o=void 0;do{o=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),ef=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=1);var i=this;if(this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Zd(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function tf(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",Lu(e),new Vu(e,t,n)}var nf=wd({batchToSpaceND_:function(e,t,n){var r=ud(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return $c(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),$c(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),$c(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),sl.runKernel((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),rf=wd({cast_:function(e,t){var n=ud(e,"x","cast");if(!vu(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return sl.runKernel((function(e){return e.cast(n,t)}),{$x:n},(function(e){return{$x:function(){return e.clone()}}}))}}),af=wd({clone_:function(e){var t=ud(e,"x","clone",null);return sl.runKernel((function(e){return Hu.make(t.shape,{dataId:t.dataId},t.dtype)}),{$x:t},(function(e){return{$x:function(){return e.toFloat()}}}))}}),of=wd({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=ud(e,"x","cumsum"),a=gd([t|=0],i.rank),o=i;null!=a&&(o=i.transpose(a));var s=yd(1,i.rank)[0],c=sl.runKernel((function(e){return e.cumsum(o,s,n,r)}),{permutedX:o},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=a&&(c=c.transpose(a)),c}}),sf=wd({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=ud(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return $c(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),$c(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),$c(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape})),sl.runKernel((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),cf=wd({expandDims_:function(e,t){void 0===t&&(t=0);var n=ud(e,"x","expandDims",null);$c(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&($c(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),_f(n,r)}}),uf=wd({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var i=tf([e,t],r),a=e<=t?e:t,o=0;o<a;++o)i.set(1,o,o);var s=i.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return Cf(cf(s,0),[n[0],1,1]);if(2===n.length)return Cf(cf(cf(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Cf(cf(cf(cf(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),lf=wd({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var i=ud(e,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?i.as2D(1,-1):i,c=sl.runKernel((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===o?c.as1D():c}}),df=wd({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=ud(e,"indices","oneHot","int32"),a=i.shape.concat([t]);return i=i.flatten(),sl.runKernel((function(e){return e.oneHot(i,t,n,r)}),{$indices:i},(function(e){return{$indices:function(){return Md(i.shape,"float32")}}})).reshape(a)}}),ff=wd({pad_:function(e,t,n){void 0===n&&(n=0);var r=ud(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=t.map((function(e){return e[0]}));return sl.runKernel((function(e){return e.pad(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.slice(i,r.shape)}}}))}}),hf=wd({pad1d_:function(e,t,n){return void 0===n&&(n=0),$c(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),ff(e,[t],n)}}),pf=wd({pad2d_:function(e,t,n){return void 0===n&&(n=0),$c(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ff(e,t,n)}}),mf=wd({pad3d_:function(e,t,n){return void 0===n&&(n=0),$c(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ff(e,t,n)}}),gf=wd({pad4d_:function(e,t,n){return void 0===n&&(n=0),$c(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ff(e,t,n)}}),vf=wd({rand_:function(e,t,n){var r=ru(e),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var a=0;a<r;a++)i[a]=t();return Hu.make(e,{values:i},n)}}),yf=wd({randomNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new $d(t,n,r,!1,i),o=tf(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),bf=wd({randomUniform_:function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=tf(e,r),o=new ef(t,n,null,i),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),_f=wd({reshape_:function(e,t){var n=ud(e,"x","reshape",null);return t=lu(t,n.size),$c(n.size===ru(t),(function(){return"new shape and old shape must have the same number of elements."})),sl.runKernel((function(e){return e.reshape(n,t)}),{$x:n},(function(e){return{$x:function(){return e.reshape(n.shape)}}}))}}),wf=wd({spaceToBatchND_:function(e,t,n){var r=ud(e,"x","spaceToBatchND");return $c(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),$c(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),$c(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),sl.runKernel((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),Ef=wd({squeeze_:function(e,t){var n=ud(e,"x","squeeze");return _f(n,fu(n.shape,t).newShape)}}),Sf=wd({stack_:function(e,t){void 0===t&&(t=0);var n=ld(e,"tensors","stack");if($c(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,i=n[0].shape,a=n[0].dtype;$c(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){eu(i,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){$c(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=n.map((function(e){return e.expandDims(t)}));return Fd(o,t)}}),Cf=wd({tile_:function(e,t){var n=ud(e,"x","tile",null);return $c(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."})),sl.runKernel((function(e,r){var i=e.tile(n,t);return r([n]),i}),{$x:n},(function(e,n){var r=n[0];return{$x:function(){var n=jd(r);if(1===r.rank)for(var i=0;i<t[0];++i)n=n.add(e.slice([i*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(i=0;i<t[0];++i)for(var a=0;a<t[1];++a)n=n.add(e.slice([i*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(i=0;i<t[0];++i)for(a=0;a<t[1];++a)for(var o=0;o<t[2];++o)n=n.add(e.slice([i*r.shape[0],a*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(i=0;i<t[0];++i)for(a=0;a<t[1];++a)for(o=0;o<t[2];++o)for(var s=0;s<t[3];++s)n=n.add(e.slice([i*r.shape[0],a*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}}))}}),xf=wd({truncatedNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new $d(t,n,r,!0,i),o=tf(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Tf=wd({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=ud(e,"x","unstack");return $c(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length),sl.runKernel((function(e){return e.unstack(n,t)}),{$x:n},(function(e){return{$x:function(){return Sf(e,t)}}}))}});function Rf(e,t,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var a=t.length,o=0;o<a;++o)i=i.concat([e[o+1]/t[o],t[o]]);i=i.concat(e.slice(a+1))}return i}function If(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var a=[],o=[];for(i=1;i<e;++i)i>=2*t+1||i%2==1?o.push(i):a.push(i);r.push.apply(r,a),r.push(0),r.push.apply(r,o)}return r}function Nf(e,t,n,r){void 0===r&&(r=!0);var i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?i.push(t[a-1]*e[a]):i.push(e[a]/t[a-1]):i.push(e[a]);return i}function Af(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function kf(e,t,n){for(var r=e.slice(0,1),i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}function Df(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],i=1,a=0;a<n.length-1;++a)i*=n[a];var o=e.shape,s=n.slice();s.pop();var c=1;for(a=r;a<e.rank;++a)c*=o[a],s.push(o[a]);var u=Iu(e.shape).map((function(e){return e/c})).concat([1]).slice(0,r);return[s,i,c,u]}function Mf(e){return e<=30?e:Ru(e,Math.floor(Math.sqrt(e)))}function Lf(e,t,n){for(var r=t.rank>1?t.shape[t.rank-1]:1,i=n.length,a=1,o=r;o<i;++o)a*=n[o];var s=r<1?1:r;return{sliceRank:r,numUpdates:t.size/s,sliceSize:a,strides:Iu(n.slice(0,r)).concat([1]),outputSize:ru(n)}}function Of(e,t,n,r,i,a,o,s,c){if(void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),0!==o)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");for(var u=[],l=[],d=[],f=0;f<e.length;f++)u[f]=Pf(i,t,r,e,f),l[f]=jf(a,n,r,e,f),c&1<<f&&(l[f]=u[f]+1,d.push(f));var h=new Array(e.length).fill(0);return h=h.map((function(e,t){for(var n=0,i=r[t]||1,a=u[t];!(i>0?a>=l[t]:a<=l[t]);a+=i)n+=1;return n})),[u,h,d]}function Pf(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),Qc(0,a,s-1)}function jf(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),o>0?Qc(0,a,s):Qc(-1,a,s-1)}function Ff(e,t,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function Uf(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Bf(e){return sl.customGrad(e)}var Vf=wd({softmax_:function(e,t){void 0===t&&(t=-1);var n=ud(e,"logits","softmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return Bf((function(e,n){var r=e.logSumExp([t],!0),i=e.toFloat().sub(r).exp();return n([i]),{value:i,gradFunc:function(e,n){var r=n[0],i=e.mul(r);return i.sub(i.sum([t],!0).mul(r))}}}))(n)}}),zf=wd({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=ud(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Bf((function(e,n){var r=e.max(t,!0),i=e.sub(r),a=i.toFloat().sub(i.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),Wf=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.data.delete(e)},e}();!function(){function e(){}e.prototype.time=function(e){throw new Error("Not yet implemented.")},e.prototype.read=function(e){throw new Error("Not yet implemented.")},e.prototype.readSync=function(e){throw new Error("Not yet implemented.")},e.prototype.disposeData=function(e){throw new Error("Not yet implemented.")},e.prototype.write=function(e,t){throw new Error("Not yet implemented.")},e.prototype.fromPixels=function(e,t){throw new Error("Not yet implemented.")},e.prototype.register=function(e,t,n){throw new Error("Not yet implemented.")},e.prototype.memory=function(){throw new Error("Not yet implemented.")},e.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.fusedBatchMatMul=function(e,t,n,r,i,a){throw new Error("Not yet implemented")},e.prototype.slice=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s,c){throw new Error("Not yet implemented")},e.prototype.unstack=function(e,t){throw new Error("Not yet implemented")},e.prototype.reverse=function(e,t){throw new Error("Not yet implemented")},e.prototype.concat=function(e,t){throw new Error("Not yet implemented")},e.prototype.neg=function(e){throw new Error("Not yet implemented")},e.prototype.add=function(e,t){throw new Error("Not yet implemented")},e.prototype.addN=function(e){throw new Error("Not yet implemented")},e.prototype.subtract=function(e,t){throw new Error("Not yet implemented")},e.prototype.multiply=function(e,t){throw new Error("Not yet implemented")},e.prototype.realDivide=function(e,t){throw new Error("Not yet implemented")},e.prototype.floorDiv=function(e,t){throw new Error("Not yet implemented")},e.prototype.sum=function(e,t){throw new Error("Not yet implemented")},e.prototype.prod=function(e,t){throw new Error("Not yet implemented")},e.prototype.unsortedSegmentSum=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.argMin=function(e,t){throw new Error("Not yet implemented")},e.prototype.argMax=function(e,t){throw new Error("Not yet implemented")},e.prototype.equal=function(e,t){throw new Error("Not yet implemented")},e.prototype.notEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.less=function(e,t){throw new Error("Not yet implemented")},e.prototype.lessEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.greater=function(e,t){throw new Error("Not yet implemented")},e.prototype.greaterEqual=function(e,t){throw new Error("Not yet implemented")},e.prototype.logicalNot=function(e){throw new Error("Not yet implemented")},e.prototype.logicalAnd=function(e,t){throw new Error("Not yet implemented")},e.prototype.logicalOr=function(e,t){throw new Error("Not yet implemented")},e.prototype.where=function(e){throw new Error("Not yet implemented")},e.prototype.select=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.topk=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.min=function(e,t){throw new Error("Not yet implemented")},e.prototype.minimum=function(e,t){throw new Error("Not yet implemented")},e.prototype.mod=function(e,t){throw new Error("Not yet implemented")},e.prototype.max=function(e,t){throw new Error("Not yet implemented")},e.prototype.maximum=function(e,t){throw new Error("Not yet implemented")},e.prototype.all=function(e,t){throw new Error("Not yet implemented")},e.prototype.any=function(e,t){throw new Error("Not yet implemented")},e.prototype.squaredDifference=function(e,t){throw new Error("Not yet implemented")},e.prototype.ceil=function(e){throw new Error("Not yet implemented")},e.prototype.floor=function(e){throw new Error("Not yet implemented")},e.prototype.round=function(e){throw new Error("Not yet implemented")},e.prototype.sign=function(e){throw new Error("Not yet implemented")},e.prototype.isNaN=function(e){throw new Error("Not yet implemented")},e.prototype.isInf=function(e){throw new Error("Not yet implemented")},e.prototype.isFinite=function(e){throw new Error("Not yet implemented")},e.prototype.pow=function(e,t){throw new Error("Not yet implemented")},e.prototype.exp=function(e){throw new Error("Not yet implemented")},e.prototype.expm1=function(e){throw new Error("Not yet implemented")},e.prototype.log=function(e){throw new Error("Not yet implemented")},e.prototype.log1p=function(e){throw new Error("Not yet implemented")},e.prototype.sqrt=function(e){throw new Error("Not yet implemented")},e.prototype.rsqrt=function(e){throw new Error("Not yet implemented")},e.prototype.square=function(e){throw new Error("Not yet implemented")},e.prototype.reciprocal=function(e){throw new Error("Not yet implemented")},e.prototype.relu=function(e){throw new Error("Not yet implemented")},e.prototype.prelu=function(e,t){throw new Error("Not yet implemented")},e.prototype.elu=function(e){throw new Error("Not yet implemented")},e.prototype.eluDer=function(e,t){throw new Error("Not yet implemented")},e.prototype.selu=function(e){throw new Error("Not yet implemented")},e.prototype.int=function(e){throw new Error("Not yet implemented")},e.prototype.clip=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.abs=function(e){throw new Error("Not yet implemented")},e.prototype.complexAbs=function(e){throw new Error("Not yet implemented")},e.prototype.sigmoid=function(e){throw new Error("Not yet implemented")},e.prototype.softplus=function(e){throw new Error("Not yet implemented")},e.prototype.sin=function(e){throw new Error("Not yet implemented")},e.prototype.cos=function(e){throw new Error("Not yet implemented")},e.prototype.tan=function(e){throw new Error("Not yet implemented")},e.prototype.asin=function(e){throw new Error("Not yet implemented")},e.prototype.acos=function(e){throw new Error("Not yet implemented")},e.prototype.atan=function(e){throw new Error("Not yet implemented")},e.prototype.atan2=function(e,t){throw new Error("Not yet implemented")},e.prototype.sinh=function(e){throw new Error("Not yet implemented")},e.prototype.cosh=function(e){throw new Error("Not yet implemented")},e.prototype.tanh=function(e){throw new Error("Not yet implemented")},e.prototype.asinh=function(e){throw new Error("Not yet implemented")},e.prototype.acosh=function(e){throw new Error("Not yet implemented")},e.prototype.atanh=function(e){throw new Error("Not yet implemented")},e.prototype.erf=function(e){throw new Error("Not yet implemented")},e.prototype.step=function(e,t){throw new Error("Not yet implemented")},e.prototype.conv2d=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv2dDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv2dDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2D=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3d=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3dDerInput=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.conv3dDerFilter=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.maxPool=function(e,t){throw new Error("Not yet implemented")},e.prototype.maxPoolBackprop=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.avgPool=function(e,t){throw new Error("Not yet implemented")},e.prototype.avgPoolBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.reshape=function(e,t){throw new Error("Not yet implemented")},e.prototype.cast=function(e,t){throw new Error("Not yet implemented")},e.prototype.tile=function(e,t){throw new Error("Not yet implemented")},e.prototype.pad=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.transpose=function(e,t){throw new Error("Not yet implemented")},e.prototype.gather=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.gatherND=function(e,t){throw new Error("Not yet implemented")},e.prototype.scatterND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.batchToSpaceND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.spaceToBatchND=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.resizeBilinear=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.resizeBilinearBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.batchNormalization=function(e,t,n,r,i,a){throw new Error("Not yet implemented")},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){throw new Error("Not yet implemented")},e.prototype.LRNGrad=function(e,t,n,r,i,a,o){throw new Error("Not yet implemented")},e.prototype.multinomial=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.oneHot=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.cumsum=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){throw new Error("Not yet implemented")},e.prototype.fft=function(e){throw new Error("Not yet implemented")},e.prototype.ifft=function(e){throw new Error("Not yet implemented")},e.prototype.complex=function(e,t){throw new Error("Not yet implemented")},e.prototype.real=function(e){throw new Error("Not yet implemented")},e.prototype.imag=function(e){throw new Error("Not yet implemented")},e.prototype.cropAndResize=function(e,t,n,r,i,a){throw new Error("Not yet implemented")},e.prototype.depthToSpace=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.split=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.sparseToDense=function(e,t,n,r){throw new Error("Not yet implemented")},e.prototype.fill=function(e,t,n){throw new Error("Not yet implemented.")},e.prototype.onesLike=function(e){throw new Error("Not yet implemented")},e.prototype.zerosLike=function(e){throw new Error("Not yet implemented")},e.prototype.linspace=function(e,t,n){throw new Error("Not yet implemented")},e.prototype.dispose=function(){throw new Error("Not yet implemented")}}();function Gf(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var a=n-1-i,o=e[a]||1;(t[t.length-1-i]||1)>1&&1===o&&r.unshift(a)}return r}function Hf(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],a=t.length-r-1,o=t[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n}function Yf(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var a=e[e.length-i-1];null==a&&(a=1);var o=t[t.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}function qf(e,t,n,r,i,a,o){void 0===o&&(o="channelsLast");var s,c=Jf(t),u=c[0],l=c[1];if("channelsLast"===o)s=[u,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);s=[u,l,e[1],e[1]]}return Kf(e,s,n,r,i,a,!1,o)}function Kf(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var c=[-1,-1,-1,-1],u=c[0],l=c[1],d=c[2],f=c[3];if("channelsLast"===s)u=e[0],l=e[1],d=e[2],f=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);u=e[0],f=e[1],l=e[2],d=e[3]}var h,p=t[0],m=t[1],g=t[3],v=Jf(n),y=v[0],b=v[1],_=Jf(r),w=_[0],E=_[1],S=$f(p,w),C=$f(m,E),x=function(e,t,n,r,i,a,o,s){var c,u,l;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var d=function(e,t,n,r,i,a){null==i&&(i=Qf(e,t,r));var o=e[1],s=eh((e[0]-t+2*i)/r+1,a);$c(au(s),(function(){return"The output # of rows ("+s+") must be an integer. Change the stride and/or zero pad parameters"}));var c=eh((o-t+2*i)/r+1,a);return $c(au(c),(function(){return"The output # of columns ("+c+") must be an integer. Change the stride and/or zero pad parameters"})),[s,c,1]}([t,n,1],a,0,r,e,s);u=d[0],l=d[1]}else if("same"===e){u=Math.ceil(t/r),l=Math.ceil(n/i);var f=Math.max(0,(u-1)*r+a-t),h=Math.max(0,(l-1)*i+o-n),p=Math.floor(f/2),m=f-p,g=Math.floor(h/2);c={top:p,bottom:m,left:g,right:h-g,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-a+1)/r),l=Math.ceil((n-o+1)/i)}return{padInfo:c,outHeight:u,outWidth:l}}(i,l,d,y,b,S,C,a),T=x.padInfo,R=x.outHeight,I=x.outWidth,N=o?g*f:g;return"channelsFirst"===s?h=[u,N,R,I]:"channelsLast"===s&&(h=[u,R,I,N]),{batchSize:u,dataFormat:s,inHeight:l,inWidth:d,inChannels:f,outHeight:R,outWidth:I,outChannels:N,padInfo:T,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:m,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationHeight:w,dilationWidth:E,inShape:e,outShape:h,filterShape:t}}function Xf(e,t,n,r,i,a,o){void 0===a&&(a=!1),void 0===o&&(o="channelsLast");var s=[-1,-1,-1,-1,-1],c=s[0],u=s[1],l=s[2],d=s[3],f=s[4];if("channelsLast"===o)c=e[0],u=e[1],l=e[2],d=e[3],f=e[4];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);c=e[0],f=e[1],u=e[2],l=e[3],d=e[4]}var h,p=t[0],m=t[1],g=t[2],v=t[4],y=Zf(n),b=y[0],_=y[1],w=y[2],E=Zf(r),S=E[0],C=E[1],x=E[2],T=function(e,t,n,r,i,a,o,s,c,u){var l,d,f,h;if("same"===e){var p=((d=Math.ceil(t/i))-1)*i+s-t,m=((f=Math.ceil(n/a))-1)*a+c-n,g=((h=Math.ceil(r/o))-1)*o+u-r,v=Math.floor(p/2),y=p-v,b=Math.floor(m/2),_=m-b,w=Math.floor(g/2);l={top:b,bottom:_,left:w,right:g-w,front:v,back:y,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);l={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-s+1)/i),f=Math.ceil((n-c+1)/a),h=Math.ceil((r-u+1)/o)}return{padInfo:l,outDepth:d,outHeight:f,outWidth:h}}(i,u,l,d,b,_,w,$f(p,S),$f(m,C),$f(g,x)),R=T.padInfo,I=T.outDepth,N=T.outHeight,A=T.outWidth,k=a?v*f:v;return"channelsFirst"===o?h=[c,k,I,N,A]:"channelsLast"===o&&(h=[c,I,N,A,k]),{batchSize:c,dataFormat:o,inDepth:u,inHeight:l,inWidth:d,inChannels:f,outDepth:I,outHeight:N,outWidth:A,outChannels:k,padInfo:R,strideDepth:b,strideHeight:_,strideWidth:w,filterDepth:p,filterHeight:m,filterWidth:g,dilationDepth:S,dilationHeight:C,dilationWidth:x,inShape:e,outShape:h,filterShape:t}}function Qf(e,t,n,r){void 0===r&&(r=1);var i=$f(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function Jf(e){return"number"==typeof e?[e,e]:e}function Zf(e){return"number"==typeof e?[e,e,e]:e}function $f(e,t){return t<=1?e:e+(e-1)*(t-1)}function eh(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function th(e){var t=Jf(e),n=t[0],r=t[1];return 1===n&&1===r}function nh(e,t){return th(e)||th(t)}function rh(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=Md(e.shape),i=e.toFloat(),a=n.complex(i,r);return r.dispose(),i.dispose(),a}if(!yu(e.dtype,t))return Hu.make(e.shape,{dataId:e.dataId},t);if("complex64"===e.dtype){var o=n.real(e);return a=o.cast(t),o.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=Rd(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function ih(e,t){return Hu.make(t,{dataId:e.dataId},e.dtype)}function ah(e,t,n){var r=(t-e)/(n-1),i=Du(n,"float32");i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+r;return Id(i,"float32")}Object.freeze({castTensor:rh,reshapeTensor:ih,linspaceImpl:ah,upcastType:$u,axesAreInnerMostDims:dd,combineLocations:fd,computeOutAndReduceShapes:hd,expandShapeToKeepDim:pd,assertAxesAreInnerMostDims:md,getAxesPermutation:gd,getUndoAxesPermutation:vd,getInnerMostAxes:yd,getBroadcastDims:Gf,getReductionAxes:Hf,assertAndGetBroadcastShape:Yf,assertParamsConsistent:bd,computeOutShape:_d,computePool2DInfo:qf,computeConv2DInfo:Kf,computeConv3DInfo:Xf,computeDefaultPad:Qf,tupleValuesAreOne:th,eitherStridesOrDilationsAreOne:nh});function oh(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function sh(e,t){return{real:e[2*t],imag:e[2*t+1]}}function ch(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function uh(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function lh(e,t,n,r,i){for(var a=Array.from(t).map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>i})).sort((function(e,t){return t.score-e.score})),o=[],s=0;s<a.length;s++){var c=a[s],u=c.score,l=c.boxIndex;if(u<i)break;for(var d=!1,f=o.length-1;f>=0;--f)if(dh(e,l,o[f])>=r){d=!0;break}if(!d&&(o.push(l),o.length>=n))break}return Id(o,"int32")}function dh(e,t,n){var r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),u=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),h=(s-a)*(c-o),p=(d-u)*(f-l);if(h<=0||p<=0)return 0;var m=Math.max(a,u),g=Math.max(o,l),v=Math.min(s,d),y=Math.min(c,f),b=Math.max(v-m,0)*Math.max(y-g,0);return b/(h+p-b)}function fh(e,t,n){var r=new Array(e.rank).fill(0),i=e.shape.slice();return t.map((function(t){i[n]=t;var a=e.slice(r,i);return r[n]+=t,a}))}function hh(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var i=tf(n,e.dtype);for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),o=new Array(e.rank),s=0;s<o.length;s++)o[s]=a[s]%e.shape[s];var c=e.locToIndex(o);i.values[r]=e.values[c]}return i.toTensor()}function ph(e,t,n,r,i){for(var a=t[t.length-1],o=[e.length/a,a],s=o[0],c=o[1],u=hu(n,s*r),l=hu("int32",s*r),d=0;d<s;d++){for(var f=d*c,h=e.subarray(f,f+c),p=[],m=0;m<h.length;m++)p.push({value:h[m],index:m});p.sort((function(e,t){return t.value-e.value}));var g=d*r,v=u.subarray(g,g+r),y=l.subarray(g,g+r);for(m=0;m<r;m++)v[m]=p[m].value,y[m]=p[m].index}var b=t.slice();return b[b.length-1]=r,[xd(u,b,n),xd(l,b,"int32")]}function mh(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var i=tf(e,"int32"),a=tf([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=i.indexToLoc(n[r]),s=r*e.length;a.values.set(o,s)}return a.toTensor()}var gh=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},vh=function(e,t){this.outputShape=[],this.usesPackedTextures=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},yh=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,a=e.inSize,o=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===t?">":"<",c=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+c+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function bh(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function _h(e,t){return 1===t?[e]:bh(e,t)}function wh(){var e,t,n,r,i,a,o,s,c,u;return 2===qc.getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 0. || val == 0.) ? false : true;\n      }\n    ",c="\n      const float INFINITY = uintBitsToFloat(uint(0x7f800000));\n    ",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",o="",s="\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:c,defineRound:u}}function Eh(e,t,n){void 0===n&&(n="index");var r=Iu(t);return r.map((function(t,i){return"int "+e[i]+" = "+n+" / "+t+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+t:"index -= "+e[i]+" * "+t)+";"})).join("")}function Sh(e){var t=Iu(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var Ch="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function xh(e,t,n,r){var i=[];e.forEach((function(e){var t=ru(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(i.push("uniform sampler2D "+e.name+";"),i.push("uniform int offset"+e.name+";"))}));var a,o,s=i.join("\n"),c=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?Rh(e):Th(e);var i=e.shapeInfo.logicalShape,a=t.logicalShape;return i.length<=a.length&&(r+=n?function(e,t){var n,r=e.name,i=r.charAt(0).toUpperCase()+r.slice(1),a="get"+i+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,c=Gf(e.shapeInfo.logicalShape,t.logicalShape),u=Lh(s),l=s-o,d=["x","y","z","w","u","v"];n=0===o?"":s<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords."+d[e+l]+" = 0;"})).join("\n");var f;f=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+d[t+l]})).join(", ");var h="return outputValue;",p=1===ru(e.shapeInfo.logicalShape),m=1===ru(t.logicalShape);if(1!==o||p||m){if(p&&!m)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var g=o-2,v=o-1;c.indexOf(g)>-1&&c.indexOf(v)>-1?h="return vec4(outputValue.x);":c.indexOf(g)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(v)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+u+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+i+"("+f+");\n      "+h+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===c&&null==e.shapeInfo.flatOffset&&iu(o,a))return"\n      float "+i+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var u,l=Lh(c),d=Gf(e.shapeInfo.logicalShape,t.logicalShape),f=c-s,h=["x","y","z","w","u","v"];u=0===s?"":c<2&&d.length>=1?"coords = 0;":d.map((function(e){return"coords."+h[e+f]+" = 0;"})).join("\n");var p;return p=c<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+h[t+f]})).join(", "),"\n    float "+i+"() {\n      "+l+" coords = getOutputCoords();\n      "+u+"\n      return get"+r+"("+p+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),u=t.texShape,l=wh(),d=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),f=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    #define isnan(value) isnan_custom(value)\n    "+e.defineSpecialNaN+"\n    bvec4 isnan_custom(vec4 val) {\n      return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n    }\n\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Ih+"\n    "+Nh+"\n    "+Ah+"\n  "}(l);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(iu(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      int index = resTexRC.x * "+i[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),i=r*Math.ceil(e[e.length-2]/2),a=i,o="",s="b, r, c",c=2;c<e.length-1;c++)o="\n      int b"+c+" = index / "+(a*=e[e.length-c-1])+";\n      index -= b"+c+" * "+a+";\n    "+o,s="b"+c+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+o+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,i,a,o}(t.logicalShape,u),o=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(l)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return iu(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=Eh(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=Eh(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=Eh(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=Eh(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,u),o=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(f+=kh),[f,d,o,s,a,c,n].join("\n")}function Th(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===i&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+Dh(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+Mh(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===a&&1===i)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=Dh(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+o+") + 0.5) / "+i+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+o+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+a+", index + "+o+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape;if(null!=i&&iu(t,i)){var a=i[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var o=fu(t),s=o.newShape,c=o.keptDims,u=s;if(u.length<t.length)return"\n      "+Th(Oh(e,u))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+Ph(["row","col"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+Mh(e)+"\n      }\n    ";var l=i[0],d=i[1],f=Dh(n);return 1===d?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+f+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+f+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+d+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+f+";\n    vec2 uv = uvFromFlat("+l+", "+d+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],a=t[2],o=fu(t),s=o.newShape,c=o.keptDims,u=s;if(u.length<t.length)return"\n        "+Th(Oh(e,u))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+Ph(["row","col","depth"],c)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+i+", "+a+", 1)));\n        "+Mh(e)+"\n      }\n    ";var l=e.shapeInfo.texShape,d=l[0],f=l[1],h=e.shapeInfo.flatOffset;return f===i&&null==h?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+f+".0, "+d+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":f===a&&null==h?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+".0, "+d+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+i+" + col * "+a+" + depth + "+Dh(n)+";\n        vec2 uv = uvFromFlat("+d+", "+f+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],a=t[2]*i,o=t[1]*a,s=fu(t),c=s.newShape,u=s.keptDims;if(c.length<t.length)return"\n      "+Th(Oh(e,c))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+Ph(["row","col","depth","depth2"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+o+", "+a+", "+i+", 1)));\n        "+Mh(e)+"\n      }\n    ";var l=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,f=d[0],h=d[1];return h===o&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":h===i&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+o+" + col * "+a+" +\n          depth * "+i+" + depth2;\n      vec2 uv = uvFromFlat("+f+", "+h+", index + "+Dh(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],a=t[3]*i,o=t[2]*a,s=t[1]*o,c=fu(t),u=c.newShape,l=c.keptDims;if(u.length<t.length)return"\n      "+Th(Oh(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+Ph(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+o+", "+a+", "+i+")) +\n          depth3;\n        "+Mh(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],p=f[1];return p===s&&null==d?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+o+", "+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===i&&null==d?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+o+" + depth * "+a+" +\n          depth2 * "+i+" + depth3 + "+Dh(n)+";\n      vec2 uv = uvFromFlat("+h+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=fu(t),a=i.newShape,o=i.keptDims;if(a.length<t.length)return"\n      "+Th(Oh(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+Ph(["row","col","depth","depth2","depth3","depth4"],o)+");\n      }\n    ";var s=t[5],c=t[4]*s,u=t[3]*c,l=t[2]*u,d=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+d+", "+l+", "+u+", "+c+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+Mh(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],m=h[1];return m===d&&null==f?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+u+", "+c+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===s&&null==f?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+d+" + col * "+l+" + depth * "+u+" +\n          depth2 * "+c+" + depth3 * "+s+" + depth4 + "+Dh(n)+";\n      vec2 uv = uvFromFlat("+p+", "+m+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Rh(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+wh().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=wh();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=i[0],o=i[1],s=wh();if(null!=i&&iu(t,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+o+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+c[0]+", "+c[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===t[0])return"\n        "+Rh(Oh(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+Ph(["b","row","col"],[1,2])+");\n        }\n      ";var o=a[0],s=a[1],c=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+o+", "+s+", "+c*Math.ceil(t[1]/2)+", "+c+", b, row, col);\n      return "+wh().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=o[0],c=o[1],u=Math.ceil(t[n-1]/2),l=u*Math.ceil(t[n-2]/2),d="int b, int row, int col",f="b * "+l+" + (row / 2) * "+u+" + (col / 2)",h=2;h<n-1;h++)d="int b"+h+", "+d,f="b"+h+" * "+(l*=t[n-h-1])+" + "+f;return"\n    vec4 "+i+"("+d+") {\n      int index = "+f+";\n      int texR = index / "+c+";\n      int texC = index - texR * "+c+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+c+", "+s+");\n      return "+wh().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var Ih="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Nh="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ah="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",kh="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Dh(e){return"offset"+e}function Mh(e){var t=e.name,n=ru(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function Lh(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Oh(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Ph(e,t){return t.map((function(t){return e[t]})).join(", ")}var jh=function(e,t,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,$c(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var i=e[e.length-1],a=Math.ceil(i/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var o,s,c=this.outputShape,u=c.length,l=Lh(u),d=_h("coords",u);if(1===a){var f=Lh(s=u+1);o="\n        "+f+" sourceLocR = "+f+"("+d.join()+", 0);\n        ++"+d[u-1]+";\n        "+f+" sourceLocG = "+f+"("+d.join()+", 0);\n        ++"+d[u-2]+";\n        "+f+" sourceLocA = "+f+"("+d.join()+", 0);\n        --"+d[u-1]+";\n        "+f+" sourceLocB = "+f+"("+d.join()+", 0);\n        --"+d[u-2]+";"}else s=u,o="\n        "+l+" sourceLocR = coords;\n        ++"+d[u-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+d[u-2]+";\n        "+l+" sourceLocA = coords;\n        --"+d[u-1]+";\n        "+l+" sourceLocB = coords;\n        --"+d[u-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],m=h.map((function(e){return"int "+e})),g=_h("sourceLocR",s-1).concat("inIdx.r"),v=_h("sourceLocG",s-1).concat("inIdx.g"),y=_h("sourceLocB",s-1).concat("inIdx.b"),b=_h("sourceLocA",s-1).concat("inIdx.a"),_="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",E="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",S=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+S+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+d[u-1]+" < "+(c[u-1]-1)+";\n        bool hasNextRow = "+d[u-2]+" < "+(c[u-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+E+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+E+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+_+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Fh=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=s-1-e.padInfo.top,l=c-1-e.padInfo.left,d=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+u+", "+l+");\n      const float avgMultiplier = float("+d+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+c+";\n            wC+= "+o+") {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Uh=function(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],Yf(e,t),Yf(e,n);var o="0.0";null!=r&&(Yf(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";null!=i&&(Yf(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Bh=function(e,t,n,r,i,a){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],Yf(e,t),Yf(e,n);var o="vec4(0.0)";null!=r&&(Yf(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=i&&(Yf(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Vh=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Yf(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},zh="return a + b;",Wh="return a - b;",Gh="return a * b;",Hh=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Yf(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Yh=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=Yf(t,n);var i=this.outputShape.length,a="";if(r)if(0===i||1===ru(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+Lh(i)+" coords = getOutputCoords();\n        ",1===i)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=_h("coords",i);a+="\n            bool nextRowOutOfBounds =\n              ("+o[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+o[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},qh=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, min, max));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"min"),n.maxLoc=r.getUniformLocationNoThrow(i,"max")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Kh=function(){function e(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(min), vec4(max)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"min"),n.maxLoc=r.getUniformLocationNoThrow(i,"max")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Xh=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Qh=function(e){this.outputShape=[],this.outputShape=_d(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var i=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var a=t.length,o=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+o+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},Jh=function(e,t){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=_d(e,t);var n=this.outputShape,r=n.length,i=Lh(r),a=_h("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var s=new Array(e.length-1);s[0]=e[0][t];for(var c=1;c<s.length;c++)s[c]=s[c-1]+e[c][t];var u=o[t],l="vec2("+o.slice(-2).join()+")",d=o.join(),f="if ("+u+" < "+s[0]+")\n          return getChannel(getT0("+d+"), "+l+");";for(c=1;c<s.length;c++){var h=s[c-1];f+="\n        else if ("+u+" < "+s[c]+") {\n          "+u+" -= "+h+";\n          return getChannel(getT"+c+"("+d+"), "+l+");\n        }"}var p=s.length;f+="\n        else {\n          "+u+" -= "+s[s.length-1]+";\n          return getChannel(getT"+p+"("+d+"), "+l+");\n        }",this.userCode="\n      float getValue("+o.map((function(e){return"int "+e}))+") {\n        "+f+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n        if (++"+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n        if (++"+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            --"+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "},Zh=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},$h=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ep=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,a=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+i+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+o+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},tp=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,c=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+c+", "+u+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+i+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},np=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},rp=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ip=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.top,n=e.padInfo.left,r=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,o=e.dilationWidth,s=e.filterHeight,c=e.filterWidth,u=4*Math.floor(e.inChannels/4),l=e.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+i+");\n      const ivec2 pads = ivec2("+t+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+a+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+o+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+u+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===l)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+u+") *\n                getW(wR, wC, "+u+", d2);\n            } else if ("+(2===l)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+u+"),\n                getX(batch, xR, xC, "+u+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+u+", d2),\n                getW(wR, wC, "+u+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===l)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+u+"),\n                getX(batch, xR, xC, "+u+" + 1),\n                getX(batch, xR, xC, "+u+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+u+", d2),\n                getW(wR, wC, "+u+" + 1, d2),\n                getW(wR, wC, "+u+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ap=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.filterDepth,d=e.filterHeight,f=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+a+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+c+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+u+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},op=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.strideHeight,o=e.strideWidth,s=e.dilationHeight,c=e.dilationWidth,u=e.filterHeight,l=e.filterWidth,d=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+a+", "+o+");\n      const ivec2 pads = ivec2("+r+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+d+";\n        int q = d2 - d1 * "+d+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+u+"; wR++) {\n          int xR = xRCorner + wR * "+s+";\n\n          if (xR < 0 || xR >= "+t+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+l+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+n+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},sp=function(e){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=e.outShape;for(var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.strideHeight,o=e.strideWidth,s=e.dilationHeight,c=e.dilationWidth,u=e.filterHeight,l=e.filterWidth,d=l,f="int xR; int xC; int xCOffset;",h=0;h<u;h++)for(var p=0;p<l;p++)f+="\n          vec4 xTexelR"+h+"C"+2*p+" = vec4(0.);\n          vec4 wR"+h+"C"+p+" = vec4(0.);\n          vec4 xR"+h+"C"+p+" = vec4(0.);";for(h=0;h<u;h++)for(var m=0;m<d;m++){if(f+="\n          xR = xRCorner + "+h*s+";\n          xC = xCCorner + "+(p=2*m)*c+";\n        ",1===o){if(p<l&&(f+=i%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+t+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+t+" && xCOffset >= 0 && xCOffset < "+n+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+h+"C"+p+" = vec4(previous.zw, xTexelR"+h+"C"+p+".xy);\n                } else {\n                  xR"+h+"C"+p+" = vec4(0, 0, xTexelR"+h+"C"+p+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+t+" && xC >= 0 && xC < "+n+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                xR"+h+"C"+p+" = xTexelR"+h+"C"+p+";\n              ",p+1<l)){var g=i%2==0?Jc(c):c;c%2==0&&i%2==1||c%2!=0&&i%2!=1?(f+="\n                  xCOffset = xC + "+i%2+" + "+g+";\n\n                  if(xR >= 0 && xR < "+t+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",c>1&&(f+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+t+" &&\n                      xCOffset >= 0 && xCOffset < "+n+") {\n                      xTexelR"+h+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+h+"C"+p+" = vec4(0.);\n                    }\n                  "),f+="\n                  xR"+h+"C"+(p+1)+" = vec4(\n                    xTexelR"+h+"C"+p+".zw, xTexelR"+h+"C"+(p+2)+".xy);\n                "):f+="\n                  xCOffset = xC + "+g+";\n\n                  if(xR >= 0 && xR < "+t+" &&\n                    xCOffset >= 0 && xCOffset < "+n+") {\n                    xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+h+"C"+(p+1)+" = xTexelR"+h+"C"+(p+2)+";\n                "}}else p<l&&(f+="\n              if(xR >= 0 && xR < "+t+") {\n            ",i%2==1?(f+="\n                xCOffset = xC + 1 - "+o+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+n+") {\n                  xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+h+"C"+(p+2)+" = vec4(0.);\n                }\n\n                xR"+h+"C"+p+" = vec4(\n                  xTexelR"+h+"C"+p+".zw, xTexelR"+h+"C"+(p+2)+".zw);\n              ",p+1<l&&(f+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+o+";\n                  if(xCOffset >= 0 && xCOffset < "+n+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+h+"C"+(p+1)+" = vec4(xTexelR"+h+"C"+(p+2)+".xy, final.xy);\n                ")):(f+="\n                if(xC >= 0 && xC < "+n+") {\n                  xTexelR"+h+"C"+p+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+h+"C"+p+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+o+";\n                if(xCOffset >= 0 && xCOffset < "+n+") {\n                  xTexelR"+h+"C"+(p+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+h+"C"+(p+2)+" = vec4(0.);\n                }\n\n                xR"+h+"C"+p+" = vec4(\n                  xTexelR"+h+"C"+p+".xy, xTexelR"+h+"C"+(p+2)+".xy);\n              ",p+1<l&&(f+="\n                  xR"+h+"C"+(p+1)+" = vec4(\n                    xTexelR"+h+"C"+p+".zw, xTexelR"+h+"C"+(p+2)+".zw);\n                ")),f+="}");p<l&&(f+="\n            vec4 wTexelR"+h+"C"+p+" = getW("+h+", "+p+", d1, q);\n            wR"+h+"C"+p+" = vec4(wTexelR"+h+"C"+p+".xz, wTexelR"+h+"C"+p+".xz);\n          ",p+1<l&&(f+="\n              vec4 wTexelR"+h+"C"+(p+1)+" = getW("+h+", "+(p+1)+", d1, q);\n              wR"+h+"C"+(p+1)+" =\n                vec4(wTexelR"+h+"C"+(p+1)+".xz, wTexelR"+h+"C"+(p+1)+".xz);"))}for(h=0;h<u;h++)for(p=0;p<l;p++)f+="result += xR"+h+"C"+p+" * wR"+h+"C"+p+";";this.userCode="\n      const ivec2 strides = ivec2("+a+", "+o+");\n      const ivec2 pads = ivec2("+r+", "+i+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+f+"\n\n        setOutput(result);\n      }\n    "},cp=function(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],o=e[1],s=e[2],c=e[3],u=t[0],l=n[0],d=n[1];this.outputShape=[u,l,d,c];var f="bilinear"===r?1:0,h=[o-1+".0",s-1+".0"],p=h[0],m=h[1],g=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=g[0],y=g[1],b=g[2],_=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=_[0],E=_[1],S=_[2];this.userCode="\n      const float height_ratio = float("+v+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+E+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+S+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+f+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},up=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Lh(r)+" coords = getOutputCoords();\n        int end = "+lp(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+lp(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function lp(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var dp,fp,hp=function(e,t){this.variableNames=["A"];var n=wh();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Eh(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},pp=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0;var n=wh();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Eh(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},mp=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),gp=function(e){this.variableNames=["A"];var t=wh();this.outputShape=e,this.userCode="\n      "+Ch+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},vp=function(e){this.variableNames=["A"],this.usesPackedTextures=!0;var t=wh();this.outputShape=e,this.userCode="\n      "+Ch+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},yp=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=wh(),i=t[0],a=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+Sh(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex /= 4;\n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "},bp=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=wh(),i=t[0],a=t[1];this.outputShape=e;var o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var u=0;u<=1;u++){var l=2*c+u;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+u+" < "+e[2]+") {\n            localCoords[2] += "+u+";\n            if(localCoords[1] + "+c+" < "+e[1]+") {\n              localCoords[1] += "+c+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n    \n              flatIndex /= 4;\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Sh(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n        \n        "+o+"\n\n        "+r.output+" = "+s+";\n      }\n    "},_p=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},wp=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),Ep=function(e){this.variableNames=["A"];var t=wh(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Sp=function(e){this.variableNames=["A"];var t=wh(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},Cp=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var i=Lh(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],a=0;a<e.length;a++)a===t?i.push("int(getIndices("+r[a]+"))"):i.push(""+r[a]);return i.join()}(e,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},xp=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Lh(t.length),i=Lh(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Tp(e,t){return[t,e]}function Rp(e){var t=ru(e);return su(Math.ceil(t/4))}function Ip(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Np(e,t){var n=wh();return vl(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Ap(e,t){return xl(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function kp(e,t){return Tl(e,t,new Uint16Array([0,1,2,2,1,3]))}function Dp(e,t){var n,r,i,a,o,s,c,u,l=e;return 2===qc.getNumber("WEBGL_VERSION")?(n=l.R32F,r=l.R16F,i=l.RGBA16F,a=l.RGBA32F,o=l.RED,s=4,c=1,u=l.HALF_FLOAT):(n=e.RGBA,r=e.RGBA,i=e.RGBA,a=l.RGBA,o=e.RGBA,s=4,c=4,u=null!=t?t.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:c,textureTypeHalfFloat:u}}function Mp(e,t,n,r,i,a,o){Il(n,r);var s=Rl(e,t),c=e.TEXTURE_2D;return hl(e,t,(function(){return e.bindTexture(c,s)})),hl(e,t,(function(){return e.texParameteri(c,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),hl(e,t,(function(){return e.texParameteri(c,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),hl(e,t,(function(){return e.texParameteri(c,e.TEXTURE_MIN_FILTER,e.NEAREST)})),hl(e,t,(function(){return e.texParameteri(c,e.TEXTURE_MAG_FILTER,e.NEAREST)})),hl(e,t,(function(){return e.texImage2D(c,0,i,n,r,0,a,o,null)})),hl(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function Lp(e,t,n,r,i){var a=Tp(n,r);return Mp(e,t,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,e.FLOAT)}function Op(e,t,n,r,i){var a=Tp(n,r);return Mp(e,t,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function Pp(e,t,n,r,i){var a=Tp(n,r);return Mp(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function jp(e,t,n,r,i){var a=Ip(n,r);return Mp(e,t,a[0],a[1],i.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function Fp(e,t,n,r,i){var a=Ip(n,r);return Mp(e,t,a[0],a[1],i.internalFormatPackedHalfFloat,e.RGBA,i.textureTypeHalfFloat)}function Up(e,t,n,r){return hl(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Al(e,t,n,"clipSpacePos",r,3,20,0)&&Al(e,t,n,"uv",r,2,20,12)}function Bp(e,t,n,r,i,a,o){var s,c,u;hl(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),a instanceof Uint8Array?(s=new Uint8Array(r*i*4),c=e.UNSIGNED_BYTE,u=e.RGBA):(s=new Float32Array(r*i*4),c=e.FLOAT,u=o.internalFormatPackedFloat),s.set(a),hl(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,r,i,0,e.RGBA,c,s)})),hl(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Vp(e,t,n,r){hl(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?hl(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):hl(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),hl(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function zp(e,t,n,r,i){var a=e.createBuffer();hl(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var o=16*n*r;return hl(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),hl(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),hl(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function Wp(e,t,n){var r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function Gp(e,t,n,r,i){var a=Tp(n,r),o=a[0],s=a[1],c=new Uint8Array(n*r*4);return hl(e,t,(function(){return e.readPixels(0,0,o,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,c)})),new Float32Array(c.buffer)}function Hp(e,t,n,r,i,a,o,s){var c=e,u=new Float32Array(function(e,t){var n=Ip(e,t);return n[0]*n[1]*4}(a,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,u),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u}function Yp(e,t,n,r){var i=new Float32Array(n*r*4);return hl(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,i)})),i}!function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(dp||(dp={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(fp||(fp={}));var qp=Object.freeze({createVertexShader:Np,createVertexBuffer:Ap,createIndexBuffer:kp,getTextureConfig:Dp,createFloat32MatrixTexture:Lp,createFloat16MatrixTexture:Op,createUnsignedBytesMatrixTexture:Pp,createPackedMatrixTexture:jp,createFloat16PackedMatrixTexture:Fp,bindVertexProgramAttributeStreams:Up,uploadDenseMatrixToTexture:Bp,uploadPixelDataToTexture:Vp,createBufferFromOutputTexture:zp,downloadFloat32MatrixFromBuffer:Wp,downloadByteEncodedFloatMatrixFromOutputTexture:Gp,downloadPackedMatrixFromBuffer:Hp,downloadMatrixFromPackedOutputTexture:Yp}),Kp=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=qc.getNumber("WEBGL_VERSION");null!=e?(this.gl=e,dl(t,e)):this.gl=fl(t),1===qc.getNumber("WEBGL_VERSION")?(this.textureFloatExtension=gl(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),qc.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=gl(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=gl(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=Ap(this.gl,this.debug),this.indexBuffer=kp(this.gl,this.debug),this.framebuffer=Nl(this.gl,this.debug),this.textureConfig=Dp(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return qc.getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;hl(t,this.debug,(function(){return t.finish()})),hl(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),hl(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),hl(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),hl(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),hl(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Lp(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Op(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Pp(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Vp(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),Bp(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Fp(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),jp(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Pl(this.gl,this.debug,this.framebuffer),this.outputTexture=null),hl(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return Gp(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,i,a){return Hp(this.gl,e,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Wp(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=zp(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(qc.getBool("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(a,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=a}else qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return Yp(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=yl(t,this.debug,e),r=Np(t,this.debug),i=El(t,this.debug);return hl(t,this.debug,(function(){return t.attachShader(i,r)})),hl(t,this.debug,(function(){return t.attachShader(i,n)})),Sl(t,this.debug,i),this.debug&&Cl(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=Up(t,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&hl(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Cl(this.gl,this.debug,this.program),hl(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?Dl(this.gl,this.debug,e,t):Ml(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),hl(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),Ll(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=Ip(t,n),i=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,i,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&Cl(this.gl,this.debug,this.program),jl(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),hl(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),hl(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=gl(this.gl,this.debug,2===qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(2!==qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return Wc(this,void 0,void 0,(function(){var t=this;return Gc(this,(function(n){switch(n.label){case 0:return[4,uu((function(){return t.disposed||t.isQueryAvailable(e,qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||uu((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Ol(this.gl,this.debug,e,this.framebuffer),this.debug&&jl(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Ol(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&jl(this.gl)):Pl(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;Ol(r,this.debug,e,this.framebuffer),this.debug&&jl(r),this.outputTexture=e,hl(r,this.debug,(function(){return r.viewport(0,0,t,n)})),hl(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var i=this;this.throwIfDisposed(),hl(this.gl,this.debug,(function(){return i.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function Xp(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,i=t[n],a=i.shape;if(!iu(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var o=e.texShape,s=i.isUniform?null:i.texData.texShape;if(!iu(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")}}))}var Qp=function(e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;var r=n.filterWidth,i=n.inChannels,a=n.strideWidth,o=n.strideHeight,s=n.padInfo,c=n.outWidth,u=n.dilationWidth,l=n.dilationHeight,d=s.left,f=s.top,h=i*r,p=wh();this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+e[1]+" || pos >= "+e[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+c+")) * "+o+" - "+f+";\n            int d0 = offsetY + "+l+" * (pos / "+h+");\n\n            if(d0 >= "+t[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+c+".) * "+a+". - "+d+".);\n            int d1 = offsetX + "+u+" * (int(mod(float(pos), "+h+".) / "+i+".));\n\n            if(d1 >= "+t[1]+" || d1 < 0) continue;\n\n            vec2 innerDims = vec2(d1, int(mod(float(pos), "+i+".)));\n            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),\n                                              int(innerDims.y)), innerDims);\n          }\n        }\n\n        "+p.output+" = result;\n      }\n    "},Jp=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];var a,o=t,s=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+c+")":1===i?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},Zp=function(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},$p=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.usesPackedTextures=!0;var a,o=t,s=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+c+")":1===i?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},em=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,a=e.effectiveFilterWidth,o=i-1-e.padInfo.top,s=a-1-e.padInfo.left,c=i*a-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+c+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},tm=function(e,t,n,r,i,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=t;var o=n?e[1]:e[2],s=Math.ceil(o/2),c=n?"i * 2, rc.y":"rc.y, i * 2",u=r?"rc.z, i * 2":"i * 2, rc.z",l=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",h="";a&&(f="vec4 activation(vec4 x) {\n        "+a+"\n      }",h="result = activation(result);");var p=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),this.userCode="\n      "+f+"\n\n      const float sharedDimension = "+s+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+s+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+u+");\n\n          result += ("+l[0]+" * "+d[0]+") + ("+l[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+p+"\n\n        "+h+"\n\n        setOutput(result);\n      }\n    "},nm=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),rm=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},im=function(e){this.variableNames=["A"],this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=_h("rc",t),r=Lh(t),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",i=e-2;i<e;i++)r+=n[i]+" >= "+t[i],i<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var a=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),o=2;o<e;o++)a=t[t.length-1-o]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+o+"));\n          }\n        }\n      "}},am=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,i=Lh(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+a+");\n      "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},om=function(e,t,n){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,i=Lh(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=_h("rc",r),c=_h("source",r),u=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+c.slice(-2).join()+")",d=[i+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+u+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+u+") {"],f=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,m=1===r?2:4;p<m;p++)h+="\n        "+d[p]+"\n        if ("+f+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+i+" source = rc - start;\n          result["+p+"] = getChannel(getX("+c.join()+"), "+l+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+i+" start = "+i+"("+a+");\n      const "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "},sm=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideHeight,a=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var f="avg"===t,h="0.0";if(f||(h="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+a+");\n        const ivec2 pads = ivec2("+l+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+o+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+u+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+u+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var m=4*Math.floor(r/4),g=r%4,v="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+a+");\n      const ivec2 pads = ivec2("+l+", "+d+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+c+";\n            wR += "+o+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},cm=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=Math.ceil(i/n);this.outputShape=[r,a];var o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");var c=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?c="sumValue":"prod"===t?c="prodValue":"all"===t?c="allValue":"any"===t&&(c="anyValue");var u=4*Math.floor(n/4),l=n%4,d="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",f="vec4";"all"===t?(o="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===t&&(o="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+u+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+u+";\n        if ("+(1===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+c+");\n      }\n    "},um=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Eh(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Sh(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},lm=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],c=o[2],u=[n&&s>1?i-1:i,n&&c>1?a-1:a],l=[n&&s>1?s-1:s,n&&c>1?c-1:c],d=u[0]/l[0],f=u[1]/l[1],h=1/d,p=1/f,m=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},dm=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var c=[r&&t>1?a-1:a,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},fm=function(e,t,n,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var c=[r&&t>1?a-1:a,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+",\n          "+c[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+"; \n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},hm=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],c=o[2],u=[n&&s>1?i-1:i,n&&c>1?a-1:a],l=[n&&s>1?s-1:s,n&&c>1?c-1:c],d=u[0]/l[0],f=u[1]/l[1],h=1/d,p=1/f,m=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+u[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+u[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},pm=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var c=[r&&t>1?a-1:a,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},mm=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),i=Lh(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},gm=function(e,t){this.variableNames=["x"],this.usesPackedTextures=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=_h("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],o=Lh(n);function s(n){var r=e.map((function(r,i){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(i,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+i+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},vm=function(e,t,n,r,i,a,o){void 0===o&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=Lh(i.length),c=Lh(a.length),u="";1===n?u="i":2===n&&(u="i, j");var l="getIndices("+u+")",d="";1===r?d="i":2===r&&(d="i, coords[1]");var f="getUpdates("+d+")",h=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+i+");\n\n        void main() {\n          "+c+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+f+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},ym=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,o=a*Math.ceil(i/n);this.outputShape=[r,o];var s=4*Math.floor(n/4),c=n%4,u="\n        sumValue += dot(values, segFilter);\n    ",l="";i%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var d="";i%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+u+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+u+"\n        } else if ("+(2===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+u+"\n        } else if ("+(3===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+u+"\n        }\n        setOutput(sumValue);\n      }\n    "},bm=function(e,t,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],c=0;c<t.length;c++)s.push(""+a[c]),c<e&&o.push(""+a[c]);r=o.join(),i=s.join()}var u=Lh(n);this.userCode="\n      void main() {\n        "+u+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},_m=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=Lh(this.rank),r="uniform int start["+this.rank+"];",i=function(e){if(1===e)return"sourceLoc";if(e<=6)return wm.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+wm[t]+" = start["+t+"] + coords."+wm[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),wm=["x","y","z","w","u","v"],Em=function(){function e(e){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=e,this.rank=e.length;var t=Lh(this.rank),n=_h("coords",this.rank),r=_h("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+i+")",o="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+c+" \n        vec4 result = vec4(0.);\n        "+o+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Sm=function(e,t,n,r){this.variableNames=["x"];var i=n.filter((function(e,t){return-1===r.indexOf(t)}));this.outputShape=i;var a=n.length,o=Lh(n.length),s=Lh(i.length),c="";if(1===a)c="coords * strides + begin";else{var u=0;c=n.map((function(e,t){return-1===r.indexOf(t)?(u++,1===i.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(u-1)+"] * strides["+t+"] + begin["+t+"]"):"begin["+t+"]"})).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+e+");\n      "+o+" strides = "+o+"("+t+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+c+"));\n      }\n    "},Cm=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,i=xm(t,n),a=Tm(e,i,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[a].shift();return this.usedTextures[a].push(o),o}return this.numUsedTextures++,this.log(),i===fp.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===fp.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===fp.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===fp.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===fp.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var i=Tm(t,xm(n,r),r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],o=a.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(o,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function xm(e,t){if(e===dp.UPLOAD)return fp.PACKED_2X2_FLOAT32;if(e===dp.RENDER||null==e)return t?qc.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?fp.PACKED_2X2_FLOAT32:fp.PACKED_2X2_FLOAT16:qc.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?fp.UNPACKED_FLOAT32:fp.UNPACKED_FLOAT16;if(e===dp.DOWNLOAD||e===dp.PIXELS)return fp.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function Tm(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var Rm=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var i=Lh(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<e.length;i++)r.push("imod("+n[i]+", "+e[i]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},Im=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var i=Lh(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},Nm=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Lh(this.rank),a=bh("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=a[r];var s="vec2("+o.slice(-2).join()+")",c="++"+a[this.rank-1]+" < "+n[this.rank-1],u="getChannel(getA("+o.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+u+";\n      if("+c+") {\n        result[1] = "+u+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+u+";\n        if("+c+") {\n          result[3] = "+u+";\n        }\n      }  \n      setOutput(result);\n    }\n    "},Am=1.7580993408473768,km=1.0507009873554805,Dm=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Mm="if (isnan(x)) return x;",Lm=Mm+"\n  return (x < 0.0) ? 0.0 : x;\n",Om="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+Am+";\n  float scale = "+km+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",Pm="return exp(x);",jm=Mm+"\n  return sin(x);\n",Fm=Mm+"\n  return cos(x);\n",Um=Mm+"\n  return atan(x);\n",Bm=Mm+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",Vm=Mm+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",zm="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Wm=function(e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Gm=function(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e;var t=e.length,n=_h("rc",t),r=Lh(t),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),o=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "},Hm={},Ym=function(){function e(e){if(this.gpgpu=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.disposed=!1,!qc.getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var t=fl(qc.getNumber("WEBGL_VERSION"));this.binaryCache=((n=qc.getNumber("WEBGL_VERSION"))in Hm||(Hm[n]={}),Hm[n]),this.gpgpu=new Kp(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;var n;this.textureManager=new Cm(this.gpgpu),this.numMBBeforeWarning=null==qc.global.screen?1024:qc.global.screen.height*qc.global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new Wf(this,sl)}return e.prototype.register=function(e,t,n){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:n})},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=[e.height,e.width],r=[e.height,e.width,t];if(qc.getBool("IS_BROWSER")){if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e.data instanceof Uint8Array))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),e=this.fromPixels2DContext.canvas}}var i,a,o=this.makeTensorHandle(n,"int32");if(this.texData.get(o.dataId).usage=dp.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(o.dataId),e),qc.getBool("WEBGL_PACK")){i=new Sp(r);var s=this.makePackedTensor(i.outputShape,o.dtype);a=this.compileAndRun(i,[o],s)}else i=new Ep(r),a=this.compileAndRun(i,[o]);return this.disposeData(o.dataId),a},e.prototype.makeTensorHandle=function(e,t){var n={};return this.register(n,e,t),{dataId:n,shape:e,dtype:t}},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendWebGL.write(): values can not be null");if(qc.getBool("DEBUG"))for(var n=0;n<t.length;n++){var r=t[n];if(!pl(r))throw Error("The value "+r+" cannot be represented on this device.")}var i=this.texData.get(e);if("complex64"===i.dtype)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.releaseGPUData(e),i.usage=dp.UPLOAD,i.values=t},e.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,i=t.complexTensors,a=t.slice,o=t.shape;if(null!=a){var s=new Dm(o,"return x;"),c=this.compileAndRun(s,[{dataId:e,shape:o,dtype:r}]),u=this.readSync(c.dataId);return c.dispose(),u}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var l,d,f=null!=this.activeTimers;return f&&(l=performance.now()),d="complex64"===r?oh(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(e),f&&(this.downloadWaitMs+=performance.now()-l),this.convertAndCacheOnCPU(e,d)},e.prototype.read=function(e){return Wc(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w;return Gc(this,(function(E){switch(E.label){case 0:if(this.pendingRead.has(e))return n=this.pendingRead.get(e),[2,new Promise((function(e){return n.push(e)}))];if(r=this.texData.get(e),i=r.values,a=r.shape,o=r.slice,s=r.dtype,c=r.complexTensors,null!=o)return u=new Dm(a,"return x;"),l=this.compileAndRun(u,[{dataId:e,shape:a,dtype:s}]),d=this.read(l.dataId),l.dispose(),[2,d];if(null!=i)return[2,this.convertAndCacheOnCPU(e)];if(!qc.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===qc.getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return f=null,"complex64"!==s&&qc.get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(e),e=h.dataId,p=this.texData.get(h.dataId),f=(t=this.gpgpu).createBufferFromTexture.apply(t,[p.texture].concat(Rp(a)))),this.pendingRead.set(e,[]),"complex64"===s?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return"complex64"!==s?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return g=E.sent(),v=g[0],y=g[1],m=oh(v,y),[3,5];case 4:null==f?m=this.getValuesFromTexture(e):(b=ru(a),m=this.gpgpu.downloadFloat32MatrixFromBuffer(f,b),this.disposeData(e)),E.label=5;case 5:return _=this.convertAndCacheOnCPU(e,m),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach((function(e){return e(_)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)),[2,_]}}))}))},e.prototype.getValuesFromTexture=function(e){var t,n=this,r=this.texData.get(e),i=r.shape,a=r.dtype,o=r.isPacked,s=ru(i);if(qc.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(e),u=this.texData.get(c.dataId),l=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(Rp(i))).subarray(0,s);return this.disposeData(c.dataId),l}var d=qc.getBool("WEBGL_PACK")&&!0===o,f=d?Wl(i):i,h=this.makeTensorHandle(f,"float32");h.size=ru(i),this.texData.get(h.dataId).usage=dp.DOWNLOAD;var p=id((function(){var t=d?new vp(f):new gp(f);return n.compileAndRun(t,[{shape:f,dtype:a,dataId:e}],h,null)})),m=this.texData.get(p.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,s);return this.disposeData(h.dataId),g},e.prototype.time=function(e){return Wc(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return Gc(this,(function(c){switch(c.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),i=nu(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),a=nu(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),[4,Promise.all(i)];case 1:return o=c.sent(),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:Zc(o),getExtraProfileInfo:function(){return o.map((function(e,t){return{name:a[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,s]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},e.prototype.endTimer=function(e){return qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},e.prototype.getQueryTime=function(e){return Wc(this,void 0,void 0,(function(){var t;return Gc(this,(function(n){return qc.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},e.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e))if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}},e.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,i=t.texShape,a=t.usage,o=t.isPacked,s=t.slice,c=s&&s.origDataId||e,u=this.dataRefCount.get(c);u>1?this.dataRefCount.set(c,u-1):(this.dataRefCount.delete(c),null!=n&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,a,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},e.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},e.prototype.getCPUBackend=function(){return qc.getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=sl.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&e.size<t}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(e,t){var n=this.makeOutputArray(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:sl.keep(e.clone()),imag:sl.keep(t.clone())},n},e.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},e.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},e.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===ru(n))return xd([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,i=Ff(e.shape,t,n);if(r||!i){var a=qc.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Em(n):new _m(n),o=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},e.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),i=Hu.make(n,{},e.dtype,this),a=this.texData.get(i.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var o=Uf(t,e.strides);r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),i},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s,c){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r,i,a,o,s,c);var u=Of(e.shape,t,n,r,i,a,o,s,c),l=u[0],d=u[1],f=u[2],h=d.filter((function(e,t){return-1===f.indexOf(t)}));if(h.some((function(e){return 0===e})))return xd([],h);var p=new Sm(l,r,d,f);return this.compileAndRun(p,[e])},e.prototype.reverse=function(e,t){var n=qc.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new gm(e.shape,t):new mm(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.concat=function(e,t){if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>qc.getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(e.length/2),r=this.concat(e.slice(0,n),t),i=this.concat(e.slice(n),t);return this.concat([r,i],t)}if(qc.getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var a=new Jh(e.map((function(e){return e.shape})),t);return this.compileAndRun(a,e)}var o=_d(e.map((function(e){return e.shape})),t),s=e.map((function(e){return e.as2D(-1,ru(e.shape.slice(t)))})),c=new Qh(s.map((function(e){return e.shape})));return this.compileAndRun(c,s).reshape(o)},e.prototype.neg=function(e){var t=new Dm(e.shape,"return -x;");return this.compileAndRun(t,[e])},e.prototype.batchMatMul=function(e,t,n,r){var i=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===i||1===a)&&o>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var c=1===a?e:e.as3D(s,o,1),u=1===a?2:1,l=1===a?t.as3D(s,1,o):t;return this.multiply(c,l).sum(u,!0)}var d=$u(e.dtype,t.dtype),f=new tm(e.shape,[s,i,a],n,r),h=this.makePackedTensor(f.outputShape,d);return this.compileAndRun(f,[e,t],h)},e.prototype.fusedBatchMatMul=function(e,t,n,r,i,a){var o=n?e.shape[2]:e.shape[1],s=r?t.shape[1]:t.shape[2],c=e.shape[0],u=$u(e.dtype,t.dtype),l=new tm(e.shape,[c,o,s],n,r,!!i,a?function(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?zm:Lm;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}(a,!0):null),d=this.makePackedTensor(l.outputShape,u),f=[e,t];return i&&f.push(i),this.compileAndRun(l,f,d)},e.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),i=new Vh("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new Vh("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag),this.makeComplexComponentTensorHandle(t,r.complexTensors.real),this.makeComplexComponentTensorHandle(t,r.complexTensors.imag)],s=this.compileAndRun(i,o),c=this.compileAndRun(a,o),u=this.complex(s,c);return s.dispose(),c.dispose(),u}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Gh,e.dtype);var l=new Hh(Gh,e.shape,t.shape),d=this.makeOutputArray(l.outputShape,e.dtype);return this.compileAndRun(l,[e,t],d)},e.prototype.batchNormalization=function(e,t,n,r,i,a){var o=[e,t,n],s=null;null!=a&&(s=a.shape,o.push(a));var c=null;if(null!=i&&(c=i.shape,o.push(i)),qc.getBool("WEBGL_PACK_NORMALIZATION")){var u=new Bh(e.shape,t.shape,n.shape,s,c,r);return this.compileAndRun(u,o)}var l=new Uh(e.shape,t.shape,n.shape,s,c,r);return this.compileAndRun(l,o)},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){var a=qc.getBool("WEBGL_PACK_NORMALIZATION")?new $p(e.shape,t,n,r,i):new Jp(e.shape,t,n,r,i);return this.compileAndRun(a,[e])},e.prototype.LRNGrad=function(e,t,n,r,i,a,o){var s=new Zp(t.shape,r,i,a,o);return this.compileAndRun(s,[t,n,e])},e.prototype.tile=function(e,t){if("string"===e.dtype)return hh(tf(e.shape,e.dtype,this.readSync(e.dataId)),t);var n=new Rm(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.pad=function(e,t,n){var r=qc.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new om(e.shape,t,n):new am(e.shape,t,n);return this.compileAndRun(r,[e])},e.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=qc.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Nm(e.shape,t):new Im(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new Cp(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},e.prototype.batchToSpaceND=function(e,t,n){$c(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=Rf(e.shape,t,r),a=If(i.length,t.length),o=Nf(e.shape,t,r),s=Af(n,t.length),c=kf(o,n,t.length);return e.reshape(i).transpose(a).reshape(o).slice(s,c)},e.prototype.spaceToBatchND=function(e,t,n){$c(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=Rf(o.shape,t,r,!1),c=If(s.length,t.length,!1),u=Nf(o.shape,t,r,!1);return o.reshape(s).transpose(c).reshape(u)},e.prototype.reduce=function(e,t,n){var r=e.shape[0],i=e.shape[1],a=Mf(i),o=new cm({windowSize:a,inSize:i,batchSize:r},t),s=o.outputShape,c=s[0],u=s[1],l=this.makeOutputArray([c,u],n);return this.compileAndRun(o,[e],l),1===l.shape[1]?l:this.reduce(l,t,n)},e.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var a=Mf(i),o=new yh({windowSize:a,inSize:i,batchSize:r},t,null==n),s=o.outputShape,c=s[0],u=s[1],l=this.makeOutputArray([c,u],"int32"),d=[e];return null!=n&&d.push(n),this.compileAndRun(o,d,l),1===l.shape[1]?l:this.argReduce(e,t,l)},e.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,i=Mf(r[r.length-1]),a=new jh(r,i,t,null==n),o=this.makePackedTensor(a.outputShape,"int32"),s=null==n?[e]:[e,n];return this.compileAndRun(a,s,o),o.rank===e.rank?this.argReducePacked(e,t,o):o},e.prototype.sum=function(e,t){md("sum",t,e.rank);var n=hd(e.shape,t),r=n[0],i=ru(n[1]),a=e.as2D(-1,i),o=el(e.dtype);return this.reduce(a,"sum",o).reshape(r)},e.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=hd(e.shape,t),r=n[0],i=ru(n[1]),a=e.as2D(-1,i),o=el(e.dtype);return this.reduce(a,"prod",o).reshape(r)},e.prototype.unsortedSegmentSum=function(e,t,n){var r=0,i=gd([r],e.rank),a=e;null!=i&&(a=e.transpose(i),r=yd(1,e.rank)[0]);var o=function(e,t,n){for(var r=[],i=e.length,a=0;a<i;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=ru([a.shape[r]]),c=a.as2D(-1,s),u=el(e.dtype),l=this.segOpCompute(c,"unsortedSegmentSum",t,u,n).reshape(o);return null!=i&&(l=l.transpose(vd(i))),l},e.prototype.segOpCompute=function(e,t,n,r,i){var a=e.shape[0],o=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=Ru(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Ru(e,n+1);return n}(o,i),c=new ym({windowSize:s,inSize:o,batchSize:a,numSegments:i},t),u=c.outputShape,l=u[0],d=u[1],f=this.makeOutputArray([l,d],r);return this.compileAndRun(c,[e,n],f),f.shape[1]===i?f:(n=Od(0,i).tile([o/s]),this.segOpCompute(f,t,n,r,i))},e.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(md("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!qc.getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=hd(e.shape,r),a=i[0],o=ru(i[1]),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},e.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},e.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},e.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new up(e.shape,n,r);return this.compileAndRun(i,[e])},e.prototype.equal=function(e,t){if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new Hh("return float(a == b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.notEqual=function(e,t){if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Hh("return float(a != b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Hh("return float(a < b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.lessEqual=function(e,t){if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Hh("return float(a <= b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Hh("return float(a > b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greaterEqual=function(e,t){if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Hh("return float(a >= b);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalNot=function(e){var t=new Dm(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},e.prototype.logicalAnd=function(e,t){if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Hh("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalOr=function(e,t){if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Hh("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.select=function(e,t,n){var r=new bm(e.rank,t.shape,t.rank),i=this.makeOutputArray(r.outputShape,$u(t.dtype,n.dtype));return this.compileAndRun(r,[e,t,n],i)},e.prototype.where=function(e){od("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return mh(e.shape,t)},e.prototype.topk=function(e,t,n){return ph(e.dataSync(),e.shape,e.dtype,t)},e.prototype.min=function(e,t){md("min",t,e.rank);var n=hd(e.shape,t),r=n[0],i=ru(n[1]),a=e.as2D(-1,i);return this.reduce(a,"min",a.dtype).reshape(r)},e.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=qc.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yh("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Hh("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.mod=function(e,t){var n=qc.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yh("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Hh("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);md("max",t,e.rank);var n=hd(e.shape,t),r=n[0],i=ru(n[1]),a=e.as2D(-1,i);return this.reduce(a,"max",a.dtype).reshape(r)},e.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=qc.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yh("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Hh("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.all=function(e,t){md("all",t,e.rank);var n=hd(e.shape,t),r=n[0],i=ru(n[1]),a=e.as2D(-1,i);return this.reduce(a,"all",a.dtype).reshape(r)},e.prototype.any=function(e,t){md("any",t,e.rank);var n=hd(e.shape,t),r=n[0],i=ru(n[1]),a=e.as2D(-1,i);return this.reduce(a,"any",a.dtype).reshape(r)},e.prototype.squaredDifference=function(e,t){var n=qc.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yh("return (a - b) * (a - b);",e.shape,t.shape):new Hh("return (a - b) * (a - b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.realDivide=function(e,t){if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(b.x == 0.0) {\n    result.x = NAN;\n  } else if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(b.y == 0.0) {\n    result.y = NAN;\n  } else if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(b.z == 0.0) {\n    result.z = NAN;\n  } else if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(b.w == 0.0) {\n    result.w = NAN;\n  } else if(a.w == b.w) {\n    result.w = 1.;\n  }\n  \n  return result;\n","float32",!0);var n=new Hh("\nif (b == 0.0) {\n  return NAN;\n} \nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e,t],r)},e.prototype.floorDiv=function(e,t){if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Hh("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[e,t],r)},e.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,zh);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=$u(e.dtype,t.dtype);if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,zh,n);var r=new Hh(zh,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[e,t],i)},e.prototype.packedBinaryOp=function(e,t,n,r,i){void 0===i&&(i=!1);var a=new Yh(n,e.shape,t.shape,i),o=this.makePackedTensor(a.outputShape,r);return this.compileAndRun(a,[e,t],o)},e.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,i=this.texData.get(e.dataId),a=this.texData.get(t.dataId),o=[[i.complexTensors.real,a.complexTensors.real],[i.complexTensors.imag,a.complexTensors.imag]].map((function(i){var a=i[0],o=i[1],s=r.makeComplexComponentTensorHandle(e,a),c=r.makeComplexComponentTensorHandle(t,o),u=new Hh(n,e.shape,t.shape),l=r.makeOutputArray(u.outputShape,$u(a.dtype,o.dtype));return r.compileAndRun(u,[s,c],l)})),s=o[0],c=o[1],u=this.complex(s,c);return s.dispose(),c.dispose(),u},e.prototype.makeComplexComponentTensorHandle=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},e.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>qc.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var i=e.map((function(e){return e.dtype})).reduce((function(e,t){return $u(e,t)})),a=e.map((function(e){return e.shape})),o=qc.getBool("WEBGL_PACK"),s=o?new vh(e[0].shape,a):new gh(e[0].shape,a),c=o?this.makePackedTensor(s.outputShape,i):this.makeOutputArray(s.outputShape,i);return this.compileAndRun(s,e,c)},e.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Wh);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=$u(e.dtype,t.dtype);if(qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Wh,e.dtype);var r=new Hh(Wh,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,n);return this.compileAndRun(r,[e,t],i)},e.prototype.pow=function(e,t){var n=qc.getBool("WEBGL_PACK_BINARY_OPERATIONS"),r=n?new Yh("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Hh("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),i=$u(e.dtype,t.dtype),a=n?this.makePackedTensor(r.outputShape,i):this.makeOutputArray(r.outputShape,i);return this.compileAndRun(r,[e,t],a)},e.prototype.ceil=function(e){var t=new Dm(e.shape,"return ceil(x);");return this.compileAndRun(t,[e])},e.prototype.floor=function(e){var t=new Dm(e.shape,"return floor(x);");return this.compileAndRun(t,[e])},e.prototype.sign=function(e){var t=new Dm(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},e.prototype.isNaN=function(e){var t=new Dm(e.shape,"return float(isnan(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.isInf=function(e){var t=new Dm(e.shape,"return float(isinf(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.isFinite=function(e){var t=new Dm(e.shape,"return float(!isnan(x) && !isinf(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},e.prototype.round=function(e){var t=new Dm(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},e.prototype.exp=function(e){var t;return t=qc.getBool("WEBGL_PACK")?new Wm(e.shape,Pm):new Dm(e.shape,Pm),this.compileAndRun(t,[e])},e.prototype.expm1=function(e){var t=new Dm(e.shape,"return exp(x) - 1.0;");return this.compileAndRun(t,[e])},e.prototype.log=function(e){var t;return t=qc.getBool("WEBGL_PACK")?new Wm(e.shape,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n"):new Dm(e.shape,"if (x < 0.0) return NAN;\n  return log(x);"),this.compileAndRun(t,[e])},e.prototype.log1p=function(e){var t=new Dm(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},e.prototype.sqrt=function(e){var t=new Dm(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},e.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Dm(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},e.prototype.square=function(e){var t=new Dm(e.shape,"return x * x;");return this.compileAndRun(t,[e])},e.prototype.reciprocal=function(e){var t=new Dm(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},e.prototype.relu=function(e){var t;return t=qc.getBool("WEBGL_PACK")?new Wm(e.shape,zm):new Dm(e.shape,Lm),this.compileAndRun(t,[e])},e.prototype.prelu=function(e,t){var n=qc.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yh("\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",e.shape,t.shape):new Hh("return (a < 0.) ? b * a : a;",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.elu=function(e){var t=new Dm(e.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(t,[e])},e.prototype.eluDer=function(e,t){var n=qc.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yh("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Hh("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.selu=function(e){var t=new Dm(e.shape,Om);return this.compileAndRun(t,[e])},e.prototype.int=function(e){var t=new Dm(e.shape,"return float(int(x));"),n=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],n)},e.prototype.clip=function(e,t,n){var r,i=(r=qc.getBool("WEBGL_PACK_CLIP")?new Kh(e.shape):new qh(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,i)},e.prototype.abs=function(e){var t=new Dm(e.shape,"return abs(x);");return this.compileAndRun(t,[e])},e.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new Xh(e.shape),r=[this.makeComplexComponentTensorHandle(e,t.complexTensors.real),this.makeComplexComponentTensorHandle(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},e.prototype.sigmoid=function(e){var t=new Dm(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},e.prototype.softplus=function(e){var t=new Dm(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},e.prototype.sin=function(e){var t=new Dm(e.shape,jm);return this.compileAndRun(t,[e])},e.prototype.cos=function(e){var t=new Dm(e.shape,Fm);return this.compileAndRun(t,[e])},e.prototype.tan=function(e){var t=new Dm(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},e.prototype.asin=function(e){var t=new Dm(e.shape,"return asin(x);");return this.compileAndRun(t,[e])},e.prototype.acos=function(e){var t=new Dm(e.shape,"return acos(x);");return this.compileAndRun(t,[e])},e.prototype.atan=function(e){var t=new Dm(e.shape,Um);return this.compileAndRun(t,[e])},e.prototype.atan2=function(e,t){var n=qc.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yh("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Hh("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.sinh=function(e){var t=new Dm(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},e.prototype.cosh=function(e){var t=new Dm(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},e.prototype.tanh=function(e){var t=new Dm(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},e.prototype.asinh=function(e){var t=new Dm(e.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},e.prototype.acosh=function(e){var t=new Dm(e.shape,Bm);return this.compileAndRun(t,[e])},e.prototype.atanh=function(e){var t=new Dm(e.shape,Vm);return this.compileAndRun(t,[e])},e.prototype.erf=function(e){var t=new Dm(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n');return this.compileAndRun(t,[e])},e.prototype.step=function(e,t){var n=new Dm(e.shape,function(e){return void 0===e&&(e=0),Mm+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},e.prototype.conv2dByMatMul=function(e,t,n){var r=e.shape,i=this.texData.get(e.dataId),a=n.inChannels,o=r[0]*r[1]*r[2],s=n.outChannels,c=(1===o||1===s)&&a>1e3,u=r[2]%2!=0&&!!i.isPacked;if(c||!qc.getBool("WEBGL_LAZILY_UNPACK")||!qc.getBool("WEBGL_PACK_BINARY_OPERATIONS")||!u){var l=this.reshape(e,[1,r[0]*r[1]*r[2],n.inChannels]),d=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.batchMatMul(l,d,!1,!1),n.outShape)}var f=Hu.make([1,r[0]*r[1]*(r[2]+1),n.inChannels],{dataId:e.dataId},e.dtype,this),h=i.shape;i.shape=i.shape.slice(),i.shape[i.shape.length-2]++,$c(Yl(i.shape,f.shape),(function(){return"packed reshape "+i.shape+" to "+f.shape+" isn't free"}));var p=this.reshape(t,[1,n.inChannels,n.outChannels]),m=this.batchMatMul(f,p,!1,!1),g=this.texData.get(m.dataId);return $c(g.isPacked,(function(){return"batchMatMul result is expected to be packed"})),i.shape=h,g.shape=n.outShape,Hu.make(n.outShape,{dataId:m.dataId},m.dtype,this)},e.prototype.conv2dWithIm2Row=function(e,t,n){var r=n.filterWidth,i=n.filterHeight,a=n.inChannels,o=n.outWidth,s=n.outHeight,c=r*i*a,u=s*o,l=[c,u],d=e.squeeze([0]),f=t.reshape([1,c,-1]),h=new Qp(l,d.shape,n),p=this.compileAndRun(h,[d]).reshape([1,l[0],l[1]]),m=new tm(p.shape,[1,u,n.outChannels],!0,!1);return this.compileAndRun(m,[p,f]).reshape([1,s,o,n.outChannels])},e.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(qc.getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new ip(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerInput=function(e,t,n){var r=new $h(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerFilter=function(e,t,n){var r=new Zh(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2D=function(e,t,n){var r;return qc.getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new sp(n),this.compileAndRun(r,[e,t],this.makePackedTensor(n.outShape,e.dtype))):(r=new op(n),this.compileAndRun(r,[e,t]))},e.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new rp(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new np(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3d=function(e,t,n){var r=new ap(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3dDerInput=function(e,t,n){var r=new tp(n);return this.compileAndRun(r,[e,t])},e.prototype.conv3dDerFilter=function(e,t,n){var r=new ep(n);return this.compileAndRun(r,[e,t])},e.prototype.maxPool=function(e,t){var n=new sm(t,"max",!1),r=this.makeOutputArray(n.outputShape,e.dtype);return this.compileAndRun(n,[e],r)},e.prototype.avgPool=function(e,t){var n=new sm(t,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e],r)},e.prototype.maxPoolBackprop=function(e,t,n,r){var i=new sm(r,"max",!0),a=this.compileAndRun(i,[t]),o=new em(r),s=this.makeOutputArray(o.outputShape,t.dtype),c=this.compileAndRun(o,[e,a],s);return a.dispose(),c},e.prototype.avgPoolBackprop=function(e,t,n){var r=new Fh(n),i=this.makeOutputArray(r.outputShape,t.dtype);return this.compileAndRun(r,[e],i)},e.prototype.cast=function(e,t){return rh(e,t,this)},e.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var c=new Array(n);for(a=0;a<c.length;a++)o[t]=a,c[a]=this.slice(e,o,s).reshape(r);return c},e.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);return!n.isPacked||Yl(e.shape,t)||null!==n.texture&&Yl(n.shape,t)?ih(e,t):this.packedReshape(e,t)},e.prototype.resizeBilinear=function(e,t,n,r){var i=qc.getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new fm(e.shape,t,n,r):new dm(e.shape,t,n,r);return this.compileAndRun(i,[e])},e.prototype.resizeBilinearBackprop=function(e,t,n){var r=new lm(e,t,n);return this.compileAndRun(r,[e])},e.prototype.resizeNearestNeighbor=function(e,t,n,r){var i=new pm(e.shape,t,n,r);return this.compileAndRun(i,[e])},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new hm(e,t,n);return this.compileAndRun(r,[e])},e.prototype.multinomial=function(e,t,n,r){var i=t?e:Vf(e),a=i.shape[0],o=i.shape[1],s=new nm(a,o,n),c=this.makeOutputArray(s.outputShape,"int32"),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],c,u)},e.prototype.oneHot=function(e,t,n,r){var i=new rm(e.size,t,n,r);return this.compileAndRun(i,[e])},e.prototype.nonMaxSuppression=function(e,t,n,r,i){return od("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),lh(e.dataSync(),t.dataSync(),n,r,i)},e.prototype.cropAndResize=function(e,t,n,r,i,a){var o=new cp(e.shape,t.shape,r,i,a);return this.compileAndRun(o,[e,t,n])},e.prototype.depthToSpace=function(e,t,n){$c(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],i="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],o="NHWC"===n?e.shape[3]:e.shape[1],s=i*t,c=a*t,u=o/(t*t),l=new mp("NHWC"===n?[r,s,c,u]:[r,u,s,c],t,n);return this.compileAndRun(l,[e])},e.prototype.split=function(e,t,n){return fh(e,t,n)},e.prototype.scatterND=function(e,t,n){var r=Lf(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,c=r.outputSize,u=[c/o,o],l=e.reshape([a,i]),d=t.reshape([a,o]);if(0===c)return ih(xd([]),n);var f=Rd(0),h=new vm(a,i,l.rank,d.rank,s,u);return this.compileAndRun(h,[d,l,f]).reshape(n)},e.prototype.sparseToDense=function(e,t,n,r){var i=Lf(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.strides,c=i.outputSize,u=new vm(o,a,e.rank,t.rank,s,[c,1],!1);return this.compileAndRun(u,[t,e,r]).reshape(n)},e.prototype.fft=function(e){return this.fftImpl(e,!1)},e.prototype.ifft=function(e){return this.fftImpl(e,!0)},e.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new _p("return real * expR - imag * expI;",e.shape,t),i=new _p("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag)],o=this.compileAndRun(r,a),s=this.compileAndRun(i,a),c=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),c},e.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=Df(e,t),a=i[0],o=i[1],s=i[2],c=i[3],u=t.reshape([o,r]),l=e.reshape([e.size/s,s]),d=new xp(r,c,[o,s]);return this.compileAndRun(d,[l,u]).reshape(a)},e.prototype.fill=function(e,t,n){if("string"===(n=n||xu(t))){var r=pu(n,ru(e));return r.fill(t),Hu.make(e,{values:r},n)}var i=new wp(e,t),a=i.getCustomSetupFunc(t),o=this.makeOutputArray(e,n);return this.compileAndRun(i,[],o,a)},e.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},e.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},e.prototype.linspace=function(e,t,n){return ah(e,t,n)},e.prototype.makeOutputArray=function(e,t){return Hu.make(e,{},t,this)},e.prototype.makePackedTensor=function(e,t){var n=Hu.make(e,{},t,this);return this.texData.get(n.dataId).isPacked=!0,n},e.prototype.unpackTensor=function(e){var t=new Gm(e.shape);return this.compileAndRun(t,[e],Hu.make(t.outputShape,{},e.dtype,this))},e.prototype.packTensor=function(e){var t=new im(e.shape);return this.compileAndRun(t,[e],this.makePackedTensor(e.shape,e.dtype),null,!0)},e.prototype.packedReshape=function(e,t){var n=e.reshape([Vl(e.shape)].concat(zl(e.shape))),r=[Vl(t)].concat(zl(t)),i=new um(r,n.shape);return this.compileAndRun(i,[n]).reshape(t)},e.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,i=n.shape,a=n.dtype,o=Wl(i),s=Rp(i),c=this.makeTensorHandle(i,"float32");return this.texData.get(c.dataId).isPacked=!0,this.texData.get(c.dataId).dtype=a,this.texData.get(c.dataId).texShape=s.map((function(e){return 2*e})),t=r?new pp(o,s):new hp(o,s),this.compileAndRun(t,[{shape:o,dtype:a,dataId:e}],c,null,!0),c},e.prototype.compileAndRun=function(e,t,n,r,i){var a=this;if(void 0===i&&(i=!1),null==n&&(n=e.usesPackedTextures?this.makePackedTensor(e.outputShape,t[0].dtype):this.makeOutputArray(e.outputShape,t[0].dtype)),0===n.size)return this.texData.get(n.dataId).values=hu(n.dtype,0),n;var o=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.usesPackedTextures&&ru(t.shape)<=qc.getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.usesPackedTextures&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.usesPackedTextures)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!Yl(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),n=a.texData.get(t.dataId),r.shape=i}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(n.dataId);var s,c={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},u=function(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t}));var i=e.userCode;return e.constructor.name+"_"+r+"_"+i}(e,o,c),l=this.getAndSaveBinary(u,(function(){return function(e,t,n,r){var i=t.userCode,a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=a.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},c=xh(a,s,i,t.usesPackedTextures),u=e.createProgram(c),l=null,d=e.getUniformLocation(u,"NAN",!1);1===qc.getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(u,"INFINITY",!1));for(var f={},h=0;h<t.variableNames.length;h++){var p=t.variableNames[h];f[p]=e.getUniformLocation(u,p,!1),f["offset"+p]=e.getUniformLocation(u,"offset"+p,!1)}return{program:t,source:c,webGLProgram:u,uniformLocations:f,inShapeInfos:o,outShapeInfo:s,infLoc:l,nanLoc:d}}(a.gpgpu,e,o,c)})),d=null!=this.activeTimers;return d&&(s=this.startTimer()),function(e,t,n,r,i){Xp(t.inShapeInfos,n),Xp([t.outShapeInfo],[r]);var a=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,o[0],o[1]):e.setOutputMatrixTexture(a,o[0],o[1]),e.setProgram(t.webGLProgram),1===qc.getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var i=t.program.variableNames[r],a=t.uniformLocations[i],o=t.uniformLocations["offset"+i];if(null!=a)if(n.isUniform)if(ru(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,l,o,c,r),d&&(s=this.endTimer(s),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(s)})),!qc.getBool("WEBGL_LAZILY_UNPACK")&&this.texData.get(n.dataId).isPacked&&!1===i?this.unpackTensor(n):n},e.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),null!=this.canvas&&null!=this.canvas.remove?this.canvas.remove():this.canvas=null,null!=this.fromPixels2DContext&&null!=this.fromPixels2DContext.canvas.remove&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=id((function(){var t=qc.getBool("DEBUG");qc.set("DEBUG",!1);var n=e.abs(Rd(1e-8)).dataSync()[0];return qc.set("DEBUG",t),n>0?32:16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.values,o=n.texture,s=n.usage,c=n.isPacked;if(null==o){var u,l=null!=this.activeTimers;l&&(u=performance.now());var d=n.texShape;if(null==d&&(d=Gl(r,c),n.texShape=d),null!=a){var f=Wl(r),h=void 0,p=d[1],m=d[0],g=a instanceof Uint8Array;c?(p=(t=Ip(d[0],d[1]))[0],m=t[1],h=new bp(f,[m,p],g)):h=new yp(f,[m,p],g);var v=this.makeTensorHandle([m,p],i);this.texData.get(v.dataId).usage=g?dp.PIXELS:dp.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),p,m,a);var y=this.makeTensorHandle(h.outputShape,v.dtype);y.size=ru(h.outputShape),this.texData.get(y.dataId).isPacked=c,this.compileAndRun(h,[v],y);var b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(v.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=performance.now()-u)}else{var _=this.acquireTexture(d,s,i,c);n.texture=_}}},e.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},e.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},e.prototype.computeBytes=function(e,t){return e[0]*e[1]*_u(t)},e}();cl()&&sl.registerBackend("webgl",(function(){return new Ym}),2);var qm=wd({abs_:function(e){var t=ud(e,"x","abs");return"complex64"===t.dtype?sl.runKernel((function(e){return e.complexAbs(t)}),{$x:t}):sl.runKernel((function(e,n){var r=e.abs(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.toFloat().step(-1))}}}))}}),Km=wd({acos_:function(e){var t=ud(e,"x","acos");return sl.runKernel((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Rd(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),Xm=wd({acosh_:function(e){var t=ud(e,"x","acosh");return sl.runKernel((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),Qm=wd({asin_:function(e){var t=ud(e,"x","asin");return sl.runKernel((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Rd(1).sub(n.toFloat().square()).sqrt())}}}))}}),Jm=wd({asinh_:function(e){var t=ud(e,"x","asinh");return sl.runKernel((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(Rd(1).add(n.toFloat().square()).sqrt())}}}))}}),Zm=wd({atan_:function(e){var t=ud(e,"x","atan");return sl.runKernel((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),$m=wd({atanh_:function(e){var t=ud(e,"x","atanh");return sl.runKernel((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(Rd(1).sub(n.toFloat().square()))}}}))}}),eg=wd({ceil_:function(e){var t=ud(e,"x","ceil");return sl.runKernel((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return jd(e)}}}))}}),tg=wd({clipByValue_:function(e,t,n){var r=ud(e,"x","clipByValue");return $c(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."})),sl.runKernel((function(e,i){var a=e.clip(r,t,n);return i([r]),a}),{$x:r},(function(e,r){var i=r[0];return{$x:function(){return e.where(i.greaterEqual(t).logicalAnd(i.lessEqual(n)),jd(e))}}}))}}),ng=wd({cos_:function(e){var t=ud(e,"x","cos");return sl.runKernel((function(e,n){var r=e.cos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sin().neg().mul(e)}}}))}}),rg=wd({cosh_:function(e){var t=ud(e,"x","cosh");return sl.runKernel((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),ig=wd({erf_:function(e){var t=ud(e,"x","erf");return $c("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),sl.runKernel((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),ag=wd({exp_:function(e){var t=ud(e,"x","exp");return sl.runKernel((function(e,n){var r=e.exp(t);return n([r]),r}),{$x:t},(function(e,t){return{$x:function(){return e.mulStrict(t[0])}}}))}}),og=wd({expm1_:function(e){var t=ud(e,"x","expm1");return sl.runKernel((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),sg=wd({floor_:function(e){var t=ud(e,"x","floor");return sl.runKernel((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return jd(e)}}}))}}),cg=wd({log_:function(e){var t=ud(e,"x","log");return sl.runKernel((function(e,n){var r=e.log(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat())}}}))}}),ug=wd({log1p_:function(e){var t=ud(e,"x","log1p");return sl.runKernel((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),lg=wd({logSigmoid_:function(e){var t=ud(e,"x","logSigmoid");return sl.runKernel((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),dg=wd({neg_:function(e){var t=ud(e,"x","neg");return sl.runKernel((function(e){return e.neg(t)}),{$x:t},(function(e){return{$x:function(){return e.neg()}}}))}}),fg=wd({reciprocal_:function(e){var t=ud(e,"x","reciprocal");return sl.runKernel((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),hg=wd({round_:function(e){var t=ud(e,"x","round");return sl.runKernel((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return jd(e)}}}))}}),pg=wd({rsqrt_:function(e){var t=ud(e,"x","rsqrt");return sl.runKernel((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}))}}),mg=wd({sigmoid_:function(e){var t=ud(e,"x","sigmoid");return sl.runKernel((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.mul(Rd(1).sub(n)))}}}))}}),gg=wd({sign_:function(e){var t=ud(e,"x","sign");return sl.runKernel((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return jd(e)}}}))}}),vg=wd({isNaN_:function(e){var t=ud(e,"x","isNaN");return sl.runKernel((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return jd(e)}}}))}}),yg=wd({isInf_:function(e){var t=ud(e,"x","isInf");return sl.runKernel((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return jd(e)}}}))}}),bg=wd({isFinite_:function(e){var t=ud(e,"x","isFinite");return sl.runKernel((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return jd(e)}}}))}}),_g=wd({sin_:function(e){var t=ud(e,"x","sin");return sl.runKernel((function(e,n){var r=e.sin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cos().mul(e)}}}))}}),wg=wd({sinh_:function(e){var t=ud(e,"x","sinh");return sl.runKernel((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),Eg=wd({softplus_:function(e){var t=ud(e,"x","softplus");return sl.runKernel((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),Sg=wd({sqrt_:function(e){var t=ud(e,"x","sqrt");return sl.runKernel((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),Cg=wd({square_:function(e){var t=ud(e,"x","square");return sl.runKernel((function(e,n){return n([t]),e.square(t)}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.toFloat().mul(2))}}}))}}),xg=wd({step_:function(e,t){void 0===t&&(t=0);var n=ud(e,"x","step");return sl.runKernel((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return jd(e)}}}))}}),Tg=wd({tan_:function(e){var t=ud(e,"x","tan");return sl.runKernel((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),Rg=wd({tanh_:function(e){var t=ud(e,"x","tanh");return sl.runKernel((function(e,n){var r=e.tanh(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return Rd(1).sub(n.square()).mulStrict(e)}}}))}});function Ig(e,t,n,r,i,a){var o,s,c=ud(e,"x","batchNorm"),u=ud(t,"mean","batchNorm"),l=ud(n,"variance","batchNorm");return null!=i&&(o=ud(i,"scale","batchNorm")),null!=r&&(s=ud(r,"offset","batchNorm")),$c(2===c.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."})),$c(2===u.rank||1===u.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+u.rank+"."})),$c(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=o&&$c(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."})),null!=s&&$c(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),kg(c,u,l,s,o,a)}function Ng(e,t,n,r,i,a){var o,s,c=ud(e,"x","batchNorm"),u=ud(t,"mean","batchNorm"),l=ud(n,"variance","batchNorm");return null!=i&&(o=ud(i,"scale","batchNorm")),null!=r&&(s=ud(r,"offset","batchNorm")),$c(3===c.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."})),$c(3===u.rank||1===u.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+u.rank+"."})),$c(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=o&&$c(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."})),null!=s&&$c(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),kg(c,u,l,s,o,a)}function Ag(e,t,n,r,i,a){var o,s,c=ud(e,"x","batchNorm"),u=ud(t,"mean","batchNorm"),l=ud(n,"variance","batchNorm");return null!=i&&(o=ud(i,"scale","batchNorm")),null!=r&&(s=ud(r,"offset","batchNorm")),$c(4===c.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."})),$c(4===u.rank||1===u.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+u.rank+"."})),$c(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=o&&$c(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."})),null!=s&&$c(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),kg(c,u,l,s,o,a)}function kg(e,t,n,r,i,a){null==a&&(a=.001);var o,s,c,u=ud(e,"x","batchNorm"),l=ud(t,"mean","batchNorm"),d=ud(n,"variance","batchNorm");return null!=i&&(o=ud(i,"scale","batchNorm")),null!=r&&(s=ud(r,"offset","batchNorm")),$c(l.rank===d.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),$c(null==s||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),$c(null==o||l.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),c=0===u.rank||1===u.rank?u.as4D(1,1,1,u.size):2===u.rank?u.as4D(1,1,u.shape[0],u.shape[1]):3===u.rank?u.as4D(1,u.shape[0],u.shape[1],u.shape[2]):u,sl.runKernel((function(e,t){var n=e.batchNormalization(c,Dg(l),Dg(d),a,Dg(o),Dg(s));return t([u,l,d,o]),n}),{$x:u,$mean:l,$variance:d,$scale:o,$offset:s},(function(e,t){var n=t,r=n[0],i=n[1],o=n[2],s=n[3],u=null==s?Rd(1):s,l=Hf(i.shape,c.shape),d=[];if(1===i.rank){for(var f=0;f<c.shape.length-1;++f)d.push(c.shape[f]);d.push(1)}var h=r.sub(i),p=e.mul(u),m=pg(o.add(Rd(a))),g=m.mul(m).mul(m).mul(Rd(-.5));return{$x:function(){return 1===i.rank?e.mul(Cf(m.as4D(1,1,1,i.shape[0]),d)).mul(u).reshape(r.shape):e.mul(m).mul(u).reshape(r.shape)},$mean:function(){var e=m.mul(Rd(-1)).mul(p);return 1===i.rank&&(e=e.sum(l)),e.reshape(i.shape)},$variance:function(){var e=g.mul(h).mul(p);return 1===i.rank&&(e=e.sum(l)),e.reshape(i.shape)},$scale:function(){var t=h.mul(m),n=e.mul(t);return 1===i.rank&&(n=n.sum(l)),n.reshape(i.shape)},$offset:function(){var t=e;return 1===i.rank&&(t=t.sum(l)),t.reshape(i.shape)}}})).reshape(u.shape)}function Dg(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function Mg(){rd("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Lg=wd({batchNormalization2d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Mg(),Ig(e,t,n,a,i,r)}}),Og=wd({batchNormalization3d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Mg(),Ng(e,t,n,a,i,r)}}),Pg=wd({batchNormalization4d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Mg(),Ag(e,t,n,a,i,r)}}),jg=wd({batchNormalization_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),Mg(),kg(e,t,n,a,i,r)}}),Fg=wd({batchNorm_:kg}),Ug=wd({batchNorm2d_:Ig}),Bg=wd({batchNorm3d_:Ng}),Vg=wd({batchNorm4d_:Ag});function zg(e,t,n,r,i,a){$c(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var o=e,s=t,c=!1;3===t.rank&&(c=!0,s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),o=[1,e[0],e[1],e[2]]);var u=o[3],l=s.shape[3];$c(4===o.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+o.length+"."})),$c(4===s.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank})),$c(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank})),$c(u===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[2]+"."})),$c(l===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[3]+"."})),null!=a&&$c(au(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var d=Kf(o,n.shape,r,1,i,a),f=sl.runKernel((function(e,t){var r=e.conv2dDerInput(s,n,d);return t([n,s]),r}),{dy4D:s,filter:n},(function(e,t){var n=t[0],o=t[1];return{dy4D:function(){return Yg(e,n,r,i,"NHWC",1,a)},filter:function(){return Kg(e,o,n.shape,r,i,a)}}}));return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function Wg(e,t,n,r,i,a){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=t;3===s.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),$c(4===o.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+o.shape+"."})),$c(4===s.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."})),$c(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."})),$c(o.shape[3]===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+o.shape[3]+") must match input depth in filter ("+n[2]+"."})),$c(s.shape[3]===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+n[3]+")."})),null!=a&&$c(au(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var c=Kf(o.shape,n,r,1,i,a);return sl.runKernel((function(e){return e.conv2dDerFilter(o,s,c)}),{x4D:o,dy4D:s})}function Gg(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}var Hg=wd({conv1d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NWC"),void 0===a&&(a=1);var s=ud(e,"x","conv1d"),c=ud(t,"filter","conv1d"),u=s,l=!1;2===s.rank&&(l=!0,u=s.as3D(1,s.shape[0],s.shape[1])),$c(3===u.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."})),$c(3===c.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."})),null!=o&&$c(au(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."})),$c(u.shape[2]===c.shape[1],(function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+c.shape[1]+"."})),$c(nh(n,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"})),$c("NWC"===i,(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var d=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),f=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),h=Yg(f,d,[1,n],r,"NHWC",[1,a],o);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Yg=wd({conv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=ud(e,"x","conv2d"),c=ud(t,"filter","conv2d"),u=s,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),$c(4===u.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."})),$c(4===c.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."})),null!=o&&$c(au(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."})),$c(u.shape[3]===c.shape[2],(function(){return"Error in conv2d: depth of input ("+u.shape[3]+") must match input depth for filter "+c.shape[2]+"."})),$c(nh(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),$c("NHWC"===i,(function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."}));var d=Kf(u.shape,c.shape,n,a,r,o),f=sl.runKernel((function(e,t){var n=e.conv2d(u,c,d);return t([c,u]),n}),{x:u,$filter:c},(function(e,t){var i=t,o=i[0],s=i[1];return $c(th(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return zg(s.shape,e,o,n,r)},$filter:function(){return Wg(s,e,o.shape,n,r)}}}));return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),qg=wd({conv3d_:function(e,t,n,r,i,a){void 0===i&&(i="NDHWC"),void 0===a&&(a=[1,1,1]);var o=ud(e,"x","conv3d"),s=ud(t,"filter","conv3d"),c=o,u=!1;4===o.rank&&(u=!0,c=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),$c(5===c.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."})),$c(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),$c(c.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),$c(function(e,t){return Gg(e)||Gg(t)}(n,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),$c("NDHWC"===i,(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var l=Xf(c.shape,s.shape,n,a,r),d=sl.runKernel((function(e,t){var n=e.conv3d(c,s,l);return t([c,s]),n}),{x:c,$filter:s},(function(e,t){$c(Gg(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var i=t[0],o=t[1];return{x:function(){return function(e,t,n,r,i){$c(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var a=e,o=t,s=!1;4===t.rank&&(s=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var c=a[4],u=o.shape[4];$c(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),$c(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),$c(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),$c(c===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[3]+"."})),$c(u===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+n.shape[4]+"."}));var l=Xf(a,n.shape,r,1,i),d=sl.runKernel((function(e){return e.conv3dDerInput(o,n,l)}),{dy5D:o});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}(i.shape,e,o,n,r)},$filter:function(){return function(e,t,n,r,i){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var o=t;4===o.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),$c(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),$c(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),$c(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),$c(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),$c(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=Xf(a.shape,n,r,1,i);return sl.runKernel((function(e){return e.conv3dDerFilter(a,o,s)}),{x5D:a,dy5D:o})}(i,e,o.shape,n,r)}}}));return u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Kg=wd({conv2dDerFilter_:Wg}),Xg=wd({depthwiseConv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=ud(e,"x","depthwiseConv2d"),c=ud(t,"filter","depthwiseConv2d"),u=s,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),$c(4===u.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+u.rank+"."})),$c(4===c.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."})),$c(u.shape[3]===c.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+u.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."})),null==a&&(a=[1,1]),$c(nh(n,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=o&&$c(au(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var d=Kf(u.shape,c.shape,n,a,r,o,!0),f=sl.runKernel((function(e,t){var n=e.depthwiseConv2D(u,c,d);return t([u,c]),n}),{x:u,$filter:c},(function(e,t){$c(th(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var n=t[0],r=t[1];return{x:function(){return function(e,t,n,r){var i=t,a=!1;3===t.rank&&(a=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=sl.runKernel((function(e){return e.depthwiseConv2DDerInput(i,n,r)}),{dy4D:i});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}(n.shape,e,r,d)},$filter:function(){return function(e,t,n,r){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),sl.runKernel((function(e){return e.depthwiseConv2DDerFilter(i,a,r)}),{x4D:i,dy4D:a})}(n,e,r.shape,d)}}}));return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),Qg=wd({separableConv2d_:function(e,t,n,r,i,a,o){void 0===a&&(a=[1,1]),void 0===o&&(o="NHWC");var s=ud(e,"x","separableConv2d"),c=ud(t,"depthwiseFilter","separableConv2d"),u=ud(n,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(3===s.rank&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");$c(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),$c(4===c.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."})),$c(4===u.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."})),$c(1===u.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."})),$c(1===u.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."}));var f=c.shape[2],h=c.shape[3];$c(u.shape[2]===f*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+u.shape[2]+"."}));var p=Xg(l,c,r,i,o,a),m=Yg(p,u,1,"valid",o);return d?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Jg=wd({conv2dTranspose_:function(e,t,n,r,i,a){return zg(n,ud(e,"x","conv2dTranspose"),ud(t,"filter","conv2dTranspose"),r,i,a)}}),Zg=wd({matMul_:function(e,t,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=ud(e,"a","matMul"),o=ud(t,"b","matMul");i=tl(a,o),a=i[0],o=i[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],c=r?o.shape[o.rank-1]:o.shape[o.rank-2],u=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=r?o.shape[o.rank-2]:o.shape[o.rank-1],d=a.shape.slice(0,-2),f=o.shape.slice(0,-2),h=ru(d),p=ru(f);$c(a.rank>=2&&o.rank>=2&&a.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."})),$c(iu(d,f),(function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."})),$c(s===c,(function(){return"Error in matMul: inner shapes ("+s+") and ("+c+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var m=a.shape.slice(0,-2).concat([u,l]),g=n?a.as3D(h,s,u):a.as3D(h,u,s),v=r?o.as3D(p,l,c):o.as3D(p,c,l);return sl.runKernel((function(e,t){var i=e.batchMatMul(g,v,n,r);return t([g,v]),i}),{$a:g,$b:v},(function(e,t){var i=t,a=i[0],o=i[1];return n||r?!n&&r?{$a:function(){return e.matMul(o,!1,!1)},$b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{$a:function(){return o.matMul(e,!1,!0)},$b:function(){return a.matMul(e,!1,!1)}}:{$a:function(){return o.matMul(e,!0,!0)},$b:function(){return e.matMul(a,!0,!0)}}:{$a:function(){return e.matMul(o,!1,!0)},$b:function(){return a.matMul(e,!0,!1)}}})).reshape(m)}}),$g=wd({dot_:function(e,t){var n=ud(e,"t1","dot"),r=ud(t,"t2","dot");$c(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var i=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return $c(i===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),ev=wd({outerProduct_:function(e,t){var n=ud(e,"v1","outerProduct"),r=ud(t,"v2","outerProduct");return $c(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),tv=wd({reverse_:function(e,t){var n=ud(e,"x","reverse");if(0===n.rank)return n.clone();var r=du(t,n.shape);return sl.runKernel((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),nv=wd({reverse1d_:function(e){var t=ud(e,"x","reverse");return $c(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),tv(t,0)}}),rv=wd({reverse2d_:function(e,t){var n=ud(e,"x","reverse");return $c(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),tv(n,t)}}),iv=wd({reverse3d_:function(e,t){var n=ud(e,"x","reverse");return $c(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),tv(n,t)}}),av=wd({reverse4d_:function(e,t){var n=ud(e,"x","reverse");return $c(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),tv(n,t)}});function ov(e,t,n,r,i,a){var o=ud(e,"x","maxPool"),s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),null==r&&(r=[1,1]),$c(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),$c(nh(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=a&&$c(au(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var u=qf(s.shape,t,n,r,i,a),l=sl.runKernel((function(e,t){var n=e.maxPool(s,u);return t([s,n]),n}),{x:s},(function(e,a){var o=a[0],s=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var c=ud(e,"dy","maxPoolBackprop"),u=ud(t,"input","maxPoolBackprop"),l=ud(n,"output","maxPoolBackprop");$c(u.rank===c.rank,(function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+c.rank+")"})),null==a&&(a=[1,1]),$c(nh(i,a),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),$c(4===c.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),$c(4===u.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var d=qf(u.shape,r,i,a,o,s);return sl.runKernel((function(e){return e.maxPoolBackprop(c,u,l,d)}),{$dy:c,$input:u})}(e,o,s,t,n,r,i)}}}));return c?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function sv(e,t,n,r,i,a){var o=ud(e,"x","avgPool","float32");null==r&&(r=[1,1]),$c(nh(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),$c(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=a&&$c(au(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var u=qf(s.shape,t,n,r,i,a),l=sl.runKernel((function(e){return e.avgPool(s,u)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,i,a){var o=ud(e,"dy","avgPoolBackprop"),s=ud(t,"input","avgPoolBackprop");$c(s.rank===o.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+o.rank+")"})),null==i&&(i=[1,1]),$c(nh(r,i),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}));var c=s,u=o,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),$c(4===u.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),$c(4===c.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var d=qf(c.shape,n,r,i,a),f=sl.runKernel((function(e){return e.avgPoolBackprop(u,c,d)}),{dy4D:u,input4D:c});return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}(e,s,t,n,r,i)}}}));return l=l.cast(o.dtype),c?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var cv=wd({maxPool_:function(e,t,n,r,i){return ov(e,t,n,1,r,i)}}),uv=wd({avgPool_:function(e,t,n,r,i){return sv(e,t,n,1,r,i)}}),lv=wd({pool_:function(e,t,n,r,i,a){null==i&&(i=[1,1]),null==a&&(a=1),0===r&&(r="valid");var o=ud(e,"x","maxPool"),s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),$c(nh(a,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}));var u,l=qf(s.shape,t,a,i,r),d=[l.dilationHeight,l.dilationWidth];u="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),i=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],i[t]]}))}([l.filterHeight,l.filterWidth],d):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],h=function(e,t,n){var r=n.map((function(e){return e[0]})),i=n.map((function(e){return e[1]})),a=e.concat(r,i),o=t.map((function(e,t){return(e-a[t]%e)%e})),s=i.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],d,u),p=h[0],m=h[1],g=f?r:"valid",v=f?s:wf(s,d,p),y=("avg"===n?function(){return sv(v,t,a,1,g)}:function(){return ov(v,t,a,1,g)})(),b=f?y:nf(y,d,m);return c?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),dv=wd({slice_:function(e,t,n){var r,i,a=ud(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice(),i=(i=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:($c(-1===e,(function(){return"Bad value in size"})),a.shape[t]-r[t])})),function(e,t,n){$c(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),$c(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){$c(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},i=0;i<e.rank;++i)r(i)}(a,r,i);var o=a.shape;return sl.runKernel((function(e){return e.slice(a,r,i)}),{$x:a},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-i[n]]);return{$x:function(){return e.pad(t)}}}))}}),fv=wd({slice1d_:function(e,t,n){var r=ud(e,"x","slice1d");return $c(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),dv(r,[t],[n])}}),hv=wd({slice2d_:function(e,t,n){var r=ud(e,"x","slice2d");return $c(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),dv(r,t,n)}}),pv=wd({slice3d_:function(e,t,n){var r=ud(e,"x","slice3d");return $c(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),dv(r,t,n)}}),mv=wd({slice4d_:function(e,t,n){var r=ud(e,"x","slice4d");return $c(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),dv(r,t,n)}});function gv(e,t,n,r,i){return t.rank<n.rank&&(t=t.reshape(pd(t.shape,r))),e.rank<n.rank&&(e=e.reshape(pd(e.shape,r))),{$x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==i?r:r.transpose(i)}}}var vv=wd({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ud(e,"x","all","bool"),i=du(t,r.shape),a=i,o=gd(a,r.rank);null!=o&&(r=r.transpose(o),a=yd(a.length,r.rank));var s=sl.runKernel((function(e){return e.all(r,a)}),{$x:r});if(n){var c=pd(s.shape,i);return s.reshape(c)}return s}}),yv=wd({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ud(e,"x","any","bool"),i=du(t,r.shape),a=i,o=gd(a,r.rank);null!=o&&(r=r.transpose(o),a=yd(a.length,r.rank));var s=sl.runKernel((function(e){return e.any(r,a)}),{$x:r});if(n){var c=pd(s.shape,i);return s.reshape(c)}return s}}),bv=wd({argMax_:function(e,t){void 0===t&&(t=0);var n=ud(e,"x","argMax");null==t&&(t=0);var r=du(t,n.shape),i=gd(r,n.rank);return null!=i&&(n=n.transpose(i),r=yd(r.length,n.rank)),sl.runKernel((function(e,t){var i=e.argMax(n,r[0]);return t([n]),i}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return jd(n)}}}))}}),_v=wd({argMin_:function(e,t){void 0===t&&(t=0);var n=ud(e,"x","argMin");null==t&&(t=0);var r=du(t,n.shape),i=gd(r,n.rank);return null!=i&&(n=n.transpose(i),r=yd(r.length,n.rank)),sl.runKernel((function(e,t){var i=e.argMin(n,r[0]);return t([n]),i}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return jd(n)}}}))}}),wv=wd({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ud(e,"x","logSumExp"),i=du(t,r.shape),a=r.max(i,!0),o=r.sub(a).exp().sum(i).log(),s=a.reshape(o.shape).add(o);if(n){var c=pd(s.shape,i);return s.reshape(c)}return s}}),Ev=wd({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ud(e,"x","max"),i=r,a=du(t,r.shape),o=a,s=gd(o,r.rank);null!=s&&(r=r.transpose(s),o=yd(o.length,r.rank));var c=sl.runKernel((function(e,t){var n=e.max(r,o);return t([i,n]),n}),{$x:r},(function(e,t){return gv(e,t[1],t[0],a,s)}));if(n){var u=pd(c.shape,a);c=c.reshape(u)}return c}}),Sv=wd({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ud(e,"x","mean"),i=du(t,r.shape),a=ru(hd(r.shape,i)[1]);return Bf((function(e){var r=Rd(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(Dd(e.shape,"float32")).div(a)}}}))(r)}}),Cv=wd({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ud(e,"x","min"),i=r,a=du(t,r.shape),o=a,s=gd(o,r.rank);null!=s&&(r=r.transpose(s),o=yd(o.length,r.rank));var c=sl.runKernel((function(e,t){var n=e.min(r,o);return t([i,n]),n}),{$x:r},(function(e,t){return gv(e,t[1],t[0],a,s)}));if(n){var u=pd(c.shape,a);c=c.reshape(u)}return c}}),xv=wd({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=du(t,(e=ud(e,"x","moments")).shape),i=e.mean(r,n),a=i.shape;n||(a=pd(i.shape,r));var o=e.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:o.mean(r,n)}}}),Tv=wd({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ud(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=du(t,r.shape);return Bf((function(e){var t=gd(i,e.rank),r=i,a=e;null!=t&&(a=e.transpose(t),r=yd(r.length,e.rank));var o=sl.runKernel((function(e){return e.sum(a,r)}),{permutedX:a});if(n){var s=pd(o.shape,i);o=o.reshape(s)}return{value:o,gradFunc:function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(Dd(e.shape,"float32"))}}}))(r)}}),Rv=wd({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=ud(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=du(t,r.shape),a=gd(i,r.rank),o=i,s=r;null!=a&&(s=r.transpose(a),o=yd(o.length,r.rank));var c=sl.runKernel((function(e){return e.prod(s,o)}),{permutedX:s});if(n){var u=pd(c.shape,i);c=c.reshape(u)}return c}}),Iv=wd({equal_:function(e,t){var n,r=ud(e,"a","equal"),i=ud(t,"b","equal");return n=tl(r,i),r=n[0],i=n[1],Yf(r.shape,i.shape),sl.runKernel((function(e){return e.equal(r,i)}),{$a:r,$b:i})}}),Nv=wd({equalStrict_:function(e,t){var n=ud(e,"a","equalStrict"),r=ud(t,"b","equalStrict");return eu(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Av=wd({greater_:function(e,t){var n,r=ud(e,"a","greater"),i=ud(t,"b","greater");return n=tl(r,i),r=n[0],i=n[1],Yf(r.shape,i.shape),sl.runKernel((function(e){return e.greater(r,i)}),{$a:r,$b:i})}}),kv=wd({greaterEqual_:function(e,t){var n,r=ud(e,"a","greaterEqual"),i=ud(t,"b","greaterEqual");return n=tl(r,i),r=n[0],i=n[1],Yf(r.shape,i.shape),sl.runKernel((function(e,t){var n=e.greaterEqual(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){return jd(n)},$b:function(){return jd(r)}}}))}}),Dv=wd({greaterEqualStrict_:function(e,t){var n=ud(e,"a","greaterEqualStrict"),r=ud(t,"b","greaterEqualStrict");return eu(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Mv=wd({greaterStrict_:function(e,t){var n=ud(e,"a","greaterStrict"),r=ud(t,"b","greaterStrict");return eu(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Lv=wd({less_:function(e,t){var n,r=ud(e,"a","less"),i=ud(t,"b","less");return n=tl(r,i),r=n[0],i=n[1],Yf(r.shape,i.shape),sl.runKernel((function(e){return e.less(r,i)}),{$a:r,$b:i})}}),Ov=wd({lessEqual_:function(e,t){var n,r=ud(e,"a","lessEqual"),i=ud(t,"b","lessEqual");return n=tl(r,i),r=n[0],i=n[1],Yf(r.shape,i.shape),sl.runKernel((function(e){return e.lessEqual(r,i)}),{$a:r,$b:i})}}),Pv=wd({lessEqualStrict_:function(e,t){var n=ud(e,"a","lessEqualStrict"),r=ud(t,"b","lessEqualStrict");return eu(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),jv=wd({lessStrict_:function(e,t){var n=ud(e,"a","lessStrict"),r=ud(t,"b","lessStrict");return eu(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Fv=wd({notEqual_:function(e,t){var n,r=ud(e,"a","notEqual"),i=ud(t,"b","notEqual");return n=tl(r,i),r=n[0],i=n[1],Yf(r.shape,i.shape),sl.runKernel((function(e){return e.notEqual(r,i)}),{$a:r,$b:i})}}),Uv=wd({notEqualStrict_:function(e,t){var n=ud(e,"a","notEqualStrict"),r=ud(t,"b","notEqualStrict");return eu(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}}),Bv=wd({add_:function(e,t){var n,r=ud(e,"a","add"),i=ud(t,"b","add");n=tl(r,i),r=n[0],i=n[1];var a=Yf(r.shape,i.shape);return sl.runKernel((function(e){return e.add(r,i)}),{$a:r,$b:i},(function(e){return{$a:function(){var t=e,n=Hf(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},$b:function(){var t=e,n=Hf(i.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(i.shape)}}}))}}),Vv=wd({addN_:function(e){$c(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),$c(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return ud(e,"tensors"+t,"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!iu(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return sl.runKernel((function(e){return e.addN(t)}),r,(function(e){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}))}}),zv=wd({addStrict_:function(e,t){var n=ud(e,"a","addStrict"),r=ud(t,"b","addStrict");return eu(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Wv=wd({atan2_:function(e,t){var n,r=ud(e,"a","atan2"),i=ud(t,"b","atan2");n=tl(r,i),r=n[0],i=n[1];var a=Yf(r.shape,i.shape);return sl.runKernel((function(e,t){var n=e.atan2(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Bv(n.square(),r.square()),i=e.mul(r.div(t)),o=Hf(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},$b:function(){var t=Bv(n.square(),r.square()),i=dg(e.mul(n.div(t))),o=Hf(r.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(r.shape)}}}))}}),Gv=wd({div_:function(e,t){var n,r=ud(e,"a","div"),i=ud(t,"b","div");if(n=tl(r,i),r=n[0],i=n[1],"int32"===r.dtype&&"int32"===i.dtype)return Yv(r,i);var a=Yf(r.shape,i.shape);return sl.runKernel((function(e,t){var n=e.realDivide(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.div(r.toFloat()),i=Hf(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),i=Hf(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}))}}),Hv=wd({divStrict_:function(e,t){var n=ud(e,"a","div"),r=ud(t,"b","div");return eu(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Yv=wd({floorDiv_:function(e,t){var n,r=ud(e,"a","floorDiv"),i=ud(t,"b","floorDiv");n=tl(r,i),r=n[0],i=n[1];var a=Yf(r.shape,i.shape);return sl.runKernel((function(e,t){var n=e.floorDiv(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.div(r.toFloat()),i=Hf(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),i=Hf(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}))}}),qv=wd({maximum_:function(e,t){var n,r=ud(e,"a","maximum"),i=ud(t,"b","maximum");return n=tl(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),Yf(r.shape,i.shape),sl.runKernel((function(e,t){var n=e.maximum(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){return e.mul(n.greaterEqual(r).toFloat())},$b:function(){return e.mul(n.less(r).toFloat())}}}))}}),Kv=wd({maximumStrict_:function(e,t){var n=ud(e,"a","maximumStrict"),r=ud(t,"b","maximumStrict");return eu(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Xv=wd({minimum_:function(e,t){var n,r=ud(e,"a","minimum"),i=ud(t,"b","minimum");return n=tl(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),Yf(r.shape,i.shape),sl.runKernel((function(e,t){var n=e.minimum(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){return e.mul(n.lessEqual(r).toFloat())},$b:function(){return e.mul(n.greater(r).toFloat())}}}))}}),Qv=wd({minimumStrict_:function(e,t){var n=ud(e,"a","minimumStrict"),r=ud(t,"b","minimumStrict");return eu(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Jv=wd({mod_:function(e,t){var n,r=ud(e,"a","mod"),i=ud(t,"b","mod");n=tl(r,i),r=n[0],i=n[1];var a=Yf(r.shape,i.shape);return sl.runKernel((function(e,t){var n=e.mod(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Hf(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),i=Hf(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),Zv=wd({modStrict_:function(e,t){var n=ud(e,"a","modStrict"),r=ud(t,"b","modStrict");return eu(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),$v=wd({mul_:function(e,t){var n,r=ud(e,"a","mul"),i=ud(t,"b","mul");n=tl(r,i),r=n[0],i=n[1];var a=Yf(r.shape,i.shape);return sl.runKernel((function(e,t){var n=e.multiply(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=e.mul(r.toFloat()),i=Hf(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},$b:function(){var t=e.mul(n.toFloat()),i=Hf(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),ey=wd({mulStrict_:function(e,t){var n=ud(e,"a","mul"),r=ud(t,"b","mul");return eu(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),ty=wd({pow_:function(e,t){var n=ud(e,"base","pow"),r=ud(t,"exp","pow"),i=Yf(n.shape,r.shape);return e=n.cast($u(n.dtype,r.dtype)),t=r.cast($u(n.dtype,r.dtype)),sl.runKernel((function(e,t){var i=e.pow(n,r);return t([n,r,i]),i}),{$base:n,$exp:r},(function(e,t){var n=t[0],r=t[1],a=t[2];return{$base:function(){var t=r.toFloat(),a=e.mul(t.mul(n.pow(t.sub(Rd(1))))),o=Hf(n.shape,i);return o.length>0&&(a=a.sum(o)),a.reshape(n.shape)},$exp:function(){var t=n.greater(0),o=n.log().where(t,jd(n)),s=e.mul(a.mul(o)),c=Hf(r.shape,i);return c.length>0&&(s=s.sum(c)),s.reshape(r.shape)}}}))}}),ny=wd({powStrict_:function(e,t){return eu(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),ry=wd({squaredDifference_:function(e,t){var n,r=ud(e,"a","squaredDifference"),i=ud(t,"b","squaredDifference");return n=tl(r,i),r=n[0],i=n[1],Yf(r.shape,i.shape),sl.runKernel((function(e,t){var n=e.squaredDifference(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1],i=Rd(2);return{$a:function(){return e.mul(n.sub(r).mul(i))},$b:function(){return e.mul(r.sub(n).mul(i))}}}))}}),iy=wd({squaredDifferenceStrict_:function(e,t){var n=ud(e,"a","squaredDifferenceStrict"),r=ud(t,"b","squaredDifferenceStrict");return eu(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),ay=wd({sub_:function(e,t){var n,r=ud(e,"a","sub"),i=ud(t,"b","sub");n=tl(r,i),r=n[0],i=n[1];var a=Yf(r.shape,i.shape);return sl.runKernel((function(e){return e.subtract(r,i)}),{$a:r,$b:i},(function(e){return{$a:function(){var t=e,n=Hf(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},$b:function(){var t=e,n=Hf(i.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(i.shape)}}}))}}),oy=wd({subStrict_:function(e,t){var n=ud(e,"a","subStrict"),r=ud(t,"b","subStrict");return eu(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),sy=wd({logicalAnd_:function(e,t){var n=ud(e,"a","logicalAnd","bool"),r=ud(t,"b","logicalAnd","bool");return Yf(n.shape,r.shape),sl.runKernel((function(e){return e.logicalAnd(n,r)}),{$a:n,$b:r})}}),cy=wd({logicalNot_:function(e){var t=ud(e,"x","logicalNot","bool");return sl.runKernel((function(e){return e.logicalNot(t)}),{$x:t})}}),uy=wd({logicalOr_:function(e,t){var n=ud(e,"a","logicalOr","bool"),r=ud(t,"b","logicalOr","bool");return Yf(n.shape,r.shape),sl.runKernel((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),ly=wd({logicalXor_:function(e,t){var n=ud(e,"a","logicalXor","bool"),r=ud(t,"b","logicalXor","bool");return Yf(n.shape,r.shape),uy(e,t).logicalAnd(sy(e,t).logicalNot())}}),dy=wd({where_:function(e,t,n){var r=ud(t,"a","where"),i=ud(n,"b","where"),a=ud(e,"condition","where","bool");return eu(r.shape,i.shape,"Error in where: "),1===a.rank?$c(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):eu(a.shape,i.shape,"Error in where: "),sl.runKernel((function(e,t){var n=e.select(a,r,i);return t([a]),n}),{$condition:a,$a:r,$b:i},(function(e,t){var n=t[0];return{$condition:function(){return jd(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),fy=wd({elu_:function(e){var t=ud(e,"x","elu");return sl.runKernel((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return sl.runKernel((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),hy=wd({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=ud(e,"x","leakyRelu");return qv(Rd(t).mul(n),n)}}),py=wd({prelu_:function(e,t){var n=ud(e,"x","prelu"),r=ud(t,"alpha","prelu");return sl.runKernel((function(e,t){var i=e.prelu(n,r);return t([n,r]),i}),{$x:n,$alpha:r},(function(e,t){var n=t[0],r=t[1],i=n.greater(0);return{$x:function(){return dy(i,e,e.mul(r))},$alpha:function(){var t=dy(i,jd(e),e.mul(n)),a=Hf(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}}))}}),my=wd({relu_:function(e){var t=ud(e,"x","relu");return"bool"===t.dtype?t.toInt():sl.runKernel((function(e,n){var r=e.relu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mulStrict(n.step().toFloat())}}}))}}),gy=wd({selu_:function(e){var t=ud(e,"x","selu");return sl.runKernel((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(Rd(0)),r=Rd(Am),i=Rd(km),a=e.mul(i),o=e.mul(r).mul(n.toFloat().exp());return dy(t,a,o)}}}))}}),vy=wd({transpose_:function(e,t){var n=ud(e,"x","transpose");return null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),$c(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){$c(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1?n.clone():sl.runKernel((function(e){return e.transpose(n,t)}),{$x:n},(function(e){var n=vd(t);return{$x:function(){return e.transpose(n)}}}))}}),yy=wd({localResponseNormalization_:function(e,t,n,r,i){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var a=ud(e,"x","localResponseNormalization");$c(4===a.rank||3===a.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."})),$c(au(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var o=a,s=!1;3===a.rank&&(s=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var c=sl.runKernel((function(e,a){var s=e.localResponseNormalization4D(o,t,n,r,i);return a([o,s]),s}),{x4D:o},(function(e,a){var o=a[0],s=a[1];return{x4D:function(){return sl.runKernel((function(a){return a.LRNGrad(e,o,s,t,n,r,i)}),{})}}}));return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),by=wd({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(Rd(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=ud(e,"x","norm"),t,n),a=i.shape;if(r){var o=du(n,e.shape);a=pd(i.shape,o)}return i.reshape(a)}});function _y(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function wy(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Ey=wd({gather_:function(e,t,n){void 0===n&&(n=0);var r=ud(e,"x","gather"),i=ud(t,"indices","gather","int32");n=du(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],i=[],a=1,o=1,s=0;s<n;s++)i.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)i.push(t.shape[s]);for(s=n+1;s<e.rank;s++)i.push(e.shape[s]),o*=e.shape[s];return{batchSize:a,sliceSize:o,dimSize:r,outputShape:i}}(r,i,n);return sl.runKernel((function(e,t){var a=e.gather(r,i.flatten(),n);return t([i]),a}),{$x:r},(function(e,t){var i=t[0];return{$x:function(){var t=r.shape,a=i.size,o=t.slice(0,n),s=o.length,c=t.slice(n,t.length).slice(1),u=c.length,l=_y(0,s),d=_y(s+1,s+1+u),f=wy([o,[a],c]),h=e.reshape(f),p=i.reshape([a]),m=wy([[s],l,d]),g=h.transpose(m),v=Sy(g,p,r.shape[n]),y=vd(m);return v.transpose(y)}}})).reshape(a.outputShape)}}),Sy=wd({unsortedSegmentSum_:function(e,t,n){var r=ud(e,"x","unsortedSegmentSum"),i=ud(t,"segmentIds","unsortedSegmentSum","int32");return $c(au(n),(function(){return"numSegments must be of dtype int"})),sl.runKernel((function(e,t){var a=e.unsortedSegmentSum(r,i,n);return t([i]),a}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=qv(t,jd(t)),r=Ey(e,n),i=kv(t,Rd(0,"int32")),a=r.rank-i.rank,o=0;o<a;++o)i=cf(i,o+1);i=sy(i,Dd(r.shape,"bool"));var s=jd(r);return dy(i,r,s)}(e,n)}}}))}}),Cy=wd({basicLSTMCell_:function(e,t,n,r,i,a){var o=ud(e,"forgetBias","basicLSTMCell"),s=ud(t,"lstmKernel","basicLSTMCell"),c=ud(n,"lstmBias","basicLSTMCell"),u=ud(r,"data","basicLSTMCell"),l=ud(i,"c","basicLSTMCell"),d=ud(a,"h","basicLSTMCell"),f=u.concat(d,1).matMul(s).add(c),h=f.shape[0],p=f.shape[1]/4,m=[h,p],g=f.slice([0,0],m),v=f.slice([0,p],m),y=f.slice([0,2*p],m),b=f.slice([0,3*p],m),_=g.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(o.add(y).sigmoid())),w=_.tanh().mulStrict(b.sigmoid());return[_,w]}}),xy=wd({multiRNNCell_:function(e,t,n,r){for(var i=ud(t,"data","multiRNNCell"),a=ld(n,"c","multiRNNCell"),o=ld(r,"h","multiRNNCell"),s=i,c=[],u=0;u<e.length;u++){var l=e[u](s,a[u],o[u]);c.push(l[0]),c.push(l[1]),s=l[1]}var d=[],f=[];for(u=0;u<c.length;u+=2)d.push(c[u]),f.push(c[u+1]);return[d,f]}}),Ty=wd({movingAverage_:function(e,t,n,r,i){void 0===i&&(i=!0);var a=ud(e,"v","movingAverage"),o=ud(t,"x","movingAverage"),s=ud(n,"decay","movingAverage");nl(a,o),$c(iu(a.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var c=Rd(1),u=c.sub(s),l=o.sub(a).mul(u);if(i){$c(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var d=ud(r,"step","movingAverage");l=l.div(c.sub(ty(s,d)))}return a.add(l)}}),Ry=wd({stridedSlice_:function(e,t,n,r,i,a,o,s,c){if(void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),0!==o)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");var u=ud(e,"x","stridedSlice");if(r.every((function(e){return 1===e}))){var l=Of(u.shape,t,n,r,i,a,o,s,c),d=l[0],f=l[1],h=l[2],p=f.filter((function(e,t){return-1===h.indexOf(t)}));return dv(u,d,f).reshape(p)}return sl.runKernel((function(e){return e.stridedSlice(u,t,n,r,i,a,o,s,c)}),{$x:u})}}),Iy=wd({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=ud(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var a=sl.runKernel((function(e){return e.topk(r,t,n)}),{$x:r});return{values:a[0],indices:a[1]}}}),Ny=wd({scatterND_:function(e,t,n){var r=ud(e,"indices","scatterND","int32"),i=ud(t,"updates","scatterND");return function(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}!function(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(a+" update.rank < "+i+". ");if(e.length<r+(n.rank-i))throw new Error(a+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != "+(i+e.length-r));for(var o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(a+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(a+" updates.shape["+(o+i)+"] ("+n.shape[o+i]+") != shape["+(o+i)+"] ("+e[o+i]+")")}(n,t,e)}(i,r,n),sl.runKernel((function(e){return e.scatterND(r,i,n)}),{$indices:r,$updates:i})}}),Ay=wd({fft_:function(e){$c("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return sl.runKernel((function(e){return e.fft(r)}),{input:e}).reshape(e.shape)}}),ky=wd({ifft_:function(e){$c("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return sl.runKernel((function(e){return e.ifft(r)}),{input:e}).reshape(e.shape)}}),Dy=wd({rfft_:function(e,t){$c("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],i=e.size/r;if(null!=t&&t<r){var a=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=e.slice(a,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(Md(s),e.shape.length-1),r=t}else n=e;var c=n.zerosLike(),u=Ed(n,c).as2D(i,r),l=Ay(u),d=Math.floor(r/2)+1,f=Sd(l),h=Cd(l),p=f.split([d,r-d],f.shape.length-1),m=h.split([d,r-d],h.shape.length-1),g=n.shape.slice();return g[n.shape.length-1]=d,Ed(p[0],m[0]).reshape(g)}}),My=wd({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),i=ky(r);return Sd(i)}var a=[n,2*(t-1)],o=Sd(e).as2D(n,t),s=Cd(e).as2D(n,t),c=o.slice([0,1],[n,t-2]).reverse(1),u=s.slice([0,1],[n,t-2]).reverse(1).mul(Rd(-1)),l=o.concat(c,1),d=s.concat(u,1);return r=Ed(l,d).as2D(a[0],a[1]),i=ky(r),Sd(i)}}),Ly=Object.freeze({fft:Ay,ifft:ky,rfft:Dy,irfft:My}),Oy=wd({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var i=ud(e,"sparseIndices","sparseToDense","int32"),a=ud(t,"sparseValues","sparseToDense"),o=ud(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==i))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+i+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,o),sl.runKernel((function(e){return e.sparseToDense(i,a,n,o)}),{$sparseIndices:i,$sparseValues:a,$defaultValue:o})}}),Py=wd({gatherND_:function(e,t){var n=ud(t,"indices","gatherND","int32"),r=ud(e,"x","gatherND");return sl.runKernel((function(e){return e.gatherND(r,n)}),{$x:r,$indices:n})}}),jy=wd({dropout_:function(e,t,n,r){if(null!=n&&!iu(e.shape,n))throw new Error("Non-default noise shape is not implemented yet: "+JSON.stringify(n));var i=bf(e.shape,0,1,"float32",r).greater(t);return i=i.div(ay(1,t)),e.mul(i)}});function Fy(e,t,n){for(var r=1-e%2,i=new Float32Array(e),a=0;a<e;++a){var o=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(o)}return Id(i,"float32")}var Uy,By=wd({hannWindow_:function(e){return Fy(e,.5,.5)}}),Vy=wd({hammingWindow_:function(e){return Fy(e,.54,.46)}}),zy=wd({frame_:function(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var a=0,o=[];a+t<=e.size;)o.push(dv(e,a,t)),a+=n;if(r){var s=a+t-e.size,c=Fd([dv(e,a,t-s),Ld([s],i)]);o.push(c)}return 0===o.length?Nd([],[0,t]):Fd(o).as2D(o.length,t)}}),Wy=Object.freeze({hannWindow:By,hammingWindow:Vy,frame:zy});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Uy||(Uy={}));var Gy=wd({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=Uy.SUM_BY_NONZERO_WEIGHTS);var i=ud(e,"labels","absoluteDifference"),a=ud(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=ud(n,"weights","absoluteDifference")),eu(i.shape,a.shape,"Error in absoluteDifference: ");var s=i.sub(a).abs();return Hy(s,o,r)}}),Hy=wd({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=Uy.SUM_BY_NONZERO_WEIGHTS);var r=ud(e,"losses","computeWeightedLoss"),i=null;null!=t&&(i=ud(t,"weights","computeWeightedLoss"));var a=null==i?r:r.mul(i);if(n===Uy.NONE)return a;if(n===Uy.SUM)return a.sum();if(n===Uy.MEAN){if(null==i)return a.mean();var o=r.size/i.size,s=a.sum().div(i.sum());return o>1?s.div(Rd(o)):s}if(n===Uy.SUM_BY_NONZERO_WEIGHTS){if(null==i)return a.sum().div(Rd(r.size));var c=i.mul(Dd(r.shape)).notEqual(Rd(0)).sum().toFloat();return a.sum().div(c)}throw Error("Unknown reduction: "+n)}}),Yy=wd({cosineDistance_:function(e,t,n,r,i){void 0===i&&(i=Uy.SUM_BY_NONZERO_WEIGHTS);var a=ud(e,"labels","cosineDistance"),o=ud(t,"predictions","cosineDistance"),s=null;null!=r&&(s=ud(r,"weights","cosineDistance")),eu(a.shape,o.shape,"Error in cosineDistance: ");var c=Rd(1).sub(a.mul(o).sum(n,!0));return Hy(c,s,i)}}),qy=wd({hingeLoss_:function(e,t,n,r){void 0===r&&(r=Uy.SUM_BY_NONZERO_WEIGHTS);var i=ud(e,"labels","hingeLoss"),a=ud(t,"predictions","hingeLoss"),o=null;null!=n&&(o=ud(n,"weights","hingeLoss")),eu(i.shape,a.shape,"Error in hingeLoss: ");var s=Rd(1);i=Rd(2).mul(i).sub(s);var c=s.sub(i.mul(a)).relu();return Hy(c,o,r)}}),Ky=wd({huberLoss_:function(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=Uy.SUM_BY_NONZERO_WEIGHTS);var a=ud(e,"labels","huberLoss"),o=ud(t,"predictions","huberLoss"),s=null;null!=n&&(s=ud(n,"weights","huberLoss")),eu(a.shape,o.shape,"Error in huberLoss: ");var c=Rd(r),u=o.sub(a).abs(),l=Xv(u,c),d=u.sub(l),f=Rd(.5).mul(l.square()).add(c.mul(d));return Hy(f,s,i)}}),Xy=wd({logLoss_:function(e,t,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=Uy.SUM_BY_NONZERO_WEIGHTS);var a=ud(e,"labels","logLoss"),o=ud(t,"predictions","logLoss"),s=null;null!=n&&(s=ud(n,"weights","logLoss")),eu(a.shape,o.shape,"Error in logLoss: ");var c=Rd(1),u=Rd(r),l=a.mul(o.add(u).log()).neg().sub(c.sub(a).mul(c.sub(o).add(u).log()));return Hy(l,s,i)}}),Qy=wd({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=Uy.SUM_BY_NONZERO_WEIGHTS);var i=ud(e,"labels","meanSquaredError"),a=ud(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=ud(n,"weights","meanSquaredError")),eu(i.shape,a.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(a);return Hy(s,o,r)}}),Jy=wd({sigmoidCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=Uy.SUM_BY_NONZERO_WEIGHTS);var a=ud(e,"multiClassLabels","sigmoidCrossEntropy"),o=ud(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=ud(n,"weights","sigmoidCrossEntropy")),eu(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=Rd(r),u=Rd(1),l=Rd(.5);a=a.mul(u.sub(c)).add(l.mul(c))}var d=function(e,t){var n=ud(e,"labels","sigmoidCrossEntropyWithLogits"),r=ud(t,"logits","sigmoidCrossEntropyWithLogits");eu(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),a=r.mul(n),o=r.abs().neg().exp().log1p();return i.sub(a).add(o)}(a,o);return Hy(d,s,i)}}),Zy=wd({softmaxCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=Uy.SUM_BY_NONZERO_WEIGHTS);var a=ud(e,"onehotLabels","softmaxCrossEntropy"),o=ud(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=ud(n,"weights","softmaxCrossEntropy")),eu(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var c=Rd(r),u=Rd(1),l=Rd(a.shape[1]);a=a.mul(u.sub(c)).add(c.div(l))}var d=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return Bf((function(e,t,r){var i=t.logSumExp([n],!0),a=t.toFloat().sub(i);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],i=t[1],a=pd(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(i.exp())),e.reshape(a).mul(i.exp().sub(r.toFloat()))]}}}))(e,t)}(a,o);return Hy(d,s,i)}}),$y=Object.freeze({get Reduction(){return Uy},absoluteDifference:Gy,computeWeightedLoss:Hy,cosineDistance:Yy,hingeLoss:qy,huberLoss:Ky,logLoss:Xy,meanSquaredError:Qy,sigmoidCrossEntropy:Jy,softmaxCrossEntropy:Zy});function eb(e,t){return void 0===t&&(t=!1),sl.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],i=uf(n),a=e.clone(),o=Nd([[1]],[1,1]),s=o.clone(),c=n>=r?r:n,u=function(e){var t,c=a,u=s,l=i;t=sl.tidy((function(){var t=a.slice([e,e],[n-e,1]),c=t.norm(),u=a.slice([e,e],[1,1]),l=u.sign().neg(),d=u.sub(l.mul(c)),f=t.div(d);s=1===f.shape[0]?o.clone():o.concat(f.slice([1,0],[f.shape[0]-1,f.shape[1]]),0);var h=l.matMul(d).div(c).neg(),p=a.slice([e,0],[n-e,r]),m=h.mul(s);a=0===e?p.sub(m.matMul(s.transpose().matMul(p))):a.slice([0,0],[e,r]).concat(p.sub(m.matMul(s.transpose().matMul(p))),0);var g=i.slice([0,e],[n,i.shape[1]-e]);return i=0===e?g.sub(g.matMul(s).matMul(m.transpose())):i.slice([0,0],[n,e]).concat(g.sub(g.matMul(s).matMul(m.transpose())),1),[s,a,i]})),s=t[0],a=t[1],i=t[2],ad([c,u,l])},l=0;l<c;++l)u(l);return!t&&n>r&&(i=i.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[i,a]}))}var tb=wd({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,$c(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){$c(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},i=1;i<e.length;++i)r(i)}else t=!0,e=Wd(e,e.shape[0],0).map((function(e){return Ef(e,[0])}));$c(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var a=[],o=e,s=function(e){a.push(sl.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=Tv(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(by(t,"euclidean"))})))};for(i=0;i<e.length;++i)s(i);return t?Sf(a,0):a}}),nb=wd({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return eb(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Tf(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],a=[];return r.forEach((function(e){var n=eb(e,t),r=n[0],o=n[1];i.push(r),a.push(o)})),[Sf(i,0).reshape(e.shape),Sf(a,0).reshape(e.shape)]}}),rb=Object.freeze({gramSchmidt:tb,qr:nb});function ib(e,t,n,r,i){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY);var a=e.shape[0];return n=Math.min(n,a),$c(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),$c(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),$c(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),$c(1===t.rank,(function(){return"scores must be a 1D tensor"})),$c(t.shape[0]===a,(function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i}}var ab=wd({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=ud(e,"images","resizeBilinear");$c(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),$c(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],c=sl.runKernel((function(e,t){return t([i]),e.resizeBilinear(i,o,s,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return sl.runKernel((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}));return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),ob=wd({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=ud(e,"images","resizeNearestNeighbor");$c(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),$c(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),$c("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],c=sl.runKernel((function(e,t){return t([i]),e.resizeNearestNeighbor(i,o,s,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return sl.runKernel((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),sb=wd({nonMaxSuppression_:function(e,t,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var a=ud(e,"boxes","nonMaxSuppression"),o=ud(t,"scores","nonMaxSuppression"),s=ib(a,o,n,r,i);return n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,sl.runKernel((function(e){return e.nonMaxSuppression(a,o,n,r,i)}),{$boxes:a})}}),cb=wd({cropAndResize_:function(e,t,n,r,i,a){var o=ud(e,"image","cropAndResize","float32"),s=ud(t,"boxes","cropAndResize","float32"),c=ud(n,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var u=s.shape[0];return $c(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."})),$c(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+s.shape+"."})),$c(1===c.rank&&c.shape[0]===u,(function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+s.shape+"."})),$c(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),$c(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),$c("bilinear"===i||"nearest"===i,(function(){return"method must be bilinear or nearest, but was "+i})),sl.runKernel((function(e,t){return e.cropAndResize(o,s,c,r,i,a)}),{$image:o,$boxes:s})}}),ub=Object.freeze({resizeBilinear:ab,resizeNearestNeighbor:ob,nonMaxSuppression:sb,nonMaxSuppressionAsync:function(e,t,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),Wc(this,void 0,void 0,(function(){var a,o,s,c,u,l;return Gc(this,(function(d){switch(d.label){case 0:return a=ud(e,"boxes","nonMaxSuppressionAsync"),o=ud(t,"scores","nonMaxSuppressionAsync"),s=ib(a,o,n,r,i),n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,a.data()];case 1:return c=d.sent(),[4,o.data()];case 2:return u=d.sent(),l=lh(c,u,n,r,i),a!==e&&a.dispose(),o!==t&&o.dispose(),[2,l]}}))}))},cropAndResize:cb}),lb=wd({matMul_:function(e,t,n,r,i,a){var o;void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===a&&(a="linear");var s=ud(e,"a","fused matMul"),c=ud(t,"b","fused matMul");o=tl(s,c),s=o[0],c=o[1];var u=n?s.shape[s.rank-2]:s.shape[s.rank-1],l=r?c.shape[c.rank-1]:c.shape[c.rank-2],d=n?s.shape[s.rank-1]:s.shape[s.rank-2],f=r?c.shape[c.rank-2]:c.shape[c.rank-1],h=s.shape.slice(0,-2),p=c.shape.slice(0,-2),m=ru(h),g=ru(p);$c(s.rank>=2&&c.rank>=2&&s.rank===c.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+c.rank+"."})),$c(iu(h,p),(function(){return"Error in fused matMul: outer dimensions ("+h+") and ("+p+") of Tensors with shapes "+s.shape+" and "+c.shape+" must match."})),$c(u===l,(function(){return"Error in fused matMul: inner shapes ("+u+") and ("+l+") of Tensors with shapes "+s.shape+" and "+c.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var v,y=s.shape.slice(0,-2).concat([d,f]),b=n?s.as3D(m,u,d):s.as3D(m,d,u),_=r?c.as3D(g,f,l):c.as3D(g,l,f);null!=i&&Yf(y,(v=tl(v=ud(i,"bias","fused matMul"),s)[0]).shape);var w={$a:b,$b:_};return null!=i&&(w.$bias=v),sl.runKernel((function(e,t){var i=e.fusedBatchMatMul(b,_,n,r,v,a);return t([b,_,i]),i}),w,(function(e,t){var o,s=t[0],c=t[1],u=t[2];if(null==a||"linear"===a)o=e;else{if("relu"!==a)throw new Error("Gradient for activation "+a+" has not been implemented yet.");o=e.mul(u.step())}var l={};return null!=i&&(l={$bias:function(){var e=o,t=Hf(v.shape,o.shape);return t.length>0&&(e=e.sum(t)),e.reshape(v.shape)}}),n||r?!n&&r?Object.assign({$a:function(){return o.matMul(c,!1,!1)},$b:function(){return o.matMul(s,!0,!1)}},l):n&&!r?Object.assign({$a:function(){return c.matMul(o,!1,!0)},$b:function(){return s.matMul(o,!1,!1)}},l):Object.assign({$a:function(){return c.matMul(o,!0,!0)},$b:function(){return o.matMul(s,!0,!0)}},l):Object.assign({$a:function(){return o.matMul(c,!1,!0)},$b:function(){return s.matMul(o,!0,!1)}},l)})).reshape(y)}}),db=Object.freeze({matMul:lb}),fb=Object.freeze({image:ub,linalg:rb,losses:$y,spectral:Ly,fused:db,signal:Wy,op:wd,batchNormalization2d:Lg,batchNormalization3d:Og,batchNormalization4d:Pg,batchNormalization:jg,batchNorm:Fg,batchNorm2d:Ug,batchNorm3d:Bg,batchNorm4d:Vg,complex:Ed,real:Sd,imag:Cd,concat:Fd,concat1d:Ud,concat2d:Bd,concat3d:Vd,concat4d:zd,split:Wd,conv1d:Hg,conv2d:Yg,conv3d:qg,conv2dDerFilter:Kg,depthwiseConv2d:Xg,separableConv2d:Qg,conv2dTranspose:Jg,matMul:Zg,dot:$g,outerProduct:ev,reverse:tv,reverse1d:nv,reverse2d:rv,reverse3d:iv,reverse4d:av,maxPool:cv,avgPool:uv,pool:lv,slice:dv,slice1d:fv,slice2d:hv,slice3d:pv,slice4d:mv,abs:qm,acos:Km,acosh:Xm,asin:Qm,asinh:Jm,atan:Zm,atanh:$m,ceil:eg,clipByValue:tg,cos:ng,cosh:rg,erf:ig,exp:ag,expm1:og,floor:sg,log:cg,log1p:ug,logSigmoid:lg,neg:dg,reciprocal:fg,round:hg,rsqrt:pg,sigmoid:mg,sign:gg,isNaN:vg,isInf:yg,isFinite:bg,sin:_g,sinh:wg,softplus:Eg,sqrt:Sg,square:Cg,step:xg,tan:Tg,tanh:Rg,all:vv,any:yv,argMax:bv,argMin:_v,logSumExp:wv,max:Ev,mean:Sv,min:Cv,moments:xv,sum:Tv,prod:Rv,equal:Iv,equalStrict:Nv,greater:Av,greaterEqual:kv,greaterEqualStrict:Dv,greaterStrict:Mv,less:Lv,lessEqual:Ov,lessEqualStrict:Pv,lessStrict:jv,notEqual:Fv,notEqualStrict:Uv,add:Bv,addN:Vv,addStrict:zv,atan2:Wv,div:Gv,divStrict:Hv,floorDiv:Yv,maximum:qv,maximumStrict:Kv,minimum:Xv,minimumStrict:Qv,mod:Jv,modStrict:Zv,mul:$v,mulStrict:ey,pow:ty,powStrict:ny,squaredDifference:ry,squaredDifferenceStrict:iy,sub:ay,subStrict:oy,elu:fy,leakyRelu:hy,prelu:py,relu:my,selu:gy,logicalAnd:sy,logicalNot:cy,logicalOr:uy,logicalXor:ly,where:dy,whereAsync:function(e){return Wc(this,void 0,void 0,(function(){var t,n,r;return Gc(this,(function(i){switch(i.label){case 0:return[4,(t=ud(e,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=mh(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))},buffer:tf,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:nf,cast:rf,clone:af,cumsum:of,depthToSpace:sf,expandDims:cf,eye:uf,multinomial:lf,oneHot:df,pad:ff,pad1d:hf,pad2d:pf,pad3d:mf,pad4d:gf,rand:vf,randomNormal:yf,randomUniform:bf,reshape:_f,spaceToBatchND:wf,squeeze:Ef,stack:Sf,tile:Cf,truncatedNormal:xf,unstack:Tf,setdiff1dAsync:function(e,t){return Wc(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l,d;return Gc(this,(function(f){switch(f.label){case 0:return n=ud(e,"x","setdiff1d"),r=ud(t,"y","setdiff1d"),$c(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),$c(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),$c(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(a=f.sent(),o=new Set(a),s=0,l=0;l<i.length;l++)o.has(i[l])||s++;for(c=new Vu([s],n.dtype),u=new Vu([s],"int32"),l=0,d=0;l<i.length;l++)o.has(i[l])||(c.values[d]=i[l],u.values[d]=l,d++);return[2,[c.toTensor(),u.toTensor()]]}}))}))},fill:Ld,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return sl.runKernel((function(r){return r.linspace(e,t,n)}),{})},ones:Dd,range:Od,scalar:Rd,tensor:xd,tensor1d:Id,tensor2d:Nd,tensor3d:Ad,tensor4d:kd,tensor5d:function(e,t,n){if(tu(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=sd(e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Td(e,t,r,n)},tensor6d:function(e,t,n){if(tu(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=sd(e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Td(e,t=t||r,r,n)},zeros:Md,onesLike:Pd,zerosLike:jd,transpose:vy,softmax:Vf,logSoftmax:zf,localResponseNormalization:yy,norm:by,gather:Ey,unsortedSegmentSum:Sy,basicLSTMCell:Cy,multiRNNCell:xy,movingAverage:Ty,stridedSlice:Ry,topk:Iy,scatterND:Ny,fft:Ay,ifft:ky,rfft:Dy,irfft:My,sparseToDense:Oy,gatherND:Py,dropout:jy,hannWindow:By,hammingWindow:Vy,frame:zy}),hb=function(){function e(){if(this.blockSize=48,this.firstUse=!0,qc.get("IS_BROWSER")){var e=function(){if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}();this.fromPixels2DContext=e.getContext("2d")}this.data=new Wf(this,sl)}return e.prototype.register=function(e,t,n){if(this.firstUse&&(this.firstUse=!1,qc.get("IS_NODE")&&od("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,{dtype:n})},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(e).values=t},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n,r;if(qc.get("IS_NODE")&&null==e.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=e.getContext)n=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData||e.data instanceof Uint8Array)n=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),n=this.fromPixels2DContext.getImageData(0,0,e.width,e.height).data}if(4===t)r=new Int32Array(n);else{var i=e.width*e.height;r=new Int32Array(i*t);for(var a=0;a<i;a++)for(var o=0;o<t;++o)r[a*t+o]=n[4*a+o]}return Ad(r,[e.height,e.width,t],"int32")},e.prototype.read=function(e){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(t){return[2,this.readSync(e)]}))}))},e.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?oh(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},e.prototype.bufferSync=function(e){return tf(e.shape,e.dtype,this.readSync(e.dataId))},e.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},e.prototype.time=function(e){return Wc(this,void 0,void 0,(function(){var t;return Gc(this,(function(n){return t=Mu(),e(),[2,{kernelMs:Mu()-t}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(e,t){var n=Hu.make(e.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:sl.keep(e.clone()),imag:sl.keep(t.clone())},n},e.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},e.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},e.prototype.assertNotComplex=function(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&$c("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))},e.prototype.slice=function(e,t,n){if(this.assertNotComplex(e,"slice"),Ff(e.shape,t,n)){var r=Uf(t,e.strides),i=ru(n);return xd(this.readSync(e.dataId).subarray(r,r+i),n,e.dtype)}for(var a=tf(n,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var c=a.indexToLoc(s).map((function(e,n){return e+t[n]}));a.values[s]=o.get.apply(o,c)}return a.toTensor()},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s,c){this.assertNotComplex(e,"stridedSlice");var u=Of(e.shape,t,n,r,i,a,o,s,c),l=u[0],d=u[1],f=u[2],h=d.filter((function(e,t){return-1===f.indexOf(t)}));if(h.some((function(e){return 0===e})))return xd([],h);for(var p=tf(d,e.dtype),m=this.bufferSync(e),g=0;g<p.size;g++){for(var v=p.indexToLoc(g),y=new Array(v.length),b=0;b<y.length;b++)y[b]=v[b]*r[b]+l[b];p.set.apply(p,[m.get.apply(m,y)].concat(v))}return p.toTensor().reshape(h)},e.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var c=new Array(n);for(a=0;a<c.length;a++)o[t]=a,c[a]=this.slice(e,o,s).reshape(r);return c},e.prototype.reverse=function(e,t){this.assertNotComplex(e,"reverse");for(var n=tf(e.shape,e.dtype),r=this.bufferSync(e),i=function(i){var a=n.indexToLoc(i),o=a.slice();t.forEach((function(t){return o[t]=e.shape[t]-1-o[t]})),n.set.apply(n,[r.get.apply(r,o)].concat(a))},a=0;a<n.size;a++)i(a);return n.toTensor()},e.prototype.concat=function(e,t){var n=this;this.assertNotComplex(e,"concat");var r=e.map((function(e){var n=ru(e.shape.slice(t));return e.as2D(-1,n)})),i=_d(r.map((function(e){return e.shape})),1),a=tf(i,e[0].dtype).values;if(1===r[0].shape[0]){var o=0;r.forEach((function(e){a.set(n.readSync(e.dataId),o),o+=e.size}))}else{var s=0;r.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,o=0;o<e.shape[0];++o)for(var c=o*i[1]+s,u=0;u<e.shape[1];++u)a[c+u]=t[r++];s+=e.shape[1]}))}var c=_d(e.map((function(e){return e.shape})),t);return xd(a,c,e[0].dtype)},e.prototype.neg=function(e){return this.assertNotComplex(e,"neg"),this.multiply(Rd(-1),e)},e.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,$u(e.dtype,t.dtype),(function(e,t){return e+t}))},e.prototype.addN=function(e){var t=this;this.assertNotComplex(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=tf(e[0].shape,e[0].dtype),i=r.values,a=0;a<e.length;a++)for(var o=n[a],s=0;s<i.length;s++)i[s]+=o[s];return r.toTensor()},e.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,$u(e.dtype,t.dtype),(function(e,t){return e-t}))},e.prototype.pow=function(e,t){return this.assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},e.prototype.batchMatMul=function(e,t,n,r){this.assertNotComplex([e,t],"matMul");for(var i=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],c=this.readSync(e.dataId),u=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],d=l[0],f=l[1],h=l[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=p[0],g=p[1],v=p[2],y=a*o,b=tf([s,a,o],e.dtype),_=b.values,w=this.blockSize,E=0;E<s;E++)for(var S=0;S<a;S+=w)for(var C=0;C<o;C+=w)for(var x=0;x<i;x+=w)for(var T=Math.min(S+w,a),R=Math.min(C+w,o),I=Math.min(x+w,i),N=S;N<T;N++)for(var A=C;A<R;A++){for(var k=0,D=x;D<I;D++)k+=c[E*d+N*f+D*h]*u[D*m+A*g+E*v];_[E*y+(N*o+A)]+=k}return b.toTensor()},e.prototype.fusedBatchMatMul=function(e,t,n,r,i,a){var o=this.batchMatMul(e,t,n,r);return i&&(o=this.add(o,i)),a&&(o=function(e,t,n){if("linear"===t)return e.linear(n);if("relu"===t)return e.relu(n);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}(this,a,o)),o},e.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,$u(e.dtype,t.dtype),(function(e,t){return e*t}))},e.prototype.realDivide=function(e,t){return this.assertNotComplex([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",(function(e,t){return e/t}))},e.prototype.floorDiv=function(e,t){return this.assertNotComplex([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},e.prototype.sum=function(e,t){this.assertNotComplex(e,"sum"),md("sum",t,e.rank);for(var n=hd(e.shape,t),r=n[0],i=n[1],a=Md(r,$u(e.dtype,"int32")),o=ru(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=0,f=0;f<o;++f)d+=c[l+f];s[u]=d}return a},e.prototype.prod=function(e,t){this.assertNotComplex(e,"sum");for(var n=hd(e.shape,t),r=n[0],i=n[1],a=Md(r,$u(e.dtype,"int32")),o=ru(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=1,f=0;f<o;++f)d*=c[l+f];s[u]=d}return a},e.prototype.unsortedSegmentSum=function(e,t,n){this.assertNotComplex(e,"unsortedSegmentSum");for(var r=[],i=e.rank-t.rank,a=0;a<i;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var o=Rd(a,"int32"),s=Iv(o,t).asType("float32").mul(e).sum(0);r.push(s)}return Sf(r)},e.prototype.argMin=function(e,t){this.assertNotComplex(e,"argMin");var n=[t];md("argMin",n,e.rank);for(var r=hd(e.shape,n),i=r[0],a=r[1],o=Md(i,"int32"),s=ru(a),c=this.readSync(o.dataId),u=this.readSync(e.dataId),l=0;l<c.length;++l){for(var d=l*s,f=u[d],h=0,p=0;p<s;++p){var m=u[d+p];m<f&&(f=m,h=p)}c[l]=h}return o},e.prototype.argMax=function(e,t){this.assertNotComplex(e,"argMax");var n=[t];md("argMax",n,e.rank);for(var r=hd(e.shape,n),i=r[0],a=r[1],o=Md(i,"int32"),s=ru(a),c=this.readSync(o.dataId),u=this.readSync(e.dataId),l=0;l<c.length;++l){for(var d=l*s,f=u[d],h=0,p=0;p<s;++p){var m=u[d+p];m>f&&(f=m,h=p)}c[l]=h}return o},e.prototype.cumsum=function(e,t,n,r){if(this.assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=$u(e.dtype,"int32"),a=Md(e.shape,i),o=this.readSync(a.dataId),s=this.readSync(e.dataId),c=e.shape[e.rank-1],u=r?function(e,t){return e+c-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=c)for(var d=0;d<c;d++){var f=u(l,d);if(0===d)o[f]=n?0:s[f];else{var h=u(l,d-1);o[f]=n?s[h]+o[h]:s[f]+o[h]}}return a},e.prototype.equal=function(e,t){return this.assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},e.prototype.notEqual=function(e,t){return this.assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},e.prototype.less=function(e,t){return this.assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},e.prototype.lessEqual=function(e,t){return this.assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},e.prototype.greater=function(e,t){return this.assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},e.prototype.greaterEqual=function(e,t){return this.assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},e.prototype.logicalNot=function(e){this.assertNotComplex(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return Hu.make(e.shape,{values:n},"bool")},e.prototype.logicalAnd=function(e,t){return this.assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},e.prototype.logicalOr=function(e,t){return this.assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},e.prototype.select=function(e,t,n){this.assertNotComplex([e,t,n],"select");for(var r=this.readSync(e.dataId),i=this.readSync(t.dataId),a=this.readSync(n.dataId),o=Md(t.shape,$u(t.dtype,n.dtype)),s=this.readSync(o.dataId),c=0,u=0===e.rank||e.rank>1||1===t.rank?1:t.shape[1],l=0;l<r.length;l++)for(var d=0;d<u;d++)1===r[l]?s[c++]=i[l]:s[c++]=a[l];return o},e.prototype.where=function(e){this.assertNotComplex([e],"where");var t=this.readSync(e.dataId);return mh(e.shape,t)},e.prototype.topk=function(e,t,n){return this.assertNotComplex(e,"topk"),ph(this.readSync(e.dataId),e.shape,e.dtype,t)},e.prototype.min=function(e,t){this.assertNotComplex(e,"min"),md("min",t,e.rank);for(var n=hd(e.shape,t),r=n[0],i=n[1],a=Md(r,e.dtype),o=ru(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=c[l],f=0;f<o;++f){var h=c[l+f];h<d&&(d=h)}s[u]=d}return a},e.prototype.minimum=function(e,t){return this.assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},e.prototype.mod=function(e,t){return this.assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},e.prototype.max=function(e,t){this.assertNotComplex(e,"max"),md("max",t,e.rank);for(var n=hd(e.shape,t),r=n[0],i=n[1],a=Md(r,e.dtype),o=ru(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=c[l],f=0;f<o;++f){var h=c[l+f];h>d&&(d=h)}s[u]=d}return a},e.prototype.maximum=function(e,t){return this.assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},e.prototype.all=function(e,t){this.assertNotComplex(e,"all"),md("all",t,e.rank);for(var n=hd(e.shape,t),r=n[0],i=n[1],a=Md(r,e.dtype),o=ru(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=c[l],f=0;f<o;++f){var h=c[l+f];d=d&&h}s[u]=d}return a},e.prototype.any=function(e,t){this.assertNotComplex(e,"any"),md("any",t,e.rank);for(var n=hd(e.shape,t),r=n[0],i=n[1],a=Md(r,e.dtype),o=ru(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=c[l],f=0;f<o;++f){var h=c[l+f];d=d||h}s[u]=d}return a},e.prototype.squaredDifference=function(e,t){return this.assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},e.prototype.ceil=function(e){this.assertNotComplex(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return Hu.make(e.shape,{values:n})},e.prototype.floor=function(e){this.assertNotComplex(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return Hu.make(e.shape,{values:n})},e.prototype.sign=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return Hu.make(e.shape,{values:n})},e.prototype.isNaN=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return Hu.make(e.shape,{values:n},"bool")},e.prototype.isInf=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return Hu.make(e.shape,{values:n},"bool")},e.prototype.isFinite=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return Hu.make(e.shape,{values:n},"bool")},e.prototype.round=function(e){this.assertNotComplex(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=Math.floor(t[r]);t[r]-i<.5?n[r]=Math.floor(t[r]):t[r]-i>.5?n[r]=Math.ceil(t[r]):n[r]=i%2==0?i:i+1}return Hu.make(e.shape,{values:n})},e.prototype.exp=function(e){this.assertNotComplex(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return Hu.make(e.shape,{values:n})},e.prototype.expm1=function(e){this.assertNotComplex(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return Hu.make(e.shape,{values:n})},e.prototype.log=function(e){this.assertNotComplex(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log(i)}return Hu.make(e.shape,{values:n})},e.prototype.log1p=function(e){this.assertNotComplex(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log1p(i)}return Hu.make(e.shape,{values:n})},e.prototype.sqrt=function(e){this.assertNotComplex(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.sqrt(i)}return Hu.make(e.shape,{values:n})},e.prototype.rsqrt=function(e){this.assertNotComplex(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=1/Math.sqrt(i)}return Hu.make(e.shape,{values:n})},e.prototype.square=function(e){this.assertNotComplex(e,"square");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=i*i}return Hu.make(e.shape,{values:n})},e.prototype.reciprocal=function(e){this.assertNotComplex(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return Hu.make(e.shape,{values:n})},e.prototype.linear=function(e){return e},e.prototype.relu=function(e){this.assertNotComplex(e,"relu");for(var t=Md(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return t},e.prototype.prelu=function(e,t){return this.assertNotComplex([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},e.prototype.elu=function(e){this.assertNotComplex(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?i:Math.exp(i)-1}return Hu.make(e.shape,{values:t})},e.prototype.eluDer=function(e,t){this.assertNotComplex([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),i=this.readSync(e.dataId),a=0;a<r.length;++a){var o=r[a];n[a]=o>=1?i[a]:i[a]*(o+1)}return Hu.make(t.shape,{values:n})},e.prototype.selu=function(e){this.assertNotComplex(e,"selu");for(var t=Am,n=km,r=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var o=i[a];r[a]=o>=0?n*o:t*(Math.exp(o)-1)}return Hu.make(e.shape,{values:r})},e.prototype.clip=function(e,t,n){this.assertNotComplex(e,"clip");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var o=i[a];r[a]=o>n?n:o<t?t:o}return Hu.make(e.shape,{values:r})},e.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var i=n[2*r],a=n[2*r+1];t[r]=Math.hypot(i,a)}return Hu.make(e.shape,{values:t})},e.prototype.int=function(e){this.assertNotComplex(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return Hu.make(e.shape,{values:t},"int32")},e.prototype.sigmoid=function(e){this.assertNotComplex(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return Hu.make(e.shape,{values:t})},e.prototype.softplus=function(e){this.assertNotComplex(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a,o=r[i]>-t,s=r[i]<t,c=Math.exp(r[i]);a=s?c:o?r[i]:Math.log(1+c),n[i]=a}return Hu.make(e.shape,{values:n})},e.prototype.sin=function(e){this.assertNotComplex(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.cos=function(e){this.assertNotComplex(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.tan=function(e){this.assertNotComplex(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.asin=function(e){this.assertNotComplex(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.acos=function(e){this.assertNotComplex(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.atan=function(e){this.assertNotComplex(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.atan2=function(e,t){return this.assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},e.prototype.sinh=function(e){this.assertNotComplex(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.cosh=function(e){this.assertNotComplex(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.tanh=function(e){this.assertNotComplex(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=ou(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.asinh=function(e){this.assertNotComplex(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.acosh=function(e){this.assertNotComplex(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.atanh=function(e){this.assertNotComplex(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return Hu.make(e.shape,{values:t})},e.prototype.erf=function(e){this.assertNotComplex(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r],a=1/(1+.3275911*i);t[r]=1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-i*i)}return Hu.make(e.shape,{values:t})},e.prototype.step=function(e,t){void 0===t&&(t=0),this.assertNotComplex(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a=r[i];isNaN(a)?n[i]=NaN:n[i]=a>0?1:t}return Hu.make(e.shape,{values:n})},e.prototype.conv2d=function(e,t,n){this.assertNotComplex([e,t],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,c=n.padInfo.top,u=tf(n.outShape,e.dtype),l=this.readSync(e.dataId),d=this.readSync(t.dataId),f=u.values,h=0;h<n.batchSize;++h)for(var p=h*e.strides[0],m=h*u.strides[0],g=0;g<n.outHeight;++g)for(var v=m+g*u.strides[1],y=g*n.strideHeight-c,b=0;b<r;b++){var _=y+b*a;if(!(_<0||_>=n.inHeight))for(var w=b*t.strides[0],E=p+_*e.strides[1],S=0;S<n.outWidth;++S)for(var C=v+S*n.outChannels,x=S*n.strideWidth-s,T=0;T<i;T++){var R=x+T*o;if(!(R<0||R>=n.inWidth))for(var I=w+T*t.strides[1],N=E+R*n.inChannels,A=I,k=0;k<n.inChannels;++k){for(var D=l[N+k],M=0;M<n.outChannels;++M)f[C+M]+=D*d[A+M];A+=n.outChannels}}}return u.toTensor()},e.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,i=n.filterHeight,a=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,c=n.dilationWidth,u=n.padInfo.front,l=n.padInfo.left,d=n.padInfo.top,f=tf(n.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(t.dataId),m=f.values,g=0;g<n.batchSize;++g)for(var v=g*e.strides[0],y=g*f.strides[0],b=0;b<n.outDepth;++b)for(var _=y+b*f.strides[1],w=b*n.strideDepth-u,E=0;E<r;E++){var S=w+E*o;if(!(S<0||S>=n.inDepth))for(var C=E*t.strides[0],x=v+S*e.strides[1],T=0;T<n.outHeight;++T)for(var R=_+T*f.strides[2],I=T*n.strideHeight-d,N=0;N<i;N++){var A=I+N*s;if(!(A<0||A>=n.inHeight))for(var k=C+N*t.strides[1],D=x+A*e.strides[2],M=0;M<n.outWidth;++M)for(var L=R+M*n.outChannels,O=M*n.strideWidth-l,P=0;P<a;P++){var j=O+P*c;if(!(j<0||j>=n.inWidth))for(var F=k+P*t.strides[2],U=D+j*n.inChannels,B=F,V=0;V<n.inChannels;++V){for(var z=h[U+V],W=0;W<n.outChannels;++W)m[L+W]+=z*p[B+W];B+=n.outChannels}}}}return f.toTensor()},e.prototype.conv2dDerInput=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerInput");for(var r=tf(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],c=a[2],u=this.readSync(e.dataId),l=e.strides,d=l[0],f=l[1],h=l[2],p=this.readSync(t.dataId),m=t.strides,g=m[0],v=m[1],y=m[2],b=n.batchSize,_=n.filterHeight,w=n.filterWidth,E=n.inChannels,S=n.inHeight,C=n.inWidth,x=n.outChannels,T=n.outHeight,R=n.outWidth,I=n.strideHeight,N=n.strideWidth,A=_-1-n.padInfo.top,k=w-1-n.padInfo.left,D=0;D<b;++D)for(var M=0;M<E;++M)for(var L=0;L<S;++L)for(var O=L-A,P=Math.max(0,Math.ceil(O/I)),j=Math.min(T,(_+O)/I),F=0;F<C;++F){for(var U=F-k,B=Math.max(0,Math.ceil(U/N)),V=Math.min(R,(w+U)/N),z=0,W=P;W<j;++W)for(var G=W*I-O,H=B;H<V;++H)for(var Y=d*D+f*W+h*H,q=g*(_-1-G)+v*(w-1-(H*N-U))+y*M,K=0;K<x;++K)z+=u[Y+K]*p[q+K];i[o*D+s*L+c*F+M]=z}return r.toTensor()},e.prototype.conv3dDerInput=function(e,t,n){for(var r=tf(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],c=a[2],u=a[3],l=this.readSync(e.dataId),d=e.strides,f=d[0],h=d[1],p=d[2],m=d[3],g=this.readSync(t.dataId),v=t.strides,y=v[0],b=v[1],_=v[2],w=v[3],E=n.batchSize,S=n.filterDepth,C=n.filterHeight,x=n.filterWidth,T=n.inChannels,R=n.inDepth,I=n.inHeight,N=n.inWidth,A=n.outChannels,k=n.outDepth,D=n.outHeight,M=n.outWidth,L=n.strideDepth,O=n.strideHeight,P=n.strideWidth,j=S-1-n.padInfo.front,F=C-1-n.padInfo.top,U=x-1-n.padInfo.left,B=0;B<E;++B)for(var V=0;V<T;++V)for(var z=0;z<R;++z)for(var W=z-j,G=Math.max(0,Math.ceil(W/L)),H=Math.min(k,(S+W)/L),Y=0;Y<I;++Y)for(var q=Y-F,K=Math.max(0,Math.ceil(q/O)),X=Math.min(D,(C+q)/O),Q=0;Q<N;++Q){for(var J=Q-U,Z=Math.max(0,Math.ceil(J/P)),$=Math.min(M,(x+J)/P),ee=0,te=G;te<H;++te)for(var ne=te*L-W,re=K;re<X;++re)for(var ie=re*O-q,ae=Z;ae<$;++ae)for(var oe=f*B+h*te+p*re+m*ae,se=y*(S-1-ne)+b*(C-1-ie)+_*(x-1-(ae*P-J))+w*V,ce=0;ce<A;++ce)ee+=l[oe+ce]*g[se+ce];i[o*B+s*z+c*Y+u*Q+V]=ee}return r.toTensor()},e.prototype.conv2dDerFilter=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=tf(n.filterShape,"float32"),c=n.padInfo.left,u=n.padInfo.top,l=this.bufferSync(e),d=this.bufferSync(t),f=0;f<a;++f)for(var h=Math.max(0,Math.ceil((u-f)/r)),p=Math.min(n.outHeight,(n.inHeight+u-f)/r),m=0;m<o;++m)for(var g=Math.max(0,Math.ceil((c-m)/i)),v=Math.min(n.outWidth,(n.inWidth+c-m)/i),y=0;y<n.inChannels;++y)for(var b=0;b<n.outChannels;++b){for(var _=0,w=0;w<n.batchSize;++w)for(var E=h;E<p;++E)for(var S=f+E*r-u,C=g;C<v;++C){var x=m+C*i-c;_+=l.get(w,S,x,y)*d.get(w,E,C,b)}s.set(_,f,m,y,b)}return s.toTensor()},e.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,c=n.filterWidth,u=tf(n.filterShape,"float32"),l=u.values,d=u.strides,f=d[0],h=d[1],p=d[2],m=d[3],g=this.readSync(t.dataId),v=t.strides,y=v[0],b=v[1],_=v[2],w=v[3],E=this.readSync(e.dataId),S=e.strides,C=S[0],x=S[1],T=S[2],R=S[3],I=n.padInfo.front,N=n.padInfo.left,A=n.padInfo.top,k=0;k<o;++k)for(var D=Math.max(0,Math.ceil((I-k)/r)),M=Math.min(n.outDepth,(n.inDepth+I-k)/r),L=k*f,O=0;O<s;++O)for(var P=Math.max(0,Math.ceil((A-O)/i)),j=Math.min(n.outHeight,(n.inHeight+A-O)/i),F=O*h+L,U=0;U<c;++U)for(var B=Math.max(0,Math.ceil((N-U)/a)),V=Math.min(n.outWidth,(n.inWidth+N-U)/a),z=U*p+F,W=0;W<n.inChannels;++W)for(var G=W*m+z,H=0;H<n.outChannels;++H){for(var Y=0,q=0;q<n.batchSize;++q)for(var K=q*C,X=q*y,Q=D;Q<M;++Q)for(var J=(k+Q*r-I)*x+K,Z=Q*b+X,$=P;$<j;++$)for(var ee=(O+$*i-A)*T+J,te=$*_+Z,ne=B;ne<V;++ne){var re=ne*w+te;Y+=E[(U+ne*a-N)*R+ee+W]*g[re+H]}l[G+H]=Y}return u.toTensor()},e.prototype.depthwiseConv2D=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,c=n.padInfo.top,u=n.outChannels/n.inChannels,l=tf(n.outShape,e.dtype),d=this.readSync(e.dataId),f=this.readSync(t.dataId),h=l.values,p=0;p<n.batchSize;++p)for(var m=p*e.strides[0],g=p*l.strides[0],v=0;v<n.outHeight;++v)for(var y=g+v*l.strides[1],b=v*n.strideHeight-s,_=0;_<r;++_){var w=b+_*a;if(!(w<0||w>=n.inHeight))for(var E=_*t.strides[0],S=m+w*e.strides[1],C=0;C<n.outWidth;++C)for(var x=y+C*l.strides[2],T=C*n.strideWidth-c,R=0;R<i;++R){var I=T+R*o;if(!(I<0||I>=n.inWidth))for(var N=E+R*t.strides[1],A=S+I*n.inChannels,k=x,D=N,M=0;M<n.inChannels;++M){for(var L=d[A+M],O=0;O<u;++O)h[k+O]+=L*f[D+O];k+=u,D+=u}}}return l.toTensor()},e.prototype.depthwiseConv2DDerInput=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var r=tf(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],c=a[2],u=this.readSync(e.dataId),l=e.strides,d=l[0],f=l[1],h=l[2],p=this.readSync(t.dataId),m=t.strides,g=m[0],v=m[1],y=m[2],b=n.batchSize,_=n.filterHeight,w=n.filterWidth,E=n.inChannels,S=n.inHeight,C=n.inWidth,x=n.outChannels,T=n.outHeight,R=n.outWidth,I=n.strideHeight,N=n.strideWidth,A=_-1-n.padInfo.top,k=w-1-n.padInfo.left,D=x/E,M=0;M<b;++M)for(var L=0;L<E;++L)for(var O=0;O<S;++O)for(var P=O-A,j=Math.max(0,Math.ceil(P/I)),F=Math.min(T,(_+P)/I),U=0;U<C;++U){for(var B=U-k,V=Math.max(0,Math.ceil(B/N)),z=Math.min(R,(w+B)/N),W=0,G=j;G<F;++G)for(var H=G*I-P,Y=V;Y<z;++Y)for(var q=d*M+f*G+h*Y,K=g*(_-1-H)+v*(w-1-(Y*N-B))+y*L,X=0;X<D;++X)W+=u[q+(L*D+X)]*p[K+X];i[o*M+s*O+c*U+L]=W}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=tf(n.filterShape,"float32"),c=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,d=this.bufferSync(e),f=this.bufferSync(t),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((u-h)/r)),m=Math.min(n.outHeight,(n.inHeight+u-h)/r),g=0;g<o;++g)for(var v=Math.max(0,Math.ceil((c-g)/i)),y=Math.min(n.outWidth,(n.inWidth+c-g)/i),b=0;b<n.outChannels;++b){for(var _=Math.trunc(b/l),w=b%l,E=0,S=0;S<n.batchSize;++S)for(var C=p;C<m;++C)for(var x=h+C*r-u,T=v;T<y;++T){var R=g+T*i-c;E+=d.get(S,x,R,_)*f.get(S,C,T,b)}s.set(E,h,g,_,w)}return s.toTensor()},e.prototype.tile=function(e,t){return this.assertNotComplex(e,"tile"),hh(this.bufferSync(e),t)},e.prototype.pad=function(e,t,n){this.assertNotComplex(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),i=t.map((function(e){return e[0]})),a=this.bufferSync(e),o=tf(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var c=a.indexToLoc(s),u=c.map((function(e,t){return e+i[t]}));o.set.apply(o,[a.get.apply(a,c)].concat(u))}return o.toTensor()},e.prototype.transpose=function(e,t){this.assertNotComplex(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var i=this.readSync(e.dataId),a=tf(n,e.dtype),o=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=o.indexToLoc(r),c=new Array(s.length),u=0;u<c.length;u++)c[u]=s[t[u]];var l=a.locToIndex(c);a.values[l]=i[r]}return a.toTensor()},e.prototype.gather=function(e,t,n){this.assertNotComplex([e,t],"gather");var r=e.shape.slice(),i=this.readSync(t.dataId);r[n]=i.length;for(var a=tf(r,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var c=a.indexToLoc(s),u=c.slice();u[n]=i[c[n]];var l=o.locToIndex(u);a.values[s]=o.values[l]}return a.toTensor()},e.prototype.batchToSpaceND=function(e,t,n){this.assertNotComplex([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),i=Rf(e.shape,t,r),a=If(i.length,t.length),o=Nf(e.shape,t,r),s=Af(n,t.length),c=kf(o,n,t.length);return e.reshape(i).transpose(a).reshape(o).slice(s,c)},e.prototype.spaceToBatchND=function(e,t,n){this.assertNotComplex([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=Rf(o.shape,t,r,!1),c=If(s.length,t.length,!1),u=Nf(o.shape,t,r,!1);return o.reshape(s).transpose(c).reshape(u)},e.prototype.pool=function(e,t,n){this.assertNotComplex(e,"pool");for(var r=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,c=t.effectiveFilterWidth,u=t.padInfo.top,l=t.padInfo.left,d="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,f=this.readSync(e.dataId),h=tf(t.outShape,e.dtype),p=h.values,m=t.outShape[1]*t.outShape[2]*t.outShape[3],g=t.outShape[2]*t.outShape[3],v=t.outShape[3],y=0;y<t.batchSize;++y)for(var b=y*m,_=y*e.strides[0],w=0;w<t.inChannels;++w)for(var E=0;E<t.outHeight;++E)for(var S=E*r-u,C=Math.max(0,S),x=Math.min(t.inHeight,s+S),T=b+E*g,R=0;R<t.outWidth;++R){for(var I=R*i-l,N=Math.max(0,I),A=Math.min(t.inWidth,c+I),k=d,D=0,M=0,L=C;L<x;L+=a){for(var O=_+L*e.strides[1],P=N;P<A;P+=o){var j=f[O+P*e.strides[2]+w];"max"===n&&j>k?k=j:"avg"===n&&(D+=j,M++)}if(isNaN(k))break}p[T+R*v+w]="avg"===n?D/M:k}return h.toTensor()},e.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},e.prototype.maxPoolPositions=function(e,t){for(var n=tf(t.outShape,"int32"),r=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,o=t.dilationWidth,s=t.effectiveFilterHeight,c=t.effectiveFilterWidth,u=t.padInfo.top,l=t.padInfo.left,d=this.bufferSync(e),f=0;f<t.batchSize;++f)for(var h=0;h<t.inChannels;++h)for(var p=0;p<t.outHeight;++p){for(var m=p*r-u,g=m;g<0;)g+=a;for(var v=Math.min(t.inHeight,s+m),y=0;y<t.outWidth;++y){for(var b=y*i-l,_=b;_<0;)_+=o;for(var w=Math.min(t.inWidth,c+b),E=Number.NEGATIVE_INFINITY,S=-1,C=g;C<v;C+=a)for(var x=C-m,T=_;T<w;T+=o){var R=T-b,I=d.get(f,C,T,h);I>E&&(E=I,S=x*c+R)}n.set(S,f,p,y,h)}}return n.toTensor()},e.prototype.maxPoolBackprop=function(e,t,n,r){this.assertNotComplex([t,n],"maxPoolBackprop");for(var i=this.maxPoolPositions(t,r),a=r.strideHeight,o=r.strideWidth,s=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=l-1-r.padInfo.left,f=u-1-r.padInfo.top,h=tf(t.shape,"float32"),p=this.bufferSync(i),m=this.bufferSync(e),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var _=y-f,w=b-d,E=0,S=0;S<u;S+=s){var C=(_+S)/a;if(!(C<0||C>=r.outHeight||Math.floor(C)!==C))for(var x=0;x<l;x+=c){var T=(w+x)/o;if(!(T<0||T>=r.outWidth||Math.floor(T)!==T)){var R=u*l-1-p.get(g,C,T,v)===S*l+x?1:0;0!==R&&(E+=m.get(g,C,T,v)*R)}}}h.set(E,g,y,b,v)}return h.toTensor()},e.prototype.avgPoolBackprop=function(e,t,n){this.assertNotComplex([e,t],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,c=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,d=l-1-n.padInfo.left,f=u-1-n.padInfo.top,h=tf(t.shape,"float32"),p=1/(a*o),m=this.bufferSync(e),g=0;g<n.batchSize;++g)for(var v=0;v<n.inChannels;++v)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var _=y-f,w=b-d,E=0,S=0;S<u;S+=s){var C=(_+S)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var x=0;x<l;x+=c){var T=(w+x)/i;T<0||T>=n.outWidth||Math.floor(T)!==T||(E+=m.get(g,C,T,v))}}h.set(E*p,g,y,b,v)}return h.toTensor()},e.prototype.cast=function(e,t){return rh(e,t,this)},e.prototype.reshape=function(e,t){return ih(e,t)},e.prototype.avgPool=function(e,t){return this.assertNotComplex(e,"avgPool"),this.pool(e,t,"avg").toFloat()},e.prototype.resizeBilinear=function(e,t,n,r){this.assertNotComplex(e,"resizeBilinear");for(var i=e.shape,a=i[0],o=i[1],s=i[2],c=i[3],u=this.readSync(e.dataId),l=new Float32Array(ru([a,t,n,c])),d=[r&&t>1?o-1:o,r&&n>1?s-1:s],f=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0,p=d[0]/f[0],m=d[1]/f[1],g=0;g<a;g++)for(var v=0;v<t;v++)for(var y=p*v,b=Math.floor(y),_=y-b,w=Math.min(o-1,Math.ceil(y)),E=g*e.strides[0]+b*e.strides[1],S=g*e.strides[0]+w*e.strides[1],C=0;C<n;C++)for(var x=m*C,T=Math.floor(x),R=x-T,I=Math.min(s-1,Math.ceil(x)),N=E+T*e.strides[2],A=S+T*e.strides[2],k=E+ +I*e.strides[2],D=S+I*e.strides[2],M=0;M<c;M++){var L=u[N+M],O=u[A+M],P=L+(u[k+M]-L)*R,j=P+(O+(u[D+M]-O)*R-P)*_;l[h++]=j}return xd(l,[a,t,n,c])},e.prototype.resizeBilinearBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeBilinearBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],c=e.shape,u=c[1],l=c[2],d=new Float32Array(i*a*o*s),f=[n&&u>1?a-1:a,n&&l>1?o-1:o],h=[n&&u>1?u-1:u,n&&l>1?l-1:l],p=f[0]/h[0],m=f[1]/h[1],g=this.readSync(e.dataId),v=0,y=0;y<i;y++)for(var b=y*t.strides[0],_=0;_<u;_++)for(var w=_*p,E=Math.floor(w),S=Math.min(Math.ceil(w),a-1),C=b+E*t.strides[1],x=b+S*t.strides[1],T=w-E,R=1-T,I=0;I<l;I++)for(var N=I*m,A=Math.floor(N),k=Math.min(Math.ceil(N),o-1),D=N-A,M=1-D,L=C+A*t.strides[2],O=C+k*t.strides[2],P=x+A*t.strides[2],j=x+k*t.strides[2],F=R*M,U=R*D,B=T*M,V=T*D,z=0;z<s;z++){var W=g[v++];d[L+z]+=W*F,d[O+z]+=W*U,d[P+z]+=W*B,d[j+z]+=W*V}return kd(d,[i,o,a,s],t.dtype)},e.prototype.resizeNearestNeighbor=function(e,t,n,r){this.assertNotComplex(e,"resizeNearestNeighbor");for(var i=e.shape,a=i[0],o=i[1],s=i[2],c=i[3],u=this.readSync(e.dataId),l=new Float32Array(a*t*n*c),d=[r&&t>1?o-1:o,r&&n>1?s-1:s],f=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=d[0]/f[0],p=d[1]/f[1],m=0,g=0;g<a;g++)for(var v=g*e.strides[0],y=0;y<t;y++)for(var b=h*y,_=v+Math.min(o-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var E=p*w,S=_+Math.min(s-1,r?Math.round(E):Math.floor(E))*e.strides[2],C=0;C<c;C++){var x=u[S+C];l[m++]=x}return xd(l,[a,t,n,c],e.dtype)},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],c=e.shape,u=c[1],l=c[2],d=new Float32Array(i*a*o*s),f=this.readSync(e.dataId),h=[n&&u>1?a-1:a,n&&l>1?o-1:o],p=[n&&u>1?u-1:u,n&&l>1?l-1:l],m=h[0]/p[0],g=h[1]/p[1],v=1/m,y=1/g,b=2*Math.ceil(v)+2,_=2*Math.ceil(y)+2,w=0;w<i;w++)for(var E=w*t.strides[0],S=0;S<a;S++)for(var C=E+S*t.strides[1],x=Math.floor(S*v),T=Math.floor(x-b/2),R=0;R<o;R++)for(var I=C+R*t.strides[2],N=Math.floor(R*y),A=Math.floor(N-_/2),k=0;k<s;k++){for(var D=0,M=0;M<b;M++){var L=M+T;if(!(L<0||L>=u)){var O=E+L*e.strides[1],P=L*m;if(S===Math.min(a-1,n?Math.round(P):Math.floor(P)))for(var j=0;j<_;j++){var F=j+A;if(!(F<0||F>=l)){var U=O+F*e.strides[2],B=F*g;R===Math.min(o-1,n?Math.round(B):Math.floor(B))&&(D+=f[U+k])}}}}d[I+k]=D}return kd(d,t.shape,t.dtype)},e.prototype.batchNormalization=function(e,t,n,r,i,a){this.assertNotComplex([e,t,n,i,a],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=this.readSync(n.dataId),u=i?this.readSync(i.dataId):new Float32Array([1]),l=a?this.readSync(a.dataId):new Float32Array([0]),d=new Float32Array(o.length),f=l.length,h=u.length,p=c.length,m=s.length,g=0,v=0,y=0,b=0,_=0;_<o.length;++_)d[_]=l[g++]+(o[_]-s[v++])*u[y++]/Math.sqrt(c[b++]+r),g>=f&&(g=0),v>=m&&(v=0),y>=h&&(y=0),b>=p&&(b=0);return kd(d,e.shape)},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){this.assertNotComplex(e,"localResponseNormalization4D");var a=e.shape[3],o=a-1,s=this.readSync(e.dataId),c=e.size,u=new Float32Array(c);function l(e){for(var n=e%a,r=e-n+Math.max(0,n-t),i=e-n+Math.min(n+t,o),c=0;r<=i;r++){var u=s[r];c+=u*u}return c}for(var d=0;d<c;d++){var f=l(d),h=s[d]*Math.pow(n+r*f,-i);u[d]=h}return kd(u,e.shape)},e.prototype.LRNGrad=function(e,t,n,r,i,a,o){this.assertNotComplex(e,"LRNGrad");for(var s=e.shape[3],c=this.readSync(e.dataId),u=this.readSync(t.dataId),l=this.readSync(n.dataId),d=new Float32Array(e.size),f=e.size,h=0;h<f;h++){for(var p=h%s,m=h-p+Math.max(0,p-r),g=h-p+Math.min(s,p+r+1),v=0,y=m;y<g;y++)v+=Math.pow(u[y],2);for(v=a*v+i,y=m;y<g;y++){var b=-2*a*o*u[y]*l[h]/v;h===y&&(b+=Math.pow(v,-o)),b*=c[h],d[y]+=b}}return kd(d,e.shape)},e.prototype.multinomial=function(e,t,n,r){this.assertNotComplex(e,"multinomial");for(var i=t?e:Vf(e),a=i.shape[0],o=i.shape[1],s=Md([a,n],"int32"),c=this.readSync(s.dataId),u=this.readSync(i.dataId),l=0;l<a;++l){var d=l*o,f=new Float32Array(o-1);f[0]=u[d];for(var h=1;h<f.length;++h)f[h]=f[h-1]+u[d+h];for(var p=Zd(r.toString()),m=l*n,g=0;g<n;++g){var v=p();c[m+g]=f.length;for(var y=0;y<f.length;y++)if(v<f[y]){c[m+g]=y;break}}}return s},e.prototype.oneHot=function(e,t,n,r){this.assertNotComplex(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(r);for(var a=this.readSync(e.dataId),o=0;o<e.size;++o)a[o]>=0&&a[o]<t&&(i[o*t+a[o]]=n);return Nd(i,[e.size,t],"int32")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){return this.assertNotComplex(e,"nonMaxSuppression"),lh(this.readSync(e.dataId),this.readSync(t.dataId),n,r,i)},e.prototype.fft=function(e){return this.fftBatch(e,!1)},e.prototype.ifft=function(e){return this.fftBatch(e,!0)},e.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],i=tf(e.shape,"float32"),a=tf(e.shape,"float32"),o=Sd(e).as2D(n,r),s=Cd(e).as2D(n,r),c=0;c<n;c++)for(var u=o.slice([c,0],[1,r]),l=s.slice([c,0],[1,r]),d=Ed(u,l),f=this.readSync(this.fftImpl(d,t).dataId),h=0;h<r;h++){var p=sh(f,h);i.values[c*r+h]=p.real,a.values[c*r+h]=p.imag}return Ed(i.toTensor(),a.toTensor()).as2D(n,r)},e.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(i=Ed(Sd(i).div(Rd(r)),Cd(i).div(Rd(r)))),i}var a=this.readSync(e.dataId),o=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return Ed(o.real,o.imag).as2D(e.shape[0],e.shape[1])},e.prototype.isExponentOf2=function(e){return 0==(e&e-1)},e.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),i=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),o=Ed(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),c=Ed(s.real,s.imag).as1D();o=this.fftRadix2(o,i,n),c=this.fftRadix2(c,i,n);var u=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),i=0;i<Math.ceil(e/2);i++){var a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}(t,n),l=Ed(u.real,u.imag).mul(c),d=o.add(l),f=o.sub(l),h=Sd(d).concat(Sd(f)),p=Cd(d).concat(Cd(f));return Ed(h,p).as1D()},e.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),i=0;i<t;i++){for(var a=0,o=0,s=0;s<t;s++){var c=uh(i*s,t,n),u=sh(e,s);a+=u.real*c.real-u.imag*c.imag,o+=u.real*c.imag+u.imag*c.real}n&&(a/=t,o/=t),ch(r,a,o,i)}return r},e.prototype.depthToSpace=function(e,t,n){$c("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),$c(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],i=e.shape[1],a=e.shape[2],o=e.shape[3],s=i*t,c=a*t,u=o/(t*t),l=this.readSync(e.dataId),d=new Float32Array(r*s*c*u),f=0,h=0;h<r;++h)for(var p=0;p<s;++p)for(var m=Math.floor(p/t),g=p%t,v=0;v<c;++v)for(var y=Math.floor(v/t),b=(g*t+v%t)*u,_=0;_<u;++_){var w=_+b+o*(y+a*(m+i*h));d[f++]=l[w]}return kd(d,[r,s,c,u])},e.prototype.broadcastedBinaryOp=function(e,t,n,r){var i=Yf(e.shape,t.shape),a=tf(i,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=Gf(e.shape,i),u=Gf(t.shape,i),l=a.values;if(c.length+u.length===0)for(var d=0;d<l.length;++d)l[d]=r(o[d%o.length],s[d%s.length]);else{var f=this.bufferSync(e),h=this.bufferSync(t),p=function(n){var i=a.indexToLoc(n),d=i.slice(-e.rank);c.forEach((function(e){return d[e]=0}));var p=f.locToIndex(d),m=i.slice(-t.rank);u.forEach((function(e){return m[e]=0}));var g=h.locToIndex(m);l[n]=r(o[p],s[g])};for(d=0;d<l.length;++d)p(d)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=Yf(e.shape,t.shape),i=tf(r,"float32"),a=tf(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=Gf(e.shape,r),u=Gf(t.shape,r),l=i.values,d=a.values;if(c.length+u.length===0)for(var f=0;f<l.length;f++){var h=f%o.length,p=f%s.length,m=n(o[2*h],o[2*h+1],s[2*p],s[2*p+1]);l[f]=m.real,d[f]=m.imag}else{var g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=i.indexToLoc(r),f=a.slice(-e.rank);c.forEach((function(e){return f[e]=0}));var h=g.locToIndex(f),p=a.slice(-t.rank);u.forEach((function(e){return p[e]=0}));var m=v.locToIndex(p),y=n(o[2*h],o[2*h+1],s[2*m],s[2*m+1]);l[r]=y.real,d[r]=y.imag};for(f=0;f<l.length;f++)y(f)}return this.complex(i.toTensor(),a.toTensor())},e.prototype.split=function(e,t,n){return fh(e,t,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(e,t,n,r,i,a){for(var o=e.shape,s=o[0],c=o[1],u=o[2],l=o[3],d=t.shape[0],f=r[0],h=r[1],p=tf([d,f,h,l],e.dtype),m=this.readSync(t.dataId),g=this.readSync(n.dataId),v=this.readSync(e.dataId),y=e.strides,b=p.strides,_=0;_<d;_++){var w=4*_,E=m[w],S=m[w+1],C=m[w+2],x=m[w+3],T=g[_];if(!(T>=s))for(var R=f>1?(C-E)*(c-1)/(f-1):0,I=h>1?(x-S)*(u-1)/(h-1):0,N=0;N<f;N++){var A=f>1?E*(c-1)+N*R:.5*(E+C)*(c-1);if(A<0||A>c-1)for(var k=0;k<h;k++)for(var D=0;D<l;D++){var M=D+k*b[2]+N*b[1]+_*b[0];p.values[M]=a}else if("bilinear"===i){var L=Math.floor(A),O=Math.ceil(A),P=A-L;for(k=0;k<h;k++)if((H=h>1?S*(u-1)+k*I:.5*(S+x)*(u-1))<0||H>u-1)for(D=0;D<l;D++)M=D+k*b[2]+N*b[1]+_*b[0],p.values[M]=a;else{var j=Math.floor(H),F=Math.ceil(H),U=H-j;for(D=0;D<l;D++){var B=v[M=D+j*y[2]+L*y[1]+T*y[0]],V=v[M=D+F*y[2]+L*y[1]+T*y[0]],z=v[M=D+j*y[2]+O*y[1]+T*y[0]],W=B+(V-B)*U,G=z+(v[M=D+F*y[2]+O*y[1]+T*y[0]]-z)*U;M=D+k*b[2]+N*b[1]+_*b[0],p.values[M]=W+(G-W)*P}}}else for(k=0;k<h;++k){var H;if((H=h>1?S*(u-1)+k*I:.5*(S+x)*(u-1))<0||H>u-1)for(D=0;D<l;D++)M=D+k*b[2]+N*b[1]+_*b[0],p.values[M]=a;else{var Y=Math.round(H),q=Math.round(A);for(D=0;D<l;D++){var K=D+Y*y[2]+q*y[1]+T*y[0],X=D+k*b[2]+N*b[1]+_*b[0];p.values[X]=v[K]}}}}}return p.toTensor()},e.prototype.sparseToDense=function(e,t,n,r){var i=Lf(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.sliceSize,c=i.strides,u=i.outputSize;return this.scatter(e,t,n,u,s,o,a,c,r,!1)},e.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=Df(e,t),a=i[0],o=i[1],s=i[2],c=i[3];if(0===o)return xd([],a,e.dtype);for(var u=new Vu([o,s],e.dtype),l=this.readSync(t.dataId),d=this.readSync(e.dataId),f=0;f<o;f++){for(var h=[],p=0,m=0;m<r;m++){var g=l[f*r+m];p+=g*c[m],h.push(g)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+h+" does not index into "+e.shape);for(var v=0;v<s;v++)u.values[f*s+v]=d[p*s+v]}return u.toTensor().reshape(a)},e.prototype.scatterND=function(e,t,n){var r=Lf(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,c=r.outputSize,u=Rd(0);return this.scatter(e,t,n,c,o,a,i,s,u,!0)},e.prototype.fill=function(e,t,n){var r=pu(n=n||xu(t),ru(e));return r.fill(t),Hu.make(e,{values:r},n)},e.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},e.prototype.zerosLike=function(e){var t=pu(e.dtype,ru(e.shape));return Hu.make(e.shape,{values:t},e.dtype)},e.prototype.linspace=function(e,t,n){return ah(e,t,n)},e.prototype.scatter=function(e,t,n,r,i,a,o,s,c,u){var l=[r/i,i],d=this.readSync(e.dataId),f=this.readSync(t.dataId);if(0===r)return xd([],n,t.dtype);var h=new Vu(l,t.dtype);h.values.fill(this.readSync(c.dataId)[0]);for(var p=0;p<a;p++){for(var m=[],g=0,v=0;v<o;v++){var y=d[p*o+v];m.push(y),g+=y*s[v]}if(g<0||g>=r/i)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<i;b++)u?h.values[g*i+b]+=f[p*i+b]:h.values[g*i+b]=0===t.rank?f[0]:f[p*i+b]}return h.toTensor().reshape(n)},e}();sl.registerBackend("cpu",(function(){return new hb}),1);var pb=function(){function e(){this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder}return e.prototype.encodeUTF8=function(e){return this.textEncoder.encode(e)},e.prototype.decodeUTF8=function(e){return this.textDecoder.decode(e)},e.prototype.fetch=function(e,t){return fetch(e,t)},e}();qc.get("IS_BROWSER")&&qc.setPlatform("browser",new pb);var mb,gb=function(){function e(){var e=n(745);this.textEncoder=new e.TextEncoder,this.textDecoder=new e.TextDecoder}return e.prototype.encodeUTF8=function(e){return this.textEncoder.encode(e)},e.prototype.decodeUTF8=function(e){return 0===e.length?"":this.textDecoder.decode(e)},e.prototype.fetch=function(e,t){return null!=qc.global.fetch?qc.global.fetch(e,t):(null==mb&&(mb=n(7318)),mb(e,t))},e}();qc.get("IS_NODE")&&qc.setPlatform("node",new gb);var vb={float32:4,int32:4,uint16:2,uint8:1,bool:1};function yb(e,t){for(var n={},r=0,i=function(t){var i=t.name,a=t.dtype,o=t.shape,s=ru(o),c=void 0;if("quantization"in t){var u=t.quantization;if("uint8"!==u.dtype&&"uint16"!==u.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+u.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=vb[u.dtype],d=e.slice(r,r+s*l),f="uint8"===u.dtype?new Uint8Array(d):new Uint16Array(d);if("float32"===a)c=Float32Array.from(f,(function(e){return e*u.scale+u.min}));else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);c=Int32Array.from(f,(function(e){return Math.round(e*u.scale+u.min)}))}r+=s*l}else if("string"===a){var h=t,p=new Uint8Array(e.slice(r,r+h.byteLength));c=qc.platform.decodeUTF8(p).split(h.delimiter),r+=h.byteLength}else{var m=vb[a];if(d=e.slice(r,r+s*m),"float32"===a)c=new Float32Array(d);else if("int32"===a)c=new Int32Array(d);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);c=new Uint8Array(d)}r+=s*m}n[i]=xd(c,o,a)},a=0,o=t;a<o.length;a++)i(o[a]);return n}function bb(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),i=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),i),i+=e.byteLength})),r.buffer}var _b="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function wb(e){return _b?Buffer.byteLength(e):new Blob([e]).size}function Eb(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Sb(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function Cb(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:wb(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:wb(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var xb=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var i=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&i.push(n)})),i},e}(),Tb="://",Rb=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){$c(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(Tb)&&(t=t.slice(0,t.indexOf(Tb))),$c(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();$c(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function Ib(e){if(-1===e.indexOf(Tb))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Rb.getSchemes().join(","));return{scheme:e.split(Tb)[0],path:e.split(Tb)[1]}}function Nb(e,t,n){return void 0===n&&(n=!1),Wc(this,void 0,void 0,(function(){var r,i,a,o,s,c,u,l,d;return Gc(this,(function(f){switch(f.label){case 0:return $c(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),$c((r=xb.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),$c(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),i=r[0],$c((a=xb.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),$c(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."})),o=a[0],s=Ib(e).scheme,c=Ib(e).path,u=s===Ib(e).scheme,[4,i.load()];case 1:return l=f.sent(),n&&u?[4,Rb.getManager(s).removeModel(c)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,o.save(l)];case 4:return d=f.sent(),!n||u?[3,6]:[4,Rb.getManager(s).removeModel(c)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}}))}))}var Ab="models_store",kb="model_info_store";function Db(){if(!qc.getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Mb(e){var t=e.result;t.createObjectStore(Ab,{keyPath:"modelPath"}),t.createObjectStore(kb,{keyPath:"modelPath"})}var Lb=function(){function e(e){if(this.indexedDB=Db(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Mb(i)},i.onsuccess=function(){var a=i.result;if(null==t){var o=a.transaction(Ab,"readonly"),s=o.objectStore(Ab).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},o.oncomplete=function(){return a.close()}}else{var c,u=Cb(t),l=a.transaction(kb,"readwrite"),d=l.objectStore(kb),f=d.put({modelPath:n.modelPath,modelArtifactsInfo:u});f.onsuccess=function(){var i=(c=a.transaction(Ab,"readwrite")).objectStore(Ab).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:u});i.onsuccess=function(){return e({modelArtifactsInfo:u})},i.onerror=function(e){var t=(d=l.objectStore(kb)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(i.error)},t.onerror=function(e){return a.close(),r(i.error)}}},f.onerror=function(e){return a.close(),r(f.error)},l.oncomplete=function(){null==c?a.close():c.oncomplete=function(){return a.close()}}}},i.onerror=function(e){return r(i.error)}}))},e.URL_SCHEME="indexeddb://",e}(),Ob=function(e){return qc.getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Lb.URL_SCHEME)?(t=e.slice(Lb.URL_SCHEME.length),new Lb(t)):null;var t};xb.registerSaveRouter(Ob),xb.registerLoadRouter(Ob);var Pb=function(){function e(){this.indexedDB=Db()}return e.prototype.listModels=function(){return Wc(this,void 0,void 0,(function(){var e=this;return Gc(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return Mb(r)},r.onsuccess=function(){var e=r.result,i=e.transaction(kb,"readonly"),a=i.objectStore(kb).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var i=r[n];e[i.modelPath]=i.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},i.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return Wc(this,void 0,void 0,(function(){var t=this;return Gc(this,(function(n){var r;return e=(r=e).startsWith(Lb.URL_SCHEME)?r.slice(Lb.URL_SCHEME.length):r,[2,new Promise((function(n,r){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Mb(i)},i.onsuccess=function(){var t,a=i.result,o=a.transaction(kb,"readwrite"),s=o.objectStore(kb),c=s.get(e);c.onsuccess=function(){if(null==c.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var i=s.delete(e),o=function(){var i=(t=a.transaction(Ab,"readwrite")).objectStore(Ab).delete(e);i.onsuccess=function(){return n(c.result.modelArtifactsInfo)},i.onerror=function(e){return r(c.error)}};i.onsuccess=o,i.onerror=function(e){return o(),a.close(),r(c.error)}},c.onerror=function(e){return a.close(),r(c.error)},o.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},i.onerror=function(e){return r(i.error)}}))]}))}))},e}();if(qc.getBool("IS_BROWSER"))try{Rb.registerManager(Lb.URL_SCHEME,new Pb)}catch(ps){}var jb="/",Fb="tensorflowjs_models",Ub="info",Bb="model_topology",Vb="weight_specs",zb="weight_data",Wb="model_metadata";function Gb(e){return{info:[Fb,e,Ub].join(jb),topology:[Fb,e,Bb].join(jb),weightSpecs:[Fb,e,Vb].join(jb),weightData:[Fb,e,zb].join(jb),modelMetadata:[Fb,e,Wb].join(jb)}}function Hb(e){var t=e.split(jb);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(jb)}var Yb=function(){function e(e){if(!qc.getBool("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Gb(this.modelPath)}return e.prototype.save=function(e){return Wc(this,void 0,void 0,(function(){var t,n,r;return Gc(this,(function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=Cb(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,(a=e.weightData,_b?Buffer.from(a).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(a))))),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}var a}))}))},e.prototype.load=function(){return Wc(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return Gc(this,(function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy),null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(_b){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r.set([n.charCodeAt(i)],i);return r.buffer}(o),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),qb=function(e){return qc.getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Yb.URL_SCHEME)?(t=e.slice(Yb.URL_SCHEME.length),new Yb(t)):null;var t};xb.registerSaveRouter(qb),xb.registerLoadRouter(qb);var Kb=function(){function e(){$c(qc.getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),$c(void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return Wc(this,void 0,void 0,(function(){var e,t,n,r,i,a;return Gc(this,(function(o){for(e={},t=Fb+jb,n=jb+Ub,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(t)&&i.endsWith(n)&&(a=Hb(i),e[a]=JSON.parse(this.LS.getItem(i)));return[2,e]}))}))},e.prototype.removeModel=function(e){return Wc(this,void 0,void 0,(function(){var t,n;return Gc(this,(function(r){var i;if(e=(i=e).startsWith(Yb.URL_SCHEME)?i.slice(Yb.URL_SCHEME.length):i,t=Gb(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(qc.getBool("IS_BROWSER"))try{Rb.registerManager(Yb.URL_SCHEME,new Kb)}catch(ps){}function Xb(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Qb=function(){function e(t){if(!qc.getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return Wc(this,void 0,void 0,(function(){var t,n,r,i,a,o;return Gc(this,(function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,Xb((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return s.sent(),null==e.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=t,[4,Xb((function(){return o.dispatchEvent(new MouseEvent("click"))}))]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:Cb(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),Jb=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return Wc(this,void 0,void 0,(function(){var e,t,n=this;return Gc(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,i){var a=new FileReader;a.onload=function(a){var o=JSON.parse(a.target.result),s=o.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var c=o.weightsManifest;if(null!=c){var u;try{u=n.checkManifestAndWeightFiles(c,t)}catch(e){return void i(e)}var l=[],d=[],f=[];c.forEach((function(e){e.paths.forEach((function(e){d.push(e),f.push(null)})),l.push.apply(l,e.weights)})),c.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,i=d.indexOf(e);f[i]=n,-1===f.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:Eb(f)})},t.onerror=function(t){return i("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(u[e])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return Sb(e.name)})),i={},a=0,o=e;a<o.length;a++)o[a].paths.forEach((function(e){var a=Sb(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");i[e]=t[r.indexOf(a)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return i},e}();function Zb(e,t,n,r){!function(e){$c(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){$c(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),$c(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),$c(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function $b(e,t){return Wc(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l;return Gc(this,(function(d){switch(d.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?Ou:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit)})),i=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return o=d.sent(),[3,4];case 2:return[4,Zb(r,t.onProgress,i,a)];case 3:o=d.sent(),d.label=4;case 4:return s=o.map((function(e){return e.arrayBuffer()})),c=.5,u=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,Zb(s,t.onProgress,c,u)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}}))}))}function e_(e){var t=this;return function(n,r,i){return void 0===r&&(r=""),Wc(t,void 0,void 0,(function(){var t,a,o,s,c,u,l,d,f,h;return Gc(this,(function(p){switch(p.label){case 0:if(t=n.map((function(){return!1})),a={},o=null!=i?i.map((function(){return!1})):[],s=[],n.forEach((function(e,n){var r=0;e.weights.forEach((function(e){var c="quantization"in e?e.quantization.dtype:e.dtype,u=vb[c]*ru(e.shape),l=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:u})};null!=i?i.forEach((function(t,n){t===e.name&&(l(),o[n]=!0)})):l(),s.push(e.name),r+=u}))})),!o.every((function(e){return e})))throw c=i.filter((function(e,t){return!o[t]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return u=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),l=[],u.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;l.push(t)}))})),[4,e(l)];case 1:return d=p.sent(),f={},h=0,u.forEach((function(e){for(var t=n[e].paths.length,r=0,i=0;i<t;i++)r+=d[h+i].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),c=0,u=0;u<t;u++){var l=new Uint8Array(d[h+u]);s.set(l,c),c+=l.byteLength}a[e].forEach((function(e){var t=yb(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)f[n]=t[n]})),h+=t})),[2,f]}}))}))}}xb.registerSaveRouter((function(e){return qc.getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Qb.URL_SCHEME)?(void 0===(t=e.slice(Qb.URL_SCHEME.length))&&(t="model"),new Qb(t)):null;var t}));var t_=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?($c("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=Ou,$c(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&$c(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return Wc(this,void 0,void 0,(function(){var t,n,r,i;return Gc(this,(function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:Cb(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},e.prototype.load=function(){return Wc(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,s;return Gc(this,(function(c){switch(c.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=c.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");c.label=2;case 2:return c.trys.push([2,4,,5]),[4,e.json()];case 3:return t=c.sent(),[3,5];case 4:throw c.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,i=t.weightsManifest,null==r&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:s=c.sent(),a=s[0],o=s[1],c.label=7;case 7:return[2,{modelTopology:r,weightSpecs:a,weightData:o}]}}))}))},e.prototype.loadWeights=function(e){return Wc(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l,d;return Gc(this,(function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],i=n[1],a=this.weightPathPrefix||r,o=[],s=0,c=e;s<c.length;s++)u=c[s],o.push.apply(o,u.weights);return l=[],e.forEach((function(e){e.paths.forEach((function(e){l.push(a+e+i)}))})),[4,$b(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=f.sent(),[2,[o,Eb(d)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function n_(e){return null!=e.match(t_.URL_SCHEME_REGEX)}var r_=function(e,t){return(Array.isArray(e)?e.every((function(e){return n_(e)})):n_(e))?i_(e,{onProgress:t}):null};function i_(e,t){return new t_(e,t)}xb.registerSaveRouter(r_),xb.registerLoadRouter(r_);var a_=function(){function e(e,t,n,r){this.modelTopology=e,this.weightSpecs=t,this.weightData=n,this.trainingConfig=r}return e.prototype.load=function(){return Wc(this,void 0,void 0,(function(){var e;return Gc(this,(function(t){return e={},null!=this.modelTopology&&(e=zc({modelTopology:this.modelTopology},e)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(e=zc({weightSpecs:this.weightSpecs},e)),null!=this.weightData&&this.weightData.byteLength>0&&(e=zc({weightData:this.weightData},e)),null!=this.trainingConfig&&(e=zc({trainingConfig:this.trainingConfig},e)),[2,e]}))}))},e}(),o_=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),s_=(Object.freeze({browserFiles:function(e){return new Jb(e)},browserHTTPRequest:function(e,t){return i_(e,t)},concatenateArrayBuffers:Eb,decodeWeights:yb,encodeWeights:function(e,t){return Wc(this,void 0,void 0,(function(){var n,r,i,a,o,s=this;return Gc(this,(function(c){switch(c.label){case 0:for(n=[],r=[],i=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),a=function(a){var o=i[a],c=Array.isArray(e)?e[a].tensor:e[o];if("float32"!==c.dtype&&"int32"!==c.dtype&&"bool"!==c.dtype&&"string"!==c.dtype)throw new Error("Unsupported dtype in weight '"+o+"': "+c.dtype);var u={name:o,shape:c.shape,dtype:c.dtype};if("string"===c.dtype){var l=new Promise((function(e){return Wc(s,void 0,void 0,(function(){var t,n,r;return Gc(this,(function(i){switch(i.label){case 0:return t=u,[4,c.data()];case 1:return n=i.sent(),r=qc.platform.encodeUTF8(n.join("\0")),t.byteLength=r.length,t.delimiter="\0",e(r),[2]}}))}))}));r.push(l)}else r.push(c.data());null!=t&&(u.group=t),n.push(u)},o=0;o<i.length;++o)a(o);return[4,Promise.all(r)];case 1:return[2,{data:bb(c.sent()),specs:n}]}}))}))},fromMemory:function(e,t,n,r){return new a_(e,t,n,r)},getLoadHandlers:function(e,t){return xb.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:Cb,getSaveHandlers:function(e){return xb.getSaveHandlers(e)},http:i_,isHTTPScheme:n_,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),Wc(this,void 0,void 0,(function(){return Gc(this,(function(i){return[2,e_((function(e){return $b(e,{requestInit:r})}))(e,t,n)]}))}))},registerLoadRouter:function(e){return xb.registerLoadRouter(e)},registerSaveRouter:function(e){return xb.registerSaveRouter(e)},weightsLoaderFactory:e_,withSaveHandler:function(e){return new o_(e)},copyModel:function(e,t){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(n){return[2,Nb(e,t,!1)]}))}))},listModels:function(){return Wc(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return Gc(this,(function(s){switch(s.label){case 0:e=Rb.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(i=r[n],[4,Rb.getManager(i).listModels()]):[3,4];case 2:for(o in a=s.sent())t[i+Tb+o]=a[o];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(n){return[2,Nb(e,t,!0)]}))}))},removeModel:function(e){return Wc(this,void 0,void 0,(function(){var t;return Gc(this,(function(n){return t=Ib(e),[2,Rb.getManager(t.scheme).removeModel(t.path)]}))}))}}),wd({confusionMatrix_:function(e,t,n){var r=ud(e,"labels","confusionMatrix"),i=ud(t,"predictions","confusionMatrix");$c(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),$c(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),$c(1===i.rank,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),$c(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),$c(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=df(r.asType("int32"),n),o=df(i.asType("int32"),n);return a.transpose().matMul(o).asType("int32")}})),c_=(Object.freeze({confusionMatrix:s_}),wd({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return sl.fromPixels(e,t)}})),u_=Object.freeze({toPixels:function(e,t){return Wc(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w,E,S,C;return Gc(this,(function(x){switch(x.label){case 0:if(n=ud(e,"img","toPixels"),e instanceof Hu||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],a=r[1],(o=2===n.rank?1:n.shape[2])>4||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return s=x.sent(),c=n.min(),u=n.max(),[4,Promise.all([c.data(),u.data()])];case 2:if(l=x.sent(),d=l[0],f=l[1],h=d[0],p=f[0],c.dispose(),u.dispose(),"float32"===n.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(m="float32"===n.dtype?255:1,g=new Uint8ClampedArray(a*i*4),v=0;v<i*a;++v)y=void 0,b=void 0,_=void 0,w=void 0,1===o?(y=s[v]*m,b=s[v]*m,_=s[v]*m,w=255):3===o?(y=s[3*v]*m,b=s[3*v+1]*m,_=s[3*v+2]*m,w=255):4===o&&(y=s[4*v]*m,b=s[4*v+1]*m,_=s[4*v+2]*m,w=s[4*v+3]*m),g[0+(E=4*v)]=Math.round(y),g[E+1]=Math.round(b),g[E+2]=Math.round(_),g[E+3]=Math.round(w);return null!=t&&(t.width=a,t.height=i,S=t.getContext("2d"),C=new ImageData(g,a,i),S.putImageData(C,0,0)),n!==e&&n.dispose(),[2,g]}}))}))},fromPixels:c_}),l_=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),d_=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function f_(e){$c(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),$c("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),$c(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),d_.register(e)}Object.freeze({Serializable:l_,SerializationMap:d_,registerClass:f_});function h_(){return 32===sl.backend.floatPrecision()?.001:.1}function p_(e,t,n){var r=!0;if((bu(e)||bu(t))&&(r=!1),bu(e)&&bu(t)&&(r=!0),r){var i=e.constructor.name,a=t.constructor.name;if(i!==a)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var o=sd(e),s=sd(t);if(!iu(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var c=bu(e)?e:nu(e),u=bu(t)?t:nu(t);if(c.length!==u.length)throw new Error("Arrays have different lengths actual: "+c.length+" vs expected: "+u.length+".\nActual:   "+c+".\nExpected: "+u+".");for(var l=0;l<u.length;++l){var d=c[l],f=u[l];if(!n(d,f))throw new Error("Arrays differ: actual["+l+"] = "+d+", expected["+l+"] = "+f+".\nActual:   "+c+".\nExpected: "+u+".")}}function m_(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=h_()),p_(e,t,(function(e,t){return m_(e,t,n)}))},testEpsilon:h_,expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Eu(e)||Eu(e[0])||Eu(t)||Eu(t[0])?p_(e,n,(function(e,t){return e==t})):p_(e,t,(function(e,t){return m_(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=h_()),!m_(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:qp,webgl_util:nd,MathBackendWebGL:Ym,setWebGLContext:dl,GPGPUContext:Kp});var g_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Vc(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),i=r.value,a=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:a[e.name]}}));this.applyGradients(o)}else this.applyGradients(a);return ad(a),t?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){$c(Tu(e),(function(){return"The f passed in variableGrads(f) must be a function"})),$c(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Yu})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],sl.registeredVariables)t.push(sl.registeredVariables[r]);var i=n?t.filter((function(e){return!e.trainable})):null,a=t.length;$c((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var o=sl.gradients(e,t,null,!0),s=o.value,c=o.grads;$c(c.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),$c(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var u={};return t.forEach((function(e,t){null!=c[t]&&(u[e.name]=c[t])})),null!=i&&i.forEach((function(e){return u[e.name]=null})),{value:s,grads:u}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&ad(this.iterations_)},t.prototype.saveIterations=function(){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Rd(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return Wc(this,void 0,void 0,(function(){var t;return Gc(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},t}(l_);Object.defineProperty(g_,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var v_=function(e){function t(t,n,r){void 0===r&&(r=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=r,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==r&&(i.epsilon=sl.backend.epsilon()),i}return Vc(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=sl.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:id((function(){return jd(i).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:id((function(){return jd(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;id((function(){var e=o.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var c=n.mul(-t.learningRate).add(i);i.assign(c)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(ad(this.accumulatedGrads.map((function(e){return e.variable}))),ad(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return Wc(this,void 0,void 0,(function(){var e;return Gc(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Wc(this,void 0,void 0,(function(){var t;return Gc(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="AdadeltaOptimizer",t}(g_);f_(v_);var y_=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return Vc(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=sl.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:id((function(){return Ld(i.shape,t.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable;id((function(){var e=o.add(a.square());o.assign(e);var n=a.div(e.add(sl.backend.epsilon()).sqrt()).mul(-t.learningRate).add(i);i.assign(n)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&ad(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(g_);f_(y_);var b_=function(e){function t(t,n,r,i){void 0===i&&(i=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],id((function(){a.accBeta1=Rd(n).variable(),a.accBeta2=Rd(r).variable()})),null==i&&(a.epsilon=sl.backend.epsilon()),a}return Vc(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);id((function(){var r=ay(1,t.accBeta1),i=ay(1,t.accBeta2);n.forEach((function(n,a){var o=sl.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:id((function(){return jd(o).variable(!1)}))}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:id((function(){return jd(o).variable(!1)}))});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var c=t.accumulatedFirstMoment[a].variable,u=t.accumulatedSecondMoment[a].variable,l=c.mul(t.beta1).add(s.mul(1-t.beta1)),d=u.mul(t.beta2).add(s.square().mul(1-t.beta2)),f=l.div(r),h=d.div(i);c.assign(l),u.assign(d);var p=f.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(p)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&ad(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&ad(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Wc(this,void 0,void 0,(function(){var e;return Gc(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Wc(this,void 0,void 0,(function(){var t,n=this;return Gc(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),id((function(){n.accBeta1.assign(ty(n.beta1,n.iterations_+1)),n.accBeta2.assign(ty(n.beta2,n.iterations_+1))})),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(g_);f_(b_);var __=function(e){function t(t,n,r,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=i,o.decay=a,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],id((function(){o.iteration=Rd(0).variable(),o.accBeta1=Rd(n).variable()})),null==i&&(o.epsilon=sl.backend.epsilon()),o}return Vc(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);id((function(){var r=ay(1,t.accBeta1),i=Gv(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,a){var o=sl.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:jd(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:jd(o).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var c=t.accumulatedFirstMoment[a].variable,u=t.accumulatedWeightedInfNorm[a].variable,l=c.mul(t.beta1).add(s.mul(1-t.beta1)),d=u.mul(t.beta2),f=s.abs(),h=d.maximum(f);c.assign(l),u.assign(h);var p=i.div(r).mul(l.div(h.add(t.epsilon))).add(o);o.assign(p)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&ad(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&ad(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(g_);f_(__);var w_=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Vc(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var a=sl.registeredVariables[n];id((function(){var e=t.c.mul(i).add(a);a.assign(e)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return sl.keep(e)}(Rd(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(g_);f_(w_);var E_=function(e){function t(t,n,r){void 0===r&&(r=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=Rd(i.momentum),i}return Vc(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=sl.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:id((function(){return jd(i).variable(!1)}))});var a=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&id((function(){var e,n=t.m.mul(a).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(i):t.c.mul(n).add(i),a.assign(n),i.assign(e)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&ad(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Wc(this,void 0,void 0,(function(){return Gc(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="MomentumOptimizer",t}(w_);f_(E_);var S_=function(e){function t(t,n,r,i,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===a&&(a=!1);var o=e.call(this)||this;return o.learningRate=t,o.decay=n,o.momentum=r,o.epsilon=i,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=a,null==i&&(o.epsilon=sl.backend.epsilon()),o}return Vc(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=sl.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:id((function(){return jd(i).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:id((function(){return jd(i).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:id((function(){return jd(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;id((function(){var e=o.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,c=n.mul(t.decay).add(a.mul(1-t.decay)),u=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(c.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(c),s.assign(u);var l=i.sub(u);i.assign(l)}else{var d=o.mul(t.decay).add(a.square().mul(1-t.decay));u=s.mul(t.momentum).add(a.mul(t.learningRate).div(d.add(t.epsilon).sqrt())),o.assign(d),s.assign(u),l=i.sub(u),i.assign(l)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&ad(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&ad(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&ad(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Wc(this,void 0,void 0,(function(){var e;return Gc(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Wc(this,void 0,void 0,(function(){var t;return Gc(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(g_);f_(S_);var C_=function(){function e(){}return e.sgd=function(e){return new w_(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new E_(e,t,n)},e.rmsprop=function(e,t,n,r,i){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new S_(e,t,n,r,i)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new b_(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new v_(e,t,n)},e.adamax=function(e,t,n,r,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new __(e,t,n,r,i)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new y_(e,t)},e}();C_.sgd,C_.momentum,C_.adadelta,C_.adagrad,C_.rmsprop,C_.adamax,C_.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;Wu=fb;var x_=function(e,t){return(x_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function T_(e,t){function n(){this.constructor=e}x_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function R_(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,s)}c((r=r.apply(e,t||[])).next())}))}function I_(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var N_=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0],i=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,i)}))}},e}();function A_(){return k_}var k_=null,D_=new Map,M_=new Map;function L_(e,t){var n=U_(e,t);return D_.get(n)}function O_(e){return M_.get(e)}function P_(e){for(var t=D_.entries(),n=[];;){var r=t.next(),i=r.done,a=r.value;if(i)break;var o=a[0],s=a[1];o.split("_")[0]===e&&n.push(s)}return n}function j_(e){var t=e.kernelName,n=e.backendName,r=U_(t,n);if(D_.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");D_.set(r,e)}function F_(e){var t=e.kernelName;M_.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),M_.set(t,e)}function U_(e,t){return t+"_"+e}function B_(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function V_(e,t,n){return Math.max(e,Math.min(t,n))}function z_(e){return e%2==0?e:e+1}function W_(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function G_(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function H_(e,t,n){void 0===n&&(n=""),G_(X_(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function Y_(e){G_(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function q_(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||uw(e)&&!n)for(var r=0;r<e.length;++r)q_(e[r],t,n);else t.push(e);return t}function K_(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function X_(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Q_(e){return e%1==0}function J_(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Z_(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function $_(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function ew(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var a=0,o=function(){if(e())r();else{a++;var s=t(a);null!=n&&a>=n?i():setTimeout(o,s)}};o()}))}function tw(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var a=e.slice();return a[r]=t/n,a}function nw(e,t){var n=t.length;return G_((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),G_(e.every((function(e){return Q_(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function rw(e,t){for(var n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,a=null==t||i?null:nw(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=a){if(a[o]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==a[o]||a[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),a[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function iw(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function aw(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function ow(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function sw(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function cw(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function uw(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function lw(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function dw(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function fw(e){return"string"==typeof e||e instanceof String}function hw(e){return"boolean"==typeof e}function pw(e){return"number"==typeof e}function mw(e){return Array.isArray(e)?mw(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":pw(e)?"float32":fw(e)?"string":hw(e)?"bool":"float32"}function gw(e){return!!(e&&e.constructor&&e.call&&e.apply)}function vw(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function yw(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function bw(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=q_(e)),n&&ow(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}function _w(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var i=new Array;if(1===n.length)for(var a=n[0],o=0;o<a;o++)i[o]=r[t+o];else{a=n[0];var s=n.slice(1),c=s.reduce((function(e,t){return e*t}));for(o=0;o<a;o++)i[o]=e(t+o*c,s,r)}return i}(0,e,t)}function ww(e,t){for(var n=Ew(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Ew(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function Sw(){return A_().platform.now()}function Cw(e){e.forEach((function(t){G_(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function xw(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",A_().platform.encode(e,t)}function Tw(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",A_().platform.decode(e,t)}function Rw(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function Iw(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}Object.freeze({shuffle:B_,clamp:V_,nearestLargerEven:z_,sum:W_,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},assert:G_,assertShapesMatch:H_,assertNonNull:Y_,flatten:q_,sizeFromShape:K_,isScalarShape:function(e){return 0===e.length},arraysEqual:X_,isInt:Q_,tanh:J_,sizeToSquarishShape:Z_,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return B_(t),t},rightPad:$_,repeatedTry:ew,inferFromImplicitShape:tw,parseAxisParam:nw,squeezeShape:rw,getTypedArrayFromDType:iw,getArrayFromDType:aw,checkConversionForErrors:ow,isValidDtype:sw,hasEncodingLoss:cw,isTypedArray:uw,bytesPerElement:lw,bytesFromStringArray:dw,isString:fw,isBoolean:hw,isNumber:pw,inferDtype:mw,isFunction:gw,nearestDivisor:vw,computeStrides:yw,toTypedArray:bw,toNestedArray:_w,makeOnesTypedArray:ww,makeZerosTypedArray:Ew,now:Sw,assertNonNegativeIntegerDimensions:Cw,fetch:function(e,t){return A_().platform.fetch(e,t)},encodeString:xw,decodeString:Tw,locToIndex:Rw,indexToLoc:Iw});var Nw=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new Aw)}return e.prototype.profileKernel=function(e,t,n){var r,i=this,a=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var i=e[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),a.then((function(a){var o="";null!=a.getExtraProfileInfo&&(o=a.getExtraProfileInfo()),i.logger.logKernelProfile(e,n,r,a.kernelMs,t,o)}))}))})),r},e}(),Aw=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,i,a){var o="number"==typeof r?$_(r+"ms",9):r.error,s=$_(e,25),c=t.rank,u=t.size,l=$_(t.shape.toString(),14),d="";for(var f in i){var h=i[f].shape||t.shape,p=h.length;d+=f+": "+p+"D "+(p>0?h:"")+" "}console.log("%c"+s+"\t%c"+o+"\t%c"+c+"D "+l+"\t%c"+u+"\t%c"+d+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function kw(e,t,n){return $_(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":fw(e)?"'"+e+"'":"bool"===n?Dw(e):parseFloat(e.toFixed(7)).toString(),t)}function Dw(e){return 0===e?"false":"true"}function Mw(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Lw=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=K_(e),null!=n){var i=n.length;G_(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||aw(t,this.size),this.strides=yw(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),G_(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(n);this.values[i]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,i=e;r<i.length;r++){var a=i[r];if(a<0||a>=this.shape[n]){var o="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(o)}n++}for(var s=e[e.length-1],c=0;c<e.length-1;++c)s+=this.strides[c]*e[c];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Ow().makeTensor(this.values,this.shape,this.dtype)},e}(),Ow=null,Pw=null,jw=null,Fw=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=K_(e),this.strides=yw(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),G_(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),this.reshape([e,t,n,r,i])},e.prototype.asType=function(e){return this.throwIfDisposed(),Pw.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return R_(this,void 0,void 0,(function(){var e;return I_(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Pw.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return Pw.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return R_(this,void 0,void 0,(function(){var e;return I_(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,_w(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return _w(this.shape,this.dataSync())},e.prototype.data=function(){return R_(this,void 0,void 0,(function(){var e,t;return I_(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=Ow().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return Tw(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=Ow().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return Tw(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return R_(this,void 0,void 0,(function(){var e;return I_(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Ow().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(Ow().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),Pw.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),Pw.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),Pw.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),Pw.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),Pw.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),Pw.clone(this)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var i=yw(t),a=function(e,t,n,r){var i=K_(t),a=r[r.length-1],o=new Array(a).fill(0),s=t.length,c="complex64"===n?Mw(e):e;if(s>1)for(var u=0;u<i/a;u++)for(var l=u*a,d=0;d<a;d++)o[d]=Math.max(o[d],kw(c[l+d],0,n).length);return o}(e,t,n,i),o=t.length,s=function e(t,n,r,i,a,o){void 0===o&&(o=!0);var s="complex64"===r?2:1,c=n[0],u=n.length;if(0===u)return"complex64"===r?[kw(Mw(t)[0],0,r)]:"bool"===r?[Dw(t[0])]:[t[0].toString()];if(1===u){if(c>20){var l=3*s,d=Array.from(t.slice(0,l)),f=Array.from(t.slice((c-3)*s,c*s));return"complex64"===r&&(d=Mw(d),f=Mw(f)),["["+d.map((function(e,t){return kw(e,a[t],r)})).join(", ")+", ..., "+f.map((function(e,t){return kw(e,a[c-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?Mw(t):Array.from(t)).map((function(e,t){return kw(e,a[t],r)})).join(", ")+"]"]}var h=n.slice(1),p=i.slice(1),m=i[0]*s,g=[];if(c>20){for(var v=0;v<3;v++){var y=(b=v*m)+m;g.push.apply(g,e(t.slice(b,y),h,r,p,a,!1))}for(g.push("..."),v=c-3;v<c;v++)y=(b=v*m)+m,g.push.apply(g,e(t.slice(b,y),h,r,p,a,v===c-1))}else for(v=0;v<c;v++){var b;y=(b=v*m)+m,g.push.apply(g,e(t.slice(b,y),h,r,p,a,v===c-1))}var _=2===u?",":"";for(g[0]="["+g[0]+_,v=1;v<g.length-1;v++)g[v]=" "+g[v]+_;var w=",\n";for(v=2;v<u;v++)w+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(o?"":w),g}(e,t,n,i,a),c=["Tensor"];return r&&(c.push("  dtype: "+n),c.push("  rank: "+o),c.push("  shape: ["+t+"]"),c.push("  values:")),c.push(s.map((function(e){return"    "+e})).join("\n")),c.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),Pw.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),Pw.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),Pw.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),Pw.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),Pw.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),Pw.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),Pw.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),Pw.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),Pw.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),Pw.unstack(this,e)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),jw("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,r,n)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Pw.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Pw.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Pw.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Pw.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Pw.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Pw.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Pw.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Pw.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),Pw.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),Pw.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),Pw.cast(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),Pw.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),Pw.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),Pw.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),Pw.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),Pw.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),Pw.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),Pw.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),Pw.mulStrict(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),Pw.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),Pw.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),Pw.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Pw.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),Pw.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Pw.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),Pw.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),Pw.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Pw.squaredDifferenceStrict(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),Pw.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Pw.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),Pw.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),Pw.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),Pw.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),Pw.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),Pw.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Pw.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),Pw.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Pw.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Pw.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Pw.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Pw.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),Pw.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),Pw.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),Pw.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),Pw.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),Pw.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),Pw.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),Pw.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),Pw.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),Pw.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),Pw.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),Pw.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),Pw.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),Pw.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),Pw.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),Pw.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),Pw.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),Pw.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),Pw.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),Pw.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),Pw.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Pw.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),Pw.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),Pw.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),Pw.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),Pw.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),Pw.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),Pw.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),Pw.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),Pw.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),Pw.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),Pw.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),Pw.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),Pw.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),Pw.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),Pw.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),Pw.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),Pw.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),Pw.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),Pw.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),Pw.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),Pw.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),Pw.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),Pw.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),Pw.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),Pw.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),Pw.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),Pw.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),Pw.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),Pw.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),Pw.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),Pw.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,a){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),Pw.conv1d(this,e,t,n,r,i,a)},e.prototype.conv2d=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),Pw.conv2d(this,e,t,n,r,i,a)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),Pw.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,a){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),Pw.depthwiseConv2d(this,e,t,n,r,i,a)},e.prototype.separableConv2d=function(e,t,n,r,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),Pw.separableConv2d(this,e,t,n,r,i,a)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Pw.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Pw.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),Pw.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),Pw.pool(this,e,t,n,r,i)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),Ow().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Pw.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Pw.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Pw.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),Pw.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i,a,o,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.throwIfDisposed(),Pw.stridedSlice(this,e,t,n,r,i,a,o,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Pw.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),Pw.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),Pw.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),Pw.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),Pw.spectral.irfft(this)},e}();Object.defineProperty(Fw,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var Uw,Bw,Vw,zw,Ww,Gw=function(e){function t(t,n,r,i){var a=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=n,a.name=r,a}return T_(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!X_(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");Ow().disposeTensor(this),this.dataId=e.dataId,Ow().incRef(this,null)},t.prototype.dispose=function(){Ow().disposeVariable(this),this.isDisposedInternal=!0},t}(Fw);Object.defineProperty(Gw,Symbol.hasInstance,{value:function(e){return e instanceof Fw&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Uw||(Uw={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Bw||(Bw={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Vw||(Vw={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(zw||(zw={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Ww||(Ww={}));var Hw={float32:zw,int32:Bw,bool:Vw,complex64:Ww};function Yw(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Hw[e][t]}function qw(e){return Yw(e,"int32")}function Kw(e,t){if(e.dtype===t.dtype)return[e,t];var n=Yw(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Xw(e,t){G_(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function Qw(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof Fw)n.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,a=t;for(var o in a){var s=a[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:Kw,assertTypesMatch:Xw,isTensorInList:function(e,t){return t.some((function(t){return t.id===e.id}))},getTensorsInContainer:Qw});var Jw,Zw=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),$w=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Zw}return e.prototype.ready=function(){return R_(this,void 0,void 0,(function(){var e,t,n;return I_(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return R_(this,void 0,void 0,(function(){var t,n,r;return I_(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Nw(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;P_(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;P_(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,a=r.then((function(n){return!(i<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return!(i<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),i=r.success,a=r.asyncInit;if(a||i)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){return e.toFloat()}}}),[],{}),t},e.prototype.runKernel=function(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(e){i+="complex64"===e.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-i-a;if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,i,a,o){var s,c=this,u=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var d,f=this.state.numBytes,h=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var p,m=L_(r,this.backendName);if(null!=m)d=function(){var e=c.backend.numDataIds();p=m.kernelFunc({inputs:t,attrs:i,backend:c.backend});var n=Array.isArray(p)?p:[p];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return c.makeTensorFromDataId(t,n,r)}));if(l){var d=c.getTensorsForGradient(r,t,s);if(null==d){null==o&&(o=[]);var f=s.filter((function(e,t){return o[t]}));d=(a||[]).slice().concat(f)}u=c.saveTensorsForBackwardMode(d)}return s};else{var g=function(e){l&&(u=e.map((function(e){return c.keep(c.clone(e))})))};d=function(){var t=c.backend.numDataIds();p=c.tidy((function(){return e(c.backend,g)}));var n=Array.isArray(p)?p:[p];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return c.state.kernelDepth++}),(function(){return c.state.kernelDepth--}),(function(){s=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(r,t,(function(){return d()})):d()})),l&&this.addTapeNode(r,t,s,n,u,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-h,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(p)?s:s[0]},e.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))},e.prototype.getTensorsForGradient=function(e,t,n){var r=O_(e);if(null!=r){var i=r.inputsToSave||[],a=r.outputsToSave||[],o=void 0;r.saveAllInputs?(G_(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),o=Object.keys(t).map((function(e){return t[e]}))):o=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return a[t]}));return o.concat(s)}return null},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=e;"string"===n&&fw(e[0])&&(i=e.map((function(e){return xw(e)})));var a=r.write(i,t,n),o=new Fw(t,n,a,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(a),c=dw(i);this.state.numBytes+=c-s.bytes,s.bytes=c}return o},e.prototype.makeTensorFromDataId=function(e,t,n,r){var i=new Fw(t,n=n||"float32",e,this.nextTensorId());return this.incRef(i,r),i},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var i=new Gw(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*lw(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Gw||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return R_(this,void 0,void 0,(function(){var t,n;return I_(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,i,a){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=O_(e);null!=c&&(r=c.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],i=Ew(r.size,r.dtype);return o.makeTensor(i,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],i,a)}),this.state.activeTape.push(s)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Qw(e),r=new Set(n.map((function(e){return e.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||r.has(a.id)||a.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var i=this;if(void 0===r&&(r=!1),G_(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",e)}));G_(a instanceof Fw,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},i={},a=0;a<t.length;a++)r[t[a].id]=!0;for(a=0;a<e.length;a++){var o=(p=e[a]).inputs;for(var s in o){for(var c=o[s],u=!1,l=0;l<t.length;l++)if(r[c.id]){p.outputs.forEach((function(e){return r[e.id]=!0})),u=!0,i[p.id]=!0;break}if(u)break}}var d={};d[n.id]=!0;var f={};for(a=e.length-1;a>=0;a--)for(o=(p=e[a]).inputs,l=0;l<p.outputs.length;l++)if(d[p.outputs[l].id]){for(var s in o)d[o[s].id]=!0,f[p.id]=!0;break}var h=[];for(a=0;a<e.length;a++){var p;if(i[(p=e[a]).id]&&f[p.id]){var m={};for(var s in p.inputs){var g=p.inputs[s];r[g.id]&&(m[s]=g)}var v=Object.assign({},p);v.inputs=m,v.outputs=p.outputs,h.push(v)}}return h}(this.state.activeTape,t,a);if(!r&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,s={};s[a.id]=null==n?(r=ww(K_(e=a.shape),"float32"),eE.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var i=t[r],a=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?a.push(n):a.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.kernelName+".");var o=i.gradient(a),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(o)+".");var r=n((function(){return o[t]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=i.inputs[t];if(!X_(r.shape,a.shape))throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==e[a.id])e[a.id]=r;else{var s=e[a.id];e[a.id]=s.add(r),s.dispose()}};for(var c in i.inputs)s(c)},i=t.length-1;i>=0;i--)r(i)}(s,o,(function(e){return i.tidy(e)}));var c=t.map((function(e){return s[e.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),i.state.activeTape=null),{value:a,grads:c}}))},e.prototype.customGrad=function(e){var t=this;return G_(gw(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];G_(r.every((function(e){return e instanceof Fw})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(e,t){a[t]=e})),t.runKernelFunc((function(t,i){return G_((n=e.apply(void 0,r.concat([i]))).value instanceof Fw,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),G_(gw(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(e,t){var i=n.gradFunc(e,t),a=Array.isArray(i)?i:[i];G_(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),G_(a.every((function(e){return e instanceof Fw})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return R_(this,void 0,void 0,(function(){var t,n;return I_(this,(function(r){switch(r.label){case 0:return t=Sw(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=Sw()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Zw,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),eE=function(){var e=function(){if(null==Jw){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Jw=e}return Jw}();if(null==e._tfengine){var t=new N_(e);e._tfengine=new $w(t)}return function(e){k_=e}(e._tfengine.ENV),Ow=function(){return e._tfengine},e._tfengine}();function tE(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var nE=A_();nE.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),nE.registerFlag("IS_BROWSER",(function(){return tE()})),nE.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),nE.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),nE.registerFlag("PROD",(function(){return!1})),nE.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return nE.getBool("DEBUG")})),nE.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),nE.registerFlag("IS_TEST",(function(){return!1}));var rE,iE,aE,oE={},sE={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function cE(e,t){oE[e]=t}function uE(e){e in oE||(oE[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete oE[e]}),!1),1===e?t.getContext("webgl",sE)||t.getContext("experimental-webgl",sE):t.getContext("webgl2",sE)}(e));var t=oE[e];return t.isContextLost()?(delete oE[e],uE(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),oE[e])}function lE(e,t){return[t,e]}function dE(e){var t=K_(e);return Z_(Math.ceil(t/4))}function fE(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function hE(e,t){var n,r,i,a,o,s,c,u,l,d=e;return 2===A_().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,i=d.RGBA16F,a=d.RGBA32F,o=d.RED,s=4,c=1,u=d.HALF_FLOAT,l=d.FLOAT):(n=e.RGBA,r=e.RGBA,i=e.RGBA,a=d.RGBA,o=e.RGBA,s=4,c=4,u=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:a,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:c,textureTypeHalfFloat:u,textureTypeFloat:l}}function pE(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+gE(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(rE||(rE={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(iE||(iE={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(aE||(aE={}));function mE(e){return!!(A_().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function gE(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function vE(e,t,n){return BE(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function yE(e,t,n){var r=BE(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(pE(e,t,(function(){return e.shaderSource(r,n)})),pE(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function bE(e,t,n){var r=BE(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(pE(e,t,(function(){return e.shaderSource(r,n)})),pE(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=EE.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],i=e.split("\n"),a=i.length.toString().length+2,o=i.map((function(e,t){return $_((t+1).toString(),a)+e})),s=0,c=0;c<o.length;c++)s=Math.max(o[c].length,s);var u=o.slice(0,r-1),l=o.slice(r-1,r),d=o.slice(r);console.log(u.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+$_(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var _E,wE,EE=/ERROR: [0-9]+:([0-9]+):/g;function SE(e,t){return BE(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function CE(e,t,n){if(pE(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function xE(e,t,n){if(pE(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function TE(e,t,n){var r=BE(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return pE(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),pE(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function RE(e,t,n){var r=BE(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return pE(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),pE(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function IE(e,t){return BE(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function NE(e,t){var n=A_().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function AE(e,t){return BE(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function kE(e,t,n,r,i,a,o,s){var c=e.getAttribLocation(n,r);return-1!==c&&(pE(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,i)})),pE(e,t,(function(){return e.vertexAttribPointer(c,a,e.FLOAT,!1,o,s)})),pE(e,t,(function(){return e.enableVertexAttribArray(c)})),!0)}function DE(e,t,n,r){VE(e,r),pE(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),pE(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function ME(e,t,n,r){return BE(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function LE(e,t,n){return e.getUniformLocation(t,n)}function OE(e,t,n,r,i,a){pE(e,t,(function(){return DE(e,t,r,a)})),pE(e,t,(function(){return e.uniform1i(i,a)}))}function PE(e,t,n,r){pE(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),pE(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function jE(e,t,n){pE(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),pE(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function FE(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+UE(e,t))}function UE(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function BE(e,t,n,r){var i=pE(e,t,(function(){return n()}));if(null==i)throw new Error(r);return i}function VE(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function zE(e,t){return void 0===t&&(t=2),K_(e.slice(0,e.length-t))}function WE(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function GE(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[zE(e)].concat(WE(e))),t}function HE(e,t){var n;void 0===t&&(t=!1);var r=A_().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?z_(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var i=rw(e);e=i.newShape}var a=K_(e);if(e.length<=1&&a<=r)return[1,a];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var o=zE(e),s=2,c=2;return e.length&&(s=(n=WE(e))[0],c=n[1]),Z_(a=o*(s/2)*(c/2)).map((function(e){return 2*e}))}return Z_(a)}function YE(e){return e%2==0}function qE(e,t){if(X_(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(YE(n)&&YE(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&YE(e[0])&&YE(t[0])}function KE(e){if(null==_E){var t=uE(e);_E=t.getParameter(t.MAX_TEXTURE_SIZE)}return _E}function XE(e){if(null==wE){var t=uE(e);wE=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,wE)}function QE(e){if(0===e)return 0;var t=uE(e);return JE(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:JE(t,"EXT_disjoint_timer_query")?1:0}function JE(e,t){return null!=e.getExtension(t)}function ZE(e){try{if(null!=uE(e))return!0}catch(e){return!1}return!1}function $E(e){if(0===e)return!1;var t=uE(e);if(1===e){if(!JE(t,"OES_texture_float"))return!1}else if(!JE(t,"EXT_color_buffer_float"))return!1;return tS(t)}function eS(e){if(0===e)return!1;var t=uE(e);if(1!==e){if(JE(t,"EXT_color_buffer_float"))return tS(t);if(JE(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=hE(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(i),a}(t,n)}return!1}return!!JE(t,"OES_texture_float")&&!!JE(t,"WEBGL_color_buffer_float")&&tS(t)}function tS(e){var t=hE(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function nS(e){return 2===e&&null!=uE(e).fenceSync}var rS=Object.freeze({callAndCheck:pE,canBeRepresented:mE,getWebGLErrorMessage:gE,getExtensionOrThrow:vE,createVertexShader:yE,createFragmentShader:bE,createProgram:SE,linkProgram:CE,validateProgram:xE,createStaticVertexBuffer:TE,createStaticIndexBuffer:RE,getNumChannels:function(){return 2===A_().getNumber("WEBGL_VERSION")?1:4},createTexture:IE,validateTextureSize:NE,createFramebuffer:AE,bindVertexBufferToProgramAttribute:kE,bindTextureUnit:DE,unbindTextureUnit:function(e,t,n){VE(e,n),pE(e,t,(function(){return e.activeTexture(e.TEXTURE0+n)})),pE(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:ME,getProgramUniformLocation:LE,bindTextureToProgramUniformSampler:OE,bindCanvasToFramebuffer:function(e,t){pE(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),pE(e,t,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),pE(e,t,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:PE,unbindColorTextureFromFramebuffer:jE,validateFramebuffer:FE,getFramebufferErrorMessage:UE,getBatchDim:zE,getRowsCols:WE,getShapeAs3D:GE,getTextureShapeFromLogicalShape:HE,isReshapeFree:qE,getWebGLMaxTextureSize:KE,resetMaxTextureSize:function(){_E=null},resetMaxTexturesInShader:function(){wE=null},getMaxTexturesInShader:XE,getWebGLDisjointQueryTimerVersion:QE,hasExtension:JE,isWebGLVersionEnabled:ZE,isCapableOfRenderingToFloatTexture:$E,isDownloadFloatTextureEnabled:eS,isWebGLFenceEnabled:nS}),iS=A_();function aS(e){A_().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function oS(e,t){return eE.tidy(e,t)}function sS(e){Qw(e).forEach((function(e){return e.dispose()}))}function cS(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];A_().getBool("IS_TEST")||console.warn.apply(console,e)}function uS(e,t){var n=e;if(uw(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||uw(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&A_().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||uw(t)){G_(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),G_(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var i=n.slice(1),a=0;a<t.length;++a)e(t[a],i,r.concat(a))}else G_(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function lS(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function dS(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof Fw)return lS(r,e.dtype,t,n),e;var i=mw(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),lS(r,i,t,n),null==e||!uw(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var a=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var o=uS(e,i);uw(e)||Array.isArray(e)||(e=[e]);var s="string"!==i?bw(e,i,A_().getBool("DEBUG")):q_(e,[],!0);return eE.makeTensor(s,o,i)}function fS(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return dS(e,t+"["+r+"]",n)}),r)}function hS(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function pS(e,t,n){for(var r=e.length+t.length,i=[],a=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[a++]):i.push(t[o++]);return i}function mS(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map((function(t){return e[t]}))]}function gS(e,t){return pS(e,t.map((function(e){return 1})),t)}function vS(e,t,n){G_(hS(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function yS(e,t){if(hS(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function bS(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function _S(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function wS(e,t){var n=e[0].length;e.forEach((function(e,t){G_(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),G_(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,i){for(var a=0;a<n;a++)G_(a===t||e[a]===r[a],(function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."}))}))}function ES(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function SS(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];eE.startScope(n);try{var i=r.apply(void 0,e);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),eE.endScope(i),i}catch(e){throw eE.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}iS.registerFlag("HAS_WEBGL",(function(){return iS.getNumber("WEBGL_VERSION")>0})),iS.registerFlag("WEBGL_VERSION",(function(){return ZE(2)?2:ZE(1)?1:0})),iS.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===iS.get("WEBGL_VERSION")})),iS.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),iS.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),iS.registerFlag("WEBGL_PACK",(function(){return iS.getBool("HAS_WEBGL")})),iS.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return iS.getBool("WEBGL_PACK")})),iS.registerFlag("WEBGL_PACK_CLIP",(function(){return iS.getBool("WEBGL_PACK")})),iS.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),iS.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return iS.getBool("WEBGL_PACK")})),iS.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return iS.getBool("WEBGL_PACK")})),iS.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return iS.getBool("WEBGL_PACK")})),iS.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return iS.getBool("WEBGL_PACK")})),iS.registerFlag("WEBGL_PACK_REDUCE",(function(){return iS.getBool("WEBGL_PACK")})),iS.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return iS.getBool("WEBGL_PACK")})),iS.registerFlag("WEBGL_CONV_IM2COL",(function(){return iS.getBool("WEBGL_PACK")})),iS.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return KE(iS.getNumber("WEBGL_VERSION"))})),iS.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return XE(iS.getNumber("WEBGL_VERSION"))})),iS.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=iS.getNumber("WEBGL_VERSION");return 0===e?0:QE(e)})),iS.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return iS.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),iS.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return $E(iS.getNumber("WEBGL_VERSION"))})),iS.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!iS.getBool("WEBGL_FORCE_F16_TEXTURES")&&iS.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),iS.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return eS(iS.getNumber("WEBGL_VERSION"))})),iS.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return nS(iS.getNumber("WEBGL_VERSION"))})),iS.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return iS.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),jw=aS;var CS=SS({complex_:function(e,t){var n=dS(e,"real","complex"),r=dS(t,"imag","complex");return H_(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),eE.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),xS=SS({real_:function(e){var t=dS(e,"input","real");return eE.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),TS=SS({imag_:function(e){var t=dS(e,"input","imag");return eE.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function RS(e,t,n){return IS(e,t,uS(e,n),n)}function IS(e,t,n,r){if(null==r&&(r=mw(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!uw(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Cw(t);var i=K_(t),a=K_(n);G_(i===a,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+a}));for(var o=0;o<n.length;++o){var s=n[o],c=o!==n.length-1||s!==K_(t.slice(o));G_(n[o]===t[o]||!c,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return uw(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?bw(e,r,A_().getBool("DEBUG")):q_(e,[],!0),eE.makeTensor(e,t,r)}function NS(e,t){if((uw(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&uw(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return IS(e,[],[],t)}function AS(e,t){Y_(e);var n=uS(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return IS(e,null,n,t)}function kS(e,t,n){if(Y_(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=uS(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return IS(e,t,r,n)}function DS(e,t,n){if(Y_(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=uS(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return IS(e,t,r,n)}function MS(e,t,n){if(Y_(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=uS(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return IS(e,t,r,n)}function LS(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=LS(e,"float32"),r=OS(e,"float32");return CS(n,r)}var i=ww(K_(e),t);return eE.makeTensor(i,e,t)}function OS(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=OS(e,"float32"),r=OS(e,"float32");return CS(n,r)}var i=Ew(K_(e),t);return eE.makeTensor(i,e,t)}function PS(e,t,n){return eE.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function jS(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return OS([0],r);var i=Ew(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+n;return AS(i,r)}var FS=SS({onesLike_:function(e){var t=dS(e,"x","onesLike");if("complex64"===t.dtype){var n=FS(xS(t)),r=US(TS(t));return CS(n,r)}return eE.runKernelFunc((function(e){return e.onesLike(t)}),{x:t},(function(e,t){return{x:function(){return US(e)}}}),"OnesLike")}}),US=SS({zerosLike_:function(e){var t=dS(e,"x","zerosLike");return eE.runKernelFunc((function(e){return e.zerosLike(t)}),{x:t},(function(e,t){return{x:function(){return US(e)}}}),"ZerosLike")}}),BS=SS({concat_:function(e,t){void 0===t&&(t=0),G_(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=fS(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),t=nw(t,n[0].shape)[0];var r=ES(n.map((function(e){return e.shape})),t);if(0===K_(r))return RS([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var i=n.map((function(e){return e.shape}));wS(i,t);var a=n,o={axis:t};return eE.runKernelFunc((function(e){return e.concat(n,t)}),a,(function(e){var n=i.map((function(e){return e[t]}));return HS(e,n,t).map((function(e){return function(){return e}}))}),"Concat",o)}}),VS=SS({concat1d_:function(e){return BS(e,0)}}),zS=SS({concat2d_:function(e,t){return BS(e,t)}}),WS=SS({concat3d_:function(e,t){return BS(e,t)}}),GS=SS({concat4d_:function(e,t){return BS(e,t)}}),HS=SS({split_:function(e,t,n){void 0===n&&(n=0);var r,i=dS(e,"x","split");return n=nw(n,i.shape)[0],"number"==typeof t?(G_(i.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(i.shape[n]/t)):(G_(i.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),eE.runKernelFunc((function(e){return e.split(i,r,n)}),{$x:i},(function(e){return{$x:function(){return BS(e,n)}}}))}});function YS(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",Cw(e),new Lw(e,t,n)}var qS=SS({batchToSpaceND_:function(e,t,n){var r=dS(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return G_(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),G_(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),G_(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),eE.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),KS=SS({cast_:function(e,t){var n=dS(e,"x","cast");if(!sw(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return eE.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",r)}}),XS=SS({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=dS(e,"x","cumsum"),a=yS([t|=0],i.rank),o=i;null!=a&&(o=i.transpose(a));var s=_S(1,i.rank)[0],c=eE.runKernelFunc((function(e){return e.cumsum(o,s,n,r)}),{permutedX:o},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=a&&(c=c.transpose(a)),c}}),QS=SS({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=dS(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return G_(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),G_(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),G_(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+o+" for depthToSpace with input shape "+r.shape})),eE.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),JS=SS({expandDims_:function(e,t){void 0===t&&(t=0);var n=dS(e,"x","expandDims",null);G_(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(G_(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),ZS(n,r)}}),ZS=SS({reshape_:function(e,t){var n=dS(e,"x","reshape",null);t=tw(t,n.size),G_(n.size===K_(t),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:t};return eE.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",r)}}),$S=SS({spaceToBatchND_:function(e,t,n){var r=dS(e,"x","spaceToBatchND");return G_(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),G_(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),G_(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),eE.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),eC=SS({squeeze_:function(e,t){var n=dS(e,"x","squeeze");return ZS(n,rw(n.shape,t).newShape)}}),tC=SS({stack_:function(e,t){void 0===t&&(t=0);var n=fS(e,"tensors","stack");if(G_(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].rank,i=n[0].shape,a=n[0].dtype;G_(t<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){H_(i,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){G_(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=n.map((function(e){return e.expandDims(t)}));return BS(o,t)}}),nC=SS({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=dS(e,"x","unstack");G_(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length);var r={axis:t};return eE.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return tC(e,t)}}}),"Unpack",r)}});function rC(e,t,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var a=t.length,o=0;o<a;++o)i=i.concat([e[o+1]/t[o],t[o]]);i=i.concat(e.slice(a+1))}return i}function iC(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var a=[],o=[];for(i=1;i<e;++i)i>=2*t+1||i%2==1?o.push(i):a.push(i);r.push.apply(r,a),r.push(0),r.push.apply(r,o)}return r}function aC(e,t,n,r){void 0===r&&(r=!0);var i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(var a=1;a<e.length;++a)a<=t.length?r?i.push(t[a-1]*e[a]):i.push(e[a]/t[a-1]):i.push(e[a]);return i}function oC(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function sC(e,t,n){for(var r=e.slice(0,1),i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}var cC="Div",uC="SquaredDifference",lC="BroadcastTo",dC="OneHot",fC="Identity",hC="Tile",pC="PadV2",mC=SS({add_:function(e,t){var n,r=dS(e,"a","add"),i=dS(t,"b","add");n=Kw(r,i),r=n[0],i=n[1];var a={a:r,b:i};return eE.runKernelFunc((function(e,t){var n=e.add(r,i);return t([r,i]),n}),a,null,"Add")}});function gC(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var a=n-1-i,o=e[a]||1;(t[t.length-1-i]||1)>1&&1===o&&r.unshift(a)}return r}function vC(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],a=t.length-r-1,o=t[a];(null==i||1===i&&o>1)&&n.unshift(a)}return n}function yC(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var a=e[e.length-i-1];null==a&&(a=1);var o=t[t.length-i-1];if(null==o&&(o=1),1===a)n.unshift(o);else if(1===o)n.unshift(a);else{if(a!==o)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(a)}}return n}var bC=SS({abs_:function(e){var t=dS(e,"x","abs");return"complex64"===t.dtype?eE.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):eE.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),_C=SS({acos_:function(e){var t=dS(e,"x","acos");return eE.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(NS(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),wC=SS({acosh_:function(e){var t=dS(e,"x","acosh");return eE.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),EC=SS({asin_:function(e){var t=dS(e,"x","asin");return eE.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(NS(1).sub(n.toFloat().square()).sqrt())}}}))}}),SC=SS({asinh_:function(e){var t=dS(e,"x","asinh");return eE.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(NS(1).add(n.toFloat().square()).sqrt())}}}))}}),CC=SS({atan_:function(e){var t=dS(e,"x","atan");return eE.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),xC=SS({atanh_:function(e){var t=dS(e,"x","atanh");return eE.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(NS(1).sub(n.toFloat().square()))}}}))}}),TC=SS({ceil_:function(e){var t=dS(e,"x","ceil");return eE.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return US(e)}}}))}}),RC=SS({clipByValue_:function(e,t,n){var r=dS(e,"x","clipByValue");G_(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."}));var i=[r],a={min:t,max:n};return eE.runKernelFunc((function(e,i){var a=e.clip(r,t,n);return i([r]),a}),{x:r},(function(e,r){var i=r[0];return{x:function(){return e.where(i.greaterEqual(t).logicalAnd(i.lessEqual(n)),US(e))}}}),"ClipByValue",a,i)}}),IC=SS({cos_:function(e){var t=dS(e,"x","cos"),n=[t];return eE.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},n)}}),NC=SS({cosh_:function(e){var t=dS(e,"x","cosh");return eE.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),AC=SS({erf_:function(e){var t=dS(e,"x","erf");return G_("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),eE.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),kC=SS({exp_:function(e){var t=dS(e,"x","exp");return eE.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),DC=SS({expm1_:function(e){var t=dS(e,"x","expm1");return eE.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),MC=SS({floor_:function(e){var t=dS(e,"x","floor");return eE.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return US(e)}}}))}}),LC=SS({log_:function(e){var t=dS(e,"x","log"),n=[t];return eE.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},n)}}),OC=SS({log1p_:function(e){var t=dS(e,"x","log1p");return eE.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),PC=SS({logSigmoid_:function(e){var t=dS(e,"x","logSigmoid");return eE.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),jC=SS({neg_:function(e){var t=dS(e,"x","neg"),n=[t];return eE.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},n)}}),FC=SS({reciprocal_:function(e){var t=dS(e,"x","reciprocal");return eE.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),UC=SS({round_:function(e){var t=dS(e,"x","round");return eE.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return US(e)}}}))}}),BC=SS({rsqrt_:function(e){var t=dS(e,"x","rsqrt"),n=[t];return eE.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),VC=SS({sigmoid_:function(e){var t=dS(e,"x","sigmoid");return eE.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(NS(1).sub(n)))}}}),"Sigmoid")}}),zC=SS({sign_:function(e){var t=dS(e,"x","sign");return eE.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return US(e)}}}))}}),WC=SS({isNaN_:function(e){var t=dS(e,"x","isNaN");return eE.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return US(e)}}}))}}),GC=SS({isInf_:function(e){var t=dS(e,"x","isInf");return eE.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return US(e)}}}))}}),HC=SS({isFinite_:function(e){var t=dS(e,"x","isFinite");return eE.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return US(e)}}}))}}),YC=SS({sin_:function(e){var t=dS(e,"x","sin"),n=[t];return eE.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},n)}}),qC=SS({sinh_:function(e){var t=dS(e,"x","sinh");return eE.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),KC=SS({softplus_:function(e){var t=dS(e,"x","softplus");return eE.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),XC=SS({sqrt_:function(e){var t=dS(e,"x","sqrt");return eE.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),QC=SS({step_:function(e,t){void 0===t&&(t=0);var n=dS(e,"x","step");return eE.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return US(e)}}}))}}),JC=SS({tan_:function(e){var t=dS(e,"x","tan");return eE.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),ZC=SS({tanh_:function(e){var t=dS(e,"x","tanh");return eE.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return NS(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}}),$C=SS({addStrict_:function(e,t){var n=dS(e,"a","addStrict"),r=dS(t,"b","addStrict");return H_(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),ex=SS({atan2_:function(e,t){var n,r=dS(e,"a","atan2"),i=dS(t,"b","atan2");n=Kw(r,i),r=n[0],i=n[1];var a=yC(r.shape,i.shape);return eE.runKernelFunc((function(e,t){var n=e.atan2(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=mC(n.square(),r.square()),i=e.mul(r.div(t)),o=vC(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},$b:function(){var t=mC(n.square(),r.square()),i=jC(e.mul(n.div(t))),o=vC(r.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(r.shape)}}}))}}),tx=SS({divStrict_:function(e,t){var n=dS(e,"a","div"),r=dS(t,"b","div");return H_(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),nx=SS({floorDiv_:function(e,t){var n,r=dS(e,"a","floorDiv"),i=dS(t,"b","floorDiv");n=Kw(r,i),r=n[0],i=n[1];var a=yC(r.shape,i.shape);return eE.runKernelFunc((function(e,t){var n=e.floorDiv(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=vC(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=vC(r.shape,a);i.length>0&&(t=t.sum(i).reshape(r.shape));var o=r.square();return t.div(o.toFloat()).neg()}}}),"FloorDiv")}}),rx=SS({maximum_:function(e,t){var n,r=dS(e,"a","maximum"),i=dS(t,"b","maximum");return n=Kw(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),yC(r.shape,i.shape),eE.runKernelFunc((function(e,t){var n=e.maximum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),ix=SS({maximumStrict_:function(e,t){var n=dS(e,"a","maximumStrict"),r=dS(t,"b","maximumStrict");return H_(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),ax=SS({minimum_:function(e,t){var n,r=dS(e,"a","minimum"),i=dS(t,"b","minimum");return n=Kw(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),yC(r.shape,i.shape),eE.runKernelFunc((function(e,t){var n=e.minimum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),ox=SS({minimumStrict_:function(e,t){var n=dS(e,"a","minimumStrict"),r=dS(t,"b","minimumStrict");return H_(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),sx=SS({mod_:function(e,t){var n,r=dS(e,"a","mod"),i=dS(t,"b","mod");n=Kw(r,i),r=n[0],i=n[1];var a=yC(r.shape,i.shape);return eE.runKernelFunc((function(e,t){var n=e.mod(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=vC(n.shape,a);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),i=vC(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),cx=SS({modStrict_:function(e,t){var n=dS(e,"a","modStrict"),r=dS(t,"b","modStrict");return H_(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),ux=SS({mul_:function(e,t){var n,r=dS(e,"a","mul"),i=dS(t,"b","mul");n=Kw(r,i),r=n[0],i=n[1];var a=yC(r.shape,i.shape);return eE.runKernelFunc((function(e,t){var n=e.multiply(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),i=vC(n.shape,a);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=vC(r.shape,a);return i.length>0?t.sum(i).reshape(r.shape):t}}}),"Mul")}}),lx=SS({mulStrict_:function(e,t){var n=dS(e,"a","mul"),r=dS(t,"b","mul");return H_(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),dx=SS({pow_:function(e,t){var n,r=dS(e,"base","pow"),i=dS(t,"exp","pow");n=Kw(r,i),r=n[0],i=n[1];var a=yC(r.shape,i.shape),o=[r,i];return eE.runKernelFunc((function(e,t){var n=e.pow(r,i);return t([r,i,n]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1],i=t[2];return{a:function(){var t=r.toFloat(),i=e.mul(t.mul(n.pow(t.sub(NS(1))))),o=vC(n.shape,a);return o.length>0&&(i=i.sum(o)),i.reshape(n.shape)},b:function(){var t=n.greater(0),o=n.log().where(t,US(n)),s=e.mul(i.mul(o)),c=vC(r.shape,a);return c.length>0&&(s=s.sum(c)),s.reshape(r.shape)}}}),"Pow",{},o,[!0])}}),fx=SS({powStrict_:function(e,t){return H_(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),hx=SS({squaredDifferenceStrict_:function(e,t){var n=dS(e,"a","squaredDifferenceStrict"),r=dS(t,"b","squaredDifferenceStrict");return H_(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),px=SS({sub_:function(e,t){var n,r=dS(e,"a","sub"),i=dS(t,"b","sub");n=Kw(r,i),r=n[0],i=n[1];var a=yC(r.shape,i.shape);return eE.runKernelFunc((function(e){return e.subtract(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=vC(r.shape,a);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=vC(i.shape,a);return n.length>0&&(t=t.sum(n)),t.neg().reshape(i.shape)}}}),"Sub")}}),mx=SS({subStrict_:function(e,t){var n=dS(e,"a","subStrict"),r=dS(t,"b","subStrict");return H_(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),gx=SS({div_:function(e,t){var n,r=dS(e,"a","div"),i=dS(t,"b","div");if(n=Kw(r,i),r=n[0],i=n[1],"int32"===r.dtype&&"int32"===i.dtype)return nx(r,i);var a={a:r,b:i};return eE.runKernelFunc((function(e,t){var n=e.realDivide(r,i);return t([r,i]),n}),a,null,cC,{})}});function vx(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],i=1,a=0;a<n.length-1;++a)i*=n[a];var o=e.shape,s=n.slice();s.pop();var c=1;for(a=r;a<e.rank;++a)c*=o[a],s.push(o[a]);var u=yw(e.shape).map((function(e){return e/c})).concat([1]).slice(0,r);return[s,i,c,u]}Object.freeze({prepareAndValidate:vx});function yx(e){return e<=30?e:vw(e,Math.floor(Math.sqrt(e)))}function bx(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(a+" update.rank < "+i+". ");if(e.length<r+(n.rank-i))throw new Error(a+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(a+" update.rank != "+(i+e.length-r));for(var o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(a+" updates.shape["+o+"] ("+n.shape[o]+") != indices.shape["+o+"] ("+t.shape[o]+").");for(o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(a+" updates.shape["+(o+i)+"] ("+n.shape[o+i]+") != shape["+(o+i)+"] ("+e[o+i]+")")}function _x(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}bx(n,t,e)}function wx(e,t,n){for(var r=t.shape.length,i=r>1?t.shape[r-1]:1,a=n.length,o=1,s=i;s<a;++s)o*=n[s];var c=i<1?1:i;return{sliceRank:i,numUpdates:K_(t.shape)/c,sliceSize:o,strides:yw(n.slice(0,i)).concat([1]),outputSize:K_(n)}}Object.freeze({validateUpdateShape:bx,validateInput:_x,calculateShapes:wx});function Ex(e,t,n){G_(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),G_(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){G_(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},i=0;i<e.rank;++i)r(i)}function Sx(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Cx(e,t,n){for(var r=[],i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function xx(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),V_(0,a,s-1)}function Tx(e,t,n,r,i){var a=t[i],o=n[i]||1;(e&1<<i||null==a)&&(a=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return a<0&&(a+=s),o>0?V_(0,a,s):V_(-1,a,s-1)}function Rx(e,t,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function Ix(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}Object.freeze({assertParamsValid:Ex,maskToAxes:Sx,computeOutShape:Cx,startForAxis:xx,stopForAxis:Tx,isSliceContinous:Rx,computeFlatOffset:Ix});function Nx(e){return eE.customGrad(e)}var Ax=SS({softmax_:function(e,t){void 0===t&&(t=-1);var n=dS(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return eE.runKernelFunc((function(e,r){var i=e.softmax(n,t);return r([i]),i}),{logits:n},(function(e,n){var r=n[0],i=e.mul(r);return{logits:function(){return i.sub(i.sum([t],!0).mul(r))}}}),"Softmax",{dim:t},[],[!0])}}),kx=SS({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=dS(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Nx((function(e,n){var r=e.max(t,!0),i=e.sub(r),a=i.toFloat().sub(i.exp().sum(t,!0).log());return n([a]),{value:a,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),Dx=SS({transpose_:function(e,t){var n=dS(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),G_(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){G_(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1)return n.clone();var r={perm:t};return eE.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},null,"Transpose",r)}}),Mx=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),Lx=function(){function e(){}return e.prototype.time=function(e){return Ox("time")},e.prototype.read=function(e){return Ox("read")},e.prototype.readSync=function(e){return Ox("readSync")},e.prototype.numDataIds=function(){return Ox("numDataIds")},e.prototype.disposeData=function(e){return Ox("disposeData")},e.prototype.write=function(e,t,n){return Ox("write")},e.prototype.move=function(e,t,n,r){return Ox("move")},e.prototype.memory=function(){return Ox("memory")},e.prototype.floatPrecision=function(){return Ox("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return Ox("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,Ox("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return Ox("slice")},e.prototype.stridedSlice=function(e,t,n,r){return Ox("stridedSlice")},e.prototype.unstack=function(e,t){return Ox("unstack")},e.prototype.reverse=function(e,t){return Ox("reverse")},e.prototype.concat=function(e,t){return Ox("concat")},e.prototype.neg=function(e){return Ox("neg")},e.prototype.add=function(e,t){return Ox("add")},e.prototype.addN=function(e){return Ox("addN")},e.prototype.subtract=function(e,t){return Ox("subtract")},e.prototype.multiply=function(e,t){return Ox("multiply")},e.prototype.realDivide=function(e,t){return Ox("realDivide")},e.prototype.floorDiv=function(e,t){return Ox("floorDiv")},e.prototype.sum=function(e,t){return Ox("sum")},e.prototype.prod=function(e,t){return Ox("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return Ox("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return Ox("argMin")},e.prototype.argMax=function(e,t){return Ox("argMax")},e.prototype.equal=function(e,t){return Ox("equal")},e.prototype.notEqual=function(e,t){return Ox("notEqual")},e.prototype.less=function(e,t){return Ox("less")},e.prototype.lessEqual=function(e,t){return Ox("lessEqual")},e.prototype.greater=function(e,t){return Ox("greater")},e.prototype.greaterEqual=function(e,t){return Ox("greaterEqual")},e.prototype.logicalNot=function(e){return Ox("logicalNot")},e.prototype.logicalAnd=function(e,t){return Ox("logicalAnd")},e.prototype.logicalOr=function(e,t){return Ox("logicalOr")},e.prototype.where=function(e){return Ox("where")},e.prototype.select=function(e,t,n){return Ox("select")},e.prototype.topk=function(e,t,n){return Ox("topk")},e.prototype.min=function(e,t){return Ox("min")},e.prototype.minimum=function(e,t){return Ox("minimum")},e.prototype.mod=function(e,t){return Ox("mod")},e.prototype.max=function(e,t){return Ox("max")},e.prototype.maximum=function(e,t){return Ox("maximum")},e.prototype.all=function(e,t){return Ox("all")},e.prototype.any=function(e,t){return Ox("any")},e.prototype.squaredDifference=function(e,t){return Ox("squaredDifference")},e.prototype.ceil=function(e){return Ox("ceil")},e.prototype.floor=function(e){return Ox("floor")},e.prototype.round=function(e){return Ox("round")},e.prototype.sign=function(e){return Ox("sign")},e.prototype.isNaN=function(e){return Ox("isNaN")},e.prototype.isInf=function(e){return Ox("isInf")},e.prototype.isFinite=function(e){return Ox("isFinite")},e.prototype.pow=function(e,t){return Ox("pow")},e.prototype.exp=function(e){return Ox("exp")},e.prototype.expm1=function(e){return Ox("expm1")},e.prototype.softmax=function(e,t){return Ox("softmax")},e.prototype.log=function(e){return Ox("log")},e.prototype.log1p=function(e){return Ox("log1p")},e.prototype.sqrt=function(e){return Ox("sqrt")},e.prototype.rsqrt=function(e){return Ox("rsqrt")},e.prototype.square=function(e){return Ox("square")},e.prototype.reciprocal=function(e){return Ox("reciprocal")},e.prototype.relu=function(e){return Ox("relu")},e.prototype.relu6=function(e){return Ox("relu6")},e.prototype.prelu=function(e,t){return Ox("prelu")},e.prototype.elu=function(e){return Ox("elu")},e.prototype.eluDer=function(e,t){return Ox("eluDer")},e.prototype.selu=function(e){return Ox("selu")},e.prototype.int=function(e){return Ox("int")},e.prototype.clip=function(e,t,n){return Ox("clip")},e.prototype.abs=function(e){return Ox("abs")},e.prototype.complexAbs=function(e){return Ox("complexAbs")},e.prototype.sigmoid=function(e){return Ox("sigmoid")},e.prototype.softplus=function(e){return Ox("softplus")},e.prototype.sin=function(e){return Ox("sin")},e.prototype.cos=function(e){return Ox("cos")},e.prototype.tan=function(e){return Ox("tan")},e.prototype.asin=function(e){return Ox("asin")},e.prototype.acos=function(e){return Ox("acos")},e.prototype.atan=function(e){return Ox("atan")},e.prototype.atan2=function(e,t){return Ox("atan2")},e.prototype.sinh=function(e){return Ox("sinh")},e.prototype.cosh=function(e){return Ox("cosh")},e.prototype.tanh=function(e){return Ox("tanh")},e.prototype.asinh=function(e){return Ox("asinh")},e.prototype.acosh=function(e){return Ox("acosh")},e.prototype.atanh=function(e){return Ox("atanh")},e.prototype.erf=function(e){return Ox("erf")},e.prototype.step=function(e,t){return Ox("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,Ox("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return Ox("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return Ox("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return Ox("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,Ox("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return Ox("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return Ox("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return Ox("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return Ox("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return Ox("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return Ox("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return Ox("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return Ox("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return Ox("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return Ox("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return Ox("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return Ox("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return Ox("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return Ox("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return Ox("reshape")},e.prototype.cast=function(e,t){return Ox("cast")},e.prototype.tile=function(e,t){return Ox("tile")},e.prototype.pad=function(e,t,n){return Ox("pad")},e.prototype.transpose=function(e,t){return Ox("transpose")},e.prototype.gather=function(e,t,n){return Ox("gather")},e.prototype.gatherND=function(e,t){return Ox("gatherND")},e.prototype.scatterND=function(e,t,n){return Ox("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return Ox("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return Ox("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return Ox("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return Ox("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return Ox("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return Ox("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,i,a){return Ox("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){return Ox("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,i,a,o){return Ox("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return Ox("multinomial")},e.prototype.oneHot=function(e,t,n,r){return Ox("oneHot")},e.prototype.cumsum=function(e,t,n,r){return Ox("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){return Ox("nonMaxSuppression")},e.prototype.fft=function(e){return Ox("fft")},e.prototype.ifft=function(e){return Ox("ifft")},e.prototype.complex=function(e,t){return Ox("complex")},e.prototype.real=function(e){return Ox("real")},e.prototype.imag=function(e){return Ox("imag")},e.prototype.cropAndResize=function(e,t,n,r,i,a){return Ox("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return Ox("depthToSpace")},e.prototype.split=function(e,t,n){return Ox("split")},e.prototype.sparseToDense=function(e,t,n,r){return Ox("sparseToDense")},e.prototype.diag=function(e){return Ox("diag")},e.prototype.fill=function(e,t,n){return Ox("fill")},e.prototype.onesLike=function(e){return Ox("onesLike")},e.prototype.zerosLike=function(e){return Ox("zerosLike")},e.prototype.linspace=function(e,t,n){return Ox("linspace")},e.prototype.dispose=function(){return Ox("dispose")},e}();function Ox(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Px(e,t,n,r,i,a,o){void 0===o&&(o="channelsLast");var s,c=Vx(t),u=c[0],l=c[1];if("channelsLast"===o)s=[u,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);s=[u,l,e[1],e[1]]}return Fx(e,s,n,r,i,a,!1,o)}function jx(e,t,n,r,i,a,o){void 0===o&&(o="NDHWC");var s,c,u=zx(t),l=u[0],d=u[1],f=u[2];if("NDHWC"===o)c="channelsLast",s=[l,d,f,e[4],e[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);c="channelsFirst",s=[l,d,f,e[1],e[1]]}return Ux(e,s,n,r,i,!1,c,a)}function Fx(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var c=[-1,-1,-1,-1],u=c[0],l=c[1],d=c[2],f=c[3];if("channelsLast"===s)u=e[0],l=e[1],d=e[2],f=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);u=e[0],f=e[1],l=e[2],d=e[3]}var h,p=t[0],m=t[1],g=t[3],v=Vx(n),y=v[0],b=v[1],_=Vx(r),w=_[0],E=_[1],S=Wx(p,w),C=Wx(m,E),x=function(e,t,n,r,i,a,o,s){var c,u,l;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var d=function(e,t,n,r,i){null==r&&(r=Bx(e,t,n));var a=e[1],o=Gx((e[0]-t+2*r)/n+1,i);G_(Q_(o),(function(){return"The output # of rows ("+o+") must be an integer. Change the stride and/or zero pad parameters"}));var s=Gx((a-t+2*r)/n+1,i);return G_(Q_(s),(function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"})),[o,s]}([t,n],a,r,e,s);u=d[0],l=d[1]}else if("same"===e){u=Math.ceil(t/r),l=Math.ceil(n/i);var f=Math.max(0,(u-1)*r+a-t),h=Math.max(0,(l-1)*i+o-n),p=Math.floor(f/2),m=f-p,g=Math.floor(h/2);c={top:p,bottom:m,left:g,right:h-g,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-a+1)/r),l=Math.ceil((n-o+1)/i)}return{padInfo:c,outHeight:u,outWidth:l}}(i,l,d,y,b,S,C,a),T=x.padInfo,R=x.outHeight,I=x.outWidth,N=o?g*f:g;return"channelsFirst"===s?h=[u,N,R,I]:"channelsLast"===s&&(h=[u,R,I,N]),{batchSize:u,dataFormat:s,inHeight:l,inWidth:d,inChannels:f,outHeight:R,outWidth:I,outChannels:N,padInfo:T,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:m,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationHeight:w,dilationWidth:E,inShape:e,outShape:h,filterShape:t}}function Ux(e,t,n,r,i,a,o,s){void 0===a&&(a=!1),void 0===o&&(o="channelsLast");var c=[-1,-1,-1,-1,-1],u=c[0],l=c[1],d=c[2],f=c[3],h=c[4];if("channelsLast"===o)u=e[0],l=e[1],d=e[2],f=e[3],h=e[4];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);u=e[0],h=e[1],l=e[2],d=e[3],f=e[4]}var p,m=t[0],g=t[1],v=t[2],y=t[4],b=zx(n),_=b[0],w=b[1],E=b[2],S=zx(r),C=S[0],x=S[1],T=S[2],R=Wx(m,C),I=Wx(g,x),N=Wx(v,T),A=function(e,t,n,r,i,a,o,s,c,u,l){var d,f,h,p;if("number"==typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,i,a){null==i&&(i=Bx(e,t,r));var o=e[1],s=e[2],c=Gx((e[0]-t+2*i)/r+1,a);G_(Q_(c),(function(){return"The output # of depths ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var u=Gx((o-t+2*i)/r+1,a);G_(Q_(u),(function(){return"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var l=Gx((s-t+2*i)/r+1,a);return G_(Q_(l),(function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"})),[c,u,l,1]}([t,n,r,1],s,0,i,e,l);f=m[0],h=m[1],p=m[2]}else if("same"===e){var g=((f=Math.ceil(t/i))-1)*i+s-t,v=((h=Math.ceil(n/a))-1)*a+c-n,y=((p=Math.ceil(r/o))-1)*o+u-r,b=Math.floor(g/2),_=g-b,w=Math.floor(v/2),E=v-w,S=Math.floor(y/2);d={top:w,bottom:E,left:S,right:y-S,front:b,back:_,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/i),h=Math.ceil((n-c+1)/a),p=Math.ceil((r-u+1)/o)}return{padInfo:d,outDepth:f,outHeight:h,outWidth:p}}(i,l,d,f,_,w,E,R,I,N,s),k=A.padInfo,D=A.outDepth,M=A.outHeight,L=A.outWidth,O=a?y*h:y;return"channelsFirst"===o?p=[u,O,D,M,L]:"channelsLast"===o&&(p=[u,D,M,L,O]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:d,inWidth:f,inChannels:h,outDepth:D,outHeight:M,outWidth:L,outChannels:O,padInfo:k,strideDepth:_,strideHeight:w,strideWidth:E,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:R,effectiveFilterHeight:I,effectiveFilterWidth:N,dilationDepth:C,dilationHeight:x,dilationWidth:T,inShape:e,outShape:p,filterShape:t}}function Bx(e,t,n,r){void 0===r&&(r=1);var i=Wx(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function Vx(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function zx(e){return"number"==typeof e?[e,e,e]:e}function Wx(e,t){return t<=1?e:e+(e-1)*(t-1)}function Gx(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Hx(e){var t=Vx(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}function Yx(e,t){return Hx(e)||Hx(t)}function qx(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function Kx(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=OS(e.shape),i=e.toFloat(),a=n.complex(i,r);return r.dispose(),i.dispose(),a}if(!cw(e.dtype,t))return eE.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e);return a=o.cast(t),o.dispose(),a}if("int32"===t)return n.int(e);if("bool"===t){var s=NS(0,e.dtype);return a=n.notEqual(e,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function Xx(e,t){return eE.makeTensorFromDataId(e.dataId,t,e.dtype)}function Qx(e,t,n){var r=(t-e)/(n-1),i=Ew(n,"float32");i[0]=e;for(var a=1;a<i.length;a++)i[a]=i[a-1]+r;return AS(i,"float32")}Object.freeze({castTensor:Kx,reshapeTensor:Xx,linspaceImpl:Qx,upcastType:Yw,axesAreInnerMostDims:hS,combineLocations:pS,computeOutAndReduceShapes:mS,expandShapeToKeepDim:gS,assertAxesAreInnerMostDims:vS,getAxesPermutation:yS,getUndoAxesPermutation:bS,getInnerMostAxes:_S,getBroadcastDims:gC,getReductionAxes:vC,assertAndGetBroadcastShape:yC,assertParamsConsistent:wS,computeOutShape:ES,computePool2DInfo:Px,computePool3DInfo:jx,computeConv2DInfo:Fx,computeConv3DInfo:Ux,computeDefaultPad:Bx,tupleValuesAreOne:Hx,eitherStridesOrDilationsAreOne:Yx,convertConv2DDataFormat:qx,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:yx});function Jx(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Zx(e,t){return{real:e[2*t],imag:e[2*t+1]}}function $x(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function eT(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function tT(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,i=e.length,a=0,o=!1;r<i;){var s=n(t,e[a=r+(i-r>>>1)]);s>0?r=a+1:(i=a,o=!s)}return o?r:-r-1}(e,t,n||nT)}(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function nT(e,t){return e>t?1:e<t?-1:0}function rT(e,t,n,r,i){return aT(e,t,n,r,i,0).selectedIndices}function iT(e,t,n,r,i,a){var o=aT(e,t,n,r,i,a,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function aT(e,t,n,r,i,a,o,s){void 0===o&&(o=!1),void 0===s&&(s=!1);for(var c=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>i})).sort(cT),u=a>0?-.5/a:0,l=[],d=[];l.length<n&&c.length>0;){var f=c.pop(),h=f.score,p=f.boxIndex,m=f.suppressBeginIndex;if(h<i)break;for(var g=!1,v=l.length-1;v>=m;--v){var y=oT(e,p,l[v]);if(y>=r){g=!0;break}if(f.score=f.score*sT(r,u,y),f.score<=i)break}f.suppressBeginIndex=l.length,g||(f.score===h?(l.push(p),d.push(f.score)):f.score>i&&tT(c,f,cT))}var b=l.length;return s&&(l.fill(0,b),d.fill(0,b)),{selectedIndices:AS(l,"int32"),selectedScores:AS(d,"float32"),numValidOutputs:NS(b,"int32")}}function oT(e,t,n){var r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),u=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),h=(s-a)*(c-o),p=(d-u)*(f-l);if(h<=0||p<=0)return 0;var m=Math.max(a,u),g=Math.max(o,l),v=Math.min(s,d),y=Math.min(c,f),b=Math.max(v-m,0)*Math.max(y-g,0);return b/(h+p-b)}function sT(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function cT(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function uT(e,t,n){var r=new Array(e.rank).fill(0),i=e.shape.slice();return t.map((function(t){i[n]=t;var a=e.slice(r,i);return r[n]+=t,a}))}function lT(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var i=YS(n,e.dtype);for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),o=new Array(e.rank),s=0;s<o.length;s++)o[s]=a[s]%e.shape[s];var c=e.locToIndex(o);i.values[r]=e.values[c]}return i.toTensor()}function dT(e,t,n,r,i){for(var a=t[t.length-1],o=[e.length/a,a],s=o[0],c=o[1],u=iw(n,s*r),l=iw("int32",s*r),d=0;d<s;d++){for(var f=d*c,h=e.subarray(f,f+c),p=[],m=0;m<h.length;m++)p.push({value:h[m],index:m});p.sort((function(e,t){return t.value-e.value}));var g=d*r,v=u.subarray(g,g+r),y=l.subarray(g,g+r);for(m=0;m<r;m++)v[m]=p[m].value,y[m]=p[m].index}var b=t.slice();return b[b.length-1]=r,[RS(u,b,n),RS(l,b,"int32")]}function fT(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var i=YS(e,"int32"),a=YS([n.length,e.length],"int32");for(r=0;r<n.length;r++){var o=i.indexToLoc(n[r]),s=r*e.length;a.values.set(o,s)}return a.toTensor()}var hT=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},pT=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},mT=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,a=e.inSize,o=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===t?">":"<",c=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+c+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function gT(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function vT(e,t){return 1===t?[e]:gT(e,t)}function yT(){var e,t,n,r,i,a,o,s,c,u;return 2===A_().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",a="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",c="",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",a="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:a,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:c,defineRound:u}}function bT(e,t,n){void 0===n&&(n="index");var r=yw(t);return r.map((function(t,i){return"int "+e[i]+" = "+n+" / "+t+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+t:"index -= "+e[i]+" * "+t)+";"})).join("")}function _T(e){var t=yw(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var wT="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function ET(e,t,n,r){var i=[];e.forEach((function(e){var t=K_(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(i.push("uniform sampler2D "+e.name+";"),i.push("uniform int offset"+e.name+";"))}));var a,o,s=i.join("\n"),c=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?CT(e):ST(e);var i=e.shapeInfo.logicalShape,a=t.logicalShape;return i.length<=a.length&&(r+=n?function(e,t){var n,r=e.name,i=r.charAt(0).toUpperCase()+r.slice(1),a="get"+i+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,c=gC(e.shapeInfo.logicalShape,t.logicalShape),u=kT(s),l=s-o,d=["x","y","z","w","u","v"];n=0===o?"":s<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords."+d[e+l]+" = 0;"})).join("\n");var f;f=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+d[t+l]})).join(", ");var h="return outputValue;",p=1===K_(e.shapeInfo.logicalShape),m=1===K_(t.logicalShape);if(1!==o||p||m){if(p&&!m)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var g=o-2,v=o-1;c.indexOf(g)>-1&&c.indexOf(v)>-1?h="return vec4(outputValue.x);":c.indexOf(g)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(v)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+u+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+i+"("+f+");\n      "+h+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",a=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===c&&null==e.shapeInfo.flatOffset&&X_(o,a))return"\n      float "+i+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var u,l=kT(c),d=gC(e.shapeInfo.logicalShape,t.logicalShape),f=c-s,h=["x","y","z","w","u","v"];u=0===s?"":c<2&&d.length>=1?"coords = 0;":d.map((function(e){return"coords."+h[e+f]+" = 0;"})).join("\n");var p;return p=c<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+h[t+f]})).join(", "),"\n    float "+i+"() {\n      "+l+" coords = getOutputCoords();\n      "+u+"\n      return get"+r+"("+p+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),u=t.texShape,l=yT(),d=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),f=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+xT+"\n    "+TT+"\n    "+RT+"\n  "}(l);return t.isPacked?(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(X_(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      int index = resTexRC.x * "+i[1]+" + resTexRC.y;\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),i=r*Math.ceil(e[e.length-2]/2),a=i,o="",s="b, r, c",c=2;c<e.length-1;c++)o="\n      int b"+c+" = index / "+(a*=e[e.length-c-1])+";\n      index -= b"+c+" * "+a+";\n    "+o,s="b"+c+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+o+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,i,a,o}(t.logicalShape,u),o=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(l)):(a=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return X_(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=bT(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=bT(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=bT(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=bT(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,u),o=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(f+=IT),[f,d,o,s,a,c,n].join("\n")}function ST(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===i&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+o[0]+", "+o[1]+", "+NT(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+AT(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,i=r[0],a=r[1];if(1===a&&1===i)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var o=NT(t);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+o+") + 0.5) / "+i+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+o+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+a+", index + "+o+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape;if(null!=i&&X_(t,i)){var a=i[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var o=rw(t),s=o.newShape,c=o.keptDims,u=s;if(u.length<t.length)return"\n      "+ST(DT(e,u))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+MT(["row","col"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+AT(e)+"\n      }\n    ";var l=i[0],d=i[1],f=NT(n);return 1===d?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+f+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+f+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+d+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+f+";\n    vec2 uv = uvFromFlat("+l+", "+d+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],a=t[2],o=rw(t),s=o.newShape,c=o.keptDims,u=s;if(u.length<t.length)return"\n        "+ST(DT(e,u))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+MT(["row","col","depth"],c)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+i+", "+a+", 1)));\n        "+AT(e)+"\n      }\n    ";var l=e.shapeInfo.texShape,d=l[0],f=l[1],h=e.shapeInfo.flatOffset;return f===i&&null==h?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+f+".0, "+d+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":f===a&&null==h?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+".0, "+d+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+i+" + col * "+a+" + depth + "+NT(n)+";\n        vec2 uv = uvFromFlat("+d+", "+f+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],a=t[2]*i,o=t[1]*a,s=rw(t),c=s.newShape,u=s.keptDims;if(c.length<t.length)return"\n      "+ST(DT(e,c))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+MT(["row","col","depth","depth2"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+o+", "+a+", "+i+", 1)));\n        "+AT(e)+"\n      }\n    ";var l=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,f=d[0],h=d[1];return h===o&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":h===i&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+o+" + col * "+a+" +\n          depth * "+i+" + depth2;\n      vec2 uv = uvFromFlat("+f+", "+h+", index + "+NT(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],a=t[3]*i,o=t[2]*a,s=t[1]*o,c=rw(t),u=c.newShape,l=c.keptDims;if(u.length<t.length)return"\n      "+ST(DT(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+MT(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+o+", "+a+", "+i+")) +\n          depth3;\n        "+AT(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],p=f[1];return p===s&&null==d?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+o+", "+a+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===i&&null==d?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+o+" + depth * "+a+" +\n          depth2 * "+i+" + depth3 + "+NT(n)+";\n      vec2 uv = uvFromFlat("+h+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=rw(t),a=i.newShape,o=i.keptDims;if(a.length<t.length)return"\n      "+ST(DT(e,a))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+MT(["row","col","depth","depth2","depth3","depth4"],o)+");\n      }\n    ";var s=t[5],c=t[4]*s,u=t[3]*c,l=t[2]*u,d=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+d+", "+l+", "+u+", "+c+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+AT(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],m=h[1];return m===d&&null==f?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+u+", "+c+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===s&&null==f?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+d+" + col * "+l+" + depth * "+u+" +\n          depth2 * "+c+" + depth3 * "+s+" + depth4 + "+NT(n)+";\n      vec2 uv = uvFromFlat("+p+", "+m+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function CT(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+yT().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=yT();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return "+a.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=i[0],o=i[1],s=yT();if(null!=i&&X_(t,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+o+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+c[0]+", "+c[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===t[0])return"\n        "+CT(DT(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+MT(["b","row","col"],[1,2])+");\n        }\n      ";var o=a[0],s=a[1],c=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+o+", "+s+", "+c*Math.ceil(t[1]/2)+", "+c+", b, row, col);\n      return "+yT().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),a=e.shapeInfo.texShape,o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=o[0],c=o[1],u=Math.ceil(t[n-1]/2),l=u*Math.ceil(t[n-2]/2),d="int b, int row, int col",f="b * "+l+" + (row / 2) * "+u+" + (col / 2)",h=2;h<n-1;h++)d="int b"+h+", "+d,f="b"+h+" * "+(l*=t[n-h-1])+" + "+f;return"\n    vec4 "+i+"("+d+") {\n      int index = "+f+";\n      int texR = index / "+c+";\n      int texC = index - texR * "+c+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+c+", "+s+");\n      return "+yT().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var xT="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",TT="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",RT="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",IT="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function NT(e){return"offset"+e}function AT(e){var t=e.name,n=K_(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function kT(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function DT(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function MT(e,t){return t.map((function(t){return e[t]})).join(", ")}var LT=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,G_(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var i=e[e.length-1],a=Math.ceil(i/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var o,s,c=this.outputShape,u=c.length,l=kT(u),d=vT("coords",u);if(1===a){var f=kT(s=u+1);o="\n        "+f+" sourceLocR = "+f+"("+d.join()+", 0);\n        ++"+d[u-1]+";\n        "+f+" sourceLocG = "+f+"("+d.join()+", 0);\n        ++"+d[u-2]+";\n        "+f+" sourceLocA = "+f+"("+d.join()+", 0);\n        --"+d[u-1]+";\n        "+f+" sourceLocB = "+f+"("+d.join()+", 0);\n        --"+d[u-2]+";"}else s=u,o="\n        "+l+" sourceLocR = coords;\n        ++"+d[u-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+d[u-2]+";\n        "+l+" sourceLocA = coords;\n        --"+d[u-1]+";\n        "+l+" sourceLocB = coords;\n        --"+d[u-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],m=h.map((function(e){return"int "+e})),g=vT("sourceLocR",s-1).concat("inIdx.r"),v=vT("sourceLocG",s-1).concat("inIdx.g"),y=vT("sourceLocB",s-1).concat("inIdx.b"),b=vT("sourceLocA",s-1).concat("inIdx.a"),_="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",E="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",S=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+S+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+d[u-1]+" < "+(c[u-1]-1)+";\n        bool hasNextRow = "+d[u-2]+" < "+(c[u-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+E+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+E+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+_+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},OT=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=s-1-e.padInfo.top,l=c-1-e.padInfo.left,d=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+u+", "+l+");\n      const float avgMultiplier = float("+d+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+c+";\n            wC+= "+o+") {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},PT=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=l-1-e.padInfo.front,p=d-1-e.padInfo.top,m=f-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+h+", "+p+", "+m+");\n      const float avgMultiplier = float("+g+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+i+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+d+";\n              wR += "+c+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+u+") {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jT=function(e,t,n,r,i,a){this.outputShape=[],this.variableNames=["x","mean","variance"],yC(e,t),yC(e,n);var o="0.0";null!=r&&(yC(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="1.0";null!=i&&(yC(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+o+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},FT=function(e,t,n,r,i,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],yC(e,t),yC(e,n);var o="vec4(0.0)";null!=r&&(yC(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=i&&(yC(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+o+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},UT=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=yC(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},BT="return a + b;",VT="return a - b;",zT="return a * b;",WT="return (a < 0.) ? b * a : a;",GT=function(e,t,n){this.variableNames=["A","B"],this.outputShape=yC(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},HT="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",YT=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=yC(t,n);var i=this.outputShape.length,a="";if(r)if(0===i||1===K_(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+kT(i)+" coords = getOutputCoords();\n        ",1===i)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var o=vT("coords",i);a+="\n            bool nextRowOutOfBounds =\n              ("+o[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+o[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},qT=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),KT=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),XT=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},QT=function(e){this.outputShape=[],this.outputShape=ES(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var i=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var a=t.length,o=t[t.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+o+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},JT=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ES(e,t);var n=this.outputShape,r=n.length,i=kT(r),a=vT("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var s=new Array(e.length-1);s[0]=e[0][t];for(var c=1;c<s.length;c++)s[c]=s[c-1]+e[c][t];var u=o[t],l=o.slice(-2),d=o.join(),f="if ("+u+" < "+s[0]+") {\n        return getChannel(\n            getT0("+d+"), vec2("+l.join()+"));\n        }";for(c=1;c<s.length;c++){var h=s[c-1];f+="\n        if ("+u+" < "+s[c]+"  && "+u+" >= "+s[c-1]+") {\n          return getChannel(\n            getT"+c+"("+ZT(o,u,h)+"),\n            vec2("+ZT(l,u,h)+"));\n        }"}var p=s.length,m=s[s.length-1];f+="\n        return getChannel(\n          getT"+p+"("+ZT(o,u,m)+"),\n          vec2("+ZT(l,u,m)+"));",this.userCode="\n      float getValue("+o.map((function(e){return"int "+e}))+") {\n        "+f+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function ZT(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?e+" - "+n:e})).join()}var $T=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},eR=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a="channelsLast"===e.dataFormat,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,c=a?1:2,u=a?2:3,l=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+c+"], coords["+u+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},tR=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,a=e.padInfo.top,o=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+i+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+o+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},nR=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=t-1-e.padInfo.front,c=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+c+", "+u+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+i+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+o+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},rR=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},iR=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,a=t-1-e.padInfo.top,o=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},aR=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.padInfo.top,a=e.padInfo.left,o=e.strideHeight,s=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,d=e.filterWidth,f=4*Math.floor(e.inChannels/4),h=e.inChannels%4,p="channelsLast"===e.dataFormat,m=p?1:2,g=p?2:3,v=p?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+i+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+f+") *\n                    getW(wR, wC, "+f+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+f+", xR, xC) *\n                    getW(wR, wC, "+f+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1),\n                  getX(batch, xR, xC, "+f+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC),\n                  getX(batch, "+f+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+_+"\n        "+b+"\n        setOutput(result);\n      }\n    "},oR=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,a=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.filterDepth,d=e.filterHeight,f=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+a+", "+o+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+c+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+u+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},sR=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,p=e.outChannels/e.inChannels,m="",g="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",g="result = activation(result);");var v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+c+", "+u+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+d+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+g+"\n        setOutput(result);\n      }\n    "},cR=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var i=e.inHeight,a=e.inWidth,o=e.padInfo.top,s=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,p=h,m="int xR; int xC; int xCOffset;",g=0;g<f;g++)for(var v=0;v<h;v++)m+="\n          vec4 xTexelR"+g+"C"+2*v+" = vec4(0.);\n          vec4 wR"+g+"C"+v+" = vec4(0.);\n          vec4 xR"+g+"C"+v+" = vec4(0.);";for(g=0;g<f;g++)for(var y=0;y<p;y++){if(m+="\n          xR = xRCorner + "+g*l+";\n          xC = xCCorner + "+(v=2*y)*d+";\n        ",1===u){if(v<h&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+g+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+".xy);\n                } else {\n                  xR"+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = xTexelR"+g+"C"+v+";\n              ",v+1<h)){var b=s%2==0?z_(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",d>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+v+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+";\n                "}}else v<h&&(m+="\n              if(xR >= 0 && xR < "+i+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+u+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n              ",v+1<h&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+u+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+u+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+".xy);\n              ",v+1<h&&(m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n                ")),m+="}");v<h&&(m+="\n            vec4 wTexelR"+g+"C"+v+" = getW("+g+", "+v+", d1, q);\n            wR"+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+".xz);\n          ",v+1<h&&(m+="\n              vec4 wTexelR"+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+", d1, q);\n              wR"+g+"C"+(v+1)+" =\n                vec4(wTexelR"+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<f;g++)for(v=0;v<h;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var _="",w="";n&&(_=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var E=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+_+"\n\n      const ivec2 strides = ivec2("+c+", "+u+");\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+E+"\n        "+w+"\n        setOutput(result);\n      }\n    "},uR=function(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=e[0],o=e[1],s=e[2],c=e[3],u=t[0],l=n[0],d=n[1];this.outputShape=[u,l,d,c];var f="bilinear"===r?1:0,h=[o-1+".0",s-1+".0"],p=h[0],m=h[1],g=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=g[0],y=g[1],b=g[2],_=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=_[0],E=_[1],S=_[2];this.userCode="\n      const float height_ratio = float("+v+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+E+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+S+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+f+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},lR=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=e[e.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+kT(r)+" coords = getOutputCoords();\n        int end = "+dR(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+dR(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function dR(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var fR=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=rE.DENSE;var t=dE(e),n=yT();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+bT(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},hR=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=rE.DENSE;var t=dE(e),n=yT();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+bT(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},pR=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),mR=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},gR=function(e){this.variableNames=["A"],this.outTexUsage=iE.DOWNLOAD;var t=yT();this.outputShape=e,this.userCode="\n      "+wT+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},vR=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=iE.DOWNLOAD;var t=yT();this.outputShape=e,this.userCode="\n      "+wT+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},yR=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=yT(),i=t[0],a=t[1];this.outputShape=e;var o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode="\n      "+_T(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+o+", 0., 0., 0.);\n      }\n    "},bR=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=yT(),i=t[0],a=t[1];this.outputShape=e;var o="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var u=0;u<=1;u++){var l=2*c+u;o+="\n          localCoords = coords;\n          if(localCoords[2] + "+u+" < "+e[2]+") {\n            localCoords[2] += "+u+";\n            if(localCoords[1] + "+c+" < "+e[1]+") {\n              localCoords[1] += "+c+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+_T(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+o+"\n\n        "+r.output+" = "+s+";\n      }\n    "},_R=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},wR=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),ER=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var i=kT(this.rank),a=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],a=0;a<e.length;a++)a===t?i.push("int(getIndices("+r[a]+"))"):i.push(""+r[a]);return i.join()}(e,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},SR=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=kT(t.length),i=kT(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function CR(e,t){var n=yT();return yE(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function xR(e,t){return TE(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function TR(e,t){return RE(e,t,new Uint16Array([0,1,2,2,1,3]))}function RR(e,t,n,r,i,a,o){NE(n,r);var s=IE(e,t),c=e.TEXTURE_2D;return pE(e,t,(function(){return e.bindTexture(c,s)})),pE(e,t,(function(){return e.texParameteri(c,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),pE(e,t,(function(){return e.texParameteri(c,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),pE(e,t,(function(){return e.texParameteri(c,e.TEXTURE_MIN_FILTER,e.NEAREST)})),pE(e,t,(function(){return e.texParameteri(c,e.TEXTURE_MAG_FILTER,e.NEAREST)})),pE(e,t,(function(){return e.texImage2D(c,0,i,n,r,0,a,o,null)})),pE(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function IR(e,t,n,r,i){var a=lE(n,r);return RR(e,t,a[0],a[1],i.internalFormatFloat,i.textureFormatFloat,e.FLOAT)}function NR(e,t,n,r,i){var a=lE(n,r);return RR(e,t,a[0],a[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function AR(e,t,n,r,i){var a=lE(n,r);return RR(e,t,a[0],a[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function kR(e,t,n,r,i){var a=fE(n,r);return RR(e,t,a[0],a[1],i.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function DR(e,t,n,r,i){var a=fE(n,r);return RR(e,t,a[0],a[1],i.internalFormatPackedHalfFloat,e.RGBA,i.textureTypeHalfFloat)}function MR(e,t,n,r){return pE(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),kE(e,t,n,"clipSpacePos",r,3,20,0)&&kE(e,t,n,"uv",r,2,20,12)}function LR(e,t,n,r,i,a,o){var s,c,u;pE(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),a instanceof Uint8Array?(s=new Uint8Array(r*i*4),c=e.UNSIGNED_BYTE,u=e.RGBA):(s=new Float32Array(r*i*4),c=e.FLOAT,u=o.internalFormatPackedFloat),s.set(a),pE(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,r,i,0,e.RGBA,c,s)})),pE(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function OR(e,t,n,r){pE(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?pE(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):pE(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),pE(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function PR(e,t,n,r,i){var a=e.createBuffer();pE(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var o=16*n*r;return pE(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),pE(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),pE(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function jR(e,t,n){var r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function FR(e,t,n,r,i){var a=lE(n,r),o=a[0],s=a[1],c=new Uint8Array(n*r*4);return pE(e,t,(function(){return e.readPixels(0,0,o,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,c)})),new Float32Array(c.buffer)}function UR(e,t,n,r,i,a,o,s){var c=e,u=new Float32Array(function(e,t){var n=fE(e,t);return n[0]*n[1]*4}(a,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,u),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u}function BR(e,t,n,r){var i=new Float32Array(n*r*4);return pE(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,i)})),i}var VR=Object.freeze({createVertexShader:CR,createVertexBuffer:xR,createIndexBuffer:TR,createFloat32MatrixTexture:IR,createFloat16MatrixTexture:NR,createUnsignedBytesMatrixTexture:AR,createPackedMatrixTexture:kR,createFloat16PackedMatrixTexture:DR,bindVertexProgramAttributeStreams:MR,uploadDenseMatrixToTexture:LR,uploadPixelDataToTexture:OR,createBufferFromOutputTexture:PR,downloadFloat32MatrixFromBuffer:jR,downloadByteEncodedFloatMatrixFromOutputTexture:FR,downloadPackedMatrixFromBuffer:UR,downloadMatrixFromPackedOutputTexture:BR}),zR=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=A_().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,cE(t,e)):this.gl=uE(t);var n="WEBGL_color_buffer_float";if(1===A_().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=vE(this.gl,this.debug,"OES_texture_float"),JE(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=vE(this.gl,this.debug,"OES_texture_half_float");else if(A_().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),JE(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=vE(this.gl,this.debug,"EXT_color_buffer_half_float");else if(A_().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",JE(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!JE(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=xR(this.gl,this.debug),this.indexBuffer=TR(this.gl,this.debug),this.framebuffer=AE(this.gl,this.debug),this.textureConfig=hE(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return A_().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;pE(t,this.debug,(function(){return t.finish()})),pE(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),pE(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),pE(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),pE(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),pE(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),IR(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),NR(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),AR(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),OR(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),LR(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),DR(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),kR(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(jE(this.gl,this.debug,this.framebuffer),this.outputTexture=null),pE(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return FR(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,i,a){return UR(this.gl,e,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return jR(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=PR(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(A_().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(a,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=a}else A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return BR(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=bE(t,this.debug,e),r=CR(t,this.debug),i=SE(t,this.debug);return pE(t,this.debug,(function(){return t.attachShader(i,r)})),pE(t,this.debug,(function(){return t.attachShader(i,n)})),CE(t,this.debug,i),this.debug&&xE(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=MR(t,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&pE(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&xE(this.gl,this.debug,this.program),pE(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?ME(this.gl,this.debug,e,t):LE(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),pE(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),OE(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=fE(t,n),i=r[0],a=r[1];this.setOutputMatrixTextureDriver(e,i,a)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&xE(this.gl,this.debug,this.program),FE(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),pE(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),pE(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=vE(this.gl,this.debug,2===A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(2!==A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return R_(this,void 0,void 0,(function(){var t=this;return I_(this,(function(n){switch(n.label){case 0:return[4,ew((function(){return t.disposed||t.isQueryAvailable(e,A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||ew((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),PE(this.gl,this.debug,e,this.framebuffer),this.debug&&FE(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(PE(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&FE(this.gl)):jE(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;PE(r,this.debug,e,this.framebuffer),this.debug&&FE(r),this.outputTexture=e,pE(r,this.debug,(function(){return r.viewport(0,0,t,n)})),pE(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var i=this;this.throwIfDisposed(),pE(this.gl,this.debug,(function(){return i.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function WR(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,i=t[n],a=i.shape;if(!X_(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var o=e.texShape,s=i.isUniform?null:i.texData.texShape;if(!X_(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+s+" must match")}}))}var GR=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,i=n.inChannels,a=n.strideWidth,o=n.strideHeight,s=n.padInfo,c=n.outWidth,u=n.dilationWidth,l=n.dilationHeight,d=n.dataFormat,f=s.left,h=s.top,p=i*r,m=yT(),g="channelsLast"===d,v=g?0:1,y=g?1:2,b="",_=0;_<=1;_++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+_+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+c+")) * "+o+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+t[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+c+".) * "+a+". - "+f+".);\n              d1 = offsetX + "+u+" * (int(mod(float(pos), "+p+".) / "+i+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*_+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*_+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+m.output+" = result;\n      }\n    "},HR=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];var a,o=t,s=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+c+")":1===i?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},YR=function(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},qR=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,o=t,s=e[3]-1;this.outputShape=e;var c="float("+n+") + float("+r+") * sum";a=.5===i?"inversesqrt("+c+")":1===i?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},KR=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,a=e.effectiveFilterWidth,o=i-1-e.padInfo.top,s=a-1-e.padInfo.left,c=i*a-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+c+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},XR=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,o=e.dilationWidth,s=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.front,d=c-1-e.padInfo.top,f=u-1-e.padInfo.left,h=s*c*u-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+d+", "+f+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+i+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+c+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+u+";\n                wC += "+o+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+h+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+c+" * "+u+" +\n                  wR * "+u+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},QR=function(e,t,n,r,i,a,o){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=null),void 0===o&&(o=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],c=Math.ceil(s/2),u=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",d=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";a&&(h=o?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",p="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+c+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+c+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+d[0]+" * "+f[0]+");\n          result += ("+d[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},JR=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),ZR=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},$R=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=vT("rc",t),r=kT(t),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",i=e-2;i<e;i++)r+=n[i]+" >= "+t[i],i<e-1&&(r+="||");return r}(t,e,n),a=function(e,t,n,r){if(1===e)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),o=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var a=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),o=2;o<e;o++)a=t[t.length-1-o]+","+a;n.push(a)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+o+"));\n          }\n        }\n      "}},eI=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,i=kT(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+a+");\n      "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+o+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},tI=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,i=kT(r),a=t.map((function(e){return e[0]})).join(","),o=t.map((function(t,n){return t[0]+e[n]})).join(","),s=vT("rc",r),c=vT("source",r),u=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+c.slice(-2).join()+")",d=[i+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+u+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+u+") {"],f=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,m=1===r?2:4;p<m;p++)h+="\n        "+d[p]+"\n        if ("+f+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+i+" source = rc - start;\n          result["+p+"] = getChannel(getX("+c.join()+"), "+l+");\n        }\n      ";h+=1===r?"} ":"}}",this.userCode="\n      const "+i+" start = "+i+"("+a+");\n      const "+i+" end = "+i+"("+o+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+h+"\n        setOutput(result);\n      }\n    "},nI=function(e,t,n,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,o=e.strideHeight,s=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var p="avg"===t,m="((batch  * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + d",g="(xR * "+e.inWidth+" + xC) * "+e.inChannels+" + d",v="0.0";if(p||(v="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+s+");\n        const ivec2 pads = ivec2("+f+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+l+";\n              wR += "+c+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+u+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = "+(r?i?m:g:"wR * "+d+" + wC")+";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(a/4),_=a%4,w="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+s+");\n      const ivec2 pads = ivec2("+f+", "+h+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+l+";\n            wR += "+c+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+b+"; wC += 4) {\n            int xC = xCCorner + wC * "+u+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+u+", d),\n              getValue(batch, xR, xC + 2 * "+u+", d),\n              getValue(batch, xR, xC + 3 * "+u+", d)\n            );\n\n            "+w+"\n          }\n\n          int xC = xCCorner + "+b+";\n          if ("+(1===_)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(2===_)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+u+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(3===_)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+u+", d),\n              getValue(batch, xR, xC + 2 * "+u+", d),\n              initializationValue\n            );\n\n            "+w+"\n          }\n        }\n        setOutput("+y+");\n      }\n    "}},rI=function(e,t,n,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var a=e.filterWidth,o=e.strideDepth,s=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,l=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;var y="avg"===t,b="0.0";if(y||(b="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+s+", "+c+");\n        const ivec3 pads = ivec3("+m+", "+g+", "+v+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+f+";\n              wD += "+u+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+l+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+p+";\n                  wC += "+d+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = "+(r?i?"(((batch * "+e.inDepth+" + xD) * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"((xD * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"wD * "+h+" * "+p+" +\n                      wR * "+p+" + wC")+";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var _=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(_="avgValue / count");var w=4*Math.floor(a/4),E=a%4,S="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+s+", "+c+");\n      const ivec3 pads = ivec3("+m+", "+g+", "+v+");\n      const float initializationValue = "+b+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+b+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+f+";\n            wD += "+u+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+l+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+d+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+d+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+d+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+d+", ch)\n              );\n\n              "+S+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(1===E)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+S+"\n            } else if ("+(2===E)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+d+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+S+"\n            } else if ("+(3===E)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+d+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+d+", ch),\n                initializationValue\n              );\n\n              "+S+"\n            }\n          }\n          setOutput("+_+");\n        }\n      }\n    "}},iI=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=Math.ceil(i/n);this.outputShape=[r,a];var o="0.0",s="";"prod"===t?o="1.0":"min"===t?(o="1.0 / 1e-20",s="min"):"max"===t&&(o="-1.0 / 1e-20",s="max");var c=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?c="sumValue":"prod"===t?c="prodValue":"all"===t?c="allValue":"any"===t&&(c="anyValue");var u=4*Math.floor(n/4),l=n%4,d="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",f="vec4";"all"===t?(o="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===t&&(o="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+o+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+o+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+u+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+u+";\n        if ("+(1===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+c+");\n      }\n    "},aI=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+bT(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+_T(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},oI=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],c=o[2],u=[n&&s>1?i-1:i,n&&c>1?a-1:a],l=[n&&s>1?s-1:s,n&&c>1?c-1:c],d=u[0]/l[0],f=u[1]/l[1],h=1/d,p=1/f,m=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},sI=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var c=[r&&t>1?a-1:a,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},cI=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var c=[r&&t>1?a-1:a,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+",\n          "+c[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},uI=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],a=r[2],o=e.shape,s=o[1],c=o[2],u=[n&&s>1?i-1:i,n&&c>1?a-1:a],l=[n&&s>1?s-1:s,n&&c>1?c-1:c],d=u[0]/l[0],f=u[1]/l[1],h=1/d,p=1/f,m=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+c+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+u[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+u[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},lI=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],a=e[1],o=e[2],s=e[3];this.outputShape=[i,t,n,s];var c=[r&&t>1?a-1:a,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+c[0]/u[0]+",\n          "+c[1]/u[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},dI=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),i=kT(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},fI=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=vT("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],o=kT(n);function s(n){var r=e.map((function(r,i){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(i,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+o+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+i+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},hI=function(e,t,n,r,i,a,o){void 0===o&&(o=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=kT(i.length),c=kT(a.length),u="";1===n?u="i":2===n&&(u="i, j");var l="getIndices("+u+")",d="";1===r?d="i":2===r&&(d="i, coords[1]");var f="getUpdates("+d+")",h=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+i+");\n\n        void main() {\n          "+c+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+h+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+f+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},pI=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,i=e.inSize,a=e.numSegments,o=a*Math.ceil(i/n);this.outputShape=[r,o];var s=4*Math.floor(n/4),c=n%4,u="\n        sumValue += dot(values, segFilter);\n    ",l="";i%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var d="";i%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+u+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+u+"\n        } else if ("+(2===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+u+"\n        } else if ("+(3===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+u+"\n        }\n        setOutput(sumValue);\n      }\n    "},mI=function(e,t,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],s=[],c=0;c<t.length;c++)s.push(""+a[c]),c<e&&o.push(""+a[c]);r=o.join(),i=s.join()}var u=kT(n);this.userCode="\n      void main() {\n        "+u+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},gI=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=kT(this.rank),r="uniform int start["+this.rank+"];",i=function(e){if(1===e)return"sourceLoc";if(e<=6)return vI.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+vI[t]+" = start["+t+"] + coords."+vI[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),vI=["x","y","z","w","u","v"],yI=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=kT(this.rank),n=vT("coords",this.rank),r=vT("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+i+")",o="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+o+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),bI=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=kT(n.length),a=kT(n.length),o="";if(1===r)o="coords * strides + begin";else{var s=0;o=n.map((function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+e+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "},_I=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,i=wI(t,n),a=EI(e,i,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[a].shift();return this.usedTextures[a].push(o),o}return this.numUsedTextures++,this.log(),i===aE.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===aE.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===aE.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===aE.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===aE.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var i=EI(t,wI(n,r),r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],o=a.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(o,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function wI(e,t){if(e===iE.UPLOAD)return aE.PACKED_2X2_FLOAT32;if(e===iE.RENDER||null==e)return function(e){return A_().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?aE.PACKED_2X2_FLOAT32:aE.UNPACKED_FLOAT32:e?aE.PACKED_2X2_FLOAT16:aE.UNPACKED_FLOAT16}(t);if(e===iE.DOWNLOAD||e===iE.PIXELS)return aE.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function EI(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var SI=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var i=kT(this.rank),a=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<e.length;i++)r.push("imod("+n[i]+", "+e[i]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},CI=1.7580993408473768,xI=1.0507009873554805,TI=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},RI="if (isnan(x)) return x;",II="return abs(x);",NI=RI+"\n  return (x < 0.0) ? 0.0 : x;\n",AI=RI+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",kI="return (x >= 0.0) ? x : (exp(x) - 1.0);",DI="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+CI+";\n  float scale = "+xI+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",MI="return -x;",LI="return ceil(x);",OI="return floor(x);",PI="return exp(x);",jI="return exp(x) - 1.0;",FI=RI+"\n  return sin(x);\n",UI=RI+"\n  return cos(x);\n",BI=RI+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",VI=RI+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",zI=RI+"\n  return atan(x);\n",WI=RI+"return log(x + sqrt(x * x + 1.0));",GI=RI+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",HI=RI+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",YI="return x;",qI="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",KI="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",XI="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",QI=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},JI=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=vT("rc",t),r=kT(t),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),a=n.slice(-2),o=t<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+o+"));\n      }\n    "},ZI={};function $I(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?qI:NI;if("elu"===e)return t?XI:kI;if("relu6"===e)return t?KI:AI;if("prelu"===e)return t?HT:WT;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var eN=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!A_().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var i=uE(A_().getNumber("WEBGL_VERSION"));r.binaryCache=((n=A_().getNumber("WEBGL_VERSION"))in ZI||(ZI[n]={}),ZI[n]),r.gpgpu=new zR(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new _I(r.gpgpu),r.numMBBeforeWarning=null==A_().global.screen?1024:A_().global.screen.height*A_().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new Mx(r,eE),r}return T_(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(A_().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:iE.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(A_().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:iE.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,i=t.complexTensors,a=t.slice,o=t.shape,s=t.isPacked;if(null!=a){var c;c=s?new QI(o,YI):new TI(o,YI);var u=this.runWebGLProgram(c,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(u.dataId);return this.disposeData(u.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var d,f,h=null!=this.activeTimers;return h&&(d=Sw()),f="complex64"===r?Jx(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=Sw()-d),this.convertAndCacheOnCPU(e,f)},t.prototype.read=function(e){return R_(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w,E;return I_(this,(function(S){switch(S.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(n=this.texData.get(e),r=n.values,i=n.shape,a=n.slice,o=n.dtype,s=n.complexTensors,c=n.isPacked,null!=a)return void 0,u=c?new QI(i,YI):new TI(i,YI),l=this.runWebGLProgram(u,[{dataId:e,shape:i,dtype:o}],o),d=this.read(l.dataId),this.disposeData(l.dataId),[2,d];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!A_().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===A_().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return f=null,"complex64"!==o&&A_().get("WEBGL_BUFFER_SUPPORTED")&&(h=this.decode(e),p=this.texData.get(h.dataId),f=(E=this.gpgpu).createBufferFromTexture.apply(E,[p.texture].concat(dE(i)))),this.pendingRead.set(e,[]),"complex64"===o?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:S.sent(),S.label=2;case 2:return"complex64"!==o?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return g=S.sent(),v=g[0],y=g[1],m=Jx(v,y),[3,5];case 4:null==f?m=this.getValuesFromTexture(e):(b=K_(i),m=this.gpgpu.downloadFloat32MatrixFromBuffer(f,b)),S.label=5;case 5:return null!=h&&this.disposeData(h.dataId),_=this.convertAndCacheOnCPU(e,m),w=this.pendingRead.get(e),this.pendingRead.delete(e),w.forEach((function(e){return e(_)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,_]}}))}))},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!mE(n)){if(A_().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.isPacked,o=K_(r);if(A_().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),c=this.texData.get(s.dataId),u=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[c.texture].concat(dE(r))).subarray(0,o);return this.disposeData(s.dataId),u}var l=A_().getBool("WEBGL_PACK")&&!0===a,d=l?GE(r):r,f=l?new vR(d):new gR(d),h=this.runWebGLProgram(f,[{shape:d,dtype:i,dataId:e}],"float32"),p=this.texData.get(h.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,o);return this.disposeData(h.dataId),m},t.prototype.time=function(e){return R_(this,void 0,void 0,(function(){var t,n,r,i,a,o,s;return I_(this,(function(c){switch(c.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),i=q_(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),a=q_(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return s=c.sent(),o.kernelMs=W_(s),o.getExtraProfileInfo=function(){return s.map((function(e,t){return{name:a[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},[3,3];case 2:o.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,o]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Sw(),endMs:null}},t.prototype.endTimer=function(e){return A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Sw(),e)},t.prototype.getQueryTime=function(e){return R_(this,void 0,void 0,(function(){var t;return I_(this,(function(n){return A_().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,i=t.texShape,a=t.usage,o=t.isPacked,s=t.slice,c=s&&s.origDataId||e,u=this.dataRefCount.get(c);u>1?this.dataRefCount.set(c,u-1):(this.dataRefCount.delete(c),null!=n&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,a,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return A_().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=eE.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&K_(e.shape)<t}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:eE.keep(e.clone()),imag:eE.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===K_(n))return RS([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,i=Rx(e.shape,t,n);if(r||!i){var a=A_().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yI(n):new gI(n),o=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,o)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),i=this.makeOutput(n,e.dtype),a=this.texData.get(i.dataId);Object.assign(a,r),a.shape=n,a.dtype=e.dtype;var o=Ix(t,e.strides);r.slice&&(o+=r.slice.flatOffset),a.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),i},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var i=Cx(t,n,r);if(i.some((function(e){return 0===e})))return RS([],i);var a=new bI(t,r,i);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,t){var n=A_().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fI(e.shape,t):new dI(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return xS(e)})),r=e.map((function(e){return TS(e)}));return CS(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>A_().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),a=this.concat(e.slice(0,i),t),o=this.concat(e.slice(i),t);return this.concat([a,o],t)}if(A_().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new JT(e.map((function(e){return e.shape})),t);return this.compileAndRun(s,e)}var c=ES(e.map((function(e){return e.shape})),t),u=e.map((function(e){return e.as2D(-1,K_(e.shape.slice(t)))})),l=new QT(u.map((function(e){return e.shape})));return this.compileAndRun(l,u).reshape(c)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(A_().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,MI,e.dtype);var t=new TI(e.shape,MI);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var i=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===i||1===a)&&o>1e3){n&&(e=Dx(e,[0,2,1])),r&&(t=Dx(t,[0,2,1]));var c=1===a?e:e.as3D(s,o,1),u=1===a?2:1,l=1===a?t.as3D(s,1,o):t;return this.multiply(c,l).sum(u,!0)}var d=Yw(e.dtype,t.dtype),f=new QR(e.shape,[s,i,a],n,r);return this.compileAndRun(f,[e,t],d)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,c=r?t.shape[2]:t.shape[1],u=i?n.shape[1]:n.shape[2],l=t.shape[0],d=Yw(t.dtype,n.dtype),f=null!=a,h=null!=s,p=o?$I(o,!0):null,m=new QR(t.shape,[l,c,u],r,i,f,p,h),g=[t,n];return a&&g.push(a),s&&g.push(s),this.compileAndRun(m,g,d)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),i=new UT("return areal * breal - aimag * bimag;",e.shape,t.shape),a=new UT("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(i,o),c=this.compileAndRun(a,o),u=this.complex(s,c);return s.dispose(),c.dispose(),u}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,zT,e.dtype);var l=new GT(zT,e.shape,t.shape);return this.compileAndRun(l,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){var o=[e,t,n],s=null;null!=a&&(s=a.shape,o.push(a));var c=null;if(null!=i&&(c=i.shape,o.push(i)),A_().getBool("WEBGL_PACK_NORMALIZATION")){var u=new FT(e.shape,t.shape,n.shape,s,c,r);return this.compileAndRun(u,o)}var l=new jT(e.shape,t.shape,n.shape,s,c,r);return this.compileAndRun(l,o)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){var a=A_().getBool("WEBGL_PACK_NORMALIZATION")?new qR(e.shape,t,n,r,i):new HR(e.shape,t,n,r,i);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){var s=new YR(t.shape,r,i,a,o);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return Tw(e)}));return lT(YS(e.shape,e.dtype,n),t)}var r=new SI(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=A_().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new tI(e.shape,t,n):new eI(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new ER(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){G_(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=rC(e.shape,t,r),a=iC(i.length,t.length),o=aC(e.shape,t,r),s=oC(n,t.length),c=sC(o,n,t.length);return Dx(e.reshape(i),a).reshape(o).slice(s,c)},t.prototype.spaceToBatchND=function(e,t,n){G_(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=rC(o.shape,t,r,!1),c=iC(s.length,t.length,!1),u=aC(o.shape,t,r,!1);return Dx(o.reshape(s),c).reshape(u)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],i=e.shape[1],a=yx(i),o=new iI({windowSize:a,inSize:i,batchSize:r},t),s=this.compileAndRun(o,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var a=yx(i),o=new mT({windowSize:a,inSize:i,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var c=this.compileAndRun(o,s,"int32");return 1===c.shape[1]?c:this.argReduce(e,t,c)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,i=yx(r[r.length-1]),a=new LT(r,i,t,null==n),o=null==n?[e]:[e,n],s=this.compileAndRun(a,o,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){vS("sum",t,e.rank);var n=mS(e.shape,t),r=n[0],i=K_(n[1]),a=e.as2D(-1,i),o=qw(e.dtype);return this.reduce(a,"sum",o).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=mS(e.shape,t),r=n[0],i=K_(n[1]),a=e.as2D(-1,i),o=qw(e.dtype);return this.reduce(a,"prod",o).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,i=yS([r],e.rank),a=e;null!=i&&(a=Dx(e,i),r=_S(1,e.rank)[0]);var o=function(e,t,n){for(var r=[],i=e.length,a=0;a<i;a++)a!==t?r.push(e[a]):r.push(n);return r}(a.shape,r,n),s=K_([a.shape[r]]),c=a.as2D(-1,s),u=qw(e.dtype),l=this.segOpCompute(c,"unsortedSegmentSum",t,u,n).reshape(o);return null!=i&&(l=Dx(l,bS(i))),l},t.prototype.segOpCompute=function(e,t,n,r,i){var a=e.shape[0],o=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=vw(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=vw(e,n+1);return n}(o,i),c=new pI({windowSize:s,inSize:o,batchSize:a,numSegments:i},t),u=this.compileAndRun(c,[e,n],r);return u.shape[1]===i?u:(n=jS(0,i).tile([o/s]),this.segOpCompute(u,t,n,r,i))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(vS("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!A_().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=mS(e.shape,r),a=i[0],o=K_(i[1]),s=e.as2D(-1,o);return this.argReduce(s,n).reshape(a)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new lR(e.shape,n,r);return this.compileAndRun(i,[e])},t.prototype.equal=function(e,t){if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new GT("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new GT("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new GT("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new GT("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new GT("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new GT("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new TI(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new GT("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new GT("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new mI(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],Yw(t.dtype,n.dtype))},t.prototype.where=function(e){cS("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return fT(e.shape,t)},t.prototype.topk=function(e,t,n){return dT(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){vS("min",t,e.rank);var n=mS(e.shape,t),r=n[0],i=K_(n[1]),a=e.as2D(-1,i);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=A_().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YT("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new GT("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=A_().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YT("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new GT("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);vS("max",t,e.rank);var n=mS(e.shape,t),r=n[0],i=K_(n[1]),a=e.as2D(-1,i);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=A_().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YT("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new GT("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){vS("all",t,e.rank);var n=mS(e.shape,t),r=n[0],i=K_(n[1]),a=e.as2D(-1,i);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(e,t){vS("any",t,e.rank);var n=mS(e.shape,t),r=n[0],i=K_(n[1]),a=e.as2D(-1,i);return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.floorDiv=function(e,t){if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new GT("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,BT);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=Yw(e.dtype,t.dtype);if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,BT,n);var r=new GT(BT,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new QI(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,i){void 0===i&&(i=!1);var a=new YT(n,e.shape,t.shape,i);return this.compileAndRun(a,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,i=this.texData.get(e.dataId),a=this.texData.get(t.dataId),o=[[i.complexTensors.real,a.complexTensors.real],[i.complexTensors.imag,a.complexTensors.imag]].map((function(i){var a=i[0],o=i[1],s=r.makeComplexComponentTensorInfo(e,a),c=r.makeComplexComponentTensorInfo(t,o),u=new GT(n,e.shape,t.shape);return r.compileAndRun(u,[s,c],Yw(a.dtype,o.dtype))})),s=o[0],c=o[1],u=this.complex(s,c);return s.dispose(),c.dispose(),u},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>A_().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var i=e.map((function(e){return e.dtype})).reduce((function(e,t){return Yw(e,t)})),a=e.map((function(e){return e.shape})),o=A_().getBool("WEBGL_PACK")?new pT(e[0].shape,a):new hT(e[0].shape,a);return this.compileAndRun(o,e,i)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,VT);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=Yw(e.dtype,t.dtype);if(A_().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,VT,e.dtype);var r=new GT(VT,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=A_().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YT("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new GT("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=Yw(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(A_().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,LI,e.dtype);var t=new TI(e.shape,LI);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(A_().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,OI,e.dtype);var t=new TI(e.shape,OI);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new TI(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new TI(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new TI(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new TI(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new TI(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(A_().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,PI,e.dtype);var t=new TI(e.shape,PI);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(A_().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,jI,e.dtype);var t=new TI(e.shape,jI);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=nw([t],e.shape),r=this.max(e,n),i=gS(r.shape,n),a=this.subtract(e,r.reshape(i)),o=this.exp(a),s=this.sum(o,n).reshape(i);return gx(o,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(A_().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new TI(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new TI(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new TI(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new TI(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new TI(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=A_().getBool("WEBGL_PACK")?new QI(e.shape,qI):new TI(e.shape,NI),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=A_().getBool("WEBGL_PACK")?new QI(e.shape,KI):new TI(e.shape,AI),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=A_().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YT(HT,e.shape,t.shape):new GT(WT,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(A_().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,XI,e.dtype);var t=new TI(e.shape,kI);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=A_().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YT("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new GT("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new TI(e.shape,DI);return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new TI(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,i=(r=A_().getBool("WEBGL_PACK_CLIP")?new KT(e.shape):new qT(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,i)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(A_().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,II,e.dtype);var t=new TI(e.shape,II);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new XT(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new TI(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new TI(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new TI(e.shape,FI);return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new TI(e.shape,UI);return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new TI(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new TI(e.shape,BI);return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new TI(e.shape,VI);return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new TI(e.shape,zI);return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=A_().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YT("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new GT("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new TI(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new TI(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new TI(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new TI(e.shape,WI);return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new TI(e.shape,GI);return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new TI(e.shape,HI);return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new TI(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new TI(e.shape,function(e){return void 0===e&&(e=0),RI+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,i,a){var o=e.shape,s=this.texData.get(e.dataId),c=n.inChannels,u=o[0]*o[1]*o[2],l=n.outChannels,d="channelsLast"===n.dataFormat,f=(1===u||1===l)&&c>1e3,h=o[2]%2!=0&&!!s.isPacked;if(f||!A_().getBool("WEBGL_LAZILY_UNPACK")||!A_().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!h){var p=d?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],m=this.reshape(e,[1,p,n.inChannels]),g=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:g,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),n.outShape)}var v=d?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),y={dataId:e.dataId,shape:[1,v,n.inChannels],dtype:e.dtype},b=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,G_(qE(s.shape,y.shape),(function(){return"packed reshape "+s.shape+" to "+y.shape+" isn't free"}));var _=this.reshape(t,[1,n.inChannels,n.outChannels]),w=this.fusedBatchMatMul({a:y,b:_,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:a}),E=this.texData.get(w.dataId);return G_(E.isPacked,(function(){return"batchMatMul result is expected to be packed"})),s.shape=b,E.shape=n.outShape,eE.makeTensorFromDataId(w.dataId,n.outShape,w.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,i,a){var o=n.filterWidth,s=n.filterHeight,c=n.inChannels,u=n.outWidth,l=n.outHeight,d="channelsLast"===n.dataFormat,f=o*s*c,h=l*u,p=[f,h],m=e.squeeze([0]),g=t.reshape([1,f,-1]),v=new GR(p,m.shape,n),y=this.compileAndRun(v,[m]).reshape([1,p[0],p[1]]),b=null!=r,_=null!=a,w=i?$I(i,!0):null,E=new QR(y.shape,[1,h,n.outChannels],!0,!1,b,w,_),S=[y,g];r&&S.push(r),_&&S.push(a);var C=this.compileAndRun(E,S);return d?C.reshape([1,l,u,n.outChannels]):C.reshape([1,n.outChannels,l,u])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,i,a,o);if(A_().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,i,a,o);var s=null!=i,c=null!=o,u=a?$I(a,!1):null,l=new aR(r,s,u,c),d=[t,n];return i&&d.push(i),o&&d.push(o),this.compileAndRun(l,d)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(A_().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new aR(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new eR(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new $T(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,i=e.convInfo,a=e.bias,o=e.activation,s=e.preluActivationWeights,c=A_().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,u=o?$I(o,c):null,l=[n,r],d=null!=a,f=null!=s;return d&&l.push(a),f&&l.push(s),c?(t=new cR(i,d,u,f),this.compileAndRun(t,l)):(t=new sR(i,d,u,f),this.compileAndRun(t,l))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return A_().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new cR(n),this.compileAndRun(r,[e,t])):(r=new sR(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new iR(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new rR(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new oR(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new nR(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new tR(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new nI(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new nI(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var i=new nI(r,"max",!0),a=this.compileAndRun(i,[t]),o=new KR(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new OT(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return Kx(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var c=new Array(n);for(a=0;a<c.length;a++)o[t]=a,c[a]=this.slice(e,o,s).reshape(r);return c},t.prototype.avgPool3d=function(e,t){var n=new rI(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new PT(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new rI(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var i=new rI(r,"max",!0),a=this.compileAndRun(i,[t]),o=new XR(r),s=this.compileAndRun(o,[e,a],t.dtype);return a.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!qE(e.shape,t)&&(null===n.texture||!qE(n.shape,t))){var r=this.packedReshape(e,t);return eE.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Xx(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var i=A_().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new cI(e.shape,t,n,r):new sI(e.shape,t,n,r);return this.compileAndRun(i,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new oI(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var i=new lI(e.shape,t,n,r);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new uI(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var i=t?e:Ax(e),a=i.shape[0],o=i.shape[1],s=new JR(a,o,n),c=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],"int32",c)},t.prototype.oneHot=function(e,t,n,r){var i=new ZR(e.size,t,n,r);return this.compileAndRun(i,[e])},t.prototype.diag=function(e){var t=new mR(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return cS("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),rT(e.dataSync(),t.dataSync(),n,r,i)},t.prototype.cropAndResize=function(e,t,n,r,i,a){var o=new uR(e.shape,t.shape,r,i,a);return this.compileAndRun(o,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){G_(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],i="NHWC"===n?e.shape[1]:e.shape[2],a="NHWC"===n?e.shape[2]:e.shape[3],o="NHWC"===n?e.shape[3]:e.shape[1],s=i*t,c=a*t,u=o/(t*t),l=new pR("NHWC"===n?[r,s,c,u]:[r,u,s,c],t,n);return this.compileAndRun(l,[e])},t.prototype.split=function(e,t,n){return uT(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=wx(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,c=r.outputSize,u=[c/o,o],l=e.reshape([a,i]),d=t.reshape([a,o]);if(0===c)return Xx(RS([]),n);var f=NS(0),h=new hI(a,i,l.rank,d.rank,s,u);return this.compileAndRun(h,[d,l,f]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var i=wx(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.strides,c=i.outputSize,u=new hI(o,a,e.rank,t.rank,s,[c,1],!1);return this.compileAndRun(u,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new _R("return real * expR - imag * expI;",e.shape,t),i=new _R("return real * expI + imag * expR;",e.shape,t),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],o=this.compileAndRun(r,a),s=this.compileAndRun(i,a),c=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),c},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=vx(e,t),a=i[0],o=i[1],s=i[2],c=i[3],u=t.reshape([o,r]),l=e.reshape([e.size/s,s]),d=new SR(r,c,[o,s]);return this.compileAndRun(d,[l,u]).reshape(a)},t.prototype.fill=function(e,t,n){if("string"===(n=n||mw(t))){var r=aw(n,K_(e));return r.fill(t),eE.makeTensor(r,e,n,this)}var i=new wR(e,t),a=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],n,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return Qx(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return eE.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new JI(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new $R(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[zE(e.shape)].concat(WE(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},i=[zE(t)].concat(WE(t)),a=new aI(i,n),o=this.runWebGLProgram(a,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,i=n.shape,a=n.dtype,o=GE(i);return t=r?new hR(o):new fR(o),{dtype:a,shape:i,dataId:this.runWebGLProgram(t,[{shape:o,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,i){var a=this;void 0===i&&(i=!1);var o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===rE.DENSE){var c=dE(e.outputShape);s.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===K_(o.shape))return s.values=iw(o.dtype,0),o;var u=[],l=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&K_(t.shape)<=A_().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),u.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!qE(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),u.push(t),n=a.texData.get(t.dataId),r.shape=i}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var d,f={shape:o.shape,texData:s,isUniform:!1},h=function(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t}));var i=e.userCode;return e.constructor.name+"_"+r+"_"+i}(e,l,f),p=this.getAndSaveBinary(h,(function(){return function(e,t,n,r){var i=t.userCode,a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=a.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},c=ET(a,s,i,t.packedInputs),u=e.createProgram(c),l=null,d=e.getUniformLocation(u,"NAN",!1);1===A_().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(u,"INFINITY",!1));for(var f={},h=0;h<t.variableNames.length;h++){var p=t.variableNames[h];f[p]=e.getUniformLocation(u,p,!1),f["offset"+p]=e.getUniformLocation(u,"offset"+p,!1)}return{program:t,source:c,webGLProgram:u,uniformLocations:f,inShapeInfos:o,outShapeInfo:s,infLoc:l,nanLoc:d}}(a.gpgpu,e,l,f)})),m=null!=this.activeTimers;if(m&&(d=this.startTimer()),function(e,t,n,r,i){WR(t.inShapeInfos,n),WR([t.outShapeInfo],[r]);var a=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(a,o[0],o[1]):e.setOutputMatrixTexture(a,o[0],o[1]),e.setProgram(t.webGLProgram),1===A_().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var i=t.program.variableNames[r],a=t.uniformLocations[i],o=t.uniformLocations["offset"+i];if(null!=a)if(n.isUniform)if(K_(n.shape)<2)e.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,a,r)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,p,l,f,r),u.forEach((function(e){return a.disposeData(e.dataId)})),m&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)})),!A_().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var g=this.unpackTensor(o);return this.disposeData(o.dataId),g}return o},t.prototype.compileAndRun=function(e,t,n,r,i){void 0===i&&(i=!1),n=n||t[0].dtype;var a=this.runWebGLProgram(e,t,n,r,i);return eE.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(A_().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=oS((function(){if(!A_().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=A_().getBool("DEBUG");A_().set("DEBUG",!1);var n=e.abs(NS(1e-8)).dataSync()[0];if(A_().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,a=n.values,o=n.texture,s=n.usage,c=n.isPacked;if(null==o){var u,l=null!=this.activeTimers;l&&(u=Sw());var d=n.texShape;if(null==d&&(d=HE(r,c),n.texShape=d),null!=a){var f=GE(r),h=void 0,p=d[1],m=d[0],g=a instanceof Uint8Array;c?(p=(t=fE(d[0],d[1]))[0],m=t[1],h=new bR(f,[m,p],g)):h=new yR(f,[m,p],g);var v=this.makeTensorInfo([m,p],i);this.texData.get(v.dataId).usage=g?iE.PIXELS:iE.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),p,m,a);var y=this.runWebGLProgram(h,[v],i,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(v.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=Sw()-u)}else{var _=this.acquireTexture(d,s,i,c);n.texture=_}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*lw(t)},t}(Lx);function tN(e,t){return e(t={exports:{}},t.exports),t.exports}tE()&&eE.registerBackend("webgl",(function(){return new eN}),2),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var nN=tN((function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var i=new n(e),a=t&&t.state,o=i.next;return o.int32=function(){return 4294967296*i.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,a&&("object"==typeof a&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.alea=i}(0,e)})),rN=tN((function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var i=new n(e),a=t&&t.state,o=function(){return(i.next()>>>0)/4294967296};return o.double=function(){do{var e=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=i.next,o.quick=o,a&&("object"==typeof a&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.xor128=i}(0,e)})),iN=tN((function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var i=new n(e),a=t&&t.state,o=function(){return(i.next()>>>0)/4294967296};return o.double=function(){do{var e=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=i.next,o.quick=o,a&&("object"==typeof a&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.xorwow=i}(0,e)})),aN=tN((function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var i=new n(e),a=t&&t.state,o=function(){return(i.next()>>>0)/4294967296};return o.double=function(){do{var e=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=i.next,o.quick=o,a&&(a.x&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.xorshift7=i}(0,e)})),oN=tN((function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,a=t.i;return t.w=r=r+1640531527|0,n=i[a+34&127],e=i[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,i,a,o,s=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),i=0,a=-32;a<c;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(o=o+1640531527|0,i=0==(n=s[127&a]^=r+o)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,a=512;a>0;--a)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=o,e.X=s,e.i=i}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var i=new n(e),a=t&&t.state,o=function(){return(i.next()>>>0)/4294967296};return o.double=function(){do{var e=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=i.next,o.quick=o,a&&(a.X&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.xor4096=i}(0,e)})),sN=tN((function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var i=new n(e),a=t&&t.state,o=function(){return(i.next()>>>0)/4294967296};return o.double=function(){do{var e=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=i.next,o.quick=o,a&&("object"==typeof a&&r(a,i),o.state=function(){return r(i,{})}),o}t&&t.exports?t.exports=i:this.tychei=i}(0,e)})),cN=tN((function(e){!function(t,r){var i,a=this,o=256,s="random",c=r.pow(o,6),u=r.pow(2,52),l=2*u,d=255;function f(e,n,d){var f=[],v=m(function e(t,n){var r,i=[],a=typeof t;if(n&&"object"==a)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==a?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,g(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(e)),g(e)}catch(e){var n=a.navigator,r=n&&n.plugins;return[+new Date,a,r,a.screen,g(t)]}}():e,3),f),y=new h(f),b=function(){for(var e=y.g(6),t=c,n=0;e<u;)e=(e+n)*o,t*=o,n=y.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,m(g(y.S),t),(n.pass||d||function(e,t,n,i){return i&&(i.S&&p(i,y),e.state=function(){return p(y,{})}),n?(r[s]=e,t):e})(b,v,"global"in n?n.global:this==r,n.state)}function h(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=d&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=d&i+1],n=n*o+s[d&(s[i]=s[a=d&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var n,r=e+"",i=0;i<r.length;)t[d&i]=d&(n^=19*t[d&i])+r.charCodeAt(i++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=f,m(r.random(),t),e.exports){e.exports=f;try{i=n(3367)}catch(e){}}}([],Math)}));cN.alea=nN,cN.xor128=rN,cN.xorwow=iN,cN.xorshift7=aN,cN.xor4096=oN,cN.tychei=sN;var uN=cN.alea,lN=SS({addN_:function(e){G_(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),G_(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return dS(e,"tensors"+t,"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!X_(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return eE.runKernelFunc((function(e,n){return e.addN(t)}),r,null,"AddN")}});function dN(){aS("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function fN(e){return 0===e.rank||1===e.rank?e.as4D(1,1,1,e.size):2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function hN(e,t,n,r,i,a){null==a&&(a=.001);var o,s,c=dS(e,"x","batchNorm"),u=dS(t,"mean","batchNorm"),l=dS(n,"variance","batchNorm");null!=i&&(o=dS(i,"scale","batchNorm")),null!=r&&(s=dS(r,"offset","batchNorm")),G_(u.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),G_(null==s||u.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),G_(null==o||u.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var d={x:c,scale:o,offset:s,mean:u,variance:l},f={varianceEpsilon:a};return eE.runKernelFunc((function(e,t){var n=fN(c),r=e.batchNormalization(n,pN(u),pN(l),a,pN(o),pN(s));return t([c,u,l,o]),r}),d,null,"FusedBatchNorm",f).reshape(c.shape)}function pN(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}var mN=SS({batchNormalization_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),dN(),hN(e,t,n,a,i,r)}}),gN=SS({batchNorm_:hN});function vN(e,t,n,r,i,a){var o,s,c=dS(e,"x","batchNorm"),u=dS(t,"mean","batchNorm"),l=dS(n,"variance","batchNorm");return null!=i&&(o=dS(i,"scale","batchNorm")),null!=r&&(s=dS(r,"offset","batchNorm")),G_(2===c.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."})),G_(2===u.rank||1===u.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+u.rank+"."})),G_(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=o&&G_(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+o.rank+"."})),null!=s&&G_(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),gN(c,u,l,s,o,a)}var yN=SS({batchNormalization2d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),dN(),vN(e,t,n,a,i,r)}}),bN=SS({batchNorm2d_:vN});function _N(e,t,n,r,i,a){var o,s,c=dS(e,"x","batchNorm"),u=dS(t,"mean","batchNorm"),l=dS(n,"variance","batchNorm");return null!=i&&(o=dS(i,"scale","batchNorm")),null!=r&&(s=dS(r,"offset","batchNorm")),G_(3===c.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."})),G_(3===u.rank||1===u.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+u.rank+"."})),G_(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=o&&G_(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+o.rank+"."})),null!=s&&G_(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),gN(c,u,l,s,o,a)}var wN=SS({batchNormalization3d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),dN(),_N(e,t,n,a,i,r)}}),EN=SS({batchNorm3d_:_N});function SN(e,t,n,r,i,a){var o,s,c=dS(e,"x","batchNorm"),u=dS(t,"mean","batchNorm"),l=dS(n,"variance","batchNorm");return null!=i&&(o=dS(i,"scale","batchNorm")),null!=r&&(s=dS(r,"offset","batchNorm")),G_(4===c.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."})),G_(4===u.rank||1===u.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+u.rank+"."})),G_(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=o&&G_(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+o.rank+"."})),null!=s&&G_(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),gN(c,u,l,s,o,a)}var CN=SS({batchNormalization4d_:function(e,t,n,r,i,a){return void 0===r&&(r=.001),dN(),SN(e,t,n,a,i,r)}}),xN=SS({batchNorm4d_:SN}),TN=SS({broadcastTo_:function(e,t){var n=dS(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var i=n.shape.slice();i.length<t.length;)i.unshift(1);n=n.reshape(i)}for(var a=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(a[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var c=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===c.length)return n.clone();var u={x:n},l={shape:t,inputShape:a};return eE.runKernelFunc((function(e){return e.tile(n,o)}),u,(function(e){return{x:function(){return e.sum(c,!0)}}}),lC,l)}}),RN=SS({clone_:function(e){var t=dS(e,"x","clone",null);return eE.runKernelFunc((function(){return eE.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{x:t},null,fC)}}),IN=SS({logicalAnd_:function(e,t){var n=dS(e,"a","logicalAnd","bool"),r=dS(t,"b","logicalAnd","bool");return yC(n.shape,r.shape),eE.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),NN=SS({logicalNot_:function(e){var t=dS(e,"x","logicalNot","bool");return eE.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),AN=SS({logicalOr_:function(e,t){var n=dS(e,"a","logicalOr","bool"),r=dS(t,"b","logicalOr","bool");return yC(n.shape,r.shape),eE.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),kN=SS({logicalXor_:function(e,t){var n=dS(e,"a","logicalXor","bool"),r=dS(t,"b","logicalXor","bool");return yC(n.shape,r.shape),AN(e,t).logicalAnd(IN(e,t).logicalNot())}}),DN=SS({where_:function(e,t,n){var r=dS(t,"a","where"),i=dS(n,"b","where"),a=dS(e,"condition","where","bool");return H_(r.shape,i.shape,"Error in where: "),1===a.rank?G_(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):H_(a.shape,i.shape,"Error in where: "),eE.runKernelFunc((function(e,t){var n=e.select(a,r,i);return t([a]),n}),{$condition:a,$a:r,$b:i},(function(e,t){var n=t[0];return{$condition:function(){return US(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),MN=function(e){return R_(this,void 0,void 0,(function(){var t,n,r;return I_(this,(function(i){switch(i.label){case 0:return[4,(t=dS(e,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=fT(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))},LN=SS({divNoNan_:function(e,t){var n,r=dS(e,"a","div"),i=dS(t,"b","div");r=(n=Kw(r,i))[0],i=n[1];var a=gx(r,i),o=US(a),s=i.equal(o);return DN(s,o,a)}}),ON=SS({tile_:function(e,t){var n=dS(e,"x","tile",null);G_(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."}));var r=[n],i={x:n},a={reps:t};return eE.runKernelFunc((function(e,r){var i=e.tile(n,t);return r([n]),i}),i,null,hC,a,r)}}),PN=SS({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var i=YS([e,t],r),a=e<=t?e:t,o=0;o<a;++o)i.set(1,o,o);var s=i.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return ON(JS(s,0),[n[0],1,1]);if(2===n.length)return ON(JS(JS(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return ON(JS(JS(JS(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),jN=SS({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var i=dS(e,"logits","multinomial"),a=i.size,o=i.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?i.as2D(1,-1):i,c=eE.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===o?c.as1D():c}}),FN=SS({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=dS(e,"indices","oneHot","int32"),a=i.shape.concat([t]),o={indices:i=i.flatten()},s={depth:t,onValue:n,offValue:r};return eE.runKernelFunc((function(e,a){return a([i]),e.oneHot(i,t,n,r)}),o,null,dC,s).reshape(a)}}),UN=SS({pad_:function(e,t,n){void 0===n&&(n=0);var r=dS(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:t,constantValue:n},a={x:r};return eE.runKernelFunc((function(e,i){return i([r]),e.pad(r,t,n)}),a,null,pC,i)}}),BN=SS({pad1d_:function(e,t,n){return void 0===n&&(n=0),G_(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),UN(e,[t],n)}}),VN=SS({pad2d_:function(e,t,n){return void 0===n&&(n=0),G_(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),UN(e,t,n)}}),zN=SS({pad3d_:function(e,t,n){return void 0===n&&(n=0),G_(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),UN(e,t,n)}}),WN=SS({pad4d_:function(e,t,n){return void 0===n&&(n=0),G_(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),UN(e,t,n)}}),GN=SS({rand_:function(e,t,n){var r=K_(e),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var a=0;a<r;a++)i[a]=t();return eE.makeTensor(i,e,n)}});function HN(){return 32===eE.backend.floatPrecision()?.001:.1}function YN(e,t,n){var r=!0;if((uw(e)||uw(t))&&(r=!1),uw(e)&&uw(t)&&(r=!0),r){var i=e.constructor.name,a=t.constructor.name;if(i!==a)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+a)}if(Array.isArray(e)&&Array.isArray(t)){var o=uS(e),s=uS(t);if(!X_(o,s))throw new Error("Arrays have different shapes. Actual: ["+o+"]. Expected: ["+s+"]")}var c=uw(e)?e:q_(e),u=uw(t)?t:q_(t);if(c.length!==u.length)throw new Error("Arrays have different lengths actual: "+c.length+" vs expected: "+u.length+".\nActual:   "+c+".\nExpected: "+u+".");for(var l=0;l<u.length;++l){var d=c[l],f=u[l];if(!n(d,f))throw new Error("Arrays differ: actual["+l+"] = "+d+", expected["+l+"] = "+f+".\nActual:   "+c+".\nExpected: "+u+".")}}function qN(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=HN()),YN(e,t,(function(e,t){return qN(e,t,n)}))},testEpsilon:HN,expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return fw(e)||fw(e[0])||fw(t)||fw(t[0])?YN(e,n,(function(e,t){return e==t})):YN(e,t,(function(e,t){return qN(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=HN()),!qN(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}});var KN=function(){function e(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=uN(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var i=void 0,a=void 0,o=void 0;do{o=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),XN=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var i=r||Math.random();this.randu=uN(i.toString()),this.randn=new KN(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,i,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-a+Math.log(a)),(i=this.randu())<t||Math.log(i)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),QN=function(){function e(e,t,n,r){var i=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=uN(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}(),JN=SS({randomGamma_:function(e,t,n,r,i){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new XN(t,n,r,i),o=YS(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),ZN=SS({randomNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new KN(t,n,r,!1,i),o=YS(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),$N=SS({randomUniform_:function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=YS(e,r),o=new QN(t,n,null,i),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),eA=SS({square_:function(e){var t=dS(e,"x","square"),n=[t];return eE.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},n,[])}}),tA=SS({squaredDifference_:function(e,t){var n,r=dS(e,"a","squaredDifference"),i=dS(t,"b","squaredDifference");n=Kw(r,i),r=n[0],i=n[1],yC(r.shape,i.shape);var a={a:r,b:i},o=[r,i];return eE.runKernelFunc((function(e,t){var n=e.squaredDifference(r,i);return t([r,i]),n}),a,(function(e,t){var n=t[0],r=t[1],i=NS(2);return{a:function(){return e.mul(n.sub(r).mul(i))},b:function(){return e.mul(r.sub(n).mul(i))}}}),uC,{},o,[])}}),nA=SS({truncatedNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var a=new KN(t,n,r,!0,i),o=YS(e,r),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),rA=SS({equal_:function(e,t){var n,r=dS(e,"a","equal"),i=dS(t,"b","equal");return n=Kw(r,i),r=n[0],i=n[1],yC(r.shape,i.shape),eE.runKernelFunc((function(e){return e.equal(r,i)}),{$a:r,$b:i})}}),iA=SS({equalStrict_:function(e,t){var n=dS(e,"a","equalStrict"),r=dS(t,"b","equalStrict");return H_(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),aA=SS({greater_:function(e,t){var n,r=dS(e,"a","greater"),i=dS(t,"b","greater");return n=Kw(r,i),r=n[0],i=n[1],yC(r.shape,i.shape),eE.runKernelFunc((function(e){return e.greater(r,i)}),{a:r,b:i},null,"Greater")}}),oA=SS({greaterEqual_:function(e,t){var n,r=dS(e,"a","greaterEqual"),i=dS(t,"b","greaterEqual");return n=Kw(r,i),r=n[0],i=n[1],yC(r.shape,i.shape),eE.runKernelFunc((function(e,t){var n=e.greaterEqual(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return US(n)},b:function(){return US(r)}}}),"GreaterEqual")}}),sA=SS({greaterEqualStrict_:function(e,t){var n=dS(e,"a","greaterEqualStrict"),r=dS(t,"b","greaterEqualStrict");return H_(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),cA=SS({greaterStrict_:function(e,t){var n=dS(e,"a","greaterStrict"),r=dS(t,"b","greaterStrict");return H_(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),uA=SS({less_:function(e,t){var n,r=dS(e,"a","less"),i=dS(t,"b","less");return n=Kw(r,i),r=n[0],i=n[1],yC(r.shape,i.shape),eE.runKernelFunc((function(e){return e.less(r,i)}),{a:r,b:i},null,"Less")}}),lA=SS({lessEqual_:function(e,t){var n,r=dS(e,"a","lessEqual"),i=dS(t,"b","lessEqual");return n=Kw(r,i),r=n[0],i=n[1],yC(r.shape,i.shape),eE.runKernelFunc((function(e,t){var n=e.lessEqual(r,i);return t([r,i]),n}),{a:r,b:i},null,"LessEqual")}}),dA=SS({lessEqualStrict_:function(e,t){var n=dS(e,"a","lessEqualStrict"),r=dS(t,"b","lessEqualStrict");return H_(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),fA=SS({lessStrict_:function(e,t){var n=dS(e,"a","lessStrict"),r=dS(t,"b","lessStrict");return H_(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),hA=SS({notEqual_:function(e,t){var n,r=dS(e,"a","notEqual"),i=dS(t,"b","notEqual");return n=Kw(r,i),r=n[0],i=n[1],yC(r.shape,i.shape),eE.runKernelFunc((function(e){return e.notEqual(r,i)}),{a:r,b:i},null,"NotEqual")}}),pA=SS({notEqualStrict_:function(e,t){var n=dS(e,"a","notEqualStrict"),r=dS(t,"b","notEqualStrict");return H_(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function mA(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function gA(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var vA=SS({gather_:function(e,t,n){void 0===n&&(n=0);var r=dS(e,"x","gather"),i=dS(t,"indices","gather","int32");n=nw(n,r.shape)[0];var a=function(e,t,n){for(var r=e.shape[n],i=[],a=1,o=1,s=0;s<n;s++)i.push(e.shape[s]),a*=e.shape[s];for(s=0;s<t.rank;s++)i.push(t.shape[s]);for(s=n+1;s<e.rank;s++)i.push(e.shape[s]),o*=e.shape[s];return{batchSize:a,sliceSize:o,dimSize:r,outputShape:i}}(r,i,n);return eE.runKernelFunc((function(e,t){var a=e.gather(r,i.flatten(),n);return t([i]),a}),{x:r,indices:i},(function(e,t){var i=t[0];return{x:function(){var t=r.shape,a=i.size,o=t.slice(0,n),s=o.length,c=t.slice(n,t.length).slice(1),u=c.length,l=mA(0,s),d=mA(s+1,s+1+u),f=gA([o,[a],c]),h=e.reshape(f),p=i.reshape([a]),m=gA([[s],l,d]),g=h.transpose(m),v=yA(g,p,r.shape[n]),y=bS(m);return v.transpose(y)},indices:function(){return i}}}),"Gather",{axis:n}).reshape(a.outputShape)}}),yA=SS({unsortedSegmentSum_:function(e,t,n){var r=dS(e,"x","unsortedSegmentSum"),i=dS(t,"segmentIds","unsortedSegmentSum","int32");return G_(Q_(n),(function(){return"numSegments must be of dtype int"})),eE.runKernelFunc((function(e,t){var a=e.unsortedSegmentSum(r,i,n);return t([i]),a}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=rx(t,US(t)),r=vA(e,n),i=oA(t,NS(0,"int32")),a=r.rank-i.rank,o=0;o<a;++o)i=JS(i,o+1);i=IN(i,LS(r.shape,"bool"));var s=US(r);return DN(i,r,s)}(e,n)}}}))}});function bA(e,t,n,r,i,a,o){void 0===a&&(a="NHWC"),G_(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var s=e,c=t,u=!1;3===t.rank&&(u=!0,c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),G_(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),G_(4===c.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank})),G_(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===a?s[3]:s[1],d="NHWC"===a?c.shape[3]:c.shape[1];G_(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),G_(d===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+n.shape[3]+"."})),null!=o&&G_(Q_(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var f=qx(a),h=Fx(s,n.shape,r,1,i,o,!1,f),p=eE.runKernelFunc((function(e,t){var r=e.conv2dDerInput(c,n,h);return t([n,c]),r}),{dy4D:c,filter:n},(function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return SA(e,n,r,i,a,1,o)},filter:function(){return xA(e,s,n.shape,r,i,a,o)}}}));return u?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function _A(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],i=t[2];return 1===n&&1===r&&1===i}function wA(e,t,n,r,i){G_(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var a=e,o=t,s=!1;4===t.rank&&(s=!0,o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),a=[1,e[0],e[1],e[2],e[3]]);var c=a[4],u=o.shape[4];G_(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),G_(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),G_(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),G_(c===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[3]+"."})),G_(u===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+n.shape[4]+"."}));var l=Ux(a,n.shape,r,1,i),d=eE.runKernelFunc((function(e){return e.conv3dDerInput(o,n,l)}),{dy5D:o});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var EA=SS({conv1d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NWC"),void 0===a&&(a=1);var s=dS(e,"x","conv1d"),c=dS(t,"filter","conv1d"),u=s,l=!1;2===s.rank&&(l=!0,u=s.as3D(1,s.shape[0],s.shape[1])),G_(3===u.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."})),G_(3===c.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."})),null!=o&&G_(Q_(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."})),G_(u.shape[2]===c.shape[1],(function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+c.shape[1]+"."})),G_(Yx(n,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"})),G_("NWC"===i,(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var d=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),f=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),h=SA(f,d,[1,n],r,"NHWC",[1,a],o);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),SA=SS({conv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=dS(e,"x","conv2d"),c=dS(t,"filter","conv2d"),u=s,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),G_(4===u.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."})),G_(4===c.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."})),null!=o&&G_(Q_(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var d="NHWC"===i?u.shape[3]:u.shape[1];G_(d===c.shape[2],(function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+c.shape[2]+"."})),G_(Yx(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var f=qx(i),h=Fx(u.shape,c.shape,n,a,r,o,!1,f),p=[c,u],m=eE.runKernelFunc((function(e,t){var n=e.conv2d(u,c,h);return t([c,u]),n}),{x:u,filter:c},(function(e,t){var o=t,s=o[0],c=o[1];return G_(Hx(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return TA(c.shape,e,s,n,r,i)},filter:function(){return xA(c,e,s.shape,n,r,i)}}}),"Conv2D",h,p);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),CA=SS({conv3d_:function(e,t,n,r,i,a){void 0===i&&(i="NDHWC"),void 0===a&&(a=[1,1,1]);var o=dS(e,"x","conv3d"),s=dS(t,"filter","conv3d"),c=o,u=!1;4===o.rank&&(u=!0,c=o.as5D(1,o.shape[0],o.shape[1],o.shape[2],o.shape[3])),G_(5===c.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."})),G_(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),G_(c.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),G_(function(e,t){return _A(e)||_A(t)}(n,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),G_("NDHWC"===i,(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var l=Ux(c.shape,s.shape,n,a,r),d=eE.runKernelFunc((function(e,t){var n=e.conv3d(c,s,l);return t([c,s]),n}),{x:c,$filter:s},(function(e,t){G_(_A(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var i=t[0],o=t[1];return{x:function(){return wA(i.shape,e,o,n,r)},$filter:function(){return function(e,t,n,r,i){var a=e;4===e.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var o=t;4===o.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),G_(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),G_(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),G_(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),G_(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),G_(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=Ux(a.shape,n,r,1,i);return eE.runKernelFunc((function(e){return e.conv3dDerFilter(a,o,s)}),{x5D:a,dy5D:o})}(i,e,o.shape,n,r)}}}));return u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),xA=SS({conv2dDerFilter_:function(e,t,n,r,i,a,o){void 0===a&&(a="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var c=t;3===c.rank&&(c=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),G_(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),G_(4===c.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."})),G_(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var u="NHWC"===a?s.shape[3]:s.shape[1],l="NHWC"===a?c.shape[3]:c.shape[1];G_(u===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+u+") must match input depth in filter ("+n[2]+"."})),G_(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=o&&G_(Q_(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var d=qx(a),f=Fx(s.shape,n,r,1,i,o,!1,d);return eE.runKernelFunc((function(e){return e.conv2dDerFilter(s,c,f)}),{x4D:s,dy4D:c})}}),TA=SS({conv2dDerInput_:bA}),RA=SS({depthwiseConv2d_:function(e,t,n,r,i,a,o){void 0===i&&(i="NHWC"),void 0===a&&(a=[1,1]);var s=dS(e,"x","depthwiseConv2d"),c=dS(t,"filter","depthwiseConv2d"),u=s,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),G_(4===u.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+u.rank+"."})),G_(4===c.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."})),G_(u.shape[3]===c.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+u.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."})),null==a&&(a=[1,1]),G_(Yx(n,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=o&&G_(Q_(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var d=Fx(u.shape,c.shape,n,a,r,o,!0),f=[u,c],h=eE.runKernelFunc((function(e,t){var n=e.depthwiseConv2D(u,c,d);return t([u,c]),n}),{x:u,filter:c},(function(e,t){G_(Hx(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var n=t[0],r=t[1];return{x:function(){return IA(n.shape,e,r,d)},filter:function(){return NA(n,e,r.shape,d)}}}),"DepthwiseConv2dNative",d,f);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),IA=SS({depthwiseConv2dDerInput_:function(e,t,n,r){var i=t,a=!1;3===t.rank&&(a=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=eE.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(i,n,r)}),{dy4D:i});return a?o.as3D(o.shape[1],o.shape[2],o.shape[3]):o}}),NA=SS({depthwiseConv2dDerFilter_:function(e,t,n,r){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=t;return 3===a.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),eE.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(i,a,r)}),{x4D:i,dy4D:a})}}),AA=SS({separableConv2d_:function(e,t,n,r,i,a,o){void 0===a&&(a=[1,1]),void 0===o&&(o="NHWC");var s=dS(e,"x","separableConv2d"),c=dS(t,"depthwiseFilter","separableConv2d"),u=dS(n,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(3===s.rank&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");G_(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),G_(4===c.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."})),G_(4===u.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."})),G_(1===u.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."})),G_(1===u.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."}));var f=c.shape[2],h=c.shape[3];G_(u.shape[2]===f*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+u.shape[2]+"."}));var p=RA(l,c,r,i,o,a),m=SA(p,u,1,"valid",o);return d?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),kA=SS({conv2dTranspose_:function(e,t,n,r,i,a){return bA(n,dS(e,"x","conv2dTranspose"),dS(t,"filter","conv2dTranspose"),r,i,"NHWC",a)}}),DA=SS({conv3dTranspose_:function(e,t,n,r,i){return wA(n,dS(e,"x","conv3dTranspose"),dS(t,"filter","conv3dTranspose"),r,i)}}),MA=SS({matMul_:function(e,t,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=dS(e,"a","matMul"),o=dS(t,"b","matMul");i=Kw(a,o),a=i[0],o=i[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],c=r?o.shape[o.rank-1]:o.shape[o.rank-2],u=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=r?o.shape[o.rank-2]:o.shape[o.rank-1],d=a.shape.slice(0,-2),f=o.shape.slice(0,-2),h=K_(d),p=K_(f);G_(a.rank>=2&&o.rank>=2&&a.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."})),G_(X_(d,f),(function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."})),G_(s===c,(function(){return"Error in matMul: inner shapes ("+s+") and ("+c+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var m=a.shape.slice(0,-2).concat([u,l]),g=n?a.as3D(h,s,u):a.as3D(h,u,s),v=r?o.as3D(p,l,c):o.as3D(p,c,l),y={transposeA:n,transposeB:r};return eE.runKernelFunc((function(e,t){var i=e.batchMatMul(g,v,n,r);return t([g,v]),i}),{a:g,b:v},(function(e,t){var i=t,a=i[0],o=i[1];return n||r?!n&&r?{a:function(){return e.matMul(o,!1,!1)},b:function(){return e.matMul(a,!0,!1)}}:n&&!r?{a:function(){return o.matMul(e,!1,!0)},b:function(){return a.matMul(e,!1,!1)}}:{a:function(){return o.matMul(e,!0,!0)},b:function(){return e.matMul(a,!0,!0)}}:{a:function(){return e.matMul(o,!1,!0)},b:function(){return a.matMul(e,!0,!1)}}}),"BatchMatMul",y).reshape(m)}}),LA=SS({dot_:function(e,t){var n=dS(e,"t1","dot"),r=dS(t,"t2","dot");G_(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var i=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return G_(i===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+a+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),OA=SS({outerProduct_:function(e,t){var n=dS(e,"v1","outerProduct"),r=dS(t,"v2","outerProduct");return G_(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),PA=SS({reverse_:function(e,t){var n=dS(e,"x","reverse");if(0===n.rank)return n.clone();var r=nw(t,n.shape);return eE.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),jA=SS({reverse1d_:function(e){var t=dS(e,"x","reverse");return G_(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),PA(t,0)}}),FA=SS({reverse2d_:function(e,t){var n=dS(e,"x","reverse");return G_(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),PA(n,t)}}),UA=SS({reverse3d_:function(e,t){var n=dS(e,"x","reverse");return G_(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),PA(n,t)}}),BA=SS({reverse4d_:function(e,t){var n=dS(e,"x","reverse");return G_(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),PA(n,t)}});function VA(e,t,n,r,i,a){var o=dS(e,"x","maxPool"),s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),null==r&&(r=[1,1]),G_(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),G_(Yx(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=a&&G_(Q_(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var u=Px(s.shape,t,n,r,i,a);if(1===u.filterWidth&&1===u.filterHeight&&X_(u.inShape,u.outShape))return o.clone();var l=[s],d=eE.runKernelFunc((function(e,t){var n=e.maxPool(s,u);return t([s,n]),n}),{x:s},(function(e,a){var o=a[0],s=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var c=dS(e,"dy","maxPoolBackprop"),u=dS(t,"input","maxPoolBackprop"),l=dS(n,"output","maxPoolBackprop");G_(u.rank===c.rank,(function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+c.rank+")"})),null==a&&(a=[1,1]),G_(Yx(i,a),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),G_(4===c.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),G_(4===u.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var d=Px(u.shape,r,i,a,o,s);return eE.runKernelFunc((function(e){return e.maxPoolBackprop(c,u,l,d)}),{$dy:c,$input:u})}(e,o,s,t,n,r,i)}}}),"MaxPool",u,l);return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function zA(e,t,n,r,i,a){var o=dS(e,"x","avgPool","float32");null==r&&(r=[1,1]),G_(Yx(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),G_(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=a&&G_(Q_(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var u=Px(s.shape,t,n,r,i,a);if(1===u.filterWidth&&1===u.filterHeight&&X_(u.inShape,u.outShape))return o.clone();var l=eE.runKernelFunc((function(e){return e.avgPool(s,u)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,i,a){var o=dS(e,"dy","avgPoolBackprop"),s=dS(t,"input","avgPoolBackprop");G_(s.rank===o.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+o.rank+")"})),null==i&&(i=[1,1]),G_(Yx(r,i),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}));var c=s,u=o,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),G_(4===u.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),G_(4===c.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var d=Px(c.shape,n,r,i,a),f=eE.runKernelFunc((function(e){return e.avgPoolBackprop(u,c,d)}),{dy4D:u,input4D:c});return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}(e,s,t,n,r,i)}}}),"AvgPool",u);return l=l.cast(o.dtype),c?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var WA=SS({maxPool_:function(e,t,n,r,i){return VA(e,t,n,1,r,i)}}),GA=SS({avgPool_:function(e,t,n,r,i){return zA(e,t,n,1,r,i)}}),HA=SS({pool_:function(e,t,n,r,i,a){null==i&&(i=[1,1]),null==a&&(a=1),0===r&&(r="valid");var o=dS(e,"x","maxPool"),s=o,c=!1;3===o.rank&&(c=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),G_(Yx(a,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+i+"'"}));var u,l=Px(s.shape,t,a,i,r),d=[l.dilationHeight,l.dilationWidth];u="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),i=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],i[t]]}))}([l.filterHeight,l.filterWidth],d):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],h=function(e,t,n){var r=n.map((function(e){return e[0]})),i=n.map((function(e){return e[1]})),a=e.concat(r,i),o=t.map((function(e,t){return(e-a[t]%e)%e})),s=i.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],d,u),p=h[0],m=h[1],g=f?r:"valid",v=f?s:$S(s,d,p),y=("avg"===n?function(){return zA(v,t,a,1,g)}:function(){return VA(v,t,a,1,g)})(),b=f?y:qS(y,d,m);return c?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),YA=SS({maxPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=dS(e,"x","maxPool3d"),c=s,u=!1;4===s.rank&&(u=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),G_(5===c.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."})),G_("NDHWC"===a,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),G_(Yx(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&G_(Q_(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=jx(c.shape,t,n,o,r,i,a),d=eE.runKernelFunc((function(e,t){var n=e.maxPool3d(c,l);return t([c,n]),n}),{x:c},(function(e,a){var s=a[0],c=a[1];return{x:function(){return function(e,t,n,r,i,a,o,s){var c=dS(e,"dy","maxPool3dBackprop"),u=dS(t,"input","maxPool3dBackprop"),l=dS(n,"output","maxPool3dBackprop"),d=c,f=u,h=l,p=!1;4===u.rank&&(p=!0,d=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),f=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),h=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),G_(5===d.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+d.rank+"."})),G_(5===f.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+f.rank+"."})),G_(5===h.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+h.rank+"."})),null==a&&(a=[1,1,1]),G_(Yx(i,a),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+a+"'"})),null!=s&&G_(Q_(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+o+"."}));var m=jx(f.shape,r,i,a,o,s),g=eE.runKernelFunc((function(e){return e.maxPool3dBackprop(d,f,h,m)}),{dy5D:d,input5D:f});return p?g.as4D(g.shape[1],g.shape[2],g.shape[3],g.shape[4]):g}(e,s,c,t,n,o,r,i)}}}));return u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),qA=SS({avgPool3d_:function(e,t,n,r,i,a,o){void 0===a&&(a="NDHWC");var s=dS(e,"x","avgPool3d","float32"),c=s,u=!1;4===s.rank&&(u=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),G_(5===c.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."})),G_("NDHWC"===a,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),G_(Yx(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=i&&G_(Q_(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=jx(c.shape,t,n,o,r,i,a),d=eE.runKernelFunc((function(e){return e.avgPool3d(c,l)}),{x:c},(function(e){return{x:function(){return function(e,t,n,r,i,a,o){var s=dS(e,"dy","avgPool3dBackprop"),c=dS(t,"input","avgPool3dBackprop"),u=s,l=c,d=!1;4===c.rank&&(d=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3])),G_(5===u.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+u.rank+"."})),G_(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==i&&(i=[1,1,1]),G_(Yx(r,i),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"})),null!=o&&G_(Q_(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."}));var f=jx(l.shape,n,r,i,a,o),h=eE.runKernelFunc((function(e){return e.avgPool3dBackprop(u,l,f)}),{dy5D:u,input5D:l});return d?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}(e,c,t,n,o,r,i)}}}));return d=d.cast(c.dtype),u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),KA=SS({maxPoolWithArgmax_:function(e,t,n,r,i){void 0===i&&(i=!1);var a=dS(e,"x","maxPoolWithArgmax"),o={filterSize:t,strides:n,pad:r,includeBatchInIndex:i},s=eE.runKernel("MaxPoolWithArgmax",{x:a},o);return{result:s[0],indexes:s[1]}}}),XA=SS({slice_:function(e,t,n){var r,i,a=dS(e,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(a.rank-1).fill(0)):t.length<a.rank?t.concat(new Array(a.rank-t.length).fill(0)):t.slice()).forEach((function(e){G_(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(G_(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."})),a.shape[t]-r[t])})),Ex(a,r,i);var o=a.shape,s={begin:r,size:i};return eE.runKernelFunc((function(e){return e.slice(a,r,i)}),{x:a},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-i[n]]);return{x:function(){return UN(e,t)}}}),"Slice",s)}}),QA=SS({slice1d_:function(e,t,n){var r=dS(e,"x","slice1d");return G_(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),XA(r,[t],[n])}}),JA=SS({slice2d_:function(e,t,n){var r=dS(e,"x","slice2d");return G_(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),XA(r,t,n)}}),ZA=SS({slice3d_:function(e,t,n){var r=dS(e,"x","slice3d");return G_(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),XA(r,t,n)}}),$A=SS({slice4d_:function(e,t,n){var r=dS(e,"x","slice4d");return G_(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),XA(r,t,n)}});function ek(e,t,n,r,i){return t.rank<n.rank&&(t=t.reshape(gS(t.shape,r))),e.rank<n.rank&&(e=e.reshape(gS(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==i?r:r.transpose(i)}}}var tk=SS({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=dS(e,"x","all","bool"),i=nw(t,r.shape),a=i,o=yS(a,r.rank);null!=o&&(r=r.transpose(o),a=_S(a.length,r.rank));var s=eE.runKernelFunc((function(e){return e.all(r,a)}),{$x:r});if(n){var c=gS(s.shape,i);return s.reshape(c)}return s}}),nk=SS({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=dS(e,"x","any","bool"),i=nw(t,r.shape),a=i,o=yS(a,r.rank);null!=o&&(r=r.transpose(o),a=_S(a.length,r.rank));var s=eE.runKernelFunc((function(e){return e.any(r,a)}),{$x:r});if(n){var c=gS(s.shape,i);return s.reshape(c)}return s}}),rk=SS({argMax_:function(e,t){void 0===t&&(t=0);var n=dS(e,"x","argMax");null==t&&(t=0);var r=nw(t,n.shape),i=yS(r,n.rank);null!=i&&(n=n.transpose(i),r=_S(r.length,n.rank));var a={axis:r[0]},o=[n];return eE.runKernelFunc((function(e,t){var i=e.argMax(n,r[0]);return t([n]),i}),{x:n},(function(e,t){var n=t[0];return{x:function(){return US(n)}}}),"ArgMax",a,o)}}),ik=SS({argMin_:function(e,t){void 0===t&&(t=0);var n=dS(e,"x","argMin");null==t&&(t=0);var r=nw(t,n.shape),i=yS(r,n.rank);return null!=i&&(n=n.transpose(i),r=_S(r.length,n.rank)),eE.runKernelFunc((function(e,t){var i=e.argMin(n,r[0]);return t([n]),i}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return US(n)}}}))}}),ak=SS({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=dS(e,"x","logSumExp"),i=nw(t,r.shape),a=r.max(i,!0),o=r.sub(a).exp().sum(i).log(),s=a.reshape(o.shape).add(o);if(n){var c=gS(s.shape,i);return s.reshape(c)}return s}}),ok=SS({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=dS(e,"x","max"),i=r,a=nw(t,r.shape),o=a,s=yS(o,r.rank);null!=s&&(r=r.transpose(s),o=_S(o.length,r.rank));var c=[r],u=eE.runKernelFunc((function(e,t){var n=e.max(r,o);return t([i,n]),n}),{x:r},(function(e,t){return ek(e,t[1],t[0],a,s)}),"Max",{axes:o},c,[!0]);if(n){var l=gS(u.shape,a);u=u.reshape(l)}return u}}),sk=SS({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=dS(e,"x","mean"),i=nw(t,r.shape),a=K_(mS(r.shape,i)[1]);return Nx((function(e){var r=NS(a);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(LS(e.shape,"float32")).div(a)}}}))(r)}}),ck=SS({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=dS(e,"x","min"),i=r,a=nw(t,r.shape),o=a,s=yS(o,r.rank);null!=s&&(r=r.transpose(s),o=_S(o.length,r.rank));var c=[r],u=eE.runKernelFunc((function(e,t){var n=e.min(r,o);return t([i,n]),n}),{x:r},(function(e,t){return ek(e,t[1],t[0],a,s)}),"Min",{axes:o},c,[!0]);if(n){var l=gS(u.shape,a);u=u.reshape(l)}return u}}),uk=SS({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=nw(t,(e=dS(e,"x","moments")).shape),i=e.mean(r,n),a=i.shape;n||(a=gS(i.shape,r));var o=e.toFloat().sub(i.reshape(a)).square();return{mean:i,variance:o.mean(r,n)}}}),lk=SS({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=dS(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=nw(t,r.shape);return Nx((function(e){var t=yS(i,e.rank),r=i,a=e;null!=t&&(a=e.transpose(t),r=_S(r.length,e.rank));var o=function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(LS(e.shape,"float32"))},s={axes:r},c=eE.runKernelFunc((function(e){return e.sum(a,r)}),{x:a},(function(e){return{x:function(){return o(e)}}}),"Sum",s);if(n){var u=gS(c.shape,i);c=c.reshape(u)}return{value:c,gradFunc:o}}))(r)}}),dk=SS({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=dS(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=nw(t,r.shape),a=yS(i,r.rank),o=i,s=r;null!=a&&(s=r.transpose(a),o=_S(o.length,r.rank));var c=eE.runKernelFunc((function(e){return e.prod(s,o)}),{permutedX:s});if(n){var u=gS(c.shape,i);c=c.reshape(u)}return c}}),fk=SS({elu_:function(e){var t=dS(e,"x","elu");return eE.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return eE.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),hk=SS({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=dS(e,"x","leakyRelu");return rx(NS(t).mul(n),n)}}),pk=SS({prelu_:function(e,t){var n=dS(e,"x","prelu"),r=dS(t,"alpha","prelu");return eE.runKernelFunc((function(e,t){var i=e.prelu(n,r);return t([n,r]),i}),{x:n,alpha:r},(function(e,t){var n=t[0],r=t[1],i=n.greater(0);return{x:function(){return DN(i,e,e.mul(r))},alpha:function(){var t=DN(i,US(e),e.mul(n)),a=vC(r.shape,e.shape);return a.length>0&&(t=t.sum(a)),t.reshape(r.shape)}}}),"Prelu")}}),mk=SS({relu_:function(e){var t=dS(e,"x","relu");return"bool"===t.dtype?t.toInt():eE.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}}),"Relu")}}),gk=SS({relu6_:function(e){var t=dS(e,"x","relu6");return"bool"===t.dtype?t.toInt():eE.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}}),"Relu6")}}),vk=SS({selu_:function(e){var t=dS(e,"x","selu");return eE.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(NS(0)),r=NS(CI),i=NS(xI),a=e.mul(i),o=e.mul(r).mul(n.toFloat().exp());return DN(t,a,o)}}}))}}),yk=SS({localResponseNormalization_:function(e,t,n,r,i){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var a=dS(e,"x","localResponseNormalization");G_(4===a.rank||3===a.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."})),G_(Q_(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var o=a,s=!1;3===a.rank&&(s=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var c=eE.runKernelFunc((function(e,a){var s=e.localResponseNormalization4D(o,t,n,r,i);return a([o,s]),s}),{x4D:o},(function(e,a){var o=a[0],s=a[1];return{x4D:function(){return eE.runKernelFunc((function(a){return a.LRNGrad(e,o,s,t,n,r,i)}),{})}}}));return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),bk=SS({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(NS(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=dS(e,"x","norm"),t,n),a=i.shape;if(r){var o=nw(n,e.shape);a=gS(i.shape,o)}return i.reshape(a)}}),_k=SS({basicLSTMCell_:function(e,t,n,r,i,a){var o=dS(e,"forgetBias","basicLSTMCell"),s=dS(t,"lstmKernel","basicLSTMCell"),c=dS(n,"lstmBias","basicLSTMCell"),u=dS(r,"data","basicLSTMCell"),l=dS(i,"c","basicLSTMCell"),d=dS(a,"h","basicLSTMCell"),f=u.concat(d,1).matMul(s).add(c),h=f.shape[0],p=f.shape[1]/4,m=[h,p],g=f.slice([0,0],m),v=f.slice([0,p],m),y=f.slice([0,2*p],m),b=f.slice([0,3*p],m),_=g.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(o.add(y).sigmoid())),w=_.tanh().mulStrict(b.sigmoid());return[_,w]}}),wk=SS({multiRNNCell_:function(e,t,n,r){for(var i=dS(t,"data","multiRNNCell"),a=fS(n,"c","multiRNNCell"),o=fS(r,"h","multiRNNCell"),s=i,c=[],u=0;u<e.length;u++){var l=e[u](s,a[u],o[u]);c.push(l[0]),c.push(l[1]),s=l[1]}var d=[],f=[];for(u=0;u<c.length;u+=2)d.push(c[u]),f.push(c[u+1]);return[d,f]}}),Ek=SS({movingAverage_:function(e,t,n,r,i){void 0===i&&(i=!0);var a=dS(e,"v","movingAverage"),o=dS(t,"x","movingAverage"),s=dS(n,"decay","movingAverage");Xw(a,o),G_(X_(a.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var c=NS(1),u=c.sub(s),l=o.sub(a).mul(u);if(i){G_(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var d=dS(r,"step","movingAverage");l=l.div(c.sub(dx(s,d)))}return a.add(l)}}),Sk=SS({stridedSlice_:function(e,t,n,r,i,a,o,s,c){if(void 0===i&&(i=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),null==r&&(r=new Array(t.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var u=dS(e,"x","stridedSlice"),l=Sx(s),d=u.shape.slice();l.forEach((function(e){t[e]=0,n[e]=1,d.splice(e,0,1)})),u=u.reshape(d);for(var f=0;f<u.rank;f++)t[f]=xx(i,t,r,u.shape,f),n[f]=Tx(a,n,r,u.shape,f),r[f]=r[f]||1;var h=Sx(c);h.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var p=Cx(t,n,r),m=p.filter((function(e,t){return-1===h.indexOf(t)}));return r.every((function(e){return 1===e}))?XA(u,t,p).reshape(m):eE.runKernelFunc((function(e){return e.stridedSlice(u,t,n,r)}),{$x:u}).reshape(m)}}),Ck=SS({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=dS(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var a=eE.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r});return{values:a[0],indices:a[1]}}}),xk=SS({scatterND_:function(e,t,n){var r=dS(e,"indices","scatterND","int32"),i=dS(t,"updates","scatterND");return _x(i,r,n),eE.runKernelFunc((function(e){return e.scatterND(r,i,n)}),{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),Tk=SS({fft_:function(e){G_("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return eE.runKernelFunc((function(e){return e.fft(r)}),{input:e}).reshape(e.shape)}}),Rk=SS({ifft_:function(e){G_("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return eE.runKernelFunc((function(e){return e.ifft(r)}),{input:e}).reshape(e.shape)}}),Ik=SS({rfft_:function(e,t){G_("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],i=e.size/r;if(null!=t&&t<r){var a=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=e.slice(a,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(OS(s),e.shape.length-1),r=t}else n=e;var c=n.zerosLike(),u=CS(n,c).as2D(i,r),l=Tk(u),d=Math.floor(r/2)+1,f=xS(l),h=TS(l),p=f.split([d,r-d],f.shape.length-1),m=h.split([d,r-d],h.shape.length-1),g=n.shape.slice();return g[n.shape.length-1]=d,CS(p[0],m[0]).reshape(g)}}),Nk=SS({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),i=Rk(r);return xS(i)}var a=[n,2*(t-1)],o=xS(e).as2D(n,t),s=TS(e).as2D(n,t),c=o.slice([0,1],[n,t-2]).reverse(1),u=s.slice([0,1],[n,t-2]).reverse(1).mul(NS(-1)),l=o.concat(c,1),d=s.concat(u,1);return r=CS(l,d).as2D(a[0],a[1]),i=Rk(r),xS(i)}}),Ak=Object.freeze({fft:Tk,ifft:Rk,rfft:Ik,irfft:Nk}),kk=SS({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var i=dS(e,"sparseIndices","sparseToDense","int32"),a=dS(t,"sparseValues","sparseToDense"),o=dS(r,"defaultValue","sparseToDense",a.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var i=e.rank>0?e.shape[0]:1,a=e.rank>1?e.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==i))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+i+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,a,n,o),eE.runKernelFunc((function(e){return e.sparseToDense(i,a,n,o)}),{$sparseIndices:i,$sparseValues:a,$defaultValue:o})}}),Dk=SS({gatherND_:function(e,t){var n=dS(t,"indices","gatherND","int32"),r=dS(e,"x","gatherND");return eE.runKernelFunc((function(e){return e.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),Mk=SS({diag_:function(e){var t=dS(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return eE.runKernelFunc((function(e){return e.diag(t)}),{$x:t}).reshape(n)}}),Lk=SS({dropout_:function(e,t,n,r){var i=dS(e,"x","dropout");if(G_("float32"===i.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),G_(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return e instanceof Fw?i.clone():i;var a=function(e,t){if(null==t)return e.shape.slice();if(X_(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(i,n),o=1-t,s=$N(a,0,1,"float32",r).add(o).floor().div(o);return i.mul(s)}});function Ok(e,t,n){for(var r=1-e%2,i=new Float32Array(e),a=0;a<e;++a){var o=2*Math.PI*a/(e+r-1);i[a]=t-n*Math.cos(o)}return AS(i,"float32")}var Pk,jk=SS({hannWindow_:function(e){return Ok(e,.5,.5)}}),Fk=SS({hammingWindow_:function(e){return Ok(e,.54,.46)}}),Uk=SS({frame_:function(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var a=0,o=[];a+t<=e.size;)o.push(XA(e,a,t)),a+=n;if(r)for(;a<e.size;){var s=a+t-e.size,c=BS([XA(e,a,t-s),PS([s],i)]);o.push(c),a+=n}return 0===o.length?kS([],[0,t]):BS(o).as2D(o.length,t)}}),Bk=SS({stft_:function(e,t,n,r,i){var a;void 0===i&&(i=jk),null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var o=Uk(e,t,n),s=ux(o,i(t)),c=[],u=0;u<o.shape[0];u++)c.push(Ik(s.slice([u,0],[1,t]),r));return BS(c)}}),Vk=Object.freeze({hannWindow:jk,hammingWindow:Fk,frame:Uk,stft:Bk});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Pk||(Pk={}));var zk=SS({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=Pk.SUM_BY_NONZERO_WEIGHTS);var i=dS(e,"labels","absoluteDifference"),a=dS(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=dS(n,"weights","absoluteDifference")),H_(i.shape,a.shape,"Error in absoluteDifference: ");var s=i.sub(a).abs();return Wk(s,o,r)}}),Wk=SS({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=Pk.SUM_BY_NONZERO_WEIGHTS);var r=dS(e,"losses","computeWeightedLoss"),i=null;null!=t&&(i=dS(t,"weights","computeWeightedLoss"));var a=null==i?r:r.mul(i);if(n===Pk.NONE)return a;if(n===Pk.SUM)return a.sum();if(n===Pk.MEAN){if(null==i)return a.mean();var o=r.size/i.size,s=a.sum().div(i.sum());return o>1?s.div(NS(o)):s}if(n===Pk.SUM_BY_NONZERO_WEIGHTS){if(null==i)return a.sum().div(NS(r.size));var c=i.mul(LS(r.shape)).notEqual(NS(0)).sum().toFloat();return a.sum().div(c)}throw Error("Unknown reduction: "+n)}}),Gk=SS({cosineDistance_:function(e,t,n,r,i){void 0===i&&(i=Pk.SUM_BY_NONZERO_WEIGHTS);var a=dS(e,"labels","cosineDistance"),o=dS(t,"predictions","cosineDistance"),s=null;null!=r&&(s=dS(r,"weights","cosineDistance")),H_(a.shape,o.shape,"Error in cosineDistance: ");var c=NS(1).sub(a.mul(o).sum(n,!0));return Wk(c,s,i)}}),Hk=SS({hingeLoss_:function(e,t,n,r){void 0===r&&(r=Pk.SUM_BY_NONZERO_WEIGHTS);var i=dS(e,"labels","hingeLoss"),a=dS(t,"predictions","hingeLoss"),o=null;null!=n&&(o=dS(n,"weights","hingeLoss")),H_(i.shape,a.shape,"Error in hingeLoss: ");var s=NS(1);i=NS(2).mul(i).sub(s);var c=s.sub(i.mul(a)).relu();return Wk(c,o,r)}}),Yk=SS({huberLoss_:function(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=Pk.SUM_BY_NONZERO_WEIGHTS);var a=dS(e,"labels","huberLoss"),o=dS(t,"predictions","huberLoss"),s=null;null!=n&&(s=dS(n,"weights","huberLoss")),H_(a.shape,o.shape,"Error in huberLoss: ");var c=NS(r),u=o.sub(a).abs(),l=ax(u,c),d=u.sub(l),f=NS(.5).mul(l.square()).add(c.mul(d));return Wk(f,s,i)}}),qk=SS({logLoss_:function(e,t,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=Pk.SUM_BY_NONZERO_WEIGHTS);var a=dS(e,"labels","logLoss"),o=dS(t,"predictions","logLoss"),s=null;null!=n&&(s=dS(n,"weights","logLoss")),H_(a.shape,o.shape,"Error in logLoss: ");var c=NS(1),u=NS(r),l=a.mul(o.add(u).log()).neg().sub(c.sub(a).mul(c.sub(o).add(u).log()));return Wk(l,s,i)}}),Kk=SS({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=Pk.SUM_BY_NONZERO_WEIGHTS);var i=dS(e,"labels","meanSquaredError"),a=dS(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=dS(n,"weights","meanSquaredError")),H_(i.shape,a.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(a);return Wk(s,o,r)}}),Xk=SS({sigmoidCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=Pk.SUM_BY_NONZERO_WEIGHTS);var a=dS(e,"multiClassLabels","sigmoidCrossEntropy"),o=dS(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=dS(n,"weights","sigmoidCrossEntropy")),H_(a.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=NS(r),u=NS(1),l=NS(.5);a=a.mul(u.sub(c)).add(l.mul(c))}var d=function(e,t){var n=dS(e,"labels","sigmoidCrossEntropyWithLogits"),r=dS(t,"logits","sigmoidCrossEntropyWithLogits");H_(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),a=r.mul(n),o=r.abs().neg().exp().log1p();return i.sub(a).add(o)}(a,o);return Wk(d,s,i)}}),Qk=SS({softmaxCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=Pk.SUM_BY_NONZERO_WEIGHTS);var a=dS(e,"onehotLabels","softmaxCrossEntropy"),o=dS(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=dS(n,"weights","softmaxCrossEntropy")),H_(a.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var c=NS(r),u=NS(1),l=NS(a.shape[1]);a=a.mul(u.sub(c)).add(c.div(l))}var d=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return Nx((function(e,t,r){var i=t.logSumExp([n],!0),a=t.toFloat().sub(i);return r([e,a]),{value:a.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],i=t[1],a=gS(e.shape,[n]);return[e.reshape(a).mul(r.toFloat().sub(i.exp())),e.reshape(a).mul(i.exp().sub(r.toFloat()))]}}}))(e,t)}(a,o);return Wk(d,s,i)}}),Jk=Object.freeze({get Reduction(){return Pk},absoluteDifference:zk,computeWeightedLoss:Wk,cosineDistance:Gk,hingeLoss:Hk,huberLoss:Yk,logLoss:qk,meanSquaredError:Kk,sigmoidCrossEntropy:Xk,softmaxCrossEntropy:Qk});function Zk(e,t){return void 0===t&&(t=!1),eE.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],i=PN(n),a=e.clone(),o=kS([[1]],[1,1]),s=o.clone(),c=n>=r?r:n,u=function(e){var t,c=a,u=s,l=i;t=eE.tidy((function(){var t=a.slice([e,e],[n-e,1]),c=t.norm(),u=a.slice([e,e],[1,1]),l=kS([[-1]]).where(u.greater(0),kS([[1]])),d=u.sub(l.mul(c)),f=t.div(d);s=1===f.shape[0]?o.clone():o.concat(f.slice([1,0],[f.shape[0]-1,f.shape[1]]),0);var h=l.matMul(d).div(c).neg(),p=a.slice([e,0],[n-e,r]),m=h.mul(s),g=s.transpose();if(0===e)a=p.sub(m.matMul(g.matMul(p)));else{var v=p.sub(m.matMul(g.matMul(p)));a=a.slice([0,0],[e,r]).concat(v,0)}var y=m.transpose(),b=i.slice([0,e],[n,i.shape[1]-e]);if(0===e)i=b.sub(b.matMul(s).matMul(y));else{var _=b.sub(b.matMul(s).matMul(y));i=i.slice([0,0],[n,e]).concat(_,1)}return[s,a,i]})),s=t[0],a=t[1],i=t[2],sS([c,u,l])},l=0;l<c;++l)u(l);return!t&&n>r&&(i=i.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[i,a]}))}var $k=SS({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=dS(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,a=r.shape.slice(-2),o=a[0],s=a[1];if(!(t<=o))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+o+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=o),n<0&&(n=s);var c=jS(0,o,1,"int32").reshape([-1,1]),u=jS(0,s,1,"int32"),l=px(c,u),d=IN(l.lessEqual(NS(+t,"int32")),l.greaterEqual(NS(-n,"int32"))),f=OS([o,s],r.dtype);return tC(nC(r.reshape([-1,o,s])).map((function(e){return DN(d,e,f)}))).reshape(i)}}),eD=SS({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,G_(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){G_(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},i=1;i<e.length;++i)r(i)}else t=!0,e=HS(e,e.shape[0],0).map((function(e){return eC(e,[0])}));G_(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var a=[],o=e,s=function(e){a.push(eE.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=lk(a[n].mulStrict(t)).mul(a[n]);t=t.sub(r)}return t.div(bk(t,"euclidean"))})))};for(i=0;i<e.length;++i)s(i);return t?tC(a,0):a}}),tD=SS({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return Zk(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=nC(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],a=[];return r.forEach((function(e){var n=Zk(e,t),r=n[0],o=n[1];i.push(r),a.push(o)})),[tC(i,0).reshape(e.shape),tC(a,0).reshape(e.shape)]}}),nD=Object.freeze({bandPart:$k,gramSchmidt:eD,qr:tD});function rD(e,t,n,r,i,a){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==a&&(a=0);var o=e.shape[0];return n=Math.min(n,o),G_(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),G_(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),G_(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),G_(1===t.rank,(function(){return"scores must be a 1D tensor"})),G_(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]})),G_(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:a}}var iD=SS({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=dS(e,"images","resizeBilinear");G_(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),G_(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],c=eE.runKernelFunc((function(e,t){return t([i]),e.resizeBilinear(i,o,s,n)}),{x:i},(function(e,t){return{x:function(){return eE.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:o,newWidth:s});return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),aD=SS({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=dS(e,"images","resizeNearestNeighbor");G_(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),G_(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),G_("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,a=!1;3===r.rank&&(a=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=t[0],s=t[1],c=eE.runKernelFunc((function(e,t){return t([i]),e.resizeNearestNeighbor(i,o,s,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return eE.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return a?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),oD=SS({nonMaxSuppression_:function(e,t,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var a=dS(e,"boxes","nonMaxSuppression"),o=dS(t,"scores","nonMaxSuppression"),s=rD(a,o,n,r,i);n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var c={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return eE.runKernelFunc((function(e){return e.nonMaxSuppression(a,o,n,r,i)}),{boxes:a,scores:o},null,"NonMaxSuppressionV3",c)}}),sD=SS({nonMaxSuppressionWithScore_:function(e,t,n,r,i,a){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var o=dS(e,"boxes","nonMaxSuppression"),s=dS(t,"scores","nonMaxSuppression"),c=rD(o,s,n,r,i,a),u={maxOutputSize:n=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:i=c.scoreThreshold,softNmsSigma:a=c.softNmsSigma},l=eE.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},u);return{selectedIndices:l[0],selectedScores:l[1]}}}),cD=SS({cropAndResize_:function(e,t,n,r,i,a){var o=dS(e,"image","cropAndResize"),s=dS(t,"boxes","cropAndResize","float32"),c=dS(n,"boxInd","cropAndResize","int32");i=i||"bilinear",a=a||0;var u=s.shape[0];return G_(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+o.rank+"."})),G_(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+s.shape+"."})),G_(1===c.rank&&c.shape[0]===u,(function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+s.shape+"."})),G_(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),G_(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),G_("bilinear"===i||"nearest"===i,(function(){return"method must be bilinear or nearest, but was "+i})),eE.runKernelFunc((function(e,t){return e.cropAndResize(o,s,c,r,i,a)}),{images:o,boxes:s,boxInd:c},null,"CropAndResize",{method:i,extrapolationValue:a,cropSize:r})}}),uD=Object.freeze({resizeBilinear:iD,resizeNearestNeighbor:aD,nonMaxSuppression:oD,nonMaxSuppressionAsync:function(e,t,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),R_(this,void 0,void 0,(function(){var a,o,s,c,u,l,d;return I_(this,(function(f){switch(f.label){case 0:return a=dS(e,"boxes","nonMaxSuppressionAsync"),o=dS(t,"scores","nonMaxSuppressionAsync"),s=rD(a,o,n,r,i),n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([a.data(),o.data()])];case 1:return c=f.sent(),u=c[0],l=c[1],d=rT(u,l,n,r,i),a!==e&&a.dispose(),o!==t&&o.dispose(),[2,d]}}))}))},nonMaxSuppressionWithScore:sD,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,i,a){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===a&&(a=0),R_(this,void 0,void 0,(function(){var o,s,c,u,l,d,f;return I_(this,(function(h){switch(h.label){case 0:return o=dS(e,"boxes","nonMaxSuppressionAsync"),s=dS(t,"scores","nonMaxSuppressionAsync"),c=rD(o,s,n,r,i,a),n=c.maxOutputSize,r=c.iouThreshold,i=c.scoreThreshold,a=c.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return u=h.sent(),l=u[0],d=u[1],f=iT(l,d,n,r,i,a),o!==e&&o.dispose(),s!==t&&s.dispose(),[2,f]}}))}))},cropAndResize:cD}),lD=function(e,t){return!(e>0)||"linear"===t},dD=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},fD=function(e,t){var n=t,r=vC(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},hD=function(e,t,n){if("linear"===t)return e;if("relu"===t)return mk(e);if("elu"===t)return fk(e);if("relu6"===t)return gk(e);if("prelu"===t)return pk(e,n);throw new Error("Unknown fused activation "+t+".")},pD=SS({fusedMatMul_:function(e){var t,n=e.a,r=e.b,i=e.transposeA,a=void 0!==i&&i,o=e.transposeB,s=void 0!==o&&o,c=e.bias,u=e.activation,l=void 0===u?"linear":u,d=e.preluActivationWeights;if(!1===lD(eE.state.gradientDepth,l)){var f=MA(n,r,a,s);return null!=c&&(f=mC(f,c)),hD(f,l,d)}var h=dS(n,"a","fused matMul"),p=dS(r,"b","fused matMul");t=Kw(h,p),h=t[0],p=t[1];var m=a?h.shape[h.rank-2]:h.shape[h.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=a?h.shape[h.rank-1]:h.shape[h.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],b=h.shape.slice(0,-2),_=p.shape.slice(0,-2),w=K_(b),E=K_(_);G_(h.rank>=2&&p.rank>=2&&h.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."})),G_(X_(b,_),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+_+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."})),G_(m===g,(function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+a+" and transposeB="+s+" must match."}));var S,C,x=h.shape.slice(0,-2).concat([v,y]),T=a?h.as3D(w,m,v):h.as3D(w,v,m),R=s?p.as3D(E,y,g):p.as3D(E,g,y);null!=c&&yC(x,(S=Kw(S=dS(c,"bias","fused matMul"),h)[0]).shape),null!=d&&(C=dS(d,"prelu weights","fused matMul"));var I={a:T,b:R};null!=c&&(I.bias=S),null!=d&&(I.preluActivationWeights=C);var N=[T,R];return eE.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:T,b:R,transposeA:a,transposeB:s,bias:S,activation:l,preluActivationWeights:C});return t([T,R,n]),n}),I,(function(e,t){var n=t[0],r=t[1],i=t[2],o=dD(e,i,l),u={};return null!=c&&(u={bias:function(){return fD(S,o)}}),a||s?!a&&s?Object.assign({a:function(){return o.matMul(r,!1,!1)},b:function(){return o.matMul(n,!0,!1)}},u):a&&!s?Object.assign({a:function(){return r.matMul(o,!1,!0)},b:function(){return n.matMul(o,!1,!1)}},u):Object.assign({a:function(){return r.matMul(o,!0,!0)},b:function(){return o.matMul(n,!0,!0)}},u):Object.assign({a:function(){return o.matMul(r,!1,!0)},b:function(){return n.matMul(o,!0,!1)}},u)}),"_FusedMatMul",{transposeA:a,transposeB:s,activation:l},N,[!0]).reshape(x)}}),mD=SS({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,c=void 0===s?[1,1]:s,u=e.dimRoundingMode,l=e.bias,d=e.activation,f=void 0===d?"linear":d,h=e.preluActivationWeights;if(f=f||"linear",!1===lD(eE.state.gradientDepth,f)){var p=SA(t,n,r,i,o,c,u);return null!=l&&(p=mC(p,l)),hD(p,f,h)}var m=dS(t,"x","conv2d"),g=dS(n,"filter","conv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),G_(4===v.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."})),G_(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."})),null!=u&&G_(Q_(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+"."})),G_(v.shape[3]===g.shape[2],(function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."})),G_(Yx(r,c),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"})),G_("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of "+o+" but only NHWC is currently supported."}));var b,_,w=Fx(v.shape,g.shape,r,c,i,u);null!=l&&(b=Kw(b=dS(l,"bias","fused conv2d"),m)[0],yC(w.outShape,b.shape)),null!=h&&(_=dS(h,"prelu weights","fused conv2d"));var E={x:v,filter:g};null!=l&&(E.bias=b),null!=h&&(E.preluActivationWeights=_);var S=[g,v],C=eE.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:v,filter:g,convInfo:w,bias:b,activation:f,preluActivationWeights:_});return t([g,v,n]),n}),E,(function(e,t){var n=t,a=n[0],o=n[1],s=n[2],u=dD(e,s,f);G_(Hx(c),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"}));var d={};return null!=l&&(d={bias:function(){return fD(b,u)}}),Object.assign({x:function(){return TA(o.shape,u,a,r,i)},filter:function(){return xA(o,u,a.shape,r,i)}},d)}),"FusedConv2D",{convInfo:w,activation:f},S,[!0]);return y?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),gD=SS({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,a=e.dataFormat,o=void 0===a?"NHWC":a,s=e.dilations,c=void 0===s?[1,1]:s,u=e.dimRoundingMode,l=e.bias,d=e.activation,f=void 0===d?"linear":d,h=e.preluActivationWeights;if(!1===lD(eE.state.gradientDepth,f)){var p=RA(t,n,r,i,o,c,u);return null!=l&&(p=mC(p,l)),hD(p,f,h)}var m=dS(t,"x","depthwiseConv2d"),g=dS(n,"filter","depthwiseConv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),G_(4===v.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."})),G_(4===g.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."})),G_(v.shape[3]===g.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."})),null==c&&(c=[1,1]),G_(Yx(r,c),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"})),null!=u&&G_(Q_(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+u+" but got pad "+i+"."}));var b,_,w=Fx(v.shape,g.shape,r,c,i,u,!0);null!=l&&(b=Kw(b=dS(l,"bias","fused conv2d"),m)[0],yC(w.outShape,b.shape)),null!=h&&(_=dS(h,"prelu weights","fused depthwiseConv2d"));var E={x:v,filter:g};null!=l&&(E.bias=b),null!=h&&(E.preluActivationWeights=_);var S=[g,v],C=eE.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:v,filter:g,convInfo:w,bias:b,activation:f,preluActivationWeights:_});return t([g,v,n]),n}),E,(function(e,t){G_(Hx(c),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"}));var n=t[0],r=t[1],i=t[2],a=dD(e,i,f),o={};return null!=l&&(o={bias:function(){return fD(b,a)}}),Object.assign({x:function(){return IA(r.shape,a,n,w)},filter:function(){return NA(r,a,n.shape,w)}},o)}),"FusedDepthwiseConv2D",{convInfo:w,activation:f},S,[!0]);return y?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),vD=Object.freeze({matMul:pD,conv2d:mD,depthwiseConv2d:gD}),yD=Object.freeze({image:uD,linalg:nD,losses:Jk,spectral:Ak,fused:vD,signal:Vk,add:mC,addN:lN,batchNorm:gN,batchNormalization:mN,batchNorm2d:bN,batchNormalization2d:yN,batchNorm3d:EN,batchNormalization3d:wN,batchNorm4d:xN,batchNormalization4d:CN,broadcastTo:TN,clone:RN,div:gx,divNoNan:LN,eye:PN,multinomial:jN,oneHot:FN,pad:UN,pad1d:BN,pad2d:VN,pad3d:zN,pad4d:WN,rand:GN,randomGamma:JN,randomNormal:ZN,randomUniform:$N,square:eA,squaredDifference:tA,tile:ON,truncatedNormal:nA,conv1d:EA,conv2d:SA,conv3d:CA,depthwiseConv2d:RA,separableConv2d:AA,conv2dTranspose:kA,conv3dTranspose:DA,op:SS,booleanMaskAsync:function(e,t,n){return R_(this,void 0,void 0,(function(){var r,i,a,o,s,c,u,l,d,f,h,p,m;return I_(this,(function(g){switch(g.label){case 0:for(r=dS(e,"tensor","boolMask"),i=dS(t,"mask","boolMask","bool"),a=null==n?0:n,o=i.rank,s=r.shape,G_(o>0,(function(){return"mask cannot be scalar"})),H_(s.slice(a,a+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,u=a;u<a+o;u++)c*=s[u];return l=s.slice(0,a).concat([c],s.slice(a+o)),d=r.reshape(l),f=i.reshape([-1]),[4,MN(f)];case 1:return h=g.sent(),p=h.squeeze([1]),m=vA(d,p,a),e!==r&&r.dispose(),t!==i&&i.dispose(),p.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,m]}}))}))},complex:CS,real:xS,imag:TS,concat:BS,concat1d:VS,concat2d:zS,concat3d:WS,concat4d:GS,split:HS,matMul:MA,dot:LA,outerProduct:OA,reverse:PA,reverse1d:jA,reverse2d:FA,reverse3d:UA,reverse4d:BA,maxPool:WA,avgPool:GA,pool:HA,maxPool3d:YA,avgPool3d:qA,maxPoolWithArgmax:KA,slice:XA,slice1d:QA,slice2d:JA,slice3d:ZA,slice4d:$A,abs:bC,acos:_C,acosh:wC,asin:EC,asinh:SC,atan:CC,atanh:xC,ceil:TC,clipByValue:RC,cos:IC,cosh:NC,erf:AC,exp:kC,expm1:DC,floor:MC,log:LC,log1p:OC,logSigmoid:PC,neg:jC,reciprocal:FC,round:UC,rsqrt:BC,sigmoid:VC,sign:zC,isNaN:WC,isInf:GC,isFinite:HC,sin:YC,sinh:qC,softplus:KC,sqrt:XC,step:QC,tan:JC,tanh:ZC,all:tk,any:nk,argMax:rk,argMin:ik,logSumExp:ak,max:ok,mean:sk,min:ck,moments:uk,sum:lk,prod:dk,equal:rA,equalStrict:iA,greater:aA,greaterEqual:oA,greaterEqualStrict:sA,greaterStrict:cA,less:uA,lessEqual:lA,lessEqualStrict:dA,lessStrict:fA,notEqual:hA,notEqualStrict:pA,addStrict:$C,atan2:ex,divStrict:tx,floorDiv:nx,maximum:rx,maximumStrict:ix,minimum:ax,minimumStrict:ox,mod:sx,modStrict:cx,mul:ux,mulStrict:lx,pow:dx,powStrict:fx,squaredDifferenceStrict:hx,sub:px,subStrict:mx,elu:fk,leakyRelu:hk,prelu:pk,relu:mk,relu6:gk,selu:vk,logicalAnd:IN,logicalNot:NN,logicalOr:AN,logicalXor:kN,where:DN,whereAsync:MN,buffer:YS,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:qS,cast:KS,cumsum:XS,depthToSpace:QS,expandDims:JS,reshape:ZS,spaceToBatchND:$S,squeeze:eC,stack:tC,unstack:nC,setdiff1dAsync:function(e,t){return R_(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l,d;return I_(this,(function(f){switch(f.label){case 0:return n=dS(e,"x","setdiff1d"),r=dS(t,"y","setdiff1d"),G_(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),G_(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),G_(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(a=f.sent(),o=new Set(a),s=0,l=0;l<i.length;l++)o.has(i[l])||s++;for(c=new Lw([s],n.dtype),u=new Lw([s],"int32"),l=0,d=0;l<i.length;l++)o.has(i[l])||(c.values[d]=i[l],u.values[d]=l,d++);return[2,[c.toTensor(),u.toTensor()]]}}))}))},fill:PS,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return eE.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})},ones:LS,range:jS,scalar:NS,tensor:RS,tensor1d:AS,tensor2d:kS,tensor3d:DS,tensor4d:MS,tensor5d:function(e,t,n){if(Y_(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=uS(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return IS(e,t,r,n)},tensor6d:function(e,t,n){if(Y_(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=uS(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return IS(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),eE.makeVariable(e,t,n,r)},zeros:OS,onesLike:FS,zerosLike:US,transpose:Dx,softmax:Ax,logSoftmax:kx,localResponseNormalization:yk,norm:bk,gather:vA,unsortedSegmentSum:yA,basicLSTMCell:_k,multiRNNCell:wk,movingAverage:Ek,stridedSlice:Sk,topk:Ck,scatterND:xk,fft:Tk,ifft:Rk,rfft:Ik,irfft:Nk,sparseToDense:kk,gatherND:Dk,diag:Mk,dropout:Lk,hannWindow:jk,hammingWindow:Fk,frame:Uk,stft:Bk,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),R_(this,void 0,void 0,(function(){var r,i,a,o,s,c,u,l,d,f,h,p,m,g;return I_(this,(function(v){switch(v.label){case 0:return r=dS(e,"predictions","inTopK"),i=dS(t,"targets","inTopK"),G_(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),G_(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),H_(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),a=r.shape[r.shape.length-1],G_(n>0&&n<=a,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+a+"), but got "+n})),[4,r.data()];case 1:return o=v.sent(),[4,i.data()];case 2:for(s=v.sent(),c=[o.length/a,a],l=c[1],d=iw("bool",u=c[0]),f=0;f<u;f++){for(h=f*l,p=o.subarray(h,h+l),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});for(m.sort((function(e,t){return t.value-e.value})),d[f]=0,g=0;g<n;g++)if(m[g].index===s[f]){d[f]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),[2,RS(d,i.shape,"bool")]}}))}))}});function bD(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&G_("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function _D(e,t,n,r,i,a){for(var o=i.strideHeight,s=i.strideWidth,c=i.dilationHeight,u=i.dilationWidth,l=i.effectiveFilterHeight,d=i.effectiveFilterWidth,f=i.padInfo.top,h=i.padInfo.left,p="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=YS(i.outShape,n),g=m.values,v=i.outShape[1]*i.outShape[2]*i.outShape[3],y=i.outShape[2]*i.outShape[3],b=i.outShape[3],_=0;_<i.batchSize;++_)for(var w=_*v,E=_*r[0],S=0;S<i.inChannels;++S)for(var C=0;C<i.outHeight;++C)for(var x=C*o-f,T=Math.max(0,x),R=Math.min(i.inHeight,l+x),I=w+C*y,N=0;N<i.outWidth;++N){for(var A=N*s-h,k=Math.max(0,A),D=Math.min(i.inWidth,d+A),M=p,L=0,O=0,P=T;P<R;P+=c){for(var j=E+P*r[1],F=k;F<D;F+=u){var U=e[j+F*r[2]+S];"max"===a&&U>M?M=U:"avg"===a&&(L+=U,O++)}if(isNaN(M))break}g[I+N*b+S]="avg"===a?L/O:M}return m}function wD(e,t,n,r,i,a){void 0===i&&(i=!1),void 0===a&&(a=!1);for(var o=YS(r.outShape,"int32"),s=r.strideHeight,c=r.strideWidth,u=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,h=r.padInfo.top,p=r.padInfo.left,m=YS(t,n,e),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.outHeight;++y){for(var b=y*s-h,_=b;_<0;)_+=u;for(var w=Math.min(r.inHeight,d+b),E=0;E<r.outWidth;++E){for(var S=E*c-p,C=S;C<0;)C+=l;for(var x=Math.min(r.inWidth,f+S),T=Number.NEGATIVE_INFINITY,R=-1,I=_;I<w;I+=u)for(var N=I-b,A=C;A<x;A+=l){var k=A-S,D=m.get(g,I,A,v);D>T&&(T=D,R=i?a?((g*r.inHeight+I)*r.inWidth+A)*r.inChannels+v:(I*r.inWidth+A)*r.inChannels+v:N*f+k)}o.set(R,g,y,E,v)}}return o}function ED(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var SD=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Mx(t,eE),t}return T_(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,A_().get("IS_NODE")&&cS("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return R_(this,void 0,void 0,(function(){return I_(this,(function(t){return[2,this.readSync(e)]}))}))},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?Jx(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return Tw(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return YS(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return eE.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return R_(this,void 0,void 0,(function(){var t;return I_(this,(function(n){return t=Sw(),e(),[2,{kernelMs:Sw()-t}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:eE.keep(e.clone()),imag:eE.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(bD(e,"slice"),Rx(e.shape,t,n)){var r=Ix(t,e.strides),i=K_(n);return RS(this.readSync(e.dataId).subarray(r,r+i),n,e.dtype)}for(var a=YS(n,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var c=a.indexToLoc(s).map((function(e,n){return e+t[n]}));a.values[s]=o.get.apply(o,c)}return a.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){bD(e,"stridedSlice");var i=Cx(t,n,r);if(i.some((function(e){return 0===e})))return RS([],i);for(var a=YS(i,e.dtype),o=this.bufferSync(e),s=0;s<a.size;s++){for(var c=a.indexToLoc(s),u=new Array(c.length),l=0;l<u.length;l++)u[l]=c[l]*r[l]+t[l];a.set.apply(a,[o.get.apply(o,u)].concat(c))}return a.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=YS([e.size,e.size],e.dtype),r=n.values,i=0;i<t.length;i++)r[i*e.size+i]=t[i];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,a=0;a<e.rank;a++)a!==t&&(r[i++]=e.shape[a]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var c=new Array(n);for(a=0;a<c.length;a++)o[t]=a,c[a]=this.slice(e,o,s).reshape(r);return c},t.prototype.reverse=function(e,t){bD(e,"reverse");for(var n=YS(e.shape,e.dtype),r=this.bufferSync(e),i=function(i){var a=n.indexToLoc(i),o=a.slice();t.forEach((function(t){return o[t]=e.shape[t]-1-o[t]})),n.set.apply(n,[r.get.apply(r,o)].concat(a))},a=0;a<n.size;a++)i(a);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map((function(e){return xS(e)})),i=e.map((function(e){return TS(e)}));return CS(this.concat(r,t),this.concat(i,t))}var a=e.map((function(e){var n=K_(e.shape.slice(t));return e.as2D(-1,n)})),o=ES(a.map((function(e){return e.shape})),1),s=YS(o,e[0].dtype).values;if(1===a[0].shape[0]){var c=0;a.forEach((function(e){s.set(n.readSync(e.dataId),c),c+=e.size}))}else{var u=0;a.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,i=0;i<e.shape[0];++i)for(var a=i*o[1]+u,c=0;c<e.shape[1];++c)s[a+c]=t[r++];u+=e.shape[1]}))}var l=ES(e.map((function(e){return e.shape})),t);return RS(s,l,e[0].dtype)},t.prototype.neg=function(e){return bD(e,"neg"),this.multiply(NS(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,Yw(e.dtype,t.dtype),(function(e,t){return e+t}))},t.prototype.addN=function(e){var t=this;bD(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=YS(e[0].shape,e[0].dtype),i=r.values,a=0;a<e.length;a++)for(var o=n[a],s=0;s<i.length;s++)i[s]+=o[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=nw([t],e.shape),r=this.max(e,n),i=gS(r.shape,n),a=this.subtract(e,r.reshape(i)),o=this.exp(a),s=this.sum(o,n).reshape(i);return gx(o,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,Yw(e.dtype,t.dtype),(function(e,t){return e-t}))},t.prototype.pow=function(e,t){return bD([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},t.prototype.batchMatMul=function(e,t,n,r){bD([e,t],"matMul");for(var i=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],c=this.readSync(e.dataId),u=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],d=l[0],f=l[1],h=l[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=p[0],g=p[1],v=p[2],y=a*o,b=YS([s,a,o],e.dtype),_=b.values,w=this.blockSize,E=0;E<s;E++)for(var S=0;S<a;S+=w)for(var C=0;C<o;C+=w)for(var x=0;x<i;x+=w)for(var T=Math.min(S+w,a),R=Math.min(C+w,o),I=Math.min(x+w,i),N=S;N<T;N++)for(var A=C;A<R;A++){for(var k=0,D=x;D<I;D++)k+=c[E*d+N*f+D*h]*u[D*m+A*g+E*v];_[E*y+(N*o+A)]+=k}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,a=e.bias,o=e.activation,s=e.preluActivationWeights,c=this.batchMatMul(t,n,r,i);return a&&(c=this.add(c,a)),o&&(c=ED(this,c,o,s)),c},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,Yw(e.dtype,t.dtype),(function(e,t){return e*t}))},t.prototype.floorDiv=function(e,t){return bD([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},t.prototype.sum=function(e,t){bD(e,"sum"),vS("sum",t,e.rank);for(var n=mS(e.shape,t),r=n[0],i=n[1],a=OS(r,Yw(e.dtype,"int32")),o=K_(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=0,f=0;f<o;++f)d+=c[l+f];s[u]=d}return a},t.prototype.prod=function(e,t){bD(e,"sum");for(var n=mS(e.shape,t),r=n[0],i=n[1],a=OS(r,Yw(e.dtype,"int32")),o=K_(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=1,f=0;f<o;++f)d*=c[l+f];s[u]=d}return a},t.prototype.unsortedSegmentSum=function(e,t,n){bD(e,"unsortedSegmentSum");for(var r=[],i=e.rank-t.rank,a=0;a<i;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var o=NS(a,"int32"),s=rA(o,t).asType("float32").mul(e).sum(0);r.push(s)}return tC(r)},t.prototype.argMin=function(e,t){bD(e,"argMin");var n=[t];vS("argMin",n,e.rank);for(var r=mS(e.shape,n),i=r[0],a=r[1],o=OS(i,"int32"),s=K_(a),c=this.readSync(o.dataId),u=this.readSync(e.dataId),l=0;l<c.length;++l){for(var d=l*s,f=u[d],h=0,p=0;p<s;++p){var m=u[d+p];m<f&&(f=m,h=p)}c[l]=h}return o},t.prototype.argMax=function(e,t){bD(e,"argMax");var n=[t];vS("argMax",n,e.rank);for(var r=mS(e.shape,n),i=r[0],a=r[1],o=OS(i,"int32"),s=K_(a),c=this.readSync(o.dataId),u=this.readSync(e.dataId),l=0;l<c.length;++l){for(var d=l*s,f=u[d],h=0,p=0;p<s;++p){var m=u[d+p];m>f&&(f=m,h=p)}c[l]=h}return o},t.prototype.cumsum=function(e,t,n,r){if(bD(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=Yw(e.dtype,"int32"),a=OS(e.shape,i),o=this.readSync(a.dataId),s=this.readSync(e.dataId),c=e.shape[e.rank-1],u=r?function(e,t){return e+c-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=c)for(var d=0;d<c;d++){var f=u(l,d);if(0===d)o[f]=n?0:s[f];else{var h=u(l,d-1);o[f]=n?s[h]+o[h]:s[f]+o[h]}}return a},t.prototype.equal=function(e,t){return bD([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},t.prototype.notEqual=function(e,t){return bD([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},t.prototype.less=function(e,t){return bD([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},t.prototype.lessEqual=function(e,t){return bD([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},t.prototype.greater=function(e,t){return bD([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},t.prototype.greaterEqual=function(e,t){return bD([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},t.prototype.logicalNot=function(e){bD(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return bD([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},t.prototype.logicalOr=function(e,t){return bD([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},t.prototype.select=function(e,t,n){bD([e,t,n],"select");for(var r=this.readSync(e.dataId),i=this.readSync(t.dataId),a=this.readSync(n.dataId),o=OS(t.shape,Yw(t.dtype,n.dtype)),s=this.readSync(o.dataId),c=0,u=0===e.rank||e.rank>1||1===t.rank?1:K_(t.shape.slice(1)),l=0;l<r.length;l++)for(var d=0;d<u;d++)1===r[l]?s[c++]=i[l]:s[c++]=a[l];return o},t.prototype.where=function(e){bD([e],"where");var t=this.readSync(e.dataId);return fT(e.shape,t)},t.prototype.topk=function(e,t,n){return bD(e,"topk"),dT(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){bD(e,"min"),vS("min",t,e.rank);for(var n=mS(e.shape,t),r=n[0],i=n[1],a=OS(r,e.dtype),o=K_(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=c[l],f=0;f<o;++f){var h=c[l+f];h<d&&(d=h)}s[u]=d}return a},t.prototype.minimum=function(e,t){return bD([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},t.prototype.mod=function(e,t){return bD([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},t.prototype.max=function(e,t){bD(e,"max"),vS("max",t,e.rank);for(var n=mS(e.shape,t),r=n[0],i=n[1],a=OS(r,e.dtype),o=K_(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=c[l],f=0;f<o;++f){var h=c[l+f];h>d&&(d=h)}s[u]=d}return a},t.prototype.maximum=function(e,t){return bD([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},t.prototype.all=function(e,t){bD(e,"all"),vS("all",t,e.rank);for(var n=mS(e.shape,t),r=n[0],i=n[1],a=OS(r,e.dtype),o=K_(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=c[l],f=0;f<o;++f){var h=c[l+f];d=d&&h}s[u]=d}return a},t.prototype.any=function(e,t){bD(e,"any"),vS("any",t,e.rank);for(var n=mS(e.shape,t),r=n[0],i=n[1],a=OS(r,e.dtype),o=K_(i),s=this.readSync(a.dataId),c=this.readSync(e.dataId),u=0;u<s.length;++u){for(var l=u*o,d=c[l],f=0;f<o;++f){var h=c[l+f];d=d||h}s[u]=d}return a},t.prototype.squaredDifference=function(e,t){return bD([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},t.prototype.ceil=function(e){bD(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){bD(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){bD(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){bD(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){bD(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){bD(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){bD(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=Math.floor(t[r]);t[r]-i<.5?n[r]=Math.floor(t[r]):t[r]-i>.5?n[r]=Math.ceil(t[r]):n[r]=i%2==0?i:i+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){bD(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){bD(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){bD(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){bD(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log1p(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){bD(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.sqrt(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){bD(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=1/Math.sqrt(i)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){bD(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){bD(e,"relu");for(var t=OS(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return t},t.prototype.relu6=function(e){bD(e,"relu");for(var t=OS(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.min(Math.max(0,r[i]),6);return t},t.prototype.prelu=function(e,t){return bD([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},t.prototype.elu=function(e){bD(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?i:Math.exp(i)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){bD([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),i=this.readSync(e.dataId),a=0;a<r.length;++a){var o=r[a];n[a]=o>=1?i[a]:i[a]*(o+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){bD(e,"selu");for(var t=CI,n=xI,r=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var o=i[a];r[a]=o>=0?n*o:t*(Math.exp(o)-1)}return this.makeOutput(r,e.shape,"float32")},t.prototype.clip=function(e,t,n){bD(e,"clip");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var o=i[a];r[a]=o>n?n:o<t?t:o}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var i=n[2*r],a=n[2*r+1];t[r]=Math.hypot(i,a)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){bD(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){bD(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){bD(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a,o=r[i]>-t,s=r[i]<t,c=Math.exp(r[i]);a=s?c:o?r[i]:Math.log(1+c),n[i]=a}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){bD(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){bD(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){bD(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){bD(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){bD(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){bD(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return bD([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},t.prototype.sinh=function(e){bD(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){bD(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){bD(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=J_(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){bD(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){bD(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){bD(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){bD(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=Math.sign(n[r]),a=Math.abs(n[r]),o=1/(1+.3275911*a);t[r]=i*(1-((((1.061405429*o-1.453152027)*o+1.421413741)*o-.284496736)*o+.254829592)*o*Math.exp(-a*a))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),bD(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var a=r[i];isNaN(a)?n[i]=NaN:n[i]=a>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights,s=this.conv2d(t,n,r);return i&&(s=this.add(s,i)),a&&(s=ED(this,s,a,o)),s},t.prototype.conv2d=function(e,t,n){bD([e,t],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,c=n.padInfo.top,u="channelsLast"===n.dataFormat,l=YS(n.outShape,e.dtype),d=e.strides[0],f=u?e.strides[1]:e.strides[2],h=u?e.strides[2]:1,p=u?1:e.strides[1],m=l.strides[0],g=u?l.strides[1]:l.strides[2],v=u?l.strides[2]:1,y=u?1:l.strides[1],b=this.readSync(e.dataId),_=this.readSync(t.dataId),w=l.values,E=0;E<n.batchSize;++E)for(var S=E*d,C=E*m,x=0;x<n.outHeight;++x)for(var T=C+x*g,R=x*n.strideHeight-c,I=0;I<r;I++){var N=R+I*a;if(!(N<0||N>=n.inHeight))for(var A=I*t.strides[0],k=S+N*f,D=0;D<n.outWidth;++D)for(var M=T+D*v,L=D*n.strideWidth-s,O=0;O<i;O++){var P=L+O*o;if(!(P<0||P>=n.inWidth))for(var j=k+P*h,F=A+O*t.strides[1],U=0;U<n.inChannels;++U){for(var B=b[j+U*p],V=0;V<n.outChannels;++V)w[M+V*y]+=B*_[F+V];F+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,i=n.filterHeight,a=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,c=n.dilationWidth,u=n.padInfo.front,l=n.padInfo.left,d=n.padInfo.top,f=YS(n.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(t.dataId),m=f.values,g=0;g<n.batchSize;++g)for(var v=g*e.strides[0],y=g*f.strides[0],b=0;b<n.outDepth;++b)for(var _=y+b*f.strides[1],w=b*n.strideDepth-u,E=0;E<r;E++){var S=w+E*o;if(!(S<0||S>=n.inDepth))for(var C=E*t.strides[0],x=v+S*e.strides[1],T=0;T<n.outHeight;++T)for(var R=_+T*f.strides[2],I=T*n.strideHeight-d,N=0;N<i;N++){var A=I+N*s;if(!(A<0||A>=n.inHeight))for(var k=C+N*t.strides[1],D=x+A*e.strides[2],M=0;M<n.outWidth;++M)for(var L=R+M*n.outChannels,O=M*n.strideWidth-l,P=0;P<a;P++){var j=O+P*c;if(!(j<0||j>=n.inWidth))for(var F=k+P*t.strides[2],U=D+j*n.inChannels,B=F,V=0;V<n.inChannels;++V){for(var z=h[U+V],W=0;W<n.outChannels;++W)m[L+W]+=z*p[B+W];B+=n.outChannels}}}}return f.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){bD([e,t],"conv2dDerInput");for(var r=YS(n.inShape,"float32"),i=r.values,a=this.readSync(e.dataId),o=this.readSync(t.dataId),s=t.strides,c=s[0],u=s[1],l=s[2],d=n.batchSize,f=n.filterHeight,h=n.filterWidth,p=n.inChannels,m=n.inHeight,g=n.inWidth,v=n.outChannels,y=n.outHeight,b=n.outWidth,_=n.strideHeight,w=n.strideWidth,E=n.dataFormat,S=f-1-n.padInfo.top,C=h-1-n.padInfo.left,x="channelsLast"===E,T=r.strides[0],R=x?r.strides[1]:r.strides[2],I=x?r.strides[2]:1,N=x?1:r.strides[1],A=e.strides[0],k=x?e.strides[1]:e.strides[2],D=x?e.strides[2]:1,M=x?1:e.strides[1],L=0;L<d;++L)for(var O=0;O<p;++O)for(var P=0;P<m;++P)for(var j=P-S,F=Math.max(0,Math.ceil(j/_)),U=Math.min(y,(f+j)/_),B=0;B<g;++B){for(var V=B-C,z=Math.max(0,Math.ceil(V/w)),W=Math.min(b,(h+V)/w),G=0,H=F;H<U;++H)for(var Y=H*_-j,q=z;q<W;++q)for(var K=A*L+k*H+D*q,X=c*(f-1-Y)+u*(h-1-(q*w-V))+l*O,Q=0;Q<v;++Q)G+=a[K+M*Q]*o[X+Q];i[T*L+R*P+I*B+N*O]=G}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=YS(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],c=a[2],u=a[3],l=this.readSync(e.dataId),d=e.strides,f=d[0],h=d[1],p=d[2],m=d[3],g=this.readSync(t.dataId),v=t.strides,y=v[0],b=v[1],_=v[2],w=v[3],E=n.batchSize,S=n.filterDepth,C=n.filterHeight,x=n.filterWidth,T=n.inChannels,R=n.inDepth,I=n.inHeight,N=n.inWidth,A=n.outChannels,k=n.outDepth,D=n.outHeight,M=n.outWidth,L=n.strideDepth,O=n.strideHeight,P=n.strideWidth,j=S-1-n.padInfo.front,F=C-1-n.padInfo.top,U=x-1-n.padInfo.left,B=0;B<E;++B)for(var V=0;V<T;++V)for(var z=0;z<R;++z)for(var W=z-j,G=Math.max(0,Math.ceil(W/L)),H=Math.min(k,(S+W)/L),Y=0;Y<I;++Y)for(var q=Y-F,K=Math.max(0,Math.ceil(q/O)),X=Math.min(D,(C+q)/O),Q=0;Q<N;++Q){for(var J=Q-U,Z=Math.max(0,Math.ceil(J/P)),$=Math.min(M,(x+J)/P),ee=0,te=G;te<H;++te)for(var ne=te*L-W,re=K;re<X;++re)for(var ie=re*O-q,ae=Z;ae<$;++ae)for(var oe=f*B+h*te+p*re+m*ae,se=y*(S-1-ne)+b*(C-1-ie)+_*(x-1-(ae*P-J))+w*V,ce=0;ce<A;++ce)ee+=l[oe+ce]*g[se+ce];i[o*B+s*z+c*Y+u*Q+V]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){bD([e,t],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s="channelsLast"===n.dataFormat,c=YS(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,d=this.bufferSync(e),f=this.bufferSync(t),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((l-h)/r)),m=Math.min(n.outHeight,(n.inHeight+l-h)/r),g=0;g<o;++g)for(var v=Math.max(0,Math.ceil((u-g)/i)),y=Math.min(n.outWidth,(n.inWidth+u-g)/i),b=0;b<n.inChannels;++b)for(var _=0;_<n.outChannels;++_){for(var w=0,E=0;E<n.batchSize;++E)for(var S=p;S<m;++S)for(var C=h+S*r-l,x=v;x<y;++x){var T=g+x*i-u;w+=s?d.get(E,C,T,b)*f.get(E,S,x,_):d.get(E,b,C,T)*f.get(E,_,S,x)}c.set(w,h,g,b,_)}return c.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,c=n.filterWidth,u=YS(n.filterShape,"float32"),l=u.values,d=u.strides,f=d[0],h=d[1],p=d[2],m=d[3],g=this.readSync(t.dataId),v=t.strides,y=v[0],b=v[1],_=v[2],w=v[3],E=this.readSync(e.dataId),S=e.strides,C=S[0],x=S[1],T=S[2],R=S[3],I=n.padInfo.front,N=n.padInfo.left,A=n.padInfo.top,k=0;k<o;++k)for(var D=Math.max(0,Math.ceil((I-k)/r)),M=Math.min(n.outDepth,(n.inDepth+I-k)/r),L=k*f,O=0;O<s;++O)for(var P=Math.max(0,Math.ceil((A-O)/i)),j=Math.min(n.outHeight,(n.inHeight+A-O)/i),F=O*h+L,U=0;U<c;++U)for(var B=Math.max(0,Math.ceil((N-U)/a)),V=Math.min(n.outWidth,(n.inWidth+N-U)/a),z=U*p+F,W=0;W<n.inChannels;++W)for(var G=W*m+z,H=0;H<n.outChannels;++H){for(var Y=0,q=0;q<n.batchSize;++q)for(var K=q*C,X=q*y,Q=D;Q<M;++Q)for(var J=(k+Q*r-I)*x+K,Z=Q*b+X,$=P;$<j;++$)for(var ee=(O+$*i-A)*T+J,te=$*_+Z,ne=B;ne<V;++ne){var re=ne*w+te;Y+=E[(U+ne*a-N)*R+ee+W]*g[re+H]}l[G+H]=Y}return u.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,a=e.activation,o=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return i&&(s=this.add(s,i)),a&&(s=ED(this,s,a,o)),s},t.prototype.depthwiseConv2D=function(e,t,n){bD([e,t],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,a=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,c=n.padInfo.top,u=n.outChannels/n.inChannels,l=YS(n.outShape,e.dtype),d=this.readSync(e.dataId),f=this.readSync(t.dataId),h=l.values,p=0;p<n.batchSize;++p)for(var m=p*e.strides[0],g=p*l.strides[0],v=0;v<n.outHeight;++v)for(var y=g+v*l.strides[1],b=v*n.strideHeight-s,_=0;_<r;++_){var w=b+_*a;if(!(w<0||w>=n.inHeight))for(var E=_*t.strides[0],S=m+w*e.strides[1],C=0;C<n.outWidth;++C)for(var x=y+C*l.strides[2],T=C*n.strideWidth-c,R=0;R<i;++R){var I=T+R*o;if(!(I<0||I>=n.inWidth))for(var N=E+R*t.strides[1],A=S+I*n.inChannels,k=x,D=N,M=0;M<n.inChannels;++M){for(var L=d[A+M],O=0;O<u;++O)h[k+O]+=L*f[D+O];k+=u,D+=u}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){bD([e,t],"depthwiseConv2DDerInput");for(var r=YS(n.inShape,"float32"),i=r.values,a=r.strides,o=a[0],s=a[1],c=a[2],u=this.readSync(e.dataId),l=e.strides,d=l[0],f=l[1],h=l[2],p=this.readSync(t.dataId),m=t.strides,g=m[0],v=m[1],y=m[2],b=n.batchSize,_=n.filterHeight,w=n.filterWidth,E=n.inChannels,S=n.inHeight,C=n.inWidth,x=n.outChannels,T=n.outHeight,R=n.outWidth,I=n.strideHeight,N=n.strideWidth,A=_-1-n.padInfo.top,k=w-1-n.padInfo.left,D=x/E,M=0;M<b;++M)for(var L=0;L<E;++L)for(var O=0;O<S;++O)for(var P=O-A,j=Math.max(0,Math.ceil(P/I)),F=Math.min(T,(_+P)/I),U=0;U<C;++U){for(var B=U-k,V=Math.max(0,Math.ceil(B/N)),z=Math.min(R,(w+B)/N),W=0,G=j;G<F;++G)for(var H=G*I-P,Y=V;Y<z;++Y)for(var q=d*M+f*G+h*Y,K=g*(_-1-H)+v*(w-1-(Y*N-B))+y*L,X=0;X<D;++X)W+=u[q+(L*D+X)]*p[K+X];i[o*M+s*O+c*U+L]=W}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){bD([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=YS(n.filterShape,"float32"),c=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,d=this.bufferSync(e),f=this.bufferSync(t),h=0;h<a;++h)for(var p=Math.max(0,Math.ceil((u-h)/r)),m=Math.min(n.outHeight,(n.inHeight+u-h)/r),g=0;g<o;++g)for(var v=Math.max(0,Math.ceil((c-g)/i)),y=Math.min(n.outWidth,(n.inWidth+c-g)/i),b=0;b<n.outChannels;++b){for(var _=Math.trunc(b/l),w=b%l,E=0,S=0;S<n.batchSize;++S)for(var C=p;C<m;++C)for(var x=h+C*r-u,T=v;T<y;++T){var R=g+T*i-c;E+=d.get(S,x,R,_)*f.get(S,C,T,b)}s.set(E,h,g,_,w)}return s.toTensor()},t.prototype.tile=function(e,t){return bD(e,"tile"),lT(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){bD(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),i=t.map((function(e){return e[0]})),a=this.bufferSync(e),o=YS(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var c=a.indexToLoc(s),u=c.map((function(e,t){return e+i[t]}));o.set.apply(o,[a.get.apply(a,c)].concat(u))}return o.toTensor()},t.prototype.gather=function(e,t,n){bD([e,t],"gather");var r=e.shape.slice(),i=this.readSync(t.dataId);r[n]=i.length;for(var a=YS(r,e.dtype),o=this.bufferSync(e),s=0;s<a.size;++s){var c=a.indexToLoc(s),u=c.slice();u[n]=i[c[n]];var l=o.locToIndex(u);a.values[s]=o.values[l]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){bD([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),i=rC(e.shape,t,r),a=iC(i.length,t.length),o=aC(e.shape,t,r),s=oC(n,t.length),c=sC(o,n,t.length);return Dx(e.reshape(i),a).reshape(o).slice(s,c)},t.prototype.spaceToBatchND=function(e,t,n){bD([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var a=1+t.length;a<e.shape.length;++a)i.push([0,0]);var o=e.pad(i),s=rC(o.shape,t,r,!1),c=iC(s.length,t.length,!1),u=aC(o.shape,t,r,!1);return Dx(o.reshape(s),c).reshape(u)},t.prototype.maxPool=function(e,t){return bD(e,"maxPool"),_D(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"max").toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){bD([t,n],"maxPoolBackprop");for(var i=this.readSync(t.dataId),a=YS(r.outShape,t.dtype,wD(i,t.shape,t.dtype,r).values),o=r.strideHeight,s=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=d-1-r.padInfo.left,h=l-1-r.padInfo.top,p=YS(t.shape,"float32"),m=this.bufferSync(e),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var _=y-h,w=b-f,E=0,S=0;S<l;S+=c){var C=(_+S)/o;if(!(C<0||C>=r.outHeight||Math.floor(C)!==C))for(var x=0;x<d;x+=u){var T=(w+x)/s;if(!(T<0||T>=r.outWidth||Math.floor(T)!==T)){var R=l*d-1-a.get(g,C,T,v)===S*d+x?1:0;0!==R&&(E+=m.get(g,C,T,v)*R)}}}p.set(E,g,y,b,v)}return p.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){bD([e,t],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,a=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,c=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,d=l-1-n.padInfo.left,f=u-1-n.padInfo.top,h=YS(t.shape,"float32"),p=1/(a*o),m=this.bufferSync(e),g=0;g<n.batchSize;++g)for(var v=0;v<n.inChannels;++v)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var _=y-f,w=b-d,E=0,S=0;S<u;S+=s){var C=(_+S)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var x=0;x<l;x+=c){var T=(w+x)/i;T<0||T>=n.outWidth||Math.floor(T)!==T||(E+=m.get(g,C,T,v))}}h.set(E*p,g,y,b,v)}return h.toTensor()},t.prototype.pool3d=function(e,t,n){bD(e,"pool3d");for(var r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(e.dataId),v=YS(t.outShape,e.dtype),y=v.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],_=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],E=t.outShape[4],S=0;S<t.batchSize;++S)for(var C=S*b,x=S*e.strides[0],T=0;T<t.inChannels;++T)for(var R=0;R<t.outDepth;++R){for(var I=R*r-f,N=I;N<0;)N+=o;for(var A=Math.min(t.inDepth,u+I),k=C+R*_,D=0;D<t.outHeight;++D){for(var M=D*i-h,L=M;L<0;)L+=s;for(var O=Math.min(t.inHeight,l+M),P=k+D*w,j=0;j<t.outWidth;++j){for(var F=j*a-p,U=F;U<0;)U+=c;for(var B=Math.min(t.inWidth,d+F),V=P+j*E,z=m,W=0,G=0,H=N;H<A;H+=o){for(var Y=x+H*e.strides[1],q=L;q<O;q+=s){for(var K=Y+q*e.strides[2],X=U;X<B;X+=c){var Q=g[K+X*e.strides[3]+T];if("max"===n&&Q>z?z=Q:"avg"===n&&(W+=Q,G++),isNaN(z))break}if(isNaN(z))break}if(isNaN(z))break}y[V+T]="avg"===n?W/G:z}}}return v.toTensor()},t.prototype.avgPool3d=function(e,t){return bD(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){bD([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,i=n.strideHeight,a=n.strideWidth,o=n.filterDepth,s=n.filterHeight,c=n.filterWidth,u=n.dilationDepth,l=n.dilationHeight,d=n.dilationWidth,f=n.effectiveFilterDepth,h=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=f-1-n.padInfo.front,g=p-1-n.padInfo.left,v=h-1-n.padInfo.top,y=YS(t.shape,"float32"),b=1/(o*s*c),_=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var E=0;E<n.inChannels;++E)for(var S=0;S<n.inDepth;++S)for(var C=0;C<n.inHeight;++C)for(var x=0;x<n.inWidth;++x){for(var T=S-m,R=C-v,I=x-g,N=0,A=0;A<f;A+=u){var k=(T+A)/r;if(!(k<0||k>=n.outDepth||Math.floor(k)!==k))for(var D=0;D<h;D+=l){var M=(R+D)/i;if(!(M<0||M>=n.outHeight||Math.floor(M)!==M))for(var L=0;L<p;L+=d){var O=(I+L)/a;O<0||O>=n.outWidth||Math.floor(O)!==O||(N+=_.get(w,k,M,O,E))}}}y.set(N*b,w,S,C,x,E)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return bD(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=YS(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,c=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=t.padInfo.front,h=t.padInfo.top,p=t.padInfo.left,m=this.bufferSync(e),g=0;g<t.batchSize;++g)for(var v=0;v<t.inChannels;++v)for(var y=0;y<t.outDepth;++y){for(var b=y*r-f,_=b;_<0;)_+=o;for(var w=Math.min(t.inDepth,u+b),E=0;E<t.outHeight;++E){for(var S=E*i-h,C=S;C<0;)C+=s;for(var x=Math.min(t.inHeight,l+S),T=0;T<t.outWidth;++T){for(var R=T*a-p,I=R;I<0;)I+=c;for(var N=Math.min(t.inWidth,d+R),A=Number.NEGATIVE_INFINITY,k=-1,D=_;D<w;D+=o)for(var M=D-b,L=C;L<x;L+=s)for(var O=L-S,P=I;P<N;P+=c){var j=P-R,F=m.get(g,D,L,P,v);F>=A&&(A=F,k=M*l*d+O*l+j)}n.set(k,g,y,E,T,v)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){bD([t,n],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(t,r),a=r.strideDepth,o=r.strideHeight,s=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=d-1-r.padInfo.front,m=h-1-r.padInfo.left,g=f-1-r.padInfo.top,v=YS(t.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(e),_=0;_<r.batchSize;++_)for(var w=0;w<r.inChannels;++w)for(var E=0;E<r.inDepth;++E)for(var S=0;S<r.inHeight;++S)for(var C=0;C<r.inWidth;++C){for(var x=E-p,T=S-g,R=C-m,I=0,N=0;N<d;N+=c){var A=(x+N)/a;if(!(A<0||A>=r.outDepth||Math.floor(A)!==A))for(var k=0;k<f;k+=u){var D=(T+k)/o;if(!(D<0||D>=r.outHeight||Math.floor(D)!==D))for(var M=0;M<h;M+=l){var L=(R+M)/s;if(!(L<0||L>=r.outWidth||Math.floor(L)!==L)){var O=d*f*h-1-y.get(_,A,D,L,w)===N*f*h+k*h+M?1:0;0!==O&&(I+=b.get(_,A,D,L,w)*O)}}}}v.set(I,_,E,S,C,w)}return v.toTensor()},t.prototype.cast=function(e,t){return Kx(e,t,this)},t.prototype.reshape=function(e,t){return Xx(e,t)},t.prototype.avgPool=function(e,t){return bD(e,"avgPool"),bD(e,"maxPool"),_D(this.readSync(e.dataId),e.shape,e.dtype,e.strides,t,"avg").toTensor().toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){bD(e,"resizeBilinear");for(var i=e.shape,a=i[0],o=i[1],s=i[2],c=i[3],u=this.readSync(e.dataId),l=new Float32Array(K_([a,t,n,c])),d=[r&&t>1?o-1:o,r&&n>1?s-1:s],f=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=0,p=d[0]/f[0],m=d[1]/f[1],g=0;g<a;g++)for(var v=0;v<t;v++)for(var y=p*v,b=Math.floor(y),_=y-b,w=Math.min(o-1,Math.ceil(y)),E=g*e.strides[0]+b*e.strides[1],S=g*e.strides[0]+w*e.strides[1],C=0;C<n;C++)for(var x=m*C,T=Math.floor(x),R=x-T,I=Math.min(s-1,Math.ceil(x)),N=E+T*e.strides[2],A=S+T*e.strides[2],k=E+I*e.strides[2],D=S+I*e.strides[2],M=0;M<c;M++){var L=u[N+M],O=u[A+M],P=L+(u[k+M]-L)*R,j=P+(O+(u[D+M]-O)*R-P)*_;l[h++]=j}return RS(l,[a,t,n,c])},t.prototype.resizeBilinearBackprop=function(e,t,n){bD([e,t],"resizeBilinearBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],c=e.shape,u=c[1],l=c[2],d=new Float32Array(i*a*o*s),f=[n&&u>1?a-1:a,n&&l>1?o-1:o],h=[n&&u>1?u-1:u,n&&l>1?l-1:l],p=f[0]/h[0],m=f[1]/h[1],g=this.readSync(e.dataId),v=0,y=0;y<i;y++)for(var b=y*t.strides[0],_=0;_<u;_++)for(var w=_*p,E=Math.floor(w),S=Math.min(Math.ceil(w),a-1),C=b+E*t.strides[1],x=b+S*t.strides[1],T=w-E,R=1-T,I=0;I<l;I++)for(var N=I*m,A=Math.floor(N),k=Math.min(Math.ceil(N),o-1),D=N-A,M=1-D,L=C+A*t.strides[2],O=C+k*t.strides[2],P=x+A*t.strides[2],j=x+k*t.strides[2],F=R*M,U=R*D,B=T*M,V=T*D,z=0;z<s;z++){var W=g[v++];d[L+z]+=W*F,d[O+z]+=W*U,d[P+z]+=W*B,d[j+z]+=W*V}return MS(d,[i,o,a,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){bD(e,"resizeNearestNeighbor");for(var i=e.shape,a=i[0],o=i[1],s=i[2],c=i[3],u=this.readSync(e.dataId),l=new Float32Array(a*t*n*c),d=[r&&t>1?o-1:o,r&&n>1?s-1:s],f=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=d[0]/f[0],p=d[1]/f[1],m=0,g=0;g<a;g++)for(var v=g*e.strides[0],y=0;y<t;y++)for(var b=h*y,_=v+Math.min(o-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var E=p*w,S=_+Math.min(s-1,r?Math.round(E):Math.floor(E))*e.strides[2],C=0;C<c;C++){var x=u[S+C];l[m++]=x}return RS(l,[a,t,n,c],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){bD([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,i=r[0],a=r[1],o=r[2],s=r[3],c=e.shape,u=c[1],l=c[2],d=new Float32Array(i*a*o*s),f=this.readSync(e.dataId),h=[n&&u>1?a-1:a,n&&l>1?o-1:o],p=[n&&u>1?u-1:u,n&&l>1?l-1:l],m=h[0]/p[0],g=h[1]/p[1],v=1/m,y=1/g,b=2*Math.ceil(v)+2,_=2*Math.ceil(y)+2,w=0;w<i;w++)for(var E=w*t.strides[0],S=0;S<a;S++)for(var C=E+S*t.strides[1],x=Math.floor(S*v),T=Math.floor(x-b/2),R=0;R<o;R++)for(var I=C+R*t.strides[2],N=Math.floor(R*y),A=Math.floor(N-_/2),k=0;k<s;k++){for(var D=0,M=0;M<b;M++){var L=M+T;if(!(L<0||L>=u)){var O=E+L*e.strides[1],P=L*m;if(S===Math.min(a-1,n?Math.round(P):Math.floor(P)))for(var j=0;j<_;j++){var F=j+A;if(!(F<0||F>=l)){var U=O+F*e.strides[2],B=F*g;R===Math.min(o-1,n?Math.round(B):Math.floor(B))&&(D+=f[U+k])}}}}d[I+k]=D}return MS(d,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,a){bD([e,t,n,i,a],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=this.readSync(n.dataId),u=i?this.readSync(i.dataId):new Float32Array([1]),l=a?this.readSync(a.dataId):new Float32Array([0]),d=new Float32Array(o.length),f=l.length,h=u.length,p=c.length,m=s.length,g=0,v=0,y=0,b=0,_=0;_<o.length;++_)d[_]=l[g++]+(o[_]-s[v++])*u[y++]/Math.sqrt(c[b++]+r),g>=f&&(g=0),v>=m&&(v=0),y>=h&&(y=0),b>=p&&(b=0);return MS(d,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){bD(e,"localResponseNormalization4D");var a=e.shape[3],o=a-1,s=this.readSync(e.dataId),c=e.size,u=new Float32Array(c);function l(e){for(var n=e%a,r=e-n+Math.max(0,n-t),i=e-n+Math.min(n+t,o),c=0;r<=i;r++){var u=s[r];c+=u*u}return c}for(var d=0;d<c;d++){var f=l(d),h=s[d]*Math.pow(n+r*f,-i);u[d]=h}return MS(u,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,i,a,o){bD(e,"LRNGrad");for(var s=e.shape[3],c=this.readSync(e.dataId),u=this.readSync(t.dataId),l=this.readSync(n.dataId),d=new Float32Array(e.size),f=e.size,h=0;h<f;h++){for(var p=h%s,m=h-p+Math.max(0,p-r),g=h-p+Math.min(s,p+r+1),v=0,y=m;y<g;y++)v+=Math.pow(u[y],2);for(v=a*v+i,y=m;y<g;y++){var b=-2*a*o*u[y]*l[h]/v;h===y&&(b+=Math.pow(v,-o)),b*=c[h],d[y]+=b}}return MS(d,e.shape)},t.prototype.multinomial=function(e,t,n,r){bD(e,"multinomial");for(var i=t?e:Ax(e),a=i.shape[0],o=i.shape[1],s=OS([a,n],"int32"),c=this.readSync(s.dataId),u=this.readSync(i.dataId),l=0;l<a;++l){var d=l*o,f=new Float32Array(o-1);f[0]=u[d];for(var h=1;h<f.length;++h)f[h]=f[h-1]+u[d+h];for(var p=uN(r.toString()),m=l*n,g=0;g<n;++g){var v=p();c[m+g]=f.length;for(var y=0;y<f.length;y++)if(v<f[y]){c[m+g]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){bD(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(r);for(var a=this.readSync(e.dataId),o=0;o<e.size;++o)a[o]>=0&&a[o]<t&&(i[o*t+a[o]]=n);return kS(i,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return bD(e,"nonMaxSuppression"),rT(this.readSync(e.dataId),this.readSync(t.dataId),n,r,i)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],i=YS(e.shape,"float32"),a=YS(e.shape,"float32"),o=xS(e).as2D(n,r),s=TS(e).as2D(n,r),c=0;c<n;c++)for(var u=o.slice([c,0],[1,r]),l=s.slice([c,0],[1,r]),d=CS(u,l),f=this.readSync(this.fftImpl(d,t).dataId),h=0;h<r;h++){var p=Zx(f,h);i.values[c*r+h]=p.real,a.values[c*r+h]=p.imag}return CS(i.toTensor(),a.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(i=CS(xS(i).div(NS(r)),TS(i).div(NS(r)))),i}var a=this.readSync(e.dataId),o=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(a,r,t));return CS(o.real,o.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),i=t/2,a=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),o=CS(a.real,a.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),c=CS(s.real,s.imag).as1D();o=this.fftRadix2(o,i,n),c=this.fftRadix2(c,i,n);var u=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),i=0;i<Math.ceil(e/2);i++){var a=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(a),r[i]=Math.sin(a)}return{real:n,imag:r}}(t,n),l=CS(u.real,u.imag).mul(c),d=o.add(l),f=o.sub(l),h=xS(d).concat(xS(f)),p=TS(d).concat(TS(f));return CS(h,p).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),i=0;i<t;i++){for(var a=0,o=0,s=0;s<t;s++){var c=eT(i*s,t,n),u=Zx(e,s);a+=u.real*c.real-u.imag*c.imag,o+=u.real*c.imag+u.imag*c.real}n&&(a/=t,o/=t),$x(r,a,o,i)}return r},t.prototype.depthToSpace=function(e,t,n){G_("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),G_(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],i=e.shape[1],a=e.shape[2],o=e.shape[3],s=i*t,c=a*t,u=o/(t*t),l=this.readSync(e.dataId),d=new Float32Array(r*s*c*u),f=0,h=0;h<r;++h)for(var p=0;p<s;++p)for(var m=Math.floor(p/t),g=p%t,v=0;v<c;++v)for(var y=Math.floor(v/t),b=(g*t+v%t)*u,_=0;_<u;++_){var w=_+b+o*(y+a*(m+i*h));d[f++]=l[w]}return MS(d,[r,s,c,u])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var i=yC(e.shape,t.shape),a=YS(i,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=gC(e.shape,i),u=gC(t.shape,i),l=a.values;if(c.length+u.length===0)for(var d=0;d<l.length;++d)l[d]=r(o[d%o.length],s[d%s.length]);else{var f=this.bufferSync(e),h=this.bufferSync(t),p=function(n){var i=a.indexToLoc(n),d=i.slice(-e.rank);c.forEach((function(e){return d[e]=0}));var p=f.locToIndex(d),m=i.slice(-t.rank);u.forEach((function(e){return m[e]=0}));var g=h.locToIndex(m);l[n]=r(o[p],s[g])};for(d=0;d<l.length;++d)p(d)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=yC(e.shape,t.shape),i=YS(r,"float32"),a=YS(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),c=gC(e.shape,r),u=gC(t.shape,r),l=i.values,d=a.values;if(c.length+u.length===0)for(var f=0;f<l.length;f++){var h=f%o.length,p=f%s.length,m=n(o[2*h],o[2*h+1],s[2*p],s[2*p+1]);l[f]=m.real,d[f]=m.imag}else{var g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var a=i.indexToLoc(r),f=a.slice(-e.rank);c.forEach((function(e){return f[e]=0}));var h=g.locToIndex(f),p=a.slice(-t.rank);u.forEach((function(e){return p[e]=0}));var m=v.locToIndex(p),y=n(o[2*h],o[2*h+1],s[2*m],s[2*m+1]);l[r]=y.real,d[r]=y.imag};for(f=0;f<l.length;f++)y(f)}return this.complex(i.toTensor(),a.toTensor())},t.prototype.split=function(e,t,n){return uT(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,i,a){for(var o=e.shape,s=o[0],c=o[1],u=o[2],l=o[3],d=t.shape[0],f=r[0],h=r[1],p=YS([d,f,h,l],"float32"),m=this.readSync(t.dataId),g=this.readSync(n.dataId),v=this.readSync(e.dataId),y=e.strides,b=p.strides,_=0;_<d;_++){var w=4*_,E=m[w],S=m[w+1],C=m[w+2],x=m[w+3],T=g[_];if(!(T>=s))for(var R=f>1?(C-E)*(c-1)/(f-1):0,I=h>1?(x-S)*(u-1)/(h-1):0,N=0;N<f;N++){var A=f>1?E*(c-1)+N*R:.5*(E+C)*(c-1);if(A<0||A>c-1)for(var k=0;k<h;k++)for(var D=0;D<l;D++){var M=D+k*b[2]+N*b[1]+_*b[0];p.values[M]=a}else if("bilinear"===i){var L=Math.floor(A),O=Math.ceil(A),P=A-L;for(k=0;k<h;k++)if((H=h>1?S*(u-1)+k*I:.5*(S+x)*(u-1))<0||H>u-1)for(D=0;D<l;D++)M=D+k*b[2]+N*b[1]+_*b[0],p.values[M]=a;else{var j=Math.floor(H),F=Math.ceil(H),U=H-j;for(D=0;D<l;D++){var B=v[M=D+j*y[2]+L*y[1]+T*y[0]],V=v[M=D+F*y[2]+L*y[1]+T*y[0]],z=v[M=D+j*y[2]+O*y[1]+T*y[0]],W=B+(V-B)*U,G=z+(v[M=D+F*y[2]+O*y[1]+T*y[0]]-z)*U;M=D+k*b[2]+N*b[1]+_*b[0],p.values[M]=W+(G-W)*P}}}else for(k=0;k<h;++k){var H;if((H=h>1?S*(u-1)+k*I:.5*(S+x)*(u-1))<0||H>u-1)for(D=0;D<l;D++)M=D+k*b[2]+N*b[1]+_*b[0],p.values[M]=a;else{var Y=Math.round(H),q=Math.round(A);for(D=0;D<l;D++){var K=D+Y*y[2]+q*y[1]+T*y[0],X=D+k*b[2]+N*b[1]+_*b[0];p.values[X]=v[K]}}}}}return p.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var i=wx(0,e,n),a=i.sliceRank,o=i.numUpdates,s=i.sliceSize,c=i.strides,u=i.outputSize;return this.scatter(e,t,n,u,s,o,a,c,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=vx(e,t),a=i[0],o=i[1],s=i[2],c=i[3];if(0===o)return RS([],a,e.dtype);for(var u=new Lw([o,s],e.dtype),l=this.readSync(t.dataId),d=this.readSync(e.dataId),f=0;f<o;f++){for(var h=[],p=0,m=0;m<r;m++){var g=l[f*r+m];p+=g*c[m],h.push(g)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+h+" does not index into "+e.shape);for(var v=0;v<s;v++)u.values[f*s+v]=d[p*s+v]}return u.toTensor().reshape(a)},t.prototype.scatterND=function(e,t,n){var r=wx(0,e,n),i=r.sliceRank,a=r.numUpdates,o=r.sliceSize,s=r.strides,c=r.outputSize,u=NS(0);return this.scatter(e,t,n,c,o,a,i,s,u,!0)},t.prototype.fill=function(e,t,n){var r=aw(n=n||mw(t),K_(e));return r.fill(t),eE.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=aw(e.dtype,K_(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return Qx(e,t,n)},t.prototype.scatter=function(e,t,n,r,i,a,o,s,c,u){var l=[r/i,i],d=this.readSync(e.dataId),f=this.readSync(t.dataId);if(0===r)return RS([],n,t.dtype);var h=new Lw(l,t.dtype);h.values.fill(this.readSync(c.dataId)[0]);for(var p=0;p<a;p++){for(var m=[],g=0,v=0;v<o;v++){var y=d[p*o+v];m.push(y),g+=y*s[v]}if(g<0||g>=r/i)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<i;b++)u?h.values[g*i+b]+=f[p*i+b]:h.values[g*i+b]=0===t.rank?f[0]:f[p*i+b]}return h.toTensor().reshape(n)},t}(Lx);function CD(e,t){return{kernelName:e,backendName:"cpu",kernelFunc:function(n){var r=n.inputs,i=n.backend,a=r,o=a.a,s=a.b,c=i;bD([o,s],e);var u=c.data.get(o.dataId).values,l=c.data.get(s.dataId).values,d=t(o.shape,s.shape,u,l,o.dtype),f=d[0],h=d[1];return{dataId:c.write(f,h,o.dtype),shape:h,dtype:o.dtype}}}}function xD(e){return function(t,n,r,i,a){var o=yC(t,n),s=o.length,c=yw(o),u=iw(a,K_(o)),l=t.length,d=n.length,f=yw(t),h=yw(n),p=gC(t,o),m=gC(n,o);if(p.length+m.length===0)for(var g=0;g<u.length;++g)u[g]=e(r[g%r.length],i[g%i.length]);else{var v=function(t){var n=Iw(t,s,c),a=n.slice(-l);p.forEach((function(e){return a[e]=0}));var o=Rw(a,l,f),g=n.slice(-d);m.forEach((function(e){return g[e]=0}));var v=Rw(g,d,h);u[t]=e(r[o],i[v])};for(g=0;g<u.length;++g)v(g)}return[u,o]}}eE.registerBackend("cpu",(function(){return new SD}),1);var TD=xD((function(e,t){return e/t})),RD=CD(cC,TD),ID={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,i=t.x,a=n,o=a.filterSize,s=a.strides,c=a.pad,u=a.includeBatchInIndex,l=r;bD(i,"MaxPoolWithArgmax");var d=l.data.get(i.dataId).values,f=Px(i.shape,o,s,[1,1],c),h=function(e,t,n,r,i){var a=_D(e,0,n,yw(t),i,"max"),o=wD(e,t,n,i,!0,r);return[a.values,o.values]}(d,i.shape,i.dtype,u,f),p=h[0],m=h[1],g=l.write(p,f.outShape,i.dtype),v=l.write(m,f.outShape,i.dtype);return[{dataId:g,shape:f.outShape,dtype:i.dtype},{dataId:v,shape:f.outShape,dtype:"int32"}]}},ND={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t,a=i.boxes,o=i.scores,s=r,c=s.maxOutputSize,u=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,f=n;bD(a,"NonMaxSuppressionWithScore");var h=iT(f.data.get(a.dataId).values,f.data.get(o.dataId).values,c,u,l,d);return[h.selectedIndices,h.selectedScores]}},AD={kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=n;bD(r,"square");for(var a=i.data.get(r.dataId).values,o=new Float32Array(a.length),s=0;s<a.length;++s){var c=a[s];o[s]=c*c}return{dataId:i.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},kD=xD((function(e,t){var n=e-t;return n*n}));function DD(e,t,n,r,i){for(var a=K_(t),o=t.length,s=yw(t),c=yw(i),u=iw(n,K_(i)),l=0;l<a;++l){for(var d=Iw(l,o,s),f=new Array(d.length),h=0;h<f.length;h++)f[h]=d[r[h]];u[Rw(f,o,c)]=e[l]}return u}for(var MD=0,LD=[ND,AD,CD(uC,kD),RD,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,i=t.x,a=n.perm,o=r;bD(i,"transpose");for(var s=i.shape.length,c=new Array(s),u=0;u<c.length;u++)c[u]=i.shape[a[u]];var l=DD(o.data.get(i.dataId).values,i.shape,i.dtype,a,c);return{dataId:o.write(l,c,i.dtype),shape:c,dtype:i.dtype}}},ID];MD<LD.length;MD++)j_(LD[MD]);for(var OD,PD=function(e){this.variableNames=["A"];var t=yT(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},jD=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=yT(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},FD=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var i=kT(this.rank),a=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},UD=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=kT(this.rank),a=gT("rc",this.rank),o=new Array(this.rank);for(r=0;r<t.length;r++)o[t[r]]=a[r];var s="vec2("+o.slice(-2).join()+")",c="++"+a[this.rank-1]+" < "+n[this.rank-1],u="getChannel(getA("+o.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+u+";\n      if("+c+") {\n        result[1] = "+u+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+u+";\n        if("+c+") {\n          result[3] = "+u+";\n        }\n      }\n      setOutput(result);\n    }\n    "},BD=0,VD=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,i=t.pixels,a=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,c=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],u=c[0],l=c[1],d=[l,u],f=[l,u,a];(s||o)&&(null==OD&&(OD=document.createElement("canvas").getContext("2d")),OD.canvas.width=u,OD.canvas.height=l,OD.drawImage(i,0,0,u,l),i=OD.canvas);var h=n.makeTensorInfo(d,"int32");n.texData.get(h.dataId).usage=iE.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),i);var p=A_().getBool("WEBGL_PACK")?new jD(f):new PD(f),m=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),m}},{kernelName:cC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;return function(e,t,n){var r=new GT("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return A_().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(r=new YT("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",e.shape,t.shape,!0)),n.runWebGLProgram(r,[e,t],"float32")}(r.a,r.b,n)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;cS("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=t,a=i.boxes,o=i.scores,s=r,c=s.maxOutputSize,u=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,f=n,h=iT(f.readSync(a.dataId),f.readSync(o.dataId),c,u,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,i=n,a=new TI(r.shape,"return x * x;");return i.runWebGLProgram(a,[r],r.dtype)}},{kernelName:uC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,i=r.a,a=r.b,o=n,s=A_().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YT("return (a - b) * (a - b);",i.shape,a.shape):new GT("return (a - b) * (a - b);",i.shape,a.shape);return o.compileAndRun(s,[i,a])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(e){for(var t,n=e.inputs,r=e.attrs,i=e.backend,a=n.x,o=r.perm,s=i,c=a.shape.length,u=new Array(c),l=0;l<u.length;l++)u[l]=a.shape[o[l]];if(s.shouldExecuteOnCPU([a])){var d=DD(s.texData.get(a.dataId).values,a.shape,a.dtype,o,u);t=s.makeTensorInfo(u,a.dtype),s.texData.get(t.dataId).values=d}else t=function(e,t,n){var r=A_().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new UD(e.shape,t):new FD(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}(a,o,s);return t}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,i=t.x,a=n,o=a.filterSize,s=a.strides,c=a.pad,u=a.includeBatchInIndex,l=r;G_(4===i.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank "+i.shape.length+"."}));var d=[1,1];G_(Yx(s,d),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+d+"'"}));var f=Px(i.shape,o,s,d,c),h=function(e,t,n,r){var i=new nI(n,"max",!1),a=r.runWebGLProgram(i,[e],"float32");return i=new nI(n,"max",!0,!0,t),[a,r.runWebGLProgram(i,[e],"float32")]}(i,u,f,l);return[h[0],h[1]]}}];BD<VD.length;BD++)j_(VD[BD]);for(var zD=0,WD=[{kernelName:"Add",inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],i=yC(n.shape,r.shape);return{a:function(){var t=e,r=vC(n.shape,i);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},b:function(){var t=e,n=vC(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},{kernelName:lC,gradFunc:function(e,t,n){for(var r=n,i=r.inputShape,a=r.shape,o=Array.from(a),s=i.length-1;s>=0;s--)if(i[s]===a[s])o[s]=1;else if(1!==i[s])throw new Error("broadcastTo(): ["+i+"] cannot be broadcast to ["+a+"].");var c=[];for(s=0;s<o.length;s++)o[s]>1&&c.push(s);return{x:function(){return e.sum(c,!0)}}}},{kernelName:cC,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],i=yC(n.shape,r.shape);return{a:function(){var t=gx(e,r.toFloat()),a=vC(n.shape,i);return a.length>0?lk(t,a).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),a=vC(r.shape,i);a.length>0&&(t=lk(t,a).reshape(r.shape));var o=eA(r);return jC(gx(t,o.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,i=t[0],a=t[1],o=t[2],s=t[3],c=fN(i),u=null==s?NS(1):s,l=vC(a.shape,c.shape),d=[];if(1===a.rank){for(var f=0;f<c.shape.length-1;++f)d.push(c.shape[f]);d.push(1)}var h=px(i,a),p=ux(e,u),m=BC(mC(o,NS(r))),g=ux(ux(ux(m,m),m),NS(-.5));return{x:function(){return 1===a.rank?ZS(ux(ux(e,ON(m.as4D(1,1,1,a.shape[0]),d)),u),i.shape):ZS(ux(ux(e,m),u),i.shape)},mean:function(){var e=ux(ux(m,NS(-1)),p);return 1===a.rank&&(e=lk(e,l)),ZS(e,a.shape)},variance:function(){var e=ux(ux(g,h),p);return 1===a.rank&&(e=lk(e,l)),ZS(e,a.shape)},scale:function(){var t=ux(h,m),n=ux(e,t);return 1===a.rank&&(n=lk(n,l)),ZS(n,a.shape)},offset:function(){var t=e;return 1===a.rank&&(t=lk(t,l)),ZS(t,a.shape)}}}},{kernelName:fC,gradFunc:function(e){return{x:function(){return e.toFloat()}}}},{kernelName:dC,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return OS(n.shape,"float32")}}}},{kernelName:pC,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],i=n.paddings.map((function(e){return e[0]}));return{x:function(){return e.slice(i,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:uC,inputsToSave:["a","b"],gradFunc:function(e,t){var n=t[0],r=t[1],i=NS(2);return{a:function(){return ux(e,ux(i,px(n,r)))},b:function(){return ux(e,ux(i,px(r,n)))}}}},{kernelName:hC,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],i=n.reps;return{x:function(){var t=US(r);if(1===r.rank)for(var n=0;n<i[0];++n)t=t.add(e.slice([n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(n=0;n<i[0];++n)for(var a=0;a<i[1];++a)t=t.add(e.slice([n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(n=0;n<i[0];++n)for(a=0;a<i[1];++a)for(var o=0;o<i[2];++o)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(n=0;n<i[0];++n)for(a=0;a<i[1];++a)for(o=0;o<i[2];++o)for(var s=0;s<i[3];++s)t=t.add(e.slice([n*r.shape[0],a*r.shape[1],o*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:"Transpose",gradFunc:function(e,t,n){var r=bS(n.perm);return{x:function(){return Dx(e,r)}}}}];zD<WD.length;zD++)F_(WD[zD]);var GD=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();A_().get("IS_BROWSER")&&A_().setPlatform("browser",new GD);var HD,YD=function(){function e(){this.util=n(7184),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=A_().global.fetch?A_().global.fetch(e,t):(null==HD&&(HD=n(7531)),HD(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();A_().get("IS_NODE")&&A_().setPlatform("node",new YD);var qD={float32:4,int32:4,uint16:2,uint8:1,bool:1};function KD(e,t){for(var n={},r=0,i=function(t){var i=t.name,a=t.dtype,o=t.shape,s=K_(o),c=void 0;if("quantization"in t){var u=t.quantization;if("uint8"!==u.dtype&&"uint16"!==u.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+u.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=qD[u.dtype],d=e.slice(r,r+s*l),f="uint8"===u.dtype?new Uint8Array(d):new Uint16Array(d);if("float32"===a)c=Float32Array.from(f,(function(e){return e*u.scale+u.min}));else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);c=Int32Array.from(f,(function(e){return Math.round(e*u.scale+u.min)}))}r+=s*l}else if("string"===a){var h=K_(t.shape);c=[];for(var p=0;p<h;p++){var m=new Uint32Array(e.slice(r,r+4))[0];r+=4;var g=new Uint8Array(e.slice(r,r+m));c.push(g),r+=m}}else{var v=qD[a];if(d=e.slice(r,r+s*v),"float32"===a)c=new Float32Array(d);else if("int32"===a)c=new Int32Array(d);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+i+"': "+a);c=new Uint8Array(d)}r+=s*v}n[i]=RS(c,o,a)},a=0,o=t;a<o.length;a++)i(o[a]);return n}function XD(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),i=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),i),i+=e.byteLength})),r.buffer}var QD="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function JD(e){return QD?Buffer.byteLength(e):new Blob([e]).size}function ZD(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function $D(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function eM(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:JD(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:JD(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var tM=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var i=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&i.push(n)})),i},e}(),nM="://",rM=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){G_(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(nM)&&(t=t.slice(0,t.indexOf(nM))),G_(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();G_(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function iM(e){if(-1===e.indexOf(nM))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+rM.getSchemes().join(","));return{scheme:e.split(nM)[0],path:e.split(nM)[1]}}function aM(e,t,n){return void 0===n&&(n=!1),R_(this,void 0,void 0,(function(){var r,i,a,o,s,c,u,l,d;return I_(this,(function(f){switch(f.label){case 0:return G_(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),G_((r=tM.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),G_(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),i=r[0],G_((a=tM.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),G_(a.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."})),o=a[0],s=iM(e).scheme,c=iM(e).path,u=s===iM(e).scheme,[4,i.load()];case 1:return l=f.sent(),n&&u?[4,rM.getManager(s).removeModel(c)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,o.save(l)];case 4:return d=f.sent(),!n||u?[3,6]:[4,rM.getManager(s).removeModel(c)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}}))}))}var oM="models_store",sM="model_info_store";function cM(){if(!A_().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function uM(e){var t=e.result;t.createObjectStore(oM,{keyPath:"modelPath"}),t.createObjectStore(sM,{keyPath:"modelPath"})}var lM=function(){function e(e){if(this.indexedDB=cM(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return R_(this,void 0,void 0,(function(){return I_(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return R_(this,void 0,void 0,(function(){return I_(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return uM(i)},i.onsuccess=function(){var a=i.result;if(null==t){var o=a.transaction(oM,"readonly"),s=o.objectStore(oM).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return a.close(),r(s.error)},o.oncomplete=function(){return a.close()}}else{var c,u=eM(t),l=a.transaction(sM,"readwrite"),d=l.objectStore(sM),f=d.put({modelPath:n.modelPath,modelArtifactsInfo:u});f.onsuccess=function(){var i=(c=a.transaction(oM,"readwrite")).objectStore(oM).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:u});i.onsuccess=function(){return e({modelArtifactsInfo:u})},i.onerror=function(e){var t=(d=l.objectStore(sM)).delete(n.modelPath);t.onsuccess=function(){return a.close(),r(i.error)},t.onerror=function(e){return a.close(),r(i.error)}}},f.onerror=function(e){return a.close(),r(f.error)},l.oncomplete=function(){null==c?a.close():c.oncomplete=function(){return a.close()}}}},i.onerror=function(e){return r(i.error)}}))},e.URL_SCHEME="indexeddb://",e}(),dM=function(e){return A_().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(lM.URL_SCHEME)?(t=e.slice(lM.URL_SCHEME.length),new lM(t)):null;var t};tM.registerSaveRouter(dM),tM.registerLoadRouter(dM);var fM=function(){function e(){this.indexedDB=cM()}return e.prototype.listModels=function(){return R_(this,void 0,void 0,(function(){var e=this;return I_(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return uM(r)},r.onsuccess=function(){var e=r.result,i=e.transaction(sM,"readonly"),a=i.objectStore(sM).getAll();a.onsuccess=function(){for(var e={},n=0,r=a.result;n<r.length;n++){var i=r[n];e[i.modelPath]=i.modelArtifactsInfo}t(e)},a.onerror=function(t){return e.close(),n(a.error)},i.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return R_(this,void 0,void 0,(function(){var t=this;return I_(this,(function(n){var r;return e=(r=e).startsWith(lM.URL_SCHEME)?r.slice(lM.URL_SCHEME.length):r,[2,new Promise((function(n,r){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return uM(i)},i.onsuccess=function(){var t,a=i.result,o=a.transaction(sM,"readwrite"),s=o.objectStore(sM),c=s.get(e);c.onsuccess=function(){if(null==c.result)return a.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var i=s.delete(e),o=function(){var i=(t=a.transaction(oM,"readwrite")).objectStore(oM).delete(e);i.onsuccess=function(){return n(c.result.modelArtifactsInfo)},i.onerror=function(e){return r(c.error)}};i.onsuccess=o,i.onerror=function(e){return o(),a.close(),r(c.error)}},c.onerror=function(e){return a.close(),r(c.error)},o.oncomplete=function(){null==t?a.close():t.oncomplete=function(){return a.close()}}},i.onerror=function(e){return r(i.error)}}))]}))}))},e}();if(A_().getBool("IS_BROWSER"))try{rM.registerManager(lM.URL_SCHEME,new fM)}catch(ps){}var hM="/",pM="tensorflowjs_models",mM="info",gM="model_topology",vM="weight_specs",yM="weight_data",bM="model_metadata";function _M(e){return{info:[pM,e,mM].join(hM),topology:[pM,e,gM].join(hM),weightSpecs:[pM,e,vM].join(hM),weightData:[pM,e,yM].join(hM),modelMetadata:[pM,e,bM].join(hM)}}function wM(e){var t=e.split(hM);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(hM)}var EM=function(){function e(e){if(!A_().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=_M(this.modelPath)}return e.prototype.save=function(e){return R_(this,void 0,void 0,(function(){var t,n,r;return I_(this,(function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=eM(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(QD)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,i=t.length;r<i;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}}))}))},e.prototype.load=function(){return R_(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return I_(this,(function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(QD){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r.set([n.charCodeAt(i)],i);return r.buffer}(o),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),SM=function(e){return A_().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(EM.URL_SCHEME)?(t=e.slice(EM.URL_SCHEME.length),new EM(t)):null;var t};tM.registerSaveRouter(SM),tM.registerLoadRouter(SM);var CM=function(){function e(){G_(A_().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),G_("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return R_(this,void 0,void 0,(function(){var e,t,n,r,i,a;return I_(this,(function(o){for(e={},t=pM+hM,n=hM+mM,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(t)&&i.endsWith(n)&&(a=wM(i),e[a]=JSON.parse(this.LS.getItem(i)));return[2,e]}))}))},e.prototype.removeModel=function(e){return R_(this,void 0,void 0,(function(){var t,n;return I_(this,(function(r){var i;if(e=(i=e).startsWith(EM.URL_SCHEME)?i.slice(EM.URL_SCHEME.length):i,t=_M(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(A_().getBool("IS_BROWSER"))try{rM.registerManager(EM.URL_SCHEME,new CM)}catch(ps){}function xM(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var TM=function(){function e(t){if(!A_().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return R_(this,void 0,void 0,(function(){var t,n,r,i,a,o;return I_(this,(function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,xM((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return s.sent(),null==e.weightData?[3,4]:((o=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,o.href=t,[4,xM((function(){return o.dispatchEvent(new MouseEvent("click"))}))]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:eM(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),RM=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return R_(this,void 0,void 0,(function(){var e,t,n=this;return I_(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,i){var a=new FileReader;a.onload=function(a){var o=JSON.parse(a.target.result),s=o.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var c=o.weightsManifest;if(null!=c){var u;try{u=n.checkManifestAndWeightFiles(c,t)}catch(e){return void i(e)}var l=[],d=[],f=[];c.forEach((function(e){e.paths.forEach((function(e){d.push(e),f.push(null)})),l.push.apply(l,e.weights)})),c.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,i=d.indexOf(e);f[i]=n,-1===f.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:ZD(f),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},t.onerror=function(t){return i("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(u[e])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(t){return i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return $D(e.name)})),i={},a=0,o=e;a<o.length;a++)o[a].paths.forEach((function(e){var a=$D(e);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");i[e]=t[r.indexOf(a)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return i},e}();function IM(e,t,n,r){!function(e){G_(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){G_(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),G_(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),G_(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function NM(e,t){return R_(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l;return I_(this,(function(d){switch(d.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?A_().platform.fetch:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),i=0,a=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return o=d.sent(),[3,4];case 2:return[4,IM(r,t.onProgress,i,a)];case 3:o=d.sent(),d.label=4;case 4:return s=o.map((function(e){return e.arrayBuffer()})),c=.5,u=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,IM(s,t.onProgress,c,u)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}}))}))}function AM(e){var t=this;return function(n,r,i){return void 0===r&&(r=""),R_(t,void 0,void 0,(function(){var t,a,o,s,c,u,l,d,f,h;return I_(this,(function(p){switch(p.label){case 0:if(t=n.map((function(){return!1})),a={},o=null!=i?i.map((function(){return!1})):[],s=[],n.forEach((function(e,n){var r=0;e.weights.forEach((function(e){var c="quantization"in e?e.quantization.dtype:e.dtype,u=qD[c]*K_(e.shape),l=function(){t[n]=!0,null==a[n]&&(a[n]=[]),a[n].push({manifestEntry:e,groupOffset:r,sizeBytes:u})};null!=i?i.forEach((function(t,n){t===e.name&&(l(),o[n]=!0)})):l(),s.push(e.name),r+=u}))})),!o.every((function(e){return e})))throw c=i.filter((function(e,t){return!o[t]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return u=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),l=[],u.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;l.push(t)}))})),[4,e(l)];case 1:return d=p.sent(),f={},h=0,u.forEach((function(e){for(var t=n[e].paths.length,r=0,i=0;i<t;i++)r+=d[h+i].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),c=0,u=0;u<t;u++){var l=new Uint8Array(d[h+u]);s.set(l,c),c+=l.byteLength}a[e].forEach((function(e){var t=KD(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)f[n]=t[n]})),h+=t})),[2,f]}}))}))}}tM.registerSaveRouter((function(e){return A_().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(TM.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new TM(e)}(e.slice(TM.URL_SCHEME.length)):null}));var kM=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(G_("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=A_().platform.fetch,G_(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&G_(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return R_(this,void 0,void 0,(function(){var t,n,r,i;return I_(this,(function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:eM(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},e.prototype.load=function(){return R_(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,s,c,u,l,d;return I_(this,(function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,e.json()];case 3:return t=f.sent(),[3,5];case 4:throw f.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,i=t.weightsManifest,a=t.generatedBy,o=t.convertedBy,s=t.format,c=t.userDefinedMetadata,null==r&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:d=f.sent(),u=d[0],l=d[1],f.label=7;case 7:return[2,{modelTopology:r,weightSpecs:u,weightData:l,userDefinedMetadata:c,generatedBy:a,convertedBy:o,format:s}]}}))}))},e.prototype.loadWeights=function(e){return R_(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l,d;return I_(this,(function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],i=n[1],a=this.weightPathPrefix||r,o=[],s=0,c=e;s<c.length;s++)u=c[s],o.push.apply(o,u.weights);return l=[],e.forEach((function(e){e.paths.forEach((function(e){l.push(a+e+i)}))})),[4,NM(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=f.sent(),[2,[o,ZD(d)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function DM(e){return null!=e.match(kM.URL_SCHEME_REGEX)}var MM=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every((function(e){return DM(e)})):DM(e))?LM(e,{onProgress:t}):null};function LM(e,t){return new kM(e,t)}tM.registerSaveRouter(MM),tM.registerLoadRouter(MM);var OM,PM=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return R_(this,void 0,void 0,(function(){return I_(this,(function(e){return[2,this.modelArtifacts]}))}))},e}(),jM=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return R_(this,void 0,void 0,(function(){return I_(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),FM=Object.freeze({browserFiles:function(e){return new RM(e)},browserHTTPRequest:function(e,t){return LM(e,t)},concatenateArrayBuffers:ZD,decodeWeights:KD,encodeWeights:function(e,t){return R_(this,void 0,void 0,(function(){var n,r,i,a,o,s=this;return I_(this,(function(c){switch(c.label){case 0:for(n=[],r=[],i=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),a=function(a){var o=i[a],c=Array.isArray(e)?e[a].tensor:e[o];if("float32"!==c.dtype&&"int32"!==c.dtype&&"bool"!==c.dtype&&"string"!==c.dtype)throw new Error("Unsupported dtype in weight '"+o+"': "+c.dtype);var u={name:o,shape:c.shape,dtype:c.dtype};if("string"===c.dtype){var l=new Promise((function(e){return R_(s,void 0,void 0,(function(){var t,n,r,i,a,o,s;return I_(this,(function(u){switch(u.label){case 0:return[4,c.bytes()];case 1:for(t=u.sent(),n=t.reduce((function(e,t){return e+t.length}),0)+4*t.length,r=new Uint8Array(n),i=0,a=0;a<t.length;a++)o=t[a],s=new Uint8Array(new Uint32Array([o.length]).buffer),r.set(s,i),i+=4,r.set(o,i),i+=o.length;return e(r),[2]}}))}))}));r.push(l)}else r.push(c.data());null!=t&&(u.group=t),n.push(u)},o=0;o<i.length;++o)a(o);return[4,Promise.all(r)];case 1:return[2,{data:XD(c.sent()),specs:n}]}}))}))},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new PM(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new PM({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new PM({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return tM.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:eM,getSaveHandlers:function(e){return tM.getSaveHandlers(e)},http:LM,isHTTPScheme:DM,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),R_(this,void 0,void 0,(function(){return I_(this,(function(i){return[2,AM((function(e){return NM(e,{requestInit:r})}))(e,t,n)]}))}))},registerLoadRouter:function(e){return tM.registerLoadRouter(e)},registerSaveRouter:function(e){return tM.registerSaveRouter(e)},weightsLoaderFactory:AM,withSaveHandler:function(e){return new jM(e)},copyModel:function(e,t){return R_(this,void 0,void 0,(function(){return I_(this,(function(n){return[2,aM(e,t,!1)]}))}))},listModels:function(){return R_(this,void 0,void 0,(function(){var e,t,n,r,i,a,o;return I_(this,(function(s){switch(s.label){case 0:e=rM.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(i=r[n],[4,rM.getManager(i).listModels()]):[3,4];case 2:for(o in a=s.sent())t[i+nM+o]=a[o];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return R_(this,void 0,void 0,(function(){return I_(this,(function(n){return[2,aM(e,t,!0)]}))}))},removeModel:function(e){return R_(this,void 0,void 0,(function(){var t;return I_(this,(function(n){return t=iM(e),[2,rM.getManager(t.scheme).removeModel(t.path)]}))}))}}),UM=SS({confusionMatrix_:function(e,t,n){var r=dS(e,"labels","confusionMatrix"),i=dS(t,"predictions","confusionMatrix");G_(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),G_(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),G_(1===i.rank,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),G_(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),G_(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=FN(r.asType("int32"),n),o=FN(i.asType("int32"),n);return a.transpose().matMul(o).asType("int32")}}),BM=(Object.freeze({confusionMatrix:UM}),SS({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,a=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)a=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(i&&i&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=L_("FromPixels",eE.backendName))return eE.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,c,u=i?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=u[0],d=u[1];if(o?s=e.getContext("2d").getImageData(0,0,l,d).data:r||n?s=e.data:(a||i)&&(null==OM&&(OM=document.createElement("canvas").getContext("2d")),OM.canvas.width=l,OM.canvas.height=d,OM.drawImage(e,0,0,l,d),s=OM.getImageData(0,0,l,d).data),4===t)c=new Int32Array(s);else{var f=l*d;c=new Int32Array(f*t);for(var h=0;h<f;h++)for(var p=0;p<t;++p)c[h*t+p]=s[4*h+p]}return DS(c,[d,l,t],"int32")}})),VM=Object.freeze({toPixels:function(e,t){return R_(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w,E,S,C;return I_(this,(function(x){switch(x.label){case 0:if(n=dS(e,"img","toPixels"),e instanceof Fw||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],a=r[1],(o=2===n.rank?1:n.shape[2])>4||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return[4,n.data()];case 1:return s=x.sent(),c=n.min(),u=n.max(),[4,Promise.all([c.data(),u.data()])];case 2:if(l=x.sent(),d=l[0],f=l[1],h=d[0],p=f[0],c.dispose(),u.dispose(),"float32"===n.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(m="float32"===n.dtype?255:1,g=new Uint8ClampedArray(a*i*4),v=0;v<i*a;++v)y=void 0,b=void 0,_=void 0,w=void 0,1===o?(y=s[v]*m,b=s[v]*m,_=s[v]*m,w=255):3===o?(y=s[3*v]*m,b=s[3*v+1]*m,_=s[3*v+2]*m,w=255):4===o&&(y=s[4*v]*m,b=s[4*v+1]*m,_=s[4*v+2]*m,w=s[4*v+3]*m),g[0+(E=4*v)]=Math.round(y),g[E+1]=Math.round(b),g[E+2]=Math.round(_),g[E+3]=Math.round(w);return null!=t&&(t.width=a,t.height=i,S=t.getContext("2d"),C=new ImageData(g,a,i),S.putImageData(C,0,0)),n!==e&&n.dispose(),[2,g]}}))}))},fromPixels:BM}),zM=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),WM=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function GM(e){G_(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),G_("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),G_(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),WM.register(e)}Object.freeze({Serializable:zM,SerializationMap:WM,registerClass:GM}),Object.freeze({gpgpu_util:VR,webgl_util:rS,forceHalfFloat:function(){A_().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:eN,setWebGLContext:cE,GPGPUContext:zR});var HM=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return T_(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),i=r.value,a=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:a[e.name]}}));this.applyGradients(o)}else this.applyGradients(a);return sS(a),t?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){G_(gw(e),(function(){return"The f passed in variableGrads(f) must be a function"})),G_(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Gw})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],eE.registeredVariables)t.push(eE.registeredVariables[r]);var i=n?t.filter((function(e){return!e.trainable})):null,a=t.length;G_((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var o=eE.gradients(e,t,null,!0),s=o.value,c=o.grads;G_(c.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),G_(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var u={};return t.forEach((function(e,t){null!=c[t]&&(u[e.name]=c[t])})),null!=i&&i.forEach((function(e){return u[e.name]=null})),{value:s,grads:u}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&sS(this.iterations_)},t.prototype.saveIterations=function(){return R_(this,void 0,void 0,(function(){return I_(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:NS(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return R_(this,void 0,void 0,(function(){return I_(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return R_(this,void 0,void 0,(function(){return I_(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return R_(this,void 0,void 0,(function(){var t;return I_(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},t}(zM);Object.defineProperty(HM,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var YM=function(e){function t(t,n,r){void 0===r&&(r=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=r,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==r&&(i.epsilon=eE.backend.epsilon()),i}return T_(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=eE.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:oS((function(){return US(i).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:oS((function(){return US(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;oS((function(){var e=o.mul(t.rho).add(a.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(a),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var c=n.mul(-t.learningRate).add(i);i.assign(c)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(sS(this.accumulatedGrads.map((function(e){return e.variable}))),sS(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return R_(this,void 0,void 0,(function(){var e;return I_(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return R_(this,void 0,void 0,(function(){var t;return I_(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(HM);GM(YM);var qM=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return T_(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=eE.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:oS((function(){return PS(i.shape,t.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedGrads[r].variable;oS((function(){var e=o.add(a.square());o.assign(e);var n=a.div(e.add(eE.backend.epsilon()).sqrt()).mul(-t.learningRate).add(i);i.assign(n)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&sS(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return R_(this,void 0,void 0,(function(){return I_(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return R_(this,void 0,void 0,(function(){return I_(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(HM);GM(qM);var KM=function(e){function t(t,n,r,i){void 0===i&&(i=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],oS((function(){a.accBeta1=NS(n).variable(),a.accBeta2=NS(r).variable()})),null==i&&(a.epsilon=eE.backend.epsilon()),a}return T_(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);oS((function(){var r=px(1,t.accBeta1),i=px(1,t.accBeta2);n.forEach((function(n,a){var o=eE.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:oS((function(){return US(o).variable(!1)}))}),null==t.accumulatedSecondMoment[a]&&(t.accumulatedSecondMoment[a]={originalName:n+"/v",variable:oS((function(){return US(o).variable(!1)}))});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var c=t.accumulatedFirstMoment[a].variable,u=t.accumulatedSecondMoment[a].variable,l=c.mul(t.beta1).add(s.mul(1-t.beta1)),d=u.mul(t.beta2).add(s.square().mul(1-t.beta2)),f=l.div(r),h=d.div(i);c.assign(l),u.assign(d);var p=f.div(h.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(p)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&sS(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&sS(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return R_(this,void 0,void 0,(function(){var e;return I_(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return R_(this,void 0,void 0,(function(){var t,n=this;return I_(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),oS((function(){n.accBeta1.assign(dx(n.beta1,n.iterations_+1)),n.accBeta2.assign(dx(n.beta2,n.iterations_+1))})),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(HM);GM(KM);var XM=function(e){function t(t,n,r,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=i,o.decay=a,o.accumulatedFirstMoment=[],o.accumulatedWeightedInfNorm=[],oS((function(){o.iteration=NS(0).variable(),o.accBeta1=NS(n).variable()})),null==i&&(o.epsilon=eE.backend.epsilon()),o}return T_(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);oS((function(){var r=px(1,t.accBeta1),i=gx(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,a){var o=eE.registeredVariables[n];null==t.accumulatedFirstMoment[a]&&(t.accumulatedFirstMoment[a]={originalName:n+"/m",variable:US(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[a]&&(t.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:US(o).variable(!1)});var s=Array.isArray(e)?e[a].tensor:e[n];if(null!=s){var c=t.accumulatedFirstMoment[a].variable,u=t.accumulatedWeightedInfNorm[a].variable,l=c.mul(t.beta1).add(s.mul(1-t.beta1)),d=u.mul(t.beta2),f=s.abs(),h=d.maximum(f);c.assign(l),u.assign(h);var p=i.div(r).mul(l.div(h.add(t.epsilon))).add(o);o.assign(p)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&sS(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&sS(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return R_(this,void 0,void 0,(function(){return I_(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return R_(this,void 0,void 0,(function(){return I_(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(HM);GM(XM);var QM=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return T_(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var a=eE.registeredVariables[n];oS((function(){var e=t.c.mul(i).add(a);a.assign(e)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return eE.keep(e)}(NS(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return R_(this,void 0,void 0,(function(){return I_(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return R_(this,void 0,void 0,(function(){return I_(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(HM);GM(QM);var JM=function(e){function t(t,n,r){void 0===r&&(r=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=NS(i.momentum),i}return T_(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=eE.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:oS((function(){return US(i).variable(!1)}))});var a=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&oS((function(){var e,n=t.m.mul(a).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(i):t.c.mul(n).add(i),a.assign(n),i.assign(e)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&sS(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return R_(this,void 0,void 0,(function(){return I_(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return R_(this,void 0,void 0,(function(){return I_(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(QM);GM(JM);var ZM=function(e){function t(t,n,r,i,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===a&&(a=!1);var o=e.call(this)||this;if(o.learningRate=t,o.decay=n,o.momentum=r,o.epsilon=i,o.accumulatedMeanSquares=[],o.accumulatedMoments=[],o.accumulatedMeanGrads=[],o.centered=a,null==i&&(o.epsilon=eE.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return o}return T_(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=eE.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:oS((function(){return US(i).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:oS((function(){return US(i).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:oS((function(){return US(i).variable(!1)}))});var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;oS((function(){var e=o.mul(t.decay).add(a.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,c=n.mul(t.decay).add(a.mul(1-t.decay)),u=s.mul(t.momentum).add(a.mul(t.learningRate).div(e.sub(c.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(c),s.assign(u);var l=i.sub(u);i.assign(l)}else{var d=o.mul(t.decay).add(a.square().mul(1-t.decay));u=s.mul(t.momentum).add(a.mul(t.learningRate).div(d.add(t.epsilon).sqrt())),o.assign(d),s.assign(u),l=i.sub(u),i.assign(l)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&sS(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&sS(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&sS(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return R_(this,void 0,void 0,(function(){var e;return I_(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return R_(this,void 0,void 0,(function(){var t;return I_(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(HM);GM(ZM);var $M=function(){function e(){}return e.sgd=function(e){return new QM(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new JM(e,t,n)},e.rmsprop=function(e,t,n,r,i){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new ZM(e,t,n,r,i)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new KM(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new YM(e,t,n)},e.adamax=function(e,t,n,r,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new XM(e,t,n,r,i)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new qM(e,t)},e}();$M.sgd,$M.momentum,$M.adadelta,$M.adagrad,$M.rmsprop,$M.adamax,$M.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;Fw.prototype.add=function(e){return mC(this,e)},Fw.prototype.broadcastTo=function(e){return TN(this,e)},Fw.prototype.div=function(e){return gx(this,e)},Fw.prototype.divNoNan=function(e){return LN(this,e)},Fw.prototype.squaredDifference=function(e){return tA(this,e)},Fw.prototype.tile=function(e){return ON(this,e)},Fw.prototype.oneHot=function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=0),FN(this,e,t,n)},Fw.prototype.transpose=function(e){return Dx(this,e)},Fw.prototype.pad=function(e,t){return UN(this,e,t)},Fw.prototype.batchNorm=function(e,t,n,r,i){return gN(this,e,t,n,r,i)},Pw=yD;var eL=function(){function e(e,t){if(!lL(e)||!lL(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}(),tL=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}();function nL(e,t){return e instanceof Fw&&e.shape.length===t}function rL(e){return nL(e,3)}function iL(e){return nL(e,4)}function aL(e){return e%2===0}function oL(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function sL(e){return e&&e.width&&e.height}function cL(e){return e.reduce((function(e,t){return e.add(t)}),new tL(0,0)).div(new tL(e.length,e.length))}function uL(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function lL(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function dL(e){return lL(e)&&0<=e&&e<=1}var fL,hL=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},i=[r.left,r.top,r.right,r.bottom].every(lL),a=[r.x,r.y,r.width,r.height].every(lL);if(!a&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var o=a?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=o[0],c=o[1],u=o[2],l=o[3];e.assertIsValidBox({x:s,y:c,width:u,height:l},"Box.constructor",n),this._x=s,this._y=c,this._width=u,this._height=l}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(lL)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new tL(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new tL(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new tL(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new tL(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,i=t.width,a=t.height,o=Math.abs(i-a);return i<a&&(n-=o/2,i+=o),a<i&&(r-=o/2,a+=o),new e({x:n,y:r,width:i,height:a})},e.prototype.rescale=function(t){var n=sL(t)?t.width:t,r=sL(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,i=r.x,a=r.y,o=r.right,s=r.bottom,c=Math.max(i,0),u=Math.max(a,0),l=o-c,d=s-u;return new e({x:c,y:u,width:Math.min(l,t-c),height:Math.min(d,n-u)}).floor()},e.prototype.shift=function(t,n){var r=this.width,i=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:i})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,i=n,a=r,o=this.left,s=this.top,c=this.right,u=this.bottom;return c>t&&(i=-c+t+n,c=t),u>e&&(a=-u+e+r,u=e),o<1&&(a=2-o,o=1),s<1&&(a=2-s,s=1),{dy:1,edy:a,dx:1,edx:i,y:s,ey:u,x:o,ex:c,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),pL=function(e){function t(t,n,r,i,a){return void 0===a&&(a=!1),e.call(this,{left:t,top:n,right:r,bottom:i},a)||this}return Oc(t,e),t}(hL),mL=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return Oc(t,e),t.assertIsValidLabeledBox=function(e,t){if(hL.assertIsValidBox(e,t),!lL(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(hL),gL=function(){function e(e,t,n,r,i){this._imageDims=new eL(i.width,i.height),this._score=e,this._classScore=t,this._className=n,this._box=new hL(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new hL(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),vL=(function(e){function t(t,n,r,i){var a=e.call(this,t,n)||this;return a._score=r,a._classScore=i,a}Oc(t,e),t.assertIsValidPredictedBox=function(e,t){if(mL.assertIsValidLabeledBox(e,t),!dL(e.score)||!dL(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(mL),function(e){function t(t,n,r,i,a){return void 0===a&&(a=!1),e.call(this,{x:t,y:n,width:r,height:i},a)||this}return Oc(t,e),t}(hL));function yL(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function bL(e){var t="";if(!e)try{e=n(Object(function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(K$){t=K$.toString()}var r=e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:r}}function _L(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=bL();return Pc({Canvas:e||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},i)}function wL(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}function EL(){return"object"===typeof n.g&&"undefined"!==typeof process&&!!process.version}function SL(e){fL=e}function CL(){wL()&&SL(yL()),EL()&&SL(_L())}var xL,TL={getEnv:function(){if(!fL)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return fL},setEnv:SL,initialize:CL,createBrowserEnv:yL,createFileSystem:bL,createNodejsEnv:_L,monkeyPatch:function(e){if(fL||CL(),!fL)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?fL.Canvas:t,r=e.Image,i=void 0===r?fL.Image:r;fL.Canvas=n,fL.Image=i,fL.createCanvasElement=e.createCanvasElement||function(){return new n},fL.createImageElement=e.createImageElement||function(){return new i},fL.ImageData=e.ImageData||fL.ImageData,fL.Video=e.Video||fL.Video,fL.fetch=e.fetch||fL.fetch,fL.readFile=e.readFile||fL.readFile},isBrowser:wL,isNodejs:EL};function RL(e){return TL.isNodejs()||"string"!==typeof e?e:document.getElementById(e)}function IL(e){var t=TL.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=RL(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=r.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}CL(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(xL||(xL={}));var NL=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,i=e.fontSize,a=e.fontStyle,o=e.padding;this.anchorPosition=t||xL.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=o||4},AL=function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"===typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new NL(r)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map((function(t){return e.measureText(t).width})).reduce((function(e,t){return e<t?t:e}),0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===xL.BOTTOM_RIGHT||n===xL.TOP_RIGHT,i=n===xL.BOTTOM_LEFT||n===xL.BOTTOM_RIGHT,a=this.measureWidth(e),o=this.measureHeight(),s=r?this.anchor.x-a:this.anchor.x,c=i?this.anchor.y-o:this.anchor.y;if(t){var u=t.width,l=t.height;return{x:Math.max(Math.min(s,u-a),0),y:Math.max(Math.min(c,l-o),0)}}return{x:s,y:c}},e.prototype.draw=function(e){var t=RL(e),n=IL(t),r=this.options,i=r.backgroundColor,a=r.fontColor,o=r.fontSize,s=r.fontStyle,c=r.padding;n.font=o+"px "+s;var u=this.measureWidth(n),l=this.measureHeight();n.fillStyle=i;var d=this.getUpperLeft(n,t);n.fillRect(d.x,d.y,u,l),n.fillStyle=a,this.text.forEach((function(e,t){var r=c+d.x,i=c+d.y+(t+1)*o;n.fillText(e,r,i)}))},e}(),kL=function(e){void 0===e&&(e={});var t=e.boxColor,n=e.lineWidth,r=e.label,i=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var a={anchorPosition:xL.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new NL(Object.assign({},a,i))},DL=function(){function e(e,t){void 0===t&&(t={}),this.box=new hL(e),this.options=new kL(t)}return e.prototype.draw=function(e){var t=IL(e),n=this.options,r=n.boxColor,i=n.lineWidth,a=this.box,o=a.x,s=a.y,c=a.width,u=a.height;t.strokeStyle=r,t.lineWidth=i,t.strokeRect(o,s,c,u);var l=this.options.label;l&&new AL([l],{x:o-i/2,y:s},this.options.drawLabelOptions).draw(e)},e}();function ML(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),oS((function(){var i=mC(SA(e,t.filters,[1,1],n),t.bias);return r?mk(i):i}))}function LL(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function OL(e,t){return function(n,r,i,a){var o=MS(e(n*r*i*i),[i,i,n,r]),s=AS(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:o,bias:s}}}function PL(e,t){return function(n,r,i){var a=kS(e(n*r),[n,r]),o=AS(e(r));return t.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:a,bias:o}}}var jL=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function FL(e,t){return function(n,r,i){var a=MS(e(9*n),[3,3,n,1]),o=MS(e(n*r),[1,1,n,r]),s=AS(e(r));return t.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new jL(a,o,s)}}function UL(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),i=e(t+"/bias",1);return new jL(n,r,i)}}function BL(e,t){return function(n,r,i){var a=e[n];if(!nL(a,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+a);return t.push({originalPath:n,paramPath:i||n}),a}}function VL(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function zL(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",i=(e=e.replace(r,"")).split("/").filter((function(e){return e})),a=e.endsWith(".json")?i[i.length-1]:n,o=r+(e.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return{modelBaseUri:o=e.startsWith("/")?"/"+o:o,manifestUri:"/"===o?"/"+a:o+"/"+a}}function WL(e){var t=TL.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function GL(e){var t=TL.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new eL(e.naturalWidth,e.naturalHeight):e instanceof r?new eL(e.videoWidth,e.videoHeight):new eL(e.width,e.height)}function HL(e){var t=e.width,n=e.height,r=(0,TL.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function YL(e,t){var n=TL.getEnv().ImageData;if(!(e instanceof n)&&!WL(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||GL(e),i=r.width,a=r.height,o=HL({width:i,height:a});return e instanceof n?IL(o).putImageData(e,0,0):IL(o).drawImage(e,0,0,i,a),o}function qL(e,t){return jc(this,void 0,void 0,(function(){var n;return Fc(this,(function(r){switch(r.label){case 0:return[4,(0,TL.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}}))}))}function KL(e){return jc(this,void 0,void 0,(function(){return Fc(this,(function(t){switch(t.label){case 0:return[4,qL(e)];case 1:return[2,t.sent().json()]}}))}))}function XL(e,t){return jc(this,void 0,void 0,(function(){var n,r,i,a,o,s;return Fc(this,(function(c){switch(c.label){case 0:return n=t||TL.getEnv().createCanvasElement(),r=e.shape.slice(iL(e)?1:0),i=r[0],a=r[1],o=r[2],s=oS((function(){return e.as3D(i,a,o).toInt()})),[4,VM.toPixels(s,n)];case 1:return c.sent(),s.dispose(),[2,n]}}))}))}function QL(e){var t=TL.getEnv(),n=t.Image,r=t.Canvas,i=t.Video;return e instanceof n||e instanceof r||e instanceof i}function JL(e,t){return jc(this,void 0,void 0,(function(){var n,r,i,a;return Fc(this,(function(o){switch(o.label){case 0:return n=zL(e,t),r=n.manifestUri,i=n.modelBaseUri,[4,KL(r)];case 1:return a=o.sent(),[2,FM.loadWeights(a,i)]}}))}))}var ZL=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach((function(e,t){if(rL(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(iL(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var i=e instanceof TL.getEnv().Canvas?e:YL(e);n._canvases[t]=i,n._inputDimensions[t]=[i.height,i.width,3]}))}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return uL(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(e,t){var n=e.width,r=e.height,i=t/Math.max(r,n);return new eL(Math.round(n*i),Math.round(r*i))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,oS((function(){var r=uL(n.batchSize,0,1).map((function(r){var i=n.getInput(r);if(i instanceof Fw){var a=iL(i)?i:i.expandDims();return a=function(e,t){return void 0===t&&(t=!1),oS((function(){var n=e.shape.slice(1),r=n[0],i=n[1];if(r===i)return e;var a=Math.abs(r-i),o=Math.round(a*(t?.5:1)),s=r>i?2:1,c=function(t){var n=e.shape.slice();return n[s]=t,PS(n,0)},u=c(o),l=a-u.shape[s],d=[t&&l?c(l):null,e,u].filter((function(e){return!!e})).map((function(e){return e.toFloat()}));return BS(d,s)}))}(a,t),a.shape[1]===e&&a.shape[2]===e||(a=uD.resizeBilinear(a,[e,e])),a.as3D(e,e,3)}if(i instanceof TL.getEnv().Canvas)return VM.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=TL.getEnv(),i=r.Image,a=r.Canvas;if(!(e instanceof i||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=GL(e),s=t/Math.max(o.height,o.width),c=s*o.width,u=s*o.height,l=HL({width:t,height:t}),d=e instanceof a?e:YL(e),f=Math.abs(c-u)/2,h=n&&c<u?f:0,p=n&&u<c?f:0;return IL(l).drawImage(d,h,p,c,u),l}(i,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+i)})),i=tC(r.map((function(e){return e.toFloat()}))).as4D(n.batchSize,e,e,3);return i}))},e}();function $L(e){return jc(this,void 0,void 0,(function(){var t,n,r;return Fc(this,(function(i){switch(i.label){case 0:if(e instanceof ZL)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(RL)).forEach((function(e,r){if(!QL(e)&&!rL(e)&&!iL(e)){if("string"===typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(iL(e)){var i=e.shape[0];if(1!==i)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+i+" passed, but not supported in input array")}})),[4,Promise.all(r.map((function(e){return QL(e)&&(t=e,new Promise((function(e,n){if(t instanceof TL.getEnv().Canvas||WL(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",i),e(t))}function i(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",i),n(e))}t.addEventListener("load",r),t.addEventListener("error",i)})));var t})))];case 1:return i.sent(),[2,new ZL(r,Array.isArray(e))]}}))}))}var eO=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,i=n.objProp;r[i].dispose(),r[i]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))},e.prototype.getTrainableParams=function(){return this.getParamList().filter((function(e){return e.tensor instanceof Gw}))},e.prototype.getFrozenParams=function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof Gw)}))},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,i=RS(r.dataSync());r.dispose(),e.reassignParamFromPath(n,i)}))},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()})),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))},e.prototype.load=function(e){return jc(this,void 0,void 0,(function(){return Fc(this,(function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loadFromUri=function(e){return jc(this,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,JL(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}}))}))},e.prototype.loadFromDisk=function(e){return jc(this,void 0,void 0,(function(){var t,n,r,i,a,o,s,c,u,l;return Fc(this,(function(d){switch(d.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=TL.getEnv().readFile,n=zL(e,this.getDefaultModelName()),r=n.manifestUri,i=n.modelBaseUri,a=function(e){return Promise.all(e.map((function(e){return t(e).then((function(e){return e.buffer}))})))},o=FM.weightsLoaderFactory(a),u=(c=JSON).parse,[4,t(r)];case 1:return s=u.apply(c,[d.sent().toString()]),[4,o(s,i)];case 2:return l=d.sent(),this.loadFromWeightMap(l),[2]}}))}))},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof Fw))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function tO(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function nO(e,t,n,r){void 0===r&&(r=!0);for(var i=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),a=[],o=function(){var t=i.pop();a.push(t);for(var o=i,s=[],c=0;c<o.length;c++){var u=o[c],l=e[t],d=e[u];s.push(tO(l,d,r))}i=i.filter((function(e,t){return s[t]<=n}))};i.length>0;)o();return a}function rO(e,t){return oS((function(){var n=t[0],r=t[1],i=t[2],a=PS(Uc(e.shape.slice(0,3),[1]),n),o=PS(Uc(e.shape.slice(0,3),[1]),r),s=PS(Uc(e.shape.slice(0,3),[1]),i),c=BS([a,o,s],3);return px(e,c)}))}function iO(e){return 1/(1+Math.exp(-e))}var aO,oO=function(e){return"number"===typeof e};function sO(e){return oS((function(){var t=ux(e,NS(.10000000149011612));return mC(mk(px(e,t)),t)}))}function cO(e,t){return oS((function(){var n=UN(e,[[0,0],[1,1],[1,1],[0,0]]);return n=SA(n,t.conv.filters,[1,1],"valid"),n=px(n,t.bn.sub),n=ux(n,t.bn.truediv),sO(n=mC(n,t.conv.bias))}))}function uO(e,t){return oS((function(){var n=UN(e,[[0,0],[1,1],[1,1],[0,0]]);return n=AA(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),sO(n=mC(n,t.bias))}))}function lO(e,t){var n=OL(e,t);var r=FL(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,i,a){var o=n(r,i,3,a+"/conv"),s=function(n,r){var i=AS(e(n)),a=AS(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:i,truediv:a}}(i,a+"/bn");return{conv:o,bn:s}},extractSeparableConvParams:r}}function dO(e,t){var n=BL(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),i=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:i}},extractSeparableConvParams:UL(n)}}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(aO||(aO={}));var fO=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),hO=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!==typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!oO(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"===typeof e})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return oO(e.x)&&oO(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(oO)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return Oc(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=cO(e,t.conv0);return n=cO(n=WA(n,[2,2],[2,2],"same"),t.conv1),n=cO(n=WA(n,[2,2],[2,2],"same"),t.conv2),n=cO(n=WA(n,[2,2],[2,2],"same"),t.conv3),n=cO(n=WA(n,[2,2],[2,2],"same"),t.conv4),n=cO(n=WA(n,[2,2],[2,2],"same"),t.conv5),n=cO(n=WA(n,[2,2],[1,1],"same"),t.conv6),ML(n=cO(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?sO(ML(e,t.conv0,"valid",!1)):uO(e,t.conv0);return n=uO(n=WA(n,[2,2],[2,2],"same"),t.conv1),n=uO(n=WA(n,[2,2],[2,2],"same"),t.conv2),n=uO(n=WA(n,[2,2],[2,2],"same"),t.conv3),n=uO(n=WA(n,[2,2],[2,2],"same"),t.conv4),n=uO(n=WA(n,[2,2],[2,2],"same"),t.conv5),n=WA(n,[2,2],[1,1],"same"),n=t.conv6?uO(n,t.conv6):n,ML(n=t.conv7?uO(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return oS((function(){var i=e.toBatchTensor(t,!1).toFloat();return i=(i=n.config.meanRgb?rO(i,n.config.meanRgb):i).div(NS(256)),n.config.withSeparableConvs?n.runMobilenet(i,r):n.runTinyYolov2(i,r)}))},t.prototype.forward=function(e,t){return jc(this,void 0,void 0,(function(){var n;return Fc(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,$L(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}}))}))},t.prototype.detect=function(e,t){return void 0===t&&(t={}),jc(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l,d,f,h,p,m=this;return Fc(this,(function(g){switch(g.label){case 0:return n=new fO(t),r=n.inputSize,i=n.scoreThreshold,[4,$L(e)];case 1:return a=g.sent(),[4,this.forwardInput(a,r)];case 2:return o=g.sent(),s=oS((function(){return nC(o)[0].expandDims()})),c={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(s,a.getReshapedInputDimensions(0),i)];case 3:return u=g.sent(),o.dispose(),s.dispose(),l=u.map((function(e){return e.box})),d=u.map((function(e){return e.score})),f=u.map((function(e){return e.classScore})),h=u.map((function(e){return m.config.classes[e.label]})),p=nO(l.map((function(e){return e.rescale(r)})),d,this.config.iouThreshold,!0),[2,p.map((function(e){return new gL(d[e],f[e],h[e],l[e],c)}))]}}))}))},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],i=dO(e,r),a=i.extractConvParams,o=i.extractConvWithBatchNormParams,s=i.extractSeparableConvParams;if(t.withSeparableConvs){var c=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?a("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:c>7?s("conv6"):void 0,conv7:c>8?s("conv7"):void 0,conv8:a("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:a("conv8")};return LL(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var i,a=VL(e),o=a.extractWeights,s=a.getRemainingWeights,c=[],u=lO(o,c),l=u.extractConvParams,d=u.extractConvWithBatchNormParams,f=u.extractSeparableConvParams;if(t.withSeparableConvs){var h=r[0],p=r[1],m=r[2],g=r[3],v=r[4],y=r[5],b=r[6],_=r[7],w=r[8];i={conv0:t.isFirstLayerConv2d?l(h,p,3,"conv0"):f(h,p,"conv0"),conv1:f(p,m,"conv1"),conv2:f(m,g,"conv2"),conv3:f(g,v,"conv3"),conv4:f(v,y,"conv4"),conv5:f(y,b,"conv5"),conv6:_?f(b,_,"conv6"):void 0,conv7:w?f(_,w,"conv7"):void 0,conv8:l(w||_||b,5*n,1,"conv8")}}else h=r[0],p=r[1],m=r[2],g=r[3],v=r[4],y=r[5],b=r[6],_=r[7],w=r[8],i={conv0:d(h,p,"conv0"),conv1:d(p,m,"conv1"),conv2:d(m,g,"conv2"),conv3:d(g,v,"conv3"),conv4:d(v,y,"conv4"),conv5:d(y,b,"conv5"),conv6:d(b,_,"conv6"),conv7:d(_,w,"conv7"),conv8:l(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:i,paramMappings:c}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return jc(this,void 0,void 0,(function(){var r,i,a,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w,E,S,C,x,T,R,I,N,A,k,D=this;return Fc(this,(function(M){switch(M.label){case 0:return r=t.width,i=t.height,a=Math.max(r,i),o=a/r,s=a/i,c=e.shape[1],u=this.config.anchors.length,l=oS((function(){var t=e.reshape([c,c,u,D.boxEncodingSize]);return[t.slice([0,0,0,0],[c,c,u,4]),t.slice([0,0,0,4],[c,c,u,1]),D.withClassScores?Ax(t.slice([0,0,0,5],[c,c,u,D.config.classes.length]),3):NS(0)]})),d=l[0],f=l[1],h=l[2],p=[],[4,f.array()];case 1:return m=M.sent(),[4,d.array()];case 2:g=M.sent(),v=0,M.label=3;case 3:if(!(v<c))return[3,12];y=0,M.label=4;case 4:if(!(y<c))return[3,11];b=0,M.label=5;case 5:return b<u?(_=iO(m[v][y][b][0]),!n||_>n?(w=(y+iO(g[v][y][b][0]))/c*o,E=(v+iO(g[v][y][b][1]))/c*s,S=Math.exp(g[v][y][b][2])*this.config.anchors[b].x/c*o,C=Math.exp(g[v][y][b][3])*this.config.anchors[b].y/c*s,x=w-S/2,T=E-C/2,R={row:v,col:y,anchor:b},this.withClassScores?[4,this.extractPredictedClass(h,R)]:[3,7]):[3,9]):[3,10];case 6:return k=M.sent(),[3,8];case 7:k={classScore:1,label:0},M.label=8;case 8:N=(I=k).classScore,A=I.label,p.push(Pc({box:new pL(x,T,x+S,T+C),score:_,classScore:_*N,label:A},R)),M.label=9;case 9:return b++,[3,5];case 10:return y++,[3,4];case 11:return v++,[3,3];case 12:return d.dispose(),f.dispose(),h.dispose(),[2,p]}}))}))},t.prototype.extractPredictedClass=function(e,t){return jc(this,void 0,void 0,(function(){var n,r,i,a;return Fc(this,(function(o){switch(o.label){case 0:return n=t.row,r=t.col,i=t.anchor,[4,e.array()];case 1:return a=o.sent(),[2,Array(this.config.classes.length).fill(0).map((function(e,t){return a[n][r][i][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t}))]}}))}))},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(eO);function pO(e,t,n){if(void 0===n&&(n=!1),e.beginPath(),t.slice(1).forEach((function(n,r){var i=n.x,a=n.y,o=t[r];e.moveTo(o.x,o.y),e.lineTo(i,a)})),n){var r=t[t.length-1],i=t[0];if(!r||!i)return;e.moveTo(r.x,r.y),e.lineTo(i.x,i.y)}e.stroke()}var mO=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return Oc(t,e),t.prototype.forSize=function(n,r){var i=e.prototype.forSize.call(this,n,r);return new t(i.score,i.relativeBox,i.imageDims)},t}(gL);function gO(e){return e.detection instanceof mO}function vO(e,t){var n={detection:t};return Object.assign({},e,n)}function yO(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof mO?t.score:gO(t)?t.detection.score:void 0,r=t instanceof mO?t.box:gO(t)?t.detection.box:new hL(t),i=n?""+oL(n):void 0;new DL(r,{label:i}).draw(e)}))}function bO(e,t,n){return id((function(){var r=Qg(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Bv(r,t.bias)}))}function _O(e,t,n){return void 0===n&&(n=!1),id((function(){var r=my(n?Bv(Yg(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):bO(e,t.conv0,[2,2])),i=bO(r,t.conv1,[1,1]),a=bO(my(Bv(r,i)),t.conv2,[1,1]);return my(Bv(r,Bv(i,a)))}))}function wO(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),id((function(){var i=my(n?Bv(Yg(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):bO(e,t.conv0,r?[2,2]:[1,1])),a=bO(i,t.conv1,[1,1]),o=bO(my(Bv(i,a)),t.conv2,[1,1]),s=bO(my(Bv(i,Bv(a,o))),t.conv3,[1,1]);return my(Bv(i,Bv(a,Bv(o,s))))}))}function EO(e,t){var n=OL(e,t),r=FL(e,t);function i(e,t,i,a){return void 0===a&&(a=!1),{conv0:a?n(e,t,3,i+"/conv0"):r(e,t,i+"/conv0"),conv1:r(t,t,i+"/conv1"),conv2:r(t,t,i+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function(e,t,n,a){void 0===a&&(a=!1);var o=i(e,t,n,a);return{conv0:o.conv0,conv1:o.conv1,conv2:o.conv2,conv3:r(t,t,n+"/conv3")}}}}function SO(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function CO(e,t){var n=BL(e,t),r=SO(n),i=UL(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):i(e+"/conv0"),conv1:i(e+"/conv1"),conv2:i(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):i(e+"/conv0"),conv1:i(e+"/conv1"),conv2:i(e+"/conv2"),conv3:i(e+"/conv3")}}}}var xO=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return Oc(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return id((function(){var n=wO(rO(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Rd(255)),t.dense0,!0);return n=wO(n,t.dense1),n=wO(n,t.dense2),n=wO(n,t.dense3),n=uv(n,[7,7],[2,2],"valid")}))},t.prototype.forward=function(e){return jc(this,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,$L(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=CO(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return LL(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=VL(e),r=n.extractWeights,i=n.getRemainingWeights,a=EO(r,t).extractDenseBlock4Params,o=a(3,32,"dense0",!0),s=a(32,64,"dense1"),c=a(64,128,"dense2"),u=a(128,256,"dense3");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:c,dense3:u}}}(e)},t}(eO);function TO(e,t){return id((function(){return Bv(Zg(e,t.weights),t.bias)}))}function RO(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var IO=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return Oc(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return id((function(){var r=e instanceof ZL?t.faceFeatureExtractor.forwardInput(e):e;return TO(r.as2D(r.shape[0],-1),n.fc)}))},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],i=VL(e),a=i.extractWeights,o=i.getRemainingWeights,s=PL(a,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=RO(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=BL(e,n),i={fc:(t="fc",{weights:r(t+"/weights",2),bias:r(t+"/bias",1)})};return LL(e,n),{params:i,paramMappings:n}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,i=e.slice(0,e.length-r),a=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(a)},t}(eO),NO=["neutral","happy","sad","angry","fearful","disgusted","surprised"],AO=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);NO.forEach((function(n,r){t[n]=e[r]}))}return e.prototype.asSortedArray=function(){var e=this;return NO.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))},e}(),kO=function(e){function t(t){return void 0===t&&(t=new xO),e.call(this,"FaceExpressionNet",t)||this}return Oc(t,e),t.prototype.forwardInput=function(e){var t=this;return id((function(){return Vf(t.runNet(e))}))},t.prototype.forward=function(e){return jc(this,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,$L(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictExpressions=function(e){return jc(this,void 0,void 0,(function(){var t,n,r,i,a=this;return Fc(this,(function(o){switch(o.label){case 0:return[4,$L(e)];case 1:return t=o.sent(),[4,this.forwardInput(t)];case 2:return n=o.sent(),[4,Promise.all(Tf(n).map((function(e){return jc(a,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}}))}))})))];case 3:return r=o.sent(),n.dispose(),i=r.map((function(e){return new AO(e)})),[2,t.isBatchInput?i:i[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(IO);function DO(e,t){var n={expressions:t};return Object.assign({},e,n)}function MO(e,t,n,r){void 0===n&&(n=.1),(Array.isArray(t)?t:[t]).forEach((function(t){var i=t instanceof AO?t:t.expressions instanceof AO?t.expressions:void 0;if(!i)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var a=i.asSortedArray().filter((function(e){return e.probability>n})),o=gO(t)?t.detection.box.bottomLeft:r||new tL(0,0),s=new AL(a.map((function(e){return e.expression+" ("+oL(e.probability)+")"})),o);s.draw(e)}))}var LO=function(){function e(e,t,n){void 0===n&&(n=new tL(0,0));var r=t.width,i=t.height;this._imgDims=new eL(r,i),this._shift=n,this._positions=e.map((function(e){return e.mul(new tL(r,i)).add(n)}))}return Object.defineProperty(e.prototype,"shift",{get:function(){return new tL(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new tL(e.imageWidth,e.imageHeight))}))},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new tL(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof mO?e.box.floor():new hL(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),i=r.useDlibAlignment,a=r.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],i=function(e){return r.sub(e).magnitude()},a=(i(t)+i(n))/2,o=Math.floor(a/.45),s=cL(e),c=Math.floor(Math.max(0,s.x-.5*o)),u=Math.floor(Math.max(0,s.y-.43*o));return new vL(c,u,Math.min(o,this.imageWidth+c),Math.min(o,this.imageHeight+u))},e.prototype.alignMinBbox=function(e){var t=function(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),i=n.reduce((function(e,t){return t<e?t:e}),1/0),a=t.reduce((function(e,t){return e<t?t:e}),0),o=n.reduce((function(e,t){return e<t?t:e}),0);return new pL(r,i,a,o)}(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),OO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(cL)},t}(LO);function PO(e){return gO(e)&&e.landmarks instanceof LO&&e.unshiftedLandmarks instanceof LO&&e.alignedRect instanceof mO}function jO(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),i=r.align(),a=e.detection.imageDims,o={landmarks:r,unshiftedLandmarks:t,alignedRect:new mO(e.detection.score,i.rescale(a.reverse()),a)};return Object.assign({},e,o)}var FO=function(e){void 0===e&&(e={});var t=e.drawLines,n=void 0===t||t,r=e.drawPoints,i=void 0===r||r,a=e.lineWidth,o=e.lineColor,s=e.pointSize,c=e.pointColor;this.drawLines=n,this.drawPoints=i,this.lineWidth=a||1,this.pointSize=s||2,this.lineColor=o||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"},UO=function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new FO(t)}return e.prototype.draw=function(e){var t=IL(e),n=this.options,r=n.drawLines,i=n.drawPoints,a=n.lineWidth,o=n.lineColor,s=n.pointSize,c=n.pointColor;if(r&&this.faceLandmarks instanceof OO&&(t.strokeStyle=o,t.lineWidth=a,pO(t,this.faceLandmarks.getJawOutline()),pO(t,this.faceLandmarks.getLeftEyeBrow()),pO(t,this.faceLandmarks.getRightEyeBrow()),pO(t,this.faceLandmarks.getNose()),pO(t,this.faceLandmarks.getLeftEye(),!0),pO(t,this.faceLandmarks.getRightEye(),!0),pO(t,this.faceLandmarks.getMouth(),!0)),i){t.strokeStyle=c,t.fillStyle=c;this.faceLandmarks.positions.forEach((function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()}))}},e}();function BO(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof LO?t:PO(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new UO(n).draw(e)}))}function VO(e,t){var n=[],r=VL(e),i=r.extractWeights,a=r.getRemainingWeights,o=function(e,t){var n=OL(e,t),r=FL(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,i){return{separable_conv0:r(e,t,i+"/separable_conv0"),separable_conv1:r(t,t,i+"/separable_conv1"),expansion_conv:n(e,t,1,i+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(i,n),s=o.extractConvParams,c=o.extractSeparableConvParams,u=o.extractReductionBlockParams,l=o.extractMainBlockParams,d={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:u(32,64,"entry_flow/reduction_block_0"),reduction_block_1:u(64,128,"entry_flow/reduction_block_1")},f={};uL(t,0,1).forEach((function(e){f["main_block_"+e]=l(128,"middle_flow/main_block_"+e)}));var h={reduction_block:u(128,256,"exit_flow/reduction_block"),separable_conv:c(256,512,"exit_flow/separable_conv")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{entry_flow:d,middle_flow:f,exit_flow:h}}}function zO(e,t){var n=[],r=function(e,t){var n=BL(e,t),r=SO(n),i=UL(n);return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:function(e){return{separable_conv0:i(e+"/separable_conv0"),separable_conv1:i(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:i(e+"/separable_conv0"),separable_conv1:i(e+"/separable_conv1"),separable_conv2:i(e+"/separable_conv2")}}}}(e,n),i=r.extractConvParams,a=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,c={conv_in:i("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},u={};uL(t,0,1).forEach((function(e){u["main_block_"+e]=s("middle_flow/main_block_"+e)}));var l={reduction_block:o("exit_flow/reduction_block"),separable_conv:a("exit_flow/separable_conv")};return LL(e,n),{params:{entry_flow:c,middle_flow:u,exit_flow:l},paramMappings:n}}function WO(e,t,n){return Bv(Yg(e,t.filters,n,"same"),t.bias)}function GO(e,t,n){void 0===n&&(n=!0);var r=n?my(e):e;return r=bO(r,t.separable_conv0,[1,1]),r=bO(my(r),t.separable_conv1,[1,1]),r=cv(r,[3,3],[2,2],"same"),r=Bv(r,WO(e,t.expansion_conv,[2,2]))}var HO,YO=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return Oc(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return id((function(){var r=rO(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Rd(256)),i=my(WO(r,n.entry_flow.conv_in,[2,2]));return i=GO(i,n.entry_flow.reduction_block_0,!1),i=GO(i,n.entry_flow.reduction_block_1),uL(t._numMainBlocks,0,1).forEach((function(e){i=function(e,t){var n=bO(my(e),t.separable_conv0,[1,1]);return n=bO(my(n),t.separable_conv1,[1,1]),n=bO(my(n),t.separable_conv2,[1,1]),Bv(n,e)}(i,n.middle_flow["main_block_"+e])})),i=GO(i,n.exit_flow.reduction_block),i=my(bO(i,n.exit_flow.separable_conv,[1,1]))}))},t.prototype.forward=function(e){return jc(this,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,$L(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return zO(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return VO(e,this._numMainBlocks)},t}(eO);!function(e){e.FEMALE="female",e.MALE="male"}(HO||(HO={}));var qO=function(e){function t(t){void 0===t&&(t=new YO(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return Oc(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return id((function(){var r=e instanceof ZL?t.faceFeatureExtractor.forwardInput(e):e,i=uv(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:TO(i,n.fc.age).as1D(),gender:TO(i,n.fc.gender)}}))},t.prototype.forwardInput=function(e){var t=this;return id((function(){var n=t.runNet(e),r=n.age,i=n.gender;return{age:r,gender:Vf(i)}}))},t.prototype.forward=function(e){return jc(this,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,$L(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictAgeAndGender=function(e){return jc(this,void 0,void 0,(function(){var t,n,r,i,a,o,s=this;return Fc(this,(function(c){switch(c.label){case 0:return[4,$L(e)];case 1:return t=c.sent(),[4,this.forwardInput(t)];case 2:return n=c.sent(),r=Tf(n.age),i=Tf(n.gender),a=r.map((function(e,t){return{ageTensor:e,genderTensor:i[t]}})),[4,Promise.all(a.map((function(e){var t=e.ageTensor,n=e.genderTensor;return jc(s,void 0,void 0,(function(){var e,r,i,a,o;return Fc(this,(function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],a=(i=r>.5)?HO.MALE:HO.FEMALE,o=i?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:a,genderProbability:o}]}}))}))})))];case 3:return o=c.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?o:o[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=VL(e),r=n.extractWeights,i=n.getRemainingWeights,a=PL(r,t),o=a(512,1,"fc/age"),s=a(512,2,"fc/gender");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=RO(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=BL(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return LL(e,t),{params:i,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(eO),KO=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],cL([e[3],e[4]])]},t}(LO),XO=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+oL(this.distance)+")":"")},e}(),QO=function(){function e(e,t){if("string"!==typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some((function(e){return!(e instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e}();function JO(e,t){return jc(this,void 0,void 0,(function(){var n,r,i,a,o,s;return Fc(this,(function(c){switch(c.label){case 0:return n=TL.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,$L(e)];case 1:if((i=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(a=i.getInput(0))instanceof n?(o=a,[3,4]):[3,2];case 2:return[4,XL(a)];case 3:o=c.sent(),c.label=4;case 4:r=o,c.label=5;case 5:return s=IL(r),[2,t.map((function(e){return e instanceof mO?e.forSize(r.width,r.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(r.width,r.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,i=e.height,a=HL({width:r,height:i});return IL(a).putImageData(s.getImageData(t,n,r,i),0,0),a}))]}}))}))}function ZO(e,t){return jc(this,void 0,void 0,(function(){return Fc(this,(function(n){if(!rL(e)&&!iL(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(iL(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,id((function(){var n=e.shape.slice(iL(e)?1:0),r=n[0],i=n[1],a=n[2],o=t.map((function(e){return e instanceof mO?e.forSize(i,r).box:e})).map((function(e){return e.clipAtImageBorders(i,r)})).map((function(t){var n=t.x,o=t.y,s=t.width,c=t.height;return pv(e.as3D(r,i,a),[o,n,0],[c,s,a])}));return o}))]}))}))}var $O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,i=t/Math.max(r,n);return{width:n*i,height:r*i}})),i=r.length;return id((function(){var n=function(e,t){return Sf([Ld([68],e),Ld([68],t)],1).as2D(1,136).as1D()},a=function(e,t){var n=r[e],i=n.width,a=n.height;return t(i,a)?Math.abs(i-a)/2:0},o=e.mul(Ld([i,136],t)).sub(Sf(Array.from(Array(i),(function(e,t){return n(function(e){return a(e,(function(e,t){return e<t}))}(t),function(e){return a(e,(function(e,t){return t<e}))}(t))})))).div(Sf(Array.from(Array(i),(function(e,t){return n(r[t].width,r[t].height)}))));return o}))},t.prototype.forwardInput=function(e){var t=this;return id((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){return{height:e[0],width:e[1]}})))}))},t.prototype.forward=function(e){return jc(this,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,$L(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.detectLandmarks=function(e){return jc(this,void 0,void 0,(function(){var t,n,r,i=this;return Fc(this,(function(a){switch(a.label){case 0:return[4,$L(e)];case 1:return t=a.sent(),n=id((function(){return Tf(i.forwardInput(t))})),[4,Promise.all(n.map((function(e,n){return jc(i,void 0,void 0,(function(){var r,i,a,o,s;return Fc(this,(function(c){switch(c.label){case 0:return a=(i=Array).from,[4,e.data()];case 1:return r=a.apply(i,[c.sent()]),o=r.filter((function(e,t){return aL(t)})),s=r.filter((function(e,t){return!aL(t)})),[2,new OO(Array(68).fill(0).map((function(e,t){return new tL(o[t],s[t])})),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}}))}))})))];case 2:return r=a.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getClassifierChannelsOut=function(){return 136},t}(IO),eP=function(e){function t(t){return void 0===t&&(t=new xO),e.call(this,"FaceLandmark68Net",t)||this}return Oc(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}($O);var tP=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return Oc(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return id((function(){var n=_O(rO(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Rd(255)),t.dense0,!0);return n=_O(n,t.dense1),n=_O(n,t.dense2),n=uv(n,[14,14],[2,2],"valid")}))},t.prototype.forward=function(e){return jc(this,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,$L(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=CO(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return LL(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=VL(e),r=n.extractWeights,i=n.getRemainingWeights,a=EO(r,t).extractDenseBlock3Params,o=a(3,32,"dense0",!0),s=a(32,64,"dense1"),c=a(64,128,"dense2");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{dense0:o,dense1:s,dense2:c}}}(e)},t}(eO),nP=function(e){function t(t){return void 0===t&&(t=new tP),e.call(this,"FaceLandmark68TinyNet",t)||this}return Oc(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}($O);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Oc(t,e)}(eP);function rP(e,t,n,r,i){void 0===i&&(i="same");var a=t.conv,o=a.filters,s=a.bias,c=Yg(e,o,n,i);return c=function(e,t){return Bv($v(e,t.weights),t.biases)}(c=Bv(c,s),t.scale),r?my(c):c}function iP(e,t){return rP(e,t,[1,1],!1)}function aP(e,t){return rP(e,t,[2,2],!0,"valid")}function oP(e,t){function n(n,r,i,a){var o=function(t,n,r){var i=e(t),a=i.length/(n*r*r);if(a%1!==0)throw new Error("depth has to be an integer: "+a+", weights.length: "+i.length+", numFilters: "+n+", filterSize: "+r);return id((function(){return vy(kd(i,[n,a,r,r]),[2,3,1,0])}))}(n,r,i),s=Id(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:o,bias:s}}function r(r,i,a,o){var s=n(r,i,a,o+"/conv"),c=function(n,r){var i=Id(e(n)),a=Id(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:i,biases:a}}(i,o+"/scale");return{conv:s,scale:c}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,i,a){return void 0===a&&(a=!1),{conv1:r((a?.5:1)*e,t,n,i+"/conv1"),conv2:r(e,t,n,i+"/conv2")}}}}function sP(e,t){var n=BL(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),i=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:i}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function cP(e){var t=[],n=sP(e,t),r=n.extractConvLayerParams,i=n.extractResidualLayerParams,a=r("conv32_down"),o=i("conv32_1"),s=i("conv32_2"),c=i("conv32_3"),u=i("conv64_down"),l=i("conv64_1"),d=i("conv64_2"),f=i("conv64_3"),h=i("conv128_down"),p=i("conv128_1"),m=i("conv128_2"),g=i("conv256_down"),v=i("conv256_1"),y=i("conv256_2"),b=i("conv256_down_out"),_=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!nL(_,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+_);var w={conv32_down:a,conv32_1:o,conv32_2:s,conv32_3:c,conv64_down:u,conv64_1:l,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:v,conv256_2:y,conv256_down_out:b,fc:_};return LL(e,t),{params:w,paramMappings:t}}function uP(e,t){var n=function(e,t){return rP(e,t,[1,1],!0)}(e,t.conv1);return n=iP(n,t.conv2),n=Bv(n,e),n=my(n)}function lP(e,t){var n=aP(e,t.conv1);n=iP(n,t.conv2);var r=uv(e,2,2,"valid"),i=Md(r.shape),a=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=n.shape.slice();o[1]=1;var s=Md(o),c=(n=Fd([n,s],1)).shape.slice();c[2]=1;var u=Md(c);n=Fd([n,u],2)}return r=a?Fd([r,i],3):r,n=Bv(r,n),n=my(n)}var dP=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return Oc(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return id((function(){var n=aP(rO(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Rd(256)),t.conv32_down);n=uP(n=cv(n,3,2,"valid"),t.conv32_1),n=uP(n,t.conv32_2),n=uP(n,t.conv32_3),n=uP(n=lP(n,t.conv64_down),t.conv64_1),n=uP(n,t.conv64_2),n=uP(n,t.conv64_3),n=uP(n=lP(n,t.conv128_down),t.conv128_1),n=uP(n,t.conv128_2),n=uP(n=lP(n,t.conv256_down),t.conv256_1);var r=(n=lP(n=uP(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Zg(r,t.fc)}))},t.prototype.forward=function(e){return jc(this,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,$L(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.computeFaceDescriptor=function(e){return jc(this,void 0,void 0,(function(){var t,n,r,i=this;return Fc(this,(function(a){switch(a.label){case 0:return[4,$L(e)];case 1:return t=a.sent(),n=id((function(){return Tf(i.forwardInput(t))})),[4,Promise.all(n.map((function(e){return e.data()})))];case 2:return r=a.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return cP(e)},t.prototype.extractParams=function(e){return function(e){var t=VL(e),n=t.extractWeights,r=t.getRemainingWeights,i=[],a=oP(n,i),o=a.extractConvLayerParams,s=a.extractResidualLayerParams,c=o(4704,32,7,"conv32_down"),u=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),_=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),S=id((function(){return vy(Nd(n(32768),[128,256]),[1,0])}));if(i.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:c,conv32_1:u,conv32_2:l,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:v,conv128_2:y,conv256_down:b,conv256_1:_,conv256_2:w,conv256_down_out:E,fc:S},paramMappings:i}}(e)},t}(eO);var fP=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,i=t.maxNumScales,a=t.scoreThresholds,o=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=o,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(e){return"number"!==typeof e})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(e){return"number"!==typeof e}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function hP(e,t){function n(n,r,i,a,o){var s=kd(e(n*r*i*i),[i,i,n,r]),c=Id(e(r));return t.push({paramPath:a+"/filters"},{paramPath:a+"/"+(o?"batch_norm_offset":"bias")}),{filters:s,bias:c}}function r(e,t,r,i){var a=n(e,t,r,i,!0);return{filters:a.filters,batch_norm_offset:a.bias}}function i(n,i,a){var o=function(n,r){var i=kd(e(9*n),[3,3,n,1]),a=Id(e(n)),o=Id(e(n)),s=Id(e(n)),c=Id(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:i,batch_norm_scale:a,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:c}}(n,a+"/depthwise_conv");return{depthwise_conv:o,pointwise_conv:r(n,i,1,a+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function pP(e){var t=[],n=function(e,t){var n=BL(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function i(e){var t="mobilenetv1/conv_"+e,i="MobilenetV1/Conv2d_"+e+"_depthwise",a=t+"/depthwise_conv",o=t+"/pointwise_conv";return{depthwise_conv:{filters:n(i+"/depthwise_weights",4,a+"/filters"),batch_norm_scale:n(i+"/BatchNorm/gamma",1,a+"/batch_norm_scale"),batch_norm_offset:n(i+"/BatchNorm/beta",1,a+"/batch_norm_offset"),batch_norm_mean:n(i+"/BatchNorm/moving_mean",1,a+"/batch_norm_mean"),batch_norm_variance:n(i+"/BatchNorm/moving_variance",1,a+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,o)}}function a(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function o(e){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,i=n.extractPredictionLayerParams,a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!rL(a))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+a);var o={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:a}};return LL(e,t),{params:o,paramMappings:t}}function mP(e,t,n){return id((function(){var r=Yg(e,t.filters,n,"same");return r=Bv(r,t.batch_norm_offset),tg(r,0,6)}))}function gP(e,t){return id((function(){var n=null,r=mP(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var i=t+1,a=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(i);r=function(e,t,n){return id((function(){var r=Xg(e,t.filters,n,"same");return r=Fg(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),tg(r,0,6)}))}(r,e.depthwise_conv,a),r=mP(r,e.pointwise_conv,[1,1]),11===i&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function vP(e,t,n){var r=e.arraySync(),i=Math.min(r[t][0],r[t][2]),a=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),c=Math.min(r[n][0],r[n][2]),u=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),d=Math.max(r[n][1],r[n][3]),f=(o-i)*(s-a),h=(l-c)*(d-u);if(f<=0||h<=0)return 0;var p=Math.max(i,c),m=Math.max(a,u),g=Math.min(o,l),v=Math.min(s,d),y=Math.max(g-p,0)*Math.max(v-m,0);return y/(f+h-y)}function yP(e,t){var n=function(e){var t=Tf(vy(e,[1,0])),n=[ay(t[2],t[0]),ay(t[3],t[1])];return{sizes:n,centers:[Bv(t[0],Gv(n[0],Rd(2))),Bv(t[1],Gv(n[1],Rd(2)))]}}(e),r=n.sizes,i=n.centers,a=Tf(vy(t,[1,0])),o=Gv($v(ag(Gv(a[2],Rd(5))),r[0]),Rd(2)),s=Bv($v(Gv(a[0],Rd(10)),r[0]),i[0]),c=Gv($v(ag(Gv(a[3],Rd(5))),r[1]),Rd(2)),u=Bv($v(Gv(a[1],Rd(10)),r[1]),i[1]);return vy(Sf([ay(s,o),ay(u,c),Bv(s,o),Bv(u,c)]),[1,0])}function bP(e,t){return id((function(){var n=e.shape[0];return{boxPredictionEncoding:_f(ML(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:_f(ML(e,t.class_predictor),[n,-1,3])}}))}var _P=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),wP=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return Oc(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return id((function(){var n=e.toBatchTensor(512,!1).toFloat(),r=gP(ay($v(n,Rd(.007843137718737125)),Rd(1)),t.mobilenetv1),i=function(e,t,n){return id((function(){var r=mP(e,n.conv_0,[1,1]),i=mP(r,n.conv_1,[2,2]),a=mP(i,n.conv_2,[1,1]),o=mP(a,n.conv_3,[2,2]),s=mP(o,n.conv_4,[1,1]),c=mP(s,n.conv_5,[2,2]),u=mP(c,n.conv_6,[1,1]),l=mP(u,n.conv_7,[2,2]),d=bP(t,n.box_predictor_0),f=bP(e,n.box_predictor_1),h=bP(i,n.box_predictor_2),p=bP(o,n.box_predictor_3),m=bP(c,n.box_predictor_4),g=bP(l,n.box_predictor_5);return{boxPredictions:Fd([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:Fd([d.classPrediction,f.classPrediction,h.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return id((function(){var r=e.shape[0],i=yP(_f(Cf(n.extra_dim,[r,1,1]),[-1,4]),_f(e,[-1,4]));i=_f(i,[r,i.shape[0]/r,4]);var a=mg(dv(t,[0,0,1],[-1,-1,-1])),o=dv(a,[0,0,0],[-1,-1,1]);return o=_f(o,[r,o.shape[1]]),{boxes:Tf(i),scores:Tf(o)}}))}(i.boxPredictions,i.classPredictions,t.output_layer)}))},t.prototype.forward=function(e){return jc(this,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,$L(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),jc(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w;return Fc(this,(function(E){switch(E.label){case 0:return n=new _P(t),r=n.maxResults,i=n.minConfidence,[4,$L(e)];case 1:for(a=E.sent(),o=this.forwardInput(a),s=o.boxes,c=o.scores,u=s[0],l=c[0],d=1;d<s.length;d++)s[d].dispose(),c[d].dispose();return p=(h=Array).from,[4,l.data()];case 2:return f=p.apply(h,[E.sent()]),m=function(e,t,n,r,i){var a=e.shape[0],o=Math.min(n,a),s=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>i})).sort((function(e,t){return t.score-e.score})),c=function(e){return e<=r?1:0},u=[];return s.forEach((function(t){if(!(u.length>=o)){for(var n=t.score,r=u.length-1;r>=0;--r){var a=vP(e,t.boxIndex,u[r]);if(0!==a&&(t.score*=c(a),t.score<=i))break}n===t.score&&u.push(t.boxIndex)}})),u}(u,f,r,.5,i),g=a.getReshapedInputDimensions(0),v=a.inputSize,y=v/g.width,b=v/g.height,_=u.arraySync(),w=m.map((function(e){var t=[Math.max(0,_[e][0]),Math.min(1,_[e][2])].map((function(e){return e*b})),n=t[0],r=t[1],i=[Math.max(0,_[e][1]),Math.min(1,_[e][3])].map((function(e){return e*y})),o=i[0],s=i[1];return new mO(f[e],new vL(o,n,s-o,r-n),{height:a.getInputHeight(0),width:a.getInputWidth(0)})})),u.dispose(),l.dispose(),[2,w]}}))}))},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return pP(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=VL(e),r=n.extractWeights,i=n.getRemainingWeights,a=hP(r,t),o=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,c=o(),u=s(),l={extra_dim:Ad(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:c,prediction_layer:u,output_layer:l},paramMappings:t}}(e)},t}(eO);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Oc(t,e)}(wP);var EP=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return Oc(t,e),t}(fO),SP=function(){function e(){}return e.prototype.then=function(e){return jc(this,void 0,void 0,(function(){var t;return Fc(this,(function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}}))}))},e.prototype.run=function(){return jc(this,void 0,void 0,(function(){return Fc(this,(function(e){throw new Error("ComposableTask - run is not implemented")}))}))},e}();function CP(e,t){var n={descriptor:t};return Object.assign({},e,n)}function xP(e,t,n,r,i){return void 0===i&&(i=function(e){return e.alignedRect}),jc(this,void 0,void 0,(function(){var a,o,s,c,u;return Fc(this,(function(l){switch(l.label){case 0:return a=e.map((function(e){return PO(e)?i(e):e.detection})),(s=r)?[3,5]:t instanceof Hu?[4,ZO(t,a)]:[3,2];case 1:return c=l.sent(),[3,4];case 2:return[4,JO(t,a)];case 3:c=l.sent(),l.label=4;case 4:s=c,l.label=5;case 5:return[4,n(o=s)];case 6:return u=l.sent(),o.forEach((function(e){return e instanceof Hu&&e.dispose()})),[2,u]}}))}))}function TP(e,t,n,r,i){return jc(this,void 0,void 0,(function(){var a=this;return Fc(this,(function(o){return[2,xP([e],t,(function(e){return jc(a,void 0,void 0,(function(){return Fc(this,(function(t){return[2,n(e[0])]}))}))}),r,i)]}))}))}function RP(e){var t=VL(e),n=t.extractWeights,r=t.getRemainingWeights,i=[],a=function(e,t){var n=OL(e,t),r=PL(e,t);function i(n,r){var i=Id(e(n));return t.push({paramPath:r}),i}function a(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:i(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:i(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:i(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=a([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return Pc({},e,{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=a([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=i(128,"rnet/prelu4_alpha"),o=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return Pc({},e,{fc1:t,prelu4_alpha:n,fc2_1:o,fc2_2:s})},extractONetParams:function(){var e=a([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),o=i(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),c=i(256,"onet/prelu5_alpha"),u=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),d=r(256,10,"onet/fc2_3");return Pc({},e,{conv4:t,prelu4_alpha:o,fc1:s,prelu5_alpha:c,fc2_1:u,fc2_2:l,fc2_3:d})}}}(n,i),o=a.extractPNetParams,s=a.extractRNetParams,c=a.extractONetParams,u=o(),l=s(),d=c();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:u,rnet:l,onet:d},paramMappings:i}}function IP(e){var t=[],n=function(e,t){var n=BL(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function i(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function a(e){return n(e,1)}function o(e){return{conv1:r(e+"/conv1"),prelu1_alpha:a(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:a(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:a(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=o("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return Pc({},e,{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=o("rnet"),t=i("rnet/fc1"),n=a("rnet/prelu4_alpha"),r=i("rnet/fc2_1"),s=i("rnet/fc2_2");return Pc({},e,{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=o("onet"),t=r("onet/conv4"),n=a("onet/prelu4_alpha"),s=i("onet/fc1"),c=a("onet/prelu5_alpha"),u=i("onet/fc2_1"),l=i("onet/fc2_2"),d=i("onet/fc2_3");return Pc({},e,{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:c,fc2_1:u,fc2_2:l,fc2_3:d})}}}(e,t),r=n.extractPNetParams,i=n.extractRNetParams,a=n.extractONetParams,o=r(),s=i(),c=a();return LL(e,t),{params:{pnet:o,rnet:s,onet:c},paramMappings:t}}function NP(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var AP=function(e){function t(t,n,r,i){return e.call(this,{left:t,top:n,right:r,bottom:i},!0)||this}return Oc(t,e),t}(hL);function kP(e){return id((function(){return $v(ay(e,Rd(127.5)),Rd(.0078125))}))}function DP(e,t){return id((function(){return Bv(my(e),$v(t,dg(my(dg(e)))))}))}function MP(e,t,n){return void 0===n&&(n=!1),id((function(){var r=ML(e,t.conv1,"valid");return r=DP(r,t.prelu1_alpha),r=DP(r=ML(r=cv(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),r=DP(r=ML(r=n?r:cv(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)}))}function LP(e,t,n,r,i){i.stage1=[];var a=t.map((function(t){return id((function(){var n={scale:t},i=function(e,t){return id((function(){var n=NP(t,e.shape.slice(1)),r=n.height,i=n.width,a=kP(ub.resizeBilinear(e,[r,i]));return vy(a,[0,2,1,3])}))}(e,t),a=Date.now(),o=function(e,t){return id((function(){var n=MP(e,t,!0),r=ML(n,t.conv4_1,"valid"),i=cf(Ev(r,3),3);return{prob:Vf(ay(r,i),3),regions:ML(n,t.conv4_2,"valid")}}))}(i,r),s=o.prob,c=o.regions;return n.pnet=Date.now()-a,{scoresTensor:Tf(Tf(s,3)[1])[0],regionsTensor:Tf(c)[0],scale:t,statsForScale:n}}))})),o=a.map((function(e){var t=e.scoresTensor,r=e.regionsTensor,a=e.scale,o=e.statsForScale,s=function(e,t,n,r){for(var i=[],a=e.arraySync(),o=0;o<e.shape[0];o++)for(var s=0;s<e.shape[1];s++)a[o][s]>=r&&i.push(new tL(s,o));return i.map((function(e){var r=new pL(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),i=a[e.y][e.x],o=t.arraySync();return{cell:r,score:i,region:new AP(o[e.y][e.x][0],o[e.y][e.x][1],o[e.y][e.x][2],o[e.y][e.x][3])}}))}(t,r,a,n);if(t.dispose(),r.dispose(),!s.length)return i.stage1.push(o),[];var c=Date.now(),u=nO(s.map((function(e){return e.cell})),s.map((function(e){return e.score})),.5);return o.nms=Date.now()-c,o.numBoxes=u.length,i.stage1.push(o),u.map((function(e){return s[e]}))})),s=o.reduce((function(e,t){return e.concat(t)}),[]),c=[],u=[];if(s.length>0){var l=Date.now(),d=nO(s.map((function(e){return e.cell})),s.map((function(e){return e.score})),.7);i.stage1_nms=Date.now()-l,u=d.map((function(e){return s[e].score})),c=d.map((function(e){return s[e]})).map((function(e){var t=e.cell,n=e.region;return new pL(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()}))}return{boxes:c,scores:u}}function OP(e,t,n){var r=n.width,i=n.height;return jc(this,void 0,void 0,(function(){var n,a,o,s=this;return Fc(this,(function(c){switch(c.label){case 0:return n=IL(e),[4,Promise.all(t.map((function(t){return jc(s,void 0,void 0,(function(){var r,i,a,o,s,c,u,l;return Fc(this,(function(d){return r=t.padAtBorders(e.height,e.width),i=r.y,a=r.ey,o=r.x,s=r.ex,c=o-1,u=i-1,l=n.getImageData(c,u,s-c,a-u),[2,TL.isNodejs()?YL(l):createImageBitmap(l)]}))}))})))];case 1:return a=c.sent(),o=[],a.forEach((function(e){var t=IL(HL({width:r,height:i}));t.drawImage(e,0,0,r,i);for(var n=t.getImageData(0,0,r,i).data,a=[],s=0;s<n.length;s+=4)a.push(n[s+2]),a.push(n[s+1]),a.push(n[s]);o.push(a)})),[2,o.map((function(e){return id((function(){return kP(vy(kd(e,[1,r,i,3]),[0,2,1,3]).toFloat())}))}))]}}))}))}function PP(e,t,n,r,i){return jc(this,void 0,void 0,(function(){var a,o,s,c,u,l,d,f,h,p,m,g,v,y;return Fc(this,(function(b){switch(b.label){case 0:return a=Date.now(),[4,OP(e,t,{width:24,height:24})];case 1:return o=b.sent(),i.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=o.map((function(e){var t=function(e,t){return id((function(){var n=MP(e,t),r=DP(TO(_f(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),i=TO(r,t.fc2_1),a=cf(Ev(i,1),1),o=Vf(ay(i,a),1),s=TO(r,t.fc2_2);return{scores:Tf(o,1)[1],regions:s}}))}(e,r);return e.dispose(),t})),i.stage2_rnet=Date.now()-a,c=s.length>1?Fd(s.map((function(e){return e.scores}))):s[0].scores,d=(l=Array).from,[4,c.data()];case 2:return u=d.apply(l,[b.sent()]),c.dispose(),f=u.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),h=f.map((function(e){return t[e]})),p=f.map((function(e){return u[e]})),m=[],g=[],h.length>0&&(a=Date.now(),v=nO(h,p,.7),i.stage2_nms=Date.now()-a,y=v.map((function(e){var t=s[f[e]].regions.arraySync();return new AP(t[0][0],t[0][1],t[0][2],t[0][3])})),g=v.map((function(e){return p[e]})),m=v.map((function(e,t){return h[e].calibrate(y[t])}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose()})),[2,{boxes:m,scores:g}]}}))}))}function jP(e,t,n,r,i){return jc(this,void 0,void 0,(function(){var a,o,s,c,u,l,d,f,h,p,m,g,v,y,b;return Fc(this,(function(_){switch(_.label){case 0:return a=Date.now(),[4,OP(e,t,{width:48,height:48})];case 1:return o=_.sent(),i.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=o.map((function(e){var t=function(e,t){return id((function(){var n=MP(e,t);n=DP(n=ML(n=cv(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=DP(TO(_f(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),i=TO(r,t.fc2_1),a=cf(Ev(i,1),1),o=Vf(ay(i,a),1),s=TO(r,t.fc2_2),c=TO(r,t.fc2_3);return{scores:Tf(o,1)[1],regions:s,points:c}}))}(e,r);return e.dispose(),t})),i.stage3_onet=Date.now()-a,c=s.length>1?Fd(s.map((function(e){return e.scores}))):s[0].scores,d=(l=Array).from,[4,c.data()];case 2:return u=d.apply(l,[_.sent()]),c.dispose(),f=u.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),h=f.map((function(e){var t=s[e].regions.arraySync();return new AP(t[0][0],t[0][1],t[0][2],t[0][3])})),p=f.map((function(e,n){return t[e].calibrate(h[n])})),m=f.map((function(e){return u[e]})),g=[],v=[],y=[],p.length>0&&(a=Date.now(),b=nO(p,m,.7,!1),i.stage3_nms=Date.now()-a,g=b.map((function(e){return p[e]})),v=b.map((function(e){return m[e]})),y=b.map((function(e,t){return Array(5).fill(0).map((function(n,r){var i=s[e].points.arraySync();return new tL(i[0][r]*(g[t].width+1)+g[t].left,i[0][r+5]*(g[t].height+1)+g[t].top)}))}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()})),[2,{boxes:g,scores:v,points:y}]}}))}))}var FP=function(e){function t(){return e.call(this,"Mtcnn")||this}return Oc(t,e),t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),jc(this,void 0,void 0,(function(){var n,r,i,a,o,s,c,u,l,d,f,h,p,m,g,v,y,b,_,w,E;return Fc(this,(function(S){switch(S.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},a=Date.now(),o=id((function(){return e=cf(u_.fromPixels(r)).toFloat(),id((function(){return Sf(Tf(e,3).reverse(),3)}));var e})),s=function(e){return o.dispose(),i.total=Date.now()-a,e},c=o.shape.slice(1),u=c[0],l=c[1],d=new fP(t),f=d.minFaceSize,h=d.scaleFactor,p=d.maxNumScales,m=d.scoreThresholds,g=d.scaleSteps,v=(g||function(e,t,n){for(var r=n[0],i=n[1],a=12/e,o=[],s=Math.min(r,i)*a,c=0;s>=12;)o.push(a*Math.pow(t,c)),s*=t,c+=1;return o}(f,h,[u,l])).filter((function(e){var t=NP(e,[u,l]);return Math.min(t.width,t.height)>12})).slice(0,p),i.scales=v,i.pyramid=v.map((function(e){return NP(e,[u,l])})),y=Date.now(),[4,LP(o,v,m[0],n.pnet,i)];case 1:return b=S.sent(),i.total_stage1=Date.now()-y,b.boxes.length?(i.stage2_numInputBoxes=b.boxes.length,y=Date.now(),[4,PP(r,b.boxes,m[1],n.rnet,i)]):[2,s({results:[],stats:i})];case 2:return _=S.sent(),i.total_stage2=Date.now()-y,_.boxes.length?(i.stage3_numInputBoxes=_.boxes.length,y=Date.now(),[4,jP(r,_.boxes,m[2],n.onet,i)]):[2,s({results:[],stats:i})];case 3:return w=S.sent(),i.total_stage3=Date.now()-y,E=w.boxes.map((function(e,t){return jO(vO({},new mO(w.scores[t],new vL(e.left/l,e.top/u,e.width/l,e.height/u),{height:u,width:l})),new KO(w.points[t].map((function(t){return t.sub(new tL(e.left,e.top)).div(new tL(e.width,e.height))})),{width:e.width,height:e.height}))})),[2,s({results:E,stats:i})]}}))}))},t.prototype.forward=function(e,t){return void 0===t&&(t={}),jc(this,void 0,void 0,(function(){var n;return Fc(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,$L(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}}))}))},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),jc(this,void 0,void 0,(function(){var n;return Fc(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,$L(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}}))}))},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return IP(e)},t.prototype.extractParams=function(e){return RP(e)},t}(eO),UP=[new tL(1.603231,2.094468),new tL(6.041143,7.080126),new tL(2.882459,3.518061),new tL(4.266906,5.178857),new tL(9.041765,10.66308)],BP=[117.001,114.697,97.404],VP=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:UP,meanRgb:BP,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return Oc(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return jc(this,void 0,void 0,(function(){return Fc(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new mO(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(hO),zP=[new tL(.738768,.874946),new tL(2.42204,2.65704),new tL(4.30971,7.04493),new tL(10.246,4.59428),new tL(12.6868,11.8741)],WP=[new tL(1.603231,2.094468),new tL(6.041143,7.080126),new tL(2.882459,3.518061),new tL(4.266906,5.178857),new tL(9.041765,10.66308)],GP=[117.001,114.697,97.404],HP=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:WP,meanRgb:GP}:{anchors:zP,withClassScores:!0});return e.call(this,n)||this}return Oc(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return jc(this,void 0,void 0,(function(){return Fc(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new mO(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(hO);var YP={ssdMobilenetv1:new wP,tinyFaceDetector:new VP,tinyYolov2:new HP,mtcnn:new FP,faceLandmark68Net:new eP,faceLandmark68TinyNet:new nP,faceRecognitionNet:new dP,faceExpressionNet:new kO,ageGenderNet:new qO};function qP(e,t){var n={age:t};return Object.assign({},e,n)}function KP(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var XP=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.extractedFaces=r,i}return Oc(t,e),t}(SP),QP=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.run=function(){return jc(this,void 0,void 0,(function(){var e,t,n=this;return Fc(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,xP(e=r.sent(),this.input,(function(e){return jc(n,void 0,void 0,(function(){return Fc(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return YP.faceExpressionNet.predictExpressions(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){return DO(e,t[n])}))]}}))}))},t.prototype.withAgeAndGender=function(){return new tj(this,this.input)},t}(XP),JP=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.run=function(){return jc(this,void 0,void 0,(function(){var e,t;return Fc(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,TP(e,this.input,(function(e){return YP.faceExpressionNet.predictExpressions(e)}),this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,DO(e,t)]}}))}))},t.prototype.withAgeAndGender=function(){return new nj(this,this.input)},t}(XP),ZP=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.withAgeAndGender=function(){return new rj(this,this.input)},t.prototype.withFaceDescriptors=function(){return new oj(this,this.input)},t}(QP),$P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.withAgeAndGender=function(){return new ij(this,this.input)},t.prototype.withFaceDescriptor=function(){return new sj(this,this.input)},t}(JP),ej=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.extractedFaces=r,i}return Oc(t,e),t}(SP),tj=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.run=function(){return jc(this,void 0,void 0,(function(){var e,t,n=this;return Fc(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,xP(e=r.sent(),this.input,(function(e){return jc(n,void 0,void 0,(function(){return Fc(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return YP.ageGenderNet.predictAgeAndGender(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){var r=t[n],i=r.age;return qP(KP(e,r.gender,r.genderProbability),i)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new QP(this,this.input)},t}(ej),nj=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.run=function(){return jc(this,void 0,void 0,(function(){var e,t,n,r,i;return Fc(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?[4,TP(e,this.input,(function(e){return YP.ageGenderNet.predictAgeAndGender(e)}),this.extractedFaces)]:[2];case 2:return t=a.sent(),n=t.age,r=t.gender,i=t.genderProbability,[2,qP(KP(e,r,i),n)]}}))}))},t.prototype.withFaceExpressions=function(){return new JP(this,this.input)},t}(ej),rj=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.withFaceExpressions=function(){return new ZP(this,this.input)},t.prototype.withFaceDescriptors=function(){return new oj(this,this.input)},t}(tj),ij=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.withFaceExpressions=function(){return new $P(this,this.input)},t.prototype.withFaceDescriptor=function(){return new sj(this,this.input)},t}(nj),aj=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return Oc(t,e),t}(SP),oj=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.run=function(){return jc(this,void 0,void 0,(function(){var e;return Fc(this,(function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,xP(e=t.sent(),this.input,(function(e){return Promise.all(e.map((function(e){return YP.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,t.sent().map((function(t,n){return CP(e[n],t)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new ZP(this,this.input)},t.prototype.withAgeAndGender=function(){return new rj(this,this.input)},t}(aj),sj=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.run=function(){return jc(this,void 0,void 0,(function(){var e,t;return Fc(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,TP(e,this.input,(function(e){return YP.faceRecognitionNet.computeFaceDescriptor(e)}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))]:[2];case 2:return t=n.sent(),[2,CP(e,t)]}}))}))},t.prototype.withFaceExpressions=function(){return new $P(this,this.input)},t.prototype.withAgeAndGender=function(){return new ij(this,this.input)},t}(aj),cj=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.useTinyLandmarkNet=r,i}return Oc(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?YP.faceLandmark68TinyNet:YP.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(SP),uj=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.run=function(){return jc(this,void 0,void 0,(function(){var e,t,n,r,i,a=this;return Fc(this,(function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),t=e.map((function(e){return e.detection})),this.input instanceof Hu?[4,ZO(this.input,t)]:[3,3];case 2:return r=o.sent(),[3,5];case 3:return[4,JO(this.input,t)];case 4:r=o.sent(),o.label=5;case 5:return n=r,[4,Promise.all(n.map((function(e){return a.landmarkNet.detectLandmarks(e)})))];case 6:return i=o.sent(),n.forEach((function(e){return e instanceof Hu&&e.dispose()})),[2,e.map((function(e,t){return jO(e,i[t])}))]}}))}))},t.prototype.withFaceExpressions=function(){return new ZP(this,this.input)},t.prototype.withAgeAndGender=function(){return new rj(this,this.input)},t.prototype.withFaceDescriptors=function(){return new oj(this,this.input)},t}(cj),lj=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.run=function(){return jc(this,void 0,void 0,(function(){var e,t,n,r,i;return Fc(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?(t=e.detection,this.input instanceof Hu?[4,ZO(this.input,[t])]:[3,3]):[2];case 2:return r=a.sent(),[3,5];case 3:return[4,JO(this.input,[t])];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return i=a.sent(),n.forEach((function(e){return e instanceof Hu&&e.dispose()})),[2,jO(e,i)]}}))}))},t.prototype.withFaceExpressions=function(){return new $P(this,this.input)},t.prototype.withAgeAndGender=function(){return new ij(this,this.input)},t.prototype.withFaceDescriptor=function(){return new sj(this,this.input)},t}(cj),dj=function(e){function t(t,n){void 0===n&&(n=new _P);var r=e.call(this)||this;return r.input=t,r.options=n,r}return Oc(t,e),t}(SP),fj=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Oc(t,e),t.prototype.run=function(){return jc(this,void 0,void 0,(function(){var e,t,n,r;return Fc(this,(function(i){switch(i.label){case 0:return t=(e=this).input,(n=e.options)instanceof fP?[4,YP.mtcnn.forward(t,n)]:[3,2];case 1:return[2,i.sent().map((function(e){return e.detection}))];case 2:if(r=n instanceof EP?function(e){return YP.tinyFaceDetector.locateFaces(e,n)}:n instanceof _P?function(e){return YP.ssdMobilenetv1.locateFaces(e,n)}:n instanceof fO?function(e){return YP.tinyYolov2.locateFaces(e,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}}))}))},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise((function(t){return jc(e,void 0,void 0,(function(){var e;return Fc(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map((function(e){return vO({},e)})))]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new uj(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new QP(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new tj(this.runAndExtendWithFaceDetections(),this.input)},t}(dj);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Oc(t,e),t.prototype.run=function(){return jc(this,void 0,void 0,(function(){var e,t;return Fc(this,(function(n){switch(n.label){case 0:return[4,new fj(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach((function(e){e.score>t.score&&(t=e)})),[2,t]}}))}))},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise((function(t){return jc(e,void 0,void 0,(function(){var e;return Fc(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?vO({},e):void 0)]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new lj(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new JP(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new nj(this.runAndExtendWithFaceDetection(),this.input)}}(dj);!function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,i=function(){return"person "+r++};this._labeledDescriptors=n.map((function(e){if(e instanceof QO)return e;if(e instanceof Float32Array)return new QO(i(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new QO(i(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map((function(t){return function(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map((function(e,t){return e-r[t]})).reduce((function(e,t){return e+Math.pow(t,2)}),0))}(t,e)})).reduce((function(e,t){return e+t}),0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map((function(n){var r=n.descriptors,i=n.label;return new XO(i,t.computeMeanDistance(e,r))})).reduce((function(e,t){return e.distance<t.distance?e:t}))},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new XO("unknown",t.distance)}}();Pc({},r,i);var hj=n(1635),pj=n.n(hj);const mj=(0,a.createContext)(),gj=()=>{const e=(0,a.useContext)(mj);if(!e)throw new Error("useCallMinimize must be used within a CallMinimizeProvider");return e},vj=e=>{let{children:t}=e;const[n,r]=(0,a.useState)([]),i=(0,a.useCallback)((e=>{r((t=>[...t.filter((t=>t.id!==e.id)),e]))}),[]),o=(0,a.useCallback)((e=>{r((t=>t.filter((t=>t.id!==e))))}),[]),s=(0,a.useCallback)((e=>{r((t=>t.filter((t=>t.id!==e))))}),[]),c=(0,a.useCallback)(((e,t)=>{r((n=>n.map((n=>n.id===e?d(d({},n),t):n))))}),[]),u=(0,a.useCallback)((e=>n.find((t=>t.id===e))),[n]),l={minimizedCalls:n,minimizeCall:i,restoreCall:o,endMinimizedCall:s,updateMinimizedCall:c,getMinimizedCall:u};return(0,kt.jsx)(mj.Provider,{value:l,children:t})},yj=e=>{let{friendProfile:t,isActive:n,room:r,lastSeen:i,friendProfilePic:o}=e;const[s,c]=(0,a.useState)(!1),[u,l]=(0,a.useState)(!1),[d,f]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[m,g]=(0,a.useState)(o),[v,y]=(0,a.useState)(!0),[b,_]=(0,a.useState)(!1),[w,E]=(0,a.useState)(!0),[S,C]=(0,a.useState)(!1),[x,T]=(0,a.useState)(""),[R,I]=(0,a.useState)(!1),[N,A]=(0,a.useState)(),[k,D]=(0,a.useState)(!1),[M,L]=(0,a.useState)(null),[O,P]=(0,a.useState)(!1),[j,F]=(0,a.useState)(null),[U,B]=(0,a.useState)(!1),[V,z]=(0,a.useState)(!1),[W,G]=(0,a.useState)(!1),[H,Y]=(0,a.useState)(0),q=(0,a.useRef)(null),K=(0,a.useRef)(null),X=He(),Q=(0,a.useRef)(),J=(0,a.useRef)(),Z=(0,a.useRef)(),$=(0,a.useRef)(),ee=(0,a.useRef)(pj().createClient({mode:"rtc",codec:"vp8"})).current,te=(0,a.useRef)([]),ne=(0,a.useRef)(!1),re=(0,a.useRef)(!1),ie=((0,a.useRef)(),(0,a.useRef)(),(0,a.useRef)(null)),ae=(0,a.useRef)(null),oe=wa(),se=qe(),ce=En((e=>e.setting)),ue=En((e=>e.profile)),le=ue._id,{minimizeCall:de,restoreCall:fe,endMinimizedCall:he,updateMinimizedCall:pe}=gj(),me=oe?{width:56,height:56,borderRadius:"50%",padding:0,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 6px 16px rgba(0,0,0,0.35)",border:"1px solid rgba(255,255,255,0.08)",boxSizing:"border-box",overflow:"hidden",flexShrink:0,flexBasis:56}:{},ge=async e=>{const{data:t}=await pa.post("/agora/token",{channelName:e,uid:le});return t},ve=(0,a.useCallback)((async()=>{const e=te.current.find((e=>"audio"===e.kind));e?(console.log("Toggling microphone. Current state:",v,"New state:",!v),console.log("Audio track found:",e),console.log("Audio track kind:",e.kind),await e.setEnabled(!v),console.log("Audio track enabled state after toggle:",e.enabled)):(console.log("No audio track found in tracks:",te.current),te.current[0]&&(console.log("Using fallback - index 0 track:",te.current[0]),await te.current[0].setEnabled(!v))),y((e=>!e))}),[v]),ye=(0,a.useCallback)((async()=>{const e=te.current.find((e=>"video"===e.kind));e?(console.log("Toggling camera. Current state:",w,"New state:",!w),console.log("Video track found:",e),console.log("Video track kind:",e.kind),await e.setEnabled(!w),console.log("Video track enabled state after toggle:",e.enabled)):(console.log("No video track found in tracks:",te.current),te.current[1]&&(console.log("Using fallback - index 1 track:",te.current[1]),await te.current[1].setEnabled(!w))),E((e=>!e))}),[w]),be=()=>{null===$||void 0===$||$.current.play()},_e=()=>{null===$||void 0===$||$.current.pause()};(0,a.useEffect)((()=>{if(k||S)try{Ne()}catch(Vc){}}),[k,S]),(0,a.useEffect)((()=>{let e=null;return S&&!W&&(q.current||(q.current=Date.now()),e=setInterval((()=>{const e=Math.floor((Date.now()-q.current)/1e3);Y(e)}),1e3)),()=>{e&&clearInterval(e)}}),[S,W]),(0,a.useEffect)((()=>{if(S&&W&&j&&q.current){const e="chatheader-video-".concat(j);ae.current=setInterval((()=>{const t=Math.floor((Date.now()-q.current)/1e3);try{pe(e,{duration:t})}catch(Vc){}}),1e3)}return()=>{ae.current&&(clearInterval(ae.current),ae.current=null)}}),[S,W,j]),(0,a.useEffect)((()=>{const e=()=>{try{Ne()}catch(Vc){}};return window.addEventListener("stopEmotionCamera",e),()=>window.removeEventListener("stopEmotionCamera",e)}),[]);const we=(0,a.useCallback)((async e=>{try{console.log("Starting Agora call with channel:",e),C(!0),F(e),q.current||(q.current=Date.now());const{appId:n,token:r}=await ge(e);console.log("Got Agora token for channel:",e),ne.current?console.warn("Join skipped: client already joining/joined"):(ne.current=!0,await ee.join(n,e,r,le),console.log("Joined Agora channel successfully"),setTimeout((()=>{const e=ee.remoteUsers;console.log("ChatHeader - Immediate check - Remote users in channel:",e.length),e.forEach((e=>{console.log("ChatHeader - Remote user details:",{uid:e.uid,hasVideo:e.hasVideo,hasAudio:e.hasAudio})}))}),500));try{Ne()}catch(Vc){}if(te.current&&0!==te.current.length)console.log("Using existing local tracks");else{try{te.current=await pj().createMicrophoneAndCameraTracks()}catch(t){console.error("createMicrophoneAndCameraTracks failed, falling back to mic only:",t),te.current=[await pj().createMicrophoneAudioTrack()]}console.log("Created local tracks:",te.current),console.log("Audio track (index 0):",te.current[0]),console.log("Audio track type:",te.current[0].trackMediaType),console.log("Audio track kind:",te.current[0].kind),console.log("Video track (index 1):",te.current[1]),console.log("Video track type:",te.current[1].trackMediaType),console.log("Video track kind:",te.current[1].kind),Q.current&&(te.current[1].play(Q.current),console.log("Playing local video"))}await ee.publish(te.current),console.log("Published local tracks"),re.current||(re.current=!0,ee.on("user-published",(async(e,t)=>{console.log("ChatHeader - Remote user published:",e.uid,t);try{await ee.subscribe(e,t),console.log("ChatHeader - Successfully subscribed to",e.uid,t),"video"===t&&(J.current&&e.videoTrack?(J.current.innerHTML="",e.videoTrack.play(J.current),console.log("ChatHeader - Playing remote video from user:",e.uid)):console.warn("ChatHeader - Cannot play remote video - missing userVideo ref or videoTrack")),"audio"===t&&(e.audioTrack?(e.audioTrack.play(),console.log("ChatHeader - Playing remote audio from user:",e.uid)):console.warn("ChatHeader - Cannot play remote audio - missing audioTrack"))}catch(n){console.error("ChatHeader - Error subscribing to user:",e.uid,t,n)}})),ee.on("user-unpublished",(e=>{console.log("ChatHeader - Remote user unpublished:",e.uid),J.current&&(J.current.innerHTML="")}))),setTimeout((async()=>{try{const e=ee.remoteUsers;console.log("ChatHeader - Checking for existing remote users:",e.length);for(const t of e)console.log("ChatHeader - Found existing remote user:",t.uid,"hasVideo:",t.hasVideo,"hasAudio:",t.hasAudio),t.hasVideo&&!t.videoTrack?(console.log("ChatHeader - Subscribing to existing user video:",t.uid),await ee.subscribe(t,"video"),J.current&&t.videoTrack&&(t.videoTrack.play(J.current),console.log("ChatHeader - Playing existing remote user video"))):t.hasVideo&&t.videoTrack&&J.current&&(t.videoTrack.play(J.current),console.log("ChatHeader - Playing already subscribed remote video")),t.hasAudio&&!t.audioTrack?(console.log("ChatHeader - Subscribing to existing user audio:",t.uid),await ee.subscribe(t,"audio"),t.audioTrack&&(t.audioTrack.play(),console.log("ChatHeader - Playing existing remote user audio"))):t.hasAudio&&t.audioTrack&&(t.audioTrack.play(),console.log("ChatHeader - Playing already subscribed remote audio"))}catch(e){console.error("ChatHeader - Error checking for existing remote users:",e)}}),1e3);let i=0;const a=5;ie.current=setInterval((async()=>{i++;try{const e=ee.remoteUsers;if(e.length>0){console.log("ChatHeader - Periodic check ".concat(i,": Found ").concat(e.length," remote users"));for(const t of e)if(t.hasVideo&&t.videoTrack&&J.current){const e=J.current.querySelector("video");e&&!e.paused&&0!==e.readyState||(console.log("ChatHeader - Periodic check ".concat(i,": Re-attempting to play remote video for user ").concat(t.uid)),J.current.innerHTML="",t.videoTrack.play(J.current))}}i>=a&&(clearInterval(ie.current),ie.current=null,console.log("ChatHeader - Stopped periodic remote user checks"))}catch(e){console.error("ChatHeader - Error in periodic check ".concat(i,":"),e)}}),2e3)}catch(n){console.error("Failed to start call:",n),alert("Failed to start call. Please try again."),D(!1),C(!1),ne.current=!1}}),[ee,le,ge]),Ee=(0,a.useCallback)((async e=>{_e();try{console.log("Starting local video for call answer"),te.current=await pj().createMicrophoneAndCameraTracks(),Q.current&&te.current[1]&&(te.current[1].play(Q.current),console.log("Local video started immediately"))}catch(t){console.error("Failed to start local video immediately:",t)}Jo.emit("agora-answer-call",{to:e.from,channelName:e.channelName}),await we(e.channelName)}),[we]);(0,a.useEffect)((()=>(Jo.on("agora-incoming-call",(e=>{let{from:t,channelName:n,isAudio:r,callerName:i,callerProfilePic:a}=e;r||(console.log("Incoming Agora video call from",t,"channel:",n),console.log("Caller info:",{callerName:i,callerProfilePic:a}),L({from:t,channelName:n,name:i||"Unknown Caller",profilePic:a}),D(!0),be())})),Jo.on("agora-apply-video-filter",(e=>{let{filter:t}=e;B(""!==t?t:"")})),Jo.on("agora-call-accepted",(e=>{let{channelName:t,isAudio:n}=e;n||(_e(),we(t))})),Jo.on("videoCallEnd",(()=>{var e;null===(e=Z.current)||void 0===e||e.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!1}))})),null===$||void 0===$||$.current.setAttribute("src","https://programmerikram.com/wp-content/uploads/2025/05/calling-beep.mp3"),()=>{Jo.off("agora-incoming-call"),Jo.off("agora-call-accepted"),Jo.off("videoCallEnd"),Jo.off("agora-apply-video-filter")})),[we]);const Se=(0,a.useCallback)((async e=>{if(!e)return;const t="".concat(le,"-").concat(e);F(t),console.log("Initiating Agora call to:",e,"with channel:",t);try{console.log("Starting local video for outgoing call"),te.current=await pj().createMicrophoneAndCameraTracks(),Q.current&&te.current[1]&&(te.current[1].play(Q.current),console.log("Local video started for outgoing call"))}catch(n){console.error("Failed to start local video for outgoing call:",n)}Jo.emit("agora-video-call",{to:e,channelName:t}),be()}),[le]),Ce=(0,a.useCallback)((e=>{const t=e.currentTarget.dataset.id;A(t),L(null),D(!0),Se(t)}),[Se]),xe=(0,a.useCallback)((e=>{var n,r;const i=e.currentTarget.dataset.id;A(i),L(null),D(!1);const a="".concat(le,"-").concat(i);window.dispatchEvent(new CustomEvent("startAudioCall",{detail:{to:i,channelName:a,callerName:t.fullName||"".concat(null===(n=t.user)||void 0===n?void 0:n.firstName," ").concat(null===(r=t.user)||void 0===r?void 0:r.surname)||"Friend",callerProfilePic:t.profilePic}})),Jo.emit("agora-audio-call",{to:i,channelName:a,isAudio:!0})}),[le,t]),Te=(0,a.useCallback)((async()=>{if(_e(),Jo.emit("leaveVideoCall",d),ie.current&&(clearInterval(ie.current),ie.current=null),j){const e="chatheader-video-".concat(j);he(e)}te.current.forEach((e=>e.close())),te.current=[];try{await ee.leave()}catch(Vc){console.log("Leave skipped or already left")}ne.current=!1,q.current=null,Q.current&&(Q.current.innerHTML=""),J.current&&(J.current.innerHTML=""),C(!1),D(!1),F(null),G(!1),Y(0),ae.current&&(clearInterval(ae.current),ae.current=null)}),[d,ee,j,he]),Re=(0,a.useCallback)((()=>{var e,n;if(!S||!j)return;const r={id:"chatheader-video-".concat(j),type:"video",callerName:(null===t||void 0===t?void 0:t.fullName)||"".concat(null===t||void 0===t||null===(e=t.user)||void 0===e?void 0:e.firstName," ").concat(null===t||void 0===t||null===(n=t.user)||void 0===n?void 0:n.surname)||"Unknown Caller",callerProfilePic:null===t||void 0===t?void 0:t.profilePic,callerId:d,status:"connected",duration:H,isMuted:!v,isCameraOn:w,onRestore:()=>{G(!1),D(!0)},onEnd:()=>{Te()},onToggleMute:()=>{ve()},onToggleCamera:()=>{ye()}};de(r),G(!0),D(!1)}),[S,j,t,d,H,v,w,de,ve,ye,Te]),Ie=(0,a.useCallback)((async()=>{if(K.current)try{const e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});K.current.srcObject=e}catch(K$){console.error("Failed to start hidden camera for emotion",K$)}}),[]),Ne=()=>{var e;if(!K.current)return;const t=null===(e=K.current)||void 0===e?void 0:e.srcObject;null===t||void 0===t||t.getTracks().forEach((e=>e.stop())),K.current.srcObject=null},Ae=()=>{setTimeout((()=>{setInterval((async()=>{if(null!==K&&void 0!==K&&K.current){const n=await(e=K.current,t=new EP,void 0===t&&(t=new _P),new fj(e,t)).withFaceExpressions();if(n.length>0){const e=n[0].expressions,t=Object.entries(e).reduce(((e,t)=>e[1]>t[1]?e:t))[0];r&&u!==t&&l(t)}}var e,t}),100)}),3e3)},ke=(0,a.useCallback)((async()=>{await YP.tinyFaceDetector.loadFromUri("/models"),await YP.faceExpressionNet.loadFromUri("/models"),Ae()}),[]);(0,a.useEffect)((()=>{T(ue._id)}),[ue]);const De=(0,a.useCallback)((()=>{Jo.emit("bump",{friendProfile:t._id,myProfile:ue._id})}),[t,ue]);(0,a.useEffect)((()=>{r&&ce.isShareEmotion&&(Ie(),ke())}),[r,ce.isShareEmotion,Ie,ke]),(0,a.useEffect)((()=>{Ne()}),[X]),(0,a.useEffect)((()=>()=>{ie.current&&(clearInterval(ie.current),ie.current=null)}),[]),(0,a.useEffect)((()=>{f(t._id),p(!!t._id),g(t.profilePic),Jo.emit("last_emotion",{friendId:t._id,profileId:le})}),[t,le]),(0,a.useEffect)((()=>{Ns(m)?Fn(m,(()=>{})):g("")}),[m]),(0,a.useEffect)((()=>{u&&d&&Jo.emit("emotion_change",{profileId:le,emotion:u,friendId:d})}),[u,d,le]),(0,a.useEffect)((()=>{const e=e=>c(e),t=e=>c(e.lastEmotion&&" L: ".concat(e.lastEmotion));return Jo.on("emotion_change",e),Jo.on("last_emotion",t),()=>{Jo.off("emotion_change",e),Jo.off("last_emotion",t)}}),[]);(0,a.useCallback)((async()=>{const e=te.current.find((e=>"video"===e.kind));if(e&&S)try{await ee.unpublish([e]),e.close();const t=await pj().createCameraVideoTrack({facingMode:b?"user":"environment"}),n=te.current.findIndex((e=>"video"===e.kind));-1!==n&&(te.current[n]=t),await ee.publish([t]),Q.current&&t.play(Q.current),_((e=>!e))}catch(t){console.error("Failed to switch camera:",t)}else _((e=>!e))}),[b,S,ee]);const Me=(0,a.useCallback)((()=>{const e=["video-vivid-filter","video-vivid-warm","video-vivid-cool","video-vivid-dramatic",""],t=e.indexOf(V),n=e[(t+1)%e.length];z(n),Jo.emit("agora-filter-video",{to:d,filter:n})}),[V,d]),Le=(0,a.useCallback)((async()=>{if(O)try{document.fullscreenElement?await document.exitFullscreen():document.webkitFullscreenElement?await document.webkitExitFullscreen():document.mozFullScreenElement?await document.mozCancelFullScreen():document.msFullscreenElement&&await document.msExitFullscreen(),P(!1)}catch(K$){console.error("Failed to exit fullscreen:",K$),P(!1)}else try{const e=document.getElementById("videoCallModal");e&&e.requestFullscreen?await e.requestFullscreen():e&&e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e&&e.mozRequestFullScreen?await e.mozRequestFullScreen():e&&e.msRequestFullscreen&&await e.msRequestFullscreen(),P(!0)}catch(K$){console.error("Failed to enter fullscreen:",K$),P(!0)}}),[O]);(0,a.useEffect)((()=>{const e=()=>{const e=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);P(e)};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)}}),[]);const Oe=(0,a.useRef)(null);(0,a.useEffect)((()=>{const e=e=>{Oe.current&&!Oe.current.contains(e.target)&&I(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);const Pe=(0,a.useCallback)((()=>I((e=>!e))),[]),je=(0,a.useCallback)((async()=>{200===(await pa.post("friend/block",{friendId:d})).status&&alert("User Blocked")}),[d]),Fe=(0,a.useCallback)((async()=>{200===(await pa.post("friend/unblock",{friendId:d})).status&&alert("User unblocked")}),[d]),Ue=(0,a.useCallback)((()=>se("/".concat(d))),[se,d]);return(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsxs)("div",{className:"chat-header-user ".concat("skleton-card"),children:[(0,kt.jsx)("div",{className:"chat-header-profilePic",children:h?(0,kt.jsx)(Un,{profilePic:"".concat(m),hasStory:!1,profile:t._id,active:t.isActive}):(0,kt.jsx)("div",{className:"skeleton-header",children:(0,kt.jsx)("div",{className:"skeleton-avatar"})})}),!0===h?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"chat-header-user-info",children:[(0,kt.jsxs)("h4",{className:"chat-header-username",children:[" ","".concat(!0===t?(null===t||void 0===t?void 0:t.fullName)||"":t.user&&t.user.firstName+" "+t.user.surname)]}),oe?(0,kt.jsx)(kt.Fragment,{children:s?(0,kt.jsx)("span",{className:"chat-header-active-status text-capitalized",children:s}):(0,kt.jsx)(kt.Fragment,{children:i&&(0,kt.jsxs)("span",{className:"chat-header-active-status text-capitalized",children:["Last Seen: ",i]})})}):(0,kt.jsxs)(kt.Fragment,{children:[s&&(0,kt.jsxs)("span",{className:"chat-header-active-status text-capitalized",children:[s," |"]}),i&&(0,kt.jsxs)("span",{className:"chat-header-active-status text-capitalized",children:[" Last Seen: ",i]})]})," "]})}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"chat-header-user-info",children:(0,kt.jsxs)("div",{className:"skeleton-lines",children:[(0,kt.jsx)("div",{className:"skeleton-line short"}),(0,kt.jsx)("div",{className:"skeleton-line medium"})]})})})]}),(0,kt.jsxs)("div",{className:"chat-header-action",children:[(0,kt.jsxs)("div",{className:"chat-header-action-btn-container",children:[(0,kt.jsx)("div",{onClick:De,className:"bump-button action-button",title:"bump",children:(0,kt.jsx)("i",{className:"fas fa-record-vinyl"})}),(0,kt.jsx)("div",{onClick:xe,"data-id":d,className:"call-button action-button",children:(0,kt.jsx)("i",{className:"fas fa-phone-alt"})}),(0,kt.jsx)("div",{onClick:Ce,"data-id":d,className:"video-call-button action-button",children:(0,kt.jsx)("i",{className:"fas fa-video"})}),(0,kt.jsx)("div",{onClick:Pe.bind(void 0),className:"info-button action-button",children:(0,kt.jsx)("i",{className:"fas fa-info-circle"})}),R&&(0,kt.jsx)("div",{className:"chat-option-menu",ref:Oe,children:(0,kt.jsxs)("ul",{children:[(0,kt.jsx)("li",{onClick:Ue.bind(void 0),children:"View Profile"}),null!==ue&&void 0!==ue&&ue.blockedUsers.includes(d)?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("li",{onClick:Fe.bind(void 0),children:["Unblock ",t.user.firstName]})}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("li",{onClick:je.bind(void 0),children:["Block ",t.user.firstName]})}),(0,kt.jsxs)("li",{children:["Report ",t.user.firstName]})]})})]}),(0,kt.jsx)(jn,{title:"Video Call",style:O?{}:{width:oe?"95%":"600px",top:"50%",height:"auto"},isOpen:(k||S)&&!W,onRequestClose:()=>{},id:"videoCallModal",isFullscreen:O,children:(0,kt.jsxs)("div",{className:"".concat(S?"call-accepted":""," ").concat(O?"fullscreen-content":""),style:{padding:0},children:[(0,kt.jsxs)("h2",{className:"text-center vc-modal-heading",children:["Video Call - ",t&&t.fullName,S?" \u2022 ".concat((e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))})(H)):""]}),!O&&(0,kt.jsx)("p",{className:"fs-4 text-center",children:!S&&(M?(0,kt.jsxs)(kt.Fragment,{children:[M.name||"Someone"," is calling you"]}):(0,kt.jsxs)(kt.Fragment,{children:["Calling ",t&&t.fullName]}))}),(0,kt.jsxs)("div",{className:"video-call-container ".concat(oe?"mobile":""),children:[(0,kt.jsx)("div",{ref:J,className:"receive-friends-video ".concat(U),style:{width:"100%",height:"400px",display:S?"block":"none",background:"#000",border:U?"3px solid #29B1A9":"none"},"data-video-type":"friend-remote-video"}),(0,kt.jsx)("div",{ref:Q,className:"receive-my-video ".concat(V),style:{width:"150px",height:"100px",position:"absolute",bottom:"10px",right:"10px",background:"#222",display:k||M?"block":"none",borderRadius:"8px",zIndex:10,border:"2px solid gray"},"data-video-type":"my-local-video"})]}),(0,kt.jsxs)("div",{className:"call-buttons",style:oe?{display:"flex",gap:"10px",justifyContent:"space-between",alignItems:"center",background:"rgba(32,32,32,0.6)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"16px",padding:"10px 12px",marginTop:"12px"}:{},children:[(0,kt.jsx)("button",{onClick:Te.bind(void 0),ref:Z,className:"call-button-ends call-button bg-danger",style:me,children:(0,kt.jsx)("i",{className:"fa fa-phone",style:{color:"white"}})}),!S&&M&&(0,kt.jsx)("button",{onClick:()=>Ee(M),className:"call-button-receive call-button bg-success",style:me,children:(0,kt.jsx)("i",{className:"fa fa-phone-volume",style:{color:"white"}})}),S&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("button",{onClick:ve.bind(void 0),className:"call-button-microphone call-button",style:me,children:v?(0,kt.jsx)("i",{className:"fa fa-microphone",style:{color:"white"}}):(0,kt.jsx)("i",{className:"fa fa-microphone-slash",style:{color:"white"}})}),(0,kt.jsx)("button",{onClick:ye,className:"call-button-camera call-button",style:me,children:w?(0,kt.jsx)("i",{className:"fa fa-video",style:{color:"white"}}):(0,kt.jsx)("i",{className:"fa fa-video-slash",style:{color:"white"}})}),(0,kt.jsx)("button",{onClick:Me,className:"call-button-filter call-button ".concat(V?"active":""),title:V?"Filter: ".concat(V.replace("video-vivid-","").replace("filter","vivid")):"No filter",style:me,children:(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",viewBox:"0 0 24 24",children:(0,kt.jsx)("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})})}),!oe&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("button",{onClick:Le,className:"call-button-fullscreen call-button",children:O?(0,kt.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}),(0,kt.jsx)("path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}),(0,kt.jsx)("path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}),(0,kt.jsx)("path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"})]}):(0,kt.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{d:"M3 7V3a2 2 0 0 1 2-2h4"}),(0,kt.jsx)("path",{d:"M17 3h4a2 2 0 0 1 2 2v4"}),(0,kt.jsx)("path",{d:"M21 17v4a2 2 0 0 1-2 2h-4"}),(0,kt.jsx)("path",{d:"M7 21H3a2 2 0 0 1-2-2v-4"})]})}),(0,kt.jsx)("button",{onClick:Re,className:"call-button-minimize call-button",title:"Minimize",children:(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{d:"M6 9l6 6 6-6"})})})]})]})]})]})})]}),!0===ce.isShareEmotion&&(0,kt.jsx)("video",{style:{display:"none"},ref:K,autoPlay:!0,muted:!0,width:"600",height:"400"}),(0,kt.jsx)("audio",{ref:$,src:"",loop:!0})]})},bj="LOAD_SETTINGS",_j=e=>({type:bj,payload:e});function wj(e){return[].concat(e)}function Ej(e){return e.startsWith(":")}function Sj(e){return Rj(e)&&("*"===e||e.length>1&&":>~.+*".includes(e.slice(0,1))||Ij(e))}function Cj(e,t){return(Rj(t)||"number"===typeof t)&&!Tj(e)&&!Ej(e)&&!xj(e)}function xj(e){return e.startsWith("@media")}function Tj(e){return"--"===e}function Rj(e){return e+""===e}function Ij(e){return Rj(e)&&(e.startsWith("&")||Ej(e))}function Nj(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.filter(Boolean).join(t)}function Aj(e,t){let n=0;if(0===t.length)return n.toString();for(let r=0;r<t.length;r++){n=(n<<5)-n+t.charCodeAt(r),n&=n}return"".concat(null!==e&&void 0!==e?e:"cl","_").concat(n.toString(36))}function kj(e,t){return"".concat(e,":").concat(t)}var Dj=class e{constructor(e,t,n,r){this.sheet=e,this.property=t,this.value=n,this.selector=r,this.property=t,this.value=n,this.joined=kj(t,n);const i=this.selector.preconditions.concat(this.selector.postconditions);this.hash=this.selector.hasConditions?this.selector.scopeClassName:Aj(this.sheet.name,this.joined),this.key=Nj([this.joined,i,this.hash])}toString(){let t=Mj(this.selector.preconditions,{right:this.hash});return t=Mj(this.selector.postconditions,{left:t}),"".concat(t," {").concat(e.genRule(this.property,this.value),"}")}static genRule(e,t){return kj(e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),function(e,t){return"content"===e?'"'.concat(t,'"'):t}(e,t))+";"}};function Mj(e){let{left:t="",right:n=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.reduce(((e,t)=>Ej(t)?e+t:Ij(t)?e+t.slice(1):Nj([e,t]," ")),t);return Nj([r,(i=n,i?".".concat(i):"")]," ");var i}var Lj,Oj=class e{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{preconditions:n,postconditions:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.sheet=e,this.preconditions=[],this.scopeClassName=null,this.scopeName=null,this.postconditions=[],this.preconditions=n?wj(n):[],this.postconditions=r?wj(r):[],this.setScope(t)}setScope(e){return e?(this.scopeClassName||(this.scopeName=e,this.scopeClassName=Aj(this.sheet.name,e+this.sheet.count)),this):this}get hasConditions(){return this.preconditions.length>0||this.postconditions.length>0}addScope(t){return new e(this.sheet,t,{preconditions:this.preconditions,postconditions:this.postconditions})}addPrecondition(t){return new e(this.sheet,this.scopeClassName,{postconditions:this.postconditions,preconditions:this.preconditions.concat(t)})}addPostcondition(t){return new e(this.sheet,this.scopeClassName,{preconditions:this.preconditions,postconditions:this.postconditions.concat(t)})}createRule(e,t){return new Dj(this.sheet,e,t,this)}},Pj=class{constructor(e,t){this.name=e,this.rootNode=t,this.storedStyles={},this.storedClasses={},this.style="",this.count=0,this.id="flairup-".concat(e),this.styleTag=this.createStyleTag()}getStyle(){return this.style}append(e){var t,n;this.style=(t=this.style,n=e,t?"".concat(t,"\n").concat(n):n)}apply(){this.count++,this.styleTag&&(this.styleTag.innerHTML=this.style)}isApplied(){return!!this.styleTag}createStyleTag(){var e;if("undefined"===typeof document||this.isApplied()||null===this.rootNode)return this.styleTag;const t=document.createElement("style");return t.type="text/css",t.id=this.id,(null!==(e=this.rootNode)&&void 0!==e?e:document.head).appendChild(t),t}addRule(e){const t=this.storedClasses[e.key];return Rj(t)?t:(this.storedClasses[e.key]=e.hash,this.storedStyles[e.hash]=[e.property,e.value],this.append(e.toString()),e.hash)}};function jj(e,t){for(const n in e)t(n.trim(),e[n])}function Fj(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>(t instanceof Set?e.push(...t):"string"===typeof t?e.push(t):Array.isArray(t)?e.push(Fj(...t)):"object"===typeof t&&Object.entries(t).forEach((t=>{let[n,r]=t;r&&e.push(n)})),e)),[]);return Nj(r," ").trim()}function Uj(e,t){const n=new Pj(e,t);return{create:function(e){const t={};return Bj(n,e,new Oj(n)).forEach((e=>{let[r,i,a]=e;Vj(n,i,a).forEach((e=>{!function(e,n){var r;t[e]=null!==(r=t[e])&&void 0!==r?r:new Set,t[e].add(n)}(r,e)}))})),n.apply(),t},getStyle:n.getStyle.bind(n),isApplied:n.isApplied.bind(n)}}function Bj(e,t,n){const r=[];return jj(t,((i,a)=>{if(Sj(i))return Bj(e,a,n.addPrecondition(i)).forEach((e=>r.push(e)));r.push([i,t[i],n.addScope(i)])})),r}function Vj(e,t,n){const r=new Set;return jj(t,((t,i)=>{let a=[];if(Sj(t))a=Vj(e,i,n.addPostcondition(t));else if(function(e){return"."===e}(t))a=wj(i);else if(xj(t))a=function(e,t,n,r){e.append(n+" {");const i=Vj(e,t,r);return e.append("}"),i}(e,i,t,n);else if(Tj(t))a=function(e,t,n){const r=new Set,i=[];if(jj(t,((t,a)=>{if(Cj(t,a))return void i.push(Dj.genRule(t,a));zj(Vj(e,null!==a&&void 0!==a?a:{},n),r)})),!n.scopeClassName)return r;if(i.length){const t=i.join(" ");e.append("".concat(Mj(n.preconditions,{right:n.scopeClassName})," {").concat(t,"}"))}return r.add(n.scopeClassName),r}(e,i,n);else if(Cj(t,i)){const a=n.createRule(t,i);e.addRule(a),r.add(a.hash)}return zj(a,r)})),r}function zj(e,t){return e.forEach((e=>t.add(e))),t}function Wj(){return Wj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Wj.apply(this,arguments)}function Gj(e,t){return Gj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Gj(e,t)}function Hj(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function Yj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qj(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return Yj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yj(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Kj(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return"."+e})).join("")}!function(e){e.hiddenOnSearch="epr-hidden-on-search",e.searchActive="epr-search-active",e.hidden="epr-hidden",e.visible="epr-visible",e.active="epr-active",e.emoji="epr-emoji",e.category="epr-emoji-category",e.label="epr-emoji-category-label",e.categoryContent="epr-emoji-category-content",e.emojiHasVariations="epr-emoji-has-variations",e.scrollBody="epr-body",e.emojiList="epr-emoji-list",e.external="__EmojiPicker__",e.emojiPicker="EmojiPickerReact",e.open="epr-open",e.vertical="epr-vertical",e.horizontal="epr-horizontal",e.variationPicker="epr-emoji-variation-picker",e.darkTheme="epr-dark-theme",e.autoTheme="epr-auto-theme"}(Lj||(Lj={}));var Xj=Uj("epr",null),Qj={display:"none",opacity:"0",pointerEvents:"none",visibility:"hidden",overflow:"hidden"},Jj=Xj.create({hidden:Wj({".":Lj.hidden},Qj)}),Zj=(0,a.memo)((function(){return(0,a.createElement)("style",{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:Xj.getStyle()}})})),$j=Xj.create({".epr-main":{":has(input:not(:placeholder-shown))":{categoryBtn:{":hover":{opacity:"1",backgroundPositionY:"var(--epr-category-navigation-button-size)"}},hiddenOnSearch:Wj({".":Lj.hiddenOnSearch},Qj)},":has(input(:placeholder-shown))":{visibleOnSearchOnly:Qj}},hiddenOnReactions:{transition:"all 0.5s ease-in-out"},".epr-reactions":{hiddenOnReactions:{height:"0px",width:"0px",opacity:"0",pointerEvents:"none",overflow:"hidden"}},".EmojiPickerReact:not(.epr-search-active)":{categoryBtn:{":hover":{opacity:"1",backgroundPositionY:"var(--epr-category-navigation-button-size)"},"&.epr-active":{opacity:"1",backgroundPositionY:"var(--epr-category-navigation-button-size)"}},visibleOnSearchOnly:Wj({".":"epr-visible-on-search-only"},Qj)}});function eF(e,t){var n,r;return{".epr-dark-theme":(n={},n[e]=t,n),".epr-auto-theme":(r={},r[e]={"@media (prefers-color-scheme: dark)":t},r)}}function tF(e,t){var n,r,i=null!=(n=e.customEmojis)?n:[],a=null!=(r=t.customEmojis)?r:[];return e.open===t.open&&e.emojiVersion===t.emojiVersion&&e.reactionsDefaultOpen===t.reactionsDefaultOpen&&e.searchPlaceHolder===t.searchPlaceHolder&&e.searchPlaceholder===t.searchPlaceholder&&e.defaultSkinTone===t.defaultSkinTone&&e.skinTonesDisabled===t.skinTonesDisabled&&e.autoFocusSearch===t.autoFocusSearch&&e.emojiStyle===t.emojiStyle&&e.theme===t.theme&&e.suggestedEmojisMode===t.suggestedEmojisMode&&e.lazyLoadEmojis===t.lazyLoadEmojis&&e.className===t.className&&e.height===t.height&&e.width===t.width&&e.style===t.style&&e.searchDisabled===t.searchDisabled&&e.skinTonePickerLocation===t.skinTonePickerLocation&&i.length===a.length}var nF,rF,iF,aF,oF,sF,cF,uF=["1f44d","2764-fe0f","1f603","1f622","1f64f","1f44e","1f621"];!function(e){e.RECENT="recent",e.FREQUENT="frequent"}(nF||(nF={})),function(e){e.NATIVE="native",e.APPLE="apple",e.TWITTER="twitter",e.GOOGLE="google",e.FACEBOOK="facebook"}(rF||(rF={})),function(e){e.DARK="dark",e.LIGHT="light",e.AUTO="auto"}(iF||(iF={})),function(e){e.NEUTRAL="neutral",e.LIGHT="1f3fb",e.MEDIUM_LIGHT="1f3fc",e.MEDIUM="1f3fd",e.MEDIUM_DARK="1f3fe",e.DARK="1f3ff"}(aF||(aF={})),function(e){e.SUGGESTED="suggested",e.CUSTOM="custom",e.SMILEYS_PEOPLE="smileys_people",e.ANIMALS_NATURE="animals_nature",e.FOOD_DRINK="food_drink",e.TRAVEL_PLACES="travel_places",e.ACTIVITIES="activities",e.OBJECTS="objects",e.SYMBOLS="symbols",e.FLAGS="flags"}(oF||(oF={})),function(e){e.SEARCH="SEARCH",e.PREVIEW="PREVIEW"}(sF||(sF={}));var lF=[oF.SUGGESTED,oF.CUSTOM,oF.SMILEYS_PEOPLE,oF.ANIMALS_NATURE,oF.FOOD_DRINK,oF.TRAVEL_PLACES,oF.ACTIVITIES,oF.OBJECTS,oF.SYMBOLS,oF.FLAGS],dF={name:"Recently Used",category:oF.SUGGESTED},fF=((cF={})[oF.SUGGESTED]={category:oF.SUGGESTED,name:"Frequently Used"},cF[oF.CUSTOM]={category:oF.CUSTOM,name:"Custom Emojis"},cF[oF.SMILEYS_PEOPLE]={category:oF.SMILEYS_PEOPLE,name:"Smileys & People"},cF[oF.ANIMALS_NATURE]={category:oF.ANIMALS_NATURE,name:"Animals & Nature"},cF[oF.FOOD_DRINK]={category:oF.FOOD_DRINK,name:"Food & Drink"},cF[oF.TRAVEL_PLACES]={category:oF.TRAVEL_PLACES,name:"Travel & Places"},cF[oF.ACTIVITIES]={category:oF.ACTIVITIES,name:"Activities"},cF[oF.OBJECTS]={category:oF.OBJECTS,name:"Objects"},cF[oF.SYMBOLS]={category:oF.SYMBOLS,name:"Symbols"},cF[oF.FLAGS]={category:oF.FLAGS,name:"Flags"},cF);function hF(e){return lF.map((function(t){return Wj({},fF[t],e&&e[t]&&e[t])}))}function pF(e){return e.category}function mF(e){return e.name}function gF(e,t){return void 0===t&&(t={}),Object.assign(fF[e],t)}var vF,yF={custom:[],smileys_people:[{n:["grinning","grinning face"],u:"1f600",a:"1.0"},{n:["smiley","smiling face with open mouth"],u:"1f603",a:"0.6"},{n:["smile","smiling face with open mouth and smiling eyes"],u:"1f604",a:"0.6"},{n:["grin","grinning face with smiling eyes"],u:"1f601",a:"0.6"},{n:["laughing","satisfied","smiling face with open mouth and tightly-closed eyes"],u:"1f606",a:"0.6"},{n:["sweat smile","smiling face with open mouth and cold sweat"],u:"1f605",a:"0.6"},{n:["rolling on the floor laughing"],u:"1f923",a:"3.0"},{n:["joy","face with tears of joy"],u:"1f602",a:"0.6"},{n:["slightly smiling face"],u:"1f642",a:"1.0"},{n:["upside-down face","upside down face"],u:"1f643",a:"1.0"},{n:["melting face"],u:"1fae0",a:"14.0"},{n:["wink","winking face"],u:"1f609",a:"0.6"},{n:["blush","smiling face with smiling eyes"],u:"1f60a",a:"0.6"},{n:["innocent","smiling face with halo"],u:"1f607",a:"1.0"},{n:["smiling face with 3 hearts","smiling face with smiling eyes and three hearts"],u:"1f970",a:"11.0"},{n:["heart eyes","smiling face with heart-shaped eyes"],u:"1f60d",a:"0.6"},{n:["star-struck","grinning face with star eyes"],u:"1f929",a:"5.0"},{n:["kissing heart","face throwing a kiss"],u:"1f618",a:"0.6"},{n:["kissing","kissing face"],u:"1f617",a:"1.0"},{n:["relaxed","white smiling face"],u:"263a-fe0f",a:"0.6"},{n:["kissing closed eyes","kissing face with closed eyes"],u:"1f61a",a:"0.6"},{n:["kissing smiling eyes","kissing face with smiling eyes"],u:"1f619",a:"1.0"},{n:["smiling face with tear"],u:"1f972",a:"13.0"},{n:["yum","face savouring delicious food"],u:"1f60b",a:"0.6"},{n:["stuck out tongue","face with stuck-out tongue"],u:"1f61b",a:"1.0"},{n:["stuck out tongue winking eye","face with stuck-out tongue and winking eye"],u:"1f61c",a:"0.6"},{n:["zany face","grinning face with one large and one small eye"],u:"1f92a",a:"5.0"},{n:["stuck out tongue closed eyes","face with stuck-out tongue and tightly-closed eyes"],u:"1f61d",a:"0.6"},{n:["money-mouth face","money mouth face"],u:"1f911",a:"1.0"},{n:["hugging face"],u:"1f917",a:"1.0"},{n:["face with hand over mouth","smiling face with smiling eyes and hand covering mouth"],u:"1f92d",a:"5.0"},{n:["face with open eyes and hand over mouth"],u:"1fae2",a:"14.0"},{n:["face with peeking eye"],u:"1fae3",a:"14.0"},{n:["shushing face","face with finger covering closed lips"],u:"1f92b",a:"5.0"},{n:["thinking face"],u:"1f914",a:"1.0"},{n:["saluting face"],u:"1fae1",a:"14.0"},{n:["zipper-mouth face","zipper mouth face"],u:"1f910",a:"1.0"},{n:["face with raised eyebrow","face with one eyebrow raised"],u:"1f928",a:"5.0"},{n:["neutral face"],u:"1f610",a:"0.7"},{n:["expressionless","expressionless face"],u:"1f611",a:"1.0"},{n:["no mouth","face without mouth"],u:"1f636",a:"1.0"},{n:["dotted line face"],u:"1fae5",a:"14.0"},{n:["face in clouds"],u:"1f636-200d-1f32b-fe0f",a:"13.1"},{n:["smirk","smirking face"],u:"1f60f",a:"0.6"},{n:["unamused","unamused face"],u:"1f612",a:"0.6"},{n:["face with rolling eyes"],u:"1f644",a:"1.0"},{n:["grimacing","grimacing face"],u:"1f62c",a:"1.0"},{n:["face exhaling"],u:"1f62e-200d-1f4a8",a:"13.1"},{n:["lying face"],u:"1f925",a:"3.0"},{n:["relieved","relieved face"],u:"1f60c",a:"0.6"},{n:["pensive","pensive face"],u:"1f614",a:"0.6"},{n:["sleepy","sleepy face"],u:"1f62a",a:"0.6"},{n:["drooling face"],u:"1f924",a:"3.0"},{n:["sleeping","sleeping face"],u:"1f634",a:"1.0"},{n:["mask","face with medical mask"],u:"1f637",a:"0.6"},{n:["face with thermometer"],u:"1f912",a:"1.0"},{n:["face with head-bandage","face with head bandage"],u:"1f915",a:"1.0"},{n:["nauseated face"],u:"1f922",a:"3.0"},{n:["face vomiting","face with open mouth vomiting"],u:"1f92e",a:"5.0"},{n:["sneezing face"],u:"1f927",a:"3.0"},{n:["hot face","overheated face"],u:"1f975",a:"11.0"},{n:["cold face","freezing face"],u:"1f976",a:"11.0"},{n:["woozy face","face with uneven eyes and wavy mouth"],u:"1f974",a:"11.0"},{n:["dizzy face"],u:"1f635",a:"0.6"},{n:["face with spiral eyes"],u:"1f635-200d-1f4ab",a:"13.1"},{n:["exploding head","shocked face with exploding head"],u:"1f92f",a:"5.0"},{n:["face with cowboy hat"],u:"1f920",a:"3.0"},{n:["partying face","face with party horn and party hat"],u:"1f973",a:"11.0"},{n:["disguised face"],u:"1f978",a:"13.0"},{n:["sunglasses","smiling face with sunglasses"],u:"1f60e",a:"1.0"},{n:["nerd face"],u:"1f913",a:"1.0"},{n:["face with monocle"],u:"1f9d0",a:"5.0"},{n:["confused","confused face"],u:"1f615",a:"1.0"},{n:["face with diagonal mouth"],u:"1fae4",a:"14.0"},{n:["worried","worried face"],u:"1f61f",a:"1.0"},{n:["slightly frowning face"],u:"1f641",a:"1.0"},{n:["frowning face","white frowning face"],u:"2639-fe0f",a:"0.7"},{n:["open mouth","face with open mouth"],u:"1f62e",a:"1.0"},{n:["hushed","hushed face"],u:"1f62f",a:"1.0"},{n:["astonished","astonished face"],u:"1f632",a:"0.6"},{n:["flushed","flushed face"],u:"1f633",a:"0.6"},{n:["pleading face","face with pleading eyes"],u:"1f97a",a:"11.0"},{n:["face holding back tears"],u:"1f979",a:"14.0"},{n:["frowning","frowning face with open mouth"],u:"1f626",a:"1.0"},{n:["anguished","anguished face"],u:"1f627",a:"1.0"},{n:["fearful","fearful face"],u:"1f628",a:"0.6"},{n:["cold sweat","face with open mouth and cold sweat"],u:"1f630",a:"0.6"},{n:["disappointed relieved","disappointed but relieved face"],u:"1f625",a:"0.6"},{n:["cry","crying face"],u:"1f622",a:"0.6"},{n:["sob","loudly crying face"],u:"1f62d",a:"0.6"},{n:["scream","face screaming in fear"],u:"1f631",a:"0.6"},{n:["confounded","confounded face"],u:"1f616",a:"0.6"},{n:["persevere","persevering face"],u:"1f623",a:"0.6"},{n:["disappointed","disappointed face"],u:"1f61e",a:"0.6"},{n:["sweat","face with cold sweat"],u:"1f613",a:"0.6"},{n:["weary","weary face"],u:"1f629",a:"0.6"},{n:["tired face"],u:"1f62b",a:"0.6"},{n:["yawning face"],u:"1f971",a:"12.0"},{n:["triumph","face with look of triumph"],u:"1f624",a:"0.6"},{n:["rage","pouting face"],u:"1f621",a:"0.6"},{n:["angry","angry face"],u:"1f620",a:"0.6"},{n:["face with symbols on mouth","serious face with symbols covering mouth"],u:"1f92c",a:"5.0"},{n:["smiling imp","smiling face with horns"],u:"1f608",a:"1.0"},{n:["imp"],u:"1f47f",a:"0.6"},{n:["skull"],u:"1f480",a:"0.6"},{n:["skull and crossbones"],u:"2620-fe0f",a:"1.0"},{n:["poop","shit","hankey","pile of poo"],u:"1f4a9",a:"0.6"},{n:["clown face"],u:"1f921",a:"3.0"},{n:["japanese ogre"],u:"1f479",a:"0.6"},{n:["japanese goblin"],u:"1f47a",a:"0.6"},{n:["ghost"],u:"1f47b",a:"0.6"},{n:["alien","extraterrestrial alien"],u:"1f47d",a:"0.6"},{n:["alien monster","space invader"],u:"1f47e",a:"0.6"},{n:["robot face"],u:"1f916",a:"1.0"},{n:["smiley cat","smiling cat face with open mouth"],u:"1f63a",a:"0.6"},{n:["smile cat","grinning cat face with smiling eyes"],u:"1f638",a:"0.6"},{n:["joy cat","cat face with tears of joy"],u:"1f639",a:"0.6"},{n:["heart eyes cat","smiling cat face with heart-shaped eyes"],u:"1f63b",a:"0.6"},{n:["smirk cat","cat face with wry smile"],u:"1f63c",a:"0.6"},{n:["kissing cat","kissing cat face with closed eyes"],u:"1f63d",a:"0.6"},{n:["scream cat","weary cat face"],u:"1f640",a:"0.6"},{n:["crying cat face"],u:"1f63f",a:"0.6"},{n:["pouting cat","pouting cat face"],u:"1f63e",a:"0.6"},{n:["see no evil","see-no-evil monkey"],u:"1f648",a:"0.6"},{n:["hear no evil","hear-no-evil monkey"],u:"1f649",a:"0.6"},{n:["speak no evil","speak-no-evil monkey"],u:"1f64a",a:"0.6"},{n:["kiss","kiss mark"],u:"1f48b",a:"0.6"},{n:["love letter"],u:"1f48c",a:"0.6"},{n:["cupid","heart with arrow"],u:"1f498",a:"0.6"},{n:["gift heart","heart with ribbon"],u:"1f49d",a:"0.6"},{n:["sparkling heart"],u:"1f496",a:"0.6"},{n:["heartpulse","growing heart"],u:"1f497",a:"0.6"},{n:["heartbeat","beating heart"],u:"1f493",a:"0.6"},{n:["revolving hearts"],u:"1f49e",a:"0.6"},{n:["two hearts"],u:"1f495",a:"0.6"},{n:["heart decoration"],u:"1f49f",a:"0.6"},{n:["heart exclamation","heavy heart exclamation mark ornament"],u:"2763-fe0f",a:"1.0"},{n:["broken heart"],u:"1f494",a:"0.6"},{n:["heart on fire"],u:"2764-fe0f-200d-1f525",a:"13.1"},{n:["mending heart"],u:"2764-fe0f-200d-1fa79",a:"13.1"},{n:["heart","heavy black heart"],u:"2764-fe0f",a:"0.6"},{n:["orange heart"],u:"1f9e1",a:"5.0"},{n:["yellow heart"],u:"1f49b",a:"0.6"},{n:["green heart"],u:"1f49a",a:"0.6"},{n:["blue heart"],u:"1f499",a:"0.6"},{n:["purple heart"],u:"1f49c",a:"0.6"},{n:["brown heart"],u:"1f90e",a:"12.0"},{n:["black heart"],u:"1f5a4",a:"3.0"},{n:["white heart"],u:"1f90d",a:"12.0"},{n:["100","hundred points symbol"],u:"1f4af",a:"0.6"},{n:["anger","anger symbol"],u:"1f4a2",a:"0.6"},{n:["boom","collision","collision symbol"],u:"1f4a5",a:"0.6"},{n:["dizzy","dizzy symbol"],u:"1f4ab",a:"0.6"},{n:["sweat drops","splashing sweat symbol"],u:"1f4a6",a:"0.6"},{n:["dash","dash symbol"],u:"1f4a8",a:"0.6"},{n:["hole"],u:"1f573-fe0f",a:"0.7"},{n:["bomb"],u:"1f4a3",a:"0.6"},{n:["speech balloon"],u:"1f4ac",a:"0.6"},{n:["eye in speech bubble","eye-in-speech-bubble"],u:"1f441-fe0f-200d-1f5e8-fe0f",a:"2.0"},{n:["left speech bubble"],u:"1f5e8-fe0f",a:"2.0"},{n:["right anger bubble"],u:"1f5ef-fe0f",a:"0.7"},{n:["thought balloon"],u:"1f4ad",a:"1.0"},{n:["zzz","sleeping symbol"],u:"1f4a4",a:"0.6"},{n:["wave","waving hand sign"],u:"1f44b",v:["1f44b-1f3fb","1f44b-1f3fc","1f44b-1f3fd","1f44b-1f3fe","1f44b-1f3ff"],a:"0.6"},{n:["raised back of hand"],u:"1f91a",v:["1f91a-1f3fb","1f91a-1f3fc","1f91a-1f3fd","1f91a-1f3fe","1f91a-1f3ff"],a:"3.0"},{n:["hand with fingers splayed","raised hand with fingers splayed"],u:"1f590-fe0f",v:["1f590-1f3fb","1f590-1f3fc","1f590-1f3fd","1f590-1f3fe","1f590-1f3ff"],a:"0.7"},{n:["hand","raised hand"],u:"270b",v:["270b-1f3fb","270b-1f3fc","270b-1f3fd","270b-1f3fe","270b-1f3ff"],a:"0.6"},{n:["spock-hand","raised hand with part between middle and ring fingers"],u:"1f596",v:["1f596-1f3fb","1f596-1f3fc","1f596-1f3fd","1f596-1f3fe","1f596-1f3ff"],a:"1.0"},{n:["rightwards hand"],u:"1faf1",v:["1faf1-1f3fb","1faf1-1f3fc","1faf1-1f3fd","1faf1-1f3fe","1faf1-1f3ff"],a:"14.0"},{n:["leftwards hand"],u:"1faf2",v:["1faf2-1f3fb","1faf2-1f3fc","1faf2-1f3fd","1faf2-1f3fe","1faf2-1f3ff"],a:"14.0"},{n:["palm down hand"],u:"1faf3",v:["1faf3-1f3fb","1faf3-1f3fc","1faf3-1f3fd","1faf3-1f3fe","1faf3-1f3ff"],a:"14.0"},{n:["palm up hand"],u:"1faf4",v:["1faf4-1f3fb","1faf4-1f3fc","1faf4-1f3fd","1faf4-1f3fe","1faf4-1f3ff"],a:"14.0"},{n:["ok hand","ok hand sign"],u:"1f44c",v:["1f44c-1f3fb","1f44c-1f3fc","1f44c-1f3fd","1f44c-1f3fe","1f44c-1f3ff"],a:"0.6"},{n:["pinched fingers"],u:"1f90c",v:["1f90c-1f3fb","1f90c-1f3fc","1f90c-1f3fd","1f90c-1f3fe","1f90c-1f3ff"],a:"13.0"},{n:["pinching hand"],u:"1f90f",v:["1f90f-1f3fb","1f90f-1f3fc","1f90f-1f3fd","1f90f-1f3fe","1f90f-1f3ff"],a:"12.0"},{n:["v","victory hand"],u:"270c-fe0f",v:["270c-1f3fb","270c-1f3fc","270c-1f3fd","270c-1f3fe","270c-1f3ff"],a:"0.6"},{n:["crossed fingers","hand with index and middle fingers crossed"],u:"1f91e",v:["1f91e-1f3fb","1f91e-1f3fc","1f91e-1f3fd","1f91e-1f3fe","1f91e-1f3ff"],a:"3.0"},{n:["hand with index finger and thumb crossed"],u:"1faf0",v:["1faf0-1f3fb","1faf0-1f3fc","1faf0-1f3fd","1faf0-1f3fe","1faf0-1f3ff"],a:"14.0"},{n:["i love you hand sign"],u:"1f91f",v:["1f91f-1f3fb","1f91f-1f3fc","1f91f-1f3fd","1f91f-1f3fe","1f91f-1f3ff"],a:"5.0"},{n:["the horns","sign of the horns"],u:"1f918",v:["1f918-1f3fb","1f918-1f3fc","1f918-1f3fd","1f918-1f3fe","1f918-1f3ff"],a:"1.0"},{n:["call me hand"],u:"1f919",v:["1f919-1f3fb","1f919-1f3fc","1f919-1f3fd","1f919-1f3fe","1f919-1f3ff"],a:"3.0"},{n:["point left","white left pointing backhand index"],u:"1f448",v:["1f448-1f3fb","1f448-1f3fc","1f448-1f3fd","1f448-1f3fe","1f448-1f3ff"],a:"0.6"},{n:["point right","white right pointing backhand index"],u:"1f449",v:["1f449-1f3fb","1f449-1f3fc","1f449-1f3fd","1f449-1f3fe","1f449-1f3ff"],a:"0.6"},{n:["point up 2","white up pointing backhand index"],u:"1f446",v:["1f446-1f3fb","1f446-1f3fc","1f446-1f3fd","1f446-1f3fe","1f446-1f3ff"],a:"0.6"},{n:["middle finger","reversed hand with middle finger extended"],u:"1f595",v:["1f595-1f3fb","1f595-1f3fc","1f595-1f3fd","1f595-1f3fe","1f595-1f3ff"],a:"1.0"},{n:["point down","white down pointing backhand index"],u:"1f447",v:["1f447-1f3fb","1f447-1f3fc","1f447-1f3fd","1f447-1f3fe","1f447-1f3ff"],a:"0.6"},{n:["point up","white up pointing index"],u:"261d-fe0f",v:["261d-1f3fb","261d-1f3fc","261d-1f3fd","261d-1f3fe","261d-1f3ff"],a:"0.6"},{n:["index pointing at the viewer"],u:"1faf5",v:["1faf5-1f3fb","1faf5-1f3fc","1faf5-1f3fd","1faf5-1f3fe","1faf5-1f3ff"],a:"14.0"},{n:["+1","thumbsup","thumbs up sign"],u:"1f44d",v:["1f44d-1f3fb","1f44d-1f3fc","1f44d-1f3fd","1f44d-1f3fe","1f44d-1f3ff"],a:"0.6"},{n:["-1","thumbsdown","thumbs down sign"],u:"1f44e",v:["1f44e-1f3fb","1f44e-1f3fc","1f44e-1f3fd","1f44e-1f3fe","1f44e-1f3ff"],a:"0.6"},{n:["fist","raised fist"],u:"270a",v:["270a-1f3fb","270a-1f3fc","270a-1f3fd","270a-1f3fe","270a-1f3ff"],a:"0.6"},{n:["punch","facepunch","fisted hand sign"],u:"1f44a",v:["1f44a-1f3fb","1f44a-1f3fc","1f44a-1f3fd","1f44a-1f3fe","1f44a-1f3ff"],a:"0.6"},{n:["left-facing fist"],u:"1f91b",v:["1f91b-1f3fb","1f91b-1f3fc","1f91b-1f3fd","1f91b-1f3fe","1f91b-1f3ff"],a:"3.0"},{n:["right-facing fist"],u:"1f91c",v:["1f91c-1f3fb","1f91c-1f3fc","1f91c-1f3fd","1f91c-1f3fe","1f91c-1f3ff"],a:"3.0"},{n:["clap","clapping hands sign"],u:"1f44f",v:["1f44f-1f3fb","1f44f-1f3fc","1f44f-1f3fd","1f44f-1f3fe","1f44f-1f3ff"],a:"0.6"},{n:["raised hands","person raising both hands in celebration"],u:"1f64c",v:["1f64c-1f3fb","1f64c-1f3fc","1f64c-1f3fd","1f64c-1f3fe","1f64c-1f3ff"],a:"0.6"},{n:["heart hands"],u:"1faf6",v:["1faf6-1f3fb","1faf6-1f3fc","1faf6-1f3fd","1faf6-1f3fe","1faf6-1f3ff"],a:"14.0"},{n:["open hands","open hands sign"],u:"1f450",v:["1f450-1f3fb","1f450-1f3fc","1f450-1f3fd","1f450-1f3fe","1f450-1f3ff"],a:"0.6"},{n:["palms up together"],u:"1f932",v:["1f932-1f3fb","1f932-1f3fc","1f932-1f3fd","1f932-1f3fe","1f932-1f3ff"],a:"5.0"},{n:["handshake"],u:"1f91d",v:["1f91d-1f3fb","1f91d-1f3fc","1f91d-1f3fd","1f91d-1f3fe","1f91d-1f3ff","1faf1-1f3fb-200d-1faf2-1f3fc","1faf1-1f3fb-200d-1faf2-1f3fd","1faf1-1f3fb-200d-1faf2-1f3fe","1faf1-1f3fb-200d-1faf2-1f3ff","1faf1-1f3fc-200d-1faf2-1f3fb","1faf1-1f3fc-200d-1faf2-1f3fd","1faf1-1f3fc-200d-1faf2-1f3fe","1faf1-1f3fc-200d-1faf2-1f3ff","1faf1-1f3fd-200d-1faf2-1f3fb","1faf1-1f3fd-200d-1faf2-1f3fc","1faf1-1f3fd-200d-1faf2-1f3fe","1faf1-1f3fd-200d-1faf2-1f3ff","1faf1-1f3fe-200d-1faf2-1f3fb","1faf1-1f3fe-200d-1faf2-1f3fc","1faf1-1f3fe-200d-1faf2-1f3fd","1faf1-1f3fe-200d-1faf2-1f3ff","1faf1-1f3ff-200d-1faf2-1f3fb","1faf1-1f3ff-200d-1faf2-1f3fc","1faf1-1f3ff-200d-1faf2-1f3fd","1faf1-1f3ff-200d-1faf2-1f3fe"],a:"3.0"},{n:["pray","person with folded hands"],u:"1f64f",v:["1f64f-1f3fb","1f64f-1f3fc","1f64f-1f3fd","1f64f-1f3fe","1f64f-1f3ff"],a:"0.6"},{n:["writing hand"],u:"270d-fe0f",v:["270d-1f3fb","270d-1f3fc","270d-1f3fd","270d-1f3fe","270d-1f3ff"],a:"0.7"},{n:["nail care","nail polish"],u:"1f485",v:["1f485-1f3fb","1f485-1f3fc","1f485-1f3fd","1f485-1f3fe","1f485-1f3ff"],a:"0.6"},{n:["selfie"],u:"1f933",v:["1f933-1f3fb","1f933-1f3fc","1f933-1f3fd","1f933-1f3fe","1f933-1f3ff"],a:"3.0"},{n:["muscle","flexed biceps"],u:"1f4aa",v:["1f4aa-1f3fb","1f4aa-1f3fc","1f4aa-1f3fd","1f4aa-1f3fe","1f4aa-1f3ff"],a:"0.6"},{n:["mechanical arm"],u:"1f9be",a:"12.0"},{n:["mechanical leg"],u:"1f9bf",a:"12.0"},{n:["leg"],u:"1f9b5",v:["1f9b5-1f3fb","1f9b5-1f3fc","1f9b5-1f3fd","1f9b5-1f3fe","1f9b5-1f3ff"],a:"11.0"},{n:["foot"],u:"1f9b6",v:["1f9b6-1f3fb","1f9b6-1f3fc","1f9b6-1f3fd","1f9b6-1f3fe","1f9b6-1f3ff"],a:"11.0"},{n:["ear"],u:"1f442",v:["1f442-1f3fb","1f442-1f3fc","1f442-1f3fd","1f442-1f3fe","1f442-1f3ff"],a:"0.6"},{n:["ear with hearing aid"],u:"1f9bb",v:["1f9bb-1f3fb","1f9bb-1f3fc","1f9bb-1f3fd","1f9bb-1f3fe","1f9bb-1f3ff"],a:"12.0"},{n:["nose"],u:"1f443",v:["1f443-1f3fb","1f443-1f3fc","1f443-1f3fd","1f443-1f3fe","1f443-1f3ff"],a:"0.6"},{n:["brain"],u:"1f9e0",a:"5.0"},{n:["anatomical heart"],u:"1fac0",a:"13.0"},{n:["lungs"],u:"1fac1",a:"13.0"},{n:["tooth"],u:"1f9b7",a:"11.0"},{n:["bone"],u:"1f9b4",a:"11.0"},{n:["eyes"],u:"1f440",a:"0.6"},{n:["eye"],u:"1f441-fe0f",a:"0.7"},{n:["tongue"],u:"1f445",a:"0.6"},{n:["lips","mouth"],u:"1f444",a:"0.6"},{n:["biting lip"],u:"1fae6",a:"14.0"},{n:["baby"],u:"1f476",v:["1f476-1f3fb","1f476-1f3fc","1f476-1f3fd","1f476-1f3fe","1f476-1f3ff"],a:"0.6"},{n:["child"],u:"1f9d2",v:["1f9d2-1f3fb","1f9d2-1f3fc","1f9d2-1f3fd","1f9d2-1f3fe","1f9d2-1f3ff"],a:"5.0"},{n:["boy"],u:"1f466",v:["1f466-1f3fb","1f466-1f3fc","1f466-1f3fd","1f466-1f3fe","1f466-1f3ff"],a:"0.6"},{n:["girl"],u:"1f467",v:["1f467-1f3fb","1f467-1f3fc","1f467-1f3fd","1f467-1f3fe","1f467-1f3ff"],a:"0.6"},{n:["adult"],u:"1f9d1",v:["1f9d1-1f3fb","1f9d1-1f3fc","1f9d1-1f3fd","1f9d1-1f3fe","1f9d1-1f3ff"],a:"5.0"},{n:["person with blond hair"],u:"1f471",v:["1f471-1f3fb","1f471-1f3fc","1f471-1f3fd","1f471-1f3fe","1f471-1f3ff"],a:"0.6"},{n:["man"],u:"1f468",v:["1f468-1f3fb","1f468-1f3fc","1f468-1f3fd","1f468-1f3fe","1f468-1f3ff"],a:"0.6"},{n:["bearded person"],u:"1f9d4",v:["1f9d4-1f3fb","1f9d4-1f3fc","1f9d4-1f3fd","1f9d4-1f3fe","1f9d4-1f3ff"],a:"5.0"},{n:["man: beard","man with beard"],u:"1f9d4-200d-2642-fe0f",v:["1f9d4-1f3fb-200d-2642-fe0f","1f9d4-1f3fc-200d-2642-fe0f","1f9d4-1f3fd-200d-2642-fe0f","1f9d4-1f3fe-200d-2642-fe0f","1f9d4-1f3ff-200d-2642-fe0f"],a:"13.1"},{n:["woman: beard","woman with beard"],u:"1f9d4-200d-2640-fe0f",v:["1f9d4-1f3fb-200d-2640-fe0f","1f9d4-1f3fc-200d-2640-fe0f","1f9d4-1f3fd-200d-2640-fe0f","1f9d4-1f3fe-200d-2640-fe0f","1f9d4-1f3ff-200d-2640-fe0f"],a:"13.1"},{n:["man: red hair","red haired man"],u:"1f468-200d-1f9b0",v:["1f468-1f3fb-200d-1f9b0","1f468-1f3fc-200d-1f9b0","1f468-1f3fd-200d-1f9b0","1f468-1f3fe-200d-1f9b0","1f468-1f3ff-200d-1f9b0"],a:"11.0"},{n:["man: curly hair","curly haired man"],u:"1f468-200d-1f9b1",v:["1f468-1f3fb-200d-1f9b1","1f468-1f3fc-200d-1f9b1","1f468-1f3fd-200d-1f9b1","1f468-1f3fe-200d-1f9b1","1f468-1f3ff-200d-1f9b1"],a:"11.0"},{n:["man: white hair","white haired man"],u:"1f468-200d-1f9b3",v:["1f468-1f3fb-200d-1f9b3","1f468-1f3fc-200d-1f9b3","1f468-1f3fd-200d-1f9b3","1f468-1f3fe-200d-1f9b3","1f468-1f3ff-200d-1f9b3"],a:"11.0"},{n:["bald man","man: bald"],u:"1f468-200d-1f9b2",v:["1f468-1f3fb-200d-1f9b2","1f468-1f3fc-200d-1f9b2","1f468-1f3fd-200d-1f9b2","1f468-1f3fe-200d-1f9b2","1f468-1f3ff-200d-1f9b2"],a:"11.0"},{n:["woman"],u:"1f469",v:["1f469-1f3fb","1f469-1f3fc","1f469-1f3fd","1f469-1f3fe","1f469-1f3ff"],a:"0.6"},{n:["woman: red hair","red haired woman"],u:"1f469-200d-1f9b0",v:["1f469-1f3fb-200d-1f9b0","1f469-1f3fc-200d-1f9b0","1f469-1f3fd-200d-1f9b0","1f469-1f3fe-200d-1f9b0","1f469-1f3ff-200d-1f9b0"],a:"11.0"},{n:["person: red hair","red haired person"],u:"1f9d1-200d-1f9b0",v:["1f9d1-1f3fb-200d-1f9b0","1f9d1-1f3fc-200d-1f9b0","1f9d1-1f3fd-200d-1f9b0","1f9d1-1f3fe-200d-1f9b0","1f9d1-1f3ff-200d-1f9b0"],a:"12.1"},{n:["woman: curly hair","curly haired woman"],u:"1f469-200d-1f9b1",v:["1f469-1f3fb-200d-1f9b1","1f469-1f3fc-200d-1f9b1","1f469-1f3fd-200d-1f9b1","1f469-1f3fe-200d-1f9b1","1f469-1f3ff-200d-1f9b1"],a:"11.0"},{n:["person: curly hair","curly haired person"],u:"1f9d1-200d-1f9b1",v:["1f9d1-1f3fb-200d-1f9b1","1f9d1-1f3fc-200d-1f9b1","1f9d1-1f3fd-200d-1f9b1","1f9d1-1f3fe-200d-1f9b1","1f9d1-1f3ff-200d-1f9b1"],a:"12.1"},{n:["woman: white hair","white haired woman"],u:"1f469-200d-1f9b3",v:["1f469-1f3fb-200d-1f9b3","1f469-1f3fc-200d-1f9b3","1f469-1f3fd-200d-1f9b3","1f469-1f3fe-200d-1f9b3","1f469-1f3ff-200d-1f9b3"],a:"11.0"},{n:["person: white hair","white haired person"],u:"1f9d1-200d-1f9b3",v:["1f9d1-1f3fb-200d-1f9b3","1f9d1-1f3fc-200d-1f9b3","1f9d1-1f3fd-200d-1f9b3","1f9d1-1f3fe-200d-1f9b3","1f9d1-1f3ff-200d-1f9b3"],a:"12.1"},{n:["bald woman","woman: bald"],u:"1f469-200d-1f9b2",v:["1f469-1f3fb-200d-1f9b2","1f469-1f3fc-200d-1f9b2","1f469-1f3fd-200d-1f9b2","1f469-1f3fe-200d-1f9b2","1f469-1f3ff-200d-1f9b2"],a:"11.0"},{n:["bald person","person: bald"],u:"1f9d1-200d-1f9b2",v:["1f9d1-1f3fb-200d-1f9b2","1f9d1-1f3fc-200d-1f9b2","1f9d1-1f3fd-200d-1f9b2","1f9d1-1f3fe-200d-1f9b2","1f9d1-1f3ff-200d-1f9b2"],a:"12.1"},{n:["woman: blond hair","blond-haired-woman"],u:"1f471-200d-2640-fe0f",v:["1f471-1f3fb-200d-2640-fe0f","1f471-1f3fc-200d-2640-fe0f","1f471-1f3fd-200d-2640-fe0f","1f471-1f3fe-200d-2640-fe0f","1f471-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["man: blond hair","blond-haired-man"],u:"1f471-200d-2642-fe0f",v:["1f471-1f3fb-200d-2642-fe0f","1f471-1f3fc-200d-2642-fe0f","1f471-1f3fd-200d-2642-fe0f","1f471-1f3fe-200d-2642-fe0f","1f471-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["older adult"],u:"1f9d3",v:["1f9d3-1f3fb","1f9d3-1f3fc","1f9d3-1f3fd","1f9d3-1f3fe","1f9d3-1f3ff"],a:"5.0"},{n:["older man"],u:"1f474",v:["1f474-1f3fb","1f474-1f3fc","1f474-1f3fd","1f474-1f3fe","1f474-1f3ff"],a:"0.6"},{n:["older woman"],u:"1f475",v:["1f475-1f3fb","1f475-1f3fc","1f475-1f3fd","1f475-1f3fe","1f475-1f3ff"],a:"0.6"},{n:["person frowning"],u:"1f64d",v:["1f64d-1f3fb","1f64d-1f3fc","1f64d-1f3fd","1f64d-1f3fe","1f64d-1f3ff"],a:"0.6"},{n:["man frowning","man-frowning"],u:"1f64d-200d-2642-fe0f",v:["1f64d-1f3fb-200d-2642-fe0f","1f64d-1f3fc-200d-2642-fe0f","1f64d-1f3fd-200d-2642-fe0f","1f64d-1f3fe-200d-2642-fe0f","1f64d-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman frowning","woman-frowning"],u:"1f64d-200d-2640-fe0f",v:["1f64d-1f3fb-200d-2640-fe0f","1f64d-1f3fc-200d-2640-fe0f","1f64d-1f3fd-200d-2640-fe0f","1f64d-1f3fe-200d-2640-fe0f","1f64d-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["person with pouting face"],u:"1f64e",v:["1f64e-1f3fb","1f64e-1f3fc","1f64e-1f3fd","1f64e-1f3fe","1f64e-1f3ff"],a:"0.6"},{n:["man pouting","man-pouting"],u:"1f64e-200d-2642-fe0f",v:["1f64e-1f3fb-200d-2642-fe0f","1f64e-1f3fc-200d-2642-fe0f","1f64e-1f3fd-200d-2642-fe0f","1f64e-1f3fe-200d-2642-fe0f","1f64e-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman pouting","woman-pouting"],u:"1f64e-200d-2640-fe0f",v:["1f64e-1f3fb-200d-2640-fe0f","1f64e-1f3fc-200d-2640-fe0f","1f64e-1f3fd-200d-2640-fe0f","1f64e-1f3fe-200d-2640-fe0f","1f64e-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["no good","face with no good gesture"],u:"1f645",v:["1f645-1f3fb","1f645-1f3fc","1f645-1f3fd","1f645-1f3fe","1f645-1f3ff"],a:"0.6"},{n:["man gesturing no","man-gesturing-no"],u:"1f645-200d-2642-fe0f",v:["1f645-1f3fb-200d-2642-fe0f","1f645-1f3fc-200d-2642-fe0f","1f645-1f3fd-200d-2642-fe0f","1f645-1f3fe-200d-2642-fe0f","1f645-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman gesturing no","woman-gesturing-no"],u:"1f645-200d-2640-fe0f",v:["1f645-1f3fb-200d-2640-fe0f","1f645-1f3fc-200d-2640-fe0f","1f645-1f3fd-200d-2640-fe0f","1f645-1f3fe-200d-2640-fe0f","1f645-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["ok woman","face with ok gesture"],u:"1f646",v:["1f646-1f3fb","1f646-1f3fc","1f646-1f3fd","1f646-1f3fe","1f646-1f3ff"],a:"0.6"},{n:["man gesturing ok","man-gesturing-ok"],u:"1f646-200d-2642-fe0f",v:["1f646-1f3fb-200d-2642-fe0f","1f646-1f3fc-200d-2642-fe0f","1f646-1f3fd-200d-2642-fe0f","1f646-1f3fe-200d-2642-fe0f","1f646-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman gesturing ok","woman-gesturing-ok"],u:"1f646-200d-2640-fe0f",v:["1f646-1f3fb-200d-2640-fe0f","1f646-1f3fc-200d-2640-fe0f","1f646-1f3fd-200d-2640-fe0f","1f646-1f3fe-200d-2640-fe0f","1f646-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["information desk person"],u:"1f481",v:["1f481-1f3fb","1f481-1f3fc","1f481-1f3fd","1f481-1f3fe","1f481-1f3ff"],a:"0.6"},{n:["man tipping hand","man-tipping-hand"],u:"1f481-200d-2642-fe0f",v:["1f481-1f3fb-200d-2642-fe0f","1f481-1f3fc-200d-2642-fe0f","1f481-1f3fd-200d-2642-fe0f","1f481-1f3fe-200d-2642-fe0f","1f481-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman tipping hand","woman-tipping-hand"],u:"1f481-200d-2640-fe0f",v:["1f481-1f3fb-200d-2640-fe0f","1f481-1f3fc-200d-2640-fe0f","1f481-1f3fd-200d-2640-fe0f","1f481-1f3fe-200d-2640-fe0f","1f481-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["raising hand","happy person raising one hand"],u:"1f64b",v:["1f64b-1f3fb","1f64b-1f3fc","1f64b-1f3fd","1f64b-1f3fe","1f64b-1f3ff"],a:"0.6"},{n:["man raising hand","man-raising-hand"],u:"1f64b-200d-2642-fe0f",v:["1f64b-1f3fb-200d-2642-fe0f","1f64b-1f3fc-200d-2642-fe0f","1f64b-1f3fd-200d-2642-fe0f","1f64b-1f3fe-200d-2642-fe0f","1f64b-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman raising hand","woman-raising-hand"],u:"1f64b-200d-2640-fe0f",v:["1f64b-1f3fb-200d-2640-fe0f","1f64b-1f3fc-200d-2640-fe0f","1f64b-1f3fd-200d-2640-fe0f","1f64b-1f3fe-200d-2640-fe0f","1f64b-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["deaf person"],u:"1f9cf",v:["1f9cf-1f3fb","1f9cf-1f3fc","1f9cf-1f3fd","1f9cf-1f3fe","1f9cf-1f3ff"],a:"12.0"},{n:["deaf man"],u:"1f9cf-200d-2642-fe0f",v:["1f9cf-1f3fb-200d-2642-fe0f","1f9cf-1f3fc-200d-2642-fe0f","1f9cf-1f3fd-200d-2642-fe0f","1f9cf-1f3fe-200d-2642-fe0f","1f9cf-1f3ff-200d-2642-fe0f"],a:"12.0"},{n:["deaf woman"],u:"1f9cf-200d-2640-fe0f",v:["1f9cf-1f3fb-200d-2640-fe0f","1f9cf-1f3fc-200d-2640-fe0f","1f9cf-1f3fd-200d-2640-fe0f","1f9cf-1f3fe-200d-2640-fe0f","1f9cf-1f3ff-200d-2640-fe0f"],a:"12.0"},{n:["bow","person bowing deeply"],u:"1f647",v:["1f647-1f3fb","1f647-1f3fc","1f647-1f3fd","1f647-1f3fe","1f647-1f3ff"],a:"0.6"},{n:["man bowing","man-bowing"],u:"1f647-200d-2642-fe0f",v:["1f647-1f3fb-200d-2642-fe0f","1f647-1f3fc-200d-2642-fe0f","1f647-1f3fd-200d-2642-fe0f","1f647-1f3fe-200d-2642-fe0f","1f647-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman bowing","woman-bowing"],u:"1f647-200d-2640-fe0f",v:["1f647-1f3fb-200d-2640-fe0f","1f647-1f3fc-200d-2640-fe0f","1f647-1f3fd-200d-2640-fe0f","1f647-1f3fe-200d-2640-fe0f","1f647-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["face palm"],u:"1f926",v:["1f926-1f3fb","1f926-1f3fc","1f926-1f3fd","1f926-1f3fe","1f926-1f3ff"],a:"3.0"},{n:["man facepalming","man-facepalming"],u:"1f926-200d-2642-fe0f",v:["1f926-1f3fb-200d-2642-fe0f","1f926-1f3fc-200d-2642-fe0f","1f926-1f3fd-200d-2642-fe0f","1f926-1f3fe-200d-2642-fe0f","1f926-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman facepalming","woman-facepalming"],u:"1f926-200d-2640-fe0f",v:["1f926-1f3fb-200d-2640-fe0f","1f926-1f3fc-200d-2640-fe0f","1f926-1f3fd-200d-2640-fe0f","1f926-1f3fe-200d-2640-fe0f","1f926-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["shrug"],u:"1f937",v:["1f937-1f3fb","1f937-1f3fc","1f937-1f3fd","1f937-1f3fe","1f937-1f3ff"],a:"3.0"},{n:["man shrugging","man-shrugging"],u:"1f937-200d-2642-fe0f",v:["1f937-1f3fb-200d-2642-fe0f","1f937-1f3fc-200d-2642-fe0f","1f937-1f3fd-200d-2642-fe0f","1f937-1f3fe-200d-2642-fe0f","1f937-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman shrugging","woman-shrugging"],u:"1f937-200d-2640-fe0f",v:["1f937-1f3fb-200d-2640-fe0f","1f937-1f3fc-200d-2640-fe0f","1f937-1f3fd-200d-2640-fe0f","1f937-1f3fe-200d-2640-fe0f","1f937-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["health worker"],u:"1f9d1-200d-2695-fe0f",v:["1f9d1-1f3fb-200d-2695-fe0f","1f9d1-1f3fc-200d-2695-fe0f","1f9d1-1f3fd-200d-2695-fe0f","1f9d1-1f3fe-200d-2695-fe0f","1f9d1-1f3ff-200d-2695-fe0f"],a:"12.1"},{n:["male-doctor","man health worker"],u:"1f468-200d-2695-fe0f",v:["1f468-1f3fb-200d-2695-fe0f","1f468-1f3fc-200d-2695-fe0f","1f468-1f3fd-200d-2695-fe0f","1f468-1f3fe-200d-2695-fe0f","1f468-1f3ff-200d-2695-fe0f"],a:"4.0"},{n:["female-doctor","woman health worker"],u:"1f469-200d-2695-fe0f",v:["1f469-1f3fb-200d-2695-fe0f","1f469-1f3fc-200d-2695-fe0f","1f469-1f3fd-200d-2695-fe0f","1f469-1f3fe-200d-2695-fe0f","1f469-1f3ff-200d-2695-fe0f"],a:"4.0"},{n:["student"],u:"1f9d1-200d-1f393",v:["1f9d1-1f3fb-200d-1f393","1f9d1-1f3fc-200d-1f393","1f9d1-1f3fd-200d-1f393","1f9d1-1f3fe-200d-1f393","1f9d1-1f3ff-200d-1f393"],a:"12.1"},{n:["man student","male-student"],u:"1f468-200d-1f393",v:["1f468-1f3fb-200d-1f393","1f468-1f3fc-200d-1f393","1f468-1f3fd-200d-1f393","1f468-1f3fe-200d-1f393","1f468-1f3ff-200d-1f393"],a:"4.0"},{n:["woman student","female-student"],u:"1f469-200d-1f393",v:["1f469-1f3fb-200d-1f393","1f469-1f3fc-200d-1f393","1f469-1f3fd-200d-1f393","1f469-1f3fe-200d-1f393","1f469-1f3ff-200d-1f393"],a:"4.0"},{n:["teacher"],u:"1f9d1-200d-1f3eb",v:["1f9d1-1f3fb-200d-1f3eb","1f9d1-1f3fc-200d-1f3eb","1f9d1-1f3fd-200d-1f3eb","1f9d1-1f3fe-200d-1f3eb","1f9d1-1f3ff-200d-1f3eb"],a:"12.1"},{n:["man teacher","male-teacher"],u:"1f468-200d-1f3eb",v:["1f468-1f3fb-200d-1f3eb","1f468-1f3fc-200d-1f3eb","1f468-1f3fd-200d-1f3eb","1f468-1f3fe-200d-1f3eb","1f468-1f3ff-200d-1f3eb"],a:"4.0"},{n:["woman teacher","female-teacher"],u:"1f469-200d-1f3eb",v:["1f469-1f3fb-200d-1f3eb","1f469-1f3fc-200d-1f3eb","1f469-1f3fd-200d-1f3eb","1f469-1f3fe-200d-1f3eb","1f469-1f3ff-200d-1f3eb"],a:"4.0"},{n:["judge"],u:"1f9d1-200d-2696-fe0f",v:["1f9d1-1f3fb-200d-2696-fe0f","1f9d1-1f3fc-200d-2696-fe0f","1f9d1-1f3fd-200d-2696-fe0f","1f9d1-1f3fe-200d-2696-fe0f","1f9d1-1f3ff-200d-2696-fe0f"],a:"12.1"},{n:["man judge","male-judge"],u:"1f468-200d-2696-fe0f",v:["1f468-1f3fb-200d-2696-fe0f","1f468-1f3fc-200d-2696-fe0f","1f468-1f3fd-200d-2696-fe0f","1f468-1f3fe-200d-2696-fe0f","1f468-1f3ff-200d-2696-fe0f"],a:"4.0"},{n:["woman judge","female-judge"],u:"1f469-200d-2696-fe0f",v:["1f469-1f3fb-200d-2696-fe0f","1f469-1f3fc-200d-2696-fe0f","1f469-1f3fd-200d-2696-fe0f","1f469-1f3fe-200d-2696-fe0f","1f469-1f3ff-200d-2696-fe0f"],a:"4.0"},{n:["farmer"],u:"1f9d1-200d-1f33e",v:["1f9d1-1f3fb-200d-1f33e","1f9d1-1f3fc-200d-1f33e","1f9d1-1f3fd-200d-1f33e","1f9d1-1f3fe-200d-1f33e","1f9d1-1f3ff-200d-1f33e"],a:"12.1"},{n:["man farmer","male-farmer"],u:"1f468-200d-1f33e",v:["1f468-1f3fb-200d-1f33e","1f468-1f3fc-200d-1f33e","1f468-1f3fd-200d-1f33e","1f468-1f3fe-200d-1f33e","1f468-1f3ff-200d-1f33e"],a:"4.0"},{n:["woman farmer","female-farmer"],u:"1f469-200d-1f33e",v:["1f469-1f3fb-200d-1f33e","1f469-1f3fc-200d-1f33e","1f469-1f3fd-200d-1f33e","1f469-1f3fe-200d-1f33e","1f469-1f3ff-200d-1f33e"],a:"4.0"},{n:["cook"],u:"1f9d1-200d-1f373",v:["1f9d1-1f3fb-200d-1f373","1f9d1-1f3fc-200d-1f373","1f9d1-1f3fd-200d-1f373","1f9d1-1f3fe-200d-1f373","1f9d1-1f3ff-200d-1f373"],a:"12.1"},{n:["man cook","male-cook"],u:"1f468-200d-1f373",v:["1f468-1f3fb-200d-1f373","1f468-1f3fc-200d-1f373","1f468-1f3fd-200d-1f373","1f468-1f3fe-200d-1f373","1f468-1f3ff-200d-1f373"],a:"4.0"},{n:["woman cook","female-cook"],u:"1f469-200d-1f373",v:["1f469-1f3fb-200d-1f373","1f469-1f3fc-200d-1f373","1f469-1f3fd-200d-1f373","1f469-1f3fe-200d-1f373","1f469-1f3ff-200d-1f373"],a:"4.0"},{n:["mechanic"],u:"1f9d1-200d-1f527",v:["1f9d1-1f3fb-200d-1f527","1f9d1-1f3fc-200d-1f527","1f9d1-1f3fd-200d-1f527","1f9d1-1f3fe-200d-1f527","1f9d1-1f3ff-200d-1f527"],a:"12.1"},{n:["man mechanic","male-mechanic"],u:"1f468-200d-1f527",v:["1f468-1f3fb-200d-1f527","1f468-1f3fc-200d-1f527","1f468-1f3fd-200d-1f527","1f468-1f3fe-200d-1f527","1f468-1f3ff-200d-1f527"],a:"4.0"},{n:["woman mechanic","female-mechanic"],u:"1f469-200d-1f527",v:["1f469-1f3fb-200d-1f527","1f469-1f3fc-200d-1f527","1f469-1f3fd-200d-1f527","1f469-1f3fe-200d-1f527","1f469-1f3ff-200d-1f527"],a:"4.0"},{n:["factory worker"],u:"1f9d1-200d-1f3ed",v:["1f9d1-1f3fb-200d-1f3ed","1f9d1-1f3fc-200d-1f3ed","1f9d1-1f3fd-200d-1f3ed","1f9d1-1f3fe-200d-1f3ed","1f9d1-1f3ff-200d-1f3ed"],a:"12.1"},{n:["man factory worker","male-factory-worker"],u:"1f468-200d-1f3ed",v:["1f468-1f3fb-200d-1f3ed","1f468-1f3fc-200d-1f3ed","1f468-1f3fd-200d-1f3ed","1f468-1f3fe-200d-1f3ed","1f468-1f3ff-200d-1f3ed"],a:"4.0"},{n:["woman factory worker","female-factory-worker"],u:"1f469-200d-1f3ed",v:["1f469-1f3fb-200d-1f3ed","1f469-1f3fc-200d-1f3ed","1f469-1f3fd-200d-1f3ed","1f469-1f3fe-200d-1f3ed","1f469-1f3ff-200d-1f3ed"],a:"4.0"},{n:["office worker"],u:"1f9d1-200d-1f4bc",v:["1f9d1-1f3fb-200d-1f4bc","1f9d1-1f3fc-200d-1f4bc","1f9d1-1f3fd-200d-1f4bc","1f9d1-1f3fe-200d-1f4bc","1f9d1-1f3ff-200d-1f4bc"],a:"12.1"},{n:["man office worker","male-office-worker"],u:"1f468-200d-1f4bc",v:["1f468-1f3fb-200d-1f4bc","1f468-1f3fc-200d-1f4bc","1f468-1f3fd-200d-1f4bc","1f468-1f3fe-200d-1f4bc","1f468-1f3ff-200d-1f4bc"],a:"4.0"},{n:["woman office worker","female-office-worker"],u:"1f469-200d-1f4bc",v:["1f469-1f3fb-200d-1f4bc","1f469-1f3fc-200d-1f4bc","1f469-1f3fd-200d-1f4bc","1f469-1f3fe-200d-1f4bc","1f469-1f3ff-200d-1f4bc"],a:"4.0"},{n:["scientist"],u:"1f9d1-200d-1f52c",v:["1f9d1-1f3fb-200d-1f52c","1f9d1-1f3fc-200d-1f52c","1f9d1-1f3fd-200d-1f52c","1f9d1-1f3fe-200d-1f52c","1f9d1-1f3ff-200d-1f52c"],a:"12.1"},{n:["man scientist","male-scientist"],u:"1f468-200d-1f52c",v:["1f468-1f3fb-200d-1f52c","1f468-1f3fc-200d-1f52c","1f468-1f3fd-200d-1f52c","1f468-1f3fe-200d-1f52c","1f468-1f3ff-200d-1f52c"],a:"4.0"},{n:["woman scientist","female-scientist"],u:"1f469-200d-1f52c",v:["1f469-1f3fb-200d-1f52c","1f469-1f3fc-200d-1f52c","1f469-1f3fd-200d-1f52c","1f469-1f3fe-200d-1f52c","1f469-1f3ff-200d-1f52c"],a:"4.0"},{n:["technologist"],u:"1f9d1-200d-1f4bb",v:["1f9d1-1f3fb-200d-1f4bb","1f9d1-1f3fc-200d-1f4bb","1f9d1-1f3fd-200d-1f4bb","1f9d1-1f3fe-200d-1f4bb","1f9d1-1f3ff-200d-1f4bb"],a:"12.1"},{n:["man technologist","male-technologist"],u:"1f468-200d-1f4bb",v:["1f468-1f3fb-200d-1f4bb","1f468-1f3fc-200d-1f4bb","1f468-1f3fd-200d-1f4bb","1f468-1f3fe-200d-1f4bb","1f468-1f3ff-200d-1f4bb"],a:"4.0"},{n:["woman technologist","female-technologist"],u:"1f469-200d-1f4bb",v:["1f469-1f3fb-200d-1f4bb","1f469-1f3fc-200d-1f4bb","1f469-1f3fd-200d-1f4bb","1f469-1f3fe-200d-1f4bb","1f469-1f3ff-200d-1f4bb"],a:"4.0"},{n:["singer"],u:"1f9d1-200d-1f3a4",v:["1f9d1-1f3fb-200d-1f3a4","1f9d1-1f3fc-200d-1f3a4","1f9d1-1f3fd-200d-1f3a4","1f9d1-1f3fe-200d-1f3a4","1f9d1-1f3ff-200d-1f3a4"],a:"12.1"},{n:["man singer","male-singer"],u:"1f468-200d-1f3a4",v:["1f468-1f3fb-200d-1f3a4","1f468-1f3fc-200d-1f3a4","1f468-1f3fd-200d-1f3a4","1f468-1f3fe-200d-1f3a4","1f468-1f3ff-200d-1f3a4"],a:"4.0"},{n:["woman singer","female-singer"],u:"1f469-200d-1f3a4",v:["1f469-1f3fb-200d-1f3a4","1f469-1f3fc-200d-1f3a4","1f469-1f3fd-200d-1f3a4","1f469-1f3fe-200d-1f3a4","1f469-1f3ff-200d-1f3a4"],a:"4.0"},{n:["artist"],u:"1f9d1-200d-1f3a8",v:["1f9d1-1f3fb-200d-1f3a8","1f9d1-1f3fc-200d-1f3a8","1f9d1-1f3fd-200d-1f3a8","1f9d1-1f3fe-200d-1f3a8","1f9d1-1f3ff-200d-1f3a8"],a:"12.1"},{n:["man artist","male-artist"],u:"1f468-200d-1f3a8",v:["1f468-1f3fb-200d-1f3a8","1f468-1f3fc-200d-1f3a8","1f468-1f3fd-200d-1f3a8","1f468-1f3fe-200d-1f3a8","1f468-1f3ff-200d-1f3a8"],a:"4.0"},{n:["woman artist","female-artist"],u:"1f469-200d-1f3a8",v:["1f469-1f3fb-200d-1f3a8","1f469-1f3fc-200d-1f3a8","1f469-1f3fd-200d-1f3a8","1f469-1f3fe-200d-1f3a8","1f469-1f3ff-200d-1f3a8"],a:"4.0"},{n:["pilot"],u:"1f9d1-200d-2708-fe0f",v:["1f9d1-1f3fb-200d-2708-fe0f","1f9d1-1f3fc-200d-2708-fe0f","1f9d1-1f3fd-200d-2708-fe0f","1f9d1-1f3fe-200d-2708-fe0f","1f9d1-1f3ff-200d-2708-fe0f"],a:"12.1"},{n:["man pilot","male-pilot"],u:"1f468-200d-2708-fe0f",v:["1f468-1f3fb-200d-2708-fe0f","1f468-1f3fc-200d-2708-fe0f","1f468-1f3fd-200d-2708-fe0f","1f468-1f3fe-200d-2708-fe0f","1f468-1f3ff-200d-2708-fe0f"],a:"4.0"},{n:["woman pilot","female-pilot"],u:"1f469-200d-2708-fe0f",v:["1f469-1f3fb-200d-2708-fe0f","1f469-1f3fc-200d-2708-fe0f","1f469-1f3fd-200d-2708-fe0f","1f469-1f3fe-200d-2708-fe0f","1f469-1f3ff-200d-2708-fe0f"],a:"4.0"},{n:["astronaut"],u:"1f9d1-200d-1f680",v:["1f9d1-1f3fb-200d-1f680","1f9d1-1f3fc-200d-1f680","1f9d1-1f3fd-200d-1f680","1f9d1-1f3fe-200d-1f680","1f9d1-1f3ff-200d-1f680"],a:"12.1"},{n:["man astronaut","male-astronaut"],u:"1f468-200d-1f680",v:["1f468-1f3fb-200d-1f680","1f468-1f3fc-200d-1f680","1f468-1f3fd-200d-1f680","1f468-1f3fe-200d-1f680","1f468-1f3ff-200d-1f680"],a:"4.0"},{n:["woman astronaut","female-astronaut"],u:"1f469-200d-1f680",v:["1f469-1f3fb-200d-1f680","1f469-1f3fc-200d-1f680","1f469-1f3fd-200d-1f680","1f469-1f3fe-200d-1f680","1f469-1f3ff-200d-1f680"],a:"4.0"},{n:["firefighter"],u:"1f9d1-200d-1f692",v:["1f9d1-1f3fb-200d-1f692","1f9d1-1f3fc-200d-1f692","1f9d1-1f3fd-200d-1f692","1f9d1-1f3fe-200d-1f692","1f9d1-1f3ff-200d-1f692"],a:"12.1"},{n:["man firefighter","male-firefighter"],u:"1f468-200d-1f692",v:["1f468-1f3fb-200d-1f692","1f468-1f3fc-200d-1f692","1f468-1f3fd-200d-1f692","1f468-1f3fe-200d-1f692","1f468-1f3ff-200d-1f692"],a:"4.0"},{n:["woman firefighter","female-firefighter"],u:"1f469-200d-1f692",v:["1f469-1f3fb-200d-1f692","1f469-1f3fc-200d-1f692","1f469-1f3fd-200d-1f692","1f469-1f3fe-200d-1f692","1f469-1f3ff-200d-1f692"],a:"4.0"},{n:["cop","police officer"],u:"1f46e",v:["1f46e-1f3fb","1f46e-1f3fc","1f46e-1f3fd","1f46e-1f3fe","1f46e-1f3ff"],a:"0.6"},{n:["man police officer","male-police-officer"],u:"1f46e-200d-2642-fe0f",v:["1f46e-1f3fb-200d-2642-fe0f","1f46e-1f3fc-200d-2642-fe0f","1f46e-1f3fd-200d-2642-fe0f","1f46e-1f3fe-200d-2642-fe0f","1f46e-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman police officer","female-police-officer"],u:"1f46e-200d-2640-fe0f",v:["1f46e-1f3fb-200d-2640-fe0f","1f46e-1f3fc-200d-2640-fe0f","1f46e-1f3fd-200d-2640-fe0f","1f46e-1f3fe-200d-2640-fe0f","1f46e-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["detective","sleuth or spy"],u:"1f575-fe0f",v:["1f575-1f3fb","1f575-1f3fc","1f575-1f3fd","1f575-1f3fe","1f575-1f3ff"],a:"0.7"},{n:["man detective","male-detective"],u:"1f575-fe0f-200d-2642-fe0f",v:["1f575-1f3fb-200d-2642-fe0f","1f575-1f3fc-200d-2642-fe0f","1f575-1f3fd-200d-2642-fe0f","1f575-1f3fe-200d-2642-fe0f","1f575-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman detective","female-detective"],u:"1f575-fe0f-200d-2640-fe0f",v:["1f575-1f3fb-200d-2640-fe0f","1f575-1f3fc-200d-2640-fe0f","1f575-1f3fd-200d-2640-fe0f","1f575-1f3fe-200d-2640-fe0f","1f575-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["guardsman"],u:"1f482",v:["1f482-1f3fb","1f482-1f3fc","1f482-1f3fd","1f482-1f3fe","1f482-1f3ff"],a:"0.6"},{n:["man guard","male-guard"],u:"1f482-200d-2642-fe0f",v:["1f482-1f3fb-200d-2642-fe0f","1f482-1f3fc-200d-2642-fe0f","1f482-1f3fd-200d-2642-fe0f","1f482-1f3fe-200d-2642-fe0f","1f482-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman guard","female-guard"],u:"1f482-200d-2640-fe0f",v:["1f482-1f3fb-200d-2640-fe0f","1f482-1f3fc-200d-2640-fe0f","1f482-1f3fd-200d-2640-fe0f","1f482-1f3fe-200d-2640-fe0f","1f482-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["ninja"],u:"1f977",v:["1f977-1f3fb","1f977-1f3fc","1f977-1f3fd","1f977-1f3fe","1f977-1f3ff"],a:"13.0"},{n:["construction worker"],u:"1f477",v:["1f477-1f3fb","1f477-1f3fc","1f477-1f3fd","1f477-1f3fe","1f477-1f3ff"],a:"0.6"},{n:["man construction worker","male-construction-worker"],u:"1f477-200d-2642-fe0f",v:["1f477-1f3fb-200d-2642-fe0f","1f477-1f3fc-200d-2642-fe0f","1f477-1f3fd-200d-2642-fe0f","1f477-1f3fe-200d-2642-fe0f","1f477-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman construction worker","female-construction-worker"],u:"1f477-200d-2640-fe0f",v:["1f477-1f3fb-200d-2640-fe0f","1f477-1f3fc-200d-2640-fe0f","1f477-1f3fd-200d-2640-fe0f","1f477-1f3fe-200d-2640-fe0f","1f477-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["person with crown"],u:"1fac5",v:["1fac5-1f3fb","1fac5-1f3fc","1fac5-1f3fd","1fac5-1f3fe","1fac5-1f3ff"],a:"14.0"},{n:["prince"],u:"1f934",v:["1f934-1f3fb","1f934-1f3fc","1f934-1f3fd","1f934-1f3fe","1f934-1f3ff"],a:"3.0"},{n:["princess"],u:"1f478",v:["1f478-1f3fb","1f478-1f3fc","1f478-1f3fd","1f478-1f3fe","1f478-1f3ff"],a:"0.6"},{n:["man with turban"],u:"1f473",v:["1f473-1f3fb","1f473-1f3fc","1f473-1f3fd","1f473-1f3fe","1f473-1f3ff"],a:"0.6"},{n:["man wearing turban","man-wearing-turban"],u:"1f473-200d-2642-fe0f",v:["1f473-1f3fb-200d-2642-fe0f","1f473-1f3fc-200d-2642-fe0f","1f473-1f3fd-200d-2642-fe0f","1f473-1f3fe-200d-2642-fe0f","1f473-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman wearing turban","woman-wearing-turban"],u:"1f473-200d-2640-fe0f",v:["1f473-1f3fb-200d-2640-fe0f","1f473-1f3fc-200d-2640-fe0f","1f473-1f3fd-200d-2640-fe0f","1f473-1f3fe-200d-2640-fe0f","1f473-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["man with gua pi mao"],u:"1f472",v:["1f472-1f3fb","1f472-1f3fc","1f472-1f3fd","1f472-1f3fe","1f472-1f3ff"],a:"0.6"},{n:["person with headscarf"],u:"1f9d5",v:["1f9d5-1f3fb","1f9d5-1f3fc","1f9d5-1f3fd","1f9d5-1f3fe","1f9d5-1f3ff"],a:"5.0"},{n:["man in tuxedo","person in tuxedo"],u:"1f935",v:["1f935-1f3fb","1f935-1f3fc","1f935-1f3fd","1f935-1f3fe","1f935-1f3ff"],a:"3.0"},{n:["man in tuxedo"],u:"1f935-200d-2642-fe0f",v:["1f935-1f3fb-200d-2642-fe0f","1f935-1f3fc-200d-2642-fe0f","1f935-1f3fd-200d-2642-fe0f","1f935-1f3fe-200d-2642-fe0f","1f935-1f3ff-200d-2642-fe0f"],a:"13.0"},{n:["woman in tuxedo"],u:"1f935-200d-2640-fe0f",v:["1f935-1f3fb-200d-2640-fe0f","1f935-1f3fc-200d-2640-fe0f","1f935-1f3fd-200d-2640-fe0f","1f935-1f3fe-200d-2640-fe0f","1f935-1f3ff-200d-2640-fe0f"],a:"13.0"},{n:["bride with veil"],u:"1f470",v:["1f470-1f3fb","1f470-1f3fc","1f470-1f3fd","1f470-1f3fe","1f470-1f3ff"],a:"0.6"},{n:["man with veil"],u:"1f470-200d-2642-fe0f",v:["1f470-1f3fb-200d-2642-fe0f","1f470-1f3fc-200d-2642-fe0f","1f470-1f3fd-200d-2642-fe0f","1f470-1f3fe-200d-2642-fe0f","1f470-1f3ff-200d-2642-fe0f"],a:"13.0"},{n:["woman with veil"],u:"1f470-200d-2640-fe0f",v:["1f470-1f3fb-200d-2640-fe0f","1f470-1f3fc-200d-2640-fe0f","1f470-1f3fd-200d-2640-fe0f","1f470-1f3fe-200d-2640-fe0f","1f470-1f3ff-200d-2640-fe0f"],a:"13.0"},{n:["pregnant woman"],u:"1f930",v:["1f930-1f3fb","1f930-1f3fc","1f930-1f3fd","1f930-1f3fe","1f930-1f3ff"],a:"3.0"},{n:["pregnant man"],u:"1fac3",v:["1fac3-1f3fb","1fac3-1f3fc","1fac3-1f3fd","1fac3-1f3fe","1fac3-1f3ff"],a:"14.0"},{n:["pregnant person"],u:"1fac4",v:["1fac4-1f3fb","1fac4-1f3fc","1fac4-1f3fd","1fac4-1f3fe","1fac4-1f3ff"],a:"14.0"},{n:["breast-feeding"],u:"1f931",v:["1f931-1f3fb","1f931-1f3fc","1f931-1f3fd","1f931-1f3fe","1f931-1f3ff"],a:"5.0"},{n:["woman feeding baby"],u:"1f469-200d-1f37c",v:["1f469-1f3fb-200d-1f37c","1f469-1f3fc-200d-1f37c","1f469-1f3fd-200d-1f37c","1f469-1f3fe-200d-1f37c","1f469-1f3ff-200d-1f37c"],a:"13.0"},{n:["man feeding baby"],u:"1f468-200d-1f37c",v:["1f468-1f3fb-200d-1f37c","1f468-1f3fc-200d-1f37c","1f468-1f3fd-200d-1f37c","1f468-1f3fe-200d-1f37c","1f468-1f3ff-200d-1f37c"],a:"13.0"},{n:["person feeding baby"],u:"1f9d1-200d-1f37c",v:["1f9d1-1f3fb-200d-1f37c","1f9d1-1f3fc-200d-1f37c","1f9d1-1f3fd-200d-1f37c","1f9d1-1f3fe-200d-1f37c","1f9d1-1f3ff-200d-1f37c"],a:"13.0"},{n:["angel","baby angel"],u:"1f47c",v:["1f47c-1f3fb","1f47c-1f3fc","1f47c-1f3fd","1f47c-1f3fe","1f47c-1f3ff"],a:"0.6"},{n:["santa","father christmas"],u:"1f385",v:["1f385-1f3fb","1f385-1f3fc","1f385-1f3fd","1f385-1f3fe","1f385-1f3ff"],a:"0.6"},{n:["mrs claus","mother christmas"],u:"1f936",v:["1f936-1f3fb","1f936-1f3fc","1f936-1f3fd","1f936-1f3fe","1f936-1f3ff"],a:"3.0"},{n:["mx claus"],u:"1f9d1-200d-1f384",v:["1f9d1-1f3fb-200d-1f384","1f9d1-1f3fc-200d-1f384","1f9d1-1f3fd-200d-1f384","1f9d1-1f3fe-200d-1f384","1f9d1-1f3ff-200d-1f384"],a:"13.0"},{n:["superhero"],u:"1f9b8",v:["1f9b8-1f3fb","1f9b8-1f3fc","1f9b8-1f3fd","1f9b8-1f3fe","1f9b8-1f3ff"],a:"11.0"},{n:["man superhero","male superhero"],u:"1f9b8-200d-2642-fe0f",v:["1f9b8-1f3fb-200d-2642-fe0f","1f9b8-1f3fc-200d-2642-fe0f","1f9b8-1f3fd-200d-2642-fe0f","1f9b8-1f3fe-200d-2642-fe0f","1f9b8-1f3ff-200d-2642-fe0f"],a:"11.0"},{n:["woman superhero","female superhero"],u:"1f9b8-200d-2640-fe0f",v:["1f9b8-1f3fb-200d-2640-fe0f","1f9b8-1f3fc-200d-2640-fe0f","1f9b8-1f3fd-200d-2640-fe0f","1f9b8-1f3fe-200d-2640-fe0f","1f9b8-1f3ff-200d-2640-fe0f"],a:"11.0"},{n:["supervillain"],u:"1f9b9",v:["1f9b9-1f3fb","1f9b9-1f3fc","1f9b9-1f3fd","1f9b9-1f3fe","1f9b9-1f3ff"],a:"11.0"},{n:["man supervillain","male supervillain"],u:"1f9b9-200d-2642-fe0f",v:["1f9b9-1f3fb-200d-2642-fe0f","1f9b9-1f3fc-200d-2642-fe0f","1f9b9-1f3fd-200d-2642-fe0f","1f9b9-1f3fe-200d-2642-fe0f","1f9b9-1f3ff-200d-2642-fe0f"],a:"11.0"},{n:["woman supervillain","female supervillain"],u:"1f9b9-200d-2640-fe0f",v:["1f9b9-1f3fb-200d-2640-fe0f","1f9b9-1f3fc-200d-2640-fe0f","1f9b9-1f3fd-200d-2640-fe0f","1f9b9-1f3fe-200d-2640-fe0f","1f9b9-1f3ff-200d-2640-fe0f"],a:"11.0"},{n:["mage"],u:"1f9d9",v:["1f9d9-1f3fb","1f9d9-1f3fc","1f9d9-1f3fd","1f9d9-1f3fe","1f9d9-1f3ff"],a:"5.0"},{n:["man mage","male mage"],u:"1f9d9-200d-2642-fe0f",v:["1f9d9-1f3fb-200d-2642-fe0f","1f9d9-1f3fc-200d-2642-fe0f","1f9d9-1f3fd-200d-2642-fe0f","1f9d9-1f3fe-200d-2642-fe0f","1f9d9-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman mage","female mage"],u:"1f9d9-200d-2640-fe0f",v:["1f9d9-1f3fb-200d-2640-fe0f","1f9d9-1f3fc-200d-2640-fe0f","1f9d9-1f3fd-200d-2640-fe0f","1f9d9-1f3fe-200d-2640-fe0f","1f9d9-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["fairy"],u:"1f9da",v:["1f9da-1f3fb","1f9da-1f3fc","1f9da-1f3fd","1f9da-1f3fe","1f9da-1f3ff"],a:"5.0"},{n:["man fairy","male fairy"],u:"1f9da-200d-2642-fe0f",v:["1f9da-1f3fb-200d-2642-fe0f","1f9da-1f3fc-200d-2642-fe0f","1f9da-1f3fd-200d-2642-fe0f","1f9da-1f3fe-200d-2642-fe0f","1f9da-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman fairy","female fairy"],u:"1f9da-200d-2640-fe0f",v:["1f9da-1f3fb-200d-2640-fe0f","1f9da-1f3fc-200d-2640-fe0f","1f9da-1f3fd-200d-2640-fe0f","1f9da-1f3fe-200d-2640-fe0f","1f9da-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["vampire"],u:"1f9db",v:["1f9db-1f3fb","1f9db-1f3fc","1f9db-1f3fd","1f9db-1f3fe","1f9db-1f3ff"],a:"5.0"},{n:["man vampire","male vampire"],u:"1f9db-200d-2642-fe0f",v:["1f9db-1f3fb-200d-2642-fe0f","1f9db-1f3fc-200d-2642-fe0f","1f9db-1f3fd-200d-2642-fe0f","1f9db-1f3fe-200d-2642-fe0f","1f9db-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman vampire","female vampire"],u:"1f9db-200d-2640-fe0f",v:["1f9db-1f3fb-200d-2640-fe0f","1f9db-1f3fc-200d-2640-fe0f","1f9db-1f3fd-200d-2640-fe0f","1f9db-1f3fe-200d-2640-fe0f","1f9db-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["merperson"],u:"1f9dc",v:["1f9dc-1f3fb","1f9dc-1f3fc","1f9dc-1f3fd","1f9dc-1f3fe","1f9dc-1f3ff"],a:"5.0"},{n:["merman"],u:"1f9dc-200d-2642-fe0f",v:["1f9dc-1f3fb-200d-2642-fe0f","1f9dc-1f3fc-200d-2642-fe0f","1f9dc-1f3fd-200d-2642-fe0f","1f9dc-1f3fe-200d-2642-fe0f","1f9dc-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["mermaid"],u:"1f9dc-200d-2640-fe0f",v:["1f9dc-1f3fb-200d-2640-fe0f","1f9dc-1f3fc-200d-2640-fe0f","1f9dc-1f3fd-200d-2640-fe0f","1f9dc-1f3fe-200d-2640-fe0f","1f9dc-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["elf"],u:"1f9dd",v:["1f9dd-1f3fb","1f9dd-1f3fc","1f9dd-1f3fd","1f9dd-1f3fe","1f9dd-1f3ff"],a:"5.0"},{n:["man elf","male elf"],u:"1f9dd-200d-2642-fe0f",v:["1f9dd-1f3fb-200d-2642-fe0f","1f9dd-1f3fc-200d-2642-fe0f","1f9dd-1f3fd-200d-2642-fe0f","1f9dd-1f3fe-200d-2642-fe0f","1f9dd-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman elf","female elf"],u:"1f9dd-200d-2640-fe0f",v:["1f9dd-1f3fb-200d-2640-fe0f","1f9dd-1f3fc-200d-2640-fe0f","1f9dd-1f3fd-200d-2640-fe0f","1f9dd-1f3fe-200d-2640-fe0f","1f9dd-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["genie"],u:"1f9de",a:"5.0"},{n:["man genie","male genie"],u:"1f9de-200d-2642-fe0f",a:"5.0"},{n:["woman genie","female genie"],u:"1f9de-200d-2640-fe0f",a:"5.0"},{n:["zombie"],u:"1f9df",a:"5.0"},{n:["man zombie","male zombie"],u:"1f9df-200d-2642-fe0f",a:"5.0"},{n:["woman zombie","female zombie"],u:"1f9df-200d-2640-fe0f",a:"5.0"},{n:["troll"],u:"1f9cc",a:"14.0"},{n:["massage","face massage"],u:"1f486",v:["1f486-1f3fb","1f486-1f3fc","1f486-1f3fd","1f486-1f3fe","1f486-1f3ff"],a:"0.6"},{n:["man getting massage","man-getting-massage"],u:"1f486-200d-2642-fe0f",v:["1f486-1f3fb-200d-2642-fe0f","1f486-1f3fc-200d-2642-fe0f","1f486-1f3fd-200d-2642-fe0f","1f486-1f3fe-200d-2642-fe0f","1f486-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman getting massage","woman-getting-massage"],u:"1f486-200d-2640-fe0f",v:["1f486-1f3fb-200d-2640-fe0f","1f486-1f3fc-200d-2640-fe0f","1f486-1f3fd-200d-2640-fe0f","1f486-1f3fe-200d-2640-fe0f","1f486-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["haircut"],u:"1f487",v:["1f487-1f3fb","1f487-1f3fc","1f487-1f3fd","1f487-1f3fe","1f487-1f3ff"],a:"0.6"},{n:["man getting haircut","man-getting-haircut"],u:"1f487-200d-2642-fe0f",v:["1f487-1f3fb-200d-2642-fe0f","1f487-1f3fc-200d-2642-fe0f","1f487-1f3fd-200d-2642-fe0f","1f487-1f3fe-200d-2642-fe0f","1f487-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman getting haircut","woman-getting-haircut"],u:"1f487-200d-2640-fe0f",v:["1f487-1f3fb-200d-2640-fe0f","1f487-1f3fc-200d-2640-fe0f","1f487-1f3fd-200d-2640-fe0f","1f487-1f3fe-200d-2640-fe0f","1f487-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["walking","pedestrian"],u:"1f6b6",v:["1f6b6-1f3fb","1f6b6-1f3fc","1f6b6-1f3fd","1f6b6-1f3fe","1f6b6-1f3ff"],a:"0.6"},{n:["man walking","man-walking"],u:"1f6b6-200d-2642-fe0f",v:["1f6b6-1f3fb-200d-2642-fe0f","1f6b6-1f3fc-200d-2642-fe0f","1f6b6-1f3fd-200d-2642-fe0f","1f6b6-1f3fe-200d-2642-fe0f","1f6b6-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman walking","woman-walking"],u:"1f6b6-200d-2640-fe0f",v:["1f6b6-1f3fb-200d-2640-fe0f","1f6b6-1f3fc-200d-2640-fe0f","1f6b6-1f3fd-200d-2640-fe0f","1f6b6-1f3fe-200d-2640-fe0f","1f6b6-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["standing person"],u:"1f9cd",v:["1f9cd-1f3fb","1f9cd-1f3fc","1f9cd-1f3fd","1f9cd-1f3fe","1f9cd-1f3ff"],a:"12.0"},{n:["man standing"],u:"1f9cd-200d-2642-fe0f",v:["1f9cd-1f3fb-200d-2642-fe0f","1f9cd-1f3fc-200d-2642-fe0f","1f9cd-1f3fd-200d-2642-fe0f","1f9cd-1f3fe-200d-2642-fe0f","1f9cd-1f3ff-200d-2642-fe0f"],a:"12.0"},{n:["woman standing"],u:"1f9cd-200d-2640-fe0f",v:["1f9cd-1f3fb-200d-2640-fe0f","1f9cd-1f3fc-200d-2640-fe0f","1f9cd-1f3fd-200d-2640-fe0f","1f9cd-1f3fe-200d-2640-fe0f","1f9cd-1f3ff-200d-2640-fe0f"],a:"12.0"},{n:["kneeling person"],u:"1f9ce",v:["1f9ce-1f3fb","1f9ce-1f3fc","1f9ce-1f3fd","1f9ce-1f3fe","1f9ce-1f3ff"],a:"12.0"},{n:["man kneeling"],u:"1f9ce-200d-2642-fe0f",v:["1f9ce-1f3fb-200d-2642-fe0f","1f9ce-1f3fc-200d-2642-fe0f","1f9ce-1f3fd-200d-2642-fe0f","1f9ce-1f3fe-200d-2642-fe0f","1f9ce-1f3ff-200d-2642-fe0f"],a:"12.0"},{n:["woman kneeling"],u:"1f9ce-200d-2640-fe0f",v:["1f9ce-1f3fb-200d-2640-fe0f","1f9ce-1f3fc-200d-2640-fe0f","1f9ce-1f3fd-200d-2640-fe0f","1f9ce-1f3fe-200d-2640-fe0f","1f9ce-1f3ff-200d-2640-fe0f"],a:"12.0"},{n:["person with white cane","person with probing cane"],u:"1f9d1-200d-1f9af",v:["1f9d1-1f3fb-200d-1f9af","1f9d1-1f3fc-200d-1f9af","1f9d1-1f3fd-200d-1f9af","1f9d1-1f3fe-200d-1f9af","1f9d1-1f3ff-200d-1f9af"],a:"12.1"},{n:["man with white cane","man with probing cane"],u:"1f468-200d-1f9af",v:["1f468-1f3fb-200d-1f9af","1f468-1f3fc-200d-1f9af","1f468-1f3fd-200d-1f9af","1f468-1f3fe-200d-1f9af","1f468-1f3ff-200d-1f9af"],a:"12.0"},{n:["woman with white cane","woman with probing cane"],u:"1f469-200d-1f9af",v:["1f469-1f3fb-200d-1f9af","1f469-1f3fc-200d-1f9af","1f469-1f3fd-200d-1f9af","1f469-1f3fe-200d-1f9af","1f469-1f3ff-200d-1f9af"],a:"12.0"},{n:["person in motorized wheelchair"],u:"1f9d1-200d-1f9bc",v:["1f9d1-1f3fb-200d-1f9bc","1f9d1-1f3fc-200d-1f9bc","1f9d1-1f3fd-200d-1f9bc","1f9d1-1f3fe-200d-1f9bc","1f9d1-1f3ff-200d-1f9bc"],a:"12.1"},{n:["man in motorized wheelchair"],u:"1f468-200d-1f9bc",v:["1f468-1f3fb-200d-1f9bc","1f468-1f3fc-200d-1f9bc","1f468-1f3fd-200d-1f9bc","1f468-1f3fe-200d-1f9bc","1f468-1f3ff-200d-1f9bc"],a:"12.0"},{n:["woman in motorized wheelchair"],u:"1f469-200d-1f9bc",v:["1f469-1f3fb-200d-1f9bc","1f469-1f3fc-200d-1f9bc","1f469-1f3fd-200d-1f9bc","1f469-1f3fe-200d-1f9bc","1f469-1f3ff-200d-1f9bc"],a:"12.0"},{n:["person in manual wheelchair"],u:"1f9d1-200d-1f9bd",v:["1f9d1-1f3fb-200d-1f9bd","1f9d1-1f3fc-200d-1f9bd","1f9d1-1f3fd-200d-1f9bd","1f9d1-1f3fe-200d-1f9bd","1f9d1-1f3ff-200d-1f9bd"],a:"12.1"},{n:["man in manual wheelchair"],u:"1f468-200d-1f9bd",v:["1f468-1f3fb-200d-1f9bd","1f468-1f3fc-200d-1f9bd","1f468-1f3fd-200d-1f9bd","1f468-1f3fe-200d-1f9bd","1f468-1f3ff-200d-1f9bd"],a:"12.0"},{n:["woman in manual wheelchair"],u:"1f469-200d-1f9bd",v:["1f469-1f3fb-200d-1f9bd","1f469-1f3fc-200d-1f9bd","1f469-1f3fd-200d-1f9bd","1f469-1f3fe-200d-1f9bd","1f469-1f3ff-200d-1f9bd"],a:"12.0"},{n:["runner","running"],u:"1f3c3",v:["1f3c3-1f3fb","1f3c3-1f3fc","1f3c3-1f3fd","1f3c3-1f3fe","1f3c3-1f3ff"],a:"0.6"},{n:["man running","man-running"],u:"1f3c3-200d-2642-fe0f",v:["1f3c3-1f3fb-200d-2642-fe0f","1f3c3-1f3fc-200d-2642-fe0f","1f3c3-1f3fd-200d-2642-fe0f","1f3c3-1f3fe-200d-2642-fe0f","1f3c3-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman running","woman-running"],u:"1f3c3-200d-2640-fe0f",v:["1f3c3-1f3fb-200d-2640-fe0f","1f3c3-1f3fc-200d-2640-fe0f","1f3c3-1f3fd-200d-2640-fe0f","1f3c3-1f3fe-200d-2640-fe0f","1f3c3-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["dancer"],u:"1f483",v:["1f483-1f3fb","1f483-1f3fc","1f483-1f3fd","1f483-1f3fe","1f483-1f3ff"],a:"0.6"},{n:["man dancing"],u:"1f57a",v:["1f57a-1f3fb","1f57a-1f3fc","1f57a-1f3fd","1f57a-1f3fe","1f57a-1f3ff"],a:"3.0"},{n:["person in suit levitating","man in business suit levitating"],u:"1f574-fe0f",v:["1f574-1f3fb","1f574-1f3fc","1f574-1f3fd","1f574-1f3fe","1f574-1f3ff"],a:"0.7"},{n:["dancers","woman with bunny ears"],u:"1f46f",a:"0.6"},{n:["men with bunny ears","men-with-bunny-ears-partying","man-with-bunny-ears-partying"],u:"1f46f-200d-2642-fe0f",a:"4.0"},{n:["women with bunny ears","women-with-bunny-ears-partying","woman-with-bunny-ears-partying"],u:"1f46f-200d-2640-fe0f",a:"4.0"},{n:["person in steamy room"],u:"1f9d6",v:["1f9d6-1f3fb","1f9d6-1f3fc","1f9d6-1f3fd","1f9d6-1f3fe","1f9d6-1f3ff"],a:"5.0"},{n:["man in steamy room"],u:"1f9d6-200d-2642-fe0f",v:["1f9d6-1f3fb-200d-2642-fe0f","1f9d6-1f3fc-200d-2642-fe0f","1f9d6-1f3fd-200d-2642-fe0f","1f9d6-1f3fe-200d-2642-fe0f","1f9d6-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman in steamy room"],u:"1f9d6-200d-2640-fe0f",v:["1f9d6-1f3fb-200d-2640-fe0f","1f9d6-1f3fc-200d-2640-fe0f","1f9d6-1f3fd-200d-2640-fe0f","1f9d6-1f3fe-200d-2640-fe0f","1f9d6-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["person climbing"],u:"1f9d7",v:["1f9d7-1f3fb","1f9d7-1f3fc","1f9d7-1f3fd","1f9d7-1f3fe","1f9d7-1f3ff"],a:"5.0"},{n:["man climbing"],u:"1f9d7-200d-2642-fe0f",v:["1f9d7-1f3fb-200d-2642-fe0f","1f9d7-1f3fc-200d-2642-fe0f","1f9d7-1f3fd-200d-2642-fe0f","1f9d7-1f3fe-200d-2642-fe0f","1f9d7-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman climbing"],u:"1f9d7-200d-2640-fe0f",v:["1f9d7-1f3fb-200d-2640-fe0f","1f9d7-1f3fc-200d-2640-fe0f","1f9d7-1f3fd-200d-2640-fe0f","1f9d7-1f3fe-200d-2640-fe0f","1f9d7-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["fencer"],u:"1f93a",a:"3.0"},{n:["horse racing"],u:"1f3c7",v:["1f3c7-1f3fb","1f3c7-1f3fc","1f3c7-1f3fd","1f3c7-1f3fe","1f3c7-1f3ff"],a:"1.0"},{n:["skier"],u:"26f7-fe0f",a:"0.7"},{n:["snowboarder"],u:"1f3c2",v:["1f3c2-1f3fb","1f3c2-1f3fc","1f3c2-1f3fd","1f3c2-1f3fe","1f3c2-1f3ff"],a:"0.6"},{n:["golfer","person golfing"],u:"1f3cc-fe0f",v:["1f3cc-1f3fb","1f3cc-1f3fc","1f3cc-1f3fd","1f3cc-1f3fe","1f3cc-1f3ff"],a:"0.7"},{n:["man golfing","man-golfing"],u:"1f3cc-fe0f-200d-2642-fe0f",v:["1f3cc-1f3fb-200d-2642-fe0f","1f3cc-1f3fc-200d-2642-fe0f","1f3cc-1f3fd-200d-2642-fe0f","1f3cc-1f3fe-200d-2642-fe0f","1f3cc-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman golfing","woman-golfing"],u:"1f3cc-fe0f-200d-2640-fe0f",v:["1f3cc-1f3fb-200d-2640-fe0f","1f3cc-1f3fc-200d-2640-fe0f","1f3cc-1f3fd-200d-2640-fe0f","1f3cc-1f3fe-200d-2640-fe0f","1f3cc-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["surfer"],u:"1f3c4",v:["1f3c4-1f3fb","1f3c4-1f3fc","1f3c4-1f3fd","1f3c4-1f3fe","1f3c4-1f3ff"],a:"0.6"},{n:["man surfing","man-surfing"],u:"1f3c4-200d-2642-fe0f",v:["1f3c4-1f3fb-200d-2642-fe0f","1f3c4-1f3fc-200d-2642-fe0f","1f3c4-1f3fd-200d-2642-fe0f","1f3c4-1f3fe-200d-2642-fe0f","1f3c4-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman surfing","woman-surfing"],u:"1f3c4-200d-2640-fe0f",v:["1f3c4-1f3fb-200d-2640-fe0f","1f3c4-1f3fc-200d-2640-fe0f","1f3c4-1f3fd-200d-2640-fe0f","1f3c4-1f3fe-200d-2640-fe0f","1f3c4-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["rowboat"],u:"1f6a3",v:["1f6a3-1f3fb","1f6a3-1f3fc","1f6a3-1f3fd","1f6a3-1f3fe","1f6a3-1f3ff"],a:"1.0"},{n:["man rowing boat","man-rowing-boat"],u:"1f6a3-200d-2642-fe0f",v:["1f6a3-1f3fb-200d-2642-fe0f","1f6a3-1f3fc-200d-2642-fe0f","1f6a3-1f3fd-200d-2642-fe0f","1f6a3-1f3fe-200d-2642-fe0f","1f6a3-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman rowing boat","woman-rowing-boat"],u:"1f6a3-200d-2640-fe0f",v:["1f6a3-1f3fb-200d-2640-fe0f","1f6a3-1f3fc-200d-2640-fe0f","1f6a3-1f3fd-200d-2640-fe0f","1f6a3-1f3fe-200d-2640-fe0f","1f6a3-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["swimmer"],u:"1f3ca",v:["1f3ca-1f3fb","1f3ca-1f3fc","1f3ca-1f3fd","1f3ca-1f3fe","1f3ca-1f3ff"],a:"0.6"},{n:["man swimming","man-swimming"],u:"1f3ca-200d-2642-fe0f",v:["1f3ca-1f3fb-200d-2642-fe0f","1f3ca-1f3fc-200d-2642-fe0f","1f3ca-1f3fd-200d-2642-fe0f","1f3ca-1f3fe-200d-2642-fe0f","1f3ca-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman swimming","woman-swimming"],u:"1f3ca-200d-2640-fe0f",v:["1f3ca-1f3fb-200d-2640-fe0f","1f3ca-1f3fc-200d-2640-fe0f","1f3ca-1f3fd-200d-2640-fe0f","1f3ca-1f3fe-200d-2640-fe0f","1f3ca-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["person with ball","person bouncing ball"],u:"26f9-fe0f",v:["26f9-1f3fb","26f9-1f3fc","26f9-1f3fd","26f9-1f3fe","26f9-1f3ff"],a:"0.7"},{n:["man bouncing ball","man-bouncing-ball"],u:"26f9-fe0f-200d-2642-fe0f",v:["26f9-1f3fb-200d-2642-fe0f","26f9-1f3fc-200d-2642-fe0f","26f9-1f3fd-200d-2642-fe0f","26f9-1f3fe-200d-2642-fe0f","26f9-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman bouncing ball","woman-bouncing-ball"],u:"26f9-fe0f-200d-2640-fe0f",v:["26f9-1f3fb-200d-2640-fe0f","26f9-1f3fc-200d-2640-fe0f","26f9-1f3fd-200d-2640-fe0f","26f9-1f3fe-200d-2640-fe0f","26f9-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["weight lifter","person lifting weights"],u:"1f3cb-fe0f",v:["1f3cb-1f3fb","1f3cb-1f3fc","1f3cb-1f3fd","1f3cb-1f3fe","1f3cb-1f3ff"],a:"0.7"},{n:["man lifting weights","man-lifting-weights"],u:"1f3cb-fe0f-200d-2642-fe0f",v:["1f3cb-1f3fb-200d-2642-fe0f","1f3cb-1f3fc-200d-2642-fe0f","1f3cb-1f3fd-200d-2642-fe0f","1f3cb-1f3fe-200d-2642-fe0f","1f3cb-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman lifting weights","woman-lifting-weights"],u:"1f3cb-fe0f-200d-2640-fe0f",v:["1f3cb-1f3fb-200d-2640-fe0f","1f3cb-1f3fc-200d-2640-fe0f","1f3cb-1f3fd-200d-2640-fe0f","1f3cb-1f3fe-200d-2640-fe0f","1f3cb-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["bicyclist"],u:"1f6b4",v:["1f6b4-1f3fb","1f6b4-1f3fc","1f6b4-1f3fd","1f6b4-1f3fe","1f6b4-1f3ff"],a:"1.0"},{n:["man biking","man-biking"],u:"1f6b4-200d-2642-fe0f",v:["1f6b4-1f3fb-200d-2642-fe0f","1f6b4-1f3fc-200d-2642-fe0f","1f6b4-1f3fd-200d-2642-fe0f","1f6b4-1f3fe-200d-2642-fe0f","1f6b4-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman biking","woman-biking"],u:"1f6b4-200d-2640-fe0f",v:["1f6b4-1f3fb-200d-2640-fe0f","1f6b4-1f3fc-200d-2640-fe0f","1f6b4-1f3fd-200d-2640-fe0f","1f6b4-1f3fe-200d-2640-fe0f","1f6b4-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["mountain bicyclist"],u:"1f6b5",v:["1f6b5-1f3fb","1f6b5-1f3fc","1f6b5-1f3fd","1f6b5-1f3fe","1f6b5-1f3ff"],a:"1.0"},{n:["man mountain biking","man-mountain-biking"],u:"1f6b5-200d-2642-fe0f",v:["1f6b5-1f3fb-200d-2642-fe0f","1f6b5-1f3fc-200d-2642-fe0f","1f6b5-1f3fd-200d-2642-fe0f","1f6b5-1f3fe-200d-2642-fe0f","1f6b5-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman mountain biking","woman-mountain-biking"],u:"1f6b5-200d-2640-fe0f",v:["1f6b5-1f3fb-200d-2640-fe0f","1f6b5-1f3fc-200d-2640-fe0f","1f6b5-1f3fd-200d-2640-fe0f","1f6b5-1f3fe-200d-2640-fe0f","1f6b5-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["person doing cartwheel"],u:"1f938",v:["1f938-1f3fb","1f938-1f3fc","1f938-1f3fd","1f938-1f3fe","1f938-1f3ff"],a:"3.0"},{n:["man cartwheeling","man-cartwheeling"],u:"1f938-200d-2642-fe0f",v:["1f938-1f3fb-200d-2642-fe0f","1f938-1f3fc-200d-2642-fe0f","1f938-1f3fd-200d-2642-fe0f","1f938-1f3fe-200d-2642-fe0f","1f938-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman cartwheeling","woman-cartwheeling"],u:"1f938-200d-2640-fe0f",v:["1f938-1f3fb-200d-2640-fe0f","1f938-1f3fc-200d-2640-fe0f","1f938-1f3fd-200d-2640-fe0f","1f938-1f3fe-200d-2640-fe0f","1f938-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["wrestlers"],u:"1f93c",a:"3.0"},{n:["men wrestling","man-wrestling"],u:"1f93c-200d-2642-fe0f",a:"4.0"},{n:["women wrestling","woman-wrestling"],u:"1f93c-200d-2640-fe0f",a:"4.0"},{n:["water polo"],u:"1f93d",v:["1f93d-1f3fb","1f93d-1f3fc","1f93d-1f3fd","1f93d-1f3fe","1f93d-1f3ff"],a:"3.0"},{n:["man playing water polo","man-playing-water-polo"],u:"1f93d-200d-2642-fe0f",v:["1f93d-1f3fb-200d-2642-fe0f","1f93d-1f3fc-200d-2642-fe0f","1f93d-1f3fd-200d-2642-fe0f","1f93d-1f3fe-200d-2642-fe0f","1f93d-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman playing water polo","woman-playing-water-polo"],u:"1f93d-200d-2640-fe0f",v:["1f93d-1f3fb-200d-2640-fe0f","1f93d-1f3fc-200d-2640-fe0f","1f93d-1f3fd-200d-2640-fe0f","1f93d-1f3fe-200d-2640-fe0f","1f93d-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["handball"],u:"1f93e",v:["1f93e-1f3fb","1f93e-1f3fc","1f93e-1f3fd","1f93e-1f3fe","1f93e-1f3ff"],a:"3.0"},{n:["man playing handball","man-playing-handball"],u:"1f93e-200d-2642-fe0f",v:["1f93e-1f3fb-200d-2642-fe0f","1f93e-1f3fc-200d-2642-fe0f","1f93e-1f3fd-200d-2642-fe0f","1f93e-1f3fe-200d-2642-fe0f","1f93e-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman playing handball","woman-playing-handball"],u:"1f93e-200d-2640-fe0f",v:["1f93e-1f3fb-200d-2640-fe0f","1f93e-1f3fc-200d-2640-fe0f","1f93e-1f3fd-200d-2640-fe0f","1f93e-1f3fe-200d-2640-fe0f","1f93e-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["juggling"],u:"1f939",v:["1f939-1f3fb","1f939-1f3fc","1f939-1f3fd","1f939-1f3fe","1f939-1f3ff"],a:"3.0"},{n:["man juggling","man-juggling"],u:"1f939-200d-2642-fe0f",v:["1f939-1f3fb-200d-2642-fe0f","1f939-1f3fc-200d-2642-fe0f","1f939-1f3fd-200d-2642-fe0f","1f939-1f3fe-200d-2642-fe0f","1f939-1f3ff-200d-2642-fe0f"],a:"4.0"},{n:["woman juggling","woman-juggling"],u:"1f939-200d-2640-fe0f",v:["1f939-1f3fb-200d-2640-fe0f","1f939-1f3fc-200d-2640-fe0f","1f939-1f3fd-200d-2640-fe0f","1f939-1f3fe-200d-2640-fe0f","1f939-1f3ff-200d-2640-fe0f"],a:"4.0"},{n:["person in lotus position"],u:"1f9d8",v:["1f9d8-1f3fb","1f9d8-1f3fc","1f9d8-1f3fd","1f9d8-1f3fe","1f9d8-1f3ff"],a:"5.0"},{n:["man in lotus position"],u:"1f9d8-200d-2642-fe0f",v:["1f9d8-1f3fb-200d-2642-fe0f","1f9d8-1f3fc-200d-2642-fe0f","1f9d8-1f3fd-200d-2642-fe0f","1f9d8-1f3fe-200d-2642-fe0f","1f9d8-1f3ff-200d-2642-fe0f"],a:"5.0"},{n:["woman in lotus position"],u:"1f9d8-200d-2640-fe0f",v:["1f9d8-1f3fb-200d-2640-fe0f","1f9d8-1f3fc-200d-2640-fe0f","1f9d8-1f3fd-200d-2640-fe0f","1f9d8-1f3fe-200d-2640-fe0f","1f9d8-1f3ff-200d-2640-fe0f"],a:"5.0"},{n:["bath"],u:"1f6c0",v:["1f6c0-1f3fb","1f6c0-1f3fc","1f6c0-1f3fd","1f6c0-1f3fe","1f6c0-1f3ff"],a:"0.6"},{n:["sleeping accommodation"],u:"1f6cc",v:["1f6cc-1f3fb","1f6cc-1f3fc","1f6cc-1f3fd","1f6cc-1f3fe","1f6cc-1f3ff"],a:"1.0"},{n:["people holding hands"],u:"1f9d1-200d-1f91d-200d-1f9d1",v:["1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fb","1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fc","1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fd","1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fe","1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3ff","1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fb","1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fc","1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fd","1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fe","1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3ff","1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fb","1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fc","1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fd","1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fe","1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3ff","1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fb","1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fc","1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fd","1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fe","1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3ff","1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fb","1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fc","1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fd","1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fe","1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3ff"],a:"12.0"},{n:["women holding hands","two women holding hands"],u:"1f46d",v:["1f46d-1f3fb","1f46d-1f3fc","1f46d-1f3fd","1f46d-1f3fe","1f46d-1f3ff","1f469-1f3fb-200d-1f91d-200d-1f469-1f3fc","1f469-1f3fb-200d-1f91d-200d-1f469-1f3fd","1f469-1f3fb-200d-1f91d-200d-1f469-1f3fe","1f469-1f3fb-200d-1f91d-200d-1f469-1f3ff","1f469-1f3fc-200d-1f91d-200d-1f469-1f3fb","1f469-1f3fc-200d-1f91d-200d-1f469-1f3fd","1f469-1f3fc-200d-1f91d-200d-1f469-1f3fe","1f469-1f3fc-200d-1f91d-200d-1f469-1f3ff","1f469-1f3fd-200d-1f91d-200d-1f469-1f3fb","1f469-1f3fd-200d-1f91d-200d-1f469-1f3fc","1f469-1f3fd-200d-1f91d-200d-1f469-1f3fe","1f469-1f3fd-200d-1f91d-200d-1f469-1f3ff","1f469-1f3fe-200d-1f91d-200d-1f469-1f3fb","1f469-1f3fe-200d-1f91d-200d-1f469-1f3fc","1f469-1f3fe-200d-1f91d-200d-1f469-1f3fd","1f469-1f3fe-200d-1f91d-200d-1f469-1f3ff","1f469-1f3ff-200d-1f91d-200d-1f469-1f3fb","1f469-1f3ff-200d-1f91d-200d-1f469-1f3fc","1f469-1f3ff-200d-1f91d-200d-1f469-1f3fd","1f469-1f3ff-200d-1f91d-200d-1f469-1f3fe"],a:"1.0"},{n:["couple","man and woman holding hands","woman and man holding hands"],u:"1f46b",v:["1f46b-1f3fb","1f46b-1f3fc","1f46b-1f3fd","1f46b-1f3fe","1f46b-1f3ff","1f469-1f3fb-200d-1f91d-200d-1f468-1f3fc","1f469-1f3fb-200d-1f91d-200d-1f468-1f3fd","1f469-1f3fb-200d-1f91d-200d-1f468-1f3fe","1f469-1f3fb-200d-1f91d-200d-1f468-1f3ff","1f469-1f3fc-200d-1f91d-200d-1f468-1f3fb","1f469-1f3fc-200d-1f91d-200d-1f468-1f3fd","1f469-1f3fc-200d-1f91d-200d-1f468-1f3fe","1f469-1f3fc-200d-1f91d-200d-1f468-1f3ff","1f469-1f3fd-200d-1f91d-200d-1f468-1f3fb","1f469-1f3fd-200d-1f91d-200d-1f468-1f3fc","1f469-1f3fd-200d-1f91d-200d-1f468-1f3fe","1f469-1f3fd-200d-1f91d-200d-1f468-1f3ff","1f469-1f3fe-200d-1f91d-200d-1f468-1f3fb","1f469-1f3fe-200d-1f91d-200d-1f468-1f3fc","1f469-1f3fe-200d-1f91d-200d-1f468-1f3fd","1f469-1f3fe-200d-1f91d-200d-1f468-1f3ff","1f469-1f3ff-200d-1f91d-200d-1f468-1f3fb","1f469-1f3ff-200d-1f91d-200d-1f468-1f3fc","1f469-1f3ff-200d-1f91d-200d-1f468-1f3fd","1f469-1f3ff-200d-1f91d-200d-1f468-1f3fe"],a:"0.6"},{n:["men holding hands","two men holding hands"],u:"1f46c",v:["1f46c-1f3fb","1f46c-1f3fc","1f46c-1f3fd","1f46c-1f3fe","1f46c-1f3ff","1f468-1f3fb-200d-1f91d-200d-1f468-1f3fc","1f468-1f3fb-200d-1f91d-200d-1f468-1f3fd","1f468-1f3fb-200d-1f91d-200d-1f468-1f3fe","1f468-1f3fb-200d-1f91d-200d-1f468-1f3ff","1f468-1f3fc-200d-1f91d-200d-1f468-1f3fb","1f468-1f3fc-200d-1f91d-200d-1f468-1f3fd","1f468-1f3fc-200d-1f91d-200d-1f468-1f3fe","1f468-1f3fc-200d-1f91d-200d-1f468-1f3ff","1f468-1f3fd-200d-1f91d-200d-1f468-1f3fb","1f468-1f3fd-200d-1f91d-200d-1f468-1f3fc","1f468-1f3fd-200d-1f91d-200d-1f468-1f3fe","1f468-1f3fd-200d-1f91d-200d-1f468-1f3ff","1f468-1f3fe-200d-1f91d-200d-1f468-1f3fb","1f468-1f3fe-200d-1f91d-200d-1f468-1f3fc","1f468-1f3fe-200d-1f91d-200d-1f468-1f3fd","1f468-1f3fe-200d-1f91d-200d-1f468-1f3ff","1f468-1f3ff-200d-1f91d-200d-1f468-1f3fb","1f468-1f3ff-200d-1f91d-200d-1f468-1f3fc","1f468-1f3ff-200d-1f91d-200d-1f468-1f3fd","1f468-1f3ff-200d-1f91d-200d-1f468-1f3fe"],a:"1.0"},{n:["kiss","couplekiss"],u:"1f48f",v:["1f48f-1f3fb","1f48f-1f3fc","1f48f-1f3fd","1f48f-1f3fe","1f48f-1f3ff","1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc","1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd","1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe","1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff","1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb","1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd","1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe","1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff","1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb","1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc","1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe","1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff","1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb","1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc","1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd","1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff","1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb","1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc","1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd","1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe"],a:"0.6"},{n:["woman-kiss-man","kiss: woman, man"],u:"1f469-200d-2764-fe0f-200d-1f48b-200d-1f468",v:["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff"],a:"2.0"},{n:["man-kiss-man","kiss: man, man"],u:"1f468-200d-2764-fe0f-200d-1f48b-200d-1f468",v:["1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff","1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb","1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc","1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd","1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe","1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff"],a:"2.0"},{n:["woman-kiss-woman","kiss: woman, woman"],u:"1f469-200d-2764-fe0f-200d-1f48b-200d-1f469",v:["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe","1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe","1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe","1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe","1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe","1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff"],a:"2.0"},{n:["couple with heart"],u:"1f491",v:["1f491-1f3fb","1f491-1f3fc","1f491-1f3fd","1f491-1f3fe","1f491-1f3ff","1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3fc","1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3fd","1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3fe","1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3ff","1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3fb","1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3fd","1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3fe","1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3ff","1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3fb","1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3fc","1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3fe","1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3ff","1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3fb","1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3fc","1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3fd","1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3ff","1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fb","1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fc","1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fd","1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fe"],a:"0.6"},{n:["woman-heart-man","couple with heart: woman, man"],u:"1f469-200d-2764-fe0f-200d-1f468",v:["1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fb","1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fc","1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fd","1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fe","1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3ff","1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fb","1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fc","1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fd","1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fe","1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3ff","1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fb","1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fc","1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fd","1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fe","1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3ff","1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fb","1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fc","1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fd","1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fe","1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3ff","1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fb","1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fc","1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fd","1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fe","1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3ff"],a:"2.0"},{n:["man-heart-man","couple with heart: man, man"],u:"1f468-200d-2764-fe0f-200d-1f468",v:["1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fb","1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fc","1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fd","1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fe","1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3ff","1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fb","1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fc","1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fd","1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fe","1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3ff","1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fb","1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fc","1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fd","1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fe","1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3ff","1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fb","1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fc","1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fd","1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fe","1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3ff","1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fb","1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fc","1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fd","1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fe","1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3ff"],a:"2.0"},{n:["woman-heart-woman","couple with heart: woman, woman"],u:"1f469-200d-2764-fe0f-200d-1f469",v:["1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fb","1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fc","1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fd","1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fe","1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3ff","1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fb","1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fc","1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fd","1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fe","1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3ff","1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fb","1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fc","1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fd","1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fe","1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3ff","1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fb","1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fc","1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fd","1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fe","1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3ff","1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fb","1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fc","1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fd","1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fe","1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3ff"],a:"2.0"},{n:["family"],u:"1f46a",a:"0.6"},{n:["man-woman-boy","family: man, woman, boy"],u:"1f468-200d-1f469-200d-1f466",a:"2.0"},{n:["man-woman-girl","family: man, woman, girl"],u:"1f468-200d-1f469-200d-1f467",a:"2.0"},{n:["man-woman-girl-boy","family: man, woman, girl, boy"],u:"1f468-200d-1f469-200d-1f467-200d-1f466",a:"2.0"},{n:["man-woman-boy-boy","family: man, woman, boy, boy"],u:"1f468-200d-1f469-200d-1f466-200d-1f466",a:"2.0"},{n:["man-woman-girl-girl","family: man, woman, girl, girl"],u:"1f468-200d-1f469-200d-1f467-200d-1f467",a:"2.0"},{n:["man-man-boy","family: man, man, boy"],u:"1f468-200d-1f468-200d-1f466",a:"2.0"},{n:["man-man-girl","family: man, man, girl"],u:"1f468-200d-1f468-200d-1f467",a:"2.0"},{n:["man-man-girl-boy","family: man, man, girl, boy"],u:"1f468-200d-1f468-200d-1f467-200d-1f466",a:"2.0"},{n:["man-man-boy-boy","family: man, man, boy, boy"],u:"1f468-200d-1f468-200d-1f466-200d-1f466",a:"2.0"},{n:["man-man-girl-girl","family: man, man, girl, girl"],u:"1f468-200d-1f468-200d-1f467-200d-1f467",a:"2.0"},{n:["woman-woman-boy","family: woman, woman, boy"],u:"1f469-200d-1f469-200d-1f466",a:"2.0"},{n:["woman-woman-girl","family: woman, woman, girl"],u:"1f469-200d-1f469-200d-1f467",a:"2.0"},{n:["woman-woman-girl-boy","family: woman, woman, girl, boy"],u:"1f469-200d-1f469-200d-1f467-200d-1f466",a:"2.0"},{n:["woman-woman-boy-boy","family: woman, woman, boy, boy"],u:"1f469-200d-1f469-200d-1f466-200d-1f466",a:"2.0"},{n:["woman-woman-girl-girl","family: woman, woman, girl, girl"],u:"1f469-200d-1f469-200d-1f467-200d-1f467",a:"2.0"},{n:["man-boy","family: man, boy"],u:"1f468-200d-1f466",a:"4.0"},{n:["man-boy-boy","family: man, boy, boy"],u:"1f468-200d-1f466-200d-1f466",a:"4.0"},{n:["man-girl","family: man, girl"],u:"1f468-200d-1f467",a:"4.0"},{n:["man-girl-boy","family: man, girl, boy"],u:"1f468-200d-1f467-200d-1f466",a:"4.0"},{n:["man-girl-girl","family: man, girl, girl"],u:"1f468-200d-1f467-200d-1f467",a:"4.0"},{n:["woman-boy","family: woman, boy"],u:"1f469-200d-1f466",a:"4.0"},{n:["woman-boy-boy","family: woman, boy, boy"],u:"1f469-200d-1f466-200d-1f466",a:"4.0"},{n:["woman-girl","family: woman, girl"],u:"1f469-200d-1f467",a:"4.0"},{n:["woman-girl-boy","family: woman, girl, boy"],u:"1f469-200d-1f467-200d-1f466",a:"4.0"},{n:["woman-girl-girl","family: woman, girl, girl"],u:"1f469-200d-1f467-200d-1f467",a:"4.0"},{n:["speaking head","speaking head in silhouette"],u:"1f5e3-fe0f",a:"0.7"},{n:["bust in silhouette"],u:"1f464",a:"0.6"},{n:["busts in silhouette"],u:"1f465",a:"1.0"},{n:["people hugging"],u:"1fac2",a:"13.0"},{n:["footprints"],u:"1f463",a:"0.6"}],animals_nature:[{n:["monkey face"],u:"1f435",a:"0.6"},{n:["monkey"],u:"1f412",a:"0.6"},{n:["gorilla"],u:"1f98d",a:"3.0"},{n:["orangutan"],u:"1f9a7",a:"12.0"},{n:["dog","dog face"],u:"1f436",a:"0.6"},{n:["dog","dog2"],u:"1f415",a:"0.7"},{n:["guide dog"],u:"1f9ae",a:"12.0"},{n:["service dog"],u:"1f415-200d-1f9ba",a:"12.0"},{n:["poodle"],u:"1f429",a:"0.6"},{n:["wolf","wolf face"],u:"1f43a",a:"0.6"},{n:["fox face"],u:"1f98a",a:"3.0"},{n:["raccoon"],u:"1f99d",a:"11.0"},{n:["cat","cat face"],u:"1f431",a:"0.6"},{n:["cat","cat2"],u:"1f408",a:"0.7"},{n:["black cat"],u:"1f408-200d-2b1b",a:"13.0"},{n:["lion face"],u:"1f981",a:"1.0"},{n:["tiger","tiger face"],u:"1f42f",a:"0.6"},{n:["tiger","tiger2"],u:"1f405",a:"1.0"},{n:["leopard"],u:"1f406",a:"1.0"},{n:["horse","horse face"],u:"1f434",a:"0.6"},{n:["horse","racehorse"],u:"1f40e",a:"0.6"},{n:["unicorn face"],u:"1f984",a:"1.0"},{n:["zebra face"],u:"1f993",a:"5.0"},{n:["deer"],u:"1f98c",a:"3.0"},{n:["bison"],u:"1f9ac",a:"13.0"},{n:["cow","cow face"],u:"1f42e",a:"0.6"},{n:["ox"],u:"1f402",a:"1.0"},{n:["water buffalo"],u:"1f403",a:"1.0"},{n:["cow","cow2"],u:"1f404",a:"1.0"},{n:["pig","pig face"],u:"1f437",a:"0.6"},{n:["pig","pig2"],u:"1f416",a:"1.0"},{n:["boar"],u:"1f417",a:"0.6"},{n:["pig nose"],u:"1f43d",a:"0.6"},{n:["ram"],u:"1f40f",a:"1.0"},{n:["sheep"],u:"1f411",a:"0.6"},{n:["goat"],u:"1f410",a:"1.0"},{n:["dromedary camel"],u:"1f42a",a:"1.0"},{n:["camel","bactrian camel"],u:"1f42b",a:"0.6"},{n:["llama"],u:"1f999",a:"11.0"},{n:["giraffe face"],u:"1f992",a:"5.0"},{n:["elephant"],u:"1f418",a:"0.6"},{n:["mammoth"],u:"1f9a3",a:"13.0"},{n:["rhinoceros"],u:"1f98f",a:"3.0"},{n:["hippopotamus"],u:"1f99b",a:"11.0"},{n:["mouse","mouse face"],u:"1f42d",a:"0.6"},{n:["mouse","mouse2"],u:"1f401",a:"1.0"},{n:["rat"],u:"1f400",a:"1.0"},{n:["hamster","hamster face"],u:"1f439",a:"0.6"},{n:["rabbit","rabbit face"],u:"1f430",a:"0.6"},{n:["rabbit","rabbit2"],u:"1f407",a:"1.0"},{n:["chipmunk"],u:"1f43f-fe0f",a:"0.7"},{n:["beaver"],u:"1f9ab",a:"13.0"},{n:["hedgehog"],u:"1f994",a:"5.0"},{n:["bat"],u:"1f987",a:"3.0"},{n:["bear","bear face"],u:"1f43b",a:"0.6"},{n:["polar bear"],u:"1f43b-200d-2744-fe0f",a:"13.0"},{n:["koala"],u:"1f428",a:"0.6"},{n:["panda face"],u:"1f43c",a:"0.6"},{n:["sloth"],u:"1f9a5",a:"12.0"},{n:["otter"],u:"1f9a6",a:"12.0"},{n:["skunk"],u:"1f9a8",a:"12.0"},{n:["kangaroo"],u:"1f998",a:"11.0"},{n:["badger"],u:"1f9a1",a:"11.0"},{n:["feet","paw prints"],u:"1f43e",a:"0.6"},{n:["turkey"],u:"1f983",a:"1.0"},{n:["chicken"],u:"1f414",a:"0.6"},{n:["rooster"],u:"1f413",a:"1.0"},{n:["hatching chick"],u:"1f423",a:"0.6"},{n:["baby chick"],u:"1f424",a:"0.6"},{n:["hatched chick","front-facing baby chick"],u:"1f425",a:"0.6"},{n:["bird"],u:"1f426",a:"0.6"},{n:["penguin"],u:"1f427",a:"0.6"},{n:["dove","dove of peace"],u:"1f54a-fe0f",a:"0.7"},{n:["eagle"],u:"1f985",a:"3.0"},{n:["duck"],u:"1f986",a:"3.0"},{n:["swan"],u:"1f9a2",a:"11.0"},{n:["owl"],u:"1f989",a:"3.0"},{n:["dodo"],u:"1f9a4",a:"13.0"},{n:["feather"],u:"1fab6",a:"13.0"},{n:["flamingo"],u:"1f9a9",a:"12.0"},{n:["peacock"],u:"1f99a",a:"11.0"},{n:["parrot"],u:"1f99c",a:"11.0"},{n:["frog","frog face"],u:"1f438",a:"0.6"},{n:["crocodile"],u:"1f40a",a:"1.0"},{n:["turtle"],u:"1f422",a:"0.6"},{n:["lizard"],u:"1f98e",a:"3.0"},{n:["snake"],u:"1f40d",a:"0.6"},{n:["dragon face"],u:"1f432",a:"0.6"},{n:["dragon"],u:"1f409",a:"1.0"},{n:["sauropod"],u:"1f995",a:"5.0"},{n:["t-rex"],u:"1f996",a:"5.0"},{n:["whale","spouting whale"],u:"1f433",a:"0.6"},{n:["whale","whale2"],u:"1f40b",a:"1.0"},{n:["dolphin","flipper"],u:"1f42c",a:"0.6"},{n:["seal"],u:"1f9ad",a:"13.0"},{n:["fish"],u:"1f41f",a:"0.6"},{n:["tropical fish"],u:"1f420",a:"0.6"},{n:["blowfish"],u:"1f421",a:"0.6"},{n:["shark"],u:"1f988",a:"3.0"},{n:["octopus"],u:"1f419",a:"0.6"},{n:["shell","spiral shell"],u:"1f41a",a:"0.6"},{n:["coral"],u:"1fab8",a:"14.0"},{n:["snail"],u:"1f40c",a:"0.6"},{n:["butterfly"],u:"1f98b",a:"3.0"},{n:["bug"],u:"1f41b",a:"0.6"},{n:["ant"],u:"1f41c",a:"0.6"},{n:["bee","honeybee"],u:"1f41d",a:"0.6"},{n:["beetle"],u:"1fab2",a:"13.0"},{n:["ladybug","lady beetle"],u:"1f41e",a:"0.6"},{n:["cricket"],u:"1f997",a:"5.0"},{n:["cockroach"],u:"1fab3",a:"13.0"},{n:["spider"],u:"1f577-fe0f",a:"0.7"},{n:["spider web"],u:"1f578-fe0f",a:"0.7"},{n:["scorpion"],u:"1f982",a:"1.0"},{n:["mosquito"],u:"1f99f",a:"11.0"},{n:["fly"],u:"1fab0",a:"13.0"},{n:["worm"],u:"1fab1",a:"13.0"},{n:["microbe"],u:"1f9a0",a:"11.0"},{n:["bouquet"],u:"1f490",a:"0.6"},{n:["cherry blossom"],u:"1f338",a:"0.6"},{n:["white flower"],u:"1f4ae",a:"0.6"},{n:["lotus"],u:"1fab7",a:"14.0"},{n:["rosette"],u:"1f3f5-fe0f",a:"0.7"},{n:["rose"],u:"1f339",a:"0.6"},{n:["wilted flower"],u:"1f940",a:"3.0"},{n:["hibiscus"],u:"1f33a",a:"0.6"},{n:["sunflower"],u:"1f33b",a:"0.6"},{n:["blossom"],u:"1f33c",a:"0.6"},{n:["tulip"],u:"1f337",a:"0.6"},{n:["seedling"],u:"1f331",a:"0.6"},{n:["potted plant"],u:"1fab4",a:"13.0"},{n:["evergreen tree"],u:"1f332",a:"1.0"},{n:["deciduous tree"],u:"1f333",a:"1.0"},{n:["palm tree"],u:"1f334",a:"0.6"},{n:["cactus"],u:"1f335",a:"0.6"},{n:["ear of rice"],u:"1f33e",a:"0.6"},{n:["herb"],u:"1f33f",a:"0.6"},{n:["shamrock"],u:"2618-fe0f",a:"1.0"},{n:["four leaf clover"],u:"1f340",a:"0.6"},{n:["maple leaf"],u:"1f341",a:"0.6"},{n:["fallen leaf"],u:"1f342",a:"0.6"},{n:["leaves","leaf fluttering in wind"],u:"1f343",a:"0.6"},{n:["empty nest"],u:"1fab9",a:"14.0"},{n:["nest with eggs"],u:"1faba",a:"14.0"}],food_drink:[{n:["grapes"],u:"1f347",a:"0.6"},{n:["melon"],u:"1f348",a:"0.6"},{n:["watermelon"],u:"1f349",a:"0.6"},{n:["tangerine"],u:"1f34a",a:"0.6"},{n:["lemon"],u:"1f34b",a:"1.0"},{n:["banana"],u:"1f34c",a:"0.6"},{n:["pineapple"],u:"1f34d",a:"0.6"},{n:["mango"],u:"1f96d",a:"11.0"},{n:["apple","red apple"],u:"1f34e",a:"0.6"},{n:["green apple"],u:"1f34f",a:"0.6"},{n:["pear"],u:"1f350",a:"1.0"},{n:["peach"],u:"1f351",a:"0.6"},{n:["cherries"],u:"1f352",a:"0.6"},{n:["strawberry"],u:"1f353",a:"0.6"},{n:["blueberries"],u:"1fad0",a:"13.0"},{n:["kiwifruit"],u:"1f95d",a:"3.0"},{n:["tomato"],u:"1f345",a:"0.6"},{n:["olive"],u:"1fad2",a:"13.0"},{n:["coconut"],u:"1f965",a:"5.0"},{n:["avocado"],u:"1f951",a:"3.0"},{n:["eggplant","aubergine"],u:"1f346",a:"0.6"},{n:["potato"],u:"1f954",a:"3.0"},{n:["carrot"],u:"1f955",a:"3.0"},{n:["corn","ear of maize"],u:"1f33d",a:"0.6"},{n:["hot pepper"],u:"1f336-fe0f",a:"0.7"},{n:["bell pepper"],u:"1fad1",a:"13.0"},{n:["cucumber"],u:"1f952",a:"3.0"},{n:["leafy green"],u:"1f96c",a:"11.0"},{n:["broccoli"],u:"1f966",a:"5.0"},{n:["garlic"],u:"1f9c4",a:"12.0"},{n:["onion"],u:"1f9c5",a:"12.0"},{n:["mushroom"],u:"1f344",a:"0.6"},{n:["peanuts"],u:"1f95c",a:"3.0"},{n:["beans"],u:"1fad8",a:"14.0"},{n:["chestnut"],u:"1f330",a:"0.6"},{n:["bread"],u:"1f35e",a:"0.6"},{n:["croissant"],u:"1f950",a:"3.0"},{n:["baguette bread"],u:"1f956",a:"3.0"},{n:["flatbread"],u:"1fad3",a:"13.0"},{n:["pretzel"],u:"1f968",a:"5.0"},{n:["bagel"],u:"1f96f",a:"11.0"},{n:["pancakes"],u:"1f95e",a:"3.0"},{n:["waffle"],u:"1f9c7",a:"12.0"},{n:["cheese wedge"],u:"1f9c0",a:"1.0"},{n:["meat on bone"],u:"1f356",a:"0.6"},{n:["poultry leg"],u:"1f357",a:"0.6"},{n:["cut of meat"],u:"1f969",a:"5.0"},{n:["bacon"],u:"1f953",a:"3.0"},{n:["hamburger"],u:"1f354",a:"0.6"},{n:["fries","french fries"],u:"1f35f",a:"0.6"},{n:["pizza","slice of pizza"],u:"1f355",a:"0.6"},{n:["hotdog","hot dog"],u:"1f32d",a:"1.0"},{n:["sandwich"],u:"1f96a",a:"5.0"},{n:["taco"],u:"1f32e",a:"1.0"},{n:["burrito"],u:"1f32f",a:"1.0"},{n:["tamale"],u:"1fad4",a:"13.0"},{n:["stuffed flatbread"],u:"1f959",a:"3.0"},{n:["falafel"],u:"1f9c6",a:"12.0"},{n:["egg"],u:"1f95a",a:"3.0"},{n:["cooking","fried egg"],u:"1f373",a:"0.6"},{n:["shallow pan of food"],u:"1f958",a:"3.0"},{n:["stew","pot of food"],u:"1f372",a:"0.6"},{n:["fondue"],u:"1fad5",a:"13.0"},{n:["bowl with spoon"],u:"1f963",a:"5.0"},{n:["green salad"],u:"1f957",a:"3.0"},{n:["popcorn"],u:"1f37f",a:"1.0"},{n:["butter"],u:"1f9c8",a:"12.0"},{n:["salt","salt shaker"],u:"1f9c2",a:"11.0"},{n:["canned food"],u:"1f96b",a:"5.0"},{n:["bento","bento box"],u:"1f371",a:"0.6"},{n:["rice cracker"],u:"1f358",a:"0.6"},{n:["rice ball"],u:"1f359",a:"0.6"},{n:["rice","cooked rice"],u:"1f35a",a:"0.6"},{n:["curry","curry and rice"],u:"1f35b",a:"0.6"},{n:["ramen","steaming bowl"],u:"1f35c",a:"0.6"},{n:["spaghetti"],u:"1f35d",a:"0.6"},{n:["sweet potato","roasted sweet potato"],u:"1f360",a:"0.6"},{n:["oden"],u:"1f362",a:"0.6"},{n:["sushi"],u:"1f363",a:"0.6"},{n:["fried shrimp"],u:"1f364",a:"0.6"},{n:["fish cake","fish cake with swirl design"],u:"1f365",a:"0.6"},{n:["moon cake"],u:"1f96e",a:"11.0"},{n:["dango"],u:"1f361",a:"0.6"},{n:["dumpling"],u:"1f95f",a:"5.0"},{n:["fortune cookie"],u:"1f960",a:"5.0"},{n:["takeout box"],u:"1f961",a:"5.0"},{n:["crab"],u:"1f980",a:"1.0"},{n:["lobster"],u:"1f99e",a:"11.0"},{n:["shrimp"],u:"1f990",a:"3.0"},{n:["squid"],u:"1f991",a:"3.0"},{n:["oyster"],u:"1f9aa",a:"12.0"},{n:["icecream","soft ice cream"],u:"1f366",a:"0.6"},{n:["shaved ice"],u:"1f367",a:"0.6"},{n:["ice cream"],u:"1f368",a:"0.6"},{n:["doughnut"],u:"1f369",a:"0.6"},{n:["cookie"],u:"1f36a",a:"0.6"},{n:["birthday","birthday cake"],u:"1f382",a:"0.6"},{n:["cake","shortcake"],u:"1f370",a:"0.6"},{n:["cupcake"],u:"1f9c1",a:"11.0"},{n:["pie"],u:"1f967",a:"5.0"},{n:["chocolate bar"],u:"1f36b",a:"0.6"},{n:["candy"],u:"1f36c",a:"0.6"},{n:["lollipop"],u:"1f36d",a:"0.6"},{n:["custard"],u:"1f36e",a:"0.6"},{n:["honey pot"],u:"1f36f",a:"0.6"},{n:["baby bottle"],u:"1f37c",a:"1.0"},{n:["glass of milk"],u:"1f95b",a:"3.0"},{n:["coffee","hot beverage"],u:"2615",a:"0.6"},{n:["teapot"],u:"1fad6",a:"13.0"},{n:["tea","teacup without handle"],u:"1f375",a:"0.6"},{n:["sake","sake bottle and cup"],u:"1f376",a:"0.6"},{n:["champagne","bottle with popping cork"],u:"1f37e",a:"1.0"},{n:["wine glass"],u:"1f377",a:"0.6"},{n:["cocktail","cocktail glass"],u:"1f378",a:"0.6"},{n:["tropical drink"],u:"1f379",a:"0.6"},{n:["beer","beer mug"],u:"1f37a",a:"0.6"},{n:["beers","clinking beer mugs"],u:"1f37b",a:"0.6"},{n:["clinking glasses"],u:"1f942",a:"3.0"},{n:["tumbler glass"],u:"1f943",a:"3.0"},{n:["pouring liquid"],u:"1fad7",a:"14.0"},{n:["cup with straw"],u:"1f964",a:"5.0"},{n:["bubble tea"],u:"1f9cb",a:"13.0"},{n:["beverage box"],u:"1f9c3",a:"12.0"},{n:["mate drink"],u:"1f9c9",a:"12.0"},{n:["ice cube"],u:"1f9ca",a:"12.0"},{n:["chopsticks"],u:"1f962",a:"5.0"},{n:["knife fork plate","fork and knife with plate"],u:"1f37d-fe0f",a:"0.7"},{n:["fork and knife"],u:"1f374",a:"0.6"},{n:["spoon"],u:"1f944",a:"3.0"},{n:["hocho","knife"],u:"1f52a",a:"0.6"},{n:["jar"],u:"1fad9",a:"14.0"},{n:["amphora"],u:"1f3fa",a:"1.0"}],travel_places:[{n:["earth africa","earth globe europe-africa"],u:"1f30d",a:"0.7"},{n:["earth americas","earth globe americas"],u:"1f30e",a:"0.7"},{n:["earth asia","earth globe asia-australia"],u:"1f30f",a:"0.6"},{n:["globe with meridians"],u:"1f310",a:"1.0"},{n:["world map"],u:"1f5fa-fe0f",a:"0.7"},{n:["japan","silhouette of japan"],u:"1f5fe",a:"0.6"},{n:["compass"],u:"1f9ed",a:"11.0"},{n:["snow-capped mountain","snow capped mountain"],u:"1f3d4-fe0f",a:"0.7"},{n:["mountain"],u:"26f0-fe0f",a:"0.7"},{n:["volcano"],u:"1f30b",a:"0.6"},{n:["mount fuji"],u:"1f5fb",a:"0.6"},{n:["camping"],u:"1f3d5-fe0f",a:"0.7"},{n:["beach with umbrella"],u:"1f3d6-fe0f",a:"0.7"},{n:["desert"],u:"1f3dc-fe0f",a:"0.7"},{n:["desert island"],u:"1f3dd-fe0f",a:"0.7"},{n:["national park"],u:"1f3de-fe0f",a:"0.7"},{n:["stadium"],u:"1f3df-fe0f",a:"0.7"},{n:["classical building"],u:"1f3db-fe0f",a:"0.7"},{n:["building construction"],u:"1f3d7-fe0f",a:"0.7"},{n:["brick","bricks"],u:"1f9f1",a:"11.0"},{n:["rock"],u:"1faa8",a:"13.0"},{n:["wood"],u:"1fab5",a:"13.0"},{n:["hut"],u:"1f6d6",a:"13.0"},{n:["houses","house buildings"],u:"1f3d8-fe0f",a:"0.7"},{n:["derelict house","derelict house building"],u:"1f3da-fe0f",a:"0.7"},{n:["house","house building"],u:"1f3e0",a:"0.6"},{n:["house with garden"],u:"1f3e1",a:"0.6"},{n:["office","office building"],u:"1f3e2",a:"0.6"},{n:["post office","japanese post office"],u:"1f3e3",a:"0.6"},{n:["european post office"],u:"1f3e4",a:"1.0"},{n:["hospital"],u:"1f3e5",a:"0.6"},{n:["bank"],u:"1f3e6",a:"0.6"},{n:["hotel"],u:"1f3e8",a:"0.6"},{n:["love hotel"],u:"1f3e9",a:"0.6"},{n:["convenience store"],u:"1f3ea",a:"0.6"},{n:["school"],u:"1f3eb",a:"0.6"},{n:["department store"],u:"1f3ec",a:"0.6"},{n:["factory"],u:"1f3ed",a:"0.6"},{n:["japanese castle"],u:"1f3ef",a:"0.6"},{n:["european castle"],u:"1f3f0",a:"0.6"},{n:["wedding"],u:"1f492",a:"0.6"},{n:["tokyo tower"],u:"1f5fc",a:"0.6"},{n:["statue of liberty"],u:"1f5fd",a:"0.6"},{n:["church"],u:"26ea",a:"0.6"},{n:["mosque"],u:"1f54c",a:"1.0"},{n:["hindu temple"],u:"1f6d5",a:"12.0"},{n:["synagogue"],u:"1f54d",a:"1.0"},{n:["shinto shrine"],u:"26e9-fe0f",a:"0.7"},{n:["kaaba"],u:"1f54b",a:"1.0"},{n:["fountain"],u:"26f2",a:"0.6"},{n:["tent"],u:"26fa",a:"0.6"},{n:["foggy"],u:"1f301",a:"0.6"},{n:["night with stars"],u:"1f303",a:"0.6"},{n:["cityscape"],u:"1f3d9-fe0f",a:"0.7"},{n:["sunrise over mountains"],u:"1f304",a:"0.6"},{n:["sunrise"],u:"1f305",a:"0.6"},{n:["city sunset","cityscape at dusk"],u:"1f306",a:"0.6"},{n:["city sunrise","sunset over buildings"],u:"1f307",a:"0.6"},{n:["bridge at night"],u:"1f309",a:"0.6"},{n:["hotsprings","hot springs"],u:"2668-fe0f",a:"0.6"},{n:["carousel horse"],u:"1f3a0",a:"0.6"},{n:["playground slide"],u:"1f6dd",a:"14.0"},{n:["ferris wheel"],u:"1f3a1",a:"0.6"},{n:["roller coaster"],u:"1f3a2",a:"0.6"},{n:["barber","barber pole"],u:"1f488",a:"0.6"},{n:["circus tent"],u:"1f3aa",a:"0.6"},{n:["steam locomotive"],u:"1f682",a:"1.0"},{n:["railway car"],u:"1f683",a:"0.6"},{n:["high-speed train","bullettrain side"],u:"1f684",a:"0.6"},{n:["bullettrain front","high-speed train with bullet nose"],u:"1f685",a:"0.6"},{n:["train","train2"],u:"1f686",a:"1.0"},{n:["metro"],u:"1f687",a:"0.6"},{n:["light rail"],u:"1f688",a:"1.0"},{n:["station"],u:"1f689",a:"0.6"},{n:["tram"],u:"1f68a",a:"1.0"},{n:["monorail"],u:"1f69d",a:"1.0"},{n:["mountain railway"],u:"1f69e",a:"1.0"},{n:["train","tram car"],u:"1f68b",a:"1.0"},{n:["bus"],u:"1f68c",a:"0.6"},{n:["oncoming bus"],u:"1f68d",a:"0.7"},{n:["trolleybus"],u:"1f68e",a:"1.0"},{n:["minibus"],u:"1f690",a:"1.0"},{n:["ambulance"],u:"1f691",a:"0.6"},{n:["fire engine"],u:"1f692",a:"0.6"},{n:["police car"],u:"1f693",a:"0.6"},{n:["oncoming police car"],u:"1f694",a:"0.7"},{n:["taxi"],u:"1f695",a:"0.6"},{n:["oncoming taxi"],u:"1f696",a:"1.0"},{n:["car","red car","automobile"],u:"1f697",a:"0.6"},{n:["oncoming automobile"],u:"1f698",a:"0.7"},{n:["blue car","recreational vehicle"],u:"1f699",a:"0.6"},{n:["pickup truck"],u:"1f6fb",a:"13.0"},{n:["truck","delivery truck"],u:"1f69a",a:"0.6"},{n:["articulated lorry"],u:"1f69b",a:"1.0"},{n:["tractor"],u:"1f69c",a:"1.0"},{n:["racing car"],u:"1f3ce-fe0f",a:"0.7"},{n:["motorcycle","racing motorcycle"],u:"1f3cd-fe0f",a:"0.7"},{n:["motor scooter"],u:"1f6f5",a:"3.0"},{n:["manual wheelchair"],u:"1f9bd",a:"12.0"},{n:["motorized wheelchair"],u:"1f9bc",a:"12.0"},{n:["auto rickshaw"],u:"1f6fa",a:"12.0"},{n:["bike","bicycle"],u:"1f6b2",a:"0.6"},{n:["scooter"],u:"1f6f4",a:"3.0"},{n:["skateboard"],u:"1f6f9",a:"11.0"},{n:["roller skate"],u:"1f6fc",a:"13.0"},{n:["busstop","bus stop"],u:"1f68f",a:"0.6"},{n:["motorway"],u:"1f6e3-fe0f",a:"0.7"},{n:["railway track"],u:"1f6e4-fe0f",a:"0.7"},{n:["oil drum"],u:"1f6e2-fe0f",a:"0.7"},{n:["fuelpump","fuel pump"],u:"26fd",a:"0.6"},{n:["wheel"],u:"1f6de",a:"14.0"},{n:["rotating light","police cars revolving light"],u:"1f6a8",a:"0.6"},{n:["traffic light","horizontal traffic light"],u:"1f6a5",a:"0.6"},{n:["vertical traffic light"],u:"1f6a6",a:"1.0"},{n:["octagonal sign"],u:"1f6d1",a:"3.0"},{n:["construction","construction sign"],u:"1f6a7",a:"0.6"},{n:["anchor"],u:"2693",a:"0.6"},{n:["ring buoy"],u:"1f6df",a:"14.0"},{n:["boat","sailboat"],u:"26f5",a:"0.6"},{n:["canoe"],u:"1f6f6",a:"3.0"},{n:["speedboat"],u:"1f6a4",a:"0.6"},{n:["passenger ship"],u:"1f6f3-fe0f",a:"0.7"},{n:["ferry"],u:"26f4-fe0f",a:"0.7"},{n:["motor boat"],u:"1f6e5-fe0f",a:"0.7"},{n:["ship"],u:"1f6a2",a:"0.6"},{n:["airplane"],u:"2708-fe0f",a:"0.6"},{n:["small airplane"],u:"1f6e9-fe0f",a:"0.7"},{n:["airplane departure"],u:"1f6eb",a:"1.0"},{n:["airplane arriving"],u:"1f6ec",a:"1.0"},{n:["parachute"],u:"1fa82",a:"12.0"},{n:["seat"],u:"1f4ba",a:"0.6"},{n:["helicopter"],u:"1f681",a:"1.0"},{n:["suspension railway"],u:"1f69f",a:"1.0"},{n:["mountain cableway"],u:"1f6a0",a:"1.0"},{n:["aerial tramway"],u:"1f6a1",a:"1.0"},{n:["satellite"],u:"1f6f0-fe0f",a:"0.7"},{n:["rocket"],u:"1f680",a:"0.6"},{n:["flying saucer"],u:"1f6f8",a:"5.0"},{n:["bellhop bell"],u:"1f6ce-fe0f",a:"0.7"},{n:["luggage"],u:"1f9f3",a:"11.0"},{n:["hourglass"],u:"231b",a:"0.6"},{n:["hourglass flowing sand","hourglass with flowing sand"],u:"23f3",a:"0.6"},{n:["watch"],u:"231a",a:"0.6"},{n:["alarm clock"],u:"23f0",a:"0.6"},{n:["stopwatch"],u:"23f1-fe0f",a:"1.0"},{n:["timer clock"],u:"23f2-fe0f",a:"1.0"},{n:["mantelpiece clock"],u:"1f570-fe0f",a:"0.7"},{n:["clock12","clock face twelve oclock"],u:"1f55b",a:"0.6"},{n:["clock1230","clock face twelve-thirty"],u:"1f567",a:"0.7"},{n:["clock1","clock face one oclock"],u:"1f550",a:"0.6"},{n:["clock130","clock face one-thirty"],u:"1f55c",a:"0.7"},{n:["clock2","clock face two oclock"],u:"1f551",a:"0.6"},{n:["clock230","clock face two-thirty"],u:"1f55d",a:"0.7"},{n:["clock3","clock face three oclock"],u:"1f552",a:"0.6"},{n:["clock330","clock face three-thirty"],u:"1f55e",a:"0.7"},{n:["clock4","clock face four oclock"],u:"1f553",a:"0.6"},{n:["clock430","clock face four-thirty"],u:"1f55f",a:"0.7"},{n:["clock5","clock face five oclock"],u:"1f554",a:"0.6"},{n:["clock530","clock face five-thirty"],u:"1f560",a:"0.7"},{n:["clock6","clock face six oclock"],u:"1f555",a:"0.6"},{n:["clock630","clock face six-thirty"],u:"1f561",a:"0.7"},{n:["clock7","clock face seven oclock"],u:"1f556",a:"0.6"},{n:["clock730","clock face seven-thirty"],u:"1f562",a:"0.7"},{n:["clock8","clock face eight oclock"],u:"1f557",a:"0.6"},{n:["clock830","clock face eight-thirty"],u:"1f563",a:"0.7"},{n:["clock9","clock face nine oclock"],u:"1f558",a:"0.6"},{n:["clock930","clock face nine-thirty"],u:"1f564",a:"0.7"},{n:["clock10","clock face ten oclock"],u:"1f559",a:"0.6"},{n:["clock1030","clock face ten-thirty"],u:"1f565",a:"0.7"},{n:["clock11","clock face eleven oclock"],u:"1f55a",a:"0.6"},{n:["clock1130","clock face eleven-thirty"],u:"1f566",a:"0.7"},{n:["new moon","new moon symbol"],u:"1f311",a:"0.6"},{n:["waxing crescent moon","waxing crescent moon symbol"],u:"1f312",a:"1.0"},{n:["first quarter moon","first quarter moon symbol"],u:"1f313",a:"0.6"},{n:["moon","waxing gibbous moon","waxing gibbous moon symbol"],u:"1f314",a:"0.6"},{n:["full moon","full moon symbol"],u:"1f315",a:"0.6"},{n:["waning gibbous moon","waning gibbous moon symbol"],u:"1f316",a:"1.0"},{n:["last quarter moon","last quarter moon symbol"],u:"1f317",a:"1.0"},{n:["waning crescent moon","waning crescent moon symbol"],u:"1f318",a:"1.0"},{n:["crescent moon"],u:"1f319",a:"0.6"},{n:["new moon with face"],u:"1f31a",a:"1.0"},{n:["first quarter moon with face"],u:"1f31b",a:"0.6"},{n:["last quarter moon with face"],u:"1f31c",a:"0.7"},{n:["thermometer"],u:"1f321-fe0f",a:"0.7"},{n:["sunny","black sun with rays"],u:"2600-fe0f",a:"0.6"},{n:["full moon with face"],u:"1f31d",a:"1.0"},{n:["sun with face"],u:"1f31e",a:"1.0"},{n:["ringed planet"],u:"1fa90",a:"12.0"},{n:["star","white medium star"],u:"2b50",a:"0.6"},{n:["star2","glowing star"],u:"1f31f",a:"0.6"},{n:["stars","shooting star"],u:"1f320",a:"0.6"},{n:["milky way"],u:"1f30c",a:"0.6"},{n:["cloud"],u:"2601-fe0f",a:"0.6"},{n:["partly sunny","sun behind cloud"],u:"26c5",a:"0.6"},{n:["thunder cloud and rain","cloud with lightning and rain"],u:"26c8-fe0f",a:"0.7"},{n:["mostly sunny","sun small cloud","sun behind small cloud"],u:"1f324-fe0f",a:"0.7"},{n:["barely sunny","sun behind cloud","sun behind large cloud"],u:"1f325-fe0f",a:"0.7"},{n:["partly sunny rain","sun behind rain cloud"],u:"1f326-fe0f",a:"0.7"},{n:["rain cloud","cloud with rain"],u:"1f327-fe0f",a:"0.7"},{n:["snow cloud","cloud with snow"],u:"1f328-fe0f",a:"0.7"},{n:["lightning","lightning cloud","cloud with lightning"],u:"1f329-fe0f",a:"0.7"},{n:["tornado","tornado cloud"],u:"1f32a-fe0f",a:"0.7"},{n:["fog"],u:"1f32b-fe0f",a:"0.7"},{n:["wind face","wind blowing face"],u:"1f32c-fe0f",a:"0.7"},{n:["cyclone"],u:"1f300",a:"0.6"},{n:["rainbow"],u:"1f308",a:"0.6"},{n:["closed umbrella"],u:"1f302",a:"0.6"},{n:["umbrella"],u:"2602-fe0f",a:"0.7"},{n:["umbrella with rain drops"],u:"2614",a:"0.6"},{n:["umbrella on ground"],u:"26f1-fe0f",a:"0.7"},{n:["zap","high voltage sign"],u:"26a1",a:"0.6"},{n:["snowflake"],u:"2744-fe0f",a:"0.6"},{n:["snowman"],u:"2603-fe0f",a:"0.7"},{n:["snowman without snow"],u:"26c4",a:"0.6"},{n:["comet"],u:"2604-fe0f",a:"1.0"},{n:["fire"],u:"1f525",a:"0.6"},{n:["droplet"],u:"1f4a7",a:"0.6"},{n:["ocean","water wave"],u:"1f30a",a:"0.6"}],activities:[{n:["jack-o-lantern","jack o lantern"],u:"1f383",a:"0.6"},{n:["christmas tree"],u:"1f384",a:"0.6"},{n:["fireworks"],u:"1f386",a:"0.6"},{n:["sparkler","firework sparkler"],u:"1f387",a:"0.6"},{n:["firecracker"],u:"1f9e8",a:"11.0"},{n:["sparkles"],u:"2728",a:"0.6"},{n:["balloon"],u:"1f388",a:"0.6"},{n:["tada","party popper"],u:"1f389",a:"0.6"},{n:["confetti ball"],u:"1f38a",a:"0.6"},{n:["tanabata tree"],u:"1f38b",a:"0.6"},{n:["bamboo","pine decoration"],u:"1f38d",a:"0.6"},{n:["dolls","japanese dolls"],u:"1f38e",a:"0.6"},{n:["flags","carp streamer"],u:"1f38f",a:"0.6"},{n:["wind chime"],u:"1f390",a:"0.6"},{n:["rice scene","moon viewing ceremony"],u:"1f391",a:"0.6"},{n:["red envelope","red gift envelope"],u:"1f9e7",a:"11.0"},{n:["ribbon"],u:"1f380",a:"0.6"},{n:["gift","wrapped present"],u:"1f381",a:"0.6"},{n:["reminder ribbon"],u:"1f397-fe0f",a:"0.7"},{n:["admission tickets"],u:"1f39f-fe0f",a:"0.7"},{n:["ticket"],u:"1f3ab",a:"0.6"},{n:["medal","military medal"],u:"1f396-fe0f",a:"0.7"},{n:["trophy"],u:"1f3c6",a:"0.6"},{n:["sports medal"],u:"1f3c5",a:"1.0"},{n:["first place medal"],u:"1f947",a:"3.0"},{n:["second place medal"],u:"1f948",a:"3.0"},{n:["third place medal"],u:"1f949",a:"3.0"},{n:["soccer","soccer ball"],u:"26bd",a:"0.6"},{n:["baseball"],u:"26be",a:"0.6"},{n:["softball"],u:"1f94e",a:"11.0"},{n:["basketball","basketball and hoop"],u:"1f3c0",a:"0.6"},{n:["volleyball"],u:"1f3d0",a:"1.0"},{n:["football","american football"],u:"1f3c8",a:"0.6"},{n:["rugby football"],u:"1f3c9",a:"1.0"},{n:["tennis","tennis racquet and ball"],u:"1f3be",a:"0.6"},{n:["flying disc"],u:"1f94f",a:"11.0"},{n:["bowling"],u:"1f3b3",a:"0.6"},{n:["cricket bat and ball"],u:"1f3cf",a:"1.0"},{n:["field hockey stick and ball"],u:"1f3d1",a:"1.0"},{n:["ice hockey stick and puck"],u:"1f3d2",a:"1.0"},{n:["lacrosse","lacrosse stick and ball"],u:"1f94d",a:"11.0"},{n:["table tennis paddle and ball"],u:"1f3d3",a:"1.0"},{n:["badminton racquet and shuttlecock"],u:"1f3f8",a:"1.0"},{n:["boxing glove"],u:"1f94a",a:"3.0"},{n:["martial arts uniform"],u:"1f94b",a:"3.0"},{n:["goal net"],u:"1f945",a:"3.0"},{n:["golf","flag in hole"],u:"26f3",a:"0.6"},{n:["ice skate"],u:"26f8-fe0f",a:"0.7"},{n:["fishing pole and fish"],u:"1f3a3",a:"0.6"},{n:["diving mask"],u:"1f93f",a:"12.0"},{n:["running shirt with sash"],u:"1f3bd",a:"0.6"},{n:["ski","ski and ski boot"],u:"1f3bf",a:"0.6"},{n:["sled"],u:"1f6f7",a:"5.0"},{n:["curling stone"],u:"1f94c",a:"5.0"},{n:["dart","direct hit"],u:"1f3af",a:"0.6"},{n:["yo-yo"],u:"1fa80",a:"12.0"},{n:["kite"],u:"1fa81",a:"12.0"},{n:["8ball","billiards"],u:"1f3b1",a:"0.6"},{n:["crystal ball"],u:"1f52e",a:"0.6"},{n:["magic wand"],u:"1fa84",a:"13.0"},{n:["nazar amulet"],u:"1f9ff",a:"11.0"},{n:["hamsa"],u:"1faac",a:"14.0"},{n:["video game"],u:"1f3ae",a:"0.6"},{n:["joystick"],u:"1f579-fe0f",a:"0.7"},{n:["slot machine"],u:"1f3b0",a:"0.6"},{n:["game die"],u:"1f3b2",a:"0.6"},{n:["jigsaw","jigsaw puzzle piece"],u:"1f9e9",a:"11.0"},{n:["teddy bear"],u:"1f9f8",a:"11.0"},{n:["pinata"],u:"1fa85",a:"13.0"},{n:["mirror ball"],u:"1faa9",a:"14.0"},{n:["nesting dolls"],u:"1fa86",a:"13.0"},{n:["spades","black spade suit"],u:"2660-fe0f",a:"0.6"},{n:["hearts","black heart suit"],u:"2665-fe0f",a:"0.6"},{n:["diamonds","black diamond suit"],u:"2666-fe0f",a:"0.6"},{n:["clubs","black club suit"],u:"2663-fe0f",a:"0.6"},{n:["chess pawn"],u:"265f-fe0f",a:"11.0"},{n:["black joker","playing card black joker"],u:"1f0cf",a:"0.6"},{n:["mahjong","mahjong tile red dragon"],u:"1f004",a:"0.6"},{n:["flower playing cards"],u:"1f3b4",a:"0.6"},{n:["performing arts"],u:"1f3ad",a:"0.6"},{n:["framed picture","frame with picture"],u:"1f5bc-fe0f",a:"0.7"},{n:["art","artist palette"],u:"1f3a8",a:"0.6"},{n:["thread","spool of thread"],u:"1f9f5",a:"11.0"},{n:["sewing needle"],u:"1faa1",a:"13.0"},{n:["yarn","ball of yarn"],u:"1f9f6",a:"11.0"},{n:["knot"],u:"1faa2",a:"13.0"}],objects:[{n:["eyeglasses"],u:"1f453",a:"0.6"},{n:["sunglasses","dark sunglasses"],u:"1f576-fe0f",a:"0.7"},{n:["goggles"],u:"1f97d",a:"11.0"},{n:["lab coat"],u:"1f97c",a:"11.0"},{n:["safety vest"],u:"1f9ba",a:"12.0"},{n:["necktie"],u:"1f454",a:"0.6"},{n:["shirt","tshirt","t-shirt"],u:"1f455",a:"0.6"},{n:["jeans"],u:"1f456",a:"0.6"},{n:["scarf"],u:"1f9e3",a:"5.0"},{n:["gloves"],u:"1f9e4",a:"5.0"},{n:["coat"],u:"1f9e5",a:"5.0"},{n:["socks"],u:"1f9e6",a:"5.0"},{n:["dress"],u:"1f457",a:"0.6"},{n:["kimono"],u:"1f458",a:"0.6"},{n:["sari"],u:"1f97b",a:"12.0"},{n:["one-piece swimsuit"],u:"1fa71",a:"12.0"},{n:["briefs"],u:"1fa72",a:"12.0"},{n:["shorts"],u:"1fa73",a:"12.0"},{n:["bikini"],u:"1f459",a:"0.6"},{n:["womans clothes"],u:"1f45a",a:"0.6"},{n:["purse"],u:"1f45b",a:"0.6"},{n:["handbag"],u:"1f45c",a:"0.6"},{n:["pouch"],u:"1f45d",a:"0.6"},{n:["shopping bags"],u:"1f6cd-fe0f",a:"0.7"},{n:["school satchel"],u:"1f392",a:"0.6"},{n:["thong sandal"],u:"1fa74",a:"13.0"},{n:["shoe","mans shoe"],u:"1f45e",a:"0.6"},{n:["athletic shoe"],u:"1f45f",a:"0.6"},{n:["hiking boot"],u:"1f97e",a:"11.0"},{n:["flat shoe","womans flat shoe"],u:"1f97f",a:"11.0"},{n:["high heel","high-heeled shoe"],u:"1f460",a:"0.6"},{n:["sandal","womans sandal"],u:"1f461",a:"0.6"},{n:["ballet shoes"],u:"1fa70",a:"12.0"},{n:["boot","womans boots"],u:"1f462",a:"0.6"},{n:["crown"],u:"1f451",a:"0.6"},{n:["womans hat"],u:"1f452",a:"0.6"},{n:["tophat","top hat"],u:"1f3a9",a:"0.6"},{n:["mortar board","graduation cap"],u:"1f393",a:"0.6"},{n:["billed cap"],u:"1f9e2",a:"5.0"},{n:["military helmet"],u:"1fa96",a:"13.0"},{n:["rescue worker\u2019s helmet","helmet with white cross"],u:"26d1-fe0f",a:"0.7"},{n:["prayer beads"],u:"1f4ff",a:"1.0"},{n:["lipstick"],u:"1f484",a:"0.6"},{n:["ring"],u:"1f48d",a:"0.6"},{n:["gem","gem stone"],u:"1f48e",a:"0.6"},{n:["mute","speaker with cancellation stroke"],u:"1f507",a:"1.0"},{n:["speaker"],u:"1f508",a:"0.7"},{n:["sound","speaker with one sound wave"],u:"1f509",a:"1.0"},{n:["loud sound","speaker with three sound waves"],u:"1f50a",a:"0.6"},{n:["loudspeaker","public address loudspeaker"],u:"1f4e2",a:"0.6"},{n:["mega","cheering megaphone"],u:"1f4e3",a:"0.6"},{n:["postal horn"],u:"1f4ef",a:"1.0"},{n:["bell"],u:"1f514",a:"0.6"},{n:["no bell","bell with cancellation stroke"],u:"1f515",a:"1.0"},{n:["musical score"],u:"1f3bc",a:"0.6"},{n:["musical note"],u:"1f3b5",a:"0.6"},{n:["notes","multiple musical notes"],u:"1f3b6",a:"0.6"},{n:["studio microphone"],u:"1f399-fe0f",a:"0.7"},{n:["level slider"],u:"1f39a-fe0f",a:"0.7"},{n:["control knobs"],u:"1f39b-fe0f",a:"0.7"},{n:["microphone"],u:"1f3a4",a:"0.6"},{n:["headphone","headphones"],u:"1f3a7",a:"0.6"},{n:["radio"],u:"1f4fb",a:"0.6"},{n:["saxophone"],u:"1f3b7",a:"0.6"},{n:["accordion"],u:"1fa97",a:"13.0"},{n:["guitar"],u:"1f3b8",a:"0.6"},{n:["musical keyboard"],u:"1f3b9",a:"0.6"},{n:["trumpet"],u:"1f3ba",a:"0.6"},{n:["violin"],u:"1f3bb",a:"0.6"},{n:["banjo"],u:"1fa95",a:"12.0"},{n:["drum with drumsticks"],u:"1f941",a:"3.0"},{n:["long drum"],u:"1fa98",a:"13.0"},{n:["iphone","mobile phone"],u:"1f4f1",a:"0.6"},{n:["calling","mobile phone with rightwards arrow at left"],u:"1f4f2",a:"0.6"},{n:["phone","telephone","black telephone"],u:"260e-fe0f",a:"0.6"},{n:["telephone receiver"],u:"1f4de",a:"0.6"},{n:["pager"],u:"1f4df",a:"0.6"},{n:["fax","fax machine"],u:"1f4e0",a:"0.6"},{n:["battery"],u:"1f50b",a:"0.6"},{n:["low battery"],u:"1faab",a:"14.0"},{n:["electric plug"],u:"1f50c",a:"0.6"},{n:["computer","personal computer"],u:"1f4bb",a:"0.6"},{n:["desktop computer"],u:"1f5a5-fe0f",a:"0.7"},{n:["printer"],u:"1f5a8-fe0f",a:"0.7"},{n:["keyboard"],u:"2328-fe0f",a:"1.0"},{n:["computer mouse","three button mouse"],u:"1f5b1-fe0f",a:"0.7"},{n:["trackball"],u:"1f5b2-fe0f",a:"0.7"},{n:["minidisc"],u:"1f4bd",a:"0.6"},{n:["floppy disk"],u:"1f4be",a:"0.6"},{n:["cd","optical disc"],u:"1f4bf",a:"0.6"},{n:["dvd"],u:"1f4c0",a:"0.6"},{n:["abacus"],u:"1f9ee",a:"11.0"},{n:["movie camera"],u:"1f3a5",a:"0.6"},{n:["film frames"],u:"1f39e-fe0f",a:"0.7"},{n:["film projector"],u:"1f4fd-fe0f",a:"0.7"},{n:["clapper","clapper board"],u:"1f3ac",a:"0.6"},{n:["tv","television"],u:"1f4fa",a:"0.6"},{n:["camera"],u:"1f4f7",a:"0.6"},{n:["camera with flash"],u:"1f4f8",a:"1.0"},{n:["video camera"],u:"1f4f9",a:"0.6"},{n:["vhs","videocassette"],u:"1f4fc",a:"0.6"},{n:["mag","left-pointing magnifying glass"],u:"1f50d",a:"0.6"},{n:["mag right","right-pointing magnifying glass"],u:"1f50e",a:"0.6"},{n:["candle"],u:"1f56f-fe0f",a:"0.7"},{n:["bulb","electric light bulb"],u:"1f4a1",a:"0.6"},{n:["flashlight","electric torch"],u:"1f526",a:"0.6"},{n:["lantern","izakaya lantern"],u:"1f3ee",a:"0.6"},{n:["diya lamp"],u:"1fa94",a:"12.0"},{n:["notebook with decorative cover"],u:"1f4d4",a:"0.6"},{n:["closed book"],u:"1f4d5",a:"0.6"},{n:["book","open book"],u:"1f4d6",a:"0.6"},{n:["green book"],u:"1f4d7",a:"0.6"},{n:["blue book"],u:"1f4d8",a:"0.6"},{n:["orange book"],u:"1f4d9",a:"0.6"},{n:["books"],u:"1f4da",a:"0.6"},{n:["notebook"],u:"1f4d3",a:"0.6"},{n:["ledger"],u:"1f4d2",a:"0.6"},{n:["page with curl"],u:"1f4c3",a:"0.6"},{n:["scroll"],u:"1f4dc",a:"0.6"},{n:["page facing up"],u:"1f4c4",a:"0.6"},{n:["newspaper"],u:"1f4f0",a:"0.6"},{n:["rolled-up newspaper","rolled up newspaper"],u:"1f5de-fe0f",a:"0.7"},{n:["bookmark tabs"],u:"1f4d1",a:"0.6"},{n:["bookmark"],u:"1f516",a:"0.6"},{n:["label"],u:"1f3f7-fe0f",a:"0.7"},{n:["moneybag","money bag"],u:"1f4b0",a:"0.6"},{n:["coin"],u:"1fa99",a:"13.0"},{n:["yen","banknote with yen sign"],u:"1f4b4",a:"0.6"},{n:["dollar","banknote with dollar sign"],u:"1f4b5",a:"0.6"},{n:["euro","banknote with euro sign"],u:"1f4b6",a:"1.0"},{n:["pound","banknote with pound sign"],u:"1f4b7",a:"1.0"},{n:["money with wings"],u:"1f4b8",a:"0.6"},{n:["credit card"],u:"1f4b3",a:"0.6"},{n:["receipt"],u:"1f9fe",a:"11.0"},{n:["chart","chart with upwards trend and yen sign"],u:"1f4b9",a:"0.6"},{n:["email","envelope"],u:"2709-fe0f",a:"0.6"},{n:["e-mail","e-mail symbol"],u:"1f4e7",a:"0.6"},{n:["incoming envelope"],u:"1f4e8",a:"0.6"},{n:["envelope with arrow","envelope with downwards arrow above"],u:"1f4e9",a:"0.6"},{n:["outbox tray"],u:"1f4e4",a:"0.6"},{n:["inbox tray"],u:"1f4e5",a:"0.6"},{n:["package"],u:"1f4e6",a:"0.6"},{n:["mailbox","closed mailbox with raised flag"],u:"1f4eb",a:"0.6"},{n:["mailbox closed","closed mailbox with lowered flag"],u:"1f4ea",a:"0.6"},{n:["mailbox with mail","open mailbox with raised flag"],u:"1f4ec",a:"0.7"},{n:["mailbox with no mail","open mailbox with lowered flag"],u:"1f4ed",a:"0.7"},{n:["postbox"],u:"1f4ee",a:"0.6"},{n:["ballot box with ballot"],u:"1f5f3-fe0f",a:"0.7"},{n:["pencil","pencil2"],u:"270f-fe0f",a:"0.6"},{n:["black nib"],u:"2712-fe0f",a:"0.6"},{n:["fountain pen","lower left fountain pen"],u:"1f58b-fe0f",a:"0.7"},{n:["pen","lower left ballpoint pen"],u:"1f58a-fe0f",a:"0.7"},{n:["paintbrush","lower left paintbrush"],u:"1f58c-fe0f",a:"0.7"},{n:["crayon","lower left crayon"],u:"1f58d-fe0f",a:"0.7"},{n:["memo","pencil"],u:"1f4dd",a:"0.6"},{n:["briefcase"],u:"1f4bc",a:"0.6"},{n:["file folder"],u:"1f4c1",a:"0.6"},{n:["open file folder"],u:"1f4c2",a:"0.6"},{n:["card index dividers"],u:"1f5c2-fe0f",a:"0.7"},{n:["date","calendar"],u:"1f4c5",a:"0.6"},{n:["calendar","tear-off calendar"],u:"1f4c6",a:"0.6"},{n:["spiral notepad","spiral note pad"],u:"1f5d2-fe0f",a:"0.7"},{n:["spiral calendar","spiral calendar pad"],u:"1f5d3-fe0f",a:"0.7"},{n:["card index"],u:"1f4c7",a:"0.6"},{n:["chart with upwards trend"],u:"1f4c8",a:"0.6"},{n:["chart with downwards trend"],u:"1f4c9",a:"0.6"},{n:["bar chart"],u:"1f4ca",a:"0.6"},{n:["clipboard"],u:"1f4cb",a:"0.6"},{n:["pushpin"],u:"1f4cc",a:"0.6"},{n:["round pushpin"],u:"1f4cd",a:"0.6"},{n:["paperclip"],u:"1f4ce",a:"0.6"},{n:["linked paperclips"],u:"1f587-fe0f",a:"0.7"},{n:["straight ruler"],u:"1f4cf",a:"0.6"},{n:["triangular ruler"],u:"1f4d0",a:"0.6"},{n:["scissors","black scissors"],u:"2702-fe0f",a:"0.6"},{n:["card file box"],u:"1f5c3-fe0f",a:"0.7"},{n:["file cabinet"],u:"1f5c4-fe0f",a:"0.7"},{n:["wastebasket"],u:"1f5d1-fe0f",a:"0.7"},{n:["lock"],u:"1f512",a:"0.6"},{n:["unlock","open lock"],u:"1f513",a:"0.6"},{n:["lock with ink pen"],u:"1f50f",a:"0.6"},{n:["closed lock with key"],u:"1f510",a:"0.6"},{n:["key"],u:"1f511",a:"0.6"},{n:["old key"],u:"1f5dd-fe0f",a:"0.7"},{n:["hammer"],u:"1f528",a:"0.6"},{n:["axe"],u:"1fa93",a:"12.0"},{n:["pick"],u:"26cf-fe0f",a:"0.7"},{n:["hammer and pick"],u:"2692-fe0f",a:"1.0"},{n:["hammer and wrench"],u:"1f6e0-fe0f",a:"0.7"},{n:["dagger","dagger knife"],u:"1f5e1-fe0f",a:"0.7"},{n:["crossed swords"],u:"2694-fe0f",a:"1.0"},{n:["gun","pistol"],u:"1f52b",a:"0.6"},{n:["boomerang"],u:"1fa83",a:"13.0"},{n:["bow and arrow"],u:"1f3f9",a:"1.0"},{n:["shield"],u:"1f6e1-fe0f",a:"0.7"},{n:["carpentry saw"],u:"1fa9a",a:"13.0"},{n:["wrench"],u:"1f527",a:"0.6"},{n:["screwdriver"],u:"1fa9b",a:"13.0"},{n:["nut and bolt"],u:"1f529",a:"0.6"},{n:["gear"],u:"2699-fe0f",a:"1.0"},{n:["clamp","compression"],u:"1f5dc-fe0f",a:"0.7"},{n:["scales","balance scale"],u:"2696-fe0f",a:"1.0"},{n:["probing cane"],u:"1f9af",a:"12.0"},{n:["link","link symbol"],u:"1f517",a:"0.6"},{n:["chains"],u:"26d3-fe0f",a:"0.7"},{n:["hook"],u:"1fa9d",a:"13.0"},{n:["toolbox"],u:"1f9f0",a:"11.0"},{n:["magnet"],u:"1f9f2",a:"11.0"},{n:["ladder"],u:"1fa9c",a:"13.0"},{n:["alembic"],u:"2697-fe0f",a:"1.0"},{n:["test tube"],u:"1f9ea",a:"11.0"},{n:["petri dish"],u:"1f9eb",a:"11.0"},{n:["dna","dna double helix"],u:"1f9ec",a:"11.0"},{n:["microscope"],u:"1f52c",a:"1.0"},{n:["telescope"],u:"1f52d",a:"1.0"},{n:["satellite antenna"],u:"1f4e1",a:"0.6"},{n:["syringe"],u:"1f489",a:"0.6"},{n:["drop of blood"],u:"1fa78",a:"12.0"},{n:["pill"],u:"1f48a",a:"0.6"},{n:["adhesive bandage"],u:"1fa79",a:"12.0"},{n:["crutch"],u:"1fa7c",a:"14.0"},{n:["stethoscope"],u:"1fa7a",a:"12.0"},{n:["x-ray"],u:"1fa7b",a:"14.0"},{n:["door"],u:"1f6aa",a:"0.6"},{n:["elevator"],u:"1f6d7",a:"13.0"},{n:["mirror"],u:"1fa9e",a:"13.0"},{n:["window"],u:"1fa9f",a:"13.0"},{n:["bed"],u:"1f6cf-fe0f",a:"0.7"},{n:["couch and lamp"],u:"1f6cb-fe0f",a:"0.7"},{n:["chair"],u:"1fa91",a:"12.0"},{n:["toilet"],u:"1f6bd",a:"0.6"},{n:["plunger"],u:"1faa0",a:"13.0"},{n:["shower"],u:"1f6bf",a:"1.0"},{n:["bathtub"],u:"1f6c1",a:"1.0"},{n:["mouse trap"],u:"1faa4",a:"13.0"},{n:["razor"],u:"1fa92",a:"12.0"},{n:["lotion bottle"],u:"1f9f4",a:"11.0"},{n:["safety pin"],u:"1f9f7",a:"11.0"},{n:["broom"],u:"1f9f9",a:"11.0"},{n:["basket"],u:"1f9fa",a:"11.0"},{n:["roll of paper"],u:"1f9fb",a:"11.0"},{n:["bucket"],u:"1faa3",a:"13.0"},{n:["soap","bar of soap"],u:"1f9fc",a:"11.0"},{n:["bubbles"],u:"1fae7",a:"14.0"},{n:["toothbrush"],u:"1faa5",a:"13.0"},{n:["sponge"],u:"1f9fd",a:"11.0"},{n:["fire extinguisher"],u:"1f9ef",a:"11.0"},{n:["shopping trolley"],u:"1f6d2",a:"3.0"},{n:["smoking","smoking symbol"],u:"1f6ac",a:"0.6"},{n:["coffin"],u:"26b0-fe0f",a:"1.0"},{n:["headstone"],u:"1faa6",a:"13.0"},{n:["funeral urn"],u:"26b1-fe0f",a:"1.0"},{n:["moyai"],u:"1f5ff",a:"0.6"},{n:["placard"],u:"1faa7",a:"13.0"},{n:["identification card"],u:"1faaa",a:"14.0"}],symbols:[{n:["atm","automated teller machine"],u:"1f3e7",a:"0.6"},{n:["put litter in its place","put litter in its place symbol"],u:"1f6ae",a:"1.0"},{n:["potable water","potable water symbol"],u:"1f6b0",a:"1.0"},{n:["wheelchair","wheelchair symbol"],u:"267f",a:"0.6"},{n:["mens","mens symbol"],u:"1f6b9",a:"0.6"},{n:["womens","womens symbol"],u:"1f6ba",a:"0.6"},{n:["restroom"],u:"1f6bb",a:"0.6"},{n:["baby symbol"],u:"1f6bc",a:"0.6"},{n:["wc","water closet"],u:"1f6be",a:"0.6"},{n:["passport control"],u:"1f6c2",a:"1.0"},{n:["customs"],u:"1f6c3",a:"1.0"},{n:["baggage claim"],u:"1f6c4",a:"1.0"},{n:["left luggage"],u:"1f6c5",a:"1.0"},{n:["warning","warning sign"],u:"26a0-fe0f",a:"0.6"},{n:["children crossing"],u:"1f6b8",a:"1.0"},{n:["no entry"],u:"26d4",a:"0.6"},{n:["no entry sign"],u:"1f6ab",a:"0.6"},{n:["no bicycles"],u:"1f6b3",a:"1.0"},{n:["no smoking","no smoking symbol"],u:"1f6ad",a:"0.6"},{n:["do not litter","do not litter symbol"],u:"1f6af",a:"1.0"},{n:["non-potable water","non-potable water symbol"],u:"1f6b1",a:"1.0"},{n:["no pedestrians"],u:"1f6b7",a:"1.0"},{n:["no mobile phones"],u:"1f4f5",a:"1.0"},{n:["underage","no one under eighteen symbol"],u:"1f51e",a:"0.6"},{n:["radioactive","radioactive sign"],u:"2622-fe0f",a:"1.0"},{n:["biohazard","biohazard sign"],u:"2623-fe0f",a:"1.0"},{n:["arrow up","upwards black arrow"],u:"2b06-fe0f",a:"0.6"},{n:["north east arrow","arrow upper right"],u:"2197-fe0f",a:"0.6"},{n:["arrow right","black rightwards arrow"],u:"27a1-fe0f",a:"0.6"},{n:["south east arrow","arrow lower right"],u:"2198-fe0f",a:"0.6"},{n:["arrow down","downwards black arrow"],u:"2b07-fe0f",a:"0.6"},{n:["south west arrow","arrow lower left"],u:"2199-fe0f",a:"0.6"},{n:["arrow left","leftwards black arrow"],u:"2b05-fe0f",a:"0.6"},{n:["north west arrow","arrow upper left"],u:"2196-fe0f",a:"0.6"},{n:["up down arrow","arrow up down"],u:"2195-fe0f",a:"0.6"},{n:["left right arrow"],u:"2194-fe0f",a:"0.6"},{n:["leftwards arrow with hook"],u:"21a9-fe0f",a:"0.6"},{n:["arrow right hook","rightwards arrow with hook"],u:"21aa-fe0f",a:"0.6"},{n:["arrow heading up","arrow pointing rightwards then curving upwards"],u:"2934-fe0f",a:"0.6"},{n:["arrow heading down","arrow pointing rightwards then curving downwards"],u:"2935-fe0f",a:"0.6"},{n:["arrows clockwise","clockwise downwards and upwards open circle arrows"],u:"1f503",a:"0.6"},{n:["arrows counterclockwise","anticlockwise downwards and upwards open circle arrows"],u:"1f504",a:"1.0"},{n:["back","back with leftwards arrow above"],u:"1f519",a:"0.6"},{n:["end","end with leftwards arrow above"],u:"1f51a",a:"0.6"},{n:["on","on with exclamation mark with left right arrow above"],u:"1f51b",a:"0.6"},{n:["soon","soon with rightwards arrow above"],u:"1f51c",a:"0.6"},{n:["top","top with upwards arrow above"],u:"1f51d",a:"0.6"},{n:["place of worship"],u:"1f6d0",a:"1.0"},{n:["atom symbol"],u:"269b-fe0f",a:"1.0"},{n:["om","om symbol"],u:"1f549-fe0f",a:"0.7"},{n:["star of david"],u:"2721-fe0f",a:"0.7"},{n:["wheel of dharma"],u:"2638-fe0f",a:"0.7"},{n:["yin yang"],u:"262f-fe0f",a:"0.7"},{n:["latin cross"],u:"271d-fe0f",a:"0.7"},{n:["orthodox cross"],u:"2626-fe0f",a:"1.0"},{n:["star and crescent"],u:"262a-fe0f",a:"0.7"},{n:["peace symbol"],u:"262e-fe0f",a:"1.0"},{n:["menorah with nine branches"],u:"1f54e",a:"1.0"},{n:["six pointed star","six pointed star with middle dot"],u:"1f52f",a:"0.6"},{n:["aries"],u:"2648",a:"0.6"},{n:["taurus"],u:"2649",a:"0.6"},{n:["gemini"],u:"264a",a:"0.6"},{n:["cancer"],u:"264b",a:"0.6"},{n:["leo"],u:"264c",a:"0.6"},{n:["virgo"],u:"264d",a:"0.6"},{n:["libra"],u:"264e",a:"0.6"},{n:["scorpius"],u:"264f",a:"0.6"},{n:["sagittarius"],u:"2650",a:"0.6"},{n:["capricorn"],u:"2651",a:"0.6"},{n:["aquarius"],u:"2652",a:"0.6"},{n:["pisces"],u:"2653",a:"0.6"},{n:["ophiuchus"],u:"26ce",a:"0.6"},{n:["twisted rightwards arrows"],u:"1f500",a:"1.0"},{n:["repeat","clockwise rightwards and leftwards open circle arrows"],u:"1f501",a:"1.0"},{n:["repeat one","clockwise rightwards and leftwards open circle arrows with circled one overlay"],u:"1f502",a:"1.0"},{n:["arrow forward","black right-pointing triangle"],u:"25b6-fe0f",a:"0.6"},{n:["fast forward","black right-pointing double triangle"],u:"23e9",a:"0.6"},{n:["next track button","black right pointing double triangle with vertical bar"],u:"23ed-fe0f",a:"0.7"},{n:["play or pause button","black right pointing triangle with double vertical bar"],u:"23ef-fe0f",a:"1.0"},{n:["arrow backward","black left-pointing triangle"],u:"25c0-fe0f",a:"0.6"},{n:["rewind","black left-pointing double triangle"],u:"23ea",a:"0.6"},{n:["last track button","black left pointing double triangle with vertical bar"],u:"23ee-fe0f",a:"0.7"},{n:["arrow up small","up-pointing small red triangle"],u:"1f53c",a:"0.6"},{n:["arrow double up","black up-pointing double triangle"],u:"23eb",a:"0.6"},{n:["arrow down small","down-pointing small red triangle"],u:"1f53d",a:"0.6"},{n:["arrow double down","black down-pointing double triangle"],u:"23ec",a:"0.6"},{n:["pause button","double vertical bar"],u:"23f8-fe0f",a:"0.7"},{n:["stop button","black square for stop"],u:"23f9-fe0f",a:"0.7"},{n:["record button","black circle for record"],u:"23fa-fe0f",a:"0.7"},{n:["eject","eject button"],u:"23cf-fe0f",a:"1.0"},{n:["cinema"],u:"1f3a6",a:"0.6"},{n:["low brightness","low brightness symbol"],u:"1f505",a:"1.0"},{n:["high brightness","high brightness symbol"],u:"1f506",a:"1.0"},{n:["signal strength","antenna with bars"],u:"1f4f6",a:"0.6"},{n:["vibration mode"],u:"1f4f3",a:"0.6"},{n:["mobile phone off"],u:"1f4f4",a:"0.6"},{n:["female sign"],u:"2640-fe0f",a:"4.0"},{n:["male sign"],u:"2642-fe0f",a:"4.0"},{n:["transgender symbol"],u:"26a7-fe0f",a:"13.0"},{n:["heavy multiplication x"],u:"2716-fe0f",a:"0.6"},{n:["heavy plus sign"],u:"2795",a:"0.6"},{n:["heavy minus sign"],u:"2796",a:"0.6"},{n:["heavy division sign"],u:"2797",a:"0.6"},{n:["heavy equals sign"],u:"1f7f0",a:"14.0"},{n:["infinity"],u:"267e-fe0f",a:"11.0"},{n:["bangbang","double exclamation mark"],u:"203c-fe0f",a:"0.6"},{n:["interrobang","exclamation question mark"],u:"2049-fe0f",a:"0.6"},{n:["question","black question mark ornament"],u:"2753",a:"0.6"},{n:["grey question","white question mark ornament"],u:"2754",a:"0.6"},{n:["grey exclamation","white exclamation mark ornament"],u:"2755",a:"0.6"},{n:["exclamation","heavy exclamation mark","heavy exclamation mark symbol"],u:"2757",a:"0.6"},{n:["wavy dash"],u:"3030-fe0f",a:"0.6"},{n:["currency exchange"],u:"1f4b1",a:"0.6"},{n:["heavy dollar sign"],u:"1f4b2",a:"0.6"},{n:["medical symbol","staff of aesculapius"],u:"2695-fe0f",a:"4.0"},{n:["recycle","black universal recycling symbol"],u:"267b-fe0f",a:"0.6"},{n:["fleur-de-lis","fleur de lis"],u:"269c-fe0f",a:"1.0"},{n:["trident","trident emblem"],u:"1f531",a:"0.6"},{n:["name badge"],u:"1f4db",a:"0.6"},{n:["beginner","japanese symbol for beginner"],u:"1f530",a:"0.6"},{n:["o","heavy large circle"],u:"2b55",a:"0.6"},{n:["white check mark","white heavy check mark"],u:"2705",a:"0.6"},{n:["ballot box with check"],u:"2611-fe0f",a:"0.6"},{n:["heavy check mark"],u:"2714-fe0f",a:"0.6"},{n:["x","cross mark"],u:"274c",a:"0.6"},{n:["negative squared cross mark"],u:"274e",a:"0.6"},{n:["curly loop"],u:"27b0",a:"0.6"},{n:["loop","double curly loop"],u:"27bf",a:"1.0"},{n:["part alternation mark"],u:"303d-fe0f",a:"0.6"},{n:["eight spoked asterisk"],u:"2733-fe0f",a:"0.6"},{n:["eight pointed black star"],u:"2734-fe0f",a:"0.6"},{n:["sparkle"],u:"2747-fe0f",a:"0.6"},{n:["copyright","copyright sign"],u:"00a9-fe0f",a:"0.6"},{n:["registered","registered sign"],u:"00ae-fe0f",a:"0.6"},{n:["tm","trade mark sign"],u:"2122-fe0f",a:"0.6"},{n:["hash","hash key"],u:"0023-fe0f-20e3",a:"0.6"},{n:["keycap: *","keycap star"],u:"002a-fe0f-20e3",a:"2.0"},{n:["zero","keycap 0"],u:"0030-fe0f-20e3",a:"0.6"},{n:["one","keycap 1"],u:"0031-fe0f-20e3",a:"0.6"},{n:["two","keycap 2"],u:"0032-fe0f-20e3",a:"0.6"},{n:["three","keycap 3"],u:"0033-fe0f-20e3",a:"0.6"},{n:["four","keycap 4"],u:"0034-fe0f-20e3",a:"0.6"},{n:["five","keycap 5"],u:"0035-fe0f-20e3",a:"0.6"},{n:["six","keycap 6"],u:"0036-fe0f-20e3",a:"0.6"},{n:["seven","keycap 7"],u:"0037-fe0f-20e3",a:"0.6"},{n:["eight","keycap 8"],u:"0038-fe0f-20e3",a:"0.6"},{n:["nine","keycap 9"],u:"0039-fe0f-20e3",a:"0.6"},{n:["keycap ten"],u:"1f51f",a:"0.6"},{n:["capital abcd","input symbol for latin capital letters"],u:"1f520",a:"0.6"},{n:["abcd","input symbol for latin small letters"],u:"1f521",a:"0.6"},{n:["1234","input symbol for numbers"],u:"1f522",a:"0.6"},{n:["symbols","input symbol for symbols"],u:"1f523",a:"0.6"},{n:["abc","input symbol for latin letters"],u:"1f524",a:"0.6"},{n:["a","negative squared latin capital letter a"],u:"1f170-fe0f",a:"0.6"},{n:["ab","negative squared ab"],u:"1f18e",a:"0.6"},{n:["b","negative squared latin capital letter b"],u:"1f171-fe0f",a:"0.6"},{n:["cl","squared cl"],u:"1f191",a:"0.6"},{n:["cool","squared cool"],u:"1f192",a:"0.6"},{n:["free","squared free"],u:"1f193",a:"0.6"},{n:["information source"],u:"2139-fe0f",a:"0.6"},{n:["id","squared id"],u:"1f194",a:"0.6"},{n:["m","circled latin capital letter m"],u:"24c2-fe0f",a:"0.6"},{n:["new","squared new"],u:"1f195",a:"0.6"},{n:["ng","squared ng"],u:"1f196",a:"0.6"},{n:["o2","negative squared latin capital letter o"],u:"1f17e-fe0f",a:"0.6"},{n:["ok","squared ok"],u:"1f197",a:"0.6"},{n:["parking","negative squared latin capital letter p"],u:"1f17f-fe0f",a:"0.6"},{n:["sos","squared sos"],u:"1f198",a:"0.6"},{n:["up","squared up with exclamation mark"],u:"1f199",a:"0.6"},{n:["vs","squared vs"],u:"1f19a",a:"0.6"},{n:["koko","squared katakana koko"],u:"1f201",a:"0.6"},{n:["sa","squared katakana sa"],u:"1f202-fe0f",a:"0.6"},{n:["u6708","squared cjk unified ideograph-6708"],u:"1f237-fe0f",a:"0.6"},{n:["u6709","squared cjk unified ideograph-6709"],u:"1f236",a:"0.6"},{n:["u6307","squared cjk unified ideograph-6307"],u:"1f22f",a:"0.6"},{n:["ideograph advantage","circled ideograph advantage"],u:"1f250",a:"0.6"},{n:["u5272","squared cjk unified ideograph-5272"],u:"1f239",a:"0.6"},{n:["u7121","squared cjk unified ideograph-7121"],u:"1f21a",a:"0.6"},{n:["u7981","squared cjk unified ideograph-7981"],u:"1f232",a:"0.6"},{n:["accept","circled ideograph accept"],u:"1f251",a:"0.6"},{n:["u7533","squared cjk unified ideograph-7533"],u:"1f238",a:"0.6"},{n:["u5408","squared cjk unified ideograph-5408"],u:"1f234",a:"0.6"},{n:["u7a7a","squared cjk unified ideograph-7a7a"],u:"1f233",a:"0.6"},{n:["congratulations","circled ideograph congratulation"],u:"3297-fe0f",a:"0.6"},{n:["secret","circled ideograph secret"],u:"3299-fe0f",a:"0.6"},{n:["u55b6","squared cjk unified ideograph-55b6"],u:"1f23a",a:"0.6"},{n:["u6e80","squared cjk unified ideograph-6e80"],u:"1f235",a:"0.6"},{n:["red circle","large red circle"],u:"1f534",a:"0.6"},{n:["large orange circle"],u:"1f7e0",a:"12.0"},{n:["large yellow circle"],u:"1f7e1",a:"12.0"},{n:["large green circle"],u:"1f7e2",a:"12.0"},{n:["large blue circle"],u:"1f535",a:"0.6"},{n:["large purple circle"],u:"1f7e3",a:"12.0"},{n:["large brown circle"],u:"1f7e4",a:"12.0"},{n:["black circle","medium black circle"],u:"26ab",a:"0.6"},{n:["white circle","medium white circle"],u:"26aa",a:"0.6"},{n:["large red square"],u:"1f7e5",a:"12.0"},{n:["large orange square"],u:"1f7e7",a:"12.0"},{n:["large yellow square"],u:"1f7e8",a:"12.0"},{n:["large green square"],u:"1f7e9",a:"12.0"},{n:["large blue square"],u:"1f7e6",a:"12.0"},{n:["large purple square"],u:"1f7ea",a:"12.0"},{n:["large brown square"],u:"1f7eb",a:"12.0"},{n:["black large square"],u:"2b1b",a:"0.6"},{n:["white large square"],u:"2b1c",a:"0.6"},{n:["black medium square"],u:"25fc-fe0f",a:"0.6"},{n:["white medium square"],u:"25fb-fe0f",a:"0.6"},{n:["black medium small square"],u:"25fe",a:"0.6"},{n:["white medium small square"],u:"25fd",a:"0.6"},{n:["black small square"],u:"25aa-fe0f",a:"0.6"},{n:["white small square"],u:"25ab-fe0f",a:"0.6"},{n:["large orange diamond"],u:"1f536",a:"0.6"},{n:["large blue diamond"],u:"1f537",a:"0.6"},{n:["small orange diamond"],u:"1f538",a:"0.6"},{n:["small blue diamond"],u:"1f539",a:"0.6"},{n:["small red triangle","up-pointing red triangle"],u:"1f53a",a:"0.6"},{n:["small red triangle down","down-pointing red triangle"],u:"1f53b",a:"0.6"},{n:["diamond shape with a dot inside"],u:"1f4a0",a:"0.6"},{n:["radio button"],u:"1f518",a:"0.6"},{n:["white square button"],u:"1f533",a:"0.6"},{n:["black square button"],u:"1f532",a:"0.6"}],flags:[{n:["chequered flag","checkered flag"],u:"1f3c1",a:"0.6"},{n:["triangular flag on post"],u:"1f6a9",a:"0.6"},{n:["crossed flags"],u:"1f38c",a:"0.6"},{n:["waving black flag"],u:"1f3f4",a:"1.0"},{n:["white flag","waving white flag"],u:"1f3f3-fe0f",a:"0.7"},{n:["rainbow flag","rainbow-flag"],u:"1f3f3-fe0f-200d-1f308",a:"4.0"},{n:["transgender flag"],u:"1f3f3-fe0f-200d-26a7-fe0f",a:"13.0"},{n:["pirate flag"],u:"1f3f4-200d-2620-fe0f",a:"11.0"},{n:["flag-ac","ascension island flag"],u:"1f1e6-1f1e8",a:"2.0"},{n:["flag-ad","andorra flag"],u:"1f1e6-1f1e9",a:"2.0"},{n:["flag-ae","united arab emirates flag"],u:"1f1e6-1f1ea",a:"2.0"},{n:["flag-af","afghanistan flag"],u:"1f1e6-1f1eb",a:"2.0"},{n:["flag-ag","antigua & barbuda flag"],u:"1f1e6-1f1ec",a:"2.0"},{n:["flag-ai","anguilla flag"],u:"1f1e6-1f1ee",a:"2.0"},{n:["flag-al","albania flag"],u:"1f1e6-1f1f1",a:"2.0"},{n:["flag-am","armenia flag"],u:"1f1e6-1f1f2",a:"2.0"},{n:["flag-ao","angola flag"],u:"1f1e6-1f1f4",a:"2.0"},{n:["flag-aq","antarctica flag"],u:"1f1e6-1f1f6",a:"2.0"},{n:["flag-ar","argentina flag"],u:"1f1e6-1f1f7",a:"2.0"},{n:["flag-as","american samoa flag"],u:"1f1e6-1f1f8",a:"2.0"},{n:["flag-at","austria flag"],u:"1f1e6-1f1f9",a:"2.0"},{n:["flag-au","australia flag"],u:"1f1e6-1f1fa",a:"2.0"},{n:["flag-aw","aruba flag"],u:"1f1e6-1f1fc",a:"2.0"},{n:["flag-ax","\xe5land islands flag"],u:"1f1e6-1f1fd",a:"2.0"},{n:["flag-az","azerbaijan flag"],u:"1f1e6-1f1ff",a:"2.0"},{n:["flag-ba","bosnia & herzegovina flag"],u:"1f1e7-1f1e6",a:"2.0"},{n:["flag-bb","barbados flag"],u:"1f1e7-1f1e7",a:"2.0"},{n:["flag-bd","bangladesh flag"],u:"1f1e7-1f1e9",a:"2.0"},{n:["flag-be","belgium flag"],u:"1f1e7-1f1ea",a:"2.0"},{n:["flag-bf","burkina faso flag"],u:"1f1e7-1f1eb",a:"2.0"},{n:["flag-bg","bulgaria flag"],u:"1f1e7-1f1ec",a:"2.0"},{n:["flag-bh","bahrain flag"],u:"1f1e7-1f1ed",a:"2.0"},{n:["flag-bi","burundi flag"],u:"1f1e7-1f1ee",a:"2.0"},{n:["flag-bj","benin flag"],u:"1f1e7-1f1ef",a:"2.0"},{n:["flag-bl","st. barth\xe9lemy flag"],u:"1f1e7-1f1f1",a:"2.0"},{n:["flag-bm","bermuda flag"],u:"1f1e7-1f1f2",a:"2.0"},{n:["flag-bn","brunei flag"],u:"1f1e7-1f1f3",a:"2.0"},{n:["flag-bo","bolivia flag"],u:"1f1e7-1f1f4",a:"2.0"},{n:["flag-bq","caribbean netherlands flag"],u:"1f1e7-1f1f6",a:"2.0"},{n:["flag-br","brazil flag"],u:"1f1e7-1f1f7",a:"2.0"},{n:["flag-bs","bahamas flag"],u:"1f1e7-1f1f8",a:"2.0"},{n:["flag-bt","bhutan flag"],u:"1f1e7-1f1f9",a:"2.0"},{n:["flag-bv","bouvet island flag"],u:"1f1e7-1f1fb",a:"2.0"},{n:["flag-bw","botswana flag"],u:"1f1e7-1f1fc",a:"2.0"},{n:["flag-by","belarus flag"],u:"1f1e7-1f1fe",a:"2.0"},{n:["flag-bz","belize flag"],u:"1f1e7-1f1ff",a:"2.0"},{n:["flag-ca","canada flag"],u:"1f1e8-1f1e6",a:"2.0"},{n:["flag-cc","cocos (keeling) islands flag"],u:"1f1e8-1f1e8",a:"2.0"},{n:["flag-cd","congo - kinshasa flag"],u:"1f1e8-1f1e9",a:"2.0"},{n:["flag-cf","central african republic flag"],u:"1f1e8-1f1eb",a:"2.0"},{n:["flag-cg","congo - brazzaville flag"],u:"1f1e8-1f1ec",a:"2.0"},{n:["flag-ch","switzerland flag"],u:"1f1e8-1f1ed",a:"2.0"},{n:["flag-ci","c\xf4te d\u2019ivoire flag"],u:"1f1e8-1f1ee",a:"2.0"},{n:["flag-ck","cook islands flag"],u:"1f1e8-1f1f0",a:"2.0"},{n:["flag-cl","chile flag"],u:"1f1e8-1f1f1",a:"2.0"},{n:["flag-cm","cameroon flag"],u:"1f1e8-1f1f2",a:"2.0"},{n:["cn","flag-cn","china flag"],u:"1f1e8-1f1f3",a:"0.6"},{n:["flag-co","colombia flag"],u:"1f1e8-1f1f4",a:"2.0"},{n:["flag-cp","clipperton island flag"],u:"1f1e8-1f1f5",a:"2.0"},{n:["flag-cr","costa rica flag"],u:"1f1e8-1f1f7",a:"2.0"},{n:["flag-cu","cuba flag"],u:"1f1e8-1f1fa",a:"2.0"},{n:["flag-cv","cape verde flag"],u:"1f1e8-1f1fb",a:"2.0"},{n:["flag-cw","cura\xe7ao flag"],u:"1f1e8-1f1fc",a:"2.0"},{n:["flag-cx","christmas island flag"],u:"1f1e8-1f1fd",a:"2.0"},{n:["flag-cy","cyprus flag"],u:"1f1e8-1f1fe",a:"2.0"},{n:["flag-cz","czechia flag"],u:"1f1e8-1f1ff",a:"2.0"},{n:["de","flag-de","germany flag"],u:"1f1e9-1f1ea",a:"0.6"},{n:["flag-dg","diego garcia flag"],u:"1f1e9-1f1ec",a:"2.0"},{n:["flag-dj","djibouti flag"],u:"1f1e9-1f1ef",a:"2.0"},{n:["flag-dk","denmark flag"],u:"1f1e9-1f1f0",a:"2.0"},{n:["flag-dm","dominica flag"],u:"1f1e9-1f1f2",a:"2.0"},{n:["flag-do","dominican republic flag"],u:"1f1e9-1f1f4",a:"2.0"},{n:["flag-dz","algeria flag"],u:"1f1e9-1f1ff",a:"2.0"},{n:["flag-ea","ceuta & melilla flag"],u:"1f1ea-1f1e6",a:"2.0"},{n:["flag-ec","ecuador flag"],u:"1f1ea-1f1e8",a:"2.0"},{n:["flag-ee","estonia flag"],u:"1f1ea-1f1ea",a:"2.0"},{n:["flag-eg","egypt flag"],u:"1f1ea-1f1ec",a:"2.0"},{n:["flag-eh","western sahara flag"],u:"1f1ea-1f1ed",a:"2.0"},{n:["flag-er","eritrea flag"],u:"1f1ea-1f1f7",a:"2.0"},{n:["es","flag-es","spain flag"],u:"1f1ea-1f1f8",a:"0.6"},{n:["flag-et","ethiopia flag"],u:"1f1ea-1f1f9",a:"2.0"},{n:["flag-eu","european union flag"],u:"1f1ea-1f1fa",a:"2.0"},{n:["flag-fi","finland flag"],u:"1f1eb-1f1ee",a:"2.0"},{n:["flag-fj","fiji flag"],u:"1f1eb-1f1ef",a:"2.0"},{n:["flag-fk","falkland islands flag"],u:"1f1eb-1f1f0",a:"2.0"},{n:["flag-fm","micronesia flag"],u:"1f1eb-1f1f2",a:"2.0"},{n:["flag-fo","faroe islands flag"],u:"1f1eb-1f1f4",a:"2.0"},{n:["fr","flag-fr","france flag"],u:"1f1eb-1f1f7",a:"0.6"},{n:["flag-ga","gabon flag"],u:"1f1ec-1f1e6",a:"2.0"},{n:["gb","uk","flag-gb","united kingdom flag"],u:"1f1ec-1f1e7",a:"0.6"},{n:["flag-gd","grenada flag"],u:"1f1ec-1f1e9",a:"2.0"},{n:["flag-ge","georgia flag"],u:"1f1ec-1f1ea",a:"2.0"},{n:["flag-gf","french guiana flag"],u:"1f1ec-1f1eb",a:"2.0"},{n:["flag-gg","guernsey flag"],u:"1f1ec-1f1ec",a:"2.0"},{n:["flag-gh","ghana flag"],u:"1f1ec-1f1ed",a:"2.0"},{n:["flag-gi","gibraltar flag"],u:"1f1ec-1f1ee",a:"2.0"},{n:["flag-gl","greenland flag"],u:"1f1ec-1f1f1",a:"2.0"},{n:["flag-gm","gambia flag"],u:"1f1ec-1f1f2",a:"2.0"},{n:["flag-gn","guinea flag"],u:"1f1ec-1f1f3",a:"2.0"},{n:["flag-gp","guadeloupe flag"],u:"1f1ec-1f1f5",a:"2.0"},{n:["flag-gq","equatorial guinea flag"],u:"1f1ec-1f1f6",a:"2.0"},{n:["flag-gr","greece flag"],u:"1f1ec-1f1f7",a:"2.0"},{n:["flag-gs","south georgia & south sandwich islands flag"],u:"1f1ec-1f1f8",a:"2.0"},{n:["flag-gt","guatemala flag"],u:"1f1ec-1f1f9",a:"2.0"},{n:["flag-gu","guam flag"],u:"1f1ec-1f1fa",a:"2.0"},{n:["flag-gw","guinea-bissau flag"],u:"1f1ec-1f1fc",a:"2.0"},{n:["flag-gy","guyana flag"],u:"1f1ec-1f1fe",a:"2.0"},{n:["flag-hk","hong kong sar china flag"],u:"1f1ed-1f1f0",a:"2.0"},{n:["flag-hm","heard & mcdonald islands flag"],u:"1f1ed-1f1f2",a:"2.0"},{n:["flag-hn","honduras flag"],u:"1f1ed-1f1f3",a:"2.0"},{n:["flag-hr","croatia flag"],u:"1f1ed-1f1f7",a:"2.0"},{n:["flag-ht","haiti flag"],u:"1f1ed-1f1f9",a:"2.0"},{n:["flag-hu","hungary flag"],u:"1f1ed-1f1fa",a:"2.0"},{n:["flag-ic","canary islands flag"],u:"1f1ee-1f1e8",a:"2.0"},{n:["flag-id","indonesia flag"],u:"1f1ee-1f1e9",a:"2.0"},{n:["flag-ie","ireland flag"],u:"1f1ee-1f1ea",a:"2.0"},{n:["flag-il","israel flag"],u:"1f1ee-1f1f1",a:"2.0"},{n:["flag-im","isle of man flag"],u:"1f1ee-1f1f2",a:"2.0"},{n:["flag-in","india flag"],u:"1f1ee-1f1f3",a:"2.0"},{n:["flag-io","british indian ocean territory flag"],u:"1f1ee-1f1f4",a:"2.0"},{n:["flag-iq","iraq flag"],u:"1f1ee-1f1f6",a:"2.0"},{n:["flag-ir","iran flag"],u:"1f1ee-1f1f7",a:"2.0"},{n:["flag-is","iceland flag"],u:"1f1ee-1f1f8",a:"2.0"},{n:["it","flag-it","italy flag"],u:"1f1ee-1f1f9",a:"0.6"},{n:["flag-je","jersey flag"],u:"1f1ef-1f1ea",a:"2.0"},{n:["flag-jm","jamaica flag"],u:"1f1ef-1f1f2",a:"2.0"},{n:["flag-jo","jordan flag"],u:"1f1ef-1f1f4",a:"2.0"},{n:["jp","flag-jp","japan flag"],u:"1f1ef-1f1f5",a:"0.6"},{n:["flag-ke","kenya flag"],u:"1f1f0-1f1ea",a:"2.0"},{n:["flag-kg","kyrgyzstan flag"],u:"1f1f0-1f1ec",a:"2.0"},{n:["flag-kh","cambodia flag"],u:"1f1f0-1f1ed",a:"2.0"},{n:["flag-ki","kiribati flag"],u:"1f1f0-1f1ee",a:"2.0"},{n:["flag-km","comoros flag"],u:"1f1f0-1f1f2",a:"2.0"},{n:["flag-kn","st. kitts & nevis flag"],u:"1f1f0-1f1f3",a:"2.0"},{n:["flag-kp","north korea flag"],u:"1f1f0-1f1f5",a:"2.0"},{n:["kr","flag-kr","south korea flag"],u:"1f1f0-1f1f7",a:"0.6"},{n:["flag-kw","kuwait flag"],u:"1f1f0-1f1fc",a:"2.0"},{n:["flag-ky","cayman islands flag"],u:"1f1f0-1f1fe",a:"2.0"},{n:["flag-kz","kazakhstan flag"],u:"1f1f0-1f1ff",a:"2.0"},{n:["flag-la","laos flag"],u:"1f1f1-1f1e6",a:"2.0"},{n:["flag-lb","lebanon flag"],u:"1f1f1-1f1e7",a:"2.0"},{n:["flag-lc","st. lucia flag"],u:"1f1f1-1f1e8",a:"2.0"},{n:["flag-li","liechtenstein flag"],u:"1f1f1-1f1ee",a:"2.0"},{n:["flag-lk","sri lanka flag"],u:"1f1f1-1f1f0",a:"2.0"},{n:["flag-lr","liberia flag"],u:"1f1f1-1f1f7",a:"2.0"},{n:["flag-ls","lesotho flag"],u:"1f1f1-1f1f8",a:"2.0"},{n:["flag-lt","lithuania flag"],u:"1f1f1-1f1f9",a:"2.0"},{n:["flag-lu","luxembourg flag"],u:"1f1f1-1f1fa",a:"2.0"},{n:["flag-lv","latvia flag"],u:"1f1f1-1f1fb",a:"2.0"},{n:["flag-ly","libya flag"],u:"1f1f1-1f1fe",a:"2.0"},{n:["flag-ma","morocco flag"],u:"1f1f2-1f1e6",a:"2.0"},{n:["flag-mc","monaco flag"],u:"1f1f2-1f1e8",a:"2.0"},{n:["flag-md","moldova flag"],u:"1f1f2-1f1e9",a:"2.0"},{n:["flag-me","montenegro flag"],u:"1f1f2-1f1ea",a:"2.0"},{n:["flag-mf","st. martin flag"],u:"1f1f2-1f1eb",a:"2.0"},{n:["flag-mg","madagascar flag"],u:"1f1f2-1f1ec",a:"2.0"},{n:["flag-mh","marshall islands flag"],u:"1f1f2-1f1ed",a:"2.0"},{n:["flag-mk","north macedonia flag"],u:"1f1f2-1f1f0",a:"2.0"},{n:["flag-ml","mali flag"],u:"1f1f2-1f1f1",a:"2.0"},{n:["flag-mm","myanmar (burma) flag"],u:"1f1f2-1f1f2",a:"2.0"},{n:["flag-mn","mongolia flag"],u:"1f1f2-1f1f3",a:"2.0"},{n:["flag-mo","macao sar china flag"],u:"1f1f2-1f1f4",a:"2.0"},{n:["flag-mp","northern mariana islands flag"],u:"1f1f2-1f1f5",a:"2.0"},{n:["flag-mq","martinique flag"],u:"1f1f2-1f1f6",a:"2.0"},{n:["flag-mr","mauritania flag"],u:"1f1f2-1f1f7",a:"2.0"},{n:["flag-ms","montserrat flag"],u:"1f1f2-1f1f8",a:"2.0"},{n:["flag-mt","malta flag"],u:"1f1f2-1f1f9",a:"2.0"},{n:["flag-mu","mauritius flag"],u:"1f1f2-1f1fa",a:"2.0"},{n:["flag-mv","maldives flag"],u:"1f1f2-1f1fb",a:"2.0"},{n:["flag-mw","malawi flag"],u:"1f1f2-1f1fc",a:"2.0"},{n:["flag-mx","mexico flag"],u:"1f1f2-1f1fd",a:"2.0"},{n:["flag-my","malaysia flag"],u:"1f1f2-1f1fe",a:"2.0"},{n:["flag-mz","mozambique flag"],u:"1f1f2-1f1ff",a:"2.0"},{n:["flag-na","namibia flag"],u:"1f1f3-1f1e6",a:"2.0"},{n:["flag-nc","new caledonia flag"],u:"1f1f3-1f1e8",a:"2.0"},{n:["flag-ne","niger flag"],u:"1f1f3-1f1ea",a:"2.0"},{n:["flag-nf","norfolk island flag"],u:"1f1f3-1f1eb",a:"2.0"},{n:["flag-ng","nigeria flag"],u:"1f1f3-1f1ec",a:"2.0"},{n:["flag-ni","nicaragua flag"],u:"1f1f3-1f1ee",a:"2.0"},{n:["flag-nl","netherlands flag"],u:"1f1f3-1f1f1",a:"2.0"},{n:["flag-no","norway flag"],u:"1f1f3-1f1f4",a:"2.0"},{n:["flag-np","nepal flag"],u:"1f1f3-1f1f5",a:"2.0"},{n:["flag-nr","nauru flag"],u:"1f1f3-1f1f7",a:"2.0"},{n:["flag-nu","niue flag"],u:"1f1f3-1f1fa",a:"2.0"},{n:["flag-nz","new zealand flag"],u:"1f1f3-1f1ff",a:"2.0"},{n:["flag-om","oman flag"],u:"1f1f4-1f1f2",a:"2.0"},{n:["flag-pa","panama flag"],u:"1f1f5-1f1e6",a:"2.0"},{n:["flag-pe","peru flag"],u:"1f1f5-1f1ea",a:"2.0"},{n:["flag-pf","french polynesia flag"],u:"1f1f5-1f1eb",a:"2.0"},{n:["flag-pg","papua new guinea flag"],u:"1f1f5-1f1ec",a:"2.0"},{n:["flag-ph","philippines flag"],u:"1f1f5-1f1ed",a:"2.0"},{n:["flag-pk","pakistan flag"],u:"1f1f5-1f1f0",a:"2.0"},{n:["flag-pl","poland flag"],u:"1f1f5-1f1f1",a:"2.0"},{n:["flag-pm","st. pierre & miquelon flag"],u:"1f1f5-1f1f2",a:"2.0"},{n:["flag-pn","pitcairn islands flag"],u:"1f1f5-1f1f3",a:"2.0"},{n:["flag-pr","puerto rico flag"],u:"1f1f5-1f1f7",a:"2.0"},{n:["flag-ps","palestinian territories flag"],u:"1f1f5-1f1f8",a:"2.0"},{n:["flag-pt","portugal flag"],u:"1f1f5-1f1f9",a:"2.0"},{n:["flag-pw","palau flag"],u:"1f1f5-1f1fc",a:"2.0"},{n:["flag-py","paraguay flag"],u:"1f1f5-1f1fe",a:"2.0"},{n:["flag-qa","qatar flag"],u:"1f1f6-1f1e6",a:"2.0"},{n:["flag-re","r\xe9union flag"],u:"1f1f7-1f1ea",a:"2.0"},{n:["flag-ro","romania flag"],u:"1f1f7-1f1f4",a:"2.0"},{n:["flag-rs","serbia flag"],u:"1f1f7-1f1f8",a:"2.0"},{n:["ru","flag-ru","russia flag"],u:"1f1f7-1f1fa",a:"0.6"},{n:["flag-rw","rwanda flag"],u:"1f1f7-1f1fc",a:"2.0"},{n:["flag-sa","saudi arabia flag"],u:"1f1f8-1f1e6",a:"2.0"},{n:["flag-sb","solomon islands flag"],u:"1f1f8-1f1e7",a:"2.0"},{n:["flag-sc","seychelles flag"],u:"1f1f8-1f1e8",a:"2.0"},{n:["flag-sd","sudan flag"],u:"1f1f8-1f1e9",a:"2.0"},{n:["flag-se","sweden flag"],u:"1f1f8-1f1ea",a:"2.0"},{n:["flag-sg","singapore flag"],u:"1f1f8-1f1ec",a:"2.0"},{n:["flag-sh","st. helena flag"],u:"1f1f8-1f1ed",a:"2.0"},{n:["flag-si","slovenia flag"],u:"1f1f8-1f1ee",a:"2.0"},{n:["flag-sj","svalbard & jan mayen flag"],u:"1f1f8-1f1ef",a:"2.0"},{n:["flag-sk","slovakia flag"],u:"1f1f8-1f1f0",a:"2.0"},{n:["flag-sl","sierra leone flag"],u:"1f1f8-1f1f1",a:"2.0"},{n:["flag-sm","san marino flag"],u:"1f1f8-1f1f2",a:"2.0"},{n:["flag-sn","senegal flag"],u:"1f1f8-1f1f3",a:"2.0"},{n:["flag-so","somalia flag"],u:"1f1f8-1f1f4",a:"2.0"},{n:["flag-sr","suriname flag"],u:"1f1f8-1f1f7",a:"2.0"},{n:["flag-ss","south sudan flag"],u:"1f1f8-1f1f8",a:"2.0"},{n:["flag-st","s\xe3o tom\xe9 & pr\xedncipe flag"],u:"1f1f8-1f1f9",a:"2.0"},{n:["flag-sv","el salvador flag"],u:"1f1f8-1f1fb",a:"2.0"},{n:["flag-sx","sint maarten flag"],u:"1f1f8-1f1fd",a:"2.0"},{n:["flag-sy","syria flag"],u:"1f1f8-1f1fe",a:"2.0"},{n:["flag-sz","eswatini flag"],u:"1f1f8-1f1ff",a:"2.0"},{n:["flag-ta","tristan da cunha flag"],u:"1f1f9-1f1e6",a:"2.0"},{n:["flag-tc","turks & caicos islands flag"],u:"1f1f9-1f1e8",a:"2.0"},{n:["flag-td","chad flag"],u:"1f1f9-1f1e9",a:"2.0"},{n:["flag-tf","french southern territories flag"],u:"1f1f9-1f1eb",a:"2.0"},{n:["flag-tg","togo flag"],u:"1f1f9-1f1ec",a:"2.0"},{n:["flag-th","thailand flag"],u:"1f1f9-1f1ed",a:"2.0"},{n:["flag-tj","tajikistan flag"],u:"1f1f9-1f1ef",a:"2.0"},{n:["flag-tk","tokelau flag"],u:"1f1f9-1f1f0",a:"2.0"},{n:["flag-tl","timor-leste flag"],u:"1f1f9-1f1f1",a:"2.0"},{n:["flag-tm","turkmenistan flag"],u:"1f1f9-1f1f2",a:"2.0"},{n:["flag-tn","tunisia flag"],u:"1f1f9-1f1f3",a:"2.0"},{n:["flag-to","tonga flag"],u:"1f1f9-1f1f4",a:"2.0"},{n:["flag-tr","turkey flag"],u:"1f1f9-1f1f7",a:"2.0"},{n:["flag-tt","trinidad & tobago flag"],u:"1f1f9-1f1f9",a:"2.0"},{n:["flag-tv","tuvalu flag"],u:"1f1f9-1f1fb",a:"2.0"},{n:["flag-tw","taiwan flag"],u:"1f1f9-1f1fc",a:"2.0"},{n:["flag-tz","tanzania flag"],u:"1f1f9-1f1ff",a:"2.0"},{n:["flag-ua","ukraine flag"],u:"1f1fa-1f1e6",a:"2.0"},{n:["flag-ug","uganda flag"],u:"1f1fa-1f1ec",a:"2.0"},{n:["flag-um","u.s. outlying islands flag"],u:"1f1fa-1f1f2",a:"2.0"},{n:["flag-un","united nations flag"],u:"1f1fa-1f1f3",a:"4.0"},{n:["us","flag-us","united states flag"],u:"1f1fa-1f1f8",a:"0.6"},{n:["flag-uy","uruguay flag"],u:"1f1fa-1f1fe",a:"2.0"},{n:["flag-uz","uzbekistan flag"],u:"1f1fa-1f1ff",a:"2.0"},{n:["flag-va","vatican city flag"],u:"1f1fb-1f1e6",a:"2.0"},{n:["flag-vc","st. vincent & grenadines flag"],u:"1f1fb-1f1e8",a:"2.0"},{n:["flag-ve","venezuela flag"],u:"1f1fb-1f1ea",a:"2.0"},{n:["flag-vg","british virgin islands flag"],u:"1f1fb-1f1ec",a:"2.0"},{n:["flag-vi","u.s. virgin islands flag"],u:"1f1fb-1f1ee",a:"2.0"},{n:["flag-vn","vietnam flag"],u:"1f1fb-1f1f3",a:"2.0"},{n:["flag-vu","vanuatu flag"],u:"1f1fb-1f1fa",a:"2.0"},{n:["flag-wf","wallis & futuna flag"],u:"1f1fc-1f1eb",a:"2.0"},{n:["flag-ws","samoa flag"],u:"1f1fc-1f1f8",a:"2.0"},{n:["flag-xk","kosovo flag"],u:"1f1fd-1f1f0",a:"2.0"},{n:["flag-ye","yemen flag"],u:"1f1fe-1f1ea",a:"2.0"},{n:["flag-yt","mayotte flag"],u:"1f1fe-1f1f9",a:"2.0"},{n:["flag-za","south africa flag"],u:"1f1ff-1f1e6",a:"2.0"},{n:["flag-zm","zambia flag"],u:"1f1ff-1f1f2",a:"2.0"},{n:["flag-zw","zimbabwe flag"],u:"1f1ff-1f1fc",a:"2.0"},{n:["england flag","flag-england"],u:"1f3f4-e0067-e0062-e0065-e006e-e0067-e007f",a:"5.0"},{n:["scotland flag","flag-scotland"],u:"1f3f4-e0067-e0062-e0073-e0063-e0074-e007f",a:"5.0"},{n:["wales flag","flag-wales"],u:"1f3f4-e0067-e0062-e0077-e006c-e0073-e007f",a:"5.0"}]},bF=[aF.NEUTRAL,aF.LIGHT,aF.MEDIUM_LIGHT,aF.MEDIUM,aF.MEDIUM_DARK,aF.DARK],_F=Object.entries(aF).reduce((function(e,t){var n=t[0];return e[t[1]]=n,e}),{}),wF=bF.reduce((function(e,t){var n;return Object.assign(e,((n={})[t]=t,n))}),{});!function(e){e.name="n",e.unified="u",e.variations="v",e.added_in="a",e.imgUrl="imgUrl"}(vF||(vF={}));var EF={};function SF(e){CF(e).flat().join("").toLowerCase().replace(/[^a-zA-Z\d]/g,"").split("").forEach((function(t){var n;EF[t]=null!=(n=EF[t])?n:{},EF[t][RF(e)]=e}))}function CF(e){var t;return null!=(t=e[vF.name])?t:[]}function xF(e){return e?CF(e)[0]:""}function TF(e){var t=e.split("-"),n=t.splice(1,1)[0];return wF[n]?t.join("-"):e}function RF(e,t){var n,r=e[vF.unified];return t&&kF(e)&&null!=(n=function(e,t){return t?AF(e).find((function(e){return e.includes(t)})):RF(e)}(e,t))?n:r}function IF(e){var t;return null!=(t=null==yF?void 0:yF[e])?t:[]}function NF(e,t){return""+function(e){switch(e){case rF.TWITTER:return"https://cdn.jsdelivr.net/npm/emoji-datasource-twitter/img/twitter/64/";case rF.GOOGLE:return"https://cdn.jsdelivr.net/npm/emoji-datasource-google/img/google/64/";case rF.FACEBOOK:return"https://cdn.jsdelivr.net/npm/emoji-datasource-facebook/img/facebook/64/";case rF.APPLE:default:return"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/"}}(t)+e+".png"}function AF(e){var t;return null!=(t=e[vF.variations])?t:[]}function kF(e){return AF(e).length>0}function DF(e){if(e){if(OF[e])return OF[e];var t=TF(e);return OF[t]}}setTimeout((function(){MF.reduce((function(e,t){return SF(t),e}),EF)}));var MF=Object.values(yF).flat();function LF(e){yF[oF.CUSTOM].length=0,e.forEach((function(e){var t=function(e){var t;return(t={})[vF.name]=e.names.map((function(e){return e.toLowerCase()})),t[vF.unified]=e.id.toLowerCase(),t[vF.added_in]="0",t[vF.imgUrl]=e.imgUrl,t}(e);yF[oF.CUSTOM].push(t),OF[t[vF.unified]]||(MF.push(t),OF[t[vF.unified]]=t,SF(t))}))}var OF={};setTimeout((function(){MF.reduce((function(e,t){return e[RF(t)]=t,kF(t)&&AF(t).forEach((function(n){e[n]=t})),e}),OF)}));var PF=["2640-fe0f","2642-fe0f","2695-fe0f"],jF="Search",FF=" found. Use up and down arrow keys to navigate.",UF="1 result"+FF,BF="%n results"+FF;function VF(e){var t,n;void 0===e&&(e={});var r=zF(),i=Object.assign(r.previewConfig,null!=(t=e.previewConfig)?t:{}),a=Object.assign(r,e),o=function(e,t){var n;void 0===e&&(e=[]),void 0===t&&(t={});var r={};t.suggestionMode===nF.RECENT&&(r[oF.SUGGESTED]=dF);var i=hF(r);return null!=(n=e)&&n.length?e.map((function(e){return"string"===typeof e?gF(e,r[e]):Wj({},gF(e.category,r[e.category]),e)})):i}(e.categories,{suggestionMode:a.suggestedEmojisMode});a.hiddenEmojis.forEach((function(e){a.unicodeToHide.add(e)})),LF(null!=(n=a.customEmojis)?n:[]);var s=a.searchDisabled?sF.PREVIEW:a.skinTonePickerLocation;return Wj({},a,{categories:o,previewConfig:i,skinTonePickerLocation:s})}function zF(){return{autoFocusSearch:!0,categories:hF(),className:"",customEmojis:[],defaultSkinTone:aF.NEUTRAL,emojiStyle:rF.APPLE,emojiVersion:null,getEmojiUrl:NF,height:450,lazyLoadEmojis:!1,previewConfig:Wj({},WF),searchDisabled:!1,searchPlaceHolder:jF,searchPlaceholder:jF,skinTonePickerLocation:sF.SEARCH,skinTonesDisabled:!1,style:{},suggestedEmojisMode:nF.FREQUENT,theme:iF.LIGHT,unicodeToHide:new Set(PF),width:350,reactionsDefaultOpen:!1,reactions:uF,open:!0,allowExpandReactions:!0,hiddenEmojis:[]}}var WF={defaultEmoji:"1f60a",defaultCaption:"What's your mood?",showPreview:!0},GF=["children"],HF=(0,a.createContext)(zF());function YF(e){var t=e.children,n=function(e){var t,n=(0,a.useState)((function(){return VF(e)})),r=n[0],i=n[1];return(0,a.useEffect)((function(){tF(r,e)||i(VF(e))}),[null==(t=e.customEmojis)?void 0:t.length,e.open,e.emojiVersion,e.reactionsDefaultOpen,e.searchPlaceHolder,e.searchPlaceholder,e.defaultSkinTone,e.skinTonesDisabled,e.autoFocusSearch,e.emojiStyle,e.theme,e.suggestedEmojisMode,e.lazyLoadEmojis,e.className,e.height,e.width,e.searchDisabled,e.skinTonePickerLocation,e.allowExpandReactions]),r}(Hj(e,GF));return(0,a.createElement)(HF.Provider,{value:n},t)}function qF(){return(0,a.useContext)(HF)}var KF,XF=a.createContext({});function QF(){return a.useContext(XF)}function JF(){}function ZF(){return qF().allowExpandReactions}function $F(){return qF().skinTonesDisabled}function eU(){return qF().emojiStyle}function tU(){return qF().categories}function nU(){return qF().previewConfig}function rU(){return qF().searchDisabled}function iU(){return qF().skinTonePickerLocation}function aU(){return qF().getEmojiUrl}function oU(e){return"number"===typeof e?e+"px":e}function sU(e,t){void 0===t&&(t=0);var n=(0,a.useState)(e),r=n[0],i=n[1],o=(0,a.useRef)(null);return[r,function(e){return new Promise((function(n){var r;o.current&&clearTimeout(o.current),o.current=null==(r=window)?void 0:r.setTimeout((function(){i(e),n(e)}),t)}))}]}function cU(){var e=qF().unicodeToHide;return function(t){return e.has(t)}}function uU(){var e=(0,a.useRef)({}),t=qF().emojiVersion;return(0,a.useMemo)((function(){var n=parseFloat(""+t);return!t||Number.isNaN(n)?e.current:MF.reduce((function(e,t){return function(e,t){return function(e){return parseFloat(e[vF.added_in])}(e)>t}(t,n)&&(e[RF(t)]=!0),e}),e.current)}),[t])}function lU(e){var t,n=e.children,r=uU(),i=qF().defaultSkinTone,o=qF().reactionsDefaultOpen,s=(0,a.useRef)(EF),c=(0,a.useRef)(!1),u=(0,a.useRef)(!1),l=(0,a.useRef)(r),d=sU(Date.now(),200),f=sU("",100),h=(0,a.useState)(!1),p=(0,a.useState)(i),m=(0,a.useState)(null),g=(0,a.useState)(new Set),v=(0,a.useState)(null),y=(0,a.useState)(o),b=(0,a.useState)(!1),_=b[0],w=b[1];return t=w,(0,a.useEffect)((function(){t(!0)}),[t]),(0,a.createElement)(dU.Provider,{value:{activeCategoryState:m,activeSkinTone:p,disallowClickRef:c,disallowMouseRef:u,disallowedEmojisRef:l,emojiVariationPickerState:v,emojisThatFailedToLoadState:g,filterRef:s,isPastInitialLoad:_,searchTerm:f,skinToneFanOpenState:h,suggestedUpdateState:d,reactionsModeState:y}},n)}!function(e){e.REACTIONS="reactions",e.PICKER="picker"}(KF||(KF={}));var dU=(0,a.createContext)({activeCategoryState:[null,function(){}],activeSkinTone:[aF.NEUTRAL,function(){}],disallowClickRef:{current:!1},disallowMouseRef:{current:!1},disallowedEmojisRef:{current:{}},emojiVariationPickerState:[null,function(){}],emojisThatFailedToLoadState:[new Set,function(){}],filterRef:{current:{}},isPastInitialLoad:!0,searchTerm:["",function(){return new Promise((function(){}))}],skinToneFanOpenState:[!1,function(){}],suggestedUpdateState:[Date.now(),function(){}],reactionsModeState:[!1,function(){}]});function fU(){return(0,a.useContext)(dU).filterRef}function hU(){return(0,a.useContext)(dU).disallowMouseRef}function pU(){return(0,a.useContext)(dU).reactionsModeState}function mU(){return(0,a.useContext)(dU).searchTerm}function gU(){return(0,a.useContext)(dU).activeSkinTone}function vU(){return(0,a.useContext)(dU).emojisThatFailedToLoadState}function yU(){return(0,a.useContext)(dU).emojiVariationPickerState}function bU(){return(0,a.useContext)(dU).skinToneFanOpenState}function _U(){var e=(0,a.useContext)(dU).suggestedUpdateState,t=e[0],n=e[1];return[t,function(){n(Date.now())}]}function wU(){return!!mU()[0]}function EU(e){e&&requestAnimationFrame((function(){e.focus()}))}function SU(e){e&&EU(e.previousElementSibling)}function CU(e){e&&EU(e.nextElementSibling)}function xU(e){e&&EU(e.firstElementChild)}function TU(){return document.activeElement}function RU(e){var t=e.children,n=(0,a.useRef)(null),r=(0,a.useRef)(null),i=(0,a.useRef)(null),o=(0,a.useRef)(null),s=(0,a.useRef)(null),c=(0,a.useRef)(null),u=(0,a.useRef)(null),l=(0,a.useRef)(null);return(0,a.createElement)(NU.Provider,{value:{AnchoredEmojiRef:r,BodyRef:i,CategoryNavigationRef:c,PickerMainRef:n,SearchInputRef:o,SkinTonePickerRef:s,VariationPickerRef:u,ReactionsRef:l}},t)}var IU,NU=(0,a.createContext)({AnchoredEmojiRef:(0,a.createRef)(),BodyRef:(0,a.createRef)(),CategoryNavigationRef:(0,a.createRef)(),PickerMainRef:(0,a.createRef)(),SearchInputRef:(0,a.createRef)(),SkinTonePickerRef:(0,a.createRef)(),VariationPickerRef:(0,a.createRef)(),ReactionsRef:(0,a.createRef)()});function AU(){return(0,a.useContext)(NU)}function kU(){return AU().PickerMainRef}function DU(){return AU().AnchoredEmojiRef}function MU(){var e=DU();return function(t){null===t&&null!==e.current&&EU(e.current),e.current=t}}function LU(){return AU().BodyRef}function OU(){return AU().SearchInputRef}function PU(){return AU().SkinTonePickerRef}function jU(){return AU().CategoryNavigationRef}function FU(e,t){void 0===t&&(t=0);var n=kB(e);n&&requestAnimationFrame((function(){n.scrollTop=t}))}function UU(e){if(e&&function(e){if(!e)return!1;return DB(e)<AB(KB(e))}(e)&&!e.closest(Kj(Lj.variationPicker))){var t=MB(e),n=DB(e);!function(e,t){var n=kB(e);n&&requestAnimationFrame((function(){n.scrollTop=n.scrollTop+t}))}(t,-(AB(KB(e))-n))}}function BU(e){var t=HB(e);EU(t),UU(t)}function VU(e){if(e){var t=WB(e);if(!t)return BU(qB(e));EU(t),UU(t)}}function zU(e){if(e){var t=GB(e);if(t)EU(t),UU(t);else EU(zB(YB(e)))}}function WU(e,t){if(e){var n=function(e){if(!e)return null;var t=XB(e),n=KB(t),r=bB(t,e),i=_B(t,e),a=yB(t,e);if(0===i){var o=YB(n);return o?EB(VB(o),-1,a,r):null}return function(e,t,n,r){var i=wB(e,t-1,n);return i[r]||i[i.length-1]||null}(VB(t),i,a,r)}(e);if(!n)return t();EU(n),UU(n)}}function GU(e){if(e){var t=function(e){if(!e)return null;var t=XB(e),n=KB(t),r=bB(t,e),i=_B(t,e),a=yB(t,e);if(!function(e,t){if(!e||!t)return!1;var n=t.getBoundingClientRect().height,r=t.getBoundingClientRect().top,i=e.getBoundingClientRect().top,a=e.getBoundingClientRect().height;return Math.round(r-i+n)<a}(t,e)){var o=qB(n);return o?EB(VB(o),0,a,r):null}return function(e,t,n,r){var i=function(e,t,n){var r=t+1;if(r*n>e.length)return[];return wB(e,r,n)}(e,t,n);return i[r]||i[i.length-1]||null}(VB(t),i,a,r)}(e);return EU(t)}}function HU(){var e=yU(),t=e[0],n=e[1],r=bU(),i=r[0],o=r[1];return(0,a.useCallback)((function(){t&&n(null),i&&o(!1)}),[t,i,n,o])}function YU(){var e=yU()[0],t=bU()[0];return function(){return!!e||t}}function qU(){var e=hU();return function(){e.current=!1}}function KU(){var e=hU();return function(){return e.current}}function XU(){var e=OU();return(0,a.useCallback)((function(){EU(e.current)}),[e])}function QU(){var e=jU();return(0,a.useCallback)((function(){e.current&&xU(e.current)}),[e])}function JU(){var e=$U(),t=OU(),n=XU();return function(){t.current&&(t.current.value=""),e(""),n()}}function ZU(){var e=OU(),t=fU(),n=function(){var e=fU();return function t(n){if("function"===typeof n)return t(n(e.current));e.current=n}}(),r=$U(),i=mU()[0],a=function(e,t){var n;if(null==e||!e[t])return"";var r=(null==(n=Object.entries(null==e?void 0:e[t]))?void 0:n.length)||0;return function(e){return e>0?e>1?BF.replace("%n",e.toString()):UF:"No results found"}(r)}(t.current,i);return{onChange:function(e){var i=t.current,a=e.toLowerCase();if(null!=i&&i[a]||a.length<=1)return r(a);var o=function(e,t){if(!t)return null;if(t[e])return t[e];var n=Object.keys(t).sort((function(e,t){return t.length-e.length})).find((function(t){return e.includes(t)}));if(n)return t[n];return null}(a,i);if(!o)return r(a);n((function(e){var t;return Object.assign(e,((t={})[a]=function(e,t){var n={};for(var r in e){var i=e[r];eB(i,t)&&(n[r]=i)}return n}(o,a),t))})),r(a)},searchTerm:i,SearchInputRef:e,statusSearchResults:a}}function $U(){var e=mU()[1],t=kU();return function(n){requestAnimationFrame((function(){e(n?null==n?void 0:n.toLowerCase():n).then((function(){FU(t.current,0)}))}))}}function eB(e,t){return CF(e).some((function(e){return e.includes(t)}))}function tB(e){return e&&"string"===typeof e?e.trim().toLowerCase():""}function nB(){var e=MU(),t=yU()[1];return function(n){var r=RB(n)[0];r&&(e(n),t(r))}}function rB(){return iU()===sF.SEARCH}function iB(){return iU()===sF.PREVIEW}function aB(){!function(){var e=kU(),t=JU(),n=function(){var e=LU();return(0,a.useCallback)((function(t){requestAnimationFrame((function(){e.current&&(e.current.scrollTop=t)}))}),[e])}(),r=OU(),i=XU(),o=YU(),s=function(){var e=hU();return function(){e.current=!0}}(),c=HU(),u=(0,a.useMemo)((function(){return function(e){var r=e.key;if(s(),r===IU.Escape){if(e.preventDefault(),o())return void c();t(),n(0),i()}}}),[n,t,c,i,o,s]);(0,a.useEffect)((function(){var t=e.current;if(t)return t.addEventListener("keydown",u),function(){t.removeEventListener("keydown",u)}}),[e,r,n,u])}(),function(){var e=function(){var e=PU();return(0,a.useCallback)((function(){e.current&&xU(e.current)}),[e])}(),t=kU(),n=LU(),r=OU(),i=bU()[1],o=oB(),s=rB(),c=(0,a.useMemo)((function(){return function(t){switch(t.key){case IU.ArrowRight:if(!s)return;t.preventDefault(),i(!0),e();break;case IU.ArrowDown:t.preventDefault(),o();break;case IU.Enter:t.preventDefault(),function(e){var t=HB(e);EU(t),null==t||t.click()}(n.current)}}}),[e,o,i,n,s]);(0,a.useEffect)((function(){var e=r.current;if(e)return e.addEventListener("keydown",c),function(){e.removeEventListener("keydown",c)}}),[t,r,c])}(),function(){var e=PU(),t=XU(),n=OU(),r=oB(),i=bU(),o=i[0],s=i[1],c=iB(),u=rB(),l=uB(),d=(0,a.useMemo)((function(){return function(e){var n=e.key;if(u)switch(n){case IU.ArrowLeft:if(e.preventDefault(),!o)return t();sB(t);break;case IU.ArrowRight:if(e.preventDefault(),!o)return t();cB();break;case IU.ArrowDown:e.preventDefault(),o&&s(!1),r();break;default:l(e)}if(c)switch(n){case IU.ArrowUp:if(e.preventDefault(),!o)return t();sB(t);break;case IU.ArrowDown:if(e.preventDefault(),!o)return t();cB();break;default:l(e)}}}),[o,t,s,r,l,c,u]);(0,a.useEffect)((function(){var t=e.current;if(t)return t.addEventListener("keydown",d),function(){t.removeEventListener("keydown",d)}}),[e,n,o,d])}(),function(){var e=XU(),t=jU(),n=LU(),r=uB(),i=(0,a.useMemo)((function(){return function(t){switch(t.key){case IU.ArrowUp:t.preventDefault(),e();break;case IU.ArrowRight:t.preventDefault(),CU(TU());break;case IU.ArrowLeft:t.preventDefault(),SU(TU());break;case IU.ArrowDown:t.preventDefault(),BU(n.current);break;default:r(t)}}}),[n,e,r]);(0,a.useEffect)((function(){var e=t.current;if(e)return e.addEventListener("keydown",i),function(){e.removeEventListener("keydown",i)}}),[t,n,i])}(),function(){var e=LU(),t=function(){var e=XU(),t=QU(),n=wU();return(0,a.useCallback)((function(){return n?e():t()}),[e,n,t])}(),n=nB(),r=YU(),i=HU(),o=uB(),s=(0,a.useMemo)((function(){return function(e){var a=e.key,s=TB(TU());switch(a){case IU.ArrowRight:e.preventDefault(),VU(s);break;case IU.ArrowLeft:e.preventDefault(),zU(s);break;case IU.ArrowDown:if(e.preventDefault(),r()){i();break}GU(s);break;case IU.ArrowUp:if(e.preventDefault(),r()){i();break}WU(s,t);break;case IU.Space:e.preventDefault(),n(e.target);break;default:o(e)}}}),[t,o,n,r,i]);(0,a.useEffect)((function(){var t=e.current;if(t)return t.addEventListener("keydown",s),function(){t.removeEventListener("keydown",s)}}),[e,s])}()}function oB(){var e=QU(),t=wU(),n=LU();return(0,a.useCallback)((function(){return t?BU(n.current):e()}),[n,e,t])}function sB(e){var t=TU();t&&(t.nextElementSibling||e(),CU(t))}function cB(){var e=TU();e&&SU(e)}function uB(){var e=function(){var e=OU(),t=$U();return function(n){e.current?(e.current.value=""+e.current.value+n,t(tB(e.current.value))):t(tB(n))}}(),t=XU(),n=rU(),r=HU();return function(i){var a=i.key;(function(e){var t=e.metaKey,n=e.ctrlKey,r=e.altKey;return t||n||r})(i)||n||a.match(/(^[a-zA-Z0-9]$){1}/)&&(i.preventDefault(),r(),t(),e(a))}}function lB(e,t,n){if(t&&n!==rF.NATIVE){var r=RF(t);dB.has(r)||(AF(t).forEach((function(t){!function(e){(new Image).src=e}(e(t,n))})),dB.add(r))}}!function(e){e.ArrowDown="ArrowDown",e.ArrowUp="ArrowUp",e.ArrowLeft="ArrowLeft",e.ArrowRight="ArrowRight",e.Escape="Escape",e.Enter="Enter",e.Space=" "}(IU||(IU={}));var dB=new Set;var fB=["width","height"],hB=40;function pB(e){var t=e.children;return(0,a.createElement)(lU,null,(0,a.createElement)(mB,null,t))}function mB(e){var t,n=e.children,r=pU()[0],i=qF().theme,o=wU(),s=kU(),c=qF().className,u=function(){var e=qF(),t=e.height,n=e.width,r=e.style;return Wj({height:oU(t),width:oU(n)},r)}();aB(),function(){var e=LU(),t=eU(),n=aU();(0,a.useEffect)((function(){if(t!==rF.NATIVE){var r=e.current;return null==r||r.addEventListener("focusin",i),function(){null==r||r.removeEventListener("focusin",i)}}function i(e){var r=TB(e.target);if(r){var i=RB(r)[0];i&&kF(i)&&lB(n,i,t)}}}),[e,t,n])}();var l=u||{},d=l.width,f=l.height,h=Hj(l,fB);return(0,a.createElement)("aside",{className:Fj(vB.main,vB.baseVariables,i===iF.DARK&&vB.darkTheme,i===iF.AUTO&&vB.autoThemeDark,(t={},t[Lj.searchActive]=o,t),r&&vB.reactionsMenu,c),ref:s,style:Wj({},h,!r&&{height:f,width:d})},n)}var gB={"--epr-emoji-variation-picker-bg-color":"var(--epr-dark-emoji-variation-picker-bg-color)","--epr-hover-bg-color-reduced-opacity":"var(--epr-dark-hover-bg-color-reduced-opacity)","--epr-highlight-color":"var(--epr-dark-highlight-color)","--epr-text-color":"var(--epr-dark-text-color)","--epr-hover-bg-color":"var(--epr-dark-hover-bg-color)","--epr-focus-bg-color":"var(--epr-dark-focus-bg-color)","--epr-search-input-bg-color":"var(--epr-dark-search-input-bg-color)","--epr-category-label-bg-color":"var(--epr-dark-category-label-bg-color)","--epr-picker-border-color":"var(--epr-dark-picker-border-color)","--epr-bg-color":"var(--epr-dark-bg-color)","--epr-reactions-bg-color":"var(--epr-dark-reactions-bg-color)","--epr-search-input-bg-color-active":"var(--epr-dark-search-input-bg-color-active)","--epr-emoji-variation-indicator-color":"var(--epr-dark-emoji-variation-indicator-color)","--epr-category-icon-active-color":"var(--epr-dark-category-icon-active-color)","--epr-skin-tone-picker-menu-color":"var(--epr-dark-skin-tone-picker-menu-color)","--epr-skin-tone-outer-border-color":"var(--epr-dark-skin-tone-outer-border-color)","--epr-skin-tone-inner-border-color":"var(--epr-dark-skin-tone-inner-border-color)"},vB=Xj.create({main:{".":["epr-main",Lj.emojiPicker],position:"relative",display:"flex",flexDirection:"column",borderWidth:"1px",borderStyle:"solid",borderRadius:"var(--epr-picker-border-radius)",borderColor:"var(--epr-picker-border-color)",backgroundColor:"var(--epr-bg-color)",overflow:"hidden",transition:"all 0.3s ease-in-out, background-color 0.1s ease-in-out","*":{boxSizing:"border-box",fontFamily:"sans-serif"}},baseVariables:{"--":{"--epr-highlight-color":"#007aeb","--epr-hover-bg-color":"#e5f0fa","--epr-hover-bg-color-reduced-opacity":"#e5f0fa80","--epr-focus-bg-color":"#e0f0ff","--epr-text-color":"#858585","--epr-search-input-bg-color":"#f6f6f6","--epr-picker-border-color":"#e7e7e7","--epr-bg-color":"#fff","--epr-reactions-bg-color":"#ffffff90","--epr-category-icon-active-color":"#6aa8de","--epr-skin-tone-picker-menu-color":"#ffffff95","--epr-skin-tone-outer-border-color":"#555555","--epr-skin-tone-inner-border-color":"var(--epr-bg-color)","--epr-horizontal-padding":"10px","--epr-picker-border-radius":"8px","--epr-search-border-color":"var(--epr-highlight-color)","--epr-header-padding":"15px var(--epr-horizontal-padding)","--epr-active-skin-tone-indicator-border-color":"var(--epr-highlight-color)","--epr-active-skin-hover-color":"var(--epr-hover-bg-color)","--epr-search-input-bg-color-active":"var(--epr-search-input-bg-color)","--epr-search-input-padding":"0 30px","--epr-search-input-border-radius":"8px","--epr-search-input-height":"40px","--epr-search-input-text-color":"var(--epr-text-color)","--epr-search-input-placeholder-color":"var(--epr-text-color)","--epr-search-bar-inner-padding":"var(--epr-horizontal-padding)","--epr-category-navigation-button-size":"30px","--epr-emoji-variation-picker-height":"45px","--epr-emoji-variation-picker-bg-color":"var(--epr-bg-color)","--epr-preview-height":"70px","--epr-preview-text-size":"14px","--epr-preview-text-padding":"0 var(--epr-horizontal-padding)","--epr-preview-border-color":"var(--epr-picker-border-color)","--epr-preview-text-color":"var(--epr-text-color)","--epr-category-padding":"0 var(--epr-horizontal-padding)","--epr-category-label-bg-color":"#ffffffe6","--epr-category-label-text-color":"var(--epr-text-color)","--epr-category-label-padding":"0 var(--epr-horizontal-padding)","--epr-category-label-height":hB+"px","--epr-emoji-size":"30px","--epr-emoji-padding":"5px","--epr-emoji-fullsize":"calc(var(--epr-emoji-size) + var(--epr-emoji-padding) * 2)","--epr-emoji-hover-color":"var(--epr-hover-bg-color)","--epr-emoji-variation-indicator-color":"var(--epr-picker-border-color)","--epr-emoji-variation-indicator-color-hover":"var(--epr-text-color)","--epr-header-overlay-z-index":"3","--epr-emoji-variations-indictator-z-index":"1","--epr-category-label-z-index":"2","--epr-skin-variation-picker-z-index":"5","--epr-preview-z-index":"6","--epr-dark":"#000","--epr-dark-emoji-variation-picker-bg-color":"var(--epr-dark)","--epr-dark-highlight-color":"#c0c0c0","--epr-dark-text-color":"var(--epr-highlight-color)","--epr-dark-hover-bg-color":"#363636f6","--epr-dark-hover-bg-color-reduced-opacity":"#36363680","--epr-dark-focus-bg-color":"#474747","--epr-dark-search-input-bg-color":"#333333","--epr-dark-category-label-bg-color":"#222222e6","--epr-dark-picker-border-color":"#151617","--epr-dark-bg-color":"#222222","--epr-dark-reactions-bg-color":"#22222290","--epr-dark-search-input-bg-color-active":"var(--epr-dark)","--epr-dark-emoji-variation-indicator-color":"#444","--epr-dark-category-icon-active-color":"#3271b7","--epr-dark-skin-tone-picker-menu-color":"#22222295","--epr-dark-skin-tone-outer-border-color":"var(--epr-dark-picker-border-color)","--epr-dark-skin-tone-inner-border-color":"#FFFFFF"}},autoThemeDark:{".":Lj.autoTheme,"@media (prefers-color-scheme: dark)":{"--":gB}},darkTheme:{".":Lj.darkTheme,"--":gB},reactionsMenu:{".":"epr-reactions",height:"50px",display:"inline-flex",backgroundColor:"var(--epr-reactions-bg-color)",backdropFilter:"blur(8px)","--":{"--epr-picker-border-radius":"50px"}}});function yB(e,t){if(!e||!t)return 0;var n=e.getBoundingClientRect().width,r=t.getBoundingClientRect().width;return Math.floor(n/r)}function bB(e,t){if(!e||!t)return 0;var n=t.getBoundingClientRect().width,r=t.getBoundingClientRect().left,i=e.getBoundingClientRect().left;return Math.floor((r-i)/n)}function _B(e,t){if(!e||!t)return 0;var n=t.getBoundingClientRect().height,r=t.getBoundingClientRect().top,i=e.getBoundingClientRect().top;return Math.round((r-i)/n)}function wB(e,t,n){if(-1===t){var r=Math.floor((e.length-1)/n)*n,i=e.length-1;return e.slice(r,i+1)}return e.slice(t*n,(t+1)*n)}function EB(e,t,n,r){var i=wB(e,t,n);return i[r]||i[i.length-1]||null}function SB(e,t,n){if(void 0===n&&(n=0),!e||!t.length)return null;var r=e.getBoundingClientRect().top,i=e.getBoundingClientRect().bottom,a=r+function(e){for(var t=Array.from(e.querySelectorAll(Kj(Lj.label))),n=0,r=t;n<r.length;n++){var i=r[n].getBoundingClientRect().height;if(i>0)return i}return hB}(e);return t.find((function(e){var t=e.getBoundingClientRect().top,o=e.getBoundingClientRect().bottom,s=e.clientHeight*n,c=t+s,u=o-s;return!(c<a)&&(c>=r&&c<=i||u>=r&&u<=i)}))||null}var CB="button"+Kj(Lj.emoji),xB=[CB,Kj(Lj.visible),":not("+Kj(Lj.hidden)+")"].join("");function TB(e){var t;return null!=(t=null==e?void 0:e.closest(CB))?t:null}function RB(e){var t=jB(e),n=PB(e);if(!t)return[];var r=DF(null!=n?n:t);return r?[r,n]:[]}function IB(e){var t;return null!=(t=null==e?void 0:e.clientHeight)?t:0}function NB(e){if(!e)return 0;var t=TB(e),n=KB(t),r=AB(n);return LB(t)+LB(n)+r}function AB(e){var t,n;if(!e)return 0;var r=e.querySelector(Kj(Lj.categoryContent));return(null!=(t=null==e?void 0:e.clientHeight)?t:0)-(null!=(n=null==r?void 0:r.clientHeight)?n:0)}function kB(e){return e?e.matches(Kj(Lj.scrollBody))?e:e.querySelector(Kj(Lj.scrollBody)):null}function DB(e){var t,n;return e?NB(e)-(null!=(t=null==(n=MB(e))?void 0:n.scrollTop)?t:0):0}function MB(e){var t;return e&&null!=(t=e.closest(Kj(Lj.scrollBody)))?t:null}function LB(e){var t;return null!=(t=null==e?void 0:e.offsetTop)?t:0}function OB(e){var t;return null!=(t=null==e?void 0:e.offsetLeft)?t:0}function PB(e){var t;return null!=(t=function(e,t){var n;return null!=(n=function(e){var t;return null!=(t=null==e?void 0:e.dataset)?t:{}}(e)[t])?n:null}(TB(e),"unified"))?t:null}function jB(e){var t=PB(e);return t?TF(t):null}function FB(e){return e?{unified:PB(e),originalUnified:jB(e)}:{unified:null,originalUnified:null}}function UB(e){return e.classList.contains(Lj.visible)}function BB(e){return!e||e.classList.contains(Lj.hidden)}function VB(e){return e?Array.from(e.querySelectorAll(xB)):[]}function zB(e){if(!e)return null;var t=VB(e).slice(-1)[0];return t?UB(t)?t:GB(t):null}function WB(e){var t=e.nextElementSibling;return t?UB(t)?t:WB(t):HB(qB(e))}function GB(e){var t=e.previousElementSibling;return t?UB(t)?t:GB(t):zB(YB(e))}function HB(e){return e?SB(e,VB(e),.1):null}function YB(e){var t=KB(e);if(!t)return null;var n=t.previousElementSibling;return n?BB(n)?YB(n):n:null}function qB(e){var t=KB(e);if(!t)return null;var n=t.nextElementSibling;return n?BB(n)?qB(n):n:null}function KB(e){return e?e.closest(Kj(Lj.category)):null}function XB(e){return e?e.closest(Kj(Lj.categoryContent)):null}function QB(e){return e.split("-").map((function(e){return String.fromCodePoint(parseInt(e,16))})).join("")}var JB="epr_suggested";function ZB(e){try{var t,n,r;if(null==(t=window)||!t.localStorage)return[];var i=JSON.parse(null!=(n=null==(r=window)?void 0:r.localStorage.getItem(JB))?n:"[]");return e===nF.FREQUENT?i.sort((function(e,t){return t.count-e.count})):i}catch(a){return[]}}function $B(e){return void 0!==e.imgUrl}function eV(e,t){var n=(0,a.useRef)(),r=nB(),i=(0,a.useContext)(dU).disallowClickRef,o=yU()[1],s=HU(),c=gU()[0],u=function(e){var t,n=QF().current;return(null!=(t=e===KF.REACTIONS?n.onReactionClick:n.onEmojiClick)?t:n.onEmojiClick)||function(){}}(t),l=_U()[1],d=aU(),f=eU(),h=(0,a.useCallback)((function(e){if(!i.current){s();var t=tV(e),n=t[0],r=t[1];if(n&&r){var a=function(e){var t=e.split("-")[1];return bF.includes(t)?t:null}(r)||c;l(),function(e,t){var n,r=ZB(),i=RF(e,t),a=RF(e),o=r.find((function(e){return e.unified===i}));n=o?[o].concat(r.filter((function(e){return e!==o}))):[o={unified:i,original:a,count:0}].concat(r),o.count++,n.length=Math.min(n.length,14);try{var s;null==(s=window)||s.localStorage.setItem(JB,JSON.stringify(n))}catch(c){}}(n,a),u(function(e,t,n,r){var i=CF(e);if($B(e)){var a=RF(e);return{activeSkinTone:t,emoji:a,getImageUrl:function(){return e.imgUrl},imageUrl:e.imgUrl,isCustom:!0,names:i,unified:a,unifiedWithoutSkinTone:a}}var o=RF(e,t);return{activeSkinTone:t,emoji:QB(o),getImageUrl:function(e){return void 0===e&&(e=null!=n?n:rF.APPLE),r(o,e)},imageUrl:r(o,null!=n?n:rF.APPLE),isCustom:!1,names:i,unified:o,unifiedWithoutSkinTone:RF(e)}}(n,a,f,d),e)}}}),[c,s,i,u,l,d,f]),p=(0,a.useCallback)((function(e){var t;n.current&&clearTimeout(n.current);var a=tV(e)[0];a&&kF(a)&&(n.current=null==(t=window)?void 0:t.setTimeout((function(){i.current=!0,n.current=void 0,s(),r(e.target),o(a)}),500))}),[i,s,r,o]),m=(0,a.useCallback)((function(){n.current?(clearTimeout(n.current),n.current=void 0):i.current&&requestAnimationFrame((function(){i.current=!1}))}),[i]);(0,a.useEffect)((function(){if(e.current){var t=e.current;return t.addEventListener("click",h,{passive:!0}),t.addEventListener("mousedown",p,{passive:!0}),t.addEventListener("mouseup",m,{passive:!0}),function(){null==t||t.removeEventListener("click",h),null==t||t.removeEventListener("mousedown",p),null==t||t.removeEventListener("mouseup",m)}}}),[e,h,p,m])}function tV(e){var t=null==e?void 0:e.target;return function(e){var t;return Boolean((null==e?void 0:e.matches(CB))||(null==e||null==(t=e.parentElement)?void 0:t.matches(CB)))}(t)?RB(t):[]}function nV(e){return(0,a.createElement)("button",Object.assign({type:"button"},e,{className:Fj(rV.button,e.className)}),e.children)}var rV=Xj.create({button:{".":"epr-btn",cursor:"pointer",border:"0",background:"none",outline:"none"}});function iV(e){var t,n=e.emojiNames,r=e.unified,i=e.hidden,o=e.hiddenOnSearch,s=e.showVariations,c=void 0===s||s,u=e.hasVariations,l=e.children,d=e.className,f=e.noBackground,h=void 0!==f&&f;return(0,a.createElement)(nV,{className:Fj(oV.emoji,i&&Jj.hidden,o&&$j.hiddenOnSearch,(t={},t[Lj.visible]=!i&&!o,t),!(!u||!c)&&oV.hasVariations,h&&oV.noBackground,d),"data-unified":r,"aria-label":aV(n),"data-full-name":n},l)}function aV(e){var t;return e[0].match("flag-")&&null!=(t=e[1])?t:e[0]}var oV=Xj.create({emoji:{".":Lj.emoji,position:"relative",width:"var(--epr-emoji-fullsize)",height:"var(--epr-emoji-fullsize)",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",maxWidth:"var(--epr-emoji-fullsize)",maxHeight:"var(--epr-emoji-fullsize)",borderRadius:"8px",overflow:"hidden",transition:"background-color 0.2s",":hover":{backgroundColor:"var(--epr-emoji-hover-color)"},":focus":{backgroundColor:"var(--epr-focus-bg-color)"}},noBackground:{background:"none",":hover":{backgroundColor:"transparent",background:"none"},":focus":{backgroundColor:"transparent",background:"none"}},hasVariations:{".":Lj.emojiHasVariations,":after":{content:"",display:"block",width:"0",height:"0",right:"0px",bottom:"1px",position:"absolute",borderLeft:"4px solid transparent",borderRight:"4px solid transparent",transform:"rotate(135deg)",borderBottom:"4px solid var(--epr-emoji-variation-indicator-color)",zIndex:"var(--epr-emoji-variations-indictator-z-index)"},":hover:after":{borderBottom:"4px solid var(--epr-emoji-variation-indicator-color-hover)"}}}),sV=Xj.create({external:{".":Lj.external,fontSize:"0"},common:{alignSelf:"center",justifySelf:"center",display:"block"}});function cV(e){var t=e.emojiName,n=e.style,r=e.lazyLoad,i=void 0!==r&&r,o=e.imgUrl,s=e.onError,c=e.className;return(0,a.createElement)("img",{src:o,alt:t,className:Fj(uV.emojiImag,sV.external,sV.common,c),loading:i?"lazy":"eager",onError:s,style:n})}var uV=Xj.create({emojiImag:{".":"epr-emoji-img",maxWidth:"var(--epr-emoji-fullsize)",maxHeight:"var(--epr-emoji-fullsize)",minWidth:"var(--epr-emoji-fullsize)",minHeight:"var(--epr-emoji-fullsize)",padding:"var(--epr-emoji-padding)"}});function lV(e){var t=e.unified,n=e.style,r=e.className;return(0,a.createElement)("span",{className:Fj(dV.nativeEmoji,sV.common,sV.external,r),"data-unified":t,style:n},QB(t))}var dV=Xj.create({nativeEmoji:{".":"epr-emoji-native",fontFamily:'"Segoe UI Emoji", "Segoe UI Symbol", "Segoe UI", "Apple Color Emoji", "Twemoji Mozilla", "Noto Color Emoji", "EmojiOne Color", "Android Emoji"!important',position:"relative",lineHeight:"100%",fontSize:"var(--epr-emoji-size)",textAlign:"center",alignSelf:"center",justifySelf:"center",letterSpacing:"0",padding:"var(--epr-emoji-padding)"}});function fV(e){var t=e.emoji,n=e.unified,r=e.emojiStyle,i=e.size,o=e.lazyLoad,s=e.getEmojiUrl,c=void 0===s?NF:s,u=e.className,l=vU()[1],d={};i&&(d.width=d.height=d.fontSize=i+"px");var f=t||DF(n);return f?$B(f)?(0,a.createElement)(cV,{style:d,emojiName:n,emojiStyle:rF.NATIVE,lazyLoad:o,imgUrl:f.imgUrl,onError:h,className:u}):(0,a.createElement)(a.Fragment,null,r===rF.NATIVE?(0,a.createElement)(lV,{unified:n,style:d,className:u}):(0,a.createElement)(cV,{style:d,emojiName:xF(f),emojiStyle:r,lazyLoad:o,imgUrl:c(n,r),onError:h,className:u})):null;function h(){l((function(e){return new Set(e).add(n)}))}}function hV(e){var t=e.emoji,n=e.unified,r=e.hidden,i=e.hiddenOnSearch,o=e.emojiStyle,s=e.showVariations,c=void 0===s||s,u=e.size,l=e.lazyLoad,d=e.getEmojiUrl,f=e.className,h=e.noBackground,p=void 0!==h&&h,m=kF(t);return(0,a.createElement)(iV,{hasVariations:m,showVariations:c,hidden:r,hiddenOnSearch:i,emojiNames:CF(t),unified:n,noBackground:p},(0,a.createElement)(fV,{unified:n,emoji:t,size:u,emojiStyle:o,lazyLoad:l,getEmojiUrl:d,className:f}))}function pV(){var e=pU()[1];return(0,a.createElement)(nV,{"aria-label":"Show all Emojis",title:"Show all Emojis",tabIndex:0,className:Fj(mV.plusSign),onClick:function(){return e(!1)}})}var mV=Xj.create(Wj({plusSign:{fontSize:"20px",padding:"17px",color:"var(--epr-text-color)",borderRadius:"50%",textAlign:"center",lineHeight:"100%",width:"20px",height:"20px",display:"flex",justifyContent:"center",alignItems:"center",transition:"background-color 0.2s ease-in-out",":after":{content:"",minWidth:"20px",minHeight:"20px",backgroundImage:"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI4LjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjgwcHgiIHZpZXdCb3g9IjAgMCAyMCA4MCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMjAgODAiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8cGF0aCBmaWxsPSIjODY4Njg2IiBkPSJNNS43LDEwLjRjMCwwLjEsMC4xLDAuMywwLjIsMC40QzYsMTAuOSw2LjEsMTEsNi4zLDExaDMuNHYzLjRjMCwwLjEsMC4xLDAuMywwLjIsMC40CgljMC4xLDAuMSwwLjIsMC4yLDAuNCwwLjJjMC4zLDAsMC41LTAuMiwwLjUtMC41di0zLjRoMy40YzAuMywwLDAuNS0wLjIsMC41LTAuNXMtMC4yLTAuNS0wLjUtMC41aC0zLjRWNi43YzAtMC4zLTAuMi0wLjUtMC41LTAuNQoJQzkuOCw2LDkuNiw2LjIsOS42LDYuNXYzLjRINi4yQzUuOSw5LjksNS43LDEwLjEsNS43LDEwLjRMNS43LDEwLjR6Ii8+CjxwYXRoIGZpbGw9IiMzMzcxQjciIGQ9Ik01LjcsMzAuNGMwLDAuMSwwLjEsMC4zLDAuMiwwLjRTNi4xLDMxLDYuMywzMWgzLjR2My40YzAsMC4xLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMiwwLjIsMC40LDAuMgoJYzAuMywwLDAuNS0wLjIsMC41LTAuNXYtMy40aDMuNGMwLjMsMCwwLjUtMC4yLDAuNS0wLjVzLTAuMi0wLjUtMC41LTAuNWgtMy40di0zLjRjMC0wLjMtMC4yLTAuNS0wLjUtMC41cy0wLjUsMC4yLTAuNSwwLjV2My40SDYuMgoJQzUuOSwyOS45LDUuNywzMC4xLDUuNywzMC40TDUuNywzMC40eiIvPgo8cGF0aCBmaWxsPSIjQzBDMEJGIiBkPSJNNS43LDUwLjRjMCwwLjEsMC4xLDAuMywwLjIsMC40QzYsNTAuOSw2LjEsNTEsNi4zLDUxaDMuNHYzLjRjMCwwLjEsMC4xLDAuMywwLjIsMC40CgljMC4xLDAuMSwwLjIsMC4yLDAuNCwwLjJjMC4zLDAsMC41LTAuMiwwLjUtMC41di0zLjRoMy40YzAuMywwLDAuNS0wLjIsMC41LTAuNXMtMC4yLTAuNS0wLjUtMC41aC0zLjR2LTMuNGMwLTAuMy0wLjItMC41LTAuNS0wLjUKCXMtMC41LDAuMi0wLjUsMC41djMuNEg2LjJDNS45LDQ5LjksNS43LDUwLjEsNS43LDUwLjRMNS43LDUwLjR6Ii8+CjxwYXRoIGZpbGw9IiM2QUE5REQiIGQ9Ik01LjcsNzAuNGMwLDAuMSwwLjEsMC4zLDAuMiwwLjRTNi4xLDcxLDYuMyw3MWgzLjR2My40YzAsMC4xLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMiwwLjIsMC40LDAuMgoJYzAuMywwLDAuNS0wLjIsMC41LTAuNXYtMy40aDMuNGMwLjMsMCwwLjUtMC4yLDAuNS0wLjVzLTAuMi0wLjUtMC41LTAuNWgtMy40di0zLjRjMC0wLjMtMC4yLTAuNS0wLjUtMC41cy0wLjUsMC4yLTAuNSwwLjV2My40SDYuNAoJQzUuOSw2OS45LDUuNyw3MC4xLDUuNyw3MC40TDUuNyw3MC40eiIvPgo8L3N2Zz4=)",backgroundColor:"transparent",backgroundRepeat:"no-repeat",backgroundSize:"20px",backgroundPositionY:"0"},":hover":{color:"var(--epr-highlight-color)",backgroundColor:"var(--epr-hover-bg-color-reduced-opacity)",":after":{backgroundPositionY:"-20px"}},":focus":{color:"var(--epr-highlight-color)",backgroundColor:"var(--epr-hover-bg-color-reduced-opacity)",":after":{backgroundPositionY:"-40px"}}}},eF("plusSign",{":after":{backgroundPositionY:"-40px"},":hover:after":{backgroundPositionY:"-60px"}})));function gV(){var e=pU()[0],t=AU().ReactionsRef,n=qF().reactions;eV(t,KF.REACTIONS);var r=eU(),i=ZF(),o=aU();return e?(0,a.createElement)("ul",{className:Fj(vV.list,!e&&Jj.hidden),ref:t},n.map((function(e){return(0,a.createElement)("li",{key:e},(0,a.createElement)(hV,{emoji:DF(e),emojiStyle:r,unified:e,showVariations:!1,className:Fj(vV.emojiButton),noBackground:!0,getEmojiUrl:o}))})),i?(0,a.createElement)("li",null,(0,a.createElement)(pV,null)):null):null}var vV=Xj.create({list:{listStyle:"none",margin:"0",padding:"0 5px",display:"flex",justifyContent:"space-between",alignItems:"center",height:"100%"},emojiButton:{":hover":{transform:"scale(1.2)"},":focus":{transform:"scale(1.2)"},":active":{transform:"scale(1.1)"},transition:"transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.5)"}});function yV(){var e=vU()[0],t=function(){var e=fU().current,t=mU()[0];return function(n){return function(e,t,n){var r;return!(!t||!n)&&!(null!=(r=t[n])&&r[e])}(n,e,t)}}();return function(n){var r=RF(n),i=e.has(r),a=t(r);return{failedToLoad:i,filteredOut:a,hidden:i||a}}}function bV(e){var t=e.categoryConfig,n=e.children,r=e.hidden,i=e.hiddenOnSearch,o=pF(t),s=mF(t);return(0,a.createElement)("li",{className:Fj(_V.category,r&&Jj.hidden,i&&$j.hiddenOnSearch),"data-name":o,"aria-label":s},(0,a.createElement)("h2",{className:Fj(_V.label)},s),(0,a.createElement)("div",{className:Fj(_V.categoryContent)},n))}var _V=Xj.create({category:{".":Lj.category,":not(:has(.epr-visible))":{display:"none"}},categoryContent:{".":Lj.categoryContent,display:"grid",gridGap:"0",gridTemplateColumns:"repeat(auto-fill, var(--epr-emoji-fullsize))",justifyContent:"space-between",margin:"var(--epr-category-padding)",position:"relative"},label:{".":Lj.label,alignItems:"center",backdropFilter:"blur(3px)",backgroundColor:"var(--epr-category-label-bg-color)",color:"var(--epr-category-label-text-color)",display:"flex",fontSize:"16px",fontWeight:"bold",height:"var(--epr-category-label-height)",margin:"0",padding:"var(--epr-category-label-padding)",position:"sticky",textTransform:"capitalize",top:"0",width:"100%",zIndex:"var(--epr-category-label-z-index)"}}),wV=!1;function EV(e){var t=e.categoryConfig,n=_U()[0],r=function(){var e=(0,a.useState)(wV),t=e[0],n=e[1];return(0,a.useEffect)((function(){n(!0),wV=!0}),[]),t||wV}(),i=qF().suggestedEmojisMode,o=aU(),s=(0,a.useMemo)((function(){var e;return null!=(e=ZB(i))?e:[]}),[n,i]),c=eU();return r?(0,a.createElement)(bV,{categoryConfig:t,hiddenOnSearch:!0,hidden:0===s.length},s.map((function(e){var t=DF(e.original);return t?(0,a.createElement)(hV,{showVariations:!1,unified:e.unified,emojiStyle:c,emoji:t,key:e.unified,getEmojiUrl:o}):null}))):null}function SV(){var e=tU(),t=(0,a.useRef)(0);return(0,a.createElement)("ul",{className:Fj(TV.emojiList)},e.map((function(e){var n=pF(e);return n===oF.SUGGESTED?(0,a.createElement)(EV,{key:n,categoryConfig:e}):(0,a.createElement)(a.Suspense,{key:n},(0,a.createElement)(CV,{category:n,categoryConfig:e,renderdCategoriesCountRef:t}))})))}function CV(e){var t=e.category,n=e.categoryConfig,r=e.renderdCategoriesCountRef,i=yV(),o=qF().lazyLoadEmojis,s=eU(),c=(0,a.useContext)(dU).isPastInitialLoad,u=gU()[0],l=function(){var e=uU(),t=cU();return function(n){var r=TF(RF(n));return Boolean(e[r]||t(r))}}(),d=aU(),f=!$F(),h=!c&&r.current>0?[]:IF(t);h.length>0&&r.current++;var p=0,m=h.map((function(e){var t=RF(e,u),n=i(e),r=n.failedToLoad,c=n.filteredOut,h=n.hidden,m=l(e);return(h||m)&&p++,m?null:(0,a.createElement)(hV,{showVariations:f,key:t,emoji:e,unified:t,hidden:r,hiddenOnSearch:c,emojiStyle:s,lazyLoad:o,getEmojiUrl:d})}));return(0,a.createElement)(bV,{categoryConfig:n,hidden:p===m.length},m)}var xV,TV=Xj.create({emojiList:{".":Lj.emojiList,listStyle:"none",margin:"0",padding:"0"}});function RV(){var e,t,n=DU(),r=AU().VariationPickerRef,i=yU()[0],o=eU(),s=function(e){var t=DU(),n=LU(),r=xV.Up;return{getMenuDirection:i,getTop:a};function i(){return r}function a(){r=xV.Up;var i=0;if(!e.current)return 0;var a=IB(e.current);if(t.current){var o,s=n.current,c=TB(t.current),u=IB(c);i=NB(c),(null!=(o=null==s?void 0:s.scrollTop)?o:0)>i-a&&(r=xV.Down,i+=u+a)}return i-a}}(r),c=s.getTop,u=s.getMenuDirection,l=MU(),d=function(e){var t=DU();return function(){var n={};if(!e.current)return n;if(t.current){var r=TB(t.current),i=function(e){var t=TB(e),n=KB(t);return OB(t)+OB(n)}(r);if(!r)return n;n.left=i+(null==r?void 0:r.clientWidth)/2}return n}}(r),f=aU(),h=TB(n.current),p=Boolean(i&&h&&kF(i)&&h.classList.contains(Lj.emojiHasVariations));return(0,a.useEffect)((function(){p&&BU(r.current)}),[r,p,n]),!p&&n.current?l(null):(e=c(),t=d()),(0,a.createElement)("div",{ref:r,className:Fj(IV.variationPicker,u()===xV.Down&&IV.pointingUp,p&&IV.visible),style:{top:e}},p&&i?[RF(i)].concat(AF(i)).slice(0,6).map((function(e){return(0,a.createElement)(hV,{key:e,emoji:i,unified:e,emojiStyle:o,showVariations:!1,getEmojiUrl:f})})):null,(0,a.createElement)("div",{className:Fj(IV.pointer),style:t}))}!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down"}(xV||(xV={}));var IV=Xj.create(Wj({variationPicker:{".":Lj.variationPicker,position:"absolute",right:"15px",left:"15px",padding:"5px",boxShadow:"0px 2px 5px rgba(0, 0, 0, 0.2)",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"space-around",opacity:"0",visibility:"hidden",pointerEvents:"none",top:"-100%",border:"1px solid var(--epr-picker-border-color)",height:"var(--epr-emoji-variation-picker-height)",zIndex:"var(--epr-skin-variation-picker-z-index)",background:"var(--epr-emoji-variation-picker-bg-color)",transform:"scale(0.9)",transition:"transform 0.1s ease-out, opacity 0.2s ease-out"},visible:{opacity:"1",visibility:"visible",pointerEvents:"all",transform:"scale(1)"},pointingUp:{".":"pointing-up",transformOrigin:"center 0%",transform:"scale(0.9)"},".pointing-up":{pointer:{top:"0",transform:"rotate(180deg) translateY(100%) translateX(18px)"}},pointer:{".":"epr-emoji-pointer",content:"",position:"absolute",width:"25px",height:"15px",backgroundRepeat:"no-repeat",backgroundPosition:"0 0",backgroundSize:"50px 15px",top:"100%",transform:"translateX(-18px)",backgroundImage:"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI2LjMuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSI1MHB4IgoJIGhlaWdodD0iMTVweCIgdmlld0JveD0iMCAwIDUwIDE1IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA1MCAxNSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnIGlkPSJMYXllcl8xIj4KPC9nPgo8ZyBpZD0iTGF5ZXJfMiI+Cgk8cGF0aCBmaWxsPSIjRkZGRkZGIiBzdHJva2U9IiNFOEU3RTciIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTEuODYtMC40M2w5LjgzLDExLjUzYzAuNTksMC42OSwxLjU2LDAuNjksMi4xNCwwbDkuODMtMTEuNTMiLz4KCTxwYXRoIGZpbGw9IiMwMTAyMDIiIHN0cm9rZT0iIzE1MTYxNyIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMjYuODYtMC40M2w5LjgzLDExLjUzYzAuNTksMC42OSwxLjU2LDAuNjksMi4xNCwwbDkuODMtMTEuNTMiLz4KPC9nPgo8L3N2Zz4=)"}},eF("pointer",{backgroundPosition:"-25px 0"})));function NV(){var e=LU();return function(e){var t=HU();(0,a.useEffect)((function(){var n=e.current;if(n)return n.addEventListener("scroll",r,{passive:!0}),function(){null==n||n.removeEventListener("scroll",r)};function r(){t()}}),[e,t])}(e),eV(e,KF.PICKER),function(){var e=LU(),t=qU(),n=KU();(0,a.useEffect)((function(){var r=e.current;function i(){n()&&t()}return null==r||r.addEventListener("mousemove",i,{passive:!0}),function(){null==r||r.removeEventListener("mousemove",i)}}),[e,t,n])}(),(0,a.createElement)("div",{className:Fj(DV.body,$j.hiddenOnReactions),ref:e},(0,a.createElement)(RV,null),(0,a.createElement)(SV,null))}var AV,kV,DV=Xj.create({body:{".":Lj.scrollBody,flex:"1",overflowY:"scroll",overflowX:"hidden",position:"relative"}});function MV(e,t){var n=LU(),r=KU(),i=qU();(0,a.useEffect)((function(){if(e){var i=n.current;return null==i||i.addEventListener("keydown",s,{passive:!0}),null==i||i.addEventListener("mouseover",c,!0),null==i||i.addEventListener("focus",a,!0),null==i||i.addEventListener("mouseout",o,{passive:!0}),null==i||i.addEventListener("blur",o,!0),function(){null==i||i.removeEventListener("mouseover",c),null==i||i.removeEventListener("mouseout",o),null==i||i.removeEventListener("focus",a,!0),null==i||i.removeEventListener("blur",o,!0),null==i||i.removeEventListener("keydown",s)}}function a(e){var n=TB(e.target);if(!n)return o();var r=FB(n),i=r.unified,a=r.originalUnified;if(!i||!a)return o();t({unified:i,originalUnified:a})}function o(e){if(e&&!TB(e.relatedTarget))return t(null);t(null)}function s(e){"Escape"===e.key&&t(null)}function c(e){if(!r()){var n=TB(e.target);if(n){var a=function(e,t){if(!e||!t)return 0;var n=e.getBoundingClientRect(),r=t.getBoundingClientRect();return r.height-(n.y-r.y)}(n,i);if(a<n.getBoundingClientRect().height)return function(e,t){var n,r=FB(e),i=r.unified,a=r.originalUnified;if(!i||!a)return;null==(n=document.activeElement)||null==n.blur||n.blur(),t({unified:i,originalUnified:a})}(n,t);EU(n)}}}}),[n,e,t,r,i])}function LV(e){var t=e.children,n=e.className,r=e.style,i=void 0===r?{}:r,o=e.direction,s=void 0===o?kV.ROW:o;return(0,a.createElement)("div",{style:Wj({},i),className:Fj(OV.flex,n,OV[s])},t)}!function(e){e.ROW="FlexRow",e.COLUMN="FlexColumn"}(kV||(kV={}));var OV=Xj.create(((AV={flex:{display:"flex"}})[kV.ROW]={flexDirection:"row"},AV[kV.COLUMN]={flexDirection:"column"},AV));function PV(e){var t=e.className,n=e.style,r=void 0===n?{}:n;return(0,a.createElement)("div",{style:Wj({flex:1},r),className:Fj(t)})}function jV(e){var t=e.children,n=e.className,r=e.style;return(0,a.createElement)("div",{style:Wj({},r,{position:"absolute"}),className:n},t)}function FV(e){var t=e.children,n=e.className,r=e.style;return(0,a.createElement)("div",{style:Wj({},r,{position:"relative"}),className:n},t)}function UV(e){var t=e.isOpen,n=e.onClick,r=e.isActive,i=e.skinToneVariation,o=e.style;return(0,a.createElement)(nV,{style:o,onClick:n,className:Fj("epr-tone-"+i,VV.tone,!t&&VV.closedTone,r&&VV.active),"aria-pressed":r,"aria-label":"Skin tone "+_F[i]})}var BV,VV=Xj.create({closedTone:{opacity:"0",zIndex:"0"},active:{".":"epr-active",zIndex:"1",opacity:"1"},tone:{".":"epr-tone",width:"var(--epr-skin-tone-size)",display:"block",cursor:"pointer",borderRadius:"4px",height:"var(--epr-skin-tone-size)",position:"absolute",right:"0",transition:"transform 0.3s ease-in-out, opacity 0.35s ease-in-out",zIndex:"0",border:"1px solid var(--epr-skin-tone-outer-border-color)",boxShadow:"inset 0px 0px 0 1px var(--epr-skin-tone-inner-border-color)",":hover":{boxShadow:"0 0 0 3px var(--epr-active-skin-hover-color), inset 0px 0px 0 1px var(--epr-skin-tone-inner-border-color)"},":focus":{boxShadow:"0 0 0 3px var(--epr-focus-bg-color)"},"&.epr-tone-neutral":{backgroundColor:"#ffd225"},"&.epr-tone-1f3fb":{backgroundColor:"#ffdfbd"},"&.epr-tone-1f3fc":{backgroundColor:"#e9c197"},"&.epr-tone-1f3fd":{backgroundColor:"#c88e62"},"&.epr-tone-1f3fe":{backgroundColor:"#a86637"},"&.epr-tone-1f3ff":{backgroundColor:"#60463a"}}});function zV(){return(0,a.createElement)(FV,{style:{height:28}},(0,a.createElement)(jV,{style:{bottom:0,right:0}},(0,a.createElement)(WV,{direction:BV.VERTICAL})))}function WV(e){var t=e.direction,n=void 0===t?BV.HORIZONTAL:t,r=PU(),i=$F(),o=bU(),s=o[0],c=o[1],u=gU(),l=u[0],d=u[1],f=QF().current.onSkinToneChange||function(){},h=HU(),p=XU();if(i)return null;var m=28*bF.length+"px",g=s?m:"28px",v=n===BV.VERTICAL;return(0,a.createElement)(FV,{className:Fj(GV.skinTones,v&&GV.vertical,s&&GV.open,v&&s&&GV.verticalShadow),style:v?{flexBasis:g,height:g}:{flexBasis:g}},(0,a.createElement)("div",{className:Fj(GV.select),ref:r},bF.map((function(e,t){var n=e===l;return(0,a.createElement)(UV,{key:e,skinToneVariation:e,isOpen:s,style:{transform:Fj(v?"translateY(-"+t*(s?28:0)+"px)":"translateX(-"+t*(s?28:0)+"px)",s&&n&&"scale(1.3)")},isActive:n,onClick:function(){s?(d(e),f(e),p()):c(!0),h()}})}))))}!function(e){e.VERTICAL="epr-vertical",e.HORIZONTAL="epr-horizontal"}(BV||(BV={}));var GV=Xj.create({skinTones:{".":"epr-skin-tones","--":{"--epr-skin-tone-size":"15px"},display:"flex",alignItems:"center",justifyContent:"flex-end",transition:"all 0.3s ease-in-out",padding:"10px 0"},vertical:{padding:"9px",alignItems:"flex-end",flexDirection:"column",borderRadius:"6px",border:"1px solid var(--epr-bg-color)"},verticalShadow:{boxShadow:"0px 0 7px var(--epr-picker-border-color)"},open:{backdropFilter:"blur(5px)",background:"var(--epr-skin-tone-picker-menu-color)",".epr-active":{border:"1px solid var(--epr-active-skin-tone-indicator-border-color)"}},select:{".":"epr-skin-tone-select",position:"relative",width:"var(--epr-skin-tone-size)",height:"var(--epr-skin-tone-size)"}});function HV(){var e=nU(),t=iB();return e.showPreview?(0,a.createElement)(LV,{className:Fj(qV.preview,$j.hiddenOnReactions)},(0,a.createElement)(YV,null),(0,a.createElement)(PV,null),t?(0,a.createElement)(zV,null):null):null}function YV(){var e,t=nU(),n=(0,a.useState)(null),r=n[0],i=n[1],o=eU(),s=yU()[0],c=aU();MV(t.showPreview,i);var u=DF(null!=(e=null==r?void 0:r.unified)?e:null==r?void 0:r.originalUnified),l=null!=u&&null!=r;return(0,a.createElement)((function(){var e=null!=s?s:DF(t.defaultEmoji);if(!e)return null;var n=s?xF(s):t.defaultCaption;return(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",null,l?(0,a.createElement)(fV,{unified:null==r?void 0:r.unified,emoji:u,emojiStyle:o,size:45,getEmojiUrl:c,className:Fj(qV.emoji)}):e?(0,a.createElement)(fV,{unified:RF(e),emoji:e,emojiStyle:o,size:45,getEmojiUrl:c,className:Fj(qV.emoji)}):null),(0,a.createElement)("div",{className:Fj(qV.label)},l?xF(u):n))}),null)}var qV=Xj.create({preview:{alignItems:"center",borderTop:"1px solid var(--epr-preview-border-color)",height:"var(--epr-preview-height)",padding:"0 var(--epr-horizontal-padding)",position:"relative",zIndex:"var(--epr-preview-z-index)"},label:{color:"var(--epr-preview-text-color)",fontSize:"var(--epr-preview-text-size)",padding:"var(--epr-preview-text-padding)",textTransform:"capitalize"},emoji:{padding:"0"}});function KV(e){var t;return null!=(t=null==e?void 0:e.getAttribute("data-name"))?t:null}function XV(){var e=qF().customEmojis;return!!e&&0===e.length}function QV(e){var t,n=e.isActiveCategory,r=e.category,i=e.allowNavigation,o=e.categoryConfig,s=e.onClick;return(0,a.createElement)(nV,{tabIndex:i?0:-1,className:Fj(ez.catBtn,$j.categoryBtn,"epr-icn-"+r,(t={},t[Lj.active]=n,t)),onClick:s,"aria-label":mF(o),"aria-selected":n,role:"tab","aria-controls":"epr-category-nav-id"})}var JV={backgroundPositionY:"calc(var(--epr-category-navigation-button-size) * 3)"},ZV={backgroundPositionY:"calc(var(--epr-category-navigation-button-size) * 2)"},$V={":not(.epr-search-active)":{catBtn:{":hover":JV,"&.epr-active":JV}}},ez=Xj.create(Wj({catBtn:{".":"epr-cat-btn",display:"inline-block",transition:"opacity 0.2s ease-in-out",position:"relative",height:"var(--epr-category-navigation-button-size)",width:"var(--epr-category-navigation-button-size)",backgroundSize:"calc(var(--epr-category-navigation-button-size) * 10)",outline:"none",backgroundPosition:"0 0",backgroundImage:"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI2LjMuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSIyMDBweCIgaGVpZ2h0PSI4MHB4IiB2aWV3Qm94PSIwIDAgMjAwIDgwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyMDAgODAiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8ZyBpZD0iTGF5ZXJfMTEiPgoJPGc+CgkJPHBhdGggZmlsbD0iIzMzNzFCNyIgc3Ryb2tlPSIjMzM3MUI3IiBzdHJva2Utd2lkdGg9IjAuMSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTIuOCwyOS41YzAuNiwwLDEuMS0wLjUsMS4xLTEuMQoJCQljMC0wLjYtMC41LTEuMi0xLjEtMS4yYy0wLjYsMC0xLjIsMC41LTEuMiwxLjJDMTEuNiwyOSwxMi4yLDI5LjUsMTIuOCwyOS41eiBNMTIuOCwyOGMwLjIsMCwwLjQsMC4yLDAuNCwwLjQKCQkJYzAsMC4yLTAuMiwwLjQtMC40LDAuNGMtMC4yLDAtMC40LTAuMi0wLjQtMC40QzEyLjQsMjguMSwxMi42LDI4LDEyLjgsMjh6Ii8+CgkJPHBhdGggZmlsbD0iIzMzNzFCNyIgc3Ryb2tlPSIjMzM3MUI3IiBzdHJva2Utd2lkdGg9IjAuMSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTAsMjNjLTMuOCwwLTcsMy4xLTcsN2MwLDMuOCwzLjEsNyw3LDcKCQkJczctMy4xLDctN0MxNywyNi4yLDEzLjgsMjMsMTAsMjN6IE0xMCwzNi4yYy0zLjQsMC02LjItMi44LTYuMi02LjJjMC0zLjQsMi44LTYuMiw2LjItNi4yczYuMiwyLjgsNi4yLDYuMgoJCQlDMTYuMiwzMy40LDEzLjQsMzYuMiwxMCwzNi4yeiIvPgoJCTxwYXRoIGZpbGw9IiMzMzcxQjciIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTE0LjYsMzEuMmMtMC4xLTAuMS0wLjItMC4yLTAuMy0wLjJINS43CgkJCWMtMC4xLDAtMC4yLDAuMS0wLjMsMC4yYy0wLjEsMC4xLTAuMSwwLjIsMCwwLjRjMC43LDIsMi41LDMuMyw0LjYsMy4zczMuOS0xLjMsNC42LTMuM0MxNC43LDMxLjUsMTQuNywzMS4zLDE0LjYsMzEuMnogTTEwLDM0LjEKCQkJYy0xLjYsMC0zLTAuOS0zLjctMi4yaDcuM0MxMywzMy4yLDExLjYsMzQuMSwxMCwzNC4xeiIvPgoJCTxwYXRoIGZpbGw9IiMzMzcxQjciIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTcuMiwyOS41YzAuNiwwLDEuMi0wLjUsMS4yLTEuMQoJCQljMC0wLjYtMC41LTEuMi0xLjItMS4yYy0wLjYsMC0xLjEsMC41LTEuMSwxLjJDNi4xLDI5LDYuNiwyOS41LDcuMiwyOS41eiBNNy4yLDI4YzAuMiwwLDAuNCwwLjIsMC40LDAuNGMwLDAuMi0wLjIsMC40LTAuNCwwLjQKCQkJYy0wLjIsMC0wLjQtMC4yLTAuNC0wLjRDNi44LDI4LjEsNywyOCw3LjIsMjh6Ii8+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBkPSJNNjQuMSwzMy40bDIuMywwYzAuMiwwLDAuNCwwLjIsMC40LDAuNHYyLjFjMCwwLjItMC4yLDAuNC0wLjQsMC40aC0yLjMKCQkJCWMtMC4yLDAtMC40LTAuMi0wLjQtMC40di0yLjFDNjMuNywzMy42LDYzLjgsMzMuNCw2NC4xLDMzLjR6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgZD0iTTczLjUsMzMuNWgyLjRjMC4yLDAsMC40LDAuMiwwLjQsMC40djJjMCwwLjItMC4yLDAuNC0wLjQsMC40aC0yLjQKCQkJCWMtMC4yLDAtMC40LTAuMi0wLjQtMC40bDAtMkM3My4xLDMzLjYsNzMuMywzMy41LDczLjUsMzMuNXoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBkPSJNNjMuNywyOC40aDEyLjZ2NUg2My43VjI4LjR6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgZD0iTTY1LjUsMjMuNmg4LjljMSwwLDEuOSwwLjgsMS45LDEuOXYzLjFINjMuN3YtMy4xQzYzLjcsMjQuNSw2NC41LDIzLjYsNjUuNSwyMy42eiIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjMzM3MUI3IiBjeD0iNjYuMiIgY3k9IjMwLjkiIHJ4PSIwLjkiIHJ5PSIxIi8+CgkJCTxlbGxpcHNlIGZpbGw9IiMzMzcxQjciIGN4PSI3My44IiBjeT0iMzAuOSIgcng9IjAuOSIgcnk9IjEiLz4KCQk8L2c+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBkPSJNOTYuNCwzMGMwLDMuNi0yLjksNi41LTYuNCw2LjVzLTYuNC0yLjktNi40LTYuNXMyLjktNi41LDYuNC02LjVTOTYuNCwyNi40LDk2LjQsMzB6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgZD0iTTk2LjMsMjguNmMwLDAsMCwwLjEsMCwwLjFjLTAuOSwwLjEtMi45LDAuMS00LjYtMS4xYy0xLjEtMC44LTItMS43LTIuNi0yLjUKCQkJCWMtMC4zLTAuNC0wLjYtMC44LTAuNy0xYy0wLjEtMC4xLTAuMS0wLjEtMC4xLTAuMmMwLjUtMC4xLDEuMi0wLjIsMi0wLjFjMS4yLDAsMi41LDAuMywzLjUsMS4xYzEsMC44LDEuNywxLjgsMi4xLDIuOAoJCQkJQzk2LjEsMjcuOSw5Ni4yLDI4LjMsOTYuMywyOC42eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik04NCwzMi4yYzAsMCwwLTAuMSwwLTAuMWMwLjktMC4yLDIuOS0wLjQsNC43LDAuNmMxLjEsMC43LDEuOSwxLjUsMi40LDIuMwoJCQkJYzAuNCwwLjUsMC42LDEsMC43LDEuM2MtMC40LDAuMS0xLDAuMi0xLjcsMC4zYy0xLDAtMi4xLTAuMS0zLjItMC44cy0xLjktMS42LTIuNC0yLjVDODQuMiwzMi44LDg0LjEsMzIuNSw4NCwzMi4yeiIvPgoJCTwvZz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTExNi4zLDI2LjhsLTEuNCwybC0wLjgtMC44bC0wLjYtMC42bDAsMC45bC0wLjEsOC4yaC02LjgKCQkJCWwtMC4xLTguMmwwLTAuOWwtMC42LDAuNmwtMC44LDAuOGwtMS40LTJsMi42LTIuOWMwLjEtMC4xLDAuMi0wLjEsMC4zLTAuMWgxLjNsMC40LDAuN2MwLjcsMS4zLDIuNiwxLjMsMy4zLTAuMWwwLjMtMC42aDEuMgoJCQkJYzAuMSwwLDAuMiwwLDAuMywwLjFsMC4zLTAuM2wtMC4zLDAuM0wxMTYuMywyNi44eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik0xMTAuMSwyNy43aDJ2MC45YzAsMC40LTAuNCwwLjctMSwwLjdjLTAuNiwwLTEtMC4zLTEtMC43TDExMC4xLDI3LjdMMTEwLjEsMjcuN3oiLz4KCQk8L2c+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBkPSJNMTI2LjgsMzQuM2MwLDEuMi0xLDIuMi0yLjIsMi4ycy0yLjItMS0yLjItMi4yczEtMi4yLDIuMi0yLjJTMTI2LjgsMzMuMSwxMjYuOCwzNC4zeiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik0xMzcuNiwzNC4zYzAsMS4yLTEsMi4yLTIuMiwyLjJjLTEuMiwwLTIuMi0xLTIuMi0yLjJzMS0yLjIsMi4yLTIuMgoJCQkJQzEzNi42LDMyLjEsMTM3LjYsMzMuMSwxMzcuNiwzNC4zeiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik0xMjYuOCwyNC40djkuOSIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik0xMzcuNywyNC40djkuOSIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIGQ9Ik0xMjYuOCwyMy41aDEwLjh2Mi43aC0xMC44QzEyNi44LDI2LjIsMTI2LjgsMjMuNSwxMjYuOCwyMy41eiIvPgoJCTwvZz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSIjMzM3MUI3IiBkPSJNMTcwLjgsMjMuMUwxNzAuOCwyMy4xYy0wLjMsMC0wLjUsMC0wLjgsMGMtMi4xLDAtNCwxLTUuMywyLjVsLTAuMSwwbC0wLjEtMC4xbC0xLTEuMmwtMC4zLDMuNGwzLjQsMC4zCgkJCQlsLTEuMS0xLjNsLTAuMS0wLjFsMC4xLTAuMWMxLjEtMS41LDMtMi4zLDUtMi4xbDAsMGMzLjIsMC4zLDUuNSwzLjEsNS4yLDYuM2MtMC4zLDMtMy4xLDUuMy02LjEsNS4xYy0zLjEtMC4yLTUuNC0yLjktNS4zLTYKCQkJCWwtMS4zLTAuMWMtMC4yLDMuOCwyLjYsNy4xLDYuMyw3LjRjMy45LDAuMyw3LjMtMi42LDcuNi02LjVDMTc3LjIsMjYuOCwxNzQuNCwyMy41LDE3MC44LDIzLjF6Ii8+CgkJCTxwYXRoIGZpbGw9IiMzMzcxQjciIGQ9Ik0xNzAuMywyNy40YzAtMC4zLTAuMy0wLjYtMC42LTAuNnMtMC42LDAuMy0wLjYsMC42djMuMmMwLDAuMiwwLjEsMC4zLDAuMiwwLjRjMC4xLDAuMSwwLjMsMC4yLDAuNCwwLjIKCQkJCWgyLjRjMC40LDAsMC42LTAuMywwLjYtMC42YzAtMC40LTAuMy0wLjYtMC42LTAuNmgtMS42aC0wLjJ2LTAuMkwxNzAuMywyNy40TDE3MC4zLDI3LjR6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgZD0iTTE4Ni4yLDIzLjRoNy43YzEuNSwwLDIuNywxLjIsMi43LDIuN3Y3LjdjMCwxLjUtMS4yLDIuNy0yLjcsMi43aC03LjcKCQkJCWMtMS41LDAtMi43LTEuMi0yLjctMi43di03LjdDMTgzLjQsMjQuNiwxODQuNywyMy40LDE4Ni4yLDIzLjR6Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiMzMzcxQjciIGN4PSIxODYiIGN5PSIyOC45IiByeD0iMC43IiByeT0iMC43Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiMzMzcxQjciIGN4PSIxOTQiIGN5PSIyNi43IiByeD0iMC43IiByeT0iMC43Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTg2LDMzLjNsMC40LTAuM2MwLjQtMC4zLDEtMC4zLDEuNS0wLjFsMSwwLjQKCQkJCWMwLjUsMC4yLDEsMC4yLDEuNS0wLjFsMC44LTAuNWMwLjQtMC4zLDEtMC4zLDEuNS0wLjFsMS44LDAuOCIvPgoJCTwvZz4KCTwvZz4KCTxwYXRoIGZpbGw9IiMzMzcxQjciIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLXdpZHRoPSIwLjI1IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0xNTYsMjQuM2MtMC4yLTAuMS0wLjQtMC4xLTAuNSwwCgkJYzAsMC0wLjIsMC4xLTAuOSwwLjJjLTAuNywwLTIuNC0wLjEtMy44LTAuNmMtMC44LTAuMy0xLjctMC41LTIuNS0wLjVjLTAuMiwwLTAuNCwwLTAuNSwwYy0xLjMsMC0yLjUsMC4zLTMuNiwxCgkJYy0wLjIsMC4xLTAuMiwwLjItMC4yLDAuNHYxMS42YzAsMC4zLDAuMSwwLjUsMC4zLDAuNWMwLjYsMCwwLjUtMC40LDAuNS0wLjZ2LTUuN2MwLjctMC4zLDMuMi0xLjEsNS44LTAuMQoJCWMxLjYsMC42LDMuNSwwLjcsNC4zLDAuN2MwLjgsMCwxLjMtMC4zLDEuMy0wLjNjMC4yLTAuMSwwLjMtMC4yLDAuMy0wLjR2LTUuN0MxNTYuMiwyNC42LDE1Ni4xLDI0LjQsMTU2LDI0LjN6IE0xNTUuNiwzMC4yCgkJYy0wLjEsMC0wLjcsMC4xLTEsMC4xYy0wLjcsMC0yLjQtMC4xLTMuOC0wLjZjLTIuNS0xLTUtMC41LTYuMi0wLjF2LTQuOWMwLjktMC41LDIuMi0wLjcsMy4yLTAuN2MwLjEsMCwwLjMsMCwwLjQsMAoJCWMwLjcsMCwxLjUsMC4yLDIuMiwwLjRjMS42LDAuNiwzLjUsMC43LDQuMywwLjdjMC4yLDAsMC44LDAsMS0wLjFWMzAuMnoiLz4KCTxnPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgZD0iTTQ4LjEsMjMuNWgzLjdjMi41LDAsNC41LDIsNC41LDQuNWMwLDAuNS0wLjQsMC45LTAuOSwwLjlINDQuNWMtMC41LDAtMC45LTAuNC0wLjktMC45CgkJCUM0My42LDI1LjUsNDUuNiwyMy41LDQ4LjEsMjMuNXoiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTQzLjUsMjguOGMtMC4yLDAuMS0wLjUsMS4yLDAsMS41YzEuNCwxLDguNSwwLjgsMTEuMywwLjYKCQkJYzAuOC0wLjEsMS42LTAuNCwxLjctMS4yYzAtMC4zLTAuMS0wLjYtMC42LTAuOSIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSwzMC42TDQzLjMsMzFjLTAuMiwwLjUsMC4yLDEsMC43LDAuOWMwLjMtMC4xLDAuNSwwLDAuNywwLjMKCQkJbDAuMSwwLjJjMC4zLDAuNSwxLDAuNiwxLjUsMC4ybDAsMGMwLjMtMC4yLDAuNy0wLjMsMS0wLjJsMC44LDAuM2MwLjQsMC4yLDAuOCwwLjEsMS4yLDBsMC41LTAuMmMwLjQtMC4yLDAuOS0wLjIsMS4zLDBsMC41LDAuMgoJCQljMC40LDAuMiwwLjgsMC4yLDEuMiwwbDAuMi0wLjFjMC4zLTAuMiwwLjgtMC4yLDEuMSwwLjFsMC4yLDAuMmMwLjMsMC4zLDAuOCwwLjIsMS0wLjJsMC4xLTAuMmMwLjEtMC4yLDAtMC4zLDAuMi0wLjMKCQkJYzAuNSwwLDEuMi0wLjMsMS4xLTAuN2wtMC40LTEuMSIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSwzMi4yYy0wLjEsMC4yLTAuMywwLjgsMCwxLjFjMC4zLDAuNCwzLDEuMSw2LjQsMS4xCgkJCWMyLjIsMCw0LjYtMC4zLDYtMC42YzAuNS0wLjEsMC45LTAuNSwwLjgtMC45YzAtMC4yLTAuMi0wLjUtMC40LTAuNyIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSwzMy4zYzAsMC41LDAuNiwyLjMsMS4zLDIuN2MxLjgsMC44LDUuNywwLjcsOC4xLDAuNQoJCQljMS4zLTAuMSwyLjUtMC43LDMuMi0xLjhjMC4zLTAuNSwwLjUtMSwwLjUtMS40Ii8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjUxLjYiIGN5PSIyNi41IiByeD0iMC4zIiByeT0iMC40Ii8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjUzIiBjeT0iMjUiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjMzM3MUI3IiBjeD0iNTMiIGN5PSIyNy4yIiByeD0iMC4zIiByeT0iMC40Ii8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjU0LjMiIGN5PSIyNi41IiByeD0iMC4zIiByeT0iMC40Ii8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjUwLjkiIGN5PSIyNSIgcng9IjAuMyIgcnk9IjAuNCIvPgoJPC9nPgoJPGc+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBkPSJNMjQuMiwzMXYtNy42YzAuMSwwLjEsMC44LDAuOSwyLjgsMy4xYzIuNS0xLjYsNS42LTAuNyw2LjksMGwyLjQtMy4xdjcuMQoJCQljMCwxLjItMC4xLDIuNS0wLjksMy40Yy0xLDEuMi0yLjcsMi41LTUuMywyLjVjLTIuOSwwLTQuNS0xLjUtNS4zLTIuOUMyNC4yLDMyLjksMjQuMiwzMiwyNC4yLDMxeiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMjEuMiwzMGw1LjQsMS4yIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMzM3MUI3IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0yMS4yLDM0LjFsNS40LTEuMiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzguOCwzMGwtNS40LDEuMiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzMzNzFCNyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzguOCwzNC4xbC01LjQtMS4yIi8+CgkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMzMzcxQjciIGQ9Ik0yOS41LDMyLjRMMjksMzEuN2MtMC4yLTAuMywwLTAuNiwwLjMtMC42aDEuNAoJCQljMC4zLDAsMC41LDAuNCwwLjMsMC42bC0wLjcsMWwwLDBjLTAuNywxLjItMi42LDEuMS0zLjEtMC4zbC0wLjEtMC4yYy0wLjEtMC4yLDAtMC40LDAuMi0wLjVzMC40LDAsMC41LDAuMmwwLjEsMC4yCgkJCUMyOC4zLDMyLjgsMjkuMSwzMi45LDI5LjUsMzIuNHoiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiMzMzcxQjciIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTMyLjQsMzIuMWwtMC4xLDAuMmMtMC40LDEtMS44LDEuMS0yLjMsMC4yIi8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjI3LjYiIGN5PSIyOS43IiByeD0iMC43IiByeT0iMC43Ii8+CgkJPGVsbGlwc2UgZmlsbD0iIzMzNzFCNyIgY3g9IjMyLjQiIGN5PSIyOS43IiByeD0iMC43IiByeT0iMC43Ii8+Cgk8L2c+Cgk8Zz4KCQk8cGF0aCBmaWxsPSIjQzBDMEJGIiBzdHJva2U9IiNDMEMwQkYiIHN0cm9rZS13aWR0aD0iMC4xIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0xMi44LDQ5LjVjMC42LDAsMS4xLTAuNSwxLjEtMS4xCgkJCWMwLTAuNi0wLjUtMS4yLTEuMS0xLjJjLTAuNiwwLTEuMiwwLjUtMS4yLDEuMkMxMS42LDQ5LDEyLjIsNDkuNSwxMi44LDQ5LjV6IE0xMi44LDQ4YzAuMiwwLDAuNCwwLjIsMC40LDAuNAoJCQljMCwwLjItMC4yLDAuNC0wLjQsMC40Yy0wLjIsMC0wLjQtMC4yLTAuNC0wLjRDMTIuNCw0OC4xLDEyLjYsNDgsMTIuOCw0OHoiLz4KCQk8cGF0aCBmaWxsPSIjQzBDMEJGIiBzdHJva2U9IiNDMEMwQkYiIHN0cm9rZS13aWR0aD0iMC4xIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0xNC42LDUxLjJjLTAuMS0wLjEtMC4yLTAuMi0wLjMtMC4ySDUuNwoJCQljLTAuMSwwLTAuMiwwLjEtMC4zLDAuMmMtMC4xLDAuMS0wLjEsMC4yLDAsMC40YzAuNywyLDIuNSwzLjMsNC42LDMuM3MzLjktMS4zLDQuNi0zLjNDMTQuNyw1MS41LDE0LjcsNTEuMywxNC42LDUxLjJ6IE0xMCw1NC4xCgkJCWMtMS42LDAtMy0wLjktMy43LTIuMmg3LjNDMTMsNTMuMiwxMS42LDU0LjEsMTAsNTQuMXoiLz4KCQk8cGF0aCBmaWxsPSIjQzBDMEJGIiBzdHJva2U9IiNDMEMwQkYiIHN0cm9rZS13aWR0aD0iMC4xIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik03LjIsNDkuNWMwLjYsMCwxLjItMC41LDEuMi0xLjEKCQkJYzAtMC42LTAuNS0xLjItMS4yLTEuMmMtMC42LDAtMS4xLDAuNS0xLjEsMS4yQzYuMSw0OSw2LjYsNDkuNSw3LjIsNDkuNXogTTcuMiw0OGMwLjIsMCwwLjQsMC4yLDAuNCwwLjRjMCwwLjItMC4yLDAuNC0wLjQsMC40CgkJCWMtMC4yLDAtMC40LTAuMi0wLjQtMC40QzYuOCw0OC4xLDcsNDgsNy4yLDQ4eiIvPgoJCTxwYXRoIGZpbGw9IiNDMEMwQkYiIHN0cm9rZT0iI0MwQzBCRiIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTEwLDQzYy0zLjgsMC03LDMuMS03LDdjMCwzLjgsMy4xLDcsNyw3CgkJCXM3LTMuMSw3LTdDMTcsNDYuMiwxMy44LDQzLDEwLDQzeiBNMTAsNTYuMmMtMy40LDAtNi4yLTIuOC02LjItNi4yYzAtMy40LDIuOC02LjIsNi4yLTYuMnM2LjIsMi44LDYuMiw2LjIKCQkJQzE2LjIsNTMuNCwxMy40LDU2LjIsMTAsNTYuMnoiLz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIGQ9Ik02NC4xLDUzLjRsMi4zLDBjMC4yLDAsMC40LDAuMiwwLjQsMC40djIuMWMwLDAuMi0wLjIsMC40LTAuNCwwLjRoLTIuMwoJCQkJYy0wLjIsMC0wLjQtMC4yLTAuNC0wLjR2LTIuMUM2My43LDUzLjYsNjMuOCw1My40LDY0LjEsNTMuNHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBkPSJNNzMuNSw1My41aDIuNGMwLjIsMCwwLjQsMC4yLDAuNCwwLjR2MmMwLDAuMi0wLjIsMC40LTAuNCwwLjRoLTIuNAoJCQkJYy0wLjIsMC0wLjQtMC4yLTAuNC0wLjRsMC0yQzczLjEsNTMuNiw3My4zLDUzLjUsNzMuNSw1My41eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIGQ9Ik02My43LDQ4LjRoMTIuNnY1SDYzLjdWNDguNHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBkPSJNNjUuNSw0My42aDguOWMxLDAsMS45LDAuOCwxLjksMS45djMuMUg2My43di0zLjFDNjMuNyw0NC41LDY0LjUsNDMuNiw2NS41LDQzLjZ6Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiNDMEMwQkYiIGN4PSI2Ni4yIiBjeT0iNTAuOSIgcng9IjAuOSIgcnk9IjEiLz4KCQkJPGVsbGlwc2UgZmlsbD0iI0MwQzBCRiIgY3g9IjczLjgiIGN5PSI1MC45IiByeD0iMC45IiByeT0iMSIvPgoJCTwvZz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIGQ9Ik05Ni40LDUwYzAsMy42LTIuOSw2LjUtNi40LDYuNXMtNi40LTIuOS02LjQtNi41czIuOS02LjUsNi40LTYuNVM5Ni40LDQ2LjQsOTYuNCw1MHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBkPSJNOTYuMyw0OC42YzAsMCwwLDAuMSwwLDAuMWMtMC45LDAuMS0yLjksMC4xLTQuNi0xLjJjLTEuMS0wLjgtMi0xLjctMi42LTIuNQoJCQkJYy0wLjMtMC40LTAuNi0wLjgtMC43LTFjLTAuMS0wLjEtMC4xLTAuMi0wLjEtMC4yYzAuNS0wLjEsMS4yLTAuMiwyLTAuMmMxLjIsMCwyLjUsMC4zLDMuNSwxLjFjMSwwLjgsMS43LDEuOCwyLjEsMi44CgkJCQlDOTYuMSw0Ny45LDk2LjIsNDguMyw5Ni4zLDQ4LjZ6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTg0LDUyLjJjMCwwLDAtMC4xLDAtMC4xYzAuOS0wLjIsMi45LTAuNCw0LjcsMC42YzEuMSwwLjcsMS45LDEuNSwyLjQsMi4zCgkJCQljMC40LDAuNSwwLjYsMSwwLjcsMS4zYy0wLjQsMC4xLTEsMC4yLTEuNywwLjNjLTEsMC0yLjEtMC4xLTMuMi0wLjhzLTEuOS0xLjYtMi40LTIuNUM4NC4yLDUyLjgsODQuMSw1Mi41LDg0LDUyLjJ6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTE2LjMsNDYuOGwtMS40LDJsLTAuOC0wLjhsLTAuNi0wLjdsMCwwLjlsLTAuMSw4LjJoLTYuOAoJCQkJbC0wLjEtOC4ybDAtMC45bC0wLjYsMC43bC0wLjgsMC44bC0xLjQtMmwyLjYtMi45YzAuMS0wLjEsMC4yLTAuMSwwLjMtMC4xaDEuM2wwLjQsMC43YzAuNywxLjMsMi42LDEuMywzLjMtMC4xbDAuMy0wLjZoMS4yCgkJCQljMC4xLDAsMC4yLDAsMC4zLDAuMWwwLjMtMC4zbC0wLjMsMC4zTDExNi4zLDQ2Ljh6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTExMC4xLDQ3LjdoMnYwLjljMCwwLjQtMC40LDAuNy0xLDAuN2MtMC42LDAtMS0wLjMtMS0wLjdMMTEwLjEsNDcuN0wxMTAuMSw0Ny43eiIvPgoJCTwvZz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIGQ9Ik0xMjYuOCw1NC4zYzAsMS4yLTEsMi4yLTIuMiwyLjJzLTIuMi0xLTIuMi0yLjJzMS0yLjIsMi4yLTIuMlMxMjYuOCw1My4xLDEyNi44LDU0LjN6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTEzNy42LDU0LjNjMCwxLjItMSwyLjItMi4yLDIuMmMtMS4yLDAtMi4yLTEtMi4yLTIuMnMxLTIuMiwyLjItMi4yCgkJCQlDMTM2LjYsNTIuMSwxMzcuNiw1My4xLDEzNy42LDU0LjN6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTEyNi44LDQ0LjR2OS45Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTEzNy43LDQ0LjR2OS45Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgZD0iTTEyNi44LDQzLjVoMTAuOHYyLjdoLTEwLjhDMTI2LjgsNDYuMiwxMjYuOCw0My41LDEyNi44LDQzLjV6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9IiNDMEMwQkYiIGQ9Ik0xNzAuOCw0My4xTDE3MC44LDQzLjFjLTAuMywwLTAuNSwwLTAuOCwwYy0yLjEsMC00LDEtNS4zLDIuNWwtMC4xLDBsLTAuMS0wLjFsLTEtMS4ybC0wLjMsMy40bDMuNCwwLjMKCQkJCWwtMS4xLTEuM2wtMC4xLTAuMWwwLjEtMC4xYzEuMS0xLjUsMy0yLjMsNS0yLjFsMCwwYzMuMiwwLjMsNS41LDMuMSw1LjIsNi4zYy0wLjMsMy0zLjEsNS4zLTYuMSw1LjFjLTMuMS0wLjItNS40LTIuOS01LjMtNgoJCQkJbC0xLjMtMC4xYy0wLjIsMy44LDIuNiw3LjEsNi4zLDcuNGMzLjksMC4zLDcuMy0yLjYsNy42LTYuNUMxNzcuMiw0Ni44LDE3NC40LDQzLjUsMTcwLjgsNDMuMXoiLz4KCQkJPHBhdGggZmlsbD0iI0MwQzBCRiIgZD0iTTE3MC4zLDQ3LjRjMC0wLjMtMC4zLTAuNi0wLjYtMC42cy0wLjYsMC4zLTAuNiwwLjZ2My4yYzAsMC4yLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMywwLjIsMC40LDAuMgoJCQkJaDIuNGMwLjQsMCwwLjYtMC4zLDAuNi0wLjZjMC0wLjMtMC4zLTAuNi0wLjYtMC42aC0xLjZoLTAuMnYtMC4yTDE3MC4zLDQ3LjRMMTcwLjMsNDcuNHoiLz4KCQk8L2c+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBkPSJNMTg2LjIsNDMuNGg3LjdjMS41LDAsMi43LDEuMiwyLjcsMi43djcuN2MwLDEuNS0xLjIsMi43LTIuNywyLjdoLTcuNwoJCQkJYy0xLjUsMC0yLjctMS4yLTIuNy0yLjd2LTcuN0MxODMuNCw0NC43LDE4NC43LDQzLjQsMTg2LjIsNDMuNHoiLz4KCQkJPGVsbGlwc2UgZmlsbD0iI0MwQzBCRiIgY3g9IjE4NiIgY3k9IjQ4LjkiIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQkJPGVsbGlwc2UgZmlsbD0iI0MwQzBCRiIgY3g9IjE5NCIgY3k9IjQ2LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0xODYsNTMuM2wwLjQtMC4zYzAuNC0wLjMsMS0wLjMsMS41LTAuMWwxLDAuNAoJCQkJYzAuNSwwLjIsMSwwLjIsMS41LTAuMWwwLjgtMC41YzAuNC0wLjMsMS0wLjMsMS41LTAuMWwxLjgsMC44Ii8+CgkJPC9nPgoJPC9nPgoJPHBhdGggZmlsbD0iI0MwQzBCRiIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2Utd2lkdGg9IjAuMjUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTE1Niw0NC4zYy0wLjItMC4xLTAuNC0wLjEtMC41LDAKCQljMCwwLTAuMiwwLjEtMC45LDAuMmMtMC43LDAtMi40LTAuMS0zLjgtMC42Yy0wLjgtMC4zLTEuNy0wLjUtMi41LTAuNWMtMC4yLDAtMC40LDAtMC41LDBjLTEuMywwLTIuNSwwLjMtMy42LDEKCQljLTAuMiwwLjEtMC4yLDAuMi0wLjIsMC40djExLjZjMCwwLjMsMC4xLDAuNSwwLjMsMC41YzAuNiwwLDAuNS0wLjQsMC41LTAuNnYtNS43YzAuNy0wLjMsMy4yLTEuMSw1LjgtMC4xCgkJYzEuNiwwLjYsMy41LDAuNyw0LjMsMC43YzAuOCwwLDEuMy0wLjMsMS4zLTAuM2MwLjItMC4xLDAuMy0wLjIsMC4zLTAuNHYtNS43QzE1Ni4yLDQ0LjYsMTU2LjEsNDQuNCwxNTYsNDQuM3ogTTE1NS42LDUwLjIKCQljLTAuMSwwLTAuNywwLjEtMSwwLjFjLTAuNywwLTIuNC0wLjEtMy44LTAuNmMtMi41LTEtNS0wLjUtNi4yLTAuMXYtNC45YzAuOS0wLjUsMi4yLTAuNywzLjItMC43YzAuMSwwLDAuMywwLDAuNCwwCgkJYzAuNywwLDEuNSwwLjIsMi4yLDAuNGMxLjYsMC42LDMuNSwwLjcsNC4zLDAuN2MwLjIsMCwwLjgsMCwxLTAuMVY1MC4yeiIvPgoJPGc+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBkPSJNNDguMSw0My41aDMuN2MyLjUsMCw0LjUsMiw0LjUsNC41YzAsMC41LTAuNCwwLjktMC45LDAuOUg0NC41Yy0wLjUsMC0wLjktMC40LTAuOS0wLjkKCQkJQzQzLjYsNDUuNSw0NS42LDQzLjUsNDguMSw0My41eiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSw0OC44Yy0wLjIsMC4xLTAuNSwxLjIsMCwxLjVjMS40LDEsOC41LDAuOCwxMS4zLDAuNgoJCQljMC44LTAuMSwxLjYtMC40LDEuNy0xLjJjMC0wLjMtMC4xLTAuNi0wLjYtMC45Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDUwLjZMNDMuMyw1MWMtMC4yLDAuNSwwLjIsMSwwLjcsMC45YzAuMy0wLjEsMC41LDAsMC43LDAuMwoJCQlsMC4xLDAuMmMwLjMsMC41LDEsMC42LDEuNSwwLjJsMCwwYzAuMy0wLjIsMC43LTAuMywxLTAuMmwwLjgsMC4zYzAuNCwwLjIsMC44LDAuMSwxLjIsMGwwLjUtMC4yYzAuNC0wLjIsMC45LTAuMiwxLjMsMGwwLjUsMC4yCgkJCWMwLjQsMC4yLDAuOCwwLjIsMS4yLDBsMC4yLTAuMWMwLjMtMC4yLDAuOC0wLjIsMS4xLDAuMWwwLjIsMC4yYzAuMywwLjMsMC44LDAuMiwxLTAuMmwwLjEtMC4yYzAuMS0wLjIsMC0wLjMsMC4yLTAuMwoJCQljMC41LDAsMS4yLTAuMywxLjEtMC43bC0wLjQtMS4xIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDUyLjJjLTAuMSwwLjItMC4zLDAuOCwwLDEuMWMwLjMsMC40LDMsMS4xLDYuNCwxLjEKCQkJYzIuMiwwLDQuNi0wLjMsNi0wLjZjMC41LTAuMSwwLjktMC41LDAuOC0wLjljMC0wLjItMC4yLTAuNS0wLjQtMC43Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDUzLjNjMCwwLjUsMC42LDIuMywxLjMsMi43YzEuOCwwLjgsNS43LDAuNyw4LjEsMC41CgkJCWMxLjMtMC4xLDIuNS0wLjcsMy4yLTEuOGMwLjMtMC41LDAuNS0xLDAuNS0xLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iNTEuNiIgY3k9IjQ2LjUiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iNTMiIGN5PSI0NSIgcng9IjAuMyIgcnk9IjAuNCIvPgoJCTxlbGxpcHNlIGZpbGw9IiNDMEMwQkYiIGN4PSI1MyIgY3k9IjQ3LjIiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iNTQuMyIgY3k9IjQ2LjUiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iNTAuOSIgY3k9IjQ1IiByeD0iMC4zIiByeT0iMC40Ii8+Cgk8L2c+Cgk8Zz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIGQ9Ik0yNC4yLDUxdi03LjZjMC4xLDAuMSwwLjgsMC45LDIuOCwzLjFjMi41LTEuNyw1LjYtMC43LDYuOSwwbDIuNC0zLjF2Ny4xCgkJCWMwLDEuMi0wLjEsMi41LTAuOSwzLjRjLTEsMS4yLTIuNywyLjUtNS4zLDIuNWMtMi45LDAtNC41LTEuNS01LjMtMi45QzI0LjIsNTIuOSwyNC4yLDUyLDI0LjIsNTF6Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0yMS4yLDUwbDUuNCwxLjIiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNDMEMwQkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTIxLjIsNTQuMWw1LjQtMS4yIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0zOC44LDUwbC01LjQsMS4yIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQzBDMEJGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0zOC44LDU0LjFsLTUuNC0xLjIiLz4KCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0MwQzBCRiIgZD0iTTI5LjUsNTIuNEwyOSw1MS43Yy0wLjItMC4zLDAtMC42LDAuMy0wLjZoMS40CgkJCWMwLjMsMCwwLjUsMC40LDAuMywwLjZsLTAuNywxbDAsMGMtMC43LDEuMi0yLjYsMS4xLTMuMS0wLjNsLTAuMS0wLjJjLTAuMS0wLjIsMC0wLjQsMC4yLTAuNXMwLjQsMCwwLjUsMC4ybDAuMSwwLjIKCQkJQzI4LjMsNTIuOCwyOS4xLDUyLjksMjkuNSw1Mi40eiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0MwQzBCRiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzIuNCw1Mi4xbC0wLjEsMC4yYy0wLjQsMS0xLjgsMS4xLTIuMywwLjIiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iMjcuNiIgY3k9IjQ5LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQk8ZWxsaXBzZSBmaWxsPSIjQzBDMEJGIiBjeD0iMzIuNCIgY3k9IjQ5LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCTwvZz4KCTxnPgoJCTxwYXRoIGZpbGw9IiM2QUE5REQiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTE0LjYsNzEuMmMtMC4xLTAuMS0wLjItMC4yLTAuMy0wLjJINS43CgkJCWMtMC4xLDAtMC4yLDAuMS0wLjMsMC4yYy0wLjEsMC4xLTAuMSwwLjIsMCwwLjRjMC43LDIsMi41LDMuMyw0LjYsMy4zczMuOS0xLjMsNC42LTMuM0MxNC43LDcxLjUsMTQuNyw3MS4zLDE0LjYsNzEuMnogTTEwLDc0LjEKCQkJYy0xLjYsMC0zLTAuOS0zLjctMi4yaDcuM0MxMyw3My4yLDExLjYsNzQuMSwxMCw3NC4xeiIvPgoJCTxwYXRoIGZpbGw9IiM2QUE5REQiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTEyLjgsNjkuNWMwLjYsMCwxLjEtMC41LDEuMS0xLjEKCQkJYzAtMC42LTAuNS0xLjItMS4xLTEuMmMtMC42LDAtMS4yLDAuNS0xLjIsMS4yQzExLjYsNjksMTIuMiw2OS41LDEyLjgsNjkuNXogTTEyLjgsNjhjMC4yLDAsMC40LDAuMiwwLjQsMC40CgkJCWMwLDAuMi0wLjIsMC40LTAuNCwwLjRjLTAuMiwwLTAuNC0wLjItMC40LTAuNEMxMi40LDY4LjEsMTIuNiw2OCwxMi44LDY4eiIvPgoJCTxwYXRoIGZpbGw9IiM2QUE5REQiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTcuMiw2OS41YzAuNiwwLDEuMi0wLjUsMS4yLTEuMQoJCQljMC0wLjYtMC41LTEuMi0xLjItMS4yYy0wLjYsMC0xLjEsMC41LTEuMSwxLjJDNi4xLDY5LDYuNiw2OS41LDcuMiw2OS41eiBNNy4yLDY4YzAuMiwwLDAuNCwwLjIsMC40LDAuNGMwLDAuMi0wLjIsMC40LTAuNCwwLjQKCQkJYy0wLjIsMC0wLjQtMC4yLTAuNC0wLjRDNi44LDY4LjEsNyw2OCw3LjIsNjh6Ii8+CgkJPHBhdGggZmlsbD0iIzZBQTlERCIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2Utd2lkdGg9IjAuMSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTAsNjNjLTMuOCwwLTcsMy4xLTcsN2MwLDMuOCwzLjEsNyw3LDcKCQkJczctMy4xLDctN0MxNyw2Ni4yLDEzLjgsNjMsMTAsNjN6IE0xMCw3Ni4yYy0zLjQsMC02LjItMi44LTYuMi02LjJjMC0zLjQsMi44LTYuMiw2LjItNi4yczYuMiwyLjgsNi4yLDYuMgoJCQlDMTYuMiw3My40LDEzLjQsNzYuMiwxMCw3Ni4yeiIvPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTY0LjEsNzMuNGwyLjMsMGMwLjIsMCwwLjQsMC4yLDAuNCwwLjR2Mi4xYzAsMC4yLTAuMiwwLjQtMC40LDAuNGgtMi4zCgkJCQljLTAuMiwwLTAuNC0wLjItMC40LTAuNHYtMi4xQzYzLjcsNzMuNiw2My44LDczLjQsNjQuMSw3My40eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIGQ9Ik03My41LDczLjVoMi40YzAuMiwwLDAuNCwwLjIsMC40LDAuNHYyLjFjMCwwLjItMC4yLDAuNC0wLjQsMC40aC0yLjQKCQkJCWMtMC4yLDAtMC40LTAuMi0wLjQtMC40bDAtMi4xQzczLjEsNzMuNiw3My4zLDczLjUsNzMuNSw3My41eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIGQ9Ik02My43LDY4LjRoMTIuNnY1SDYzLjdWNjguNHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBkPSJNNjUuNSw2My42aDguOWMxLDAsMS45LDAuOCwxLjksMS45djMuMUg2My43di0zLjFDNjMuNyw2NC41LDY0LjUsNjMuNiw2NS41LDYzLjZ6Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiM2QUE5REQiIGN4PSI2Ni4yIiBjeT0iNzAuOSIgcng9IjAuOSIgcnk9IjAuOSIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iNzMuOCIgY3k9IjcwLjkiIHJ4PSIwLjkiIHJ5PSIwLjkiLz4KCQk8L2c+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBkPSJNOTYuNCw3MGMwLDMuNi0yLjksNi41LTYuNCw2LjVzLTYuNC0yLjktNi40LTYuNXMyLjktNi41LDYuNC02LjVTOTYuNCw2Ni40LDk2LjQsNzB6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTk2LjMsNjguNmMwLDAsMCwwLjEsMCwwLjFjLTAuOSwwLjEtMi45LDAuMS00LjYtMS4yYy0xLjEtMC44LTItMS43LTIuNi0yLjUKCQkJCWMtMC4zLTAuNC0wLjYtMC44LTAuNy0xLjFjLTAuMS0wLjEtMC4xLTAuMi0wLjEtMC4yYzAuNS0wLjEsMS4yLTAuMiwyLTAuMmMxLjIsMCwyLjUsMC4zLDMuNSwxLjFjMSwwLjgsMS43LDEuOCwyLjEsMi44CgkJCQlDOTYuMSw2Ny45LDk2LjIsNjguMyw5Ni4zLDY4LjZ6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTg0LDcyLjJjMCwwLDAtMC4xLDAtMC4xYzAuOS0wLjIsMi45LTAuNCw0LjcsMC42YzEuMSwwLjcsMS45LDEuNSwyLjQsMi4zCgkJCQljMC40LDAuNSwwLjYsMSwwLjcsMS4zYy0wLjQsMC4xLTEsMC4yLTEuNywwLjNjLTEsMC0yLjEtMC4xLTMuMi0wLjhzLTEuOS0xLjYtMi40LTIuNUM4NC4yLDcyLjgsODQuMSw3Mi40LDg0LDcyLjJ6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTE2LjMsNjYuOGwtMS40LDJsLTAuOC0wLjhsLTAuNi0wLjdsMCwwLjlsLTAuMSw4LjJoLTYuOAoJCQkJbC0wLjEtOC4ybDAtMC45bC0wLjYsMC43bC0wLjgsMC44bC0xLjQtMmwyLjYtMi45YzAuMS0wLjEsMC4yLTAuMSwwLjMtMC4xaDEuM2wwLjQsMC43YzAuNywxLjMsMi42LDEuMywzLjMtMC4xbDAuMy0wLjZoMS4yCgkJCQljMC4xLDAsMC4yLDAsMC4zLDAuMWwwLjMtMC4zbC0wLjMsMC4zTDExNi4zLDY2Ljh6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTExMC4xLDY3LjdoMnYwLjljMCwwLjQtMC40LDAuNy0xLDAuN2MtMC42LDAtMS0wLjMtMS0wLjdMMTEwLjEsNjcuN0wxMTAuMSw2Ny43eiIvPgoJCTwvZz4KCTwvZz4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIGQ9Ik0xMjYuOCw3NC4zYzAsMS4yLTEsMi4yLTIuMiwyLjJzLTIuMi0xLTIuMi0yLjJzMS0yLjIsMi4yLTIuMlMxMjYuOCw3My4xLDEyNi44LDc0LjN6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTEzNy42LDc0LjNjMCwxLjItMSwyLjItMi4yLDIuMmMtMS4yLDAtMi4yLTEtMi4yLTIuMnMxLTIuMiwyLjItMi4yCgkJCQlDMTM2LjYsNzIuMSwxMzcuNiw3My4xLDEzNy42LDc0LjN6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTEyNi44LDY0LjR2OS45Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTEzNy43LDY0LjR2OS45Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgZD0iTTEyNi44LDYzLjVoMTAuOHYyLjdoLTEwLjhDMTI2LjgsNjYuMiwxMjYuOCw2My41LDEyNi44LDYzLjV6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9IiM2QUE5REQiIGQ9Ik0xNzAuOCw2My4xTDE3MC44LDYzLjFjLTAuMywwLTAuNSwwLTAuOCwwYy0yLjEsMC00LDEtNS4zLDIuNWwtMC4xLDBsLTAuMS0wLjFsLTEtMS4ybC0wLjMsMy40bDMuNCwwLjMKCQkJCWwtMS4xLTEuM2wtMC4xLTAuMWwwLjEtMC4xYzEuMS0xLjQsMy0yLjMsNS0yLjFsMCwwYzMuMiwwLjMsNS41LDMuMSw1LjIsNi4zYy0wLjMsMy0zLjEsNS4zLTYuMSw1LjFjLTMuMS0wLjItNS40LTIuOS01LjMtNgoJCQkJbC0xLjMtMC4xYy0wLjIsMy44LDIuNiw3LjEsNi4zLDcuNGMzLjksMC4zLDcuMy0yLjYsNy42LTYuNUMxNzcuMiw2Ni44LDE3NC40LDYzLjUsMTcwLjgsNjMuMXoiLz4KCQkJPHBhdGggZmlsbD0iIzZBQTlERCIgZD0iTTE3MC4zLDY3LjRjMC0wLjMtMC4zLTAuNi0wLjYtMC42cy0wLjYsMC4zLTAuNiwwLjZ2My4yYzAsMC4yLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMywwLjIsMC40LDAuMgoJCQkJaDIuNGMwLjQsMCwwLjYtMC4zLDAuNi0wLjZTMTcyLjQsNzAsMTcyLDcwaC0xLjZoLTAuMnYtMC4yTDE3MC4zLDY3LjRMMTcwLjMsNjcuNHoiLz4KCQk8L2c+Cgk8L2c+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBkPSJNMTg2LjIsNjMuNGg3LjdjMS41LDAsMi43LDEuMiwyLjcsMi43djcuN2MwLDEuNS0xLjIsMi43LTIuNywyLjdoLTcuNwoJCQkJYy0xLjUsMC0yLjctMS4yLTIuNy0yLjd2LTcuN0MxODMuNCw2NC43LDE4NC43LDYzLjQsMTg2LjIsNjMuNHoiLz4KCQkJPGVsbGlwc2UgZmlsbD0iIzZBQTlERCIgY3g9IjE4NiIgY3k9IjY4LjkiIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQkJPGVsbGlwc2UgZmlsbD0iIzZBQTlERCIgY3g9IjE5NCIgY3k9IjY2LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0xODYsNzMuM2wwLjQtMC4zYzAuNC0wLjMsMS0wLjMsMS41LTAuMWwxLDAuNAoJCQkJYzAuNSwwLjIsMSwwLjIsMS41LTAuMWwwLjgtMC41YzAuNC0wLjMsMS0wLjMsMS41LTAuMWwxLjgsMC44Ii8+CgkJPC9nPgoJPC9nPgoJPHBhdGggZmlsbD0iIzZBQTlERCIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2Utd2lkdGg9IjAuMjUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTE1Niw2NC4zYy0wLjItMC4xLTAuNC0wLjEtMC41LDAKCQljMCwwLTAuMiwwLjEtMC45LDAuMmMtMC43LDAtMi40LTAuMS0zLjgtMC42Yy0wLjgtMC4zLTEuNy0wLjUtMi41LTAuNWMtMC4yLDAtMC40LDAtMC41LDBjLTEuMywwLTIuNSwwLjMtMy42LDEKCQljLTAuMiwwLjEtMC4yLDAuMi0wLjIsMC40djExLjZjMCwwLjMsMC4xLDAuNSwwLjMsMC41YzAuNiwwLDAuNS0wLjQsMC41LTAuNnYtNS43YzAuNy0wLjMsMy4yLTEuMSw1LjgtMC4xCgkJYzEuNiwwLjYsMy41LDAuNyw0LjMsMC43YzAuOCwwLDEuMy0wLjMsMS4zLTAuM2MwLjItMC4xLDAuMy0wLjIsMC4zLTAuNHYtNS43QzE1Ni4yLDY0LjYsMTU2LjEsNjQuNCwxNTYsNjQuM3ogTTE1NS42LDcwLjIKCQljLTAuMSwwLTAuNywwLjEtMSwwLjFjLTAuNywwLTIuNC0wLjEtMy44LTAuNmMtMi41LTEtNS0wLjUtNi4yLTAuMXYtNC45YzAuOS0wLjUsMi4yLTAuNywzLjItMC43YzAuMSwwLDAuMywwLDAuNCwwCgkJYzAuNywwLDEuNSwwLjIsMi4yLDAuNGMxLjYsMC42LDMuNSwwLjcsNC4zLDAuN2MwLjIsMCwwLjgsMCwxLTAuMVY3MC4yeiIvPgoJPGc+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBkPSJNNDguMSw2My41aDMuN2MyLjUsMCw0LjUsMiw0LjUsNC41YzAsMC41LTAuNCwwLjktMC45LDAuOUg0NC41Yy0wLjUsMC0wLjktMC40LTAuOS0wLjkKCQkJQzQzLjYsNjUuNSw0NS42LDYzLjUsNDguMSw2My41eiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSw2OC44Yy0wLjIsMC4xLTAuNSwxLjIsMCwxLjVjMS40LDAuOSw4LjUsMC44LDExLjMsMC42CgkJCWMwLjgtMC4xLDEuNi0wLjQsMS43LTEuMmMwLTAuMy0wLjEtMC42LTAuNi0wLjkiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTQzLjUsNzAuNkw0My4zLDcxYy0wLjIsMC41LDAuMiwxLDAuNywwLjljMC4zLTAuMSwwLjUsMC4xLDAuNywwLjMKCQkJbDAuMSwwLjJjMC4zLDAuNSwxLDAuNiwxLjUsMC4ybDAsMGMwLjMtMC4yLDAuNy0wLjMsMS0wLjJsMC44LDAuM2MwLjQsMC4yLDAuOCwwLjEsMS4yLDBsMC41LTAuMmMwLjQtMC4yLDAuOS0wLjIsMS4zLDBsMC41LDAuMgoJCQljMC40LDAuMiwwLjgsMC4yLDEuMi0wLjFsMC4yLTAuMWMwLjMtMC4yLDAuOC0wLjIsMS4xLDAuMWwwLjIsMC4yYzAuMywwLjMsMC44LDAuMiwxLTAuMmwwLjEtMC4yYzAuMS0wLjIsMC0wLjMsMC4yLTAuMwoJCQljMC41LDAsMS4yLTAuMywxLjEtMC43bC0wLjQtMS4xIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDcyLjJjLTAuMSwwLjItMC4zLDAuOCwwLDEuMWMwLjMsMC40LDMsMS4xLDYuNCwxLjEKCQkJYzIuMiwwLDQuNi0wLjMsNi0wLjZjMC41LTAuMSwwLjktMC40LDAuOC0wLjljMC0wLjItMC4yLTAuNS0wLjQtMC43Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDczLjNjMCwwLjUsMC42LDIuMywxLjMsMi43YzEuOCwwLjgsNS43LDAuNyw4LjEsMC41CgkJCWMxLjMtMC4xLDIuNS0wLjcsMy4yLTEuOGMwLjMtMC41LDAuNS0xLDAuNS0xLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iNTEuNiIgY3k9IjY2LjUiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iNTMiIGN5PSI2NSIgcng9IjAuMyIgcnk9IjAuNCIvPgoJCTxlbGxpcHNlIGZpbGw9IiM2QUE5REQiIGN4PSI1MyIgY3k9IjY3LjIiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iNTQuMyIgY3k9IjY2LjUiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iNTAuOSIgY3k9IjY1IiByeD0iMC4zIiByeT0iMC40Ii8+Cgk8L2c+Cgk8Zz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIGQ9Ik0yNC4yLDcxdi03LjZjMC4xLDAuMSwwLjgsMC45LDIuOCwzLjFjMi41LTEuNyw1LjYtMC43LDYuOSwwbDIuNC0zLjF2Ny4xCgkJCWMwLDEuMi0wLjEsMi41LTAuOSwzLjRjLTEsMS4yLTIuNywyLjUtNS4zLDIuNWMtMi45LDAtNC41LTEuNS01LjMtMi45QzI0LjIsNzIuOSwyNC4yLDcyLDI0LjIsNzF6Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNkFBOUREIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0yMS4yLDcwLjFsNS40LDEuMiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMjEuMiw3NC4xbDUuNC0xLjIiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM2QUE5REQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTM4LjgsNzAuMWwtNS40LDEuMiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzguOCw3NC4xbC01LjQtMS4yIi8+CgkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiM2QUE5REQiIGQ9Ik0yOS41LDcyLjRMMjksNzEuN2MtMC4yLTAuMywwLTAuNiwwLjMtMC42aDEuNAoJCQljMC4zLDAsMC41LDAuNCwwLjMsMC42bC0wLjcsMWwwLDBjLTAuNywxLjItMi42LDEuMS0zLjEtMC4zbC0wLjEtMC4yYy0wLjEtMC4yLDAtMC40LDAuMi0wLjVjMC4yLTAuMSwwLjQsMCwwLjUsMC4ybDAuMSwwLjIKCQkJQzI4LjMsNzIuOCwyOS4xLDcyLjksMjkuNSw3Mi40eiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzZBQTlERCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzIuNCw3Mi4xbC0wLjEsMC4yYy0wLjQsMS0xLjgsMS4xLTIuMywwLjIiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iMjcuNiIgY3k9IjY5LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCQk8ZWxsaXBzZSBmaWxsPSIjNkFBOUREIiBjeD0iMzIuNCIgY3k9IjY5LjciIHJ4PSIwLjciIHJ5PSIwLjciLz4KCTwvZz4KPC9nPgo8Zz4KCTxwYXRoIGZpbGw9IiM4Njg2ODYiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTEyLjgsOS41YzAuNiwwLDEuMS0wLjUsMS4xLTEuMgoJCWMwLTAuNi0wLjUtMS4xLTEuMS0xLjFjLTAuNiwwLTEuMiwwLjUtMS4yLDEuMVMxMi4yLDkuNSwxMi44LDkuNXogTTEyLjgsNy45YzAuMiwwLDAuNCwwLjIsMC40LDAuNGMwLDAuMi0wLjIsMC40LTAuNCwwLjQKCQljLTAuMiwwLTAuNC0wLjItMC40LTAuNEMxMi40LDguMSwxMi42LDcuOSwxMi44LDcuOXoiLz4KCTxwYXRoIGZpbGw9IiM4Njg2ODYiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLXdpZHRoPSIwLjEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTcuMiw5LjVjMC42LDAsMS4yLTAuNSwxLjItMS4yCgkJYzAtMC42LTAuNS0xLjEtMS4yLTEuMWMtMC42LDAtMS4xLDAuNS0xLjEsMS4xUzYuNiw5LjUsNy4yLDkuNXogTTcuMiw3LjljMC4yLDAsMC40LDAuMiwwLjQsMC40YzAsMC4yLTAuMiwwLjQtMC40LDAuNAoJCUM3LDguNyw2LjgsOC41LDYuOCw4LjNDNi44LDguMSw3LDcuOSw3LjIsNy45eiIvPgoJPHBhdGggZmlsbD0iIzg2ODY4NiIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2Utd2lkdGg9IjAuMSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTQuNiwxMS4yYy0wLjEtMC4xLTAuMi0wLjItMC4zLTAuMkg1LjcKCQljLTAuMSwwLTAuMiwwLjEtMC4zLDAuMmMtMC4xLDAuMS0wLjEsMC4yLDAsMC40YzAuNywyLDIuNSwzLjMsNC42LDMuM3MzLjktMS4zLDQuNi0zLjNDMTQuNywxMS40LDE0LjcsMTEuMywxNC42LDExLjJ6IE0xMCwxNC4xCgkJYy0xLjYsMC0zLTAuOS0zLjctMi4yaDcuM0MxMywxMy4yLDExLjYsMTQuMSwxMCwxNC4xeiIvPgoJPHBhdGggZmlsbD0iIzg2ODY4NiIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2Utd2lkdGg9IjAuMSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTAsM2MtMy44LDAtNywzLjEtNyw3czMuMSw3LDcsN3M3LTMuMSw3LTcKCQlTMTMuOCwzLDEwLDN6IE0xMCwxNi4yYy0zLjQsMC02LjItMi44LTYuMi02LjJTNi42LDMuOCwxMCwzLjhzNi4yLDIuOCw2LjIsNi4yUzEzLjQsMTYuMiwxMCwxNi4yeiIvPgo8L2c+CjxnIGlkPSJDYXJfMDAwMDAwMTg5MzUzOTUwODU0MTM0MTM3NTAwMDAwMDA4MjUyNzM4Nzc4NDI3NzU3MTVfIj4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik02NC4xLDEzLjRsMi4zLDBjMC4yLDAsMC40LDAuMiwwLjQsMC40djIuMWMwLDAuMi0wLjIsMC40LTAuNCwwLjRoLTIuMwoJCQkJYy0wLjIsMC0wLjQtMC4yLTAuNC0wLjR2LTIuMUM2My43LDEzLjYsNjMuOCwxMy40LDY0LjEsMTMuNHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNNzMuNSwxMy40aDIuNGMwLjIsMCwwLjQsMC4yLDAuNCwwLjR2Mi4xYzAsMC4yLTAuMiwwLjQtMC40LDAuNGgtMi40CgkJCQljLTAuMiwwLTAuNC0wLjItMC40LTAuNGwwLTIuMUM3My4xLDEzLjYsNzMuMywxMy40LDczLjUsMTMuNHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNNjMuNyw4LjRoMTIuNnY1SDYzLjdWOC40eiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik02NS41LDMuNmg4LjljMSwwLDEuOSwwLjgsMS45LDEuOXYzLjFINjMuN1Y1LjVDNjMuNyw0LjQsNjQuNSwzLjYsNjUuNSwzLjZ6Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiM4Njg2ODYiIGN4PSI2Ni4yIiBjeT0iMTAuOSIgcng9IjAuOSIgcnk9IjAuOSIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjODY4Njg2IiBjeD0iNzMuOCIgY3k9IjEwLjkiIHJ4PSIwLjkiIHJ5PSIwLjkiLz4KCQk8L2c+Cgk8L2c+CjwvZz4KPGcgaWQ9IkFjdGl2aXRpZXMiPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgZD0iTTk2LjQsMTBjMCwzLjYtMi45LDYuNS02LjQsNi41cy02LjQtMi45LTYuNC02LjVzMi45LTYuNSw2LjQtNi41Uzk2LjQsNi40LDk2LjQsMTB6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgZD0iTTk2LjMsOC42YzAsMCwwLDAuMSwwLDAuMWMtMC45LDAuMS0yLjksMC4xLTQuNi0xLjJjLTEuMS0wLjgtMi0xLjctMi42LTIuNQoJCQkJYy0wLjMtMC40LTAuNi0wLjgtMC43LTEuMWMtMC4xLTAuMS0wLjEtMC4yLTAuMS0wLjJjMC41LTAuMSwxLjItMC4yLDItMC4yYzEuMiwwLDIuNSwwLjMsMy41LDEuMWMxLDAuOCwxLjcsMS44LDIuMSwyLjgKCQkJCUM5Ni4xLDcuOSw5Ni4yLDguMyw5Ni4zLDguNnoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNODQsMTIuMWMwLDAsMC0wLjEsMC0wLjFjMC45LTAuMiwyLjktMC40LDQuNywwLjZjMS4xLDAuNiwxLjksMS41LDIuNCwyLjMKCQkJCWMwLjQsMC41LDAuNiwxLDAuNywxLjNjLTAuNCwwLjEtMSwwLjItMS43LDAuM2MtMSwwLTIuMS0wLjEtMy4yLTAuOGMtMS4xLTAuNi0xLjktMS42LTIuNC0yLjVDODQuMiwxMi44LDg0LjEsMTIuNCw4NCwxMi4xeiIvPgoJCTwvZz4KCTwvZz4KPC9nPgo8ZyBpZD0iT2JqZWN0c18wMDAwMDA2NDMxMjM3MTczOTEzMDMxNTI1MDAwMDAxMDIyNTg4OTAzMjIyODYzMjk3NV8iPgoJPGc+CgkJPGc+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTE2LjMsNi44bC0xLjQsMkwxMTQuMSw4bC0wLjYtMC43bDAsMC45bC0wLjEsOC4yaC02LjhsLTAuMS04LjIKCQkJCWwwLTAuOUwxMDUuOSw4bC0wLjgsMC44bC0xLjQtMmwyLjYtMi45YzAuMS0wLjEsMC4yLTAuMSwwLjMtMC4xaDEuM2wwLjQsMC43YzAuNywxLjMsMi42LDEuMywzLjMtMC4xbDAuMy0wLjZoMS4yCgkJCQljMC4xLDAsMC4yLDAsMC4zLDAuMWwwLjMtMC4zbC0wLjMsMC4zTDExNi4zLDYuOHoiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNMTEwLjEsNy43aDJ2MC45YzAsMC40LTAuNCwwLjctMSwwLjdjLTAuNiwwLTEtMC4zLTEtMC43TDExMC4xLDcuN0wxMTAuMSw3Ljd6Ii8+CgkJPC9nPgoJPC9nPgo8L2c+CjxnIGlkPSJTeW1ib2xzXzAwMDAwMDk2NzQ2OTA3ODY5OTI5OTIxMTgwMDAwMDA2NDg0ODEyODMwMjgyNTgyNDE2XyI+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNMTI2LjgsMTQuM2MwLDEuMi0xLDIuMi0yLjIsMi4ycy0yLjItMS0yLjItMi4yczEtMi4yLDIuMi0yLjJTMTI2LjgsMTMuMSwxMjYuOCwxNC4zeiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik0xMzcuNiwxNC4zYzAsMS4yLTEsMi4yLTIuMiwyLjJjLTEuMiwwLTIuMi0xLTIuMi0yLjJzMS0yLjIsMi4yLTIuMgoJCQkJQzEzNi42LDEyLjEsMTM3LjYsMTMuMSwxMzcuNiwxNC4zeiIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik0xMjYuOCw0LjR2OS45Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgZD0iTTEzNy43LDQuNHY5LjkiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBkPSJNMTI2LjgsMy41aDEwLjh2Mi43aC0xMC44QzEyNi44LDYuMiwxMjYuOCwzLjUsMTI2LjgsMy41eiIvPgoJCTwvZz4KCTwvZz4KPC9nPgo8ZyBpZD0iUmVjZW50cyI+Cgk8Zz4KCQk8Zz4KCQkJPHBhdGggZmlsbD0iIzg2ODY4NiIgZD0iTTE3MC44LDMuMUwxNzAuOCwzLjFjLTAuMywwLTAuNSwwLTAuOCwwYy0yLjEsMC00LDEtNS4zLDIuNWwtMC4xLDBsLTAuMS0wLjFsLTEtMS4ybC0wLjMsMy40bDMuNCwwLjMKCQkJCWwtMS4xLTEuM2wtMC4xLTAuMWwwLjEtMC4xYzEuMS0xLjQsMy0yLjMsNS0yLjFsMCwwYzMuMiwwLjMsNS41LDMuMSw1LjIsNi4zYy0wLjMsMy0zLjEsNS4zLTYuMSw1LjFjLTMuMS0wLjItNS40LTIuOS01LjMtNgoJCQkJTDE2Myw5LjVjLTAuMiwzLjgsMi42LDcuMSw2LjMsNy40YzMuOSwwLjQsNy4zLTIuNiw3LjYtNi41QzE3Ny4yLDYuOCwxNzQuNCwzLjUsMTcwLjgsMy4xeiIvPgoJCQk8cGF0aCBmaWxsPSIjODY4Njg2IiBkPSJNMTcwLjMsNy40YzAtMC4zLTAuMy0wLjYtMC42LTAuNlMxNjksNy4xLDE2OSw3LjR2My4yYzAsMC4yLDAuMSwwLjMsMC4yLDAuNGMwLjEsMC4xLDAuMywwLjIsMC40LDAuMgoJCQkJaDIuNGMwLjQsMCwwLjYtMC4zLDAuNi0wLjZzLTAuMy0wLjYtMC42LTAuNmgtMS42aC0wLjJWOS44TDE3MC4zLDcuNEwxNzAuMyw3LjR6Ii8+CgkJPC9nPgoJPC9nPgo8L2c+CjxnIGlkPSJDdXN0b21fMDAwMDAxODEwODcyMjk0MzQzMDIzMzY3ODAwMDAwMDUxNTIyNzc5NDU5NDA2NzQ0ODhfIj4KCTxnPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik0xODYuMiwzLjRoNy43YzEuNSwwLDIuNywxLjIsMi43LDIuN3Y3LjdjMCwxLjUtMS4yLDIuNy0yLjcsMi43aC03LjcKCQkJCWMtMS41LDAtMi43LTEuMi0yLjctMi43VjYuMUMxODMuNCw0LjYsMTg0LjcsMy40LDE4Ni4yLDMuNHoiLz4KCQkJPGVsbGlwc2UgZmlsbD0iIzg2ODY4NiIgY3g9IjE4NiIgY3k9IjguOSIgcng9IjAuNyIgcnk9IjAuNyIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjODY4Njg2IiBjeD0iMTk0IiBjeT0iNi43IiByeD0iMC43IiByeT0iMC43Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMTg2LDEzLjNsMC40LTAuM2MwLjQtMC4zLDEtMC4zLDEuNS0wLjFsMSwwLjQKCQkJCWMwLjUsMC4yLDEsMC4yLDEuNS0wLjFsMC44LTAuNWMwLjQtMC4zLDEtMC4zLDEuNS0wLjFsMS44LDAuOCIvPgoJCTwvZz4KCTwvZz4KPC9nPgo8cGF0aCBmaWxsPSIjODY4Njg2IiBzdHJva2U9IiM4Njg2ODYiIHN0cm9rZS13aWR0aD0iMC4yNSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNMTU2LDQuM2MtMC4yLTAuMS0wLjQtMC4xLTAuNSwwCgljMCwwLTAuMiwwLjEtMC45LDAuMWMtMC43LDAtMi40LTAuMS0zLjgtMC42Yy0wLjgtMC4zLTEuNy0wLjUtMi41LTAuNWMtMC4yLDAtMC40LDAtMC41LDBjLTEuMywwLTIuNSwwLjMtMy42LDEKCWMtMC4yLDAuMS0wLjIsMC4yLTAuMiwwLjR2MTEuNmMwLDAuMywwLjEsMC41LDAuMywwLjVjMC42LDAsMC41LTAuNCwwLjUtMC42di01LjdjMC43LTAuMywzLjItMS4xLDUuOC0wLjFjMS42LDAuNiwzLjUsMC43LDQuMywwLjcKCWMwLjgsMCwxLjMtMC4zLDEuMy0wLjNjMC4yLTAuMSwwLjMtMC4yLDAuMy0wLjRWNC43QzE1Ni4yLDQuNSwxNTYuMSw0LjQsMTU2LDQuM3ogTTE1NS42LDEwLjJjLTAuMSwwLTAuNywwLjEtMSwwLjEKCWMtMC43LDAtMi40LTAuMS0zLjgtMC42Yy0yLjUtMS01LTAuNS02LjItMC4xVjQuN2MwLjktMC41LDIuMi0wLjcsMy4yLTAuN2MwLjEsMCwwLjMsMCwwLjQsMGMwLjcsMCwxLjUsMC4yLDIuMiwwLjQKCWMxLjYsMC42LDMuNSwwLjcsNC4zLDAuN2MwLjIsMCwwLjgsMCwxLTAuMVYxMC4yeiIvPgo8ZyBpZD0iRm9vZCI+Cgk8ZyBpZD0iTGF5ZXJfMTIiPgoJCTxnPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIGQ9Ik00OC4xLDMuNWgzLjdjMi41LDAsNC41LDIsNC41LDQuNWMwLDAuNS0wLjQsMC45LTAuOSwwLjlINDQuNWMtMC41LDAtMC45LTAuNC0wLjktMC45CgkJCQlDNDMuNiw1LjUsNDUuNiwzLjUsNDguMSwzLjV6Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSw4LjdjLTAuMiwwLjEtMC41LDEuMiwwLDEuNWMxLjQsMC45LDguNSwwLjgsMTEuMywwLjYKCQkJCWMwLjgtMC4xLDEuNi0wLjQsMS43LTEuMmMwLTAuMy0wLjEtMC42LTAuNi0wLjkiLz4KCQkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik00My41LDEwLjZMNDMuMywxMWMtMC4yLDAuNSwwLjIsMSwwLjcsMC45CgkJCQljMC4zLTAuMSwwLjUsMC4xLDAuNywwLjNsMC4xLDAuMmMwLjMsMC41LDEsMC42LDEuNSwwLjJsMCwwYzAuMy0wLjIsMC43LTAuMywxLTAuMmwwLjgsMC4zYzAuNCwwLjEsMC44LDAuMSwxLjIsMGwwLjUtMC4yCgkJCQljMC40LTAuMiwwLjktMC4yLDEuMywwbDAuNSwwLjJjMC40LDAuMiwwLjgsMC4xLDEuMi0wLjFsMC4yLTAuMWMwLjMtMC4yLDAuOC0wLjEsMS4xLDAuMWwwLjIsMC4yYzAuMywwLjMsMC44LDAuMiwxLTAuMmwwLjEtMC4yCgkJCQljMC4xLTAuMiwwLTAuMywwLjItMC40YzAuNSwwLDEuMi0wLjMsMS4xLTAuN2wtMC40LTEuMSIvPgoJCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTQzLjUsMTIuMWMtMC4xLDAuMi0wLjMsMC44LDAsMS4xYzAuMywwLjQsMywxLjEsNi40LDEuMQoJCQkJYzIuMiwwLDQuNi0wLjMsNi0wLjZjMC41LTAuMSwwLjktMC40LDAuOC0wLjljMC0wLjItMC4yLTAuNS0wLjQtMC43Ii8+CgkJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNNDMuNSwxMy4zYzAsMC41LDAuNiwyLjQsMS4zLDIuNmMxLjgsMC44LDUuNywwLjcsOC4xLDAuNQoJCQkJYzEuMy0wLjEsMi41LTAuNywzLjItMS44YzAuMy0wLjUsMC41LTEsMC41LTEuNCIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjODY4Njg2IiBjeD0iNTEuNiIgY3k9IjYuNSIgcng9IjAuMyIgcnk9IjAuNCIvPgoJCQk8ZWxsaXBzZSBmaWxsPSIjODY4Njg2IiBjeD0iNTMiIGN5PSI0LjkiIHJ4PSIwLjMiIHJ5PSIwLjQiLz4KCQkJPGVsbGlwc2UgZmlsbD0iIzg2ODY4NiIgY3g9IjUzIiBjeT0iNy4yIiByeD0iMC4zIiByeT0iMC40Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiM4Njg2ODYiIGN4PSI1NC4zIiBjeT0iNi41IiByeD0iMC4zIiByeT0iMC40Ii8+CgkJCTxlbGxpcHNlIGZpbGw9IiM4Njg2ODYiIGN4PSI1MC45IiBjeT0iNC45IiByeD0iMC4zIiByeT0iMC40Ii8+CgkJPC9nPgoJPC9nPgo8L2c+CjxnIGlkPSJBbmltYWxzIj4KCTxnPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgZD0iTTI0LjIsMTFWMy41YzAuMSwwLjEsMC44LDAuOSwyLjgsMy4xYzIuNS0xLjcsNS42LTAuNyw2LjksMGwyLjQtMy4xdjcuMQoJCQljMCwxLjItMC4xLDIuNS0wLjksMy40Yy0xLDEuMi0yLjcsMi41LTUuMywyLjVjLTIuOSwwLTQuNS0xLjUtNS4zLTIuOUMyNC4yLDEyLjksMjQuMiwxMS45LDI0LjIsMTF6Ii8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0yMS4yLDEwbDUuNCwxLjIiLz4KCQk8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiM4Njg2ODYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTTIxLjIsMTQuMWw1LjQtMS4yIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0zOC44LDEwbC01LjQsMS4yIi8+CgkJPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSIjODY4Njg2IiBzdHJva2UtbGluZWNhcD0icm91bmQiIGQ9Ik0zOC44LDE0LjFsLTUuNC0xLjIiLz4KCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzg2ODY4NiIgZD0iTTI5LjUsMTIuNEwyOSwxMS43Yy0wLjItMC4zLDAtMC42LDAuMy0wLjZoMS40CgkJCWMwLjMsMCwwLjUsMC40LDAuMywwLjZsLTAuNywxbDAsMGMtMC43LDEuMi0yLjYsMS4xLTMuMS0wLjNsLTAuMS0wLjJjLTAuMS0wLjIsMC0wLjQsMC4yLTAuNXMwLjQsMCwwLjUsMC4ybDAuMSwwLjIKCQkJQzI4LjMsMTIuNywyOS4xLDEyLjksMjkuNSwxMi40eiIvPgoJCTxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzg2ODY4NiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBkPSJNMzIuNCwxMi4xbC0wLjEsMC4yYy0wLjQsMS0xLjgsMS4xLTIuMywwLjIiLz4KCQk8ZWxsaXBzZSBmaWxsPSIjODY4Njg2IiBjeD0iMjcuNiIgY3k9IjkuNyIgcng9IjAuNyIgcnk9IjAuNyIvPgoJCTxlbGxpcHNlIGZpbGw9IiM4Njg2ODYiIGN4PSIzMi40IiBjeT0iOS43IiByeD0iMC43IiByeT0iMC43Ii8+Cgk8L2c+CjwvZz4KPC9zdmc+)",":focus:before":{content:"",position:"absolute",top:"-2px",left:"-2px",right:"-2px",bottom:"-2px",border:"2px solid var(--epr-category-icon-active-color)",borderRadius:"50%"},"&.epr-icn-suggested":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -8)"},"&.epr-icn-custom":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -9)"},"&.epr-icn-activities":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -4)"},"&.epr-icn-animals_nature":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -1)"},"&.epr-icn-flags":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -7)"},"&.epr-icn-food_drink":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -2)"},"&.epr-icn-objects":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -5)"},"&.epr-icn-smileys_people":{backgroundPositionX:"0px"},"&.epr-icn-symbols":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -6)"},"&.epr-icn-travel_places":{backgroundPositionX:"calc(var(--epr-category-navigation-button-size) * -3)"}}},eF("catBtn",ZV),{".epr-dark-theme":Wj({},$V),".epr-auto-theme":Wj({},$V)}));function tz(){var e=(0,a.useState)(null),t=e[0],n=e[1],r=function(){var e=LU(),t=kU();return function(n){var r;if(e.current){var i=null==(r=e.current)?void 0:r.querySelector('[data-name="'+n+'"]');if(i){var a=i.offsetTop||0;FU(t.current,a)}}}}();!function(e){var t=LU();(0,a.useEffect)((function(){var n=new Map,r=t.current,i=new IntersectionObserver((function(t){if(r){for(var i,a=qj(t);!(i=a()).done;){var o=i.value,s=KV(o.target);n.set(s,o.intersectionRatio)}var c=Array.from(n),u=c[c.length-1];if(1==u[1])return e(u[0]);for(var l=0,d=c;l<d.length;l++){var f=d[l],h=f[0];if(f[1]){e(h);break}}}}),{threshold:[0,1]});null==r||r.querySelectorAll(Kj(Lj.category)).forEach((function(e){i.observe(e)}))}),[t,e])}(n);var i=wU(),o=tU(),s=jU(),c=XV();return(0,a.createElement)("div",{className:Fj(nz.nav),role:"tablist","aria-label":"Category navigation",id:"epr-category-nav-id",ref:s},o.map((function(e){var o=pF(e),s=o===t;if(function(e){return e.category===oF.CUSTOM}(e)&&c)return null;var u=!i&&!s;return(0,a.createElement)(QV,{key:o,category:o,isActiveCategory:s,allowNavigation:u,categoryConfig:e,onClick:function(){n(o),r(o)}})})))}var nz=Xj.create({nav:{".":"epr-category-nav",display:"flex",flexDirection:"row",justifyContent:"space-around",padding:"var(--epr-header-padding)"},".epr-search-active":{nav:{opacity:"0.3",cursor:"default",pointerEvents:"none"}},".epr-main:has(input:not(:placeholder-shown))":{nav:{opacity:"0.3",cursor:"default",pointerEvents:"none"}}}),rz="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI2LjMuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjgwcHgiIHZpZXdCb3g9IjAgMCAyMCA4MCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMjAgODAiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8cGF0aCBmaWxsPSIjODY4Njg2IiBkPSJNNi45OCwxMy41OWMwLjEsMC4xLDAuMjQsMC4xNSwwLjM3LDAuMTVzMC4yNy0wLjA1LDAuMzctMC4xNWwyLjQyLTIuNDJsMi40MywyLjQzCgljMC4xLDAuMSwwLjI0LDAuMTUsMC4zNywwLjE1YzAuMTQsMCwwLjI3LTAuMDUsMC4zNy0wLjE1YzAuMjEtMC4yMSwwLjIxLTAuNTQsMC0wLjc1bC0yLjQzLTIuNDNMMTMuMzIsOAoJYzAuMjEtMC4yMSwwLjIxLTAuNTQsMC0wLjc1Yy0wLjIxLTAuMjEtMC41NC0wLjIxLTAuNzUsMGwtMi40MiwyLjQyTDcuNzQsNy4yN2MtMC4yMS0wLjIxLTAuNTQtMC4yMS0wLjc1LDAKCWMtMC4yMSwwLjIxLTAuMjEsMC41NCwwLDAuNzVsMi40MSwyLjQxbC0yLjQyLDIuNDJDNi43NywxMy4wNSw2Ljc3LDEzLjM5LDYuOTgsMTMuNTlMNi45OCwxMy41OXoiLz4KPHBhdGggZmlsbD0iIzg2ODY4NiIgZD0iTTEwLjE1LDE4LjQzYzQuNDEsMCw4LTMuNTksOC04YzAtNC40MS0zLjU5LTgtOC04Yy00LjQxLDAtOCwzLjU5LTgsOEMyLjE1LDE0Ljg0LDUuNzQsMTguNDMsMTAuMTUsMTguNDN6CgkgTTEwLjE1LDMuNDljMy44MywwLDYuOTQsMy4xMSw2Ljk0LDYuOTRjMCwzLjgzLTMuMTEsNi45NC02Ljk0LDYuOTRjLTMuODMsMC02Ljk0LTMuMTEtNi45NC02Ljk0QzMuMjEsNi42LDYuMzMsMy40OSwxMC4xNSwzLjQ5CglMMTAuMTUsMy40OXoiLz4KPHBhdGggZmlsbD0iIzMzNzFCNyIgZD0iTTYuOTgsMzMuNTljMC4xLDAuMSwwLjI0LDAuMTUsMC4zNywwLjE1czAuMjctMC4wNSwwLjM3LTAuMTVsMi40Mi0yLjQybDIuNDMsMi40MwoJYzAuMSwwLjEsMC4yNCwwLjE1LDAuMzcsMC4xNWMwLjE0LDAsMC4yNy0wLjA1LDAuMzctMC4xNWMwLjIxLTAuMjEsMC4yMS0wLjU0LDAtMC43NWwtMi40My0yLjQzTDEzLjMyLDI4CgljMC4yMS0wLjIxLDAuMjEtMC41NCwwLTAuNzVjLTAuMjEtMC4yMS0wLjU0LTAuMjEtMC43NSwwbC0yLjQyLDIuNDJsLTIuNDEtMi40MWMtMC4yMS0wLjIxLTAuNTQtMC4yMS0wLjc1LDAKCWMtMC4yMSwwLjIxLTAuMjEsMC41NCwwLDAuNzVsMi40MSwyLjQxbC0yLjQyLDIuNDJDNi43NywzMy4wNSw2Ljc3LDMzLjM5LDYuOTgsMzMuNTlMNi45OCwzMy41OXoiLz4KPHBhdGggZmlsbD0iIzMzNzFCNyIgZD0iTTEwLjE1LDM4LjQzYzQuNDEsMCw4LTMuNTksOC04YzAtNC40MS0zLjU5LTgtOC04Yy00LjQxLDAtOCwzLjU5LTgsOEMyLjE1LDM0Ljg0LDUuNzQsMzguNDMsMTAuMTUsMzguNDN6CgkgTTEwLjE1LDIzLjQ5YzMuODMsMCw2Ljk0LDMuMTEsNi45NCw2Ljk0YzAsMy44My0zLjExLDYuOTQtNi45NCw2Ljk0Yy0zLjgzLDAtNi45NC0zLjExLTYuOTQtNi45NAoJQzMuMjEsMjYuNiw2LjMzLDIzLjQ5LDEwLjE1LDIzLjQ5TDEwLjE1LDIzLjQ5eiIvPgo8cGF0aCBmaWxsPSIjQzBDMEJGIiBkPSJNNi45OCw1My41OWMwLjEsMC4xLDAuMjQsMC4xNSwwLjM3LDAuMTVzMC4yNy0wLjA1LDAuMzctMC4xNWwyLjQyLTIuNDJsMi40MywyLjQzCgljMC4xLDAuMSwwLjI0LDAuMTUsMC4zNywwLjE1YzAuMTQsMCwwLjI3LTAuMDUsMC4zNy0wLjE1YzAuMjEtMC4yMSwwLjIxLTAuNTQsMC0wLjc1bC0yLjQzLTIuNDNMMTMuMzIsNDgKCWMwLjIxLTAuMjEsMC4yMS0wLjU0LDAtMC43NWMtMC4yMS0wLjIxLTAuNTQtMC4yMS0wLjc1LDBsLTIuNDIsMi40MmwtMi40MS0yLjQxYy0wLjIxLTAuMjEtMC41NC0wLjIxLTAuNzUsMAoJYy0wLjIxLDAuMjEtMC4yMSwwLjU0LDAsMC43NWwyLjQxLDIuNDFsLTIuNDIsMi40MkM2Ljc3LDUzLjA1LDYuNzcsNTMuMzksNi45OCw1My41OUw2Ljk4LDUzLjU5eiIvPgo8cGF0aCBmaWxsPSIjQzBDMEJGIiBkPSJNMTAuMTUsNTguNDNjNC40MSwwLDgtMy41OSw4LThjMC00LjQxLTMuNTktOC04LThjLTQuNDEsMC04LDMuNTktOCw4QzIuMTUsNTQuODQsNS43NCw1OC40MywxMC4xNSw1OC40M3oKCSBNMTAuMTUsNDMuNDljMy44MywwLDYuOTQsMy4xMSw2Ljk0LDYuOTRjMCwzLjgzLTMuMTEsNi45NC02Ljk0LDYuOTRjLTMuODMsMC02Ljk0LTMuMTEtNi45NC02Ljk0CglDMy4yMSw0Ni42LDYuMzMsNDMuNDksMTAuMTUsNDMuNDlMMTAuMTUsNDMuNDl6Ii8+CjxwYXRoIGZpbGw9IiM2QUE5REQiIGQ9Ik02Ljk4LDczLjU5YzAuMSwwLjEsMC4yNCwwLjE1LDAuMzcsMC4xNXMwLjI3LTAuMDUsMC4zNy0wLjE1bDIuNDItMi40MmwyLjQzLDIuNDMKCWMwLjEsMC4xLDAuMjQsMC4xNSwwLjM3LDAuMTVjMC4xNCwwLDAuMjctMC4wNSwwLjM3LTAuMTVjMC4yMS0wLjIxLDAuMjEtMC41NCwwLTAuNzVsLTIuNDMtMi40M0wxMy4zMiw2OAoJYzAuMjEtMC4yMSwwLjIxLTAuNTQsMC0wLjc1Yy0wLjIxLTAuMjEtMC41NC0wLjIxLTAuNzUsMGwtMi40MiwyLjQybC0yLjQxLTIuNDFjLTAuMjEtMC4yMS0wLjU0LTAuMjEtMC43NSwwCgljLTAuMjEsMC4yMS0wLjIxLDAuNTQsMCwwLjc1bDIuNDEsMi40MWwtMi40MiwyLjQyQzYuNzcsNzMuMDUsNi43Nyw3My4zOSw2Ljk4LDczLjU5TDYuOTgsNzMuNTl6Ii8+CjxwYXRoIGZpbGw9IiM2QUE5REQiIGQ9Ik0xMC4xNSw3OC40M2M0LjQxLDAsOC0zLjU5LDgtOGMwLTQuNDEtMy41OS04LTgtOGMtNC40MSwwLTgsMy41OS04LDhDMi4xNSw3NC44NCw1Ljc0LDc4LjQzLDEwLjE1LDc4LjQzegoJIE0xMC4xNSw2My40OWMzLjgzLDAsNi45NCwzLjExLDYuOTQsNi45NGMwLDMuODMtMy4xMSw2Ljk0LTYuOTQsNi45NGMtMy44MywwLTYuOTQtMy4xMS02Ljk0LTYuOTQKCUMzLjIxLDY2LjYsNi4zMyw2My40OSwxMC4xNSw2My40OUwxMC4xNSw2My40OXoiLz4KPC9zdmc+";function iz(){var e=JU();return(0,a.createElement)(nV,{className:Fj(oz.btnClearSearch,$j.visibleOnSearchOnly),onClick:e,"aria-label":"Clear",title:"Clear"},(0,a.createElement)("div",{className:Fj(oz.icnClearnSearch)}))}var az={":hover":{"> .epr-icn-clear-search":{backgroundPositionY:"-60px"}}},oz=Xj.create(Wj({btnClearSearch:{".":"epr-btn-clear-search",position:"absolute",right:"var(--epr-search-bar-inner-padding)",height:"30px",width:"30px",display:"flex",alignItems:"center",justifyContent:"center",top:"50%",transform:"translateY(-50%)",padding:"0",borderRadius:"50%",":hover":{background:"var(--epr-hover-bg-color)"},":focus":{background:"var(--epr-hover-bg-color)"}},icnClearnSearch:{".":"epr-icn-clear-search",backgroundColor:"transparent",backgroundRepeat:"no-repeat",backgroundSize:"20px",height:"20px",width:"20px",backgroundImage:"url("+rz+")",":hover":{backgroundPositionY:"-20px"},":focus":{backgroundPositionY:"-20px"}}},eF("icnClearnSearch",{backgroundPositionY:"-40px"}),eF("btnClearSearch",az))),sz=Kj(Lj.emojiPicker)+" "+Kj(Lj.emojiList),cz=["button",Kj(Lj.emoji)].join(""),uz=Kj(Lj.category);function lz(e){var t=e.value;if(!t)return null;var n=function(e){return[cz,'[data-full-name*="',tB(e),'"]'].join("")}(t);return(0,a.createElement)("style",null,"\n    "+sz+" "+cz+" {\n      display: none;\n    }\n\n\n    "+sz+" "+n+" {\n      display: flex;\n    }\n\n    "+sz+" "+uz+":not(:has("+n+")) {\n      display: none;\n    }\n  ")}function dz(){return(0,a.createElement)("div",{className:Fj(fz.icnSearch)})}var fz=Xj.create(Wj({icnSearch:{".":"epr-icn-search",content:"",position:"absolute",top:"50%",left:"var(--epr-search-bar-inner-padding)",transform:"translateY(-50%)",width:"20px",height:"20px",backgroundRepeat:"no-repeat",backgroundPosition:"0 0",backgroundSize:"20px",backgroundImage:"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI2LjMuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjQwcHgiIHZpZXdCb3g9IjAgMCAyMCA0MCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMjAgNDAiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzg2ODY4NiIgZD0iTTEyLDguODFjMCwyLjA4LTEuNjgsMy43Ni0zLjc2LDMuNzZjLTIuMDgsMC0zLjc2LTEuNjgtMy43Ni0zLjc2CgljMC0yLjA4LDEuNjgtMy43NiwzLjc2LTMuNzZDMTAuMzIsNS4wNSwxMiw2LjczLDEyLDguODF6IE0xMS4yMywxMi43MmMtMC44MywwLjY0LTEuODcsMS4wMS0yLjk5LDEuMDFjLTIuNzIsMC00LjkyLTIuMi00LjkyLTQuOTIKCWMwLTIuNzIsMi4yLTQuOTIsNC45Mi00LjkyYzIuNzIsMCw0LjkyLDIuMiw0LjkyLDQuOTJjMCwxLjEzLTAuMzgsMi4xNi0xLjAxLDIuOTlsMy45NCwzLjkzYzAuMjUsMC4yNSwwLjI1LDAuNjYsMCwwLjkyCgljLTAuMjUsMC4yNS0wLjY2LDAuMjUtMC45MiwwTDExLjIzLDEyLjcyeiIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0MwQzBCRiIgZD0iTTEyLDI4LjgxYzAsMi4wOC0xLjY4LDMuNzYtMy43NiwzLjc2Yy0yLjA4LDAtMy43Ni0xLjY4LTMuNzYtMy43NgoJYzAtMi4wOCwxLjY4LTMuNzYsMy43Ni0zLjc2QzEwLjMyLDI1LjA1LDEyLDI2LjczLDEyLDI4LjgxeiBNMTEuMjMsMzIuNzJjLTAuODMsMC42NC0xLjg3LDEuMDEtMi45OSwxLjAxCgljLTIuNzIsMC00LjkyLTIuMi00LjkyLTQuOTJjMC0yLjcyLDIuMi00LjkyLDQuOTItNC45MmMyLjcyLDAsNC45MiwyLjIsNC45Miw0LjkyYzAsMS4xMy0wLjM4LDIuMTYtMS4wMSwyLjk5bDMuOTQsMy45MwoJYzAuMjUsMC4yNSwwLjI1LDAuNjYsMCwwLjkyYy0wLjI1LDAuMjUtMC42NiwwLjI1LTAuOTIsMEwxMS4yMywzMi43MnoiLz4KPC9zdmc+)"}},eF("icnSearch",{backgroundPositionY:"-20px"})));function hz(){var e=rU(),t=rB();return e?null:(0,a.createElement)(LV,{className:Fj(mz.overlay)},(0,a.createElement)(pz,null),t?(0,a.createElement)(WV,null):null)}function pz(){var e=(0,a.useState)(0),t=e[0],n=e[1],r=HU(),i=OU(),o=function(){var e,t=qF();return null!=(e=[t.searchPlaceHolder,t.searchPlaceholder].find((function(e){return e!==jF})))?e:jF}(),s=qF().autoFocusSearch,c=ZU(),u=c.statusSearchResults,l=c.searchTerm,d=c.onChange,f=null==i?void 0:i.current,h=null==f?void 0:f.value;return(0,a.createElement)(FV,{className:Fj(mz.searchContainer)},(0,a.createElement)(lz,{value:h}),(0,a.createElement)("input",{autoFocus:s,"aria-label":"Type to search for an emoji",onFocus:r,className:Fj(mz.search),type:"text","aria-controls":"epr-search-id",placeholder:o,onChange:function(e){n(t+1),setTimeout((function(){var t,n;d(null!=(t=null==e||null==(n=e.target)?void 0:n.value)?t:h)}))},ref:i}),l?(0,a.createElement)("div",{role:"status",className:Fj("epr-status-search-results",mz.visuallyHidden),"aria-live":"polite",id:"epr-search-id","aria-atomic":"true"},u):null,(0,a.createElement)(dz,null),(0,a.createElement)(iz,null))}var mz=Xj.create(Wj({overlay:{padding:"var(--epr-header-padding)",zIndex:"var(--epr-header-overlay-z-index)"},searchContainer:{".":"epr-search-container",flex:"1",display:"block",minWidth:"0"},visuallyHidden:{clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",width:"1px"},search:{outline:"none",transition:"all 0.2s ease-in-out",color:"var(--epr-search-input-text-color)",borderRadius:"var(--epr-search-input-border-radius)",padding:"var(--epr-search-input-padding)",height:"var(--epr-search-input-height)",backgroundColor:"var(--epr-search-input-bg-color)",border:"1px solid var(--epr-search-input-bg-color)",width:"100%",":focus":{backgroundColor:"var(--epr-search-input-bg-color-active)",border:"1px solid var(--epr-search-border-color)"},"::placeholder":{color:"var(--epr-search-input-placeholder-color)"}},btnClearSearch:{".":"epr-btn-clear-search",position:"absolute",right:"var(--epr-search-bar-inner-padding)",height:"30px",width:"30px",display:"flex",alignItems:"center",justifyContent:"center",top:"50%",transform:"translateY(-50%)",padding:"0",borderRadius:"50%",":hover":{background:"var(--epr-hover-bg-color)"},":focus":{background:"var(--epr-hover-bg-color)"}},icnClearnSearch:{".":"epr-icn-clear-search",backgroundColor:"transparent",backgroundRepeat:"no-repeat",backgroundSize:"20px",height:"20px",width:"20px",backgroundImage:"url("+rz+")",":hover":{backgroundPositionY:"-20px"},":focus":{backgroundPositionY:"-20px"}}},eF("icnClearnSearch",{backgroundPositionY:"-40px"}),eF("btnClearSearch",{":hover > .epr-icn-clear-search":{backgroundPositionY:"-60px"}})));function gz(){return(0,a.createElement)(FV,{className:Fj("epr-header",$j.hiddenOnReactions)},(0,a.createElement)(hz,null),(0,a.createElement)(tz,null))}function vz(e){return(0,a.createElement)(RU,null,(0,a.createElement)(Zj,null),(0,a.createElement)(YF,Object.assign({},e),(0,a.createElement)(yz,null)))}function yz(){var e=pU()[0],t=ZF(),n=(0,a.useState)(!e),r=n[0],i=n[1],o=qF().open;return(0,a.useEffect)((function(){e&&!t||r||i(!0)}),[r,t,e]),o?(0,a.createElement)(pB,null,(0,a.createElement)(gV,null),(0,a.createElement)(bz,{renderAll:r})):null}function bz(e){return e.renderAll?(0,a.createElement)(a.Fragment,null,(0,a.createElement)(gz,null),(0,a.createElement)(NV,null),(0,a.createElement)(HV,null)):null}var _z=(0,a.memo)(vz,tF),wz=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this).state={hasError:!1},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,Gj(t,n),r.getDerivedStateFromError=function(){return{hasError:!0}};var i=r.prototype;return i.componentDidCatch=function(e,t){console.error("Emoji Picker React failed to render:",e,t)},i.render=function(){return this.state.hasError?null:this.props.children},r}(a.Component);const Ez=function(e){var t=function(e){var t=a.useRef({onEmojiClick:e.onEmojiClick||JF,onReactionClick:e.onReactionClick||e.onEmojiClick,onSkinToneChange:e.onSkinToneChange||JF});return a.useEffect((function(){t.current.onEmojiClick=e.onEmojiClick||JF,t.current.onReactionClick=e.onReactionClick||e.onEmojiClick}),[e.onEmojiClick,e.onReactionClick]),a.useEffect((function(){t.current.onSkinToneChange=e.onSkinToneChange||JF}),[e.onSkinToneChange]),t}({onEmojiClick:e.onEmojiClick,onReactionClick:e.onReactionClick,onSkinToneChange:e.onSkinToneChange});return(0,a.createElement)(wz,null,(0,a.createElement)(XF.Provider,{value:t},(0,a.createElement)(_z,Object.assign({},e))))},Sz=e=>{let{chatFooter:t,room:n,isReplying:r,friendId:i,setIsTyping:o,chatNewAttachment:s,messageActionButtonContainer:c,setIsReplying:u,userId:l,messageInput:d,replyData:f,messages:h,setReplyData:p,isPreview:m,setIsPreview:g,msgListRef:v}=e;const y=kn(),[b,_]=(0,a.useState)(!0),[w,E]=(0,a.useState)(""),[S,C]=(0,a.useState)(!1),[x,T]=(0,a.useState)(!1),[R,I]=(0,a.useState)(!1),[N,A]=(0,a.useState)("\ud83d\udc4d"),[k,D]=(0,a.useState)(!1),M=(0,a.useRef)(null),L=(0,a.useRef)(null),O=En((e=>e.setting)),{profile:P}=Xe();(0,a.useEffect)((()=>{"ai-chat"===P&&D(!0)}),[P]),(0,a.useEffect)((()=>{A(O.actionEmoji||"\ud83d\udc4d")}),[O]);const j=e=>{if(null!=(null===v||void 0===v?void 0:v.current)||void 0!=(null===v||void 0===v?void 0:v.current)){let e=setInterval((()=>{let e=document.querySelector("#chatMessageList .chat-message-container:last-child");null===e||void 0===e||e.scrollIntoView({behavior:"smooth"})}),500);null===v||void 0===v||v.current.addEventListener("scroll",(t=>{t.target.scrollHeight-t.target.scrollTop-t.target.clientHeight<=5&&clearInterval(e)}))}},F=(0,a.useCallback)((e=>{if(e.preventDefault(),!(Pn()(e.target).hasClass("button-disabled")||!1)){if(n)if(r){let e={room:n,senderId:l,receiverId:i,message:w,attachment:S,parent:f.messageId,isAi:k};Jo.emit("sendMessage",e),o(!1),j()}else{let e={room:n,senderId:l,receiverId:i,message:w,attachment:S,parent:!1,isAi:k};Jo.emit("sendMessage",e),o(!1),j()}E(""),u(!1),g(!1),C(""),p({messageId:null,body:null}),g(!1)}}),[h,w,S]);const U=new KeyboardEvent("keydown",{key:"Enter",keyCode:13,code:"Enter",which:13,bubbles:!0});let B=(0,a.useCallback)((async e=>{let t=new MouseEvent("click",{bubbles:!0,cancelable:!1}),n=document.createElement("input");n.type="file",n.addEventListener("change",(async e=>{let t=e.target.files[0];if(t){let e=new FormData;e.append("image",t),C("https://res.cloudinary.com/dz88yjerw/image/upload/v1743092084/i5lcu63atrbkpcy6oqam.gif"),g(!0);let n=await pa.post("/upload",e,{headers:{"Content-Type":"multipart/form-data"}});if(200===n.status){let e=n.data.secure_url;e&&C(e)}}})),n&&n.dispatchEvent(t)}),[S,m]),V=(0,a.useCallback)((()=>{T(!0)}),[x]),z=(0,a.useCallback)((()=>{I(!0)}),[R]),W=(0,a.useCallback)((e=>{E(w+e.emoji)}),[w]),G=(0,a.useCallback)((e=>{A(e.emoji),I(!1),T(!1),X(e.emoji)}),[]),H=(0,a.useCallback)((e=>{L.current.dispatchEvent(new MouseEvent("click",{bubbles:!0}))}),[S]),Y=(0,a.useCallback)((async e=>{if(e.target.files[0]){let e=new FormData;e.append("file",e),C("https://res.cloudinary.com/dz88yjerw/image/upload/v1743092084/i5lcu63atrbkpcy6oqam.gif");let t=await pa.post("/upload/file",e,{headers:{"Content-Type":"multipart/form-data"}});if(200===t.status){let e=t.data.secure_url;e&&C(e)}}}),[Jo]),q=(0,a.useRef)(null),K=(0,a.useRef)(null);(0,a.useEffect)((()=>{let e=e=>{q.current&&!q.current.contains(e.target)&&T(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),(0,a.useEffect)((()=>{let e=e=>{K.current&&!K.current.contains(e.target)&&I(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);let X=(0,a.useCallback)((async e=>{let t=await pa.post("setting/update",{actionEmoji:e});200==t.status&&y(_j(t.data))}),[O]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{ref:t,className:"chat-footer",children:[m&&(0,kt.jsxs)("div",{className:"new-message-preview-container",children:[r&&(0,kt.jsx)("div",{className:"reply-message-preview-form",children:(0,kt.jsx)("p",{className:"text-small",children:f.body})}),S&&(0,kt.jsx)("div",{className:"attachment-preview-container",children:(0,kt.jsx)("img",{className:"attachment-preview",src:S,alt:"Message Attachment"})}),(0,kt.jsx)("span",{onClick:e=>{g(!1),u(!1)},className:"preview-close-button bg-danger",children:(0,kt.jsx)("i",{className:"fa fa-times"})})]}),(0,kt.jsxs)("div",{className:"new-message-container",children:[(0,kt.jsx)("div",{ref:s,className:"chat-new-attachment",children:(0,kt.jsxs)("div",{className:"chat-atachment-button-container",children:[(0,kt.jsxs)("div",{className:"chat-attachment-button",onClick:H.bind(void 0),children:[(0,kt.jsx)("i",{className:"fas fa-plus-circle"}),(0,kt.jsx)("input",{type:"file",name:"uploaded_file",onChange:Y.bind(void 0),ref:L,style:{display:"none"}})]}),(0,kt.jsxs)("div",{className:"chat-attachment-button",onClick:B.bind(void 0),children:[(0,kt.jsx)("i",{className:"fas fa-images"}),(0,kt.jsx)("input",{type:"file",style:{display:"none"},ref:M,onChange:(async e=>{}).bind(void 0)})]}),(0,kt.jsxs)("div",{onClick:V.bind(void 0),className:"message-action-emoji-container chat-attachment-button",children:[(0,kt.jsx)("i",{style:{color:"#F4D52F"},className:"fas fa-smile-beam"}),x&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{ref:q,className:"emoji-container",children:(0,kt.jsx)(Ez,{theme:"dark",onEmojiClick:W})})})]})]})}),(0,kt.jsxs)("div",{className:"new-message-form",children:[(0,kt.jsx)("div",{className:"new-message-input-container",children:(0,kt.jsx)("input",{ref:d,style:{width:b+"px"},onChange:e=>{E(e.target.value),O.showIsTyping&&Jo.emit("update_type",{room:n,type:e.target.value})},value:w,onKeyDown:e=>{"Enter"===e.key&&(F(e),E(""))},placeholder:"Send Message....",id:"newMessageInput",className:"new-message-input",onFocus:e=>{Jo.emit("typing",{receiverId:l,room:n,isTyping:!0,type:w})},onBlur:()=>{Jo.emit("typing",{receiverId:l,room:n,isTyping:!1,type:w})}})}),(0,kt.jsx)("div",{ref:c,className:"message-action-button-container",children:w.length>0||S?(0,kt.jsx)("div",{onClick:F,className:"message-action-button send-message ".concat("https://res.cloudinary.com/dz88yjerw/image/upload/v1743092084/i5lcu63atrbkpcy6oqam.gif"==S&&"button-disabled"),children:(0,kt.jsx)("i",{className:"fas fa-paper-plane"})}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("div",{onClick:e=>{E(N),setTimeout((()=>{d.current.dispatchEvent(U)}),200)},className:"message-action-button send-like",children:(0,kt.jsx)("span",{className:"",children:N})}),(0,kt.jsxs)("div",{onClick:z.bind(void 0),className:"message-action-emoji-container chat-attachment-button",children:[(0,kt.jsx)("i",{className:"fas fa-chevron-up"}),R&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{ref:K,className:"emoji-container",children:(0,kt.jsx)(Ez,{theme:"dark",onEmojiClick:G})})})]})]})})]})]})]})})},Cz=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsxs)(a.Fragment,{children:[(0,kt.jsxs)("div",{className:"chat-message-container message-receive skeleton-card border-0 p-1 my-2 w-75 sm-skleton px-3","data-toggle":"tooltip",children:[(0,kt.jsx)("div",{className:"chat-message-profilePic",children:(0,kt.jsx)("div",{className:"skeleton-avatar"})}),(0,kt.jsx)("div",{className:"skeleton-lines",children:(0,kt.jsx)("div",{className:"skeleton-line large mb-0"})})]}),(0,kt.jsxs)("div",{className:"chat-message-container message-sent skeleton-card border-0 p-1 my-2 w-75 sm-skleton px-3","data-toggle":"tooltip",children:[(0,kt.jsx)("div",{className:"skeleton-lines",children:(0,kt.jsx)("div",{className:"skeleton-line large mb-0 ml-auto"})}),(0,kt.jsx)("div",{className:"chat-message-profilePic",children:(0,kt.jsx)("div",{className:"skeleton-avatar"})})]})]},t)))},xz=e=>{var t,n,r,i,o;let{socket:s}=e,c=kn(),u=En((e=>e.profile)),l=En((e=>e.option.headerHeight)),f=En((e=>e.option.bodyHeight)),h=(En((e=>e.setting)),u._id),[p,m]=(0,a.useState)({}),[g,v]=(0,a.useState)(!0);const[y,b]=(0,a.useState)(!1);let _=wa();const[w,E]=(0,a.useState)(""),[S,C]=(0,a.useState)(!1),[x,T]=(0,a.useState)(!1),[R,I]=(0,a.useState)(!1),[N,A]=(0,a.useState)([]),[k,D]=(0,a.useState)(!1),[M,L]=(0,a.useState)(!1),[O,P]=(0,a.useState)(""),[j,F]=(0,a.useState)(!0),[U,B]=(0,a.useState)(!1),[V,z]=(0,a.useState)(0),[W,G]=(0,a.useState)({messageId:null,body:null}),H=(0,a.useRef)(null),Y=(0,a.useRef)(null),q=(0,a.useRef)(null),K=(0,a.useRef)(null),X=(0,a.useRef)(null),Q=(0,a.useRef)(null),J=null===(t=q.current)||void 0===t?void 0:t.offsetHeight,Z=null===(n=K.current)||void 0===n?void 0:n.offsetHeight,$=(null===(r=K.current)||void 0===r?void 0:r.offsetWidth)-(null===(i=X.current)||void 0===i?void 0:i.offsetWidth)-(null===(o=Q.current)||void 0===o?void 0:o.offsetWidth),ee=e=>{if(null!=H.current){let e=setInterval((()=>{let e=document.querySelector("#chatMessageList .chat-message-container:last-child");null===e||void 0===e||e.scrollIntoView({behavior:"smooth"})}),500);H.current.addEventListener("scroll",(t=>{let n=t.target.scrollHeight-t.target.scrollTop-t.target.clientHeight;console.log("scrl",t.target.scrollHeight,t.target.scrollTop,n),n<=5&&clearInterval(e)}))}};null!==Y.current&&(Y.current.style.width=$+"px");const te=f-l;let ne=Xe(),re=ne.profile;(0,a.useEffect)((()=>{c(Mc(ne.profile))}),[ne]);const[ie,ae]=(0,a.useState)(te-J-Z),[oe,se]=(0,a.useState)({height:"".concat(_?f-l-Z-J:ie,"px"),maxHeight:"".concat(_?ie+l:ie,"px"),overflowY:"scroll"});(0,a.useEffect)((()=>{ae(f-l-J-Z),se({height:"".concat(_?f-l-Z-J:ie,"px"),maxHeight:"".concat(_?ie+l:ie,"px"),overflowY:"scroll"})}),[x,U]),(0,a.useEffect)((()=>{const e=()=>{const e=H.current,t=e.scrollTop,n=e.scrollHeight-e.clientHeight;z(t/n*100)},t=H.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}}),[]),(0,a.useEffect)((()=>{j&&V<30&&(s.emit("loadMessages",{myId:h,friendId:re,skip:N.length}),L(!0),F(!1))}),[V]),(0,a.useEffect)((()=>(s.emit("is_active",{profileId:re,myId:h}),s.on("is_active",((e,t)=>{let n,r,i=xc()(t),a=xc()(Date.now()),o=a.diff(i,"days"),s=a.diff(i,"days");C(!0===e),0===o?(n=xc()(t),r=n.format("hh:mm A")):s>0?(n=xc()(t),r=n.format("MM/YY hh:mm A")):(n=xc()(t),r=n.format("DD/MM hh:mm A")),b(r)})),s.on("messageReacted",(e=>{let t="#chatMessageList .chat-message-container .message-id-"+e;Pn()(t).addClass("message-reacted")})),s.on("messageReactRemoved",(e=>{if(e){let t="#chatMessageList .chat-message-container .message-id-"+e;Pn()(t).removeClass("message-reacted")}})),()=>{s.off("messageReacted"),s.off("messageReactRemoved"),s.off("is_active")})),[p,ne]),(0,a.useEffect)((()=>{B(!U)}),[ie]),(0,a.useEffect)((()=>{pa.get("/profile",{params:{profileId:re}}).then((e=>{m(e.data),c(ds(!1))})).catch((e=>console.log(e)))}),[ne,re]),(0,a.useEffect)((()=>{if(p&&v(!!p.blockedUsers&&p.blockedUsers.includes(u._id)),ee(),!re||!h)return;const e=[h,re].sort().join("_");return s.emit("startChat",{user1:h,user2:re}),E(e),s.on("roomJoined",(e=>{let{room:t}=e;console.log("Joined room: ".concat(t)),localStorage.setItem("roomId",t)})),s.on("loadMessages",(e=>{let{loadedMessages:t,hasNewMessage:n}=e;F(n),L(!1),A((e=>[...t,...e]))})),s.on("previousMessages",(e=>{A(e),F(!0)})),s.on("newMessage",(e=>{let{updatedMessage:t,senderName:n,senderPP:r,chatPage:i}=e;!0===i&&(t.receiverId==h&&t.senderId==re&&(A((e=>[...e,t])),ee()),t.senderId==h&&t.receiverId==re&&(A((e=>[...e,t])),ee()))})),s.on("deleteMessage",(e=>{Pn()("#chatBox .chat-body .chat-message-list").has(".chat-message-container.message-id-".concat(e))&&Pn()("#chatBox .chat-body .chat-message-list .chat-message-container.message-id-".concat(e)).hide()})),s.on("typing",(e=>{let{receiverId:t,isTyping:n,type:r}=e;console.log("typing",t,n,r),t===u._id&&(1==n?(D(!0),P(r),ee()):D(!1))})),s.on("update_type",(e=>{let{type:t}=e;P(t)})),()=>{s.off("newMessage"),s.off("previousMessages"),s.off("deleteMessage"),s.off("update_type"),s.off("typing"),s.off("loadMessages")}}),[ne,p]),(0,a.useEffect)((()=>(N.length>0&&re&&null!==p&&void 0!==p&&p._id&&setTimeout((()=>{let e=N[N.length-1];e&&e.senderId!==h&&e.senderId===re&&(s.emit("seenMessage",e),c(Mc(re)))}),2e3),s.on("seenMessage",(e=>{Pn()("#chatMessageList .message-sent.chat-message-container .chat-message-seen-status").css("visibility","hidden"),Pn()("#chatMessageList .message-sent.chat-message-container.message-id-"+e._id+":last-child .chat-message-seen-status").css("visibility","visible")})),()=>{s.off("seenMessage")})),[ne,N,re,p,h]);let ce={chatFooter:K,room:w,friendId:re,setIsTyping:D,setIsReplying:T,isReplying:x,chatNewAttachment:X,messageActionButtonContainer:Q,userId:h,messageInput:Y,replyData:W,isPreview:R,setIsPreview:I,setReplyData:G,messages:N};return(0,kt.jsx)("div",{children:(0,kt.jsxs)("div",{id:"chatBox",style:{minHeight:"".concat(te,"px")},children:[(0,kt.jsx)("div",{ref:q,className:"chat-header",children:(0,kt.jsx)(yj,{friendProfile:p,friendProfilePic:p.profilePic,isActive:S,lastSeen:y,room:w})}),(0,kt.jsx)("div",{className:"chat-body",children:(0,kt.jsxs)("div",{className:"chat-message-list",style:oe,id:"chatMessageList",ref:H,children:[N.length>0?N.map(((e,t)=>(0,kt.jsx)(Rc,{msg:e,friendProfile:p,messages:N,isActive:S,setIsReplying:T,setReplyData:G,isPreview:R,setIsPreview:I,msgListRef:H,isMsgLoading:M},t))):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(Cz,{count:10})}),k&&(0,kt.jsxs)("div",{className:"chat-message-container message-receive message-typing",children:[(0,kt.jsx)("div",{className:"chat-message-profilePic",children:(0,kt.jsx)(Un,{profilePic:"".concat(p.profilePic),profile:p._id,active:p.isActive})}),(0,kt.jsx)("div",{className:"chat-message",children:(0,kt.jsx)("p",{className:"message-container mb-0",children:O||(0,kt.jsxs)("div",{className:"typing-indicator",children:[(0,kt.jsx)("span",{className:"typing-dots"}),(0,kt.jsx)("span",{className:"typing-dots"}),(0,kt.jsx)("span",{className:"typing-dots"})]})})})]})]})}),g?(0,kt.jsx)("div",{ref:K,className:"chat-footer",children:(0,kt.jsxs)("p",{className:"text-center text-danger fs-4 mb-0",children:[p.fullName," Blocked You"]})}):(0,kt.jsx)(Sz,d({},ce))]})})},Tz=e=>{let{profile:t}=Xe();return(0,a.useEffect)((()=>{}),[]),(0,kt.jsx)(a.Fragment,{children:t?(0,kt.jsx)(xz,{socket:Jo,cameraVideoRef:e.cameraVideoRef,children:" "}):(0,kt.jsx)("h2",{className:"text-center mt-3",children:"Select an user to start conversation"})})};function Rz(){return Rz=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Rz.apply(this,arguments)}function Iz(e,t){return Iz=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Iz(e,t)}var Nz=function(e){var t,n;function r(){var t;return(t=e.call(this)||this).state={columns:[],childRefs:[],hasDistributed:!1},t}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,Iz(t,n);var i=r.prototype;return i.componentDidUpdate=function(){this.state.hasDistributed||this.props.sequential||this.distributeChildren()},r.getDerivedStateFromProps=function(e,t){var n=e.children,i=e.columnsCount,a=i!==t.columns.length;return t&&n===t.children&&!a?null:Rz({},r.getEqualCountColumns(n,i),{children:n,hasDistributed:!1})},i.shouldComponentUpdate=function(e){return e.children!==this.state.children||e.columnsCount!==this.props.columnsCount},i.distributeChildren=function(){var e=this,t=this.props,n=t.children,r=t.columnsCount,i=Array(r).fill(0);if(this.state.childRefs.every((function(e){return e.current.getBoundingClientRect().height}))){var o=Array.from({length:r},(function(){return[]})),s=0;a.Children.forEach(n,(function(t){if(t&&a.isValidElement(t)){var n=e.state.childRefs[s].current.getBoundingClientRect().height,r=i.indexOf(Math.min.apply(Math,i));i[r]+=n,o[r].push(t),s++}})),this.setState((function(e){return Rz({},e,{columns:o,hasDistributed:!0})}))}},r.getEqualCountColumns=function(e,t){var n=Array.from({length:t},(function(){return[]})),r=0,i=[];return a.Children.forEach(e,(function(e){if(e&&a.isValidElement(e)){var o=a.createRef();i.push(o),n[r%t].push(a.createElement("div",{style:{display:"flex",justifyContent:"stretch"},key:r,ref:o},e)),r++}})),{columns:n,childRefs:i}},i.renderColumns=function(){var e=this.props,t=e.gutter,n=e.itemTag,r=e.itemStyle;return this.state.columns.map((function(e,i){return a.createElement(n,{key:i,style:Rz({display:"flex",flexDirection:"column",justifyContent:"flex-start",alignContent:"stretch",flex:1,width:0,gap:t},r)},e.map((function(e){return e})))}))},i.render=function(){var e=this.props,t=e.gutter,n=e.className,r=e.style,i=e.containerTag;return a.createElement(i,{style:Rz({display:"flex",flexDirection:"row",justifyContent:"center",alignContent:"stretch",boxSizing:"border-box",width:"100%",gap:t},r),className:n},this.renderColumns())},r}(a.Component);Nz.propTypes={},Nz.defaultProps={columnsCount:3,gutter:"0",className:null,style:{},containerTag:"div",itemTag:"div",itemStyle:{},sequential:!1};const Az=Nz;var kz="undefined"!==typeof window?a.useLayoutEffect:a.useEffect,Dz=function(){var e=function(){var e=(0,a.useState)(!1),t=e[0],n=e[1];return kz((function(){n(!0)}),[]),t}(),t=(0,a.useState)("undefined"!==typeof window?window.innerWidth:0),n=t[0],r=t[1],i=(0,a.useCallback)((function(){e&&r(window.innerWidth)}),[e]);return kz((function(){if(e)return window.addEventListener("resize",i),i(),function(){return window.removeEventListener("resize",i)}}),[e,i]),n},Mz=function(e){var t=e.columnsCountBreakPoints,n=void 0===t?{350:1,750:2,900:3}:t,r=e.gutterBreakPoints,i=void 0===r?{}:r,o=e.children,s=e.className,c=void 0===s?null:s,u=e.style,l=void 0===u?null:u,d=Dz(),f=(0,a.useCallback)((function(e,t){var n=Object.keys(e).sort((function(e,t){return e-t})),r=n.length>0?e[n[0]]:t;return n.forEach((function(t){t<d&&(r=e[t])})),r}),[d]),h=(0,a.useMemo)((function(){return f(n,1)}),[f,n]),p=(0,a.useMemo)((function(){return f(i,"10px")}),[f,i]);return a.createElement("div",{className:c,style:l},a.Children.map(o,(function(e,t){return a.cloneElement(e,{key:t,columnsCount:h,gutter:p})})))};Mz.propTypes={};const Lz=Mz,Oz=Az,Pz=e=>{let{count:t=1,style:n}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsx)("div",{className:"msg-media-item",children:(0,kt.jsx)("div",{className:"pp-skleton-container",style:{backgroundColor:"gray"},children:(0,kt.jsx)("div",{style:{padding:0,margin:0,width:"300px"},className:"skeleton-card no-border",children:(0,kt.jsx)("div",{style:{padding:0,margin:0,height:"200px"},className:"skeleton-main"})})})},t)))},jz=e=>{let[t,n]=(0,a.useState)(!1);(0,a.useEffect)((()=>{Fn(e.src,n)}),[e.src]);let r=(0,a.useCallback)((t=>{e.setIsLightbox(!0),e.setImageIndex(e.index)}),[]);return(0,kt.jsxs)(kt.Fragment,{children:[!t&&(0,kt.jsx)(Pz,{count:1}),t&&(0,kt.jsx)("div",{onClick:r.bind(void 0),className:"msg-media-item",children:(0,kt.jsx)("img",{src:e.src,className:"w-100",alt:""})})]})},Fz=(0,a.createContext)({});function Uz(e){const t=(0,a.useRef)(null);return null===t.current&&(t.current=e()),t.current}const Bz="undefined"!==typeof window,Vz=Bz?a.useLayoutEffect:a.useEffect,zz=(0,a.createContext)(null);function Wz(e){return"object"===typeof e&&null!==e}function Gz(e){return Wz(e)&&"offsetHeight"in e}const Hz=(0,a.createContext)({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Yz extends a.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,n=Gz(e)&&e.offsetWidth||0,r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft,r.right=n-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function qz(e){let{children:t,isPresent:n,anchorX:r}=e;const i=(0,a.useId)(),o=(0,a.useRef)(null),s=(0,a.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,a.useContext)(Hz);return(0,a.useInsertionEffect)((()=>{const{width:e,height:t,top:a,left:u,right:l}=s.current;if(n||!o.current||!e||!t)return;const d="left"===r?"left: ".concat(u):"right: ".concat(l);o.current.dataset.motionPopId=i;const f=document.createElement("style");return c&&(f.nonce=c),document.head.appendChild(f),f.sheet&&f.sheet.insertRule('\n          [data-motion-pop-id="'.concat(i,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat(d,"px !important;\n            top: ").concat(a,"px !important;\n          }\n        ")),()=>{document.head.contains(f)&&document.head.removeChild(f)}}),[n]),(0,kt.jsx)(Yz,{isPresent:n,childRef:o,sizeRef:s,children:a.cloneElement(t,{ref:o})})}const Kz=e=>{let{children:t,initial:n,isPresent:r,onExitComplete:i,custom:o,presenceAffectsLayout:s,mode:c,anchorX:u}=e;const l=Uz(Xz),f=(0,a.useId)();let h=!0,p=(0,a.useMemo)((()=>(h=!1,{id:f,initial:n,isPresent:r,custom:o,onExitComplete:e=>{l.set(e,!0);for(const t of l.values())if(!t)return;i&&i()},register:e=>(l.set(e,!1),()=>l.delete(e))})),[r,l,i]);return s&&h&&(p=d({},p)),(0,a.useMemo)((()=>{l.forEach(((e,t)=>l.set(t,!1)))}),[r]),a.useEffect((()=>{!r&&!l.size&&i&&i()}),[r]),"popLayout"===c&&(t=(0,kt.jsx)(qz,{isPresent:r,anchorX:u,children:t})),(0,kt.jsx)(zz.Provider,{value:p,children:t})};function Xz(){return new Map}function Qz(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=(0,a.useContext)(zz);if(null===t)return[!0,null];const{isPresent:n,onExitComplete:r,register:i}=t,o=(0,a.useId)();(0,a.useEffect)((()=>{if(e)return i(o)}),[e]);const s=(0,a.useCallback)((()=>e&&r&&r(o)),[o,r,e]);return!n&&r?[!1,s]:[!0]}const Jz=e=>e.key||"";function Zz(e){const t=[];return a.Children.forEach(e,(e=>{(0,a.isValidElement)(e)&&t.push(e)})),t}const $z=e=>{let{children:t,custom:n,initial:r=!0,onExitComplete:i,presenceAffectsLayout:o=!0,mode:s="sync",propagate:c=!1,anchorX:u="left"}=e;const[l,d]=Qz(c),f=(0,a.useMemo)((()=>Zz(t)),[t]),h=c&&!l?[]:f.map(Jz),p=(0,a.useRef)(!0),m=(0,a.useRef)(f),g=Uz((()=>new Map)),[v,y]=(0,a.useState)(f),[b,_]=(0,a.useState)(f);Vz((()=>{p.current=!1,m.current=f;for(let e=0;e<b.length;e++){const t=Jz(b[e]);h.includes(t)?g.delete(t):!0!==g.get(t)&&g.set(t,!1)}}),[b,h.length,h.join("-")]);const w=[];if(f!==v){let e=[...f];for(let t=0;t<b.length;t++){const n=b[t],r=Jz(n);h.includes(r)||(e.splice(t,0,n),w.push(n))}return"wait"===s&&w.length&&(e=w),_(Zz(e)),y(f),null}const{forceRender:E}=(0,a.useContext)(Fz);return(0,kt.jsx)(kt.Fragment,{children:b.map((e=>{const t=Jz(e),a=!(c&&!l)&&(f===b||h.includes(t));return(0,kt.jsx)(Kz,{isPresent:a,initial:!(p.current&&!r)&&void 0,custom:n,presenceAffectsLayout:o,mode:s,onExitComplete:a?void 0:()=>{if(!g.has(t))return;g.set(t,!0);let e=!0;g.forEach((t=>{t||(e=!1)})),e&&(null===E||void 0===E||E(),_(m.current),c&&(null===d||void 0===d||d()),i&&i())},anchorX:u,children:e},t)}))})};function eW(e){if("undefined"===typeof Proxy)return e;const t=new Map;return new Proxy((function(){return e(...arguments)}),{get:(n,r)=>"create"===r?e:(t.has(r)||t.set(r,e(r)),t.get(r))})}function tW(e){return null!==e&&"object"===typeof e&&"function"===typeof e.start}function nW(e){const t=[{},{}];return null===e||void 0===e||e.values.forEach(((e,n)=>{t[0][n]=e.get(),t[1][n]=e.getVelocity()})),t}function rW(e,t,n,r){if("function"===typeof t){const[i,a]=nW(r);t=t(void 0!==n?n:e.custom,i,a)}if("string"===typeof t&&(t=e.variants&&e.variants[t]),"function"===typeof t){const[i,a]=nW(r);t=t(void 0!==n?n:e.custom,i,a)}return t}function iW(e,t,n){const r=e.getProps();return rW(r,t,void 0!==n?n:r.custom,e)}function aW(e,t){var n,r;return null!==(n=null!==(r=null===e||void 0===e?void 0:e[t])&&void 0!==r?r:null===e||void 0===e?void 0:e.default)&&void 0!==n?n:e}const oW=e=>e,sW={},cW=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],uW={value:null,addProjectionMetrics:null};function lW(e,t){let n=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},a=()=>n=!0,o=cW.reduce(((e,n)=>(e[n]=function(e,t){let n=new Set,r=new Set,i=!1,a=!1;const o=new WeakSet;let s={delta:0,timestamp:0,isProcessing:!1},c=0;function u(t){o.has(t)&&(l.schedule(t),e()),c++,t(s)}const l={schedule:function(e){const t=arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&i?n:r;return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&o.add(e),t.has(e)||t.add(e),e},cancel:e=>{r.delete(e),o.delete(e)},process:e=>{s=e,i?a=!0:(i=!0,[n,r]=[r,n],n.forEach(u),t&&uW.value&&uW.value.frameloop[t].push(c),c=0,n.clear(),i=!1,a&&(a=!1,l.process(e)))}};return l}(a,t?n:void 0),e)),{}),{setup:s,read:c,resolveKeyframes:u,preUpdate:l,update:d,preRender:f,render:h,postRender:p}=o,m=()=>{const a=sW.useManualTiming?i.timestamp:performance.now();n=!1,sW.useManualTiming||(i.delta=r?1e3/60:Math.max(Math.min(a-i.timestamp,40),1)),i.timestamp=a,i.isProcessing=!0,s.process(i),c.process(i),u.process(i),l.process(i),d.process(i),f.process(i),h.process(i),p.process(i),i.isProcessing=!1,n&&t&&(r=!1,e(m))},g=cW.reduce(((t,a)=>{const s=o[a];return t[a]=function(t){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n||(n=!0,r=!0,i.isProcessing||e(m)),s.schedule(t,a,o)},t}),{});return{schedule:g,cancel:e=>{for(let t=0;t<cW.length;t++)o[cW[t]].cancel(e)},state:i,steps:o}}const{schedule:dW,cancel:fW,state:hW,steps:pW}=lW("undefined"!==typeof requestAnimationFrame?requestAnimationFrame:oW,!0),mW=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],gW=(()=>new Set(mW))(),vW=new Set(["width","height","top","left","right","bottom",...mW]);function yW(e,t){-1===e.indexOf(t)&&e.push(t)}function bW(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class _W{constructor(){this.subscriptions=[]}add(e){return yW(this.subscriptions,e),()=>bW(this.subscriptions,e)}notify(e,t,n){const r=this.subscriptions.length;if(r)if(1===r)this.subscriptions[0](e,t,n);else for(let i=0;i<r;i++){const r=this.subscriptions[i];r&&r(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function wW(e,t){return t?e*(1e3/t):0}let EW;function SW(){EW=void 0}const CW={now:()=>(void 0===EW&&CW.set(hW.isProcessing||sW.useManualTiming?hW.timestamp:performance.now()),EW),set:e=>{EW=e,queueMicrotask(SW)}},xW={current:void 0};class TW{constructor(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.canTrackVelocity=null,this.events={},this.updateAndNotify=function(e){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const r=CW.now();var i,a;if((t.updatedAt!==r&&t.setPrevFrameValue(),t.prev=t.current,t.setCurrent(e),t.current!==t.prev)&&(null===(i=t.events.change)||void 0===i||i.notify(t.current),t.dependents))for(const o of t.dependents)o.dirty();n&&(null===(a=t.events.renderRequest)||void 0===a||a.notify(t.current))},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=CW.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(e=>!isNaN(parseFloat(e)))(this.current))}setPrevFrameValue(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.current;this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new _W);const n=this.events[e].add(t);return"change"===e?()=>{n(),dW.read((()=>{this.events.change.getSize()||this.stop()}))}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e,t)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;null===(e=this.events.change)||void 0===e||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return xW.current&&xW.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=CW.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,30);return wW(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise((t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,t;null===(e=this.dependents)||void 0===e||e.clear(),null===(t=this.events.destroy)||void 0===t||t.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function RW(e,t){return new TW(e,t)}const IW=e=>Array.isArray(e),NW=["transitionEnd","transition"];function AW(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,RW(n))}function kW(e){return IW(e)?e[e.length-1]||0:e}const DW=e=>Boolean(e&&e.getVelocity);function MW(e,t){const n=e.getValue("willChange");if(function(e){return Boolean(DW(e)&&e.add)}(n))return n.add(t);if(!n&&sW.WillChange){const n=new sW.WillChange("auto");e.addValue("willChange",n),n.add(t)}}const LW=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),OW="data-"+LW("framerAppearId");function PW(e){return e.props[OW]}const jW=(e,t)=>n=>t(e(n)),FW=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(jW)},UW=(e,t,n)=>n>t?t:n<e?e:n,BW=e=>1e3*e,VW=e=>e/1e3,zW={layout:0,mainThread:0,waapi:0};const WW=e=>t=>"string"===typeof t&&t.startsWith(e),GW=WW("--"),HW=WW("var(--"),YW=e=>!!HW(e)&&qW.test(e.split("/*")[0].trim()),qW=/var\(--(?:[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*|[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:(?![\t-\r \(\)\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uD800-\uDFFF\uFEFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\((?:(?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|\((?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])*\))*\))+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)\)$/i,KW={test:e=>"number"===typeof e,parse:parseFloat,transform:e=>e},XW=d(d({},KW),{},{transform:e=>UW(0,1,e)}),QW=d(d({},KW),{},{default:1}),JW=e=>Math.round(1e5*e)/1e5,ZW=/-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)/g;const $W=/^(?:#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\))$/i,eG=(e,t)=>n=>Boolean("string"===typeof n&&$W.test(n)&&n.startsWith(e)||t&&!function(e){return null==e}(n)&&Object.prototype.hasOwnProperty.call(n,t)),tG=(e,t,n)=>r=>{if("string"!==typeof r)return r;const[i,a,o,s]=r.match(ZW);return{[e]:parseFloat(i),[t]:parseFloat(a),[n]:parseFloat(o),alpha:void 0!==s?parseFloat(s):1}},nG=d(d({},KW),{},{transform:e=>Math.round((e=>UW(0,255,e))(e))}),rG={test:eG("rgb","red"),parse:tG("red","green","blue"),transform:e=>{let{red:t,green:n,blue:r,alpha:i=1}=e;return"rgba("+nG.transform(t)+", "+nG.transform(n)+", "+nG.transform(r)+", "+JW(XW.transform(i))+")"}};const iG={test:eG("#"),parse:function(e){let t="",n="",r="",i="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),r=e.substring(3,4),i=e.substring(4,5),t+=t,n+=n,r+=r,i+=i),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}},transform:rG.transform},aG=e=>({test:t=>"string"===typeof t&&t.endsWith(e)&&1===t.split(" ").length,parse:parseFloat,transform:t=>"".concat(t).concat(e)}),oG=aG("deg"),sG=aG("%"),cG=aG("px"),uG=aG("vh"),lG=aG("vw"),dG=(()=>d(d({},sG),{},{parse:e=>sG.parse(e)/100,transform:e=>sG.transform(100*e)}))(),fG={test:eG("hsl","hue"),parse:tG("hue","saturation","lightness"),transform:e=>{let{hue:t,saturation:n,lightness:r,alpha:i=1}=e;return"hsla("+Math.round(t)+", "+sG.transform(JW(n))+", "+sG.transform(JW(r))+", "+JW(XW.transform(i))+")"}},hG={test:e=>rG.test(e)||iG.test(e)||fG.test(e),parse:e=>rG.test(e)?rG.parse(e):fG.test(e)?fG.parse(e):iG.parse(e),transform:e=>"string"===typeof e?e:e.hasOwnProperty("red")?rG.transform(e):fG.transform(e)},pG=/(?:#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\))/gi;const mG="number",gG="color",vG=/var[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\([\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*--(?:[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*|[\x2D0-9A-Z_a-z\u017F\u212A]+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*,(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:(?![\t-\r \(\)\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uD800-\uDFFF\uFEFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\((?:(?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])|\((?:(?![\(\)\uD800-\uDFFF])[^]|[\uD800-\uDBFF][\uDC00-\uDFFF])*\))*\))+[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)\)|#[0-9a-f]{3,8}|(?:rgb|h[s\u017F]l)a?\((?:-?[\.0-9]+%?[\t-\r ,\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+){2}-?[\.0-9]+%?[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(?:[,\/][\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)?(?:\b[0-9]+(?:\.[0-9]+)?|\.[0-9]+)?%?\)|-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)/gi;function yG(e){const t=e.toString(),n=[],r={color:[],number:[],var:[]},i=[];let a=0;const o=t.replace(vG,(e=>(hG.test(e)?(r.color.push(a),i.push(gG),n.push(hG.parse(e))):e.startsWith("var(")?(r.var.push(a),i.push("var"),n.push(e)):(r.number.push(a),i.push(mG),n.push(parseFloat(e))),++a,"${}"))).split("${}");return{values:n,split:o,indexes:r,types:i}}function bG(e){return yG(e).values}function _G(e){const{split:t,types:n}=yG(e),r=t.length;return e=>{let i="";for(let a=0;a<r;a++)if(i+=t[a],void 0!==e[a]){const t=n[a];i+=t===mG?JW(e[a]):t===gG?hG.transform(e[a]):e[a]}return i}}const wG=e=>"number"===typeof e?0:e;const EG={test:function(e){var t,n;return isNaN(e)&&"string"===typeof e&&((null===(t=e.match(ZW))||void 0===t?void 0:t.length)||0)+((null===(n=e.match(pG))||void 0===n?void 0:n.length)||0)>0},parse:bG,createTransformer:_G,getAnimatableNone:function(e){const t=bG(e);return _G(e)(t.map(wG))}};function SG(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function CG(e,t){return n=>n>0?t:e}const xG=(e,t,n)=>e+(t-e)*n,TG=(e,t,n)=>{const r=e*e,i=n*(t*t-r)+r;return i<0?0:Math.sqrt(i)},RG=[iG,rG,fG];function IG(e){const t=(e=>RG.find((t=>t.test(e))))(e);if(Boolean(t),"'".concat(e,"' is not an animatable color. Use the equivalent color code instead."),!Boolean(t))return!1;let n=t.parse(e);return t===fG&&(n=function(e){let{hue:t,saturation:n,lightness:r,alpha:i}=e;t/=360,n/=100,r/=100;let a=0,o=0,s=0;if(n){const e=r<.5?r*(1+n):r+n-r*n,i=2*r-e;a=SG(i,e,t+1/3),o=SG(i,e,t),s=SG(i,e,t-1/3)}else a=o=s=r;return{red:Math.round(255*a),green:Math.round(255*o),blue:Math.round(255*s),alpha:i}}(n)),n}const NG=(e,t)=>{const n=IG(e),r=IG(t);if(!n||!r)return CG(e,t);const i=d({},n);return e=>(i.red=TG(n.red,r.red,e),i.green=TG(n.green,r.green,e),i.blue=TG(n.blue,r.blue,e),i.alpha=xG(n.alpha,r.alpha,e),rG.transform(i))},AG=new Set(["none","hidden"]);function kG(e,t){return n=>xG(e,t,n)}function DG(e){return"number"===typeof e?kG:"string"===typeof e?YW(e)?CG:hG.test(e)?NG:OG:Array.isArray(e)?MG:"object"===typeof e?hG.test(e)?NG:LG:CG}function MG(e,t){const n=[...e],r=n.length,i=e.map(((e,n)=>DG(e)(e,t[n])));return e=>{for(let t=0;t<r;t++)n[t]=i[t](e);return n}}function LG(e,t){const n=d(d({},e),t),r={};for(const i in n)void 0!==e[i]&&void 0!==t[i]&&(r[i]=DG(e[i])(e[i],t[i]));return e=>{for(const t in r)n[t]=r[t](e);return n}}const OG=(e,t)=>{const n=EG.createTransformer(t),r=yG(e),i=yG(t);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?AG.has(e)&&!i.values.length||AG.has(t)&&!r.values.length?function(e,t){return AG.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}(e,t):FW(MG(function(e,t){const n=[],r={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){var i;const o=t.types[a],s=e.indexes[o][r[o]],c=null!==(i=e.values[s])&&void 0!==i?i:0;n[a]=c,r[o]++}return n}(r,i),i.values),n):("Complex values '".concat(e,"' and '").concat(t,"' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition."),CG(e,t))};function PG(e,t,n){if("number"===typeof e&&"number"===typeof t&&"number"===typeof n)return xG(e,t,n);return DG(e)(e,t)}const jG=e=>{const t=t=>{let{timestamp:n}=t;return e(n)};return{start:function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return dW.update(t,e)},stop:()=>fW(t),now:()=>hW.isProcessing?hW.timestamp:CW.now()}},FG=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r="";const i=Math.max(Math.round(t/n),2);for(let a=0;a<i;a++)r+=e(a/(i-1))+", ";return"linear(".concat(r.substring(0,r.length-2),")")},UG=2e4;function BG(e){let t=0;let n=e.next(t);for(;!n.done&&t<UG;)t+=50,n=e.next(t);return t>=UG?1/0:t}function VG(e,t,n){const r=Math.max(t-5,0);return wW(n-e(r),t-r)}const zG={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},WG=.001;function GG(e){let t,n,{duration:r=zG.duration,bounce:i=zG.bounce,velocity:a=zG.velocity,mass:o=zG.mass}=e;BW(zG.maxDuration);let s=1-i;s=UW(zG.minDamping,zG.maxDamping,s),r=UW(zG.minDuration,zG.maxDuration,VW(r)),s<1?(t=e=>{const t=e*s,n=t*r,i=t-a,o=YG(e,s),c=Math.exp(-n);return WG-i/o*c},n=e=>{const n=e*s*r,i=n*a+a,o=Math.pow(s,2)*Math.pow(e,2)*r,c=Math.exp(-n),u=YG(Math.pow(e,2),s);return(-t(e)+WG>0?-1:1)*((i-o)*c)/u}):(t=e=>Math.exp(-e*r)*((e-a)*r+1)-.001,n=e=>Math.exp(-e*r)*(r*r*(a-e)));const c=function(e,t,n){let r=n;for(let i=1;i<HG;i++)r-=e(r)/t(r);return r}(t,n,5/r);if(r=BW(r),isNaN(c))return{stiffness:zG.stiffness,damping:zG.damping,duration:r};{const e=Math.pow(c,2)*o;return{stiffness:e,damping:2*s*Math.sqrt(o*e),duration:r}}}const HG=12;function YG(e,t){return e*Math.sqrt(1-t*t)}const qG=["duration","bounce"],KG=["stiffness","damping","mass"];function XG(e,t){return t.some((t=>void 0!==e[t]))}function QG(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zG.visualDuration,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zG.bounce;const n="object"!==typeof e?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:i}=n;const a=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],s={done:!1,value:a},{stiffness:c,damping:u,mass:l,duration:f,velocity:h,isResolvedFromDuration:p}=function(e){let t=d({velocity:zG.velocity,stiffness:zG.stiffness,damping:zG.damping,mass:zG.mass,isResolvedFromDuration:!1},e);if(!XG(e,KG)&&XG(e,qG))if(e.visualDuration){const n=e.visualDuration,r=2*Math.PI/(1.2*n),i=r*r,a=2*UW(.05,1,1-(e.bounce||0))*Math.sqrt(i);t=d(d({},t),{},{mass:zG.mass,stiffness:i,damping:a})}else{const n=GG(e);t=d(d(d({},t),n),{},{mass:zG.mass}),t.isResolvedFromDuration=!0}return t}(d(d({},n),{},{velocity:-VW(n.velocity||0)})),m=h||0,g=u/(2*Math.sqrt(c*l)),v=o-a,y=VW(Math.sqrt(c/l)),b=Math.abs(v)<5;let _;if(r||(r=b?zG.restSpeed.granular:zG.restSpeed.default),i||(i=b?zG.restDelta.granular:zG.restDelta.default),g<1){const e=YG(y,g);_=t=>{const n=Math.exp(-g*y*t);return o-n*((m+g*y*v)/e*Math.sin(e*t)+v*Math.cos(e*t))}}else if(1===g)_=e=>o-Math.exp(-y*e)*(v+(m+y*v)*e);else{const e=y*Math.sqrt(g*g-1);_=t=>{const n=Math.exp(-g*y*t),r=Math.min(e*t,300);return o-n*((m+g*y*v)*Math.sinh(r)+e*v*Math.cosh(r))/e}}const w={calculatedDuration:p&&f||null,next:e=>{const t=_(e);if(p)s.done=e>=f;else{let n=0===e?m:0;g<1&&(n=0===e?BW(m):VG(_,e,t));const a=Math.abs(n)<=r,c=Math.abs(o-t)<=i;s.done=a&&c}return s.value=s.done?o:t,s},toString:()=>{const e=Math.min(BG(w),UG),t=FG((t=>w.next(e*t).value),e,30);return e+"ms "+t},toTransition:()=>{}};return w}function JG(e){let{keyframes:t,velocity:n=0,power:r=.8,timeConstant:i=325,bounceDamping:a=10,bounceStiffness:o=500,modifyTarget:s,min:c,max:u,restDelta:l=.5,restSpeed:d}=e;const f=t[0],h={done:!1,value:f},p=e=>void 0===c?u:void 0===u||Math.abs(c-e)<Math.abs(u-e)?c:u;let m=r*n;const g=f+m,v=void 0===s?g:s(g);v!==g&&(m=v-f);const y=e=>-m*Math.exp(-e/i),b=e=>v+y(e),_=e=>{const t=y(e),n=b(e);h.done=Math.abs(t)<=l,h.value=h.done?v:n};let w,E;const S=e=>{(e=>void 0!==c&&e<c||void 0!==u&&e>u)(h.value)&&(w=e,E=QG({keyframes:[h.value,p(h.value)],velocity:VG(b,e,h.value),damping:a,stiffness:o,restDelta:l,restSpeed:d}))};return S(0),{calculatedDuration:null,next:e=>{let t=!1;return E||void 0!==w||(t=!0,_(e),S(e)),void 0!==w&&e>=w?E.next(e-w):(!t&&_(e),h)}}}QG.applyToOptions=e=>{const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;const n=(arguments.length>2?arguments[2]:void 0)(d(d({},e),{},{keyframes:[0,t]})),r=Math.min(BG(n),UG);return{type:"keyframes",ease:e=>n.next(r*e).value/t,duration:VW(r)}}(e,100,QG);return e.ease=t.ease,e.duration=BW(t.duration),e.type="keyframes",e};const ZG=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e;function $G(e,t,n,r){if(e===t&&n===r)return oW;const i=t=>function(e,t,n,r,i){let a,o,s=0;do{o=t+(n-t)/2,a=ZG(o,r,i)-e,a>0?n=o:t=o}while(Math.abs(a)>1e-7&&++s<12);return o}(t,0,1,e,n);return e=>0===e||1===e?e:ZG(i(e),t,r)}const eH=$G(.42,0,1,1),tH=$G(0,0,.58,1),nH=$G(.42,0,.58,1),rH=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,iH=e=>t=>1-e(1-t),aH=$G(.33,1.53,.69,.99),oH=iH(aH),sH=rH(oH),cH=e=>(e*=2)<1?.5*oH(e):.5*(2-Math.pow(2,-10*(e-1))),uH=e=>1-Math.sin(Math.acos(e)),lH=iH(uH),dH=rH(uH),fH=e=>Array.isArray(e)&&"number"===typeof e[0],hH={linear:oW,easeIn:eH,easeInOut:nH,easeOut:tH,circIn:uH,circInOut:dH,circOut:lH,backIn:oH,backInOut:sH,backOut:aH,anticipate:cH},pH=e=>{if(fH(e)){e.length;const[t,n,r,i]=e;return $G(t,n,r,i)}return"string"===typeof e?("Invalid easing type '".concat(e,"'"),hH[e]):e},mH=(e,t,n)=>{const r=t-e;return 0===r?1:(n-e)/r};function gH(e,t){let{clamp:n=!0,ease:r,mixer:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=e.length;if(t.length,1===a)return()=>t[0];if(2===a&&t[0]===t[1])return()=>t[1];const o=e[0]===e[1];e[0]>e[a-1]&&(e=[...e].reverse(),t=[...t].reverse());const s=function(e,t,n){const r=[],i=n||sW.mix||PG,a=e.length-1;for(let o=0;o<a;o++){let n=i(e[o],e[o+1]);if(t){const e=Array.isArray(t)?t[o]||oW:t;n=FW(e,n)}r.push(n)}return r}(t,r,i),c=s.length,u=n=>{if(o&&n<e[0])return t[0];let r=0;if(c>1)for(;r<e.length-2&&!(n<e[r+1]);r++);const i=mH(e[r],e[r+1],n);return s[r](i)};return n?t=>u(UW(e[0],e[a-1],t)):u}function vH(e){const t=[0];return function(e,t){const n=e[e.length-1];for(let r=1;r<=t;r++){const i=mH(0,t,r);e.push(xG(n,1,i))}}(t,e.length-1),t}function yH(e){let{duration:t=300,keyframes:n,times:r,ease:i="easeInOut"}=e;const a=(e=>Array.isArray(e)&&"number"!==typeof e[0])(i)?i.map(pH):pH(i),o={done:!1,value:n[0]},s=function(e,t){return e.map((e=>e*t))}(r&&r.length===n.length?r:vH(n),t),c=gH(s,n,{ease:Array.isArray(a)?a:(u=n,l=a,u.map((()=>l||nH)).splice(0,u.length-1))});var u,l;return{calculatedDuration:t,next:e=>(o.value=c(e),o.done=e>=t,o)}}const bH=e=>null!==e;function _H(e,t,n){let{repeat:r,repeatType:i="loop"}=t,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const o=e.filter(bH),s=a<0||r&&"loop"!==i&&r%2===1?0:o.length-1;return s&&void 0!==n?n:o[s]}const wH={decay:JG,inertia:JG,tween:yH,keyframes:yH,spring:QG};function EH(e){"string"===typeof e.type&&(e.type=wH[e.type])}class SH{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise((e=>{this.resolve=e}))}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const CH=e=>e/100;class xH extends SH{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var e,t;const{motionValue:n}=this.options;n&&n.updatedAt!==CW.now()&&this.tick(CW.now()),this.isStopped=!0,"idle"!==this.state&&(this.teardown(),null===(e=(t=this.options).onStop)||void 0===e||e.call(t))},zW.mainThread++,this.options=e,this.initAnimation(),this.play(),!1===e.autoplay&&this.pause()}initAnimation(){const{options:e}=this;EH(e);const{type:t=yH,repeat:n=0,repeatDelay:r=0,repeatType:i,velocity:a=0}=e;let{keyframes:o}=e;const s=t||yH;s!==yH&&"number"!==typeof o[0]&&(this.mixKeyframes=FW(CH,PG(o[0],o[1])),o=[0,100]);const c=s(d(d({},e),{},{keyframes:o}));"mirror"===i&&(this.mirroredGenerator=s(d(d({},e),{},{keyframes:[...o].reverse(),velocity:-a}))),null===c.calculatedDuration&&(c.calculatedDuration=BG(c));const{calculatedDuration:u}=c;this.calculatedDuration=u,this.resolvedDuration=u+r,this.totalDuration=this.resolvedDuration*(n+1)-r,this.generator=c}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;null!==this.holdTime?this.currentTime=this.holdTime:this.currentTime=t}tick(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{generator:n,totalDuration:r,mixKeyframes:i,mirroredGenerator:a,resolvedDuration:o,calculatedDuration:s}=this;if(null===this.startTime)return n.next(0);const{delay:c=0,keyframes:u,repeat:l,repeatType:d,repeatDelay:f,type:h,onUpdate:p,finalKeyframe:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const g=this.currentTime-c*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?g<0:g>r;this.currentTime=Math.max(g,0),"finished"===this.state&&null===this.holdTime&&(this.currentTime=r);let y=this.currentTime,b=n;if(l){const e=Math.min(this.currentTime,r)/o;let t=Math.floor(e),n=e%1;!n&&e>=1&&(n=1),1===n&&t--,t=Math.min(t,l+1);Boolean(t%2)&&("reverse"===d?(n=1-n,f&&(n-=f/o)):"mirror"===d&&(b=a)),y=UW(0,1,n)*o}const _=v?{done:!1,value:u[0]}:b.next(y);i&&(_.value=i(_.value));let{done:w}=_;v||null===s||(w=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const E=null===this.holdTime&&("finished"===this.state||"running"===this.state&&w);return E&&h!==JG&&(_.value=_H(u,this.options,m,this.speed)),p&&p(_.value),E&&this.finish(),_}then(e,t){return this.finished.then(e,t)}get duration(){return VW(this.calculatedDuration)}get time(){return VW(this.currentTime)}set time(e){var t;e=BW(e),this.currentTime=e,null===this.startTime||null!==this.holdTime||0===this.playbackSpeed?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),null===(t=this.driver)||void 0===t||t.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(CW.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=VW(this.currentTime))}play(){var e,t;if(this.isStopped)return;const{driver:n=jG,startTime:r}=this.options;this.driver||(this.driver=n((e=>this.tick(e)))),null===(e=(t=this.options).onPlay)||void 0===e||e.call(t);const i=this.driver.now();"finished"===this.state?(this.updateFinished(),this.startTime=i):null!==this.holdTime?this.startTime=i-this.holdTime:this.startTime||(this.startTime=null!==r&&void 0!==r?r:i),"finished"===this.state&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(CW.now()),this.holdTime=this.currentTime}complete(){"running"!==this.state&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,t;this.notifyFinished(),this.teardown(),this.state="finished",null===(e=(t=this.options).onComplete)||void 0===e||e.call(t)}cancel(){var e,t;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),null===(e=(t=this.options).onCancel)||void 0===e||e.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null,zW.mainThread--}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var t;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),null===(t=this.driver)||void 0===t||t.stop(),e.observe(this)}}const TH=e=>180*e/Math.PI,RH=e=>{const t=TH(Math.atan2(e[1],e[0]));return NH(t)},IH={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:RH,rotateZ:RH,skewX:e=>TH(Math.atan(e[1])),skewY:e=>TH(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},NH=e=>((e%=360)<0&&(e+=360),e),AH=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),kH=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),DH={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:AH,scaleY:kH,scale:e=>(AH(e)+kH(e))/2,rotateX:e=>NH(TH(Math.atan2(e[6],e[5]))),rotateY:e=>NH(TH(Math.atan2(-e[2],e[0]))),rotateZ:RH,rotate:RH,skewX:e=>TH(Math.atan(e[4])),skewY:e=>TH(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function MH(e){return e.includes("scale")?1:0}function LH(e,t){if(!e||"none"===e)return MH(t);const n=e.match(/^matrix3d\(([\t-\r ,-\.0-9e\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+)\)$/);let r,i;if(n)r=DH,i=n;else{const t=e.match(/^matrix\(([\t-\r ,-\.0-9e\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+)\)$/);r=IH,i=t}if(!i)return MH(t);const a=r[t],o=i[1].split(",").map(OH);return"function"===typeof a?a(o):o[a]}function OH(e){return parseFloat(e.trim())}const PH=e=>e===KW||e===cG,jH=new Set(["x","y","z"]),FH=mW.filter((e=>!jH.has(e)));const UH={width:(e,t)=>{let{x:n}=e,{paddingLeft:r="0",paddingRight:i="0"}=t;return n.max-n.min-parseFloat(r)-parseFloat(i)},height:(e,t)=>{let{y:n}=e,{paddingTop:r="0",paddingBottom:i="0"}=t;return n.max-n.min-parseFloat(r)-parseFloat(i)},top:(e,t)=>{let{top:n}=t;return parseFloat(n)},left:(e,t)=>{let{left:n}=t;return parseFloat(n)},bottom:(e,t)=>{let{y:n}=e,{top:r}=t;return parseFloat(r)+(n.max-n.min)},right:(e,t)=>{let{x:n}=e,{left:r}=t;return parseFloat(r)+(n.max-n.min)},x:(e,t)=>{let{transform:n}=t;return LH(n,"x")},y:(e,t)=>{let{transform:n}=t;return LH(n,"y")}};UH.translateX=UH.x,UH.translateY=UH.y;const BH=new Set;let VH=!1,zH=!1,WH=!1;function GH(){if(zH){const e=Array.from(BH).filter((e=>e.needsMeasurement)),t=new Set(e.map((e=>e.element))),n=new Map;t.forEach((e=>{const t=function(e){const t=[];return FH.forEach((n=>{const r=e.getValue(n);void 0!==r&&(t.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))})),t}(e);t.length&&(n.set(e,t),e.render())})),e.forEach((e=>e.measureInitialState())),t.forEach((e=>{e.render();const t=n.get(e);t&&t.forEach((t=>{var n;let[r,i]=t;null===(n=e.getValue(r))||void 0===n||n.set(i)}))})),e.forEach((e=>e.measureEndState())),e.forEach((e=>{void 0!==e.suspendedScrollY&&window.scrollTo(0,e.suspendedScrollY)}))}zH=!1,VH=!1,BH.forEach((e=>e.complete(WH))),BH.clear()}function HH(){BH.forEach((e=>{e.readKeyframes(),e.needsMeasurement&&(zH=!0)}))}class YH{constructor(e,t,n,r,i){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=r,this.element=i,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(BH.add(this),VH||(VH=!0,dW.read(HH),dW.resolveKeyframes(GH))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:r}=this;if(null===e[0]){const i=null===r||void 0===r?void 0:r.get(),a=e[e.length-1];if(void 0!==i)e[0]=i;else if(n&&t){const r=n.readValue(t,a);void 0!==r&&null!==r&&(e[0]=r)}void 0===e[0]&&(e[0]=a),r&&void 0===i&&r.set(e[0])}!function(e){for(let n=1;n<e.length;n++){var t;null!==(t=e[n])&&void 0!==t||(e[n]=e[n-1])}}(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),BH.delete(this)}cancel(){"scheduled"===this.state&&(BH.delete(this),this.state="pending")}resume(){"pending"===this.state&&this.scheduleResolve()}}function qH(e){let t;return()=>(void 0===t&&(t=e()),t)}const KH=qH((()=>void 0!==window.ScrollTimeline)),XH={};function QH(e,t){const n=qH(e);return()=>{var e;return null!==(e=XH[t])&&void 0!==e?e:n()}}const JH=QH((()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(Vc){return!1}return!0}),"linearEasing"),ZH=e=>{let[t,n,r,i]=e;return"cubic-bezier(".concat(t,", ").concat(n,", ").concat(r,", ").concat(i,")")},$H={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ZH([0,.65,.55,1]),circOut:ZH([.55,0,1,.45]),backIn:ZH([.31,.01,.66,-.59]),backOut:ZH([.33,1.53,.69,.99])};function eY(e,t){return e?"function"===typeof e?JH()?FG(e,t):"ease-out":fH(e)?ZH(e):Array.isArray(e)?e.map((e=>eY(e,t)||$H.easeOut)):$H[e]:void 0}function tY(e,t,n){let{delay:r=0,duration:i=300,repeat:a=0,repeatType:o="loop",ease:s="easeOut",times:c}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const l={[t]:n};c&&(l.offset=c);const d=eY(s,i);Array.isArray(d)&&(l.easing=d),uW.value&&zW.waapi++;const f={delay:r,duration:i,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:a+1,direction:"reverse"===o?"alternate":"normal"};u&&(f.pseudoElement=u);const h=e.animate(l,f);return uW.value&&h.finished.finally((()=>{zW.waapi--})),h}function nY(e){return"function"===typeof e&&"applyToOptions"in e}const rY=["type"];class iY extends SH{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:n,keyframes:r,pseudoElement:i,allowFlatten:a=!1,finalKeyframe:o,onComplete:s}=e;this.isPseudoElement=Boolean(i),this.allowFlatten=a,this.options=e,e.type;const u=function(e){let{type:t}=e,n=c(e,rY);return nY(t)&&JH()?t.applyToOptions(n):(null!==(r=n.duration)&&void 0!==r||(n.duration=300),null!==(i=n.ease)&&void 0!==i||(n.ease="easeOut"),n);var r,i}(e);this.animation=tY(t,n,r,u,i),!1===u.autoplay&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!i){const e=_H(r,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(e):function(e,t,n){(e=>e.startsWith("--"))(t)?e.style.setProperty(t,n):e.style[t]=n}(t,n,e),this.animation.cancel()}null===s||void 0===s||s(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),"finished"===this.state&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,t;null===(e=(t=this.animation).finish)||void 0===e||e.call(t)}cancel(){try{this.animation.cancel()}catch(Vc){}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;"idle"!==e&&"finished"!==e&&(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,t;this.isPseudoElement||(null===(e=(t=this.animation).commitStyles)||void 0===e||e.call(t))}get duration(){var e,t;const n=(null===(e=this.animation.effect)||void 0===e||null===(t=e.getComputedTiming)||void 0===t?void 0:t.call(e).duration)||0;return VW(Number(n))}get time(){return VW(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=BW(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return null!==this.finishedTime?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline(e){let{timeline:t,observe:n}=e;var r;this.allowFlatten&&(null===(r=this.animation.effect)||void 0===r||r.updateTiming({easing:"linear"}));return this.animation.onfinish=null,t&&KH()?(this.animation.timeline=t,oW):n(this)}}const aY={anticipate:cH,backInOut:sH,circInOut:dH};function oY(e){"string"===typeof e.ease&&e.ease in aY&&(e.ease=aY[e.ease])}const sY=["motionValue","onUpdate","onComplete","element"];class cY extends iY{constructor(e){oY(e),EH(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){var t;const n=this.options,{motionValue:r,onUpdate:i,onComplete:a,element:o}=n,s=c(n,sY);if(!r)return;if(void 0!==e)return void r.set(e);const u=new xH(d(d({},s),{},{autoplay:!1})),l=BW(null!==(t=this.finishedTime)&&void 0!==t?t:this.time);r.setWithVelocity(u.sample(l-10).value,u.sample(l).value,10),u.stop()}}const uY=(e,t)=>"zIndex"!==t&&(!("number"!==typeof e&&!Array.isArray(e))||!("string"!==typeof e||!EG.test(e)&&"0"!==e||e.startsWith("url(")));const lY=new Set(["opacity","clipPath","filter","transform"]),dY=qH((()=>Object.hasOwnProperty.call(Element.prototype,"animate")));const fY=["autoplay","delay","type","repeat","repeatDelay","repeatType","keyframes","name","motionValue","element"];class hY extends SH{constructor(e){var t;let{autoplay:n=!0,delay:r=0,type:i="keyframes",repeat:a=0,repeatDelay:o=0,repeatType:s="loop",keyframes:u,name:l,motionValue:f,element:h}=e,p=c(e,fY);super(),this.stop=()=>{var e,t;this._animation&&(this._animation.stop(),null===(t=this.stopTimeline)||void 0===t||t.call(this));null===(e=this.keyframeResolver)||void 0===e||e.cancel()},this.createdAt=CW.now();const m=d({autoplay:n,delay:r,type:i,repeat:a,repeatDelay:o,repeatType:s,name:l,motionValue:f,element:h},p),g=(null===h||void 0===h?void 0:h.KeyframeResolver)||YH;this.keyframeResolver=new g(u,((e,t,n)=>this.onKeyframesResolved(e,t,m,!n)),l,f,h),null===(t=this.keyframeResolver)||void 0===t||t.scheduleResolve()}onKeyframesResolved(e,t,n,r){this.keyframeResolver=void 0;const{name:i,type:a,velocity:o,delay:s,isHandoff:c,onUpdate:u}=n;this.resolvedAt=CW.now(),function(e,t,n,r){const i=e[0];if(null===i)return!1;if("display"===t||"visibility"===t)return!0;const a=e[e.length-1],o=uY(i,t),s=uY(a,t);return"You are trying to animate ".concat(t,' from "').concat(i,'" to "').concat(a,'". ').concat(i," is not an animatable value - to enable this animation set ").concat(i," to a value animatable to ").concat(a," via the `style` property."),!(!o||!s)&&(function(e){const t=e[0];if(1===e.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}(e)||("spring"===n||nY(n))&&r)}(e,i,a,o)||(!sW.instantAnimations&&s||null===u||void 0===u||u(_H(e,n,t)),e[0]=e[e.length-1],n.duration=0,n.repeat=0);const l=d(d({startTime:r?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:t},n),{},{keyframes:e}),f=!c&&function(e){var t;const{motionValue:n,name:r,repeatDelay:i,repeatType:a,damping:o,type:s}=e;if(!Gz(null===n||void 0===n||null===(t=n.owner)||void 0===t?void 0:t.current))return!1;const{onUpdate:c,transformTemplate:u}=n.owner.getProps();return dY()&&r&&lY.has(r)&&("transform"!==r||!u)&&!c&&!i&&"mirror"!==a&&0!==o&&"inertia"!==s}(l)?new cY(d(d({},l),{},{element:l.motionValue.owner.current})):new xH(l);f.finished.then((()=>this.notifyFinished())).catch(oW),this.pendingTimeline&&(this.stopTimeline=f.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=f}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then((()=>{}))}get animation(){var e;this._animation||(null===(e=this.keyframeResolver)||void 0===e||e.resume(),WH=!0,HH(),GH(),WH=!1);return this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),null===(e=this.keyframeResolver)||void 0===e||e.cancel()}}const pY=e=>null!==e;const mY={type:"spring",stiffness:500,damping:25,restSpeed:10},gY={type:"keyframes",duration:.8},vY={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},yY=(e,t)=>{let{keyframes:n}=t;return n.length>2?gY:gW.has(e)?e.startsWith("scale")?{type:"spring",stiffness:550,damping:0===n[1]?2*Math.sqrt(550):30,restSpeed:10}:mY:vY},bY=["when","delay","delayChildren","staggerChildren","staggerDirection","repeat","repeatType","repeatDelay","from","elapsed"];const _Y=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return o=>{const s=aW(r,e)||{},u=s.delay||r.delay||0;let{elapsed:l=0}=r;l-=BW(u);const f=d(d({keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity()},s),{},{delay:-l,onUpdate:e=>{t.set(e),s.onUpdate&&s.onUpdate(e)},onComplete:()=>{o(),s.onComplete&&s.onComplete()},name:e,motionValue:t,element:a?void 0:i});(function(e){let{when:t,delay:n,delayChildren:r,staggerChildren:i,staggerDirection:a,repeat:o,repeatType:s,repeatDelay:u,from:l,elapsed:d}=e,f=c(e,bY);return!!Object.keys(f).length})(s)||Object.assign(f,yY(e,f)),f.duration&&(f.duration=BW(f.duration)),f.repeatDelay&&(f.repeatDelay=BW(f.repeatDelay)),void 0!==f.from&&(f.keyframes[0]=f.from);let h=!1;if((!1===f.type||0===f.duration&&!f.repeatDelay)&&(f.duration=0,0===f.delay&&(h=!0)),(sW.instantAnimations||sW.skipAnimations)&&(h=!0,f.duration=0,f.delay=0),f.allowFlatten=!s.type&&!s.ease,h&&!a&&void 0!==t.get()){const e=function(e,t,n){let{repeat:r,repeatType:i="loop"}=t;const a=e.filter(pY),o=r&&"loop"!==i&&r%2===1?0:a.length-1;return o&&void 0!==n?n:a[o]}(f.keyframes,s);if(void 0!==e)return void dW.update((()=>{f.onUpdate(e),f.onComplete()}))}return s.isSync?new xH(f):new hY(f)}},wY=["transition","transitionEnd"];function EY(e,t){let{protectedKeys:n,needsAnimating:r}=e;const i=n.hasOwnProperty(t)&&!0!==r[t];return r[t]=!1,i}function SY(e,t){let{delay:n=0,transitionOverride:r,type:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{transition:a=e.getDefaultTransition(),transitionEnd:o}=t,s=c(t,wY);r&&(a=r);const u=[],l=i&&e.animationState&&e.animationState.getState()[i];for(const c in s){var f;const t=e.getValue(c,null!==(f=e.latestValues[c])&&void 0!==f?f:null),r=s[c];if(void 0===r||l&&EY(l,c))continue;const i=d({delay:n},aW(a||{},c)),o=t.get();if(void 0!==o&&!t.isAnimating&&!Array.isArray(r)&&r===o&&!i.velocity)continue;let h=!1;if(window.MotionHandoffAnimation){const t=PW(e);if(t){const e=window.MotionHandoffAnimation(t,c,dW);null!==e&&(i.startTime=e,h=!0)}}MW(e,c),t.start(_Y(c,t,r,e.shouldReduceMotion&&vW.has(c)?{type:!1}:i,e,h));const p=t.animation;p&&u.push(p)}return o&&Promise.all(u).then((()=>{dW.update((()=>{o&&function(e,t){let n=iW(e,t)||{},{transitionEnd:r={},transition:i={}}=n,a=c(n,NW);a=d(d({},a),r);for(const o in a)AW(e,o,kW(a[o]))}(e,o)}))})),u}function CY(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=iW(e,t,"exit"===r.type?null===(n=e.presenceContext)||void 0===n?void 0:n.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=i||{};r.transitionOverride&&(a=r.transitionOverride);const o=i?()=>Promise.all(SY(e,i,r)):()=>Promise.resolve(),s=e.variantChildren&&e.variantChildren.size?function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{delayChildren:i=0,staggerChildren:o,staggerDirection:s}=a;return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5?arguments[5]:void 0;const o=[],s=(e.variantChildren.size-1)*r,c=1===i?function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*r}:function(){return s-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)*r};return Array.from(e.variantChildren).sort(xY).forEach(((e,r)=>{e.notify("AnimationStart",t),o.push(CY(e,t,d(d({},a),{},{delay:n+c(r)})).then((()=>e.notify("AnimationComplete",t))))})),Promise.all(o)}(e,t,i+n,o,s,r)}:()=>Promise.resolve(),{when:c}=a;if(c){const[e,t]="beforeChildren"===c?[o,s]:[s,o];return e().then((()=>t()))}return Promise.all([o(),s(r.delay)])}function xY(e,t){return e.sortNodePosition(t)}function TY(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}function RY(e){return"string"===typeof e||Array.isArray(e)}const IY=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],NY=["initial",...IY],AY=NY.length;function kY(e){if(!e)return;if(!e.isControllingVariants){const t=e.parent&&kY(e.parent)||{};return void 0!==e.props.initial&&(t.initial=e.props.initial),t}const t={};for(let n=0;n<AY;n++){const r=NY[n],i=e.props[r];(RY(i)||!1===i)&&(t[r]=i)}return t}const DY=["transition","transitionEnd"],MY=[...IY].reverse(),LY=IY.length;function OY(e){return t=>Promise.all(t.map((t=>{let{animation:n,options:r}=t;return function(e,t){let n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.notify("AnimationStart",t),Array.isArray(t)){const i=t.map((t=>CY(e,t,r)));n=Promise.all(i)}else if("string"===typeof t)n=CY(e,t,r);else{const i="function"===typeof t?iW(e,t,r.custom):t;n=Promise.all(SY(e,i,r))}return n.then((()=>{e.notify("AnimationComplete",t)}))}(e,n,r)})))}function PY(e){let t=OY(e),n=UY(),r=!0;const i=t=>(n,r)=>{var i;const a=iW(e,r,"exit"===t?null===(i=e.presenceContext)||void 0===i?void 0:i.custom:void 0);if(a){const{transition:e,transitionEnd:t}=a,r=c(a,DY);n=d(d(d({},n),r),t)}return n};function a(a){const{props:o}=e,s=kY(e.parent)||{},c=[],u=new Set;let l={},f=1/0;for(let t=0;t<LY;t++){const h=MY[t],p=n[h],m=void 0!==o[h]?o[h]:s[h],g=RY(m),v=h===a?p.isActive:null;!1===v&&(f=t);let y=m===s[h]&&m!==o[h]&&g;if(y&&r&&e.manuallyAnimateOnMount&&(y=!1),p.protectedKeys=d({},l),!p.isActive&&null===v||!m&&!p.prevProp||tW(m)||"boolean"===typeof m)continue;const b=jY(p.prevProp,m);let _=b||h===a&&p.isActive&&!y&&g||t>f&&g,w=!1;const E=Array.isArray(m)?m:[m];let S=E.reduce(i(h),{});!1===v&&(S={});const{prevResolvedValues:C={}}=p,x=d(d({},C),S),T=t=>{_=!0,u.has(t)&&(w=!0,u.delete(t)),p.needsAnimating[t]=!0;const n=e.getValue(t);n&&(n.liveStyle=!1)};for(const e in x){const t=S[e],n=C[e];if(l.hasOwnProperty(e))continue;let r=!1;r=IW(t)&&IW(n)?!TY(t,n):t!==n,r?void 0!==t&&null!==t?T(e):u.add(e):void 0!==t&&u.has(e)?T(e):p.protectedKeys[e]=!0}p.prevProp=m,p.prevResolvedValues=S,p.isActive&&(l=d(d({},l),S)),r&&e.blockInitialAnimation&&(_=!1);_&&(!(y&&b)||w)&&c.push(...E.map((e=>({animation:e,options:{type:h}}))))}if(u.size){const t={};if("boolean"!==typeof o.initial){const n=iW(e,Array.isArray(o.initial)?o.initial[0]:o.initial);n&&n.transition&&(t.transition=n.transition)}u.forEach((n=>{const r=e.getBaseTarget(n),i=e.getValue(n);i&&(i.liveStyle=!0),t[n]=null!==r&&void 0!==r?r:null})),c.push({animation:t})}let h=Boolean(c.length);return!r||!1!==o.initial&&o.initial!==o.animate||e.manuallyAnimateOnMount||(h=!1),r=!1,h?t(c):Promise.resolve()}return{animateChanges:a,setActive:function(t,r){var i;if(n[t].isActive===r)return Promise.resolve();null===(i=e.variantChildren)||void 0===i||i.forEach((e=>{var n;return null===(n=e.animationState)||void 0===n?void 0:n.setActive(t,r)})),n[t].isActive=r;const o=a(t);for(const e in n)n[e].protectedKeys={};return o},setAnimateFunction:function(n){t=n(e)},getState:()=>n,reset:()=>{n=UY(),r=!0}}}function jY(e,t){return"string"===typeof t?t!==e:!!Array.isArray(t)&&!TY(t,e)}function FY(){return{isActive:arguments.length>0&&void 0!==arguments[0]&&arguments[0],protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function UY(){return{animate:FY(!0),whileInView:FY(),whileHover:FY(),whileTap:FY(),whileDrag:FY(),whileFocus:FY(),exit:FY()}}class BY{constructor(e){this.isMounted=!1,this.node=e}update(){}}let VY=0;const zY={animation:{Feature:class extends BY{constructor(e){super(e),e.animationState||(e.animationState=PY(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();tW(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),null===(e=this.unmountControls)||void 0===e||e.call(this)}}},exit:{Feature:class extends BY{constructor(){super(...arguments),this.id=VY++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then((()=>{t(this.id)}))}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}}},WY={x:!1,y:!1};function GY(){return WY.x||WY.y}function HY(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{passive:!0};return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n)}const YY=e=>"mouse"===e.pointerType?"number"!==typeof e.button||e.button<=0:!1!==e.isPrimary;function qY(e){return{point:{x:e.pageX,y:e.pageY}}}function KY(e,t,n,r){return HY(e,t,(e=>t=>YY(t)&&e(t,qY(t)))(n),r)}function XY(e){let{top:t,left:n,right:r,bottom:i}=e;return{x:{min:n,max:r},y:{min:t,max:i}}}function QY(e){return e.max-e.min}function JY(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;e.origin=r,e.originPoint=xG(t.min,t.max,e.origin),e.scale=QY(n)/QY(t),e.translate=xG(n.min,n.max,e.origin)-e.originPoint,(e.scale>=.9999&&e.scale<=1.0001||isNaN(e.scale))&&(e.scale=1),(e.translate>=-.01&&e.translate<=.01||isNaN(e.translate))&&(e.translate=0)}function ZY(e,t,n,r){JY(e.x,t.x,n.x,r?r.originX:void 0),JY(e.y,t.y,n.y,r?r.originY:void 0)}function $Y(e,t,n){e.min=n.min+t.min,e.max=e.min+QY(t)}function eq(e,t,n){e.min=t.min-n.min,e.max=e.min+QY(t)}function tq(e,t,n){eq(e.x,t.x,n.x),eq(e.y,t.y,n.y)}const nq=()=>({x:{min:0,max:0},y:{min:0,max:0}});function rq(e){return[e("x"),e("y")]}function iq(e){return void 0===e||1===e}function aq(e){let{scale:t,scaleX:n,scaleY:r}=e;return!iq(t)||!iq(n)||!iq(r)}function oq(e){return aq(e)||sq(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function sq(e){return cq(e.x)||cq(e.y)}function cq(e){return e&&"0%"!==e}function uq(e,t,n){return n+t*(e-n)}function lq(e,t,n,r,i){return void 0!==i&&(e=uq(e,i,r)),uq(e,n,r)+t}function dq(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;e.min=lq(e.min,t,n,r,i),e.max=lq(e.max,t,n,r,i)}function fq(e,t){let{x:n,y:r}=t;dq(e.x,n.translate,n.scale,n.originPoint),dq(e.y,r.translate,r.scale,r.originPoint)}const hq=.999999999999,pq=1.0000000000001;function mq(e,t){e.min=e.min+t,e.max=e.max+t}function gq(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;dq(e,t,n,xG(e.min,e.max,i),r)}function vq(e,t){gq(e.x,t.x,t.scaleX,t.scale,t.originX),gq(e.y,t.y,t.scaleY,t.scale,t.originY)}function yq(e,t){return XY(function(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}(e.getBoundingClientRect(),t))}const bq=e=>{let{current:t}=e;return t?t.ownerDocument.defaultView:null};function _q(e){return e&&"object"===typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}const wq=(e,t)=>Math.abs(e-t);class Eq{constructor(e,t){let{transformPagePoint:n,contextWindow:r,dragSnapToOrigin:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const e=xq(this.lastMoveEventInfo,this.history),t=null!==this.startEvent,n=function(e,t){const n=wq(e.x,t.x),r=wq(e.y,t.y);return Math.sqrt(n**2+r**2)}(e.offset,{x:0,y:0})>=3;if(!t&&!n)return;const{point:r}=e,{timestamp:i}=hW;this.history.push(d(d({},r),{},{timestamp:i}));const{onStart:a,onMove:o}=this.handlers;t||(a&&a(this.lastMoveEvent,e),this.startEvent=this.lastMoveEvent),o&&o(this.lastMoveEvent,e)},this.handlePointerMove=(e,t)=>{this.lastMoveEvent=e,this.lastMoveEventInfo=Sq(t,this.transformPagePoint),dW.update(this.updatePoint,!0)},this.handlePointerUp=(e,t)=>{this.end();const{onEnd:n,onSessionEnd:r,resumeAnimation:i}=this.handlers;if(this.dragSnapToOrigin&&i&&i(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const a=xq("pointercancel"===e.type?this.lastMoveEventInfo:Sq(t,this.transformPagePoint),this.history);this.startEvent&&n&&n(e,a),r&&r(e,a)},!YY(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=n,this.contextWindow=r||window;const a=Sq(qY(e),this.transformPagePoint),{point:o}=a,{timestamp:s}=hW;this.history=[d(d({},o),{},{timestamp:s})];const{onSessionStart:c}=t;c&&c(e,xq(a,this.history)),this.removeListeners=FW(KY(this.contextWindow,"pointermove",this.handlePointerMove),KY(this.contextWindow,"pointerup",this.handlePointerUp),KY(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),fW(this.updatePoint)}}function Sq(e,t){return t?{point:t(e.point)}:e}function Cq(e,t){return{x:e.x-t.x,y:e.y-t.y}}function xq(e,t){let{point:n}=e;return{point:n,delta:Cq(n,Rq(t)),offset:Cq(n,Tq(t)),velocity:Iq(t,.1)}}function Tq(e){return e[0]}function Rq(e){return e[e.length-1]}function Iq(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,r=null;const i=Rq(e);for(;n>=0&&(r=e[n],!(i.timestamp-r.timestamp>BW(t)));)n--;if(!r)return{x:0,y:0};const a=VW(i.timestamp-r.timestamp);if(0===a)return{x:0,y:0};const o={x:(i.x-r.x)/a,y:(i.y-r.y)/a};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function Nq(e,t,n){return{min:void 0!==t?e.min+t:void 0,max:void 0!==n?e.max+n-(e.max-e.min):void 0}}function Aq(e,t){let n=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,r]=[r,n]),{min:n,max:r}}const kq=.35;function Dq(e,t,n){return{min:Mq(e,t),max:Mq(e,n)}}function Mq(e,t){return"number"===typeof e?e:e[t]||0}const Lq=new WeakMap;class Oq{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic={x:{min:0,max:0},y:{min:0,max:0}},this.visualElement=e}start(e){let{snapToCursor:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{presenceContext:n}=this.visualElement;if(n&&!1===n.isPresent)return;const{dragSnapToOrigin:r}=this.getProps();this.panSession=new Eq(e,{onSessionStart:e=>{const{dragSnapToOrigin:n}=this.getProps();n?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(qY(e).point)},onStart:(e,t)=>{const{drag:n,dragPropagation:r,onDragStart:i}=this.getProps();if(n&&!r&&(this.openDragLock&&this.openDragLock(),this.openDragLock="x"===(a=n)||"y"===a?WY[a]?null:(WY[a]=!0,()=>{WY[a]=!1}):WY.x||WY.y?null:(WY.x=WY.y=!0,()=>{WY.x=WY.y=!1}),!this.openDragLock))return;var a;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),rq((e=>{let t=this.getAxisMotionValue(e).get()||0;if(sG.test(t)){const{projection:n}=this.visualElement;if(n&&n.layout){const r=n.layout.layoutBox[e];if(r){t=QY(r)*(parseFloat(t)/100)}}}this.originPoint[e]=t})),i&&dW.postRender((()=>i(e,t))),MW(this.visualElement,"transform");const{animationState:o}=this.visualElement;o&&o.setActive("whileDrag",!0)},onMove:(e,t)=>{const{dragPropagation:n,dragDirectionLock:r,onDirectionLock:i,onDrag:a}=this.getProps();if(!n&&!this.openDragLock)return;const{offset:o}=t;if(r&&null===this.currentDirection)return this.currentDirection=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=null;Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x");return n}(o),void(null!==this.currentDirection&&i&&i(this.currentDirection));this.updateAxis("x",t.point,o),this.updateAxis("y",t.point,o),this.visualElement.render(),a&&a(e,t)},onSessionEnd:(e,t)=>this.stop(e,t),resumeAnimation:()=>rq((e=>{var t;return"paused"===this.getAnimationState(e)&&(null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.play())}))},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:r,contextWindow:bq(this.visualElement)})}stop(e,t){const n=this.isDragging;if(this.cancel(),!n)return;const{velocity:r}=t;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&dW.postRender((()=>i(e,t)))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,n){const{drag:r}=this.getProps();if(!n||!Pq(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let a=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(a=function(e,t,n){let{min:r,max:i}=t;return void 0!==r&&e<r?e=n?xG(r,e,n.min):Math.max(e,r):void 0!==i&&e>i&&(e=n?xG(i,e,n.max):Math.min(e,i)),e}(a,this.constraints[e],this.elastic[e])),i.set(a)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):null===(e=this.visualElement.projection)||void 0===e?void 0:e.layout,i=this.constraints;t&&_q(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):this.constraints=!(!t||!r)&&function(e,t){let{top:n,left:r,bottom:i,right:a}=t;return{x:Nq(e.x,r,a),y:Nq(e.y,n,i)}}(r.layoutBox,t),this.elastic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kq;return!1===e?e=0:!0===e&&(e=kq),{x:Dq(e,"left","right"),y:Dq(e,"top","bottom")}}(n),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&rq((e=>{!1!==this.constraints&&this.getAxisMotionValue(e)&&(this.constraints[e]=function(e,t){const n={};return void 0!==t.min&&(n.min=t.min-e.min),void 0!==t.max&&(n.max=t.max-e.min),n}(r.layoutBox[e],this.constraints[e]))}))}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!_q(e))return!1;const n=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=function(e,t,n){const r=yq(e,n),{scroll:i}=t;return i&&(mq(r.x,i.offset.x),mq(r.y,i.offset.y)),r}(n,r.root,this.visualElement.getTransformPagePoint());let a=function(e,t){return{x:Aq(e.x,t.x),y:Aq(e.y,t.y)}}(r.layout.layoutBox,i);if(t){const e=t(function(e){let{x:t,y:n}=e;return{top:n.min,right:t.max,bottom:n.max,left:t.min}}(a));this.hasMutatedConstraints=!!e,e&&(a=XY(e))}return a}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:r,dragTransition:i,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),s=this.constraints||{},c=rq((o=>{if(!Pq(o,t,this.currentDirection))return;let c=s&&s[o]||{};a&&(c={min:0,max:0});const u=r?200:1e6,l=r?40:1e7,f=d(d({type:"inertia",velocity:n?e[o]:0,bounceStiffness:u,bounceDamping:l,timeConstant:750,restDelta:1,restSpeed:10},i),c);return this.startAxisValueAnimation(o,f)}));return Promise.all(c).then(o)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return MW(this.visualElement,e),n.start(_Y(e,n,0,t,this.visualElement,!1))}stopAnimation(){rq((e=>this.getAxisMotionValue(e).stop()))}pauseAnimation(){rq((e=>{var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.pause()}))}getAnimationState(e){var t;return null===(t=this.getAxisMotionValue(e).animation)||void 0===t?void 0:t.state}getAxisMotionValue(e){const t="_drag".concat(e.toUpperCase()),n=this.visualElement.getProps(),r=n[t];return r||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){rq((t=>{const{drag:n}=this.getProps();if(!Pq(t,n,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(t);if(r&&r.layout){const{min:n,max:a}=r.layout.layoutBox[t];i.set(e[t]-xG(n,a,.5))}}))}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!_q(t)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};rq((e=>{const t=this.getAxisMotionValue(e);if(t&&!1!==this.constraints){const n=t.get();r[e]=function(e,t){let n=.5;const r=QY(e),i=QY(t);return i>r?n=mH(t.min,t.max-r,e.min):r>i&&(n=mH(e.min,e.max-i,t.min)),UW(0,1,n)}({min:n,max:n},this.constraints[e])}}));const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),rq((t=>{if(!Pq(t,e,null))return;const n=this.getAxisMotionValue(t),{min:i,max:a}=this.constraints[t];n.set(xG(i,a,r[t]))}))}addListeners(){if(!this.visualElement.current)return;Lq.set(this.visualElement,this);const e=KY(this.visualElement.current,"pointerdown",(e=>{const{drag:t,dragListener:n=!0}=this.getProps();t&&n&&this.start(e)})),t=()=>{const{dragConstraints:e}=this.getProps();_q(e)&&e.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,r=n.addEventListener("measure",t);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),dW.read(t);const i=HY(window,"resize",(()=>this.scalePositionWithinConstraints())),a=n.addEventListener("didUpdate",(e=>{let{delta:t,hasLayoutChanged:n}=e;this.isDragging&&n&&(rq((e=>{const n=this.getAxisMotionValue(e);n&&(this.originPoint[e]+=t[e].translate,n.set(n.get()+t[e].translate))})),this.visualElement.render())}));return()=>{i(),e(),r(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:a=kq,dragMomentum:o=!0}=e;return d(d({},e),{},{drag:t,dragDirectionLock:n,dragPropagation:r,dragConstraints:i,dragElastic:a,dragMomentum:o})}}function Pq(e,t,n){return(!0===t||t===e)&&(null===n||n===e)}const jq=e=>(t,n)=>{e&&dW.postRender((()=>e(t,n)))};const{schedule:Fq,cancel:Uq}=lW(queueMicrotask,!1),Bq=(0,a.createContext)({}),Vq={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function zq(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Wq={correct:(e,t)=>{if(!t.target)return e;if("string"===typeof e){if(!cG.test(e))return e;e=parseFloat(e)}const n=zq(e,t.target.x),r=zq(e,t.target.y);return"".concat(n,"% ").concat(r,"%")}},Gq={correct:(e,t)=>{let{treeScale:n,projectionDelta:r}=t;const i=e,a=EG.parse(e);if(a.length>5)return i;const o=EG.createTransformer(e),s="number"!==typeof a[0]?1:0,c=r.x.scale*n.x,u=r.y.scale*n.y;a[0+s]/=c,a[1+s]/=u;const l=xG(c,u,.5);return"number"===typeof a[2+s]&&(a[2+s]/=l),"number"===typeof a[3+s]&&(a[3+s]/=l),o(a)}},Hq={};class Yq extends a.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:r}=this.props,{projection:i}=e;!function(e){for(const t in e)Hq[t]=e[t],GW(t)&&(Hq[t].isCSSVariable=!0)}(Kq),i&&(t.group&&t.group.add(i),n&&n.register&&r&&n.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",(()=>{this.safeToRemove()})),i.setOptions(d(d({},i.options),{},{onExitComplete:()=>this.safeToRemove()}))),Vq.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:r,isPresent:i}=this.props,{projection:a}=n;return a?(a.isPresent=i,r||e.layoutDependency!==t||void 0===t||e.isPresent!==i?a.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?a.promote():a.relegate()||dW.postRender((()=>{const e=a.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Fq.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function qq(e){const[t,n]=Qz(),r=(0,a.useContext)(Fz);return(0,kt.jsx)(Yq,d(d({},e),{},{layoutGroup:r,switchLayoutGroup:(0,a.useContext)(Bq),isPresent:t,safeToRemove:n}))}const Kq={borderRadius:d(d({},Wq),{},{applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]}),borderTopLeftRadius:Wq,borderTopRightRadius:Wq,borderBottomLeftRadius:Wq,borderBottomRightRadius:Wq,boxShadow:Gq};function Xq(e){return Wz(e)&&"ownerSVGElement"in e}const Qq=(e,t)=>e.depth-t.depth;class Jq{constructor(){this.children=[],this.isDirty=!1}add(e){yW(this.children,e),this.isDirty=!0}remove(e){bW(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Qq),this.isDirty=!1,this.children.forEach(e)}}function Zq(e,t){const n=CW.now(),r=i=>{let{timestamp:a}=i;const o=a-n;o>=t&&(fW(r),e(o-t))};return dW.setup(r,!0),()=>fW(r)}function $q(e){return DW(e)?e.get():e}const eK=["TopLeft","TopRight","BottomLeft","BottomRight"],tK=eK.length,nK=e=>"string"===typeof e?parseFloat(e):e,rK=e=>"number"===typeof e||cG.test(e);function iK(e,t){return void 0!==e[t]?e[t]:e.borderRadius}const aK=sK(0,.5,lH),oK=sK(.5,.95,oW);function sK(e,t,n){return r=>r<e?0:r>t?1:n(mH(e,t,r))}function cK(e,t){e.min=t.min,e.max=t.max}function uK(e,t){cK(e.x,t.x),cK(e.y,t.y)}function lK(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function dK(e,t,n,r,i){return e=uq(e-=t,1/n,r),void 0!==i&&(e=uq(e,1/i,r)),e}function fK(e,t,n,r,i){let[a,o,s]=n;!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e;sG.test(t)&&(t=parseFloat(t),t=xG(o.min,o.max,t/100)-o.min);if("number"!==typeof t)return;let s=xG(a.min,a.max,r);e===a&&(s-=t),e.min=dK(e.min,t,n,s,i),e.max=dK(e.max,t,n,s,i)}(e,t[a],t[o],t[s],t.scale,r,i)}const hK=["x","scaleX","originX"],pK=["y","scaleY","originY"];function mK(e,t,n,r){fK(e.x,t,hK,n?n.x:void 0,r?r.x:void 0),fK(e.y,t,pK,n?n.y:void 0,r?r.y:void 0)}function gK(e){return 0===e.translate&&1===e.scale}function vK(e){return gK(e.x)&&gK(e.y)}function yK(e,t){return e.min===t.min&&e.max===t.max}function bK(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function _K(e,t){return bK(e.x,t.x)&&bK(e.y,t.y)}function wK(e){return QY(e.x)/QY(e.y)}function EK(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class SK{constructor(){this.members=[]}add(e){yW(this.members,e),e.scheduleRender()}remove(e){if(bW(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const e=this.members[this.members.length-1];e&&this.promote(e)}}relegate(e){const t=this.members.findIndex((t=>e===t));if(0===t)return!1;let n;for(let r=t;r>=0;r--){const e=this.members[r];if(!1!==e.isPresent){n=e;break}}return!!n&&(this.promote(n),!0)}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;!1===r&&n.hide()}}exitAnimationComplete(){this.members.forEach((e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()}))}scheduleRender(){this.members.forEach((e=>{e.instance&&e.scheduleRender(!1)}))}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const CK={nodes:0,calculatedTargetDeltas:0,calculatedProjections:0},xK=["","X","Y","Z"],TK={visibility:"hidden"};let RK=0;function IK(e,t,n,r){const{latestValues:i}=t;i[e]&&(n[e]=i[e],t.setStaticValue(e,0),r&&(r[e]=0))}function NK(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=PW(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:t,layoutId:r}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",dW,!(t||r))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&NK(r)}function AK(e){let{attachResizeListener:t,defaultParent:n,measureScroll:r,checkIsScrollRoot:i,resetTransform:a}=e;return class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===n||void 0===n?void 0:n();this.id=RK++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,uW.value&&(CK.nodes=CK.calculatedTargetDeltas=CK.calculatedProjections=0),this.nodes.forEach(MK),this.nodes.forEach(BK),this.nodes.forEach(VK),this.nodes.forEach(LK),uW.addProjectionMetrics&&uW.addProjectionMetrics(CK)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=e,this.root=t?t.root||t:this,this.path=t?[...t.path,t]:[],this.parent=t,this.depth=t?t.depth+1:0;for(let n=0;n<this.path.length;n++)this.path[n].shouldResetTransform=!0;this.root===this&&(this.nodes=new Jq)}addEventListener(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new _W),this.eventHandlers.get(e).add(t)}notifyListeners(e){const t=this.eventHandlers.get(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t&&t.notify(...r)}hasListeners(e){return this.eventHandlers.has(e)}mount(e){if(this.instance)return;var n;this.isSVG=Xq(e)&&!(Xq(n=e)&&"svg"===n.tagName),this.instance=e;const{layoutId:r,layout:i,visualElement:a}=this.options;if(a&&!a.current&&a.mount(e),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(i||r)&&(this.isLayoutDirty=!0),t){let n;const r=()=>this.root.updateBlockedByResize=!1;t(e,(()=>{this.root.updateBlockedByResize=!0,n&&n(),n=Zq(r,250),Vq.hasAnimatedSinceResize&&(Vq.hasAnimatedSinceResize=!1,this.nodes.forEach(UK))}))}r&&this.root.registerSharedNode(r,this),!1!==this.options.animate&&a&&(r||i)&&this.addEventListener("didUpdate",(e=>{let{delta:t,hasLayoutChanged:n,hasRelativeLayoutChanged:r,layout:i}=e;if(this.isTreeAnimationBlocked())return this.target=void 0,void(this.relativeTarget=void 0);const o=this.options.transition||a.getDefaultTransition()||qK,{onLayoutAnimationStart:s,onLayoutAnimationComplete:c}=a.getProps(),u=!this.targetLayout||!_K(this.targetLayout,i),l=!n&&r;if(this.options.layoutRoot||this.resumeFrom||l||n&&(u||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const e=d(d({},aW(o,"layout")),{},{onPlay:s,onComplete:c});(a.shouldReduceMotion||this.options.layoutRoot)&&(e.delay=0,e.type=!1),this.startAnimation(e),this.setAnimationOrigin(t,l)}else n||UK(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=i}))}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const e=this.getStack();e&&e.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),fW(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(zK),this.animationId++)}getTransformTemplate(){const{visualElement:e}=this.options;return e&&e.getProps().transformTemplate}willUpdate(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked())return void(this.options.onExitComplete&&this.options.onExitComplete());if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&NK(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let i=0;i<this.path.length;i++){const e=this.path[i];e.shouldResetTransform=!0,e.updateScroll("snapshot"),e.options.layoutRoot&&e.willUpdate(!1)}const{layoutId:t,layout:n}=this.options;if(void 0===t&&!n)return;const r=this.getTransformTemplate();this.prevTransformTemplateValue=r?r(this.latestValues,""):void 0,this.updateSnapshot(),e&&this.notifyListeners("willUpdate")}update(){this.updateScheduled=!1;if(this.isUpdateBlocked())return this.unblockUpdate(),this.clearAllSnapshots(),void this.nodes.forEach(PK);this.isUpdating||this.nodes.forEach(jK),this.isUpdating=!1,this.nodes.forEach(FK),this.nodes.forEach(kK),this.nodes.forEach(DK),this.clearAllSnapshots();const e=CW.now();hW.delta=UW(0,1e3/60,e-hW.timestamp),hW.timestamp=e,hW.isProcessing=!0,pW.update.process(hW),pW.preRender.process(hW),pW.render.process(hW),hW.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Fq.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(OK),this.sharedNodes.forEach(WK)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,dW.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){dW.postRender((()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()}))}updateSnapshot(){!this.snapshot&&this.instance&&(this.snapshot=this.measure(),!this.snapshot||QY(this.snapshot.measuredBox.x)||QY(this.snapshot.measuredBox.y)||(this.snapshot=void 0))}updateLayout(){if(!this.instance)return;if(this.updateScroll(),(!this.options.alwaysMeasureLayout||!this.isLead())&&!this.isLayoutDirty)return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let n=0;n<this.path.length;n++){this.path[n].updateScroll()}const e=this.layout;this.layout=this.measure(!1),this.layoutCorrected={x:{min:0,max:0},y:{min:0,max:0}},this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:t}=this.options;t&&t.notify("LayoutMeasure",this.layout.layoutBox,e?e.layoutBox:void 0)}updateScroll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"measure",t=Boolean(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===e&&(t=!1),t&&this.instance){const t=i(this.instance);this.scroll={animationId:this.root.animationId,phase:e,isRoot:t,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:t}}}resetTransform(){if(!a)return;const e=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,t=this.projectionDelta&&!vK(this.projectionDelta),n=this.getTransformTemplate(),r=n?n(this.latestValues,""):void 0,i=r!==this.prevTransformTemplateValue;e&&this.instance&&(t||oq(this.latestValues)||i)&&(a(this.instance,r),this.shouldResetTransform=!1,this.scheduleRender())}measure(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.measurePageBox();let n=this.removeElementScroll(t);var r;return e&&(n=this.removeTransform(n)),QK((r=n).x),QK(r.y),{animationId:this.root.animationId,measuredBox:t,layoutBox:n,latestValues:{},source:this.id}}measurePageBox(){var e;const{visualElement:t}=this.options;if(!t)return{x:{min:0,max:0},y:{min:0,max:0}};const n=t.measureViewportBox();if(!((null===(e=this.scroll)||void 0===e?void 0:e.wasRoot)||this.path.some(ZK))){const{scroll:e}=this.root;e&&(mq(n.x,e.offset.x),mq(n.y,e.offset.y))}return n}removeElementScroll(e){var t;const n={x:{min:0,max:0},y:{min:0,max:0}};if(uK(n,e),null!==(t=this.scroll)&&void 0!==t&&t.wasRoot)return n;for(let r=0;r<this.path.length;r++){const t=this.path[r],{scroll:i,options:a}=t;t!==this.root&&i&&a.layoutScroll&&(i.wasRoot&&uK(n,e),mq(n.x,i.offset.x),mq(n.y,i.offset.y))}return n}applyTransform(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={x:{min:0,max:0},y:{min:0,max:0}};uK(n,e);for(let r=0;r<this.path.length;r++){const e=this.path[r];!t&&e.options.layoutScroll&&e.scroll&&e!==e.root&&vq(n,{x:-e.scroll.offset.x,y:-e.scroll.offset.y}),oq(e.latestValues)&&vq(n,e.latestValues)}return oq(this.latestValues)&&vq(n,this.latestValues),n}removeTransform(e){const t={x:{min:0,max:0},y:{min:0,max:0}};uK(t,e);for(let n=0;n<this.path.length;n++){const e=this.path[n];if(!e.instance)continue;if(!oq(e.latestValues))continue;aq(e.latestValues)&&e.updateSnapshot();const r={x:{min:0,max:0},y:{min:0,max:0}};uK(r,e.measurePageBox()),mK(t,e.latestValues,e.snapshot?e.snapshot.layoutBox:void 0,r)}return oq(this.latestValues)&&mK(t,this.latestValues),t}setTargetDelta(e){this.targetDelta=e,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(e){this.options=d(d(d({},this.options),e),{},{crossfade:void 0===e.crossfade||e.crossfade})}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==hW.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const r=Boolean(this.resumingFrom)||this!==n;if(!(t||r&&this.isSharedProjectionDirty||this.isProjectionDirty||null!==(e=this.parent)&&void 0!==e&&e.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:i,layoutId:a}=this.options;if(this.layout&&(i||a)){if(this.resolvedRelativeTargetAt=hW.timestamp,!this.targetDelta&&!this.relativeTarget){const e=this.getClosestProjectingParent();e&&e.layout&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},tq(this.relativeTargetOrigin,this.layout.layoutBox,e.layout.layoutBox),uK(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(this.relativeTarget||this.targetDelta){var o,s,c;if(this.target||(this.target={x:{min:0,max:0},y:{min:0,max:0}},this.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}}),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),o=this.target,s=this.relativeTarget,c=this.relativeParent.target,$Y(o.x,s.x,c.x),$Y(o.y,s.y,c.y)):this.targetDelta?(Boolean(this.resumingFrom)?this.target=this.applyTransform(this.layout.layoutBox):uK(this.target,this.layout.layoutBox),fq(this.target,this.targetDelta)):uK(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const e=this.getClosestProjectingParent();e&&Boolean(e.resumingFrom)===Boolean(this.resumingFrom)&&!e.options.layoutScroll&&e.target&&1!==this.animationProgress?(this.relativeParent=e,this.forceRelativeParentToResolveTarget(),this.relativeTarget={x:{min:0,max:0},y:{min:0,max:0}},this.relativeTargetOrigin={x:{min:0,max:0},y:{min:0,max:0}},tq(this.relativeTargetOrigin,this.target,e.target),uK(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}uW.value&&CK.calculatedTargetDeltas++}}}getClosestProjectingParent(){if(this.parent&&!aq(this.parent.latestValues)&&!sq(this.parent.latestValues))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return Boolean((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var e;const t=this.getLead(),n=Boolean(this.resumingFrom)||this!==t;let r=!0;if((this.isProjectionDirty||null!==(e=this.parent)&&void 0!==e&&e.isProjectionDirty)&&(r=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(r=!1),this.resolvedRelativeTargetAt===hW.timestamp&&(r=!1),r)return;const{layout:i,layoutId:a}=this.options;if(this.isTreeAnimating=Boolean(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!i&&!a)return;uK(this.layoutCorrected,this.layout.layoutBox);const o=this.treeScale.x,s=this.treeScale.y;!function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=n.length;if(!i)return;let a,o;t.x=t.y=1;for(let s=0;s<i;s++){a=n[s],o=a.projectionDelta;const{visualElement:i}=a.options;i&&i.props.style&&"contents"===i.props.style.display||(r&&a.options.layoutScroll&&a.scroll&&a!==a.root&&vq(e,{x:-a.scroll.offset.x,y:-a.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,fq(e,o)),r&&oq(a.latestValues)&&vq(e,a.latestValues))}t.x<pq&&t.x>hq&&(t.x=1),t.y<pq&&t.y>hq&&(t.y=1)}(this.layoutCorrected,this.treeScale,this.path,n),!t.layout||t.target||1===this.treeScale.x&&1===this.treeScale.y||(t.target=t.layout.layoutBox,t.targetWithTransforms={x:{min:0,max:0},y:{min:0,max:0}});const{target:c}=t;c?(this.projectionDelta&&this.prevProjectionDelta?(lK(this.prevProjectionDelta.x,this.projectionDelta.x),lK(this.prevProjectionDelta.y,this.projectionDelta.y)):this.createProjectionDeltas(),ZY(this.projectionDelta,this.layoutCorrected,c,this.latestValues),this.treeScale.x===o&&this.treeScale.y===s&&EK(this.projectionDelta.x,this.prevProjectionDelta.x)&&EK(this.projectionDelta.y,this.prevProjectionDelta.y)||(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",c)),uW.value&&CK.calculatedProjections++):this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender())}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(){var e;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(null===(e=this.options.visualElement)||void 0===e||e.scheduleRender(),t){const e=this.getStack();e&&e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDelta={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}},this.projectionDeltaWithTransform={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}}}setAnimationOrigin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.snapshot,r=n?n.latestValues:{},i=d({},this.latestValues),a={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};this.relativeParent&&this.relativeParent.options.layoutRoot||(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!t;const o={x:{min:0,max:0},y:{min:0,max:0}},s=(n?n.source:void 0)!==(this.layout?this.layout.source:void 0),c=this.getStack(),u=!c||c.members.length<=1,l=Boolean(s&&!u&&!0===this.options.crossfade&&!this.path.some(YK));let f;this.animationProgress=0,this.mixTargetDelta=t=>{const n=t/1e3;GK(a.x,e.x,n),GK(a.y,e.y,n),this.setTargetDelta(a),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(tq(o,this.layout.layoutBox,this.relativeParent.layout.layoutBox),function(e,t,n,r){HK(e.x,t.x,n.x,r),HK(e.y,t.y,n.y,r)}(this.relativeTarget,this.relativeTargetOrigin,o,n),f&&function(e,t){return yK(e.x,t.x)&&yK(e.y,t.y)}(this.relativeTarget,f)&&(this.isProjectionDirty=!1),f||(f={x:{min:0,max:0},y:{min:0,max:0}}),uK(f,this.relativeTarget)),s&&(this.animationValues=i,function(e,t,n,r,i,a){var o,s;if(i)e.opacity=xG(0,null!==(o=n.opacity)&&void 0!==o?o:1,aK(r)),e.opacityExit=xG(null!==(s=t.opacity)&&void 0!==s?s:1,0,oK(r));else if(a){var c,u;e.opacity=xG(null!==(c=t.opacity)&&void 0!==c?c:1,null!==(u=n.opacity)&&void 0!==u?u:1,r)}for(let l=0;l<tK;l++){const i="border".concat(eK[l],"Radius");let a=iK(t,i),o=iK(n,i);void 0===a&&void 0===o||(a||(a=0),o||(o=0),0===a||0===o||rK(a)===rK(o)?(e[i]=Math.max(xG(nK(a),nK(o),r),0),(sG.test(o)||sG.test(a))&&(e[i]+="%")):e[i]=o)}(t.rotate||n.rotate)&&(e.rotate=xG(t.rotate||0,n.rotate||0,r))}(i,r,this.latestValues,n,l,u)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=n},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(e){var t,n;this.notifyListeners("animationStart"),null===(t=this.currentAnimation)||void 0===t||t.stop(),null===(n=this.resumingFrom)||void 0===n||null===(n=n.currentAnimation)||void 0===n||n.stop(),this.pendingAnimation&&(fW(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=dW.update((()=>{Vq.hasAnimatedSinceResize=!0,zW.layout++,this.motionValue||(this.motionValue=RW(0)),this.currentAnimation=function(e,t,n){const r=DW(e)?e:RW(e);return r.start(_Y("",r,t,n)),r.animation}(this.motionValue,[0,1e3],d(d({},e),{},{isSync:!0,onUpdate:t=>{this.mixTargetDelta(t),e.onUpdate&&e.onUpdate(t)},onStop:()=>{zW.layout--},onComplete:()=>{zW.layout--,e.onComplete&&e.onComplete(),this.completeAnimation()}})),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0}))}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const e=this.getStack();e&&e.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(1e3),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const e=this.getLead();let{targetWithTransforms:t,target:n,layout:r,latestValues:i}=e;if(t&&n&&r){if(this!==e&&this.layout&&r&&JK(this.options.animationType,this.layout.layoutBox,r.layoutBox)){n=this.target||{x:{min:0,max:0},y:{min:0,max:0}};const t=QY(this.layout.layoutBox.x);n.x.min=e.target.x.min,n.x.max=n.x.min+t;const r=QY(this.layout.layoutBox.y);n.y.min=e.target.y.min,n.y.max=n.y.min+r}uK(t,n),vq(t,i),ZY(this.projectionDeltaWithTransform,this.layoutCorrected,t,i)}}registerSharedNode(e,t){this.sharedNodes.has(e)||this.sharedNodes.set(e,new SK);this.sharedNodes.get(e).add(t);const n=t.options.initialPromotionConfig;t.promote({transition:n?n.transition:void 0,preserveFollowOpacity:n&&n.shouldPreserveFollowOpacity?n.shouldPreserveFollowOpacity(t):void 0})}isLead(){const e=this.getStack();return!e||e.lead===this}getLead(){var e;const{layoutId:t}=this.options;return t&&(null===(e=this.getStack())||void 0===e?void 0:e.lead)||this}getPrevLead(){var e;const{layoutId:t}=this.options;return t?null===(e=this.getStack())||void 0===e?void 0:e.prevLead:void 0}getStack(){const{layoutId:e}=this.options;if(e)return this.root.sharedNodes.get(e)}promote(){let{needsReset:e,transition:t,preserveFollowOpacity:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=this.getStack();r&&r.promote(this,n),e&&(this.projectionDelta=void 0,this.needsReset=!0),t&&this.setOptions({transition:t})}relegate(){const e=this.getStack();return!!e&&e.relegate(this)}resetSkewAndRotation(){const{visualElement:e}=this.options;if(!e)return;let t=!1;const{latestValues:n}=e;if((n.z||n.rotate||n.rotateX||n.rotateY||n.rotateZ||n.skewX||n.skewY)&&(t=!0),!t)return;const r={};n.z&&IK("z",e,r,this.animationValues);for(let i=0;i<xK.length;i++)IK("rotate".concat(xK[i]),e,r,this.animationValues),IK("skew".concat(xK[i]),e,r,this.animationValues);e.render();for(const i in r)e.setStaticValue(i,r[i]),this.animationValues&&(this.animationValues[i]=r[i]);e.scheduleRender()}getProjectionStyles(e){if(!this.instance||this.isSVG)return;if(!this.isVisible)return TK;const t={visibility:""},n=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,t.opacity="",t.pointerEvents=$q(null===e||void 0===e?void 0:e.pointerEvents)||"",t.transform=n?n(this.latestValues,""):"none",t;const r=this.getLead();if(!this.projectionDelta||!this.layout||!r.target){const t={};return this.options.layoutId&&(t.opacity=void 0!==this.latestValues.opacity?this.latestValues.opacity:1,t.pointerEvents=$q(null===e||void 0===e?void 0:e.pointerEvents)||""),this.hasProjected&&!oq(this.latestValues)&&(t.transform=n?n({},""):"none",this.hasProjected=!1),t}const i=r.animationValues||r.latestValues;this.applyTransformsToTarget(),t.transform=function(e,t,n){let r="";const i=e.x.translate/t.x,a=e.y.translate/t.y,o=(null===n||void 0===n?void 0:n.z)||0;if((i||a||o)&&(r="translate3d(".concat(i,"px, ").concat(a,"px, ").concat(o,"px) ")),1===t.x&&1===t.y||(r+="scale(".concat(1/t.x,", ").concat(1/t.y,") ")),n){const{transformPerspective:e,rotate:t,rotateX:i,rotateY:a,skewX:o,skewY:s}=n;e&&(r="perspective(".concat(e,"px) ").concat(r)),t&&(r+="rotate(".concat(t,"deg) ")),i&&(r+="rotateX(".concat(i,"deg) ")),a&&(r+="rotateY(".concat(a,"deg) ")),o&&(r+="skewX(".concat(o,"deg) ")),s&&(r+="skewY(".concat(s,"deg) "))}const s=e.x.scale*t.x,c=e.y.scale*t.y;return 1===s&&1===c||(r+="scale(".concat(s,", ").concat(c,")")),r||"none"}(this.projectionDeltaWithTransform,this.treeScale,i),n&&(t.transform=n(i,t.transform));const{x:a,y:o}=this.projectionDelta;var s,c;(t.transformOrigin="".concat(100*a.origin,"% ").concat(100*o.origin,"% 0"),r.animationValues)?t.opacity=r===this?null!==(s=null!==(c=i.opacity)&&void 0!==c?c:this.latestValues.opacity)&&void 0!==s?s:1:this.preserveOpacity?this.latestValues.opacity:i.opacityExit:t.opacity=r===this?void 0!==i.opacity?i.opacity:"":void 0!==i.opacityExit?i.opacityExit:0;for(const u in Hq){if(void 0===i[u])continue;const{correct:e,applyTo:n,isCSSVariable:a}=Hq[u],o="none"===t.transform?i[u]:e(i[u],r);if(n){const e=n.length;for(let r=0;r<e;r++)t[n[r]]=o}else a?this.options.visualElement.renderState.vars[u]=o:t[u]=o}return this.options.layoutId&&(t.pointerEvents=r===this?$q(null===e||void 0===e?void 0:e.pointerEvents)||"":"none"),t}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach((e=>{var t;return null===(t=e.currentAnimation)||void 0===t?void 0:t.stop()})),this.root.nodes.forEach(PK),this.root.sharedNodes.clear()}}}function kK(e){e.updateLayout()}function DK(e){var t;const n=(null===(t=e.resumeFrom)||void 0===t?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:r}=e.layout,{animationType:i}=e.options,a=n.source!==e.layout.source;"size"===i?rq((e=>{const r=a?n.measuredBox[e]:n.layoutBox[e],i=QY(r);r.min=t[e].min,r.max=r.min+i})):JK(i,n.layoutBox,t)&&rq((r=>{const i=a?n.measuredBox[r]:n.layoutBox[r],o=QY(t[r]);i.max=i.min+o,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[r].max=e.relativeTarget[r].min+o)}));const o={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};ZY(o,t,n.layoutBox);const s={x:{translate:0,scale:1,origin:0,originPoint:0},y:{translate:0,scale:1,origin:0,originPoint:0}};a?ZY(s,e.applyTransform(r,!0),n.measuredBox):ZY(s,t,n.layoutBox);const c=!vK(o);let u=!1;if(!e.resumeFrom){const r=e.getClosestProjectingParent();if(r&&!r.resumeFrom){const{snapshot:i,layout:a}=r;if(i&&a){const o={x:{min:0,max:0},y:{min:0,max:0}};tq(o,n.layoutBox,i.layoutBox);const s={x:{min:0,max:0},y:{min:0,max:0}};tq(s,t,a.layoutBox),_K(o,s)||(u=!0),r.options.layoutRoot&&(e.relativeTarget=s,e.relativeTargetOrigin=o,e.relativeParent=r)}}}e.notifyListeners("didUpdate",{layout:t,snapshot:n,delta:s,layoutDelta:o,hasLayoutChanged:c,hasRelativeLayoutChanged:u})}else if(e.isLead()){const{onExitComplete:t}=e.options;t&&t()}e.options.transition=void 0}function MK(e){uW.value&&CK.nodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=Boolean(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function LK(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function OK(e){e.clearSnapshot()}function PK(e){e.clearMeasurements()}function jK(e){e.isLayoutDirty=!1}function FK(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function UK(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function BK(e){e.resolveTargetDelta()}function VK(e){e.calcProjection()}function zK(e){e.resetSkewAndRotation()}function WK(e){e.removeLeadSnapshot()}function GK(e,t,n){e.translate=xG(t.translate,0,n),e.scale=xG(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function HK(e,t,n,r){e.min=xG(t.min,n.min,r),e.max=xG(t.max,n.max,r)}function YK(e){return e.animationValues&&void 0!==e.animationValues.opacityExit}const qK={duration:.45,ease:[.4,0,.1,1]},KK=e=>"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),XK=KK("applewebkit/")&&!KK("chrome/")?Math.round:oW;function QK(e){e.min=XK(e.min),e.max=XK(e.max)}function JK(e,t,n){return"position"===e||"preserve-aspect"===e&&!function(e,t,n){return Math.abs(e-t)<=n}(wK(t),wK(n),.2)}function ZK(e){var t;return e!==e.root&&(null===(t=e.scroll)||void 0===t?void 0:t.wasRoot)}const $K=AK({attachResizeListener:(e,t)=>HY(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),eX={current:void 0},tX=AK({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!eX.current){const e=new $K({});e.mount(window),e.setOptions({layoutScroll:!0}),eX.current=e}return eX.current},resetTransform:(e,t)=>{e.style.transform=void 0!==t?t:"none"},checkIsScrollRoot:e=>Boolean("fixed"===window.getComputedStyle(e).position)}),nX={pan:{Feature:class extends BY{constructor(){super(...arguments),this.removePointerDownListener=oW}onPointerDown(e){this.session=new Eq(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:bq(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:jq(e),onStart:jq(t),onMove:n,onEnd:(e,t)=>{delete this.session,r&&dW.postRender((()=>r(e,t)))}}}mount(){this.removePointerDownListener=KY(this.node.current,"pointerdown",(e=>this.onPointerDown(e)))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}},drag:{Feature:class extends BY{constructor(e){super(e),this.removeGroupControls=oW,this.removeListeners=oW,this.controls=new Oq(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||oW}unmount(){this.removeGroupControls(),this.removeListeners()}},ProjectionNode:tX,MeasureLayout:qq}};function rX(e,t){const n=function(e,t,n){if(e instanceof EventTarget)return[e];if("string"===typeof e){var r;let i=document;t&&(i=t.current);const a=null!==(r=null===n||void 0===n?void 0:n[e])&&void 0!==r?r:i.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e)}(e),r=new AbortController;return[n,d(d({passive:!0},t),{},{signal:r.signal}),()=>r.abort()]}function iX(e){return!("touch"===e.pointerType||GY())}function aX(e,t,n){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover","Start"===n);const i=r["onHover"+n];i&&dW.postRender((()=>i(t,qY(t))))}const oX=(e,t)=>!!t&&(e===t||oX(e,t.parentElement)),sX=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);const cX=new WeakSet;function uX(e){return t=>{"Enter"===t.key&&e(t)}}function lX(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}function dX(e){return YY(e)&&!GY()}function fX(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[r,i,a]=rX(e,n),o=e=>{const r=e.currentTarget;if(!dX(e))return;cX.add(r);const a=t(r,e),o=(e,t)=>{window.removeEventListener("pointerup",s),window.removeEventListener("pointercancel",c),cX.has(r)&&cX.delete(r),dX(e)&&"function"===typeof a&&a(e,{success:t})},s=e=>{o(e,r===window||r===document||n.useGlobalTarget||oX(r,e.target))},c=e=>{o(e,!1)};window.addEventListener("pointerup",s,i),window.addEventListener("pointercancel",c,i)};return r.forEach((e=>{var t;(n.useGlobalTarget?window:e).addEventListener("pointerdown",o,i),Gz(e)&&(e.addEventListener("focus",(e=>((e,t)=>{const n=e.currentTarget;if(!n)return;const r=uX((()=>{if(cX.has(n))return;lX(n,"down");const e=uX((()=>{lX(n,"up")}));n.addEventListener("keyup",e,t),n.addEventListener("blur",(()=>lX(n,"cancel")),t)}));n.addEventListener("keydown",r,t),n.addEventListener("blur",(()=>n.removeEventListener("keydown",r)),t)})(e,i))),t=e,sX.has(t.tagName)||-1!==t.tabIndex||e.hasAttribute("tabindex")||(e.tabIndex=0))})),a}function hX(e,t,n){const{props:r}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap","Start"===n);const i=r["onTap"+("End"===n?"":n)];i&&dW.postRender((()=>i(t,qY(t))))}const pX=["root"],mX=new WeakMap,gX=new WeakMap,vX=e=>{const t=mX.get(e.target);t&&t(e)},yX=e=>{e.forEach(vX)};function bX(e,t,n){const r=function(e){let{root:t}=e,n=c(e,pX);const r=t||document;gX.has(r)||gX.set(r,{});const i=gX.get(r),a=JSON.stringify(n);return i[a]||(i[a]=new IntersectionObserver(yX,d({root:t},n))),i[a]}(t);return mX.set(e,n),r.observe(e),()=>{mX.delete(e),r.unobserve(e)}}const _X={some:0,all:1};const wX={inView:{Feature:class extends BY{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:r="some",once:i}=e,a={root:t?t.current:void 0,rootMargin:n,threshold:"number"===typeof r?r:_X[r]};return bX(this.node.current,a,(e=>{const{isIntersecting:t}=e;if(this.isInView===t)return;if(this.isInView=t,i&&!t&&this.hasEnteredView)return;t&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",t);const{onViewportEnter:n,onViewportLeave:r}=this.node.getProps(),a=t?n:r;a&&a(e)}))}mount(){this.startObserver()}update(){if("undefined"===typeof IntersectionObserver)return;const{props:e,prevProps:t}=this.node,n=["amount","margin","root"].some(function(e){let{viewport:t={}}=e,{viewport:n={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=>t[e]!==n[e]}(e,t));n&&this.startObserver()}unmount(){}}},tap:{Feature:class extends BY{mount(){const{current:e}=this.node;e&&(this.unmount=fX(e,((e,t)=>(hX(this.node,t,"Start"),(e,t)=>{let{success:n}=t;return hX(this.node,e,n?"End":"Cancel")})),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}},focus:{Feature:class extends BY{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch(Vc){e=!0}e&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){this.isActive&&this.node.animationState&&(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=FW(HY(this.node.current,"focus",(()=>this.onFocus())),HY(this.node.current,"blur",(()=>this.onBlur())))}unmount(){}}},hover:{Feature:class extends BY{mount(){const{current:e}=this.node;e&&(this.unmount=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const[r,i,a]=rX(e,n),o=e=>{if(!iX(e))return;const{target:n}=e,r=t(n,e);if("function"!==typeof r||!n)return;const a=e=>{iX(e)&&(r(e),n.removeEventListener("pointerleave",a))};n.addEventListener("pointerleave",a,i)};return r.forEach((e=>{e.addEventListener("pointerenter",o,i)})),a}(e,((e,t)=>(aX(this.node,t,"Start"),e=>aX(this.node,e,"End")))))}unmount(){}}}},EX={layout:{ProjectionNode:tX,MeasureLayout:qq}},SX=(0,a.createContext)({strict:!1}),CX=(0,a.createContext)({});function xX(e){return tW(e.animate)||NY.some((t=>RY(e[t])))}function TX(e){return Boolean(xX(e)||e.variants)}function RX(e){const{initial:t,animate:n}=function(e,t){if(xX(e)){const{initial:t,animate:n}=e;return{initial:!1===t||RY(t)?t:void 0,animate:RY(n)?n:void 0}}return!1!==e.inherit?t:{}}(e,(0,a.useContext)(CX));return(0,a.useMemo)((()=>({initial:t,animate:n})),[IX(t),IX(n)])}function IX(e){return Array.isArray(e)?e.join(" "):e}const NX={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},AX={};for(const n in NX)AX[n]={isEnabled:e=>NX[n].some((t=>!!e[t]))};const kX=Symbol.for("motionComponentSymbol");function DX(e,t,n){return(0,a.useCallback)((r=>{r&&e.onMount&&e.onMount(r),t&&(r?t.mount(r):t.unmount()),n&&("function"===typeof n?n(r):_q(n)&&(n.current=r))}),[t])}function MX(e,t,n,r,i){var o,s,c,u;const{visualElement:l}=(0,a.useContext)(CX),d=(0,a.useContext)(SX),f=(0,a.useContext)(zz),h=(0,a.useContext)(Hz).reducedMotion,p=(0,a.useRef)(null);r=r||d.renderer,!p.current&&r&&(p.current=r(e,{visualState:t,parent:l,props:n,presenceContext:f,blockInitialAnimation:!!f&&!1===f.initial,reducedMotionConfig:h}));const m=p.current,g=(0,a.useContext)(Bq);!m||m.projection||!i||"html"!==m.type&&"svg"!==m.type||function(e,t,n,r){const{layoutId:i,layout:a,drag:o,dragConstraints:s,layoutScroll:c,layoutRoot:u,layoutCrossfade:l}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:LX(e.parent)),e.projection.setOptions({layoutId:i,layout:a,alwaysMeasureLayout:Boolean(o)||s&&_q(s),visualElement:e,animationType:"string"===typeof a?a:"both",initialPromotionConfig:r,crossfade:l,layoutScroll:c,layoutRoot:u})}(p.current,n,i,g);const v=(0,a.useRef)(!1);(0,a.useInsertionEffect)((()=>{m&&v.current&&m.update(n,f)}));const y=n[OW],b=(0,a.useRef)(Boolean(y)&&!(null!==(o=(s=window).MotionHandoffIsComplete)&&void 0!==o&&o.call(s,y))&&(null===(c=(u=window).MotionHasOptimisedAnimation)||void 0===c?void 0:c.call(u,y)));return Vz((()=>{m&&(v.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),Fq.render(m.render),b.current&&m.animationState&&m.animationState.animateChanges())})),(0,a.useEffect)((()=>{m&&(!b.current&&m.animationState&&m.animationState.animateChanges(),b.current&&(queueMicrotask((()=>{var e,t;null===(e=(t=window).MotionHandoffMarkAsComplete)||void 0===e||e.call(t,y)})),b.current=!1))})),m}function LX(e){if(e)return!1!==e.options.allowProjection?e.projection:LX(e.parent)}function OX(e){var t,n;let{preloadedFeatures:r,createVisualElement:i,useRender:o,useVisualState:s,Component:c}=e;function u(e,t){let n;const r=d(d(d({},(0,a.useContext)(Hz)),e),{},{layoutId:PX(e)}),{isStatic:u}=r,l=RX(e),f=s(e,u);if(!u&&Bz){!function(){(0,a.useContext)(SX).strict;0}();const e=function(e){const{drag:t,layout:n}=AX;if(!t&&!n)return{};const r=d(d({},t),n);return{MeasureLayout:null!==t&&void 0!==t&&t.isEnabled(e)||null!==n&&void 0!==n&&n.isEnabled(e)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}(r);n=e.MeasureLayout,l.visualElement=MX(c,f,r,i,e.ProjectionNode)}return(0,kt.jsxs)(CX.Provider,{value:l,children:[n&&l.visualElement?(0,kt.jsx)(n,d({visualElement:l.visualElement},r)):null,o(c,e,DX(f,l.visualElement,t),f,u,l.visualElement)]})}r&&function(e){for(const t in e)AX[t]=d(d({},AX[t]),e[t])}(r),u.displayName="motion.".concat("string"===typeof c?c:"create(".concat(null!==(t=null!==(n=c.displayName)&&void 0!==n?n:c.name)&&void 0!==t?t:"",")"));const l=(0,a.forwardRef)(u);return l[kX]=c,l}function PX(e){let{layoutId:t}=e;const n=(0,a.useContext)(Fz).id;return n&&void 0!==t?n+"-"+t:t}function jX(e,t){let{layout:n,layoutId:r}=t;return gW.has(e)||e.startsWith("origin")||(n||void 0!==r)&&(!!Hq[e]||"opacity"===e)}const FX=(e,t)=>t&&"number"===typeof e?t.transform(e):e,UX=d(d({},KW),{},{transform:Math.round}),BX=d(d({borderWidth:cG,borderTopWidth:cG,borderRightWidth:cG,borderBottomWidth:cG,borderLeftWidth:cG,borderRadius:cG,radius:cG,borderTopLeftRadius:cG,borderTopRightRadius:cG,borderBottomRightRadius:cG,borderBottomLeftRadius:cG,width:cG,maxWidth:cG,height:cG,maxHeight:cG,top:cG,right:cG,bottom:cG,left:cG,padding:cG,paddingTop:cG,paddingRight:cG,paddingBottom:cG,paddingLeft:cG,margin:cG,marginTop:cG,marginRight:cG,marginBottom:cG,marginLeft:cG,backgroundPositionX:cG,backgroundPositionY:cG},{rotate:oG,rotateX:oG,rotateY:oG,rotateZ:oG,scale:QW,scaleX:QW,scaleY:QW,scaleZ:QW,skew:oG,skewX:oG,skewY:oG,distance:cG,translateX:cG,translateY:cG,translateZ:cG,x:cG,y:cG,z:cG,perspective:cG,transformPerspective:cG,opacity:XW,originX:dG,originY:dG,originZ:cG}),{},{zIndex:UX,fillOpacity:XW,strokeOpacity:XW,numOctaves:UX}),VX={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},zX=mW.length;function WX(e,t,n){const{style:r,vars:i,transformOrigin:a}=e;let o=!1,s=!1;for(const c in t){const e=t[c];if(gW.has(c))o=!0;else if(GW(c))i[c]=e;else{const t=FX(e,BX[c]);c.startsWith("origin")?(s=!0,a[c]=t):r[c]=t}}if(t.transform||(o||n?r.transform=function(e,t,n){let r="",i=!0;for(let a=0;a<zX;a++){const o=mW[a],s=e[o];if(void 0===s)continue;let c=!0;if(c="number"===typeof s?s===(o.startsWith("scale")?1:0):0===parseFloat(s),!c||n){const e=FX(s,BX[o]);c||(i=!1,r+="".concat(VX[o]||o,"(").concat(e,") ")),n&&(t[o]=e)}}return r=r.trim(),n?r=n(t,i?"":r):i&&(r="none"),r}(t,e.transform,n):r.transform&&(r.transform="none")),s){const{originX:e="50%",originY:t="50%",originZ:n=0}=a;r.transformOrigin="".concat(e," ").concat(t," ").concat(n)}}const GX=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function HX(e,t,n){for(const r in t)DW(t[r])||jX(r,n)||(e[r]=t[r])}function YX(e,t){const n={};return HX(n,e.style||{},e),Object.assign(n,function(e,t){let{transformTemplate:n}=e;return(0,a.useMemo)((()=>{const e={style:{},transform:{},transformOrigin:{},vars:{}};return WX(e,t,n),Object.assign({},e.vars,e.style)}),[t])}(e,t)),n}function qX(e,t){const n={},r=YX(e,t);return e.drag&&!1!==e.dragListener&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=!0===e.drag?"none":"pan-".concat("x"===e.drag?"y":"x")),void 0===e.tabIndex&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=r,n}const KX={offset:"stroke-dashoffset",array:"stroke-dasharray"},XX={offset:"strokeDashoffset",array:"strokeDasharray"};const QX=["attrX","attrY","attrScale","pathLength","pathSpacing","pathOffset"];function JX(e,t,n,r,i){let{attrX:a,attrY:o,attrScale:s,pathLength:u,pathSpacing:l=1,pathOffset:d=0}=t;if(WX(e,c(t,QX),r),n)return void(e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox));e.attrs=e.style,e.style={};const{attrs:f,style:h}=e;var p,m;(f.transform&&(h.transform=f.transform,delete f.transform),h.transform||f.transformOrigin)&&(h.transformOrigin=null!==(p=f.transformOrigin)&&void 0!==p?p:"50% 50%",delete f.transformOrigin);h.transform&&(h.transformBox=null!==(m=null===i||void 0===i?void 0:i.transformBox)&&void 0!==m?m:"fill-box",delete f.transformBox);void 0!==a&&(f.x=a),void 0!==o&&(f.y=o),void 0!==s&&(f.scale=s),void 0!==u&&function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e.pathLength=1;const a=i?KX:XX;e[a.offset]=cG.transform(-r);const o=cG.transform(t),s=cG.transform(n);e[a.array]="".concat(o," ").concat(s)}(f,u,l,d,!1)}const ZX=()=>d(d({},{style:{},transform:{},transformOrigin:{},vars:{}}),{},{attrs:{}}),$X=e=>"string"===typeof e&&"svg"===e.toLowerCase();function eQ(e,t,n,r){const i=(0,a.useMemo)((()=>{const n=ZX();return JX(n,t,$X(r),e.transformTemplate,e.style),d(d({},n.attrs),{},{style:d({},n.style)})}),[t]);if(e.style){const t={};HX(t,e.style,e),i.style=d(d({},t),i.style)}return i}const tQ=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function nQ(e){return e.startsWith("while")||e.startsWith("drag")&&"draggable"!==e||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||tQ.has(e)}let rQ=e=>!nQ(e);try{(iQ=require("@emotion/is-prop-valid").default)&&(rQ=e=>e.startsWith("on")?!nQ(e):iQ(e))}catch(X$){}var iQ;const aQ=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function oQ(e){return"string"===typeof e&&!e.includes("-")&&!!(aQ.indexOf(e)>-1||/[A-Z]/.test(e))}function sQ(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(t,n,r,i,o)=>{let{latestValues:s}=i;const c=(oQ(t)?eQ:qX)(n,s,o,t),u=function(e,t,n){const r={};for(const i in e)"values"===i&&"object"===typeof e.values||(rQ(i)||!0===n&&nQ(i)||!t&&!nQ(i)||e.draggable&&i.startsWith("onDrag"))&&(r[i]=e[i]);return r}(n,"string"===typeof t,e),l=t!==a.Fragment?d(d(d({},u),c),{},{ref:r}):{},{children:f}=n,h=(0,a.useMemo)((()=>DW(f)?f.get():f),[f]);return(0,a.createElement)(t,d(d({},l),{},{children:h}))}}const cQ=["transitionEnd","transition"];const uQ=e=>(t,n)=>{const r=(0,a.useContext)(CX),i=(0,a.useContext)(zz),o=()=>function(e,t,n,r){let{scrapeMotionValuesFromProps:i,createRenderState:a}=e;return{latestValues:lQ(t,n,r,i),renderState:a()}}(e,t,r,i);return n?o():Uz(o)};function lQ(e,t,n,r){const i={},a=r(e,{});for(const c in a)i[c]=$q(a[c]);let{initial:o,animate:s}=e;const u=xX(e),l=TX(e);t&&l&&!u&&!1!==e.inherit&&(void 0===o&&(o=t.initial),void 0===s&&(s=t.animate));let d=!!n&&!1===n.initial;d=d||!1===o;const f=d?s:o;if(f&&"boolean"!==typeof f&&!tW(f)){const t=Array.isArray(f)?f:[f];for(let n=0;n<t.length;n++){const r=rW(e,t[n]);if(r){const{transitionEnd:e,transition:t}=r,n=c(r,cQ);for(const r in n){let e=n[r];if(Array.isArray(e)){e=e[d?e.length-1:0]}null!==e&&(i[r]=e)}for(const r in e)i[r]=e[r]}}}return i}function dQ(e,t,n){const{style:r}=e,i={};for(const o in r){var a;(DW(r[o])||t.style&&DW(t.style[o])||jX(o,e)||void 0!==(null===n||void 0===n||null===(a=n.getValue(o))||void 0===a?void 0:a.liveStyle))&&(i[o]=r[o])}return i}const fQ={useVisualState:uQ({scrapeMotionValuesFromProps:dQ,createRenderState:GX})};function hQ(e,t,n){const r=dQ(e,t,n);for(const i in e)if(DW(e[i])||DW(t[i])){r[-1!==mW.indexOf(i)?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i]=e[i]}return r}const pQ={useVisualState:uQ({scrapeMotionValuesFromProps:hQ,createRenderState:ZX})};function mQ(e,t){return function(n){let{forwardMotionProps:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{forwardMotionProps:!1};return OX(d(d({},oQ(n)?pQ:fQ),{},{preloadedFeatures:e,useRender:sQ(r),createVisualElement:t,Component:n}))}}const gQ=e=>t=>t.test(e),vQ=[KW,cG,sG,oG,lG,uG,{test:e=>"auto"===e,parse:e=>e}],yQ=e=>vQ.find(gQ(e)),bQ=e=>/^-?(?:[0-9]+(?:\.[0-9]+)?|\.[0-9]+)$/.test(e),_Q=/^var\(--(?:([\x2D0-9A-Z_a-z]+)|([\x2D0-9A-Z_a-z]+), ?([ #%\(\),-\.0-9A-Za-z]+))\)/;function wQ(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;'Max CSS variable fallback depth detected in property "'.concat(e,'". This may indicate a circular fallback dependency.');const[r,i]=function(e){const t=_Q.exec(e);if(!t)return[,];const[,n,r,i]=t;return["--".concat(null!==n&&void 0!==n?n:r),i]}(e);if(!r)return;const a=window.getComputedStyle(t).getPropertyValue(r);if(a){const e=a.trim();return bQ(e)?parseFloat(e):e}return YW(i)?wQ(i,t,n+1):i}const EQ=e=>/^0(?:[\0-\x08\x0E-\x1F!-\x2D\/-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+$/.test(e);function SQ(e){return"number"===typeof e?0===e:null===e||("none"===e||"0"===e||EQ(e))}const CQ=new Set(["brightness","contrast","saturate","opacity"]);function xQ(e){const[t,n]=e.slice(0,-1).split("(");if("drop-shadow"===t)return e;const[r]=n.match(ZW)||[];if(!r)return e;const i=n.replace(r,"");let a=CQ.has(t)?1:0;return r!==n&&(a*=100),t+"("+a+i+")"}const TQ=/\b([\x2Da-z]*)\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\)/g,RQ=d(d({},EG),{},{getAnimatableNone:e=>{const t=e.match(TQ);return t?t.map(xQ).join(" "):e}}),IQ=d(d({},BX),{},{color:hG,backgroundColor:hG,outlineColor:hG,fill:hG,stroke:hG,borderColor:hG,borderTopColor:hG,borderRightColor:hG,borderBottomColor:hG,borderLeftColor:hG,filter:RQ,WebkitFilter:RQ}),NQ=e=>IQ[e];function AQ(e,t){let n=NQ(e);return n!==RQ&&(n=EG),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const kQ=new Set(["auto","none","0"]);class DQ extends YH{constructor(e,t,n,r,i){super(e,t,n,r,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let s=0;s<e.length;s++){let n=e[s];if("string"===typeof n&&(n=n.trim(),YW(n))){const r=wQ(n,t.current);void 0!==r&&(e[s]=r),s===e.length-1&&(this.finalKeyframe=n)}}if(this.resolveNoneKeyframes(),!vW.has(n)||2!==e.length)return;const[r,i]=e,a=yQ(r),o=yQ(i);if(a!==o)if(PH(a)&&PH(o))for(let s=0;s<e.length;s++){const t=e[s];"string"===typeof t&&(e[s]=parseFloat(t))}else UH[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let r=0;r<e.length;r++)(null===e[r]||SQ(e[r]))&&n.push(r);n.length&&function(e,t,n){let r,i=0;for(;i<e.length&&!r;){const t=e[i];"string"===typeof t&&!kQ.has(t)&&yG(t).values.length&&(r=e[i]),i++}if(r&&n)for(const a of t)e[a]=AQ(n,r)}(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;"height"===n&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=UH[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];void 0!==r&&e.getValue(n,r).jump(r,!1)}measureEndState(){var e;const{element:t,name:n,unresolvedKeyframes:r}=this;if(!t||!t.current)return;const i=t.getValue(n);i&&i.jump(this.measuredOrigin,!1);const a=r.length-1,o=r[a];r[a]=UH[n](t.measureViewportBox(),window.getComputedStyle(t.current)),null!==o&&void 0===this.finalKeyframe&&(this.finalKeyframe=o),null!==(e=this.removedTransforms)&&void 0!==e&&e.length&&this.removedTransforms.forEach((e=>{let[n,r]=e;t.getValue(n).set(r)})),this.resolveNoneKeyframes()}}const MQ=[...vQ,hG,EG],LQ={current:null},OQ={current:!1};const PQ=new WeakMap;const jQ=["willChange"],FQ=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class UQ{scrapeMotionValuesFromProps(e,t,n){return{}}constructor(e){let{parent:t,props:n,presenceContext:r,reducedMotionConfig:i,blockInitialAnimation:a,visualState:o}=e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=YH,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const e=CW.now();this.renderScheduledAt<e&&(this.renderScheduledAt=e,dW.render(this.render,!1,!0))};const{latestValues:u,renderState:l}=o;this.latestValues=u,this.baseTarget=d({},u),this.initialValues=n.initial?d({},u):{},this.renderState=l,this.parent=t,this.props=n,this.presenceContext=r,this.depth=t?t.depth+1:0,this.reducedMotionConfig=i,this.options=s,this.blockInitialAnimation=Boolean(a),this.isControllingVariants=xX(n),this.isVariantNode=TX(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=Boolean(t&&t.current);const f=this.scrapeMotionValuesFromProps(n,{},this),{willChange:h}=f,p=c(f,jQ);for(const c in p){const e=p[c];void 0!==u[c]&&DW(e)&&e.set(u[c],!1)}}mount(e){this.current=e,PQ.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach(((e,t)=>this.bindToMotionValue(t,e))),OQ.current||function(){if(OQ.current=!0,Bz)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>LQ.current=e.matches;e.addListener(t),t()}else LQ.current=!1}(),this.shouldReduceMotion="never"!==this.reducedMotionConfig&&("always"===this.reducedMotionConfig||LQ.current),this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),fW(this.notifyUpdate),fW(this.render),this.valueSubscriptions.forEach((e=>e())),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=gW.has(e);n&&this.onBindTransform&&this.onBindTransform();const r=t.on("change",(t=>{this.latestValues[e]=t,this.props.onUpdate&&dW.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0)})),i=t.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,(()=>{r(),i(),a&&a(),t.owner&&t.stop()}))}sortNodePosition(e){return this.current&&this.sortInstanceNodePosition&&this.type===e.type?this.sortInstanceNodePosition(this.current,e.current):0}updateFeatures(){let e="animation";for(e in AX){const t=AX[e];if(!t)continue;const{isEnabled:n,Feature:r}=t;if(!this.features[e]&&r&&n(this.props)&&(this.features[e]=new r(this)),this.features[e]){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):{x:{min:0,max:0},y:{min:0,max:0}}}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<FQ.length;n++){const t=FQ[n];this.propEventSubscriptions[t]&&(this.propEventSubscriptions[t](),delete this.propEventSubscriptions[t]);const r=e["on"+t];r&&(this.propEventSubscriptions[t]=this.on(t,r))}this.prevMotionValues=function(e,t,n){for(const r in t){const i=t[r],a=n[r];if(DW(i))e.addValue(r,i);else if(DW(a))e.addValue(r,RW(i,{owner:e}));else if(a!==i)if(e.hasValue(r)){const t=e.getValue(r);!0===t.liveStyle?t.jump(i):t.hasAnimated||t.set(i)}else{const t=e.getStaticValue(r);e.addValue(r,RW(void 0!==t?t:i,{owner:e}))}}for(const r in n)void 0===t[r]&&e.removeValue(r);return t}(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return void 0===n&&void 0!==t&&(n=RW(null===t?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){var n;let r=void 0===this.latestValues[e]&&this.current?null!==(n=this.getBaseTargetFromProps(this.props,e))&&void 0!==n?n:this.readValueFromInstance(this.current,e,this.options):this.latestValues[e];return void 0!==r&&null!==r&&("string"===typeof r&&(bQ(r)||EQ(r))?r=parseFloat(r):!(e=>MQ.find(gQ(e)))(r)&&EG.test(t)&&(r=AQ(e,t)),this.setBaseTarget(e,DW(r)?r.get():r)),DW(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let n;if("string"===typeof t||"object"===typeof t){var r;const i=rW(this.props,t,null===(r=this.presenceContext)||void 0===r?void 0:r.custom);i&&(n=i[e])}if(t&&void 0!==n)return n;const i=this.getBaseTargetFromProps(this.props,e);return void 0===i||DW(i)?void 0!==this.initialValues[e]&&void 0===n?void 0:this.baseTarget[e]:i}on(e,t){return this.events[e]||(this.events[e]=new _W),this.events[e].add(t)}notify(e){if(this.events[e]){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.events[e].notify(...n)}}}class BQ extends UQ{constructor(){super(...arguments),this.KeyframeResolver=DQ}sortInstanceNodePosition(e,t){return 2&e.compareDocumentPosition(t)?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,t){let{vars:n,style:r}=t;delete n[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;DW(e)&&(this.childSubscription=e.on("change",(e=>{this.current&&(this.current.textContent="".concat(e))})))}}function VQ(e,t,n,r){let{style:i,vars:a}=t;Object.assign(e.style,i,r&&r.getProjectionStyles(n));for(const o in a)e.style.setProperty(o,a[o])}class zQ extends BQ{constructor(){super(...arguments),this.type="html",this.renderInstance=VQ}readValueFromInstance(e,t){var n,r;if(gW.has(t))return null!==(n=this.projection)&&void 0!==n&&n.isProjecting?MH(t):((e,t)=>{const{transform:n="none"}=getComputedStyle(e);return LH(n,t)})(e,t);{const n=(r=e,window.getComputedStyle(r)),i=(GW(t)?n.getPropertyValue(t):n[t])||0;return"string"===typeof i?i.trim():i}}measureInstanceViewportBox(e,t){let{transformPagePoint:n}=t;return yq(e,n)}build(e,t,n){WX(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return dQ(e,t,n)}}const WQ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);class GQ extends BQ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=nq}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(gW.has(t)){const e=NQ(t);return e&&e.default||0}return t=WQ.has(t)?t:LW(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return hQ(e,t,n)}build(e,t,n){JX(e,t,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,t,n,r){!function(e,t,n,r){VQ(e,t,void 0,r);for(const i in t.attrs)e.setAttribute(WQ.has(i)?i:LW(i),t.attrs[i])}(e,t,0,r)}mount(e){this.isSVGTag=$X(e.tagName),super.mount(e)}}const HQ=(e,t)=>oQ(e)?new GQ(t):new zQ(t,{allowProjection:e!==a.Fragment}),YQ=eW(mQ(d(d(d(d({},zY),wX),nX),EX),HQ)),qQ=e=>{let{images:t,imageIndex:n,setIsLightbox:r,setImageIndex:i}=e;const[o,s]=(0,a.useState)(n);let[c,u]=(0,a.useState)(0);const l=()=>r(!1);return(0,kt.jsx)("div",{className:"media-lightbox",children:null!==o&&(0,kt.jsx)("div",{id:"lightbox-overlay",onClick:e=>{"lightbox-overlay"===e.target.id&&l()},className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",children:(0,kt.jsxs)("div",{className:"relative lightbox-content",children:[(0,kt.jsx)("button",{onClick:l,className:"lightbox-close-button bg-danger",children:(0,kt.jsx)("i",{className:"fas fa-times"})}),n>0&&(0,kt.jsx)("button",{onClick:()=>{o>0&&(u(-1),i((e=>e-1)))},className:"lightbox-prev-button",children:(0,kt.jsx)("i",{className:"fas fa-chevron-left"})}),n<t.length-1&&(0,kt.jsx)("button",{onClick:()=>{u(-1),o<t.length-1&&i((e=>e+1))},className:"lightbox-next-button ",children:(0,kt.jsx)("i",{className:"fas fa-chevron-right"})}),(0,kt.jsx)("div",{className:"overflow-hidden",children:(0,kt.jsx)($z,{initial:!0,custom:1,children:(0,kt.jsx)(YQ.img,{src:t[n],alt:"Lightbox",className:"max-h-[80vh] mx-auto rounded w-100",custom:1,variants:{enter:e=>({x:e>0?300:-300,opacity:0}),center:{x:0,opacity:1},exit:e=>({x:e>0?-300:300,opacity:0})},initial:"enter",animate:"center",exit:"exit",transition:{duration:.4}},t[n])})})]})})})},KQ=()=>{let[e,t]=(0,a.useState)([]),[n,r]=(0,a.useState)(!1),[i,o]=(0,a.useState)(0),s=Xe();return(0,a.useEffect)((()=>{t([]),pa.get("message/media/?profileId=".concat(s.profile)).then((e=>{t([...e.data.map((e=>e.attachment))])}))}),[s]),(0,kt.jsxs)("div",{className:"text-center pt-2 right-sidebar-container",children:[n&&(0,kt.jsx)(qQ,{setIsLightbox:r,setImageIndex:o,imageIndex:i,images:e,index:i}),(0,kt.jsx)("h3",{className:"msg-media-title",children:"Media"}),(0,kt.jsx)("div",{className:"msg-media-container",children:(0,kt.jsx)(Lz,{children:(0,kt.jsx)(Oz,{columnsCount:2,gutter:"10px",children:e&&e.map(((t,n)=>(0,kt.jsx)(jz,{setIsLightbox:r,setImageIndex:o,images:e,index:n,src:t},n)))})})})]})},XQ=e=>{var t=(e=>{const[t,n]=(0,a.useState)(window.matchMedia(e).matches);return(0,a.useEffect)((()=>{const t=window.matchMedia(e),r=e=>n(e.matches);return t.addEventListener("change",r),()=>t.removeEventListener("change",r)}),[e]),t})("(max-width: 768px)");return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)("div",{id:"message",children:(0,kt.jsx)(en,{fluid:!0,children:(0,kt.jsxs)(rn,{style:{minHeight:"400px"},children:[!t&&(0,kt.jsx)(cn,{md:"3",children:(0,kt.jsx)(es,{})}),(0,kt.jsx)(cn,{md:"6",children:(0,kt.jsx)(Tz,{cameraVideoRef:e.cameraVideoRef})}),!t&&(0,kt.jsx)(cn,{md:"3",children:(0,kt.jsx)(KQ,{})})]})})})})},QQ=e=>{let t=qe(),[n,r]=(0,a.useState)(e.stories);(0,a.useEffect)((()=>{r(e.stories)}));let{storyId:i}=Xe(),o=e=>{const t=xc()(e);xc()();return t.format("dddd, hh:mm A")},s=(0,a.useCallback)((e=>{t("/story/"+e.currentTarget.dataset.id)}),[]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"story-list-container",children:n.map(((e,t)=>{var n;return(0,kt.jsx)("div",{"data-id":e._id,onClick:s,className:"text-decoration-none story-link",children:(0,kt.jsx)("div",{className:"story-list-item mb-2 ".concat(i==e._id?"active":""),children:(0,kt.jsxs)("div",{className:"d-flex justify-content-center align-items-center",children:[(0,kt.jsx)("div",{className:"story-pp-container text-end",children:(0,kt.jsx)(Un,{profilePic:null===e||void 0===e||null===(n=e.author)||void 0===n?void 0:n.profilePic,hasStory:!0,profile:null===e||void 0===e?void 0:e.author._id})}),(0,kt.jsxs)("div",{className:"story-info-container px-2",children:[(0,kt.jsxs)("h2",{className:"author-name fs-5 mb-0",children:[e.author.user.firstName+" "+e.author.user.surname," "]}),(0,kt.jsx)("span",{className:"story-time text-mute text-small",children:o(e.createdAt)})]})]})})},t)}))})})};const JQ=e=>{let{children:t}=e,{storyId:n}=Xe(),[r,i]=(0,a.useState)([]),o=(0,a.useRef)(),[s,c]=(0,a.useState)(window.matchMedia("(max-width: 768px)").matches);const u=qe();return(0,a.useEffect)((()=>{window.matchMedia("(max-width:768px)").addEventListener("change",(e=>{c(e.matches)})),pa.get("/story/").then((e=>{200===e.status&&(console.log("stories",e.data),i(e.data))}))}),[n]),(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)(en,{fluid:!0,className:"story-container py-3",children:(0,kt.jsxs)(rn,{children:[(0,kt.jsx)(cn,{md:"3",children:!s&&(0,kt.jsx)(QQ,{stories:r})}),(0,kt.jsx)(cn,{md:"6",children:(0,kt.jsx)("div",{ref:o,className:"story-content-container",children:n?(0,kt.jsxs)(kt.Fragment,{children:[t,(0,kt.jsx)("div",{className:"nf-story-arrow-left",onClick:function(e){var t;const i=r.findIndex((e=>(null===e||void 0===e?void 0:e._id)===n)),a=(null===(t=r[i-1])||void 0===t?void 0:t._id)||r[i]._id;u("/story/"+a),o.current.scrollBy({left:300,behavior:"smooth"})}.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-chevron-left"})}),(0,kt.jsx)("div",{className:"nf-story-arrow-right",onClick:function(e){var t;const i=r.findIndex((e=>(null===e||void 0===e?void 0:e._id)===n)),a=(null===(t=r[i+1])||void 0===t?void 0:t._id)||r[i]._id;u("/story/"+a)}.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]}):(0,kt.jsx)("p",{className:"text-center fs-4",children:"Select a story owner from left"})})}),(0,kt.jsx)(cn,{md:"3",children:(0,kt.jsx)(lt,{})})]})})})},ZQ=e=>{let{storyId:t}=Xe(),[n,r]=(0,a.useState)(!1),[i,o]=(0,a.useState)(""),[s,c]=(0,a.useState)(!1),[u,l]=(0,a.useState)(""),d=En((e=>e.profile._id)),[f,h]=(0,a.useState)(!1),p=qe();(0,a.useEffect)((()=>{c(""),pa.get("/story/single",{params:{storyId:t}}).then((e=>{200==e.status&&(r(e.data),h(e.data.author._id==d),o(e.data.bgColor))})).catch((e=>{console.log(e)}))}),[t]),(0,a.useEffect)((()=>{n&&n.reacts.map((e=>{e.profile===d&&c(e.type.toLowerCase())})),h((null===n||void 0===n?void 0:n.author)&&n.author._id==d)}),[n]);let m=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"story";return 200===(await pa.post("/react/removeReact",{id:e,postType:t})).status&&(c(!1),!0)},g=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"story";return 200===(await pa.post("/react/addReact",{id:e,reactType:t,postType:n})).status&&(c(t),!0)};return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(JQ,{children:null==n?(0,kt.jsx)("p",{}):(0,kt.jsxs)("div",{className:"single-story-container",children:[(0,kt.jsxs)("div",{className:"single-story",style:{background:i},children:[(0,kt.jsxs)("div",{className:"story-top",children:[(0,kt.jsxs)("div",{className:"story-author-details",children:[(0,kt.jsx)("div",{className:"author-pp-container",children:n.author&&(0,kt.jsx)(Un,{profilePic:n.author.profilePic,profile:n.author._id,hasStory:!1})}),(0,kt.jsx)("div",{className:"author-name",children:(0,kt.jsx)("h3",{children:n.author&&n.author.fullName})})]}),(0,kt.jsxs)("div",{className:"story-options",children:[(0,kt.jsx)("span",{className:"option-button reacts",children:(0,kt.jsx)(Tt,{to:"reacts",children:(0,kt.jsx)("i",{className:"fa fa-heart"})})}),(0,kt.jsx)("span",{className:"option-button comments",children:(0,kt.jsx)(Tt,{to:"comments",children:(0,kt.jsx)("i",{className:"fa fa-comments"})})}),f&&(0,kt.jsx)("span",{className:"option-button delete text-danger",onClick:(async e=>{(0,Rs.ZX)({title:"Confirm Action",message:"Are you sure you want to delete this post?",buttons:[{label:"Yes",onClick:async()=>{Pn()(e.currentTarget).parents(".single-story-container").remove(),200==(await pa.post("/story/delete",{storyId:t})).status&&p("/story")}},{label:"No",onClick:()=>{}}]})}).bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-trash"})})]})]}),(0,kt.jsx)("div",{className:"single-story-image-container",style:{background:"url(".concat(n.image,")")}})]}),(0,kt.jsxs)("div",{className:"single-story-meta-container",children:[(0,kt.jsxs)("div",{className:"single-story-reacts-buttons",children:[(0,kt.jsx)("div",{className:"single-story-react-button ".concat("like"==s?"reacted":""),onClick:(async e=>{let n=e.currentTarget;n.classList.contains("reacted")?m(t)&&n.classList.remove("reacted"):g(t,"like","story")&&n.classList.add("reacted")}).bind(void 0),children:(0,kt.jsx)("img",{src:"https://programmerikram.com/wp-content/uploads/2025/03/like-icon.svg",alt:"Like"})}),(0,kt.jsx)("div",{className:"single-story-react-button ".concat("love"==s?"reacted":""),onClick:(async e=>{let n=e.currentTarget;n.classList.contains("reacted")?m(t)&&n.classList.remove("reacted"):g(t,"love","story")&&n.classList.add("reacted")}).bind(void 0),children:(0,kt.jsx)("img",{src:"https://programmerikram.com/wp-content/uploads/2025/03/love-icon.svg",alt:"Love"})}),(0,kt.jsx)("div",{className:"single-story-react-button ".concat("haha"==s?"reacted":""),onClick:(async e=>{let n=e.currentTarget;n.classList.contains("reacted")?m(t)&&n.classList.remove("reacted"):g(t,"haha","story")&&n.classList.add("reacted")}).bind(void 0),children:(0,kt.jsx)("img",{src:"https://programmerikram.com/wp-content/uploads/2025/03/haha-icon.svg",alt:"Haha"})})]}),(0,kt.jsx)("div",{className:"single-story-comment-container",children:(0,kt.jsx)("input",{type:"text",className:"single-story-comment-input",onChange:(async e=>{let t=e.target.value;l(t)}).bind(void 0),placeholder:"Post a comment to this story",value:u,onKeyUp:(async e=>{if(13===e.keyCode){200==(await pa.post("/comment/story/addComment",{body:u,storyId:t})).status&&l("")}}).bind(void 0)})})]}),(0,kt.jsx)(lt,{})]})})})};const $Q=()=>(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)(JQ,{})}),eJ="https://programmerikram.com/wp-content/uploads/2025/03/like-icon.svg",tJ=e=>{let{reactor:t}=e,[n,r]=(0,a.useState)(!1),[i,o]=(0,a.useState)("");return(0,a.useEffect)((()=>{(async()=>{let e=await pa.get("profile",{params:{profileId:t.profile}});if(200==e.status)switch(r(e.data),t.type){case"like":default:o(eJ);break;case"love":o("https://programmerikram.com/wp-content/uploads/2025/03/love-icon.svg");break;case"haha":o("https://programmerikram.com/wp-content/uploads/2025/03/haha-icon.svg")}})()}),[]),(0,kt.jsx)("div",{children:n&&(0,kt.jsxs)("li",{className:"sp-reacts-item",children:[(0,kt.jsx)("div",{className:"reactor-pp",children:(0,kt.jsx)(Un,{profilePic:n.profilePic,profile:n._id})}),(0,kt.jsx)("div",{className:"react-details",children:(0,kt.jsx)(Tt,{to:"/".concat(n._id),children:(0,kt.jsx)("span",{className:"reactor-name",children:n.fullName})})}),(0,kt.jsx)("span",{className:"reactor-react",children:(0,kt.jsx)("img",{src:i,alt:"love"})})]})})},nJ=e=>{let{storyId:t}=Xe(),[n,r]=(0,a.useState)(!1),[i,o]=(0,a.useState)(""),[s,c]=(0,a.useState)(!1),[u,l]=(0,a.useState)(""),d=En((e=>e.profile._id)),[f,h]=(0,a.useState)(!1),p=qe(),[m,g]=(0,a.useState)([]),v=(0,a.useRef)(),[y,b]=(0,a.useState)(window.matchMedia("(max-width: 768px)").matches);(0,a.useEffect)((()=>{c(""),pa.get("/story/single",{params:{storyId:t}}).then((e=>{200==e.status&&(r(e.data),h(e.data.author._id==d),o(e.data.bgColor))})).catch((e=>{console.log(e)}))}),[t]),(0,a.useEffect)((()=>{window.matchMedia("(max-width:768px)").addEventListener("change",(e=>{b(e.matches)})),pa.get("/story/").then((e=>{200===e.status&&g(e.data)}))}),[t]),(0,a.useEffect)((()=>{n&&n.reacts.map((e=>{e.profile===d&&c(e.type.toLowerCase())})),h((null===n||void 0===n?void 0:n.author)&&n.author._id==d)}),[n]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(en,{fluid:!0,className:"story-container py-3",children:(0,kt.jsxs)(rn,{children:[(0,kt.jsx)(cn,{md:"3",children:!y&&(0,kt.jsx)(QQ,{stories:m})}),(0,kt.jsx)(cn,{md:"6",children:(0,kt.jsx)("div",{ref:v,className:"story-content-container",children:t?(0,kt.jsxs)(kt.Fragment,{children:["(",null==n?(0,kt.jsx)("p",{}):(0,kt.jsxs)("div",{className:"single-story-container",children:[(0,kt.jsxs)("div",{className:"single-story",style:{background:i},children:[(0,kt.jsxs)("div",{className:"story-top",children:[(0,kt.jsxs)("div",{className:"story-author-details",children:[(0,kt.jsx)("div",{className:"author-pp-container",children:n.author&&(0,kt.jsx)(Un,{profilePic:n.author.profilePic,profile:n.author._id,hasStory:!1})}),(0,kt.jsx)("div",{className:"author-name",children:(0,kt.jsx)("h3",{children:n.author&&n.author.fullName})})]}),(0,kt.jsxs)("div",{className:"story-options",children:[(0,kt.jsx)("span",{className:"option-button reacts",children:(0,kt.jsx)(Tt,{to:"reacts",children:(0,kt.jsx)("i",{class:"fa fa-heart"})})}),(0,kt.jsx)("span",{className:"option-button comments",children:(0,kt.jsx)(Tt,{to:"comments",children:(0,kt.jsx)("i",{class:"fa fa-comments"})})}),f&&(0,kt.jsx)("span",{className:"option-button delete text-danger",onClick:(async e=>{(0,Rs.ZX)({title:"Confirm Action",message:"Are you sure you want to delete this post?",buttons:[{label:"Yes",onClick:async()=>{Pn()(e.currentTarget).parents(".single-story-container").remove(),200==(await pa.post("/story/delete",{storyId:t})).status&&p("/story")}},{label:"No",onClick:()=>{}}]})}).bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-trash"})})]})]}),(0,kt.jsx)("div",{className:"single-story-image-container",style:{background:"url(".concat(n.image,")")}})]}),(0,kt.jsx)("div",{className:"single-story-meta-container"}),(0,kt.jsx)(lt,{})]}),")",(0,kt.jsx)("div",{className:"nf-story-arrow-left",onClick:function(e){var n;const r=m.findIndex((e=>(null===e||void 0===e?void 0:e._id)===t)),i=(null===(n=m[r-1])||void 0===n?void 0:n._id)||m[r]._id;p("/story/"+i),v.current.scrollBy({left:300,behavior:"smooth"})}.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-chevron-left"})}),(0,kt.jsx)("div",{className:"nf-story-arrow-right",onClick:function(e){var n;const r=m.findIndex((e=>(null===e||void 0===e?void 0:e._id)===t)),i=(null===(n=m[r+1])||void 0===n?void 0:n._id)||m[r]._id;p("/story/"+i)}.bind(void 0),children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]}):(0,kt.jsx)("p",{className:"text-center fs-4",children:"Select a story owner from left"})})}),(0,kt.jsx)(cn,{md:"3",children:(0,kt.jsx)("div",{className:"single-story-meta-container",children:(0,kt.jsx)("ul",{className:"story-reacts-list",children:n.reacts&&n.reacts.map(((e,t)=>(0,kt.jsx)(tJ,{reactor:e},t)))})})})]})})})},rJ=()=>(0,kt.jsx)("div",{children:(0,kt.jsx)("h1",{children:"Sc"})}),iJ="https://programmerikram.com/wp-content/uploads/2025/03/like-icon.svg",aJ="https://programmerikram.com/wp-content/uploads/2025/03/love-icon.svg",oJ="https://programmerikram.com/wp-content/uploads/2025/03/haha-icon.svg",sJ=e=>{var t;let{postId:n}=Xe(),[r,i]=(0,a.useState)(!1);const[o,s]=(0,a.useState)(e.videoUrl);let c=(0,a.useRef)(null),u=(0,a.useRef)(null);const{watchId:l}=Xe();(0,a.useEffect)((()=>{(async()=>{let e=await pa.get("watch/single",{params:{watchId:l}});200==e.status&&(i(e.data),s(e.data.videoUrl))})()}),[n]);let f=En((e=>e.profile)),h=f._id,p=r&&(null===r||void 0===r?void 0:r.author._id),[m,g]=(0,a.useState)(r&&r.reacts.length),[v,y]=(0,a.useState)(r&&r.shares.length),[b,_]=(0,a.useState)(r&&r.comments.length),[w,E]=(0,a.useState)(!1),[S,C]=(0,a.useState)((null===r||void 0===r||null===(t=r.author)||void 0===t?void 0:t._id)===(null===f||void 0===f?void 0:f._id)),[x,T]=(0,a.useState)(!1),[R,I]=(0,a.useState)([]);const[N,A]=(0,a.useState)(null),[k,D]=(0,a.useState)(null);var M=h===p,L=r&&(null===r||void 0===r?void 0:r.author.profilePic);(0,a.useEffect)((()=>{let e=[];r&&r.reacts.map((t=>{if(t.profile){switch(t.type){case"like":e.includes("like")||e.push("like");break;case"love":e.includes("love")||e.push("love");break;case"haha":e.includes("haha")||e.push("haha")}t.profile===h&&E(t.type)}})),I(e)}),[]);(e=>{const t=new Image;t.src=e,t.onload=()=>D(!0),t.onerror=()=>D(!1)})(r&&r.photos),(e=>{const t=new Image;t.src=e,t.onload=()=>A(!0),t.onerror=()=>A(!1)})(L),N||(L="https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png");let O=r&&(r.type||"post"),P=async function(){g((e=>e-1));let e=await pa.post("/react/removeReact",{id:r._id,postType:"post"});return 200===e.status&&(g(e.data.reacts.length),E(""),!0)},j=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"post";g((e=>e+1));let n=await pa.post("/react/addReact",{id:r._id,postType:t,reactType:e});return 200===n.status&&(g(n.data.reacts.length),I([...R,e]),E(e),!0)},F=(En((e=>e.profile.profilePic)),En((e=>e.profile._id)),"".concat(r&&(null===r||void 0===r?void 0:r.author.profilePic))),[U,B]=(0,a.useState)(window.matchMedia("(max-width: 768px)").matches);(0,a.useEffect)((()=>{window.matchMedia("(max-width:768px)").addEventListener("change",(e=>{B(e.matches)}))}),[]),(0,a.useEffect)((()=>{null!==f&&void 0!==f&&f.id&&null!==r&&void 0!==r&&r.author&&null!==r&&void 0!==r&&r.author._id&&C(f._id===r.author._id)}),[f,r]);let V=(0,a.useCallback)((async e=>{if(null!==u&&void 0!==u&&u.current&&null!==r&&void 0!==r&&r._id){let e=u.current.value;200===(await pa.post("/watch/update",{caption:e,watchId:r._id})).status&&i(d(d({},r),{},{caption:e}))}}),[u,r]),z=(0,a.useCallback)((t=>{null!==e&&void 0!==e&&e.videoUrl&&pc(r._id,r.videoUrl,r)}),[e]);return(0,kt.jsx)("div",{children:(0,kt.jsx)(en,{className:"single-post-container",children:(0,kt.jsx)(rn,{children:(0,kt.jsx)(cn,{md:"6",className:"offset-md-3",children:(0,kt.jsx)("div",{id:"post-container",children:(0,kt.jsx)("div",{children:r&&(0,kt.jsxs)("div",{className:"nf-post ".concat(O),children:[(0,kt.jsxs)("div",{className:"header",children:["profilePic"===O&&(0,kt.jsxs)("div",{className:"reason",children:[(0,kt.jsxs)("span",{className:"d-none",children:[(0,kt.jsx)("b",{children:"A bitch"})," commented."]}),(0,kt.jsx)("span",{children:"Updated Profile Picture"})]}),(0,kt.jsxs)("div",{className:"author-info",children:[(0,kt.jsxs)("div",{className:"left",children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:F,profile:r.author._id,active:r.author.isActive})}),(0,kt.jsxs)("div",{className:"post-nd-container",children:[(0,kt.jsx)(Tt,{to:"/"+r.author._id,children:(0,kt.jsx)("h4",{className:"author-name",children:r.author.user.firstName+" "+r.author.user.surname})}),(0,kt.jsx)("span",{className:"post-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:r.createdAt})})]})]}),(0,kt.jsxs)("div",{className:"right",children:[(0,kt.jsx)("button",{onClick:z,className:"watch-three-dot",children:(0,kt.jsx)("i",{className:"fas fa-download"})}),M&&(0,kt.jsx)("button",{className:"post-three-dot",children:(0,kt.jsx)("i",{className:"far fa-ellipsis-h"})}),(0,kt.jsxs)("button",{onClick:(async e=>{let t=e.currentTarget;M?(0,Rs.ZX)({title:"Confirm Action",message:"Are you sure you want to delete this post?",buttons:[{label:"Yes",onClick:async()=>{let e=await pa.post("/post/delete",{postId:r._id,authorId:r.author._id});200===e.status?(Pn()(t).parents(".nf-post").css({"min-height":"0px",padding:"10px"}),Pn()(t).parents(".nf-post").html('<p class="fs-6 mb-0 text-center text-danger">'+e.data.message+"</p>")):alert("Failed to delete post")}},{label:"No",onClick:()=>{}}]}):Pn()(t).parents(".nf-post").hide()}).bind(void 0),className:"post-close",children:[" ",(0,kt.jsx)("i",{className:"far fa-times"})]})]})]})]}),(0,kt.jsxs)("div",{className:"body",children:[(0,kt.jsxs)("div",{className:"caption",style:{display:"flex",alignItems:"center",justifyContent:"start"},children:[S&&x&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("textarea",{style:{width:"90%"},ref:u})}),!x&&(0,kt.jsx)("p",{style:{margin:0,marginRight:20},children:r.caption}),S&&(0,kt.jsx)("button",{style:{},className:"btn ".concat(x?"btn-primary":"btn-danger"),onClick:e=>{T(!x)},children:x?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("i",{onClick:V,className:"fas fa-check"})}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("i",{onClick:()=>{},className:"fas fa-pen"})})})]}),o&&(0,kt.jsx)("div",{className:"attachment",children:(0,kt.jsx)(Tt,{to:"/watch/".concat(e._id),children:(0,kt.jsx)("video",{id:"watch-".concat(e._id),ref:c,className:"w-100 watch-video",controls:!0,src:"".concat(o)})})})||(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(Is,{})})]}),(0,kt.jsxs)("div",{className:"footer",children:[(0,kt.jsxs)("div",{className:"react-count",children:[(0,kt.jsxs)("div",{className:"reacts",children:[R.includes("like")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:iJ,alt:"like"}),"  "]}):(0,kt.jsx)("span",{}),R.includes("love")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:aJ,alt:"love"})," "]}):(0,kt.jsx)("span",{}),R.includes("haha")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:oJ,alt:"love"})," "]}):(0,kt.jsx)("span",{}),(0,kt.jsxs)("span",{className:"text",children:[r.reacts&&m," ",m>1?"Reacts":"React"]})]}),(0,kt.jsxs)("div",{className:"comment-share",children:[(0,kt.jsxs)("div",{className:"comment",children:[(0,kt.jsx)("div",{className:"text",children:r.comments&&b}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})})]}),(0,kt.jsxs)("div",{className:"shares",children:[(0,kt.jsx)("div",{className:"text",children:r.shares&&v}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"fa fa-share"})})]})]})]}),(0,kt.jsx)("div",{className:"like-comment-share",children:(0,kt.jsxs)("div",{className:"buttons-container",children:[(0,kt.jsxs)("div",{className:"react-buttons button ".concat(w?"reacted":""),children:[(0,kt.jsxs)("div",{onClick:async e=>{let t=e.currentTarget;Pn()(t).parent().hasClass("reacted")?(P("post"),Pn()(t).parent().removeClass("reacted")):(j("like","post",t),Pn()(t).parent().addClass("reacted"))},onMouseOver:e=>{let t=e.currentTarget;Pn()(t).children(".post-react-container").css("visibility","visible")},className:"react-like ".concat(1==w?"reacted":""),children:[(0,kt.jsxs)("span",{className:"react-icon",datatype:w||"",children:["haha"==w?(0,kt.jsx)("img",{src:oJ,alt:"haha"}):(0,kt.jsx)("span",{}),"love"==w?(0,kt.jsx)("img",{src:aJ,alt:"love"}):(0,kt.jsx)("span",{}),0==w||"like"==w?(0,kt.jsx)("img",{src:iJ,alt:"like"}):(0,kt.jsx)("span",{})]}),(0,kt.jsx)("span",{className:"text text-capitalize",children:w||"like"})]}),(0,kt.jsxs)("div",{className:"post-react-container",children:[(0,kt.jsx)("div",{className:"react react-like ".concat("like"==w?"reacted":""),onClick:async e=>{let t=e.currentTarget;Pn()(t).parents(".post-react-container").css("visibility","hidden"),Pn()(t).hasClass("reacted")?(P("post"),Pn()(t).removeClass("reacted")):(j("like","post",t),Pn()(t).addClass("reacted"),Pn()(e.currentTarget).siblings().removeClass("reacted")),setTimeout((()=>{Pn()(t).parents(".post-react-container").css("visibility","visible")}),500)},id:"postReactLike",title:"Like",children:(0,kt.jsx)("img",{src:iJ,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-love ".concat("love"==w?"reacted":""),onClick:e=>{let t=e.currentTarget;Pn()(t).parents(".post-react-container").css("visibility","hidden"),Pn()(e.currentTarget).hasClass("reacted")?(P("post"),Pn()(e.currentTarget).removeClass("reacted")):(j("love","post"),Pn()(e.currentTarget).siblings().removeClass("reacted"),Pn()(e.currentTarget).addClass("reacted")),setTimeout((()=>{Pn()(t).parents(".post-react-container").css("visibility","visible")}),500)},id:"postReactLove",title:"Love",children:(0,kt.jsx)("img",{src:aJ,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-haha ".concat("haha"==w?"reacted":""),onClick:e=>{let t=e.currentTarget;Pn()(t).parents(".post-react-container").css("visibility","hidden"),Pn()(e.currentTarget).hasClass("reacted")?(P(),Pn()(e.currentTarget).removeClass("reacted")):(j("haha","post",t),Pn()(e.currentTarget).siblings().removeClass("reacted"),Pn()(e.currentTarget).addClass("reacted")),setTimeout((()=>{Pn()(t).parents(".post-react-container").css("visibility","visible")}),500)},id:"postReactHaha",title:"Haha",children:(0,kt.jsx)("img",{src:oJ,alt:"haha"})})]})]}),(0,kt.jsxs)("div",{onClick:e=>{let t=e.currentTarget;Pn()(t).parents(".footer").find(".field-comment-text").focus()},className:"comment button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})}),(0,kt.jsx)("span",{className:"text",children:"Comment"})]}),(0,kt.jsxs)("div",{onClick:e=>{},className:"share button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-share"})}),(0,kt.jsx)("span",{className:"text",children:"Share"})]})]})})]})]})})})})})})})};const cJ=e=>{var t;En((e=>e.setting)),En((e=>e.profile));let[n,r]=(0,a.useState)(!1),[i,o]=(0,a.useState)(!1),[s,c]=(0,a.useState)([]),[u,l]=(0,a.useState)([]),[d,f]=(0,a.useState)(""),[h,p]=(0,a.useState)(""),m=Xe(),g=m.profile;return(0,a.useEffect)((()=>{null!==i&&void 0!==i&&i.presentAddress&&f(i.presentAddress),null!==i&&void 0!==i&&i.permanentAddress&&p(i.permanentAddress),null!==i&&void 0!==i&&i.schools&&l(i.schools),null!==i&&void 0!==i&&i.workPlaces&&c(i.workPlaces)}),[i]),(0,a.useEffect)((()=>{pa.get("/profile",{params:{profileId:g}}).then((e=>{o(e.data)})).catch((e=>console.log(e)))}),[e]),(0,a.useEffect)((()=>{pa.get("/profile",{params:{profileId:g}}).then((e=>{o(e.data)})).catch((e=>console.log(e)))}),[]),(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{id:"profile-details-list",className:"details-list",children:[s.map(((e,t)=>(0,kt.jsxs)("div",{className:"details-list-item",children:[(0,kt.jsx)("i",{className:"fas fa-briefcase"}),(0,kt.jsxs)("span",{children:[null===e||void 0===e?void 0:e.designation," at ",(0,kt.jsx)("b",{children:null===e||void 0===e?void 0:e.name})]})]},t))),u.map(((e,t)=>(0,kt.jsxs)("div",{className:"details-list-item",children:[(0,kt.jsx)("i",{className:"fas fa-graduation-cap"}),(0,kt.jsxs)("span",{children:["Studied at ",(0,kt.jsxs)("b",{children:[null===e||void 0===e?void 0:e.name," (",null===e||void 0===e?void 0:e.degree,")"]})]})]},t))),d?(0,kt.jsxs)("div",{className:"details-list-item",children:[(0,kt.jsx)("i",{className:"fas fa-home"}),(0,kt.jsxs)("span",{children:["Lives in ",(0,kt.jsx)("b",{children:d})]})]}):(0,kt.jsx)(kt.Fragment,{}),h?(0,kt.jsxs)("div",{className:"details-list-item",children:[(0,kt.jsx)("i",{className:"fas fa-globe"}),(0,kt.jsxs)("span",{children:["From ",(0,kt.jsx)("b",{children:h})]})]}):(0,kt.jsx)(kt.Fragment,{}),(0,kt.jsxs)("div",{className:"details-list-item",children:[(0,kt.jsx)("i",{className:"fas fa-clock"}),(0,kt.jsxs)("span",{children:["Joined  ",(0,kt.jsx)("b",{children:(0,kt.jsx)(xa(),{format:"MMMM YYYY",children:null===i||void 0===i||null===(t=i.user)||void 0===t?void 0:t.createdAt})})]})]})]})})};const uJ=()=>(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)("div",{id:"profile-about-content",children:(0,kt.jsx)("div",{className:"tab-content",children:(0,kt.jsx)(cJ,{})})})});const lJ=()=>{let{profile:e}=Xe(),t=En((e=>e.profile))||{},n=t._id===e,[r,i]=(0,a.useState)(!1);const[o,s]=(0,a.useState)([]),[c,u]=(0,a.useState)(t.bio);let l=qe(),d=(0,a.useRef)(null);(0,a.useEffect)((()=>{pa.get("/post/myPosts",{params:{profile:e}}).then((e=>{200===e.status&&s(e.data)})),pa.get("/profile",{params:{profileId:e}}).then((e=>{i(e.data)})).catch((e=>console.log(e)))}),[e]),(0,a.useEffect)((()=>{pa.get("/profile",{params:{profileId:e}}).then((e=>{i(e.data),u(e.data.bio)})).catch((e=>console.log(e)))}),[]);let f=(0,a.useCallback)((e=>{l("/settings/")}),[]);return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{id:"profile-post-content",children:[(0,kt.jsxs)("div",{className:"intro",children:[(0,kt.jsx)("h4",{className:"section-title",children:"Intro"}),(0,kt.jsxs)("div",{className:"profile-bio",children:[(0,kt.jsx)("p",{className:"bio-text",children:c}),(0,kt.jsx)("textarea",{onChange:e=>{u(e.target.value)},value:c,className:"bio-text-textarea"}),n&&(0,kt.jsx)("div",{onClick:async e=>{try{let t=e.currentTarget;if(Pn()(t).hasClass("edit-button"))Pn()(t).siblings(".bio-text").hide(),Pn()(t).siblings(".bio-text-textarea").show(),Pn()(t).siblings(".bio-text-textarea").val(c),Pn()(t).removeClass("edit-button"),Pn()(t).addClass("save-button"),Pn()(t).text("Save Bio");else{await pa.post("/profile/update/bio",{bio:c});Pn()(t).text("Edit Bio"),Pn()(t).siblings(".bio-text").show(),Pn()(t).removeClass("save-button"),Pn()(t).siblings(".bio-text-textarea").hide(),Pn()(t).addClass("edit-button")}}catch(e){console.log(e)}},className:"edit-button",children:" Edit bio"})]}),(0,kt.jsxs)("div",{className:"details",children:[(0,kt.jsx)(cJ,{}),n&&(0,kt.jsx)("div",{onClick:f,className:"edit-button",children:" Edit Details"})]})]}),(0,kt.jsxs)("div",{ref:d,className:"posts-container",children:[n&&(0,kt.jsx)(ya,{setPosts:s,posts:o}),o.length>0?o.map(((e,n)=>(0,kt.jsx)(Ms,{myProfile:t,postContainer:d,data:e},n))):(0,kt.jsx)(Os,{count:3})]})]})})},dJ=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsx)("div",{className:"skeleton-card no-border",children:(0,kt.jsx)("div",{className:"skeleton-main",style:{minHeight:"227px",height:"227px",marginBottom:"0px"},children:" "})},t)))},fJ=e=>{let t=e.friend,n=En((e=>e.profile)),[r,i]=(0,a.useState)(!1),[o,s]=(0,a.useState)(t.profilePic||"https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png"),c=Xe(),[u,l]=(0,a.useState)(!1);(0,a.useEffect)((()=>{n.friends&&n.friends.filter((e=>{e._id===t._id&&l(!0)})),Fn(t.profilePic,i)}),[c]),(0,a.useEffect)((()=>{r&&s(t.profilePic)}),[r]);let d=t.fullName?t.fullName:t.user&&t.user.firstName+" "+t.user.surname;return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"friend-item",children:[(0,kt.jsx)("div",{className:"friend-info",children:(0,kt.jsxs)(Tt,{to:"/"+t._id,children:[(0,kt.jsx)("div",{className:"friend-profilePic",children:r?(0,kt.jsx)("img",{src:o,alt:d}):(0,kt.jsx)(dJ,{})}),(0,kt.jsxs)("div",{className:"friend-details",children:[(0,kt.jsx)("h4",{className:"friend-name text-capitalize",children:d}),t.mutual&&(0,kt.jsx)("span",{className:"friend-mutual",children:" 20 Mutual Friends"})]})]})}),(0,kt.jsxs)("div",{className:"friend-options",onClick:e=>{let t=e.currentTarget;Pn()(t).children(".friend-options-menu").toggle()},children:[(0,kt.jsx)("i",{className:"far fa-ellipsis-h"}),(0,kt.jsx)("div",{className:"friend-options-menu",children:u?(0,kt.jsxs)("div",{onClick:async e=>{try{200==(await pa.post("/friend/removeFriend",{profile:t._id})).status&&Pn()(e.currentTarget).parents(".friend-item").fadeOut()}catch(n){console.log(n)}},className:"friend-options-menu-item",children:[(0,kt.jsx)("div",{className:"menu-item-icon",children:(0,kt.jsx)("i",{className:"fas fa-user-times"})}),(0,kt.jsx)("div",{className:"menu-item-text",children:"Remove Friend"})]}):(0,kt.jsxs)("div",{onClick:async e=>{try{let n=e.currentTarget;200==(await pa.post("/friend/sendRequest/",{profile:t._id})).status&&Pn()(n).parents(".friend-item").hide()}catch(n){console.log(n)}},className:"friend-options-menu-item",children:[(0,kt.jsx)("div",{className:"menu-item-icon",children:(0,kt.jsx)("i",{className:"fas fa-user-plus"})}),(0,kt.jsx)("div",{className:"menu-item-text",children:"Add Friend"})]})})]})]})})},hJ=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsxs)("div",{className:"friend-item skeleton-card",children:[(0,kt.jsx)("div",{className:"friend-info",children:(0,kt.jsxs)(Tt,{to:"/",children:[(0,kt.jsx)("div",{className:"friend-profilePic",children:(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(fc,{})})}),(0,kt.jsx)("div",{className:"friend-details",children:(0,kt.jsxs)("div",{className:"skeleton-lines",children:[(0,kt.jsx)("div",{className:"skeleton-line short"}),(0,kt.jsx)("div",{className:"skeleton-line medium"})]})})]})}),(0,kt.jsx)("div",{className:"friend-options",children:(0,kt.jsx)("i",{className:"far fa-ellipsis-h"})})]},t)))},pJ=()=>{let e=En((e=>e.profile)),[t,n]=(0,a.useState)([]),[r,i]=(0,a.useState)(!0),[o,s]=(0,a.useState)(!1),c=Xe();return(0,a.useEffect)((()=>{let t=c.profile===e._id;if(s(t),t)return n(e.friends);pa.get("/friend/getFriends",{params:{profile:c.profile}}).then((e=>{i(e.data.length>0),n(e.data)})).catch((e=>console.log(e)))}),[c,e]),(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{id:"profile-friends-content",children:[(0,kt.jsx)("h4",{className:"section-title",children:"Friends"}),t.length>0?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"friend-items-container",children:t.map(((t,n)=>o?t._id!==e._id?(0,kt.jsx)(fJ,{friend:t},n):void 0:(0,kt.jsx)(fJ,{friend:t},n)))})}):(0,kt.jsx)(kt.Fragment,{children:r&&(0,kt.jsx)("div",{className:"friend-items-container",children:(0,kt.jsx)(hJ,{count:6})})})]})})},mJ=e=>{let{imageData:t,setImageIndex:n,setIsLightbox:r,imageIndex:i}=e,[o,s]=(0,a.useState)(!1);(0,a.useEffect)((()=>{Fn(t.photos,s)}),[]);let c=(0,a.useCallback)((e=>{r(!0),n(i)}),[]);return(0,kt.jsx)(kt.Fragment,{children:o?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"image-item",onClick:c.bind(void 0),children:(0,kt.jsx)("div",{className:"profile-image-container",children:(0,kt.jsx)("img",{src:t.photos,alt:t.caption||""})})})}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(fc,{})})})},gJ=()=>{let[e,t]=(0,a.useState)([]),{profile:n}=Xe(),r=He(),[i,o]=(0,a.useState)([]),[s,c]=(0,a.useState)(!1),[u,l]=(0,a.useState)(0);return(0,a.useEffect)((()=>{pa.get("profile/getImages",{params:{profileId:n}}).then((e=>{t(e.data),o([...e.data.map((e=>e.photos))])}))}),[r]),(0,kt.jsxs)("div",{id:"profile-images-container",children:[s&&(0,kt.jsx)(qQ,{setIsLightbox:c,setImageIndex:l,imageIndex:u,images:i,index:u}),(0,kt.jsx)("div",{className:"section-title",children:"Profile Images"}),(0,kt.jsx)("div",{className:"image-items-container mt-3",children:(0,kt.jsx)(Lz,{children:(0,kt.jsx)(Oz,{columnsCount:2,gutter:"10px",children:e&&e.length>1?e.map(((e,t)=>(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(mJ,{setImageIndex:l,setIsLightbox:c,imageIndex:t,imageData:e},t)}))):(0,kt.jsx)("p",{children:"No Images To Show"})})})})]})};const vJ=()=>{let{profile:e}=Xe(),t=En((e=>e.profile))||{},[n,r]=(t._id===e||t.username,(0,a.useState)(!1));const[i,o]=(0,a.useState)([]),s=(0,a.useRef)();return(0,a.useEffect)((()=>{pa.get("/watch/myWatchs",{params:{profile:e}}).then((e=>{200===e.status&&o(e.data)})),pa.get("/profile",{params:{profileId:e}}).then((e=>{r(e.data)})).catch((e=>console.log(e)))}),[e]),(0,a.useEffect)((()=>{pa.get("/profile",{params:{profileId:e}}).then((e=>{r(e.data)})).catch((e=>console.log(e)))}),[]),(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{id:"profile-post-content",children:[(0,kt.jsxs)("div",{className:"intro",children:[(0,kt.jsx)("h4",{className:"section-title",children:"Intro"}),(0,kt.jsx)("div",{className:"details",children:(0,kt.jsx)(cJ,{})})]}),(0,kt.jsx)("div",{className:"posts-container",ref:s,children:i.length>0?i.map(((e,n)=>(0,kt.jsx)(bc,{myProfile:t,watch:e},n))):(0,kt.jsx)(Os,{count:3})})]})})},yJ=JSON.parse('[{"id":1,"name":"Original phone ringtone","src":"https://programmerikram.com/wp-content/uploads/2025/05/original-phone-ringtone.mp3"},{"id":2,"name":"Phone ringtone bells","src":"https://programmerikram.com/wp-content/uploads/2025/05/phone-ringtone-bells.mp3"},{"id":3,"name":"Telephone Ringtone","src":"https://programmerikram.com/wp-content/uploads/2025/05/old-telephone.mp3"},{"id":4,"name":"Telephone Ringtone 2","src":"https://programmerikram.com/wp-content/uploads/2025/05/phone-ringtone-telephone.mp3"},{"id":5,"name":"Phone ringtone office","src":"https://programmerikram.com/wp-content/uploads/2025/05/phone-ringtone-office.mp3"}]'),bJ=e=>{let{myId:t}=e;const n=En((e=>e.setting)),[r,i]=(0,a.useState)(!1),[o,s]=(0,a.useState)(""),[c,u]=(0,a.useState)(""),[l,d]=(0,a.useState)(!1),[f,h]=(0,a.useState)(""),[p,m]=(0,a.useState)(!1),[g,v]=(0,a.useState)(!0),[y,b]=(0,a.useState)(!0),[_,w]=(0,a.useState)(!1),[E,S]=(0,a.useState)(!0),[C]=(0,a.useState)("auto"),[x,T]=(0,a.useState)(!1),[R,I]=(0,a.useState)(!1),[N,A]=(0,a.useState)(!1),[k,D]=(0,a.useState)(null),[M,L]=(0,a.useState)(null),[O,P]=(0,a.useState)(!1),[j,F]=(0,a.useState)(0),U=(0,a.useRef)(null),B=(0,a.useRef)(),V=(0,a.useRef)(),z=(0,a.useRef)(),W=(0,a.useRef)(),G=(0,a.useRef)(null),H=(0,a.useRef)(pj().createClient({mode:"rtc",codec:"vp8"})).current,Y=(0,a.useRef)([]),q=(0,a.useRef)(!1),K=(0,a.useRef)(!1),X=((0,a.useRef)(),(0,a.useRef)(),(0,a.useRef)(null)),Q=wa(),{minimizeCall:J,restoreCall:Z,endMinimizedCall:$,getMinimizedCall:ee,updateMinimizedCall:te}=gj(),ne=()=>null===W||void 0===W?void 0:W.current.pause(),re=Q?{width:56,height:56,borderRadius:"50%",padding:0,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 6px 16px rgba(0,0,0,0.35)",border:"1px solid rgba(255,255,255,0.08)",boxSizing:"border-box",overflow:"hidden",flexShrink:0,flexBasis:56}:{};(0,a.useEffect)((()=>{let e=null;return p&&!O&&(U.current||(U.current=Date.now()),e=setInterval((()=>{const e=Math.floor((Date.now()-U.current)/1e3);F(e)}),1e3)),()=>{e&&clearInterval(e)}}),[p,O]),(0,a.useEffect)((()=>{if(p&&O&&k&&U.current){const e="video-".concat(k);G.current=setInterval((()=>{const t=Math.floor((Date.now()-U.current)/1e3);try{te(e,{duration:t})}catch(Vc){}}),1e3)}return()=>{G.current&&(clearInterval(G.current),G.current=null)}}),[p,O,k,te]);const ie=async e=>{const{data:n}=await pa.post("/agora/token",{channelName:e,uid:t});return n},ae=(0,a.useCallback)((async e=>{try{console.log("Starting Agora call with channel:",e),m(!0),D(e),U.current||(U.current=Date.now());const{appId:r,token:i}=await ie(e);console.log("Got Agora token for channel:",e),q.current?console.warn("Join skipped: client already joining/joined"):(q.current=!0,await H.join(r,e,i,t),console.log("Joined Agora channel successfully"),setTimeout((()=>{const e=H.remoteUsers;console.log("Immediate check - Remote users in channel:",e.length),e.forEach((e=>{console.log("Remote user details:",{uid:e.uid,hasVideo:e.hasVideo,hasAudio:e.hasAudio})}))}),500));try{window.dispatchEvent(new Event("stopEmotionCamera"))}catch(Vc){}if(Y.current&&0!==Y.current.length)console.log("Using existing local tracks");else{try{Y.current=await pj().createMicrophoneAndCameraTracks()}catch(n){console.error("createMicrophoneAndCameraTracks failed, falling back to mic only:",n),Y.current=[await pj().createMicrophoneAudioTrack()]}console.log("Created local tracks"),B.current&&Y.current[1]&&(Y.current[1].play(B.current),console.log("Playing local video"))}await H.publish(Y.current),console.log("Published local tracks"),K.current||(K.current=!0,H.on("user-published",(async(e,t)=>{console.log("Remote user published:",e.uid,t);try{await H.subscribe(e,t),console.log("Successfully subscribed to",e.uid,t),"video"===t&&(V.current&&e.videoTrack?(V.current.innerHTML="",e.videoTrack.play(V.current),console.log("Playing remote video from user:",e.uid)):console.warn("Cannot play remote video - missing userVideo ref or videoTrack")),"audio"===t&&(e.audioTrack?(e.audioTrack.play(),console.log("Playing remote audio from user:",e.uid)):console.warn("Cannot play remote audio - missing audioTrack"))}catch(n){console.error("Error subscribing to user:",e.uid,t,n)}})),H.on("user-unpublished",(e=>{console.log("Remote user unpublished:",e.uid),V.current&&(V.current.innerHTML="")}))),setTimeout((async()=>{try{const e=H.remoteUsers;console.log("Checking for existing remote users:",e.length);for(const t of e)console.log("Found existing remote user:",t.uid,"hasVideo:",t.hasVideo,"hasAudio:",t.hasAudio),t.hasVideo&&!t.videoTrack?(console.log("Subscribing to existing user video:",t.uid),await H.subscribe(t,"video"),V.current&&t.videoTrack&&(t.videoTrack.play(V.current),console.log("Playing existing remote user video"))):t.hasVideo&&t.videoTrack&&V.current&&(t.videoTrack.play(V.current),console.log("Playing already subscribed remote video")),t.hasAudio&&!t.audioTrack?(console.log("Subscribing to existing user audio:",t.uid),await H.subscribe(t,"audio"),t.audioTrack&&(t.audioTrack.play(),console.log("Playing existing remote user audio"))):t.hasAudio&&t.audioTrack&&(t.audioTrack.play(),console.log("Playing already subscribed remote audio"))}catch(e){console.error("Error checking for existing remote users:",e)}}),1e3);let a=0;const o=5;X.current=setInterval((async()=>{a++;try{const e=H.remoteUsers;if(e.length>0){console.log("Periodic check ".concat(a,": Found ").concat(e.length," remote users"));for(const t of e)if(t.hasVideo&&t.videoTrack&&V.current){const e=V.current.querySelector("video");e&&!e.paused&&0!==e.readyState||(console.log("Periodic check ".concat(a,": Re-attempting to play remote video for user ").concat(t.uid)),V.current.innerHTML="",t.videoTrack.play(V.current))}}a>=o&&(clearInterval(X.current),X.current=null,console.log("Stopped periodic remote user checks"))}catch(e){console.error("Error in periodic check ".concat(a,":"),e)}}),2e3)}catch(r){console.error("Failed to start call:",r),alert("Failed to start call. Please try again."),i(!1),m(!1),q.current=!1}}),[H,t,ie]);(0,a.useEffect)((()=>{if(n.ringtone){const e=yJ.find((e=>e.id===n.ringtone)),t=(null===e||void 0===e?void 0:e.src)||"";null===W||void 0===W||W.current.setAttribute("src",t)}}),[n]),(0,a.useEffect)((()=>(Jo.on("agora-incoming-video-call",(async e=>{let{from:t,channelName:n,isAudio:r,callerName:a,callerProfilePic:o}=e;if(!r){console.log("Incoming Agora video call from",t,"channel:",n),console.log("Caller info:",{callerName:a,callerProfilePic:o}),i(!0),d(!0),h(t),L({from:t,channelName:n,name:a||"Unknown Caller",profilePic:o}),s(a||"Unknown Caller"),u(o||"https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png"),D(n);try{console.log("Starting local video for incoming call preview"),Y.current=await pj().createMicrophoneAndCameraTracks(),B.current&&Y.current[1]&&(Y.current[1].play(B.current),console.log("Local video preview started for incoming call"))}catch(c){console.error("Failed to start local video preview:",c)}setTimeout((()=>null===W||void 0===W?void 0:W.current.play()),500)}})),Jo.on("agora-call-accepted",(e=>{let{channelName:t,isAudio:n}=e;n||(console.log("Agora video call accepted, joining channel:",t),ne(),ae(t))})),Jo.on("videoCallEnd",(()=>{ne(),z.current&&z.current.dispatchEvent(new MouseEvent("click",{bubbles:!0}))})),Jo.on("agora-apply-video-filter",(e=>{let{filter:t}=e;I(""!==t?t:"")})),()=>{Jo.off("agora-incoming-video-call"),Jo.off("agora-call-accepted"),Jo.off("videoCallEnd"),Jo.off("agora-apply-video-filter")})),[ae]),(0,a.useEffect)((()=>{(async()=>{try{const e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));S(e.length>0)}catch(K$){console.error("Error checking video devices:",K$),S(!1)}})()}),[]);const oe=(0,a.useCallback)((async()=>{ne(),M&&(console.log("Answering Agora call"),Jo.emit("agora-answer-call",{to:M.from,channelName:M.channelName}),await ae(M.channelName))}),[M,ae]),se=(0,a.useCallback)((async()=>{if(ne(),Jo.emit("leaveVideoCall",f),X.current&&(clearInterval(X.current),X.current=null),k){const e="video-".concat(k);$(e)}Y.current.forEach((e=>e.close())),Y.current=[];try{await H.leave()}catch(e){console.log("Not connected to channel or already left")}q.current=!1,U.current=null,B.current&&(B.current.innerHTML=""),V.current&&(V.current.innerHTML=""),m(!1),i(!1),D(null),d(!1),L(null),h(""),s(""),u(""),P(!1),F(0),G.current&&(clearInterval(G.current),G.current=null)}),[f,H,k,$]),ce=(0,a.useCallback)((async()=>{const e=Y.current.find((e=>"audio"===e.kind));e?(console.log("VideoCall - Toggling microphone. Current state:",g,"New state:",!g),console.log("VideoCall - Audio track found:",e),console.log("VideoCall - Audio track kind:",e.kind),await e.setEnabled(!g),console.log("VideoCall - Audio track enabled state after toggle:",e.enabled)):(console.log("VideoCall - No audio track found in tracks:",Y.current),Y.current[0]&&(console.log("VideoCall - Using fallback - index 0 track:",Y.current[0]),await Y.current[0].setEnabled(!g))),v((e=>!e))}),[g]),ue=(0,a.useCallback)((async()=>{const e=Y.current.find((e=>"video"===e.kind));e?(console.log("VideoCall - Toggling camera. Current state:",y,"New state:",!y),console.log("VideoCall - Video track found:",e),console.log("VideoCall - Video track kind:",e.kind),await e.setEnabled(!y),console.log("VideoCall - Video track enabled state after toggle:",e.enabled)):(console.log("VideoCall - No video track found in tracks:",Y.current),Y.current[1]&&(console.log("VideoCall - Using fallback - index 1 track:",Y.current[1]),await Y.current[1].setEnabled(!y))),b((e=>!e))}),[y]),le=(0,a.useCallback)((()=>{if(!p||!k)return;const e="video-".concat(k);J({id:e,type:"video",callerName:o||"Unknown Caller",callerProfilePic:c,callerId:f,status:"connected",duration:j,isMuted:!g,isCameraOn:y,onRestore:()=>{P(!1),i(!0)},onEnd:()=>{se()},onToggleMute:()=>{ce()},onToggleCamera:()=>{ue()}}),P(!0),i(!1)}),[p,k,o,c,f,j,g,y,J,ce,ue,se]),de=((0,a.useCallback)((()=>{const e="video-".concat(k);Z(e),P(!1),i(!0)}),[k,Z]),(0,a.useCallback)((async()=>{const e=Y.current.find((e=>"video"===e.kind));if(e&&p)try{await H.unpublish([e]),e.close();const t=await pj().createCameraVideoTrack({facingMode:_?"user":"environment"}),n=Y.current.findIndex((e=>"video"===e.kind));-1!==n&&(Y.current[n]=t),await H.publish([t]),B.current&&t.play(B.current),w((e=>!e))}catch(t){console.error("Failed to switch camera:",t)}else w((e=>!e))}),[_,p,H]),(0,a.useCallback)((async()=>{if(x)try{document.fullscreenElement?await document.exitFullscreen():document.webkitFullscreenElement?await document.webkitExitFullscreen():document.mozFullScreenElement?await document.mozCancelFullScreen():document.msFullscreenElement&&await document.msExitFullscreen(),T(!1)}catch(K$){console.error("Failed to exit fullscreen:",K$),T(!1)}else try{const e=document.getElementById("videoCallModal");e&&e.requestFullscreen?await e.requestFullscreen():e&&e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e&&e.mozRequestFullScreen?await e.mozRequestFullScreen():e&&e.msRequestFullscreen&&await e.msRequestFullscreen(),T(!0)}catch(K$){console.error("Failed to enter fullscreen:",K$),T(!0)}}),[x])),fe=(0,a.useCallback)((()=>{if(null!==M&&void 0!==M&&M.from){const e=["video-vivid-filter","video-vivid-warm","video-vivid-cool","video-vivid-dramatic",""],t=e.indexOf(N),n=e[(t+1)%e.length];A(n),Jo.emit("agora-filter-video",{to:M.from,filter:n})}}),[N,M]);(0,a.useEffect)((()=>{const e=()=>{const e=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);T(e)};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)}}),[]);return(0,kt.jsxs)("div",{children:[(0,kt.jsx)(jn,{title:"Video Call",style:x?{}:{width:Q?"95%":"600px",top:"50%",height:C},isOpen:r&&!O,onRequestClose:()=>{},id:"videoCallModal",isFullscreen:x,children:(0,kt.jsxs)("div",{className:"".concat(p?"call-accepted":""," ").concat(x?"fullscreen-content":""),style:{padding:0},children:[(0,kt.jsxs)("h2",{className:"text-center vc-modal-heading",children:["Video Call - ",o,p?" \u2022 ".concat((e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))})(j)):""]}),!x&&(0,kt.jsx)("p",{className:"fs-4 text-center",children:l&&!p&&"".concat(o," Calling you")}),(0,kt.jsxs)("div",{className:"video-call-container ".concat(Q?"mobile":""),children:[(0,kt.jsx)("div",{ref:V,className:"receive-friends-video ".concat(R),style:{width:"100%",height:"400px",display:p?"block":"none",background:"#000",border:R?"3px solid #29B1A9":"none"},"data-video-type":"friend-remote-video"}),(0,kt.jsx)("div",{ref:B,className:"receive-my-video ".concat(N),style:{width:"150px",height:"100px",position:"absolute",bottom:"10px",right:"10px",background:"#222",display:r||l?"block":"none",borderRadius:"8px",zIndex:10,border:"2px solid gray"},"data-video-type":"my-local-video"})]}),(0,kt.jsxs)("div",{className:"call-buttons",style:Q?{display:"flex",gap:"10px",justifyContent:"space-between",alignItems:"center",background:"rgba(32,32,32,0.6)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:"16px",padding:"10px 12px",marginTop:"12px"}:{},children:[(0,kt.jsx)("button",{onClick:se,ref:z,className:"call-button-ends call-button bg-danger",style:re,children:(0,kt.jsx)("i",{className:"fa fa-phone",style:{color:"white"}})}),p&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("button",{onClick:ce,className:"call-button-microphone call-button",style:re,children:g?(0,kt.jsx)("i",{className:"fa fa-microphone",style:{color:"white"}}):(0,kt.jsx)("i",{className:"fa fa-microphone-slash",style:{color:"white"}})}),E&&(0,kt.jsx)("button",{onClick:ue,className:"call-button-camera call-button",style:re,children:y?(0,kt.jsx)("i",{className:"fa fa-video",style:{color:"white"}}):(0,kt.jsx)("i",{className:"fa fa-video-slash",style:{color:"white"}})}),(0,kt.jsx)("button",{onClick:fe,className:"call-button-filter call-button ".concat(N?"active":""),title:N?"Filter: ".concat(N.replace("video-vivid-","").replace("filter","vivid")):"No filter",style:re,children:(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",viewBox:"0 0 24 24",children:(0,kt.jsx)("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})})}),!Q&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("button",{onClick:de,className:"call-button-fullscreen call-button",children:x?(0,kt.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{d:"M8 3v3a2 2 0 0 1-2 2H3"}),(0,kt.jsx)("path",{d:"M21 8h-3a2 2 0 0 1-2-2V3"}),(0,kt.jsx)("path",{d:"M3 16h3a2 2 0 0 1 2 2v3"}),(0,kt.jsx)("path",{d:"M16 21v-3a2 2 0 0 1 2-2h3"})]}):(0,kt.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",viewBox:"0 0 24 24",children:[(0,kt.jsx)("path",{d:"M3 7V3a2 2 0 0 1 2-2h4"}),(0,kt.jsx)("path",{d:"M17 3h4a2 2 0 0 1 2 2v4"}),(0,kt.jsx)("path",{d:"M21 17v4a2 2 0 0 1-2 2h-4"}),(0,kt.jsx)("path",{d:"M7 21H3a2 2 0 0 1-2-2v-4"})]})}),(0,kt.jsx)("button",{onClick:le,className:"call-button-minimize call-button",title:"Minimize",children:(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{d:"M6 9l6 6 6-6"})})})]})]}),!p&&l&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("button",{onClick:oe,className:"call-button-receive call-button bg-success",style:re,children:(0,kt.jsx)("i",{className:"fa fa-phone-volume",style:{color:"white"}})}),(0,kt.jsx)("button",{onClick:se,className:"call-button-decline call-button bg-danger",style:re,children:(0,kt.jsx)("i",{className:"fa fa-phone-slash",style:{color:"white"}})})]})]})]})}),(0,kt.jsx)("audio",{ref:W,loop:!0})]})},_J=e=>{let{myId:t}=e;console.log("AudioCall - Component mounted/rendered with myId:",t);const n=En((e=>e.setting)),[r,i]=(0,a.useState)(!1),[o,s]=(0,a.useState)(""),[c,u]=(0,a.useState)(""),[l,d]=(0,a.useState)(!1),[f,h]=(0,a.useState)(""),[p,m]=(0,a.useState)(!1),[g,v]=(0,a.useState)(!0),[y,b]=(0,a.useState)(null),[_,w]=(0,a.useState)(null),[E,S]=(0,a.useState)(!1),[C,x]=(0,a.useState)(0),T=(0,a.useRef)(null),R=(0,a.useRef)(),I=(0,a.useRef)(),N=(0,a.useRef)(pj().createClient({mode:"rtc",codec:"vp8"})).current,A=(0,a.useRef)([]),k=(0,a.useRef)(!1),D=(0,a.useRef)(!1),M=wa(),{minimizeCall:L,restoreCall:O,endMinimizedCall:P}=gj(),j=()=>{null!==I&&void 0!==I&&I.current&&I.current.pause()},F=()=>{setTimeout((()=>{null!==I&&void 0!==I&&I.current&&I.current.play().catch((e=>{console.warn("Failed to play ringtone:",e)}))}),500)};(0,a.useEffect)((()=>{let e=null;return p&&!E&&(T.current||(T.current=Date.now()),e=setInterval((()=>{const e=Math.floor((Date.now()-T.current)/1e3);x(e)}),1e3)),()=>{e&&clearInterval(e)}}),[p,E]);const U=async e=>{const{data:n}=await pa.post("/agora/token",{channelName:e,uid:t});return n},B=(0,a.useCallback)((async e=>{try{console.log("Starting Agora audio call with channel:",e),m(!0),w(e),T.current||(T.current=Date.now());const{appId:n,token:r}=await U(e);console.log("Got Agora token for audio channel:",e),k.current?console.warn("Audio join skipped: client already joining/joined"):(k.current=!0,await N.join(n,e,r,t),console.log("Joined Agora audio channel successfully")),A.current&&0!==A.current.length?console.log("Using existing audio track"):(A.current=[await pj().createMicrophoneAudioTrack()],console.log("Created local audio track")),await N.publish(A.current),console.log("Published local audio track"),D.current||(D.current=!0,N.on("user-published",(async(e,t)=>{console.log("Remote user published:",e.uid,t),await N.subscribe(e,t),"audio"===t&&(e.audioTrack.play(),console.log("Playing remote audio"))})),N.on("user-unpublished",(e=>{console.log("Remote user unpublished:",e.uid)})))}catch(n){console.error("Failed to start audio call:",n),alert("Failed to start audio call. Please try again."),i(!1),m(!1),k.current=!1}}),[N,t,U]);(0,a.useEffect)((()=>{if(n.ringtone&&null!==I&&void 0!==I&&I.current){const e=yJ.find((e=>e.id===n.ringtone)),t=(null===e||void 0===e?void 0:e.src)||"";t&&(I.current.setAttribute("src",t),I.current.load())}}),[n]),(0,a.useEffect)((()=>{Jo.on("connect",(()=>{console.log("AudioCall - Socket connected")})),Jo.on("disconnect",(()=>{console.log("AudioCall - Socket disconnected")})),Jo.on("agora-incoming-audio-call",(e=>{let{from:t,channelName:n,isAudio:r,callerName:a,callerProfilePic:o}=e;r?(i(!0),d(!0),h(t),b({from:t,channelName:n,name:a||"Unknown Caller",profilePic:o}),s(a||"Unknown Caller"),u(o||"https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png"),w(n),F()):console.log("AudioCall - Ignoring video call (isAudio: false)")}));const e=e=>{const{to:n,channelName:r,callerName:a,callerProfilePic:o}=e.detail;console.log("AudioCall - Starting outgoing audio call to",n,"channel:",r),console.log("AudioCall - Friend info:",{callerName:a,callerProfilePic:o}),i(!0),d(!1),h(n),s(a||"Friend"),u(o||"https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png"),w(r),b({from:t,to:n,channelName:r,name:a||"Friend",profilePic:o}),console.log("AudioCall - Outgoing call modal should now be visible"),F()};return window.addEventListener("startAudioCall",e),Jo.on("agora-call-accepted",(e=>{let{channelName:t,isAudio:n}=e;n&&(console.log("Agora audio call accepted, joining channel:",t),j(),B(t))})),Jo.on("audioCallEnd",(()=>{j(),R.current&&R.current.dispatchEvent(new MouseEvent("click",{bubbles:!0}))})),()=>{Jo.off("agora-incoming-call"),Jo.off("agora-call-accepted"),Jo.off("audioCallEnd"),Jo.off("connect"),Jo.off("disconnect"),window.removeEventListener("startAudioCall",e)}}),[B]);const V=(0,a.useCallback)((async()=>{if(j(),y){console.log("Answering Agora audio call");try{console.log("Starting local audio for call answer"),A.current=[await pj().createMicrophoneAudioTrack()],console.log("Local audio started immediately")}catch(e){console.error("Failed to start local audio immediately:",e)}Jo.emit("agora-answer-call",{to:y.from,channelName:y.channelName,isAudio:!0}),await B(y.channelName)}}),[y,B]),z=(0,a.useCallback)((async()=>{if(j(),Jo.emit("leaveAudioCall",f),_){const e="audio-".concat(_);P(e)}A.current.forEach((e=>e.close())),A.current=[];try{await N.leave()}catch(e){console.log("Not connected to channel or already left")}k.current=!1,T.current=null,m(!1),i(!1),w(null),d(!1),b(null),h(""),s(""),u(""),S(!1),x(0)}),[f,N,_,P]),W=(0,a.useCallback)((async()=>{A.current[0]&&await A.current[0].setEnabled(!g),v((e=>!e))}),[g]),G=(0,a.useCallback)((()=>{if(!p||!_)return;const e="audio-".concat(_);L({id:e,type:"audio",callerName:o||"Unknown Caller",callerProfilePic:c,callerId:f,status:"connected",duration:C,isMuted:!g,isCameraOn:!1,onRestore:()=>{S(!1),i(!0)},onEnd:()=>{z()},onToggleMute:()=>{W()}}),S(!0),i(!1)}),[p,_,o,c,f,C,g,L,W,z]);return(0,kt.jsxs)("div",{children:[(0,kt.jsx)(jn,{title:"Audio Call",style:{width:M?"95%":"400px",top:"50%",height:"auto",borderRadius:"10px",zIndex:"9999"},isOpen:r&&!E,onRequestClose:()=>{console.log("AudioCall - Closing audio call modal"),i(!1),d(!1),m(!1),h(""),s(""),u(""),b(null),w(null),j()},id:"audioCallModal",children:(0,kt.jsxs)("div",{className:"".concat(p?"call-accepted":""),style:{padding:"20px",textAlign:"center"},children:[(0,kt.jsxs)("h2",{className:"text-center vc-modal-heading",children:["Audio Call",p?" \u2022 ".concat(String(Math.floor(C/60)).padStart(2,"0"),":").concat(String(C%60).padStart(2,"0")):""]}),(0,kt.jsxs)("p",{className:"fs-4 text-center",children:[l&&!p&&"".concat(o," is calling you"),!l&&!p&&"Calling ".concat(o,"..."),p&&"Connected - ".concat(o)]}),(0,kt.jsx)("div",{className:"audio-call-avatar",style:{margin:"30px 0"},children:(0,kt.jsx)("div",{style:{width:"120px",height:"120px",borderRadius:"50%",overflow:"hidden",margin:"0 auto",border:"3px solid #29B1A9"},children:c?(0,kt.jsx)("img",{src:c,alt:o,style:{width:"100%",height:"100%",objectFit:"cover"},onError:e=>{e.target.src="https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png"}}):(0,kt.jsx)("div",{style:{width:"100%",height:"100%",background:"#f0f0f0",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"48px",color:"#666"},children:(0,kt.jsx)("i",{className:"fas fa-user"})})})}),(0,kt.jsxs)("div",{className:"call-buttons",style:{display:"flex",justifyContent:"center",gap:"20px"},children:[(0,kt.jsx)("button",{onClick:z,ref:R,className:"call-button-ends call-button bg-danger",children:(0,kt.jsx)("i",{className:"fa fa-phone",style:{color:"white"}})}),p&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("button",{onClick:W,className:"call-button-microphone call-button",children:g?(0,kt.jsx)("i",{className:"fa fa-microphone",style:{color:"white"}}):(0,kt.jsx)("i",{className:"fa fa-microphone-slash",style:{color:"white"}})}),(0,kt.jsx)("button",{onClick:G,className:"call-button-minimize call-button",title:"Minimize",children:(0,kt.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",viewBox:"0 0 24 24",children:(0,kt.jsx)("path",{d:"M6 9l6 6 6-6"})})})]}),!p&&l&&(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("button",{onClick:V,className:"call-button-receive call-button bg-success",children:(0,kt.jsx)("i",{className:"fa fa-phone-volume",style:{color:"white"}})}),(0,kt.jsx)("button",{onClick:z,className:"call-button-decline call-button bg-danger",children:(0,kt.jsx)("i",{className:"fa fa-phone-slash",style:{color:"white"}})})]})]})]})}),(0,kt.jsx)("audio",{ref:I,loop:!0})]})},wJ="https://programmerikram.com/wp-content/uploads/2025/03/like-icon.svg",EJ=e=>{let{viewer:t,reacts:n}=e,[r,i]=(0,a.useState)(!1),[o,s]=(0,a.useState)("");return(0,a.useEffect)((()=>{(async()=>{let e=await pa.get("profile",{params:{profileId:t}});if(200==e.status){i(e.data);let r=n.filter((e=>e.profile==t));if(0==r.length)return;switch(r[0].type){case"like":default:s(wJ);break;case"love":s("https://programmerikram.com/wp-content/uploads/2025/03/love-icon.svg");break;case"haha":s("https://programmerikram.com/wp-content/uploads/2025/03/haha-icon.svg")}}})()}),[]),(0,kt.jsx)("div",{children:r&&(0,kt.jsxs)("li",{className:"sp-reacts-item",children:[(0,kt.jsx)("div",{className:"reactor-pp",children:(0,kt.jsx)(Un,{profilePic:r.profilePic,profile:r._id})}),(0,kt.jsx)("div",{className:"react-details",children:(0,kt.jsx)(Tt,{to:"/".concat(r._id),children:(0,kt.jsx)("span",{className:"reactor-name",children:r.fullName})})}),(0,kt.jsx)("span",{className:"reactor-react",children:o?(0,kt.jsx)("img",{src:o}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("img",{style:{visibility:"hidden"},src:""})})})]})})},SJ="https://programmerikram.com/wp-content/uploads/2025/03/like-icon.svg",CJ="https://programmerikram.com/wp-content/uploads/2025/03/love-icon.svg",xJ="https://programmerikram.com/wp-content/uploads/2025/03/haha-icon.svg",TJ=()=>{let{postId:e}=Xe(),[t,n]=(0,a.useState)(!1),[r,i]=(0,a.useState)(!1),[o,s]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),l=wa(),f=qe();const h=He().pathname.includes("edit");(0,a.useEffect)((()=>{(async()=>{let t=await pa.get("post/single",{params:{postId:e}});200==t.status&&n(t.data)})()}),[e]);let p=En((e=>e.profile)),m=p._id,g=t&&(null===t||void 0===t?void 0:t.author._id),[v,y]=(0,a.useState)(t&&t.reacts.length),[b,_]=(0,a.useState)(t&&t.shares.length),[w,E]=(0,a.useState)(t&&t.comments.length),[S,C]=(0,a.useState)(!1),[x,T]=(0,a.useState)([]);(0,a.useEffect)((()=>{y(t&&t.reacts.length),_(t&&t.shares.length),E(t&&t.comments.length)}),[t]);var R=m===g;let[I,N]=(0,a.useState)(t&&(null===t||void 0===t?void 0:t.author.profilePic)||"https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png"),A=t&&t.photos;(0,a.useEffect)((()=>{Fn(A,u)}),[A]),(0,a.useEffect)((()=>{let e=[];t&&t.reacts.map((t=>{if(t.profile){switch(t.type){case"like":e.includes("like")||e.push("like");break;case"love":e.includes("love")||e.push("love");break;case"haha":e.includes("haha")||e.push("haha")}t.profile===m&&C(t.type)}})),T(e)}),[]);let k=t&&(t.type||"post"),D=async e=>{let n=e.currentTarget;R?(0,Rs.ZX)({title:"Confirm Action",message:"Are you sure you want to delete this post?",buttons:[{label:"Yes",onClick:async()=>{let e=await pa.post("/post/delete",{postId:t._id,authorId:t.author._id});200===e.status?(Pn()(n).parents(".nf-post").css({"min-height":"0px",padding:"10px"}),Pn()(n).parents(".nf-post").html('<p class="fs-6 mb-0 text-center text-danger">'+e.data.message+"</p>")):alert("Failed to delete post")}},{label:"No",onClick:()=>{}}]}):Pn()(n).parents(".nf-post").hide()},M=async function(){y((e=>e-1));let e=await pa.post("/react/removeReact",{id:t._id,postType:"post"});return 200===e.status&&(y(e.data.reacts.length),C(""),!0)},L=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"post";y((e=>e+1));let r=await pa.post("/react/addReact",{id:t._id,postType:n,reactType:e});return 200===r.status&&(y(r.data.reacts.length),T([...x,e]),C(e),!0)},O=async e=>{let t=e.currentTarget;Pn()(t).parent().hasClass("reacted")?(M("post"),Pn()(t).parent().removeClass("reacted")):(L("like","post",t),Pn()(t).parent().addClass("reacted"))},P=async e=>{let t=e.currentTarget;Pn()(t).parents(".post-react-container").css("visibility","hidden"),Pn()(t).hasClass("reacted")?(M("post"),Pn()(t).removeClass("reacted")):(L("like","post",t),Pn()(t).addClass("reacted"),Pn()(e.currentTarget).siblings().removeClass("reacted")),setTimeout((()=>{Pn()(t).parents(".post-react-container").css("visibility","visible")}),500)},j=e=>{let t=e.currentTarget;Pn()(t).parents(".post-react-container").css("visibility","hidden"),Pn()(e.currentTarget).hasClass("reacted")?(M("post"),Pn()(e.currentTarget).removeClass("reacted")):(L("love","post"),Pn()(e.currentTarget).siblings().removeClass("reacted"),Pn()(e.currentTarget).addClass("reacted")),setTimeout((()=>{Pn()(t).parents(".post-react-container").css("visibility","visible")}),500)},F=e=>{let t=e.currentTarget;Pn()(t).parents(".post-react-container").css("visibility","hidden"),Pn()(e.currentTarget).hasClass("reacted")?(M(),Pn()(e.currentTarget).removeClass("reacted")):(L("haha","post",t),Pn()(e.currentTarget).siblings().removeClass("reacted"),Pn()(e.currentTarget).addClass("reacted")),setTimeout((()=>{Pn()(t).parents(".post-react-container").css("visibility","visible")}),500)},U=e=>{let t=e.currentTarget;Pn()(t).children(".post-react-container").css("visibility","visible")},B=e=>{let t=e.currentTarget;Pn()(t).parents(".footer").find(".field-comment-text").focus()},V=e=>{i(!0)},z=()=>{i(!1)},W=e=>{let t=e.currentTarget.value;s(t)},G=async e=>{e.preventDefault();let n=await pa.post("post/share",{postId:t._id,caption:o});_((e=>e+1)),200==n.status?i(!1):_(t&&t.shares.length)},H=()=>{f("edit")},Y=()=>{f("/post/".concat(e))},q=En((e=>e.profile.profilePic)),K=En((e=>e.profile._id)),X="".concat(t&&(null===t||void 0===t?void 0:t.author.profilePic)),[Q,J]=(0,a.useState)(window.matchMedia("(max-width: 768px)").matches);(0,a.useEffect)((()=>{window.matchMedia("(max-width:768px)").addEventListener("change",(e=>{J(e.matches)}))}),[]);let[Z,$]=(0,a.useState)("");(0,a.useEffect)((()=>{t.caption&&$(t.caption)}),[t.caption]);let ee=(0,a.useCallback)((async e=>(e.preventDefault(),$(e.target.value),n((t=>d(d({},t),{},{caption:e.target.value}))))),[]),te=(0,a.useCallback)((async n=>{200==(await pa.post("/post/update",{postId:e,caption:t.caption})).status&&Ft("Caption Updated")}),[]),ne=()=>{var e,n,i,a,u,d,f,m,g,y,_,E,C;return"share"===t.type?(0,kt.jsxs)("div",{className:"share-nf-post nf-post",children:[(0,kt.jsxs)("div",{className:"header",children:[(0,kt.jsx)("div",{className:"reason",children:(0,kt.jsxs)("span",{className:"fs-5",children:[(0,kt.jsx)("b",{children:(0,kt.jsx)(Tt,{to:"/".concat(t.author._id),children:t.author.fullName})})," Shared ",(0,kt.jsxs)("b",{children:[(0,kt.jsxs)(Tt,{to:"/".concat(null===(e=t.parentPost)||void 0===e||null===(n=e.author)||void 0===n?void 0:n._id),children:[null===(i=t.parentPost)||void 0===i||null===(a=i.author)||void 0===a?void 0:a.fullName,"'s"]})," "]}),(0,kt.jsx)("span",{className:"text-capitalize",children:null===(u=t.parentPost)||void 0===u?void 0:u.type})]})}),(0,kt.jsxs)("div",{className:"author-info",children:[(0,kt.jsxs)("div",{className:"left",children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:t.author.profilePic,profile:t.author._id,active:t.author.isActive})}),(0,kt.jsxs)("div",{className:"post-nd-container",children:[(0,kt.jsxs)(Tt,{to:"/"+t.author._id,children:[(0,kt.jsx)("h4",{className:"author-name",children:t.author.fullName}),t.feelings&&(0,kt.jsxs)("span",{className:"post-feelings",children:[" ",(0,kt.jsx)("small",{className:"text-lowercase text-secondary",children:"is felling"})," ",t.feelings||""]}),t.location&&(0,kt.jsxs)("span",{className:"post-location",children:[" ",(0,kt.jsx)("small",{className:"text-lowercase text-secondary",children:" at"})," ",t.location||""]})]}),(0,kt.jsx)("span",{className:"post-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:t.createdAt})})]})]}),(0,kt.jsxs)("div",{className:"right",children:[R&&(0,kt.jsx)("button",{className:"post-three-dot",children:(0,kt.jsx)("i",{className:"far fa-ellipsis-h"})}),(0,kt.jsxs)("button",{onClick:D.bind(void 0),className:"post-close",children:[" ",(0,kt.jsx)("i",{className:"far fa-times"})]})]})]})]}),(0,kt.jsxs)("div",{className:"nf-post ".concat(k," m-3 border body overflow-hidden"),children:[(0,kt.jsxs)("div",{className:"header",children:["profilePic"===k&&(0,kt.jsxs)("div",{className:"reason",children:[(0,kt.jsx)("span",{className:"d-none",children:(0,kt.jsx)("b",{children:"Shared a photos"})}),(0,kt.jsx)("span",{children:"Updated Profile Picture"})]}),(0,kt.jsxs)("div",{className:"author-info",children:[(0,kt.jsxs)("div",{className:"left",children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:null===(d=t.parentPost)||void 0===d||null===(f=d.author)||void 0===f?void 0:f.profilePic,profile:null===(m=t.parentPost)||void 0===m||null===(g=m.author)||void 0===g?void 0:g._id})}),(0,kt.jsxs)("div",{className:"post-nd-container",children:[(0,kt.jsxs)(Tt,{to:"/"+t.author._id,children:[(0,kt.jsx)("h4",{className:"author-name",children:null===(y=t.parentPost)||void 0===y||null===(_=y.author)||void 0===_?void 0:_.fullName}),t.feelings&&(0,kt.jsxs)("span",{className:"post-feelings",children:[" ",(0,kt.jsx)("small",{className:"text-lowercase text-secondary",children:"is felling"})," ",t.feelings||""]}),t.location&&(0,kt.jsxs)("span",{className:"post-location",children:[" ",(0,kt.jsx)("small",{className:"text-lowercase text-secondary",children:" at"})," ",t.location||""]})]}),(0,kt.jsx)("span",{className:"post-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:null===(E=t.parentPost)||void 0===E?void 0:E.createdAt})})]})]}),(0,kt.jsx)("div",{className:"right"})]})]}),(0,kt.jsx)("p",{className:"caption",children:t.caption}),(0,kt.jsxs)("div",{className:"body",children:[(0,kt.jsx)("p",{className:"caption",children:null===(C=t.parentPost)||void 0===C?void 0:C.caption}),c?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"attachment",children:(0,kt.jsx)(Tt,{to:"/post/".concat(t._id),children:(0,kt.jsx)("img",{src:A,alt:"post"})})})}):(0,kt.jsx)(kt.Fragment,{children:Ns(A)&&(0,kt.jsx)(Is,{})})]})]}),(0,kt.jsxs)("div",{className:"footer",children:[(0,kt.jsxs)("div",{className:"react-count",children:[(0,kt.jsxs)("div",{className:"reacts",children:[x.includes("like")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:SJ,alt:"like"}),"  "]}):(0,kt.jsx)("span",{}),x.includes("love")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:CJ,alt:"love"})," "]}):(0,kt.jsx)("span",{}),x.includes("haha")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:xJ,alt:"love"})," "]}):(0,kt.jsx)("span",{}),(0,kt.jsxs)("span",{className:"text",children:[t.reacts&&v," ",v>1?"Reacts":"React"]})]}),(0,kt.jsxs)("div",{className:"comment-share",children:[(0,kt.jsxs)("div",{className:"comment",children:[(0,kt.jsx)("div",{className:"text",children:t.comments&&w}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})})]}),(0,kt.jsxs)("div",{className:"shares",children:[(0,kt.jsx)("div",{className:"text",children:t.shares&&b}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"fa fa-share"})})]})]})]}),(0,kt.jsx)("div",{className:"like-comment-share",children:(0,kt.jsxs)("div",{className:"buttons-container",children:[(0,kt.jsxs)("div",{className:"react-buttons button ".concat(S?"reacted":""),children:[(0,kt.jsxs)("div",{onClick:O,onMouseOver:U,className:"react-like ".concat(1==S?"reacted":""),children:[(0,kt.jsxs)("span",{className:"react-icon",datatype:S||"",children:["haha"==S?(0,kt.jsx)("img",{src:xJ,alt:"haha"}):(0,kt.jsx)("span",{}),"love"==S?(0,kt.jsx)("img",{src:CJ,alt:"love"}):(0,kt.jsx)("span",{}),0==S||"like"==S?(0,kt.jsx)("img",{src:SJ,alt:"like"}):(0,kt.jsx)("span",{})]}),(0,kt.jsx)("span",{className:"text text-capitalize",children:S||"like"})]}),(0,kt.jsxs)("div",{className:"post-react-container",children:[(0,kt.jsx)("div",{className:"react react-like ".concat("like"==S?"reacted":""),onClick:P,id:"postReactLike",title:"Like",children:(0,kt.jsx)("img",{src:SJ,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-love ".concat("love"==S?"reacted":""),onClick:j,id:"postReactLove",title:"Love",children:(0,kt.jsx)("img",{src:CJ,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-haha ".concat("haha"==S?"reacted":""),onClick:F,id:"postReactHaha",title:"Haha",children:(0,kt.jsx)("img",{src:xJ,alt:"haha"})})]})]}),(0,kt.jsxs)("div",{onClick:B,className:"comment button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})}),(0,kt.jsx)("span",{className:"text",children:"Comment"})]}),(0,kt.jsxs)("div",{onClick:V,className:"share button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-share"})}),(0,kt.jsx)("span",{className:"text",children:"Share"})]}),(0,kt.jsxs)(jn,{title:"View Cover Photo",style:{width:l?"95%":"600px",top:"50%"},isOpen:r,onRequestClose:z,id:"cp-view-modal",children:[(0,kt.jsxs)("div",{className:"modal-header",children:[(0,kt.jsx)("div",{}),(0,kt.jsx)("div",{onClick:z,className:"modal-close-btn text-danger",children:(0,kt.jsx)("i",{className:"far fa-times"})})]}),(0,kt.jsx)("div",{className:"modal-body",children:(0,kt.jsxs)("div",{className:"share-post-container",children:[(0,kt.jsxs)("div",{className:"share-post-header",children:[(0,kt.jsxs)("div",{className:"row",children:[(0,kt.jsx)("div",{className:"col-1",children:(0,kt.jsx)(Un,{profilePic:p.profilePic})}),(0,kt.jsx)("div",{className:"col-3",children:(0,kt.jsx)("h3",{children:p.fullName})})]}),(0,kt.jsx)("div",{className:"row",children:(0,kt.jsxs)("div",{className:"col",children:["Your Sharing ",t.author.fullName||"Someone","'s Post"]})})]}),(0,kt.jsxs)("div",{className:"share-post-body my-3",children:[(0,kt.jsx)("textarea",{className:"form-control",rows:"3",onChange:W.bind(void 0),placeholder:"What's On Your Mind?"}),(0,kt.jsx)("div",{className:"share-post-button text-end mt-2",children:(0,kt.jsx)("button",{className:"btn btn-primary",onClick:G,children:"Share Now"})})]}),(0,kt.jsx)("div",{className:"share-post-footer"})]})})]})]})})]})]}):(0,kt.jsxs)("div",{className:"nf-post ".concat(k),children:[(0,kt.jsxs)("div",{className:"header",children:["profilePic"===k&&(0,kt.jsxs)("div",{className:"reason",children:[(0,kt.jsxs)("span",{className:"d-none",children:[(0,kt.jsx)("b",{children:"A bitch"})," commented."]}),(0,kt.jsx)("span",{children:"Updated Profile Picture"})]}),(0,kt.jsxs)("div",{className:"author-info",children:[(0,kt.jsxs)("div",{className:"left",children:[(0,kt.jsx)("div",{className:"author-pp",children:(0,kt.jsx)(Un,{profilePic:X,profile:t.author._id,active:t.author.isActive})}),(0,kt.jsxs)("div",{className:"post-nd-container",children:[(0,kt.jsxs)("h4",{className:"author-name",children:[(0,kt.jsx)(Tt,{to:"/"+t.author._id,children:t.author.fullName}),t.fellings&&(0,kt.jsxs)("span",{className:"post-feelings",children:[" ",(0,kt.jsx)("small",{className:"text-lowercase text-secondary",children:"is felling"})," ",t.fellings||""]}),t.location&&(0,kt.jsxs)("span",{className:"post-location",children:[" ",(0,kt.jsx)("small",{className:"text-lowercase text-secondary",children:" at"})," ",t.location||""]})]}),(0,kt.jsx)("span",{className:"post-time",children:(0,kt.jsx)(xa(),{fromNow:!0,children:t.createdAt})})]})]}),(0,kt.jsxs)("div",{className:"right",children:[R&&!h&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("button",{onClick:H,className:"post-three-dot",children:(0,kt.jsx)("i",{className:"far fs-6 fa-pen"})})}),h&&(0,kt.jsx)("button",{onClick:Y,className:"post-three-dot",children:(0,kt.jsx)("i",{className:"fas fa-arrow-left"})}),(0,kt.jsxs)("button",{onClick:D.bind(void 0),className:"post-close",children:[" ",(0,kt.jsx)("i",{className:"far fa-times"})]})]})]})]}),(0,kt.jsxs)("div",{className:"body",children:[R&&h?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"input-group",children:[(0,kt.jsx)("input",{onChange:ee.bind(void 0),className:"caption-editor form-control mb-2",placeholder:"Enter Your Caption",value:Z}),(0,kt.jsx)("div",{className:"input-group-prepend",children:(0,kt.jsx)("button",{onClick:te,className:"btn btn-primary",children:"Update"})})]})}):(0,kt.jsx)("p",{className:"caption",children:t.caption}),c?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"attachment",children:(0,kt.jsx)(Tt,{to:"/post/".concat(t._id),children:(0,kt.jsx)("img",{src:A,alt:"post"})})})}):(0,kt.jsx)(kt.Fragment,{children:Ns(A)&&(0,kt.jsx)(Is,{})})]}),(0,kt.jsxs)("div",{className:"footer",children:[(0,kt.jsxs)("div",{className:"react-count",children:[(0,kt.jsxs)("div",{className:"reacts",children:[x.includes("like")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:SJ,alt:"like"}),"  "]}):(0,kt.jsx)("span",{}),x.includes("love")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:CJ,alt:"love"})," "]}):(0,kt.jsx)("span",{}),x.includes("haha")?(0,kt.jsxs)("div",{className:"react",children:[" ",(0,kt.jsx)("img",{src:xJ,alt:"love"})," "]}):(0,kt.jsx)("span",{}),(0,kt.jsxs)("span",{className:"text",children:[t.reacts&&v," ",v>1?"Reacts":"React"]})]}),(0,kt.jsxs)("div",{className:"comment-share",children:[(0,kt.jsxs)("div",{className:"comment",children:[(0,kt.jsx)("div",{className:"text",children:t.comments&&w}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})})]}),(0,kt.jsxs)("div",{className:"shares",children:[(0,kt.jsx)("div",{className:"text",children:t.shares&&b}),(0,kt.jsx)("div",{className:"icon",children:(0,kt.jsx)("i",{className:"fa fa-share"})})]})]})]}),(0,kt.jsx)("div",{className:"like-comment-share",children:(0,kt.jsxs)("div",{className:"buttons-container",children:[(0,kt.jsxs)("div",{className:"react-buttons button ".concat(S?"reacted":""),children:[(0,kt.jsxs)("div",{onClick:O,onMouseOver:U,className:"react-like ".concat(1==S?"reacted":""),children:[(0,kt.jsxs)("span",{className:"react-icon",datatype:S||"",children:["haha"==S?(0,kt.jsx)("img",{src:xJ,alt:"haha"}):(0,kt.jsx)("span",{}),"love"==S?(0,kt.jsx)("img",{src:CJ,alt:"love"}):(0,kt.jsx)("span",{}),0==S||"like"==S?(0,kt.jsx)("img",{src:SJ,alt:"like"}):(0,kt.jsx)("span",{})]}),(0,kt.jsx)("span",{className:"text text-capitalize",children:S||"like"})]}),(0,kt.jsxs)("div",{className:"post-react-container",children:[(0,kt.jsx)("div",{className:"react react-like ".concat("like"==S?"reacted":""),onClick:P,id:"postReactLike",title:"Like",children:(0,kt.jsx)("img",{src:SJ,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-love ".concat("love"==S?"reacted":""),onClick:j,id:"postReactLove",title:"Love",children:(0,kt.jsx)("img",{src:CJ,alt:"love"})}),(0,kt.jsx)("div",{className:"react react-haha ".concat("haha"==S?"reacted":""),onClick:F,id:"postReactHaha",title:"Haha",children:(0,kt.jsx)("img",{src:xJ,alt:"haha"})})]})]}),(0,kt.jsxs)("div",{onClick:B,className:"comment button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-comment-alt"})}),(0,kt.jsx)("span",{className:"text",children:"Comment"})]}),(0,kt.jsxs)("div",{onClick:V,className:"share button",children:[(0,kt.jsx)("span",{className:"icon",children:(0,kt.jsx)("i",{className:"far fa-share"})}),(0,kt.jsx)("span",{className:"text",children:"Share"}),(0,kt.jsxs)(jn,{title:"Share Post",style:{width:l?"95%":"600px",top:"50%"},isOpen:r,onRequestClose:z,id:"cp-view-modal",children:[(0,kt.jsxs)("div",{className:"modal-header",children:[(0,kt.jsx)("div",{}),(0,kt.jsx)("div",{onClick:z,className:"modal-close-btn text-danger",children:(0,kt.jsx)("i",{className:"far fa-times"})})]}),(0,kt.jsx)("div",{className:"modal-body",children:(0,kt.jsxs)("div",{className:"share-post-container",children:[(0,kt.jsxs)("div",{className:"share-post-header",children:[(0,kt.jsxs)("div",{className:"row",children:[(0,kt.jsx)("div",{className:"col-1",children:(0,kt.jsx)(Un,{profilePic:p.profilePic})}),(0,kt.jsx)("div",{className:"col-3",children:(0,kt.jsx)("h3",{children:p.fullName})})]}),(0,kt.jsx)("div",{className:"row",children:(0,kt.jsxs)("div",{className:"col",children:["Your Sharing ",t.author.fullName||"Someone","'s Post"]})})]}),(0,kt.jsxs)("div",{className:"share-post-body my-3",children:[(0,kt.jsx)("textarea",{className:"form-control",onChange:e=>s(e.target.value),value:o}),(0,kt.jsx)("div",{className:"share-post-button text-end mt-2",children:(0,kt.jsx)("button",{className:"btn btn-primary",onClick:G,children:"Share Now"})})]}),(0,kt.jsx)("div",{className:"share-post-footer"})]})})]})]})]})})]})]})};return(0,kt.jsx)("div",{children:(0,kt.jsx)(en,{className:"single-post-container",children:(0,kt.jsxs)(rn,{children:[(0,kt.jsx)(cn,{md:"6",className:"br",children:(0,kt.jsx)("div",{id:"post-container",children:(0,kt.jsx)("div",{children:t&&(0,kt.jsx)(ne,{})})})}),(0,kt.jsx)(cn,{md:"3",className:"br",children:(0,kt.jsxs)("div",{className:"sp-reacts-container",children:[(0,kt.jsxs)("h4",{className:"section-title",children:["Views ",t.viewers&&"(".concat(t.viewers.length,")")]}),(0,kt.jsx)("ul",{className:"sp-reacts",children:t.viewers&&t.viewers.map(((e,n)=>(0,kt.jsx)(EJ,{reacts:t.reacts,viewer:e._id},n)))})]})}),(0,kt.jsx)(cn,{md:"3",children:(0,kt.jsxs)("div",{className:"sp-comments-container",children:[(0,kt.jsxs)("h4",{className:"section-title",children:["Comments ",(null===t||void 0===t?void 0:t.comments)&&"(".concat(null===t||void 0===t?void 0:t.comments.length,")")]}),(null===t||void 0===t?void 0:t.comments)&&(0,kt.jsx)(Ts,{post:t,commentState:E,allComments:t.comments||[],myProfile:p,authProfile:K,isEditMode:h,authProfilePicture:q})]})})]})})})},RJ=()=>(0,kt.jsx)("div",{children:"post comments"}),IJ=()=>(0,kt.jsx)("div",{children:"post reacts"}),NJ="SET_LOGIN",AJ=e=>({type:NJ,payload:e});var kJ=function(){return kJ=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},kJ.apply(this,arguments)},DJ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},MJ=function(e){var t=0;if(0===e.length)return!1;for(;t<e.length;){var n=e.charAt(t);if(n==n.toLowerCase());else if(n==n.toUpperCase())return!0;t++}return!1},LJ=function(e){var t=0;if(0===e.length)return!1;for(;t<e.length;){var n=e.charAt(t);if(n==n.toUpperCase());else if(n==n.toLowerCase())return!0;t++}return!1},OJ=function(e){var t=e.valid,n=e.iconSize,r=e.validColor,i=e.invalidColor,o=e.validTextColor,s=e.invalidTextColor,c=e.iconComponents,u=e.hideIcon,l=e.rtl,d=e.children,f=e.itemClassName;return a.createElement("li",{className:"".concat(f," ").concat(t?"valid":"invalid"),style:{listStyleType:"none",display:"flex",alignItems:"center",margin:"2px 0"}},u?null:c?t?c.ValidIcon:c.InvalidIcon:a.createElement("svg",{className:"checklist-icon",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 512 512",style:{marginRight:l?0:5,marginLeft:l?5:0}},a.createElement("path",{fill:t?r:i,d:t?"M432 64l-240 240-112-112-80 80 192 192 320-320z":"M507.331 411.33c-0.002-0.002-0.004-0.004-0.006-0.005l-155.322-155.325 155.322-155.325c0.002-0.002 0.004-0.003 0.006-0.005 1.672-1.673 2.881-3.627 3.656-5.708 2.123-5.688 0.912-12.341-3.662-16.915l-73.373-73.373c-4.574-4.573-11.225-5.783-16.914-3.66-2.080 0.775-4.035 1.984-5.709 3.655 0 0.002-0.002 0.003-0.004 0.005l-155.324 155.326-155.324-155.325c-0.002-0.002-0.003-0.003-0.005-0.005-1.673-1.671-3.627-2.88-5.707-3.655-5.69-2.124-12.341-0.913-16.915 3.66l-73.374 73.374c-4.574 4.574-5.784 11.226-3.661 16.914 0.776 2.080 1.985 4.036 3.656 5.708 0.002 0.001 0.003 0.003 0.005 0.005l155.325 155.324-155.325 155.326c-0.001 0.002-0.003 0.003-0.004 0.005-1.671 1.673-2.88 3.627-3.657 5.707-2.124 5.688-0.913 12.341 3.661 16.915l73.374 73.373c4.575 4.574 11.226 5.784 16.915 3.661 2.080-0.776 4.035-1.985 5.708-3.656 0.001-0.002 0.003-0.003 0.005-0.005l155.324-155.325 155.324 155.325c0.002 0.001 0.004 0.003 0.006 0.004 1.674 1.672 3.627 2.881 5.707 3.657 5.689 2.123 12.342 0.913 16.914-3.661l73.373-73.374c4.574-4.574 5.785-11.227 3.662-16.915-0.776-2.080-1.985-4.034-3.657-5.707z"})),a.createElement("span",{style:{paddingTop:2,opacity:t?1:s?void 0:.5,flex:1,color:t?o:s}},d))};const PJ=function(e){var t=e.className,n=e.style,r=e.rules,i=e.value,o=e.valueAgain,s=e.minLength,c=e.maxLength,u=e.rtl,l=e.onChange,d=e.specialCharsRegex,f=void 0===d?/[~`\xbf\xa1!#$%\^&*\u20ac\xa3@+\xf7=\-\[\]\\';,/{}\(\)|\\":<>\?\.\_]/g:d,h=e.messages,p=void 0===h?{}:h,m=DJ(e,["className","style","rules","value","valueAgain","minLength","maxLength","rtl","onChange","specialCharsRegex","messages"]),g={minLength:{valid:i.length>=(s||100),message:p.minLength||"Password has at least ".concat(s," characters.")},specialChar:{valid:f.test(i),message:p.specialChar||"Password has special characters."},number:{valid:/\d/g.test(i),message:p.number||"Password has a number."},match:{valid:i.length>0&&i===o,message:p.match||"Passwords match."},capital:{valid:MJ(i),message:p.capital||"Password has a capital letter."},lowercase:{valid:LJ(i),message:p.lowercase||"Password has a lowercase letter."},capitalAndLowercase:{valid:MJ(i)&&LJ(i),message:p.capitalAndLowercase||"Password contains at least one uppercase and lowercase characters."},letter:{valid:/[a-zA-Z]/g.test(i),message:p.letter||"Password has a letter."},maxLength:{valid:i.length<=(c||16),message:p.maxLength||"Password has no more than ".concat(c," characters.")},notEmpty:{valid:Boolean(i.length>0&&o&&o.length>0),message:p.notEmpty||"Password fields are not empty."},noSpaces:{valid:Boolean(i.length>0&&!/\s/.test(i)),message:p.noSpaces||"Password contains no spaces."}},v=(0,a.useMemo)((function(){return r.filter((function(e){return Boolean(g[e])}))}),[r]),y=v.every((function(e){return g[e].valid})),b=(0,a.useMemo)((function(){return v.filter((function(e){return!g[e].valid}))}),[i,o,v]);return(0,a.useEffect)((function(){"function"===typeof l&&l(y,b)}),[y,b]),u&&(t=t?t+" rtl":"rtl"),a.createElement("ul",{className:t,style:kJ({margin:0,padding:0},n)},v.map((function(e){var t=g[e],n=t.message,r=t.valid;return a.createElement(OJ,kJ({key:e,valid:r,iconSize:18,validColor:"#4BCA81",invalidColor:"#FF0033",rtl:u},m),n)})))};var jJ=n(1899),FJ=n.n(jJ);const UJ={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function BJ(e){return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const VJ={date:BJ({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:BJ({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:BJ({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},zJ={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function WJ(e){return(t,n)=>{let r;if("formatting"===(null!==n&&void 0!==n&&n.context?String(n.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,i=null!==n&&void 0!==n&&n.width?String(n.width):t;r=e.formattingValues[i]||e.formattingValues[t]}else{const t=e.defaultWidth,i=null!==n&&void 0!==n&&n.width?String(n.width):e.defaultWidth;r=e.values[i]||e.values[t]}return r[e.argumentCallback?e.argumentCallback(t):t]}}const GJ={ordinalNumber:(e,t)=>{const n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:WJ({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:WJ({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:WJ({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:WJ({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:WJ({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function HJ(e){return function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=n.width,i=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],a=t.match(i);if(!a)return null;const o=a[0],s=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(s)?function(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n;return}(s,(e=>e.test(o))):function(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n;return}(s,(e=>e.test(o)));let u;u=e.valueCallback?e.valueCallback(c):c,u=n.valueCallback?n.valueCallback(u):u;return{value:u,rest:t.slice(o.length)}}}const YJ={ordinalNumber:(qJ={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)},function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.match(qJ.matchPattern);if(!n)return null;const r=n[0],i=e.match(qJ.parsePattern);if(!i)return null;let a=qJ.valueCallback?qJ.valueCallback(i[0]):i[0];return a=t.valueCallback?t.valueCallback(a):a,{value:a,rest:e.slice(r.length)}}),era:HJ({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:HJ({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:HJ({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:HJ({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:HJ({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})};var qJ;const KJ={code:"en-US",formatDistance:(e,t,n)=>{let r;const i=UJ[e];return r="string"===typeof i?i:1===t?i.one:i.other.replace("{{count}}",t.toString()),null!==n&&void 0!==n&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r},formatLong:VJ,formatRelative:(e,t,n,r)=>zJ[e],localize:GJ,match:YJ,options:{weekStartsOn:0,firstWeekContainsDate:1}};let XJ={};function QJ(){return XJ}Math.pow(10,8);const JJ=6048e5,ZJ=Symbol.for("constructDateFrom");function $J(e,t){return"function"===typeof e?e(t):e&&"object"===typeof e&&ZJ in e?e[ZJ](t):e instanceof Date?new e.constructor(t):new Date(t)}function eZ(e,t){return $J(t||e,e)}function tZ(e){const t=eZ(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function nZ(e,t){const n=eZ(e,null===t||void 0===t?void 0:t.in);return n.setHours(0,0,0,0),n}function rZ(e,t,n){const[r,i]=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=$J.bind(null,e||n.find((e=>"object"===typeof e)));return n.map(i)}(null===n||void 0===n?void 0:n.in,e,t),a=nZ(r),o=nZ(i),s=+a-tZ(a),c=+o-tZ(o);return Math.round((s-c)/864e5)}function iZ(e,t){const n=eZ(e,null===t||void 0===t?void 0:t.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}function aZ(e,t){const n=eZ(e,null===t||void 0===t?void 0:t.in);return rZ(n,iZ(n))+1}function oZ(e,t){var n,r,i,a,o,s;const c=QJ(),u=null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.weekStartsOn)&&void 0!==i?i:c.weekStartsOn)&&void 0!==r?r:null===(s=c.locale)||void 0===s||null===(s=s.options)||void 0===s?void 0:s.weekStartsOn)&&void 0!==n?n:0,l=eZ(e,null===t||void 0===t?void 0:t.in),d=l.getDay(),f=(d<u?7:0)+d-u;return l.setDate(l.getDate()-f),l.setHours(0,0,0,0),l}function sZ(e,t){return oZ(e,d(d({},t),{},{weekStartsOn:1}))}function cZ(e,t){const n=eZ(e,null===t||void 0===t?void 0:t.in),r=n.getFullYear(),i=$J(n,0);i.setFullYear(r+1,0,4),i.setHours(0,0,0,0);const a=sZ(i),o=$J(n,0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);const s=sZ(o);return n.getTime()>=a.getTime()?r+1:n.getTime()>=s.getTime()?r:r-1}function uZ(e,t){const n=cZ(e,t),r=$J((null===t||void 0===t?void 0:t.in)||e,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),sZ(r)}function lZ(e,t){const n=eZ(e,null===t||void 0===t?void 0:t.in),r=+sZ(n)-+uZ(n);return Math.round(r/JJ)+1}function dZ(e,t){var n,r,i,a,o,s;const c=eZ(e,null===t||void 0===t?void 0:t.in),u=c.getFullYear(),l=QJ(),d=null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==i?i:l.firstWeekContainsDate)&&void 0!==r?r:null===(s=l.locale)||void 0===s||null===(s=s.options)||void 0===s?void 0:s.firstWeekContainsDate)&&void 0!==n?n:1,f=$J((null===t||void 0===t?void 0:t.in)||e,0);f.setFullYear(u+1,0,d),f.setHours(0,0,0,0);const h=oZ(f,t),p=$J((null===t||void 0===t?void 0:t.in)||e,0);p.setFullYear(u,0,d),p.setHours(0,0,0,0);const m=oZ(p,t);return+c>=+h?u+1:+c>=+m?u:u-1}function fZ(e,t){var n,r,i,a,o,s;const c=QJ(),u=null!==(n=null!==(r=null!==(i=null!==(a=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==a?a:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(o=o.options)||void 0===o?void 0:o.firstWeekContainsDate)&&void 0!==i?i:c.firstWeekContainsDate)&&void 0!==r?r:null===(s=c.locale)||void 0===s||null===(s=s.options)||void 0===s?void 0:s.firstWeekContainsDate)&&void 0!==n?n:1,l=dZ(e,t),d=$J((null===t||void 0===t?void 0:t.in)||e,0);d.setFullYear(l,0,u),d.setHours(0,0,0,0);return oZ(d,t)}function hZ(e,t){const n=eZ(e,null===t||void 0===t?void 0:t.in),r=+oZ(n,t)-+fZ(n,t);return Math.round(r/JJ)+1}function pZ(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const mZ={y(e,t){const n=e.getFullYear(),r=n>0?n:1-n;return pZ("yy"===t?r%100:r,t.length)},M(e,t){const n=e.getMonth();return"M"===t?String(n+1):pZ(n+1,2)},d:(e,t)=>pZ(e.getDate(),t.length),a(e,t){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:(e,t)=>pZ(e.getHours()%12||12,t.length),H:(e,t)=>pZ(e.getHours(),t.length),m:(e,t)=>pZ(e.getMinutes(),t.length),s:(e,t)=>pZ(e.getSeconds(),t.length),S(e,t){const n=t.length,r=e.getMilliseconds();return pZ(Math.trunc(r*Math.pow(10,n-3)),t.length)}},gZ="midnight",vZ="noon",yZ="morning",bZ="afternoon",_Z="evening",wZ="night",EZ={G:function(e,t,n){const r=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){const t=e.getFullYear(),r=t>0?t:1-t;return n.ordinalNumber(r,{unit:"year"})}return mZ.y(e,t)},Y:function(e,t,n,r){const i=dZ(e,r),a=i>0?i:1-i;if("YY"===t){return pZ(a%100,2)}return"Yo"===t?n.ordinalNumber(a,{unit:"year"}):pZ(a,t.length)},R:function(e,t){return pZ(cZ(e),t.length)},u:function(e,t){return pZ(e.getFullYear(),t.length)},Q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return pZ(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return pZ(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){const r=e.getMonth();switch(t){case"M":case"MM":return mZ.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){const r=e.getMonth();switch(t){case"L":return String(r+1);case"LL":return pZ(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){const i=hZ(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):pZ(i,t.length)},I:function(e,t,n){const r=lZ(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):pZ(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getDate(),{unit:"date"}):mZ.d(e,t)},D:function(e,t,n){const r=aZ(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):pZ(r,t.length)},E:function(e,t,n){const r=e.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){const i=e.getDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return pZ(a,2);case"eo":return n.ordinalNumber(a,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){const i=e.getDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return pZ(a,t.length);case"co":return n.ordinalNumber(a,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){const r=e.getDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return pZ(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){const r=e.getHours();let i;switch(i=12===r?vZ:0===r?gZ:r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(e,t,n){const r=e.getHours();let i;switch(i=r>=17?_Z:r>=12?bZ:r>=4?yZ:wZ,t){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),n.ordinalNumber(t,{unit:"hour"})}return mZ.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getHours(),{unit:"hour"}):mZ.H(e,t)},K:function(e,t,n){const r=e.getHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):pZ(r,t.length)},k:function(e,t,n){let r=e.getHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):pZ(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getMinutes(),{unit:"minute"}):mZ.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getSeconds(),{unit:"second"}):mZ.s(e,t)},S:function(e,t){return mZ.S(e,t)},X:function(e,t,n){const r=e.getTimezoneOffset();if(0===r)return"Z";switch(t){case"X":return CZ(r);case"XXXX":case"XX":return xZ(r);default:return xZ(r,":")}},x:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"x":return CZ(r);case"xxxx":case"xx":return xZ(r);default:return xZ(r,":")}},O:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+SZ(r,":");default:return"GMT"+xZ(r,":")}},z:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+SZ(r,":");default:return"GMT"+xZ(r,":")}},t:function(e,t,n){return pZ(Math.trunc(+e/1e3),t.length)},T:function(e,t,n){return pZ(+e,t.length)}};function SZ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e>0?"-":"+",r=Math.abs(e),i=Math.trunc(r/60),a=r%60;return 0===a?n+String(i):n+String(i)+t+pZ(a,2)}function CZ(e,t){if(e%60===0){return(e>0?"-":"+")+pZ(Math.abs(e)/60,2)}return xZ(e,t)}function xZ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e>0?"-":"+",r=Math.abs(e);return n+pZ(Math.trunc(r/60),2)+t+pZ(r%60,2)}const TZ=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},RZ=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},IZ={p:RZ,P:(e,t)=>{const n=e.match(/(P+)(p+)?/)||[],r=n[1],i=n[2];if(!i)return TZ(e,t);let a;switch(r){case"P":a=t.dateTime({width:"short"});break;case"PP":a=t.dateTime({width:"medium"});break;case"PPP":a=t.dateTime({width:"long"});break;default:a=t.dateTime({width:"full"})}return a.replace("{{date}}",TZ(r,t)).replace("{{time}}",RZ(i,t))}},NZ=/^D+$/,AZ=/^Y+$/,kZ=["D","DD","YY","YYYY"];function DZ(e){return e instanceof Date||"object"===typeof e&&"[object Date]"===Object.prototype.toString.call(e)}function MZ(e){return!(!DZ(e)&&"number"!==typeof e||isNaN(+eZ(e)))}const LZ=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,OZ=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,PZ=/^'([^]*?)'?$/,jZ=/''/g,FZ=/[a-zA-Z]/;function UZ(e,t,n){var r,i,a,o,s,c,u,l,d,f,h,p,m,g;const v=QJ(),y=null!==(r=null!==(i=null===n||void 0===n?void 0:n.locale)&&void 0!==i?i:v.locale)&&void 0!==r?r:KJ,b=null!==(a=null!==(o=null!==(s=null!==(c=null===n||void 0===n?void 0:n.firstWeekContainsDate)&&void 0!==c?c:null===n||void 0===n||null===(u=n.locale)||void 0===u||null===(u=u.options)||void 0===u?void 0:u.firstWeekContainsDate)&&void 0!==s?s:v.firstWeekContainsDate)&&void 0!==o?o:null===(l=v.locale)||void 0===l||null===(l=l.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==a?a:1,_=null!==(d=null!==(f=null!==(h=null!==(p=null===n||void 0===n?void 0:n.weekStartsOn)&&void 0!==p?p:null===n||void 0===n||null===(m=n.locale)||void 0===m||null===(m=m.options)||void 0===m?void 0:m.weekStartsOn)&&void 0!==h?h:v.weekStartsOn)&&void 0!==f?f:null===(g=v.locale)||void 0===g||null===(g=g.options)||void 0===g?void 0:g.weekStartsOn)&&void 0!==d?d:0,w=eZ(e,null===n||void 0===n?void 0:n.in);if(!MZ(w))throw new RangeError("Invalid time value");let E=t.match(OZ).map((e=>{const t=e[0];if("p"===t||"P"===t){return(0,IZ[t])(e,y.formatLong)}return e})).join("").match(LZ).map((e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:BZ(e)};if(EZ[t])return{isToken:!0,value:e};if(t.match(FZ))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}}));y.localize.preprocessor&&(E=y.localize.preprocessor(w,E));const S={firstWeekContainsDate:b,weekStartsOn:_,locale:y};return E.map((r=>{if(!r.isToken)return r.value;const i=r.value;(null!==n&&void 0!==n&&n.useAdditionalWeekYearTokens||!function(e){return AZ.test(e)}(i))&&(null!==n&&void 0!==n&&n.useAdditionalDayOfYearTokens||!function(e){return NZ.test(e)}(i))||function(e,t,n){const r=function(e,t,n){const r="Y"===e[0]?"years":"days of the month";return"Use `".concat(e.toLowerCase(),"` instead of `").concat(e,"` (in `").concat(t,"`) for formatting ").concat(r," to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md")}(e,t,n);if(console.warn(r),kZ.includes(e))throw new RangeError(r)}(i,t,String(e));return(0,EZ[i[0]])(w,i,y.localize,S)})).join("")}function BZ(e){const t=e.match(PZ);return t?t[1].replace(jZ,"'"):e}const VZ=()=>{let{token:e}=En((e=>e.auth)),t=(0,a.useRef)(null),n=(0,a.useRef)(null);const[r,i]=(0,a.useState)(null);(0,a.useEffect)((()=>{e&&o("/")}),[e]);let o=qe(),s=kn(),[c,u]=(0,a.useState)({password:"",confirmPassword:"",firstName:"",email:"",gender:"",surname:""}),l=e=>{let t=e.currentTarget.name,n=e.currentTarget.value;"email"==t&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?e.target.classList.remove("is-invalid"):e.target.classList.add("is-invalid")),"confirmPassword"==t&&(c.password===n?e.target.classList.remove("is-invalid"):e.target.classList.add("is-invalid")),console.log(d(d({},c),{},{[t]:n})),u((e=>d(d({},e),{},{[t]:n})))},[f,h]=(0,a.useState)({}),p=(0,a.useCallback)((async e=>{try{pa.post("/auth/signup",c).then((e=>{if(201===e.status){Pn()("#signup-form input").val(""),Pn()(".signup-container").fadeOut("fast");let t=JSON.stringify(e.data);localStorage.setItem("user",t),s(AJ(e.data.accessToken)),window.location.reload()}else h(e.data)}))}catch(e){console.log(e)}}),[c]),m=(0,a.useCallback)((e=>{o("/portfolio")}),[]);return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{className:"signup-container",children:[(0,kt.jsxs)("div",{id:"signup-form",children:[(0,kt.jsx)("h1",{className:"text-center login-heading primary-color mb-3 fw-bold",children:"ICS - Signup"}),(0,kt.jsxs)("div",{className:"forms-container",children:[(0,kt.jsxs)("div",{className:"full-name",children:[(0,kt.jsx)("input",{onChange:l,name:"firstName",className:"first-name field",type:"text",placeholder:"First Name"}),(0,kt.jsx)("input",{name:"surname",onChange:l,className:"surname field",type:"text",placeholder:"Surame"})]}),(0,kt.jsxs)("div",{className:"form-group",children:[(0,kt.jsx)("input",{onChange:l,name:"email",className:"email field",type:"text",placeholder:"Email address or phone number"}),(0,kt.jsx)("div",{className:"invalid-feedback pb-2 fw-bold",children:"Please provide a valid email."})]}),(0,kt.jsx)("input",{onChange:l,ref:t,name:"password",type:"password",className:"password field",placeholder:"Password"}),(0,kt.jsxs)("div",{className:"input-group",children:[(0,kt.jsx)("input",{onChange:l,ref:n,name:"confirmPassword",type:"password",className:"confirm-password field",placeholder:"Confirm Password"}),(0,kt.jsx)("div",{className:"invalid-feedback pb-2 fw-bold",children:"Please Match Password With Confirm Password."})]}),c.password.length>0&&(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)(PJ,{rules:["minLength","specialChar","number","capital"],minLength:6,value:c.password,onChange:e=>{t.current.value.length>0&&(e?t.current.classList.remove("is-invalid"):t.current.classList.add("is-invalid"))},className:"my-3"})}),(0,kt.jsx)(FJ(),{selected:new Date,onChange:e=>{let t=UZ(e,"dd/MM/yyyy");console.log(d(d({},c),{},{DOB:t})),u(d(d({},c),{},{DOB:t}))},dateFormat:"dd/MM/yyyy",placeholderText:"Select a date",name:"DOB",className:"field w-100"}),(0,kt.jsxs)("div",{className:"gender-container",children:[(0,kt.jsx)("div",{className:"field-title",children:"Gender"}),(0,kt.jsxs)("div",{className:"radio-container",children:[(0,kt.jsx)("label",{htmlFor:"genderMale",children:"Male"}),(0,kt.jsx)("input",{onFocus:l,type:"radio",id:"genderMale",name:"gender",value:"male"}),(0,kt.jsx)("label",{htmlFor:"genderFemale",children:"Female"}),(0,kt.jsx)("input",{onFocus:l,type:"radio",name:"gender",id:"genderFemale",value:"female"}),(0,kt.jsx)("label",{htmlFor:"genderCustom",children:"Custom"}),(0,kt.jsx)("input",{onFocus:l,type:"radio",name:"gender",id:"genderCustom",value:"custom"})]})]}),(0,kt.jsx)("p",{style:{color:"red"},children:f.message}),(0,kt.jsx)("input",{onClick:p,type:"submit",className:"submit-button field",value:"Sign UP"})]}),(0,kt.jsxs)("div",{onClick:e=>o("/login"),className:"login-button",children:[(0,kt.jsx)("i",{className:"fa fa-arrow-alt-circle-left"})," Login"]})]}),(0,kt.jsx)("div",{className:"text-center",children:(0,kt.jsxs)("div",{onClick:m.bind(void 0),className:"btn btn-primary mt-2 text-center",children:["View Ikram's Portfolio ",(0,kt.jsx)("i",{className:"fa fa-arrow-alt-circle-right"})]})})]})})};const zZ=e=>{let t=qe();const n=localStorage.getItem("user")||"{}",r=JSON.parse(n);(0,a.useEffect)((()=>{r.accessToken&&t("/")}),[r]);let[i,o]=(0,a.useState)({}),s=e=>{let t=e.target.name,n=e.target.value;o((e=>d(d({},e),{},{[t]:n})))},[c,u]=(0,a.useState)({}),l=(0,a.useCallback)((async e=>{try{let e=await pa.post("auth/login",i);if(202===e.status){let t=JSON.stringify(e.data);localStorage.setItem("user",t),window.location.reload()}else u({message:e.data.message})}catch(c){console.log(c)}}),[i]),f=(0,a.useCallback)((e=>{t("/portfolio")}),[]);return(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{id:"login",children:[(0,kt.jsxs)("div",{className:"login-container",children:[(0,kt.jsx)("div",{className:"logo-container text-center",children:(0,kt.jsx)("img",{src:"https://programmerikram.com/wp-content/uploads/2025/05/ics_logo_out_transparent.png",alt:"Connect Logo"})}),(0,kt.jsxs)("div",{id:"login-form",children:[(0,kt.jsx)("h1",{className:"text-center login-heading primary-color mb-3 fw-bold",children:"Connect - Login"}),(0,kt.jsxs)("div",{className:"forms-container",children:[(0,kt.jsx)("input",{onChange:s,className:"email",name:"email",type:"text",placeholder:"Email address or phone number"}),(0,kt.jsx)("input",{onChange:s,type:"password",name:"password",className:"password",placeholder:"Password"}),(0,kt.jsx)("p",{id:"loginErrorMsg",style:{color:"red"},children:c.message}),(0,kt.jsx)("input",{type:"submit",onClick:l,className:"submit-button",value:"Login"}),(0,kt.jsx)("span",{className:"forgot-password",children:"Forgotten password?"})]}),(0,kt.jsxs)("div",{onClick:e=>t("/signup"),className:"create-account-button",children:["Create new account ",(0,kt.jsx)("i",{className:"fa fa-arrow-alt-circle-right"})]})]})]}),(0,kt.jsx)("div",{className:"text-center",children:(0,kt.jsxs)("div",{onClick:f.bind(void 0),className:"btn btn-primary mt-2 text-center",children:["View Ikram's Portfolio ",(0,kt.jsx)("i",{className:"fa fa-arrow-alt-circle-right"})]})})]})})},WZ=()=>{const{minimizedCalls:e,restoreCall:t,endMinimizedCall:n,updateMinimizedCall:r}=gj();if(0===e.length)return null;const i=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n.toString().padStart(2,"0"))};return(0,kt.jsx)("div",{className:"minimized-call-bar",children:e.map((a=>(0,kt.jsxs)("div",{className:"minimized-call-item ".concat(a.type),children:[(0,kt.jsxs)("div",{className:"call-info",onClick:()=>(n=>{const r=e.find((e=>e.id===n));r&&r.onRestore&&r.onRestore(),t(n)})(a.id),children:[(0,kt.jsx)("div",{className:"caller-avatar",children:a.callerProfilePic?(0,kt.jsx)(Un,{profilePic:a.callerProfilePic,hasStory:!1,profile:a.callerId,size:"small"}):(0,kt.jsx)("div",{className:"default-avatar",children:(0,kt.jsx)("i",{className:"fas fa-user"})})}),(0,kt.jsxs)("div",{className:"call-details",children:[(0,kt.jsx)("span",{className:"caller-name",children:a.callerName}),(0,kt.jsxs)("div",{className:"call-status",children:[(0,kt.jsx)("span",{className:"status-indicator ".concat(a.status)}),(0,kt.jsx)("span",{className:"status-text",children:"connected"===a.status&&a.duration?i(a.duration):a.status}),"video"===a.type&&(0,kt.jsx)("i",{className:"fas fa-video call-type-icon"}),"audio"===a.type&&(0,kt.jsx)("i",{className:"fas fa-phone call-type-icon"})]})]})]}),(0,kt.jsxs)("div",{className:"call-controls",children:["connected"===a.status&&(0,kt.jsxs)(kt.Fragment,{children:["video"===a.type&&(0,kt.jsx)("button",{className:"control-btn camera-btn ".concat(a.isCameraOn?"":"disabled"),onClick:()=>(t=>{const n=e.find((e=>e.id===t));if(n&&n.onToggleCamera){const e=!n.isCameraOn;n.onToggleCamera(),r(t,{isCameraOn:e})}})(a.id),title:a.isCameraOn?"Turn off camera":"Turn on camera",children:(0,kt.jsx)("i",{className:"fas ".concat(a.isCameraOn?"fa-video":"fa-video-slash")})}),(0,kt.jsx)("button",{className:"control-btn mic-btn ".concat(a.isMuted?"disabled":""),onClick:()=>(t=>{const n=e.find((e=>e.id===t));if(n&&n.onToggleMute){const e=!n.isMuted;n.onToggleMute(),r(t,{isMuted:e})}})(a.id),title:a.isMuted?"Unmute":"Mute",children:(0,kt.jsx)("i",{className:"fas ".concat(a.isMuted?"fa-microphone-slash":"fa-microphone")})})]}),(0,kt.jsx)("button",{className:"control-btn end-btn",onClick:()=>(t=>{const r=e.find((e=>e.id===t));r&&r.onEnd&&r.onEnd(),n(t)})(a.id),title:"End call",children:(0,kt.jsx)("i",{className:"fas fa-phone-slash"})})]})]},a.id)))})},GZ=()=>(0,kt.jsx)("div",{className:"portfolio-menu-container",children:(0,kt.jsxs)("ul",{className:"portfolio-menu",children:[(0,kt.jsx)("li",{className:"portfolio-menu-item",children:(0,kt.jsx)(Tt,{to:"/portfolio",children:"Home"})}),(0,kt.jsx)("li",{className:"portfolio-menu-item",children:(0,kt.jsx)(Tt,{to:"about",children:"About"})}),(0,kt.jsx)("li",{className:"portfolio-menu-item",children:(0,kt.jsx)(Tt,{to:"resume",children:"Resume"})}),(0,kt.jsx)("li",{className:"portfolio-menu-item",children:(0,kt.jsx)(Tt,{to:"blogs",children:"Blogs"})}),(0,kt.jsx)("li",{className:"portfolio-menu-item",children:(0,kt.jsx)(Tt,{to:"contact",children:"Contact "})})]})}),HZ=()=>(0,kt.jsxs)("div",{className:"portfolio-page-container",children:[(0,kt.jsxs)("div",{className:"left-sidebar",children:[(0,kt.jsx)("h1",{className:"my-name mb-2",children:"Md Ikram"}),(0,kt.jsx)("div",{className:"image-container my-2",children:(0,kt.jsx)("img",{className:"avatar-image",src:"https://programmerikram.com/wp-content/uploads/2024/10/Ikramul-islam-transparent.png",alt:"Programmer Ikram"})}),(0,kt.jsx)("hr",{className:"my-3",style:{color:"gray"}}),(0,kt.jsx)(GZ,{})]}),(0,kt.jsx)("div",{className:"column-9 content-container",children:(0,kt.jsx)(lt,{})})]}),YZ=()=>(0,kt.jsx)("div",{children:"contact"}),qZ=()=>(0,kt.jsxs)("section",{id:"home",children:[(0,kt.jsxs)("h1",{className:"font-bold home-title color-wh",children:["Hi, I am ",(0,kt.jsx)("span",{className:"color-pc",children:"Md Ikram"})]}),(0,kt.jsx)("p",{className:"color-tc home-desc",children:"I am a frontend web developer. I can provide clean code and pixel perfect design. I also make website more & more interactive with web animations."}),(0,kt.jsx)("div",{className:"social-media-container"})]}),KZ=()=>(0,kt.jsx)("div",{}),XZ=()=>(0,kt.jsx)("div",{}),QZ=()=>(0,kt.jsx)("div",{});const JZ=e=>{let[t,n]=(0,a.useState)(!1),[r,i]=(0,a.useState)((null===e||void 0===e?void 0:e.profilePic)||"https://programmerikram.com/wp-content/uploads/2025/03/default-profilePic.png"),o=En((e=>e.profile)),s=e.type,c=e.fullName,u=e.id?e.id:"",l=!!e.profileReqs&&e.profileReqs,d=l&&l.includes(o._id);(0,a.useEffect)((()=>{e.profilePic&&Fn(r,n)}),[e]),(0,a.useEffect)((()=>{t&&i(e.profilePic)}),[t]);let f=async e=>{200===(await pa.post("/friend/reqAccept",{profile:u})).status&&(Pn()(e.target).text("Request Accepted"),Pn()(e.target).parents(".friend-grid-item").hide())},h=async e=>{try{let t=e.currentTarget;await pa.post("/friend/reqDelete",{profile:u});Pn()(t).parents(".friend-grid-item ").hide()}catch(t){console.log(t)}},p=async e=>{try{let t=e.target;pa.post("/friend/sendRequest",{profile:u});Pn()(t).text("Request Sent"),Pn()(t).parents(".friend-grid-item").fadeOut()}catch(t){console.log(t)}},m=async e=>{let t=e.currentTarget;try{pa.post("/friend/removeRequest",{profile:u});Pn()(t).siblings(".add-friend").text("Add Friend"),!d&&Pn()(t).parents(".friend-grid-item").fadeOut()}catch(n){console.log(n)}};return"req"===s?(0,kt.jsx)(a.Fragment,{children:1==t?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"friend-grid-item request",children:[(0,kt.jsx)(Tt,{to:"/".concat(u,"/"),children:(0,kt.jsx)("div",{className:"profile-picture",alt:"profile pic",style:{backgroundImage:"url(".concat(r,")")}})}),(0,kt.jsxs)("div",{className:"grid-body",children:[(0,kt.jsx)(Tt,{to:"/".concat(u,"/"),children:(0,kt.jsx)("h5",{className:"profile-name",children:c})}),(0,kt.jsx)("div",{onClick:f,className:"primary-button button",children:"Confirm"}),(0,kt.jsx)("div",{onClick:h,className:"button",children:"Delete"})]})]})}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"friend-grid-item request",children:[(0,kt.jsx)(Tt,{to:"/".concat(u,"/"),children:(0,kt.jsx)(dJ,{})}),(0,kt.jsxs)("div",{className:"grid-body",children:[(0,kt.jsx)(Tt,{to:"/".concat(u,"/"),children:(0,kt.jsx)("h5",{className:"profile-name",children:c})}),(0,kt.jsx)("div",{onClick:f,className:"primary-button button",children:"Confirm"}),(0,kt.jsx)("div",{onClick:h,className:"button",children:"Delete"})]})]})})}):(0,kt.jsx)(a.Fragment,{children:t?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"friend-grid-item suggest",children:[(0,kt.jsx)(Tt,{to:"/".concat(u,"/"),children:(0,kt.jsx)("div",{className:"profile-picture",alt:"profile pic",style:{backgroundImage:"url(".concat(r,")")}})}),(0,kt.jsxs)("div",{className:"grid-body",children:[(0,kt.jsx)(Tt,{to:"/".concat(u,"/"),children:(0,kt.jsx)("h5",{className:"profile-name",children:c})}),(0,kt.jsx)("div",{onClick:p,className:"primary-button add-friend button",children:d?"Request Sent":"Add Frind"}),(0,kt.jsx)("div",{onClick:m,className:"button remove-friend",children:"Remove"})]})]})}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"friend-grid-item suggest",children:[(0,kt.jsx)(Tt,{to:"/".concat(u,"/"),children:(0,kt.jsx)(dJ,{})}),(0,kt.jsxs)("div",{className:"grid-body",children:[(0,kt.jsx)(Tt,{to:"/".concat(u,"/"),children:(0,kt.jsx)("h5",{className:"profile-name",children:c})}),(0,kt.jsx)("div",{onClick:p,className:"primary-button add-friend button",children:d?"Request Sent":"Add Frind"}),(0,kt.jsx)("div",{onClick:m,className:"button remove-friend",children:"Remove"})]})]})})})},ZZ=e=>{let{count:t=1}=e;return Array(t).fill(0).map(((e,t)=>(0,kt.jsx)("div",{className:"friend-grid-item",style:{minHeight:"unset"},children:(0,kt.jsxs)("div",{className:"skeleton-card",style:{marginBottom:"0px"},children:[(0,kt.jsx)("div",{className:"skeleton-main",style:{marginBottom:"0",height:"270px"}}),(0,kt.jsxs)("div",{className:"skeleton-footer",style:{flexDirection:"column",marginTop:"10px"},children:[(0,kt.jsx)("div",{style:{display:"block"},className:"skeleton-line small w-100 py-2 d-block button mb-1"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("div",{className:"skeleton-line small w-100 py-2 d-block button mb-1"})]})]})},t)))};const $Z=()=>{let[e,t]=(0,a.useState)([]),[n,r]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{pa.get("/friend/getRequest/").then((e=>{t(e.data),r(e.data.length>0)})).catch((e=>{console.log(e)}))}),[]),(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{id:"friends-container",children:[(0,kt.jsxs)("div",{className:"heading",children:[(0,kt.jsx)("h4",{className:"heading-title",children:"Friend Requests"}),(0,kt.jsx)(Tt,{to:"/friends/requests",className:"view-more-btn",children:"See All"})]}),e.length>0?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"friend-grid-container",children:[e.map(((e,t)=>(0,kt.jsx)(JZ,{id:e._id,profilePic:e.profilePic,fullName:e.user.firstName+" "+e.user.surname,type:"req"},t))),0===e.length&&(0,kt.jsx)("h4",{className:"data-not-found text-center",children:"You don't have any Friend Request to show"})]})}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"friend-grid-container",children:n?(0,kt.jsx)(ZZ,{count:4}):(0,kt.jsx)("h4",{className:"data-not-found text-center",children:"You don't have any Friend Request to show"})})})]})})};const e$=()=>{let e=En((e=>e.profile)),[t,n]=(0,a.useState)([]),[r,i]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{pa.get("/friend/getSuggetions/",{params:{profile:e._id}}).then((e=>{200===e.status&&(i(0!=e.data.length),n(e.data))})).catch((e=>{console.log(e)}))}),[e._id]),(0,a.useEffect)((()=>{}),[]),(0,kt.jsx)(a.Fragment,{children:(0,kt.jsxs)("div",{id:"friends-container",className:"mb-5",children:[(0,kt.jsx)("div",{className:"heading",children:(0,kt.jsx)("h4",{className:"heading-title",children:"People You May Know"})}),t.length>0?(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"friend-grid-container",children:[t.map(((t,n)=>t.user?e.friendReqs&&e.friendReqs.includes(t._id)?(0,kt.jsx)(JZ,{profileReqs:t.friendReqs,type:"req",id:t._id,profilePic:t.profilePic,fullName:t.user.firstName+" "+t.user.surname},n):(0,kt.jsx)(JZ,{profileReqs:t.friendReqs,type:"sug",id:t._id,profilePic:t.profilePic,fullName:t.user.firstName+" "+t.user.surname},n):(0,kt.jsx)(kt.Fragment,{}))),0===t.length&&(0,kt.jsx)("h4",{className:"data-not-found text-center",children:"You don't have any Friends to Suggest"})]})}):(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"friend-grid-container",children:r?(0,kt.jsx)(ZZ,{count:4}):(0,kt.jsx)("h4",{className:"data-not-found text-center",children:"You don't have any Friends to Suggest"})})})]})})};const t$=()=>(0,kt.jsxs)(a.Fragment,{children:[(0,kt.jsx)($Z,{}),(0,kt.jsx)(e$,{})]}),n$="GET_PROFILE_REQ",r$="GET_PROFILE_SUCCESS",i$="GET_PROFILE_FAILED",a$=e=>{let t=e.profilePic,n=e.coverPic,r=d(d({},e),{},{coverPic:n,profilePic:t});return{type:r$,payload:r}},o$=()=>{(0,a.useEffect)((()=>{}),[]);let e=(0,a.useCallback)((async e=>{Pn()(e.currentTarget).addClass("active"),Pn()(e.currentTarget).siblings().removeClass("active")}),[]);return(0,kt.jsx)("div",{className:"setting-page",children:(0,kt.jsxs)("div",{className:"container py-3",children:[(0,kt.jsx)("div",{className:"row bb",children:(0,kt.jsx)("div",{className:"col",children:(0,kt.jsx)("h1",{className:"primary-color mb-3 py-0",children:" Settings Page"})})}),(0,kt.jsxs)("div",{className:"row py-3",children:[(0,kt.jsx)("div",{className:"col-md-3 br",children:(0,kt.jsx)("div",{className:"setting-groups-container",children:(0,kt.jsxs)("ul",{className:"setting-groups",children:[(0,kt.jsx)("li",{onClick:e.bind(void 0),className:"setting-groups-item active",children:(0,kt.jsxs)(Tt,{to:"/settings",children:[(0,kt.jsx)("span",{children:"Profile"}),(0,kt.jsx)("span",{children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]})}),(0,kt.jsx)("li",{onClick:e.bind(void 0),className:"setting-groups-item",children:(0,kt.jsxs)(Tt,{to:"privacy",children:[(0,kt.jsx)("span",{children:"Privacy"}),(0,kt.jsx)("span",{children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]})}),(0,kt.jsx)("li",{onClick:e.bind(void 0),className:"setting-groups-item",children:(0,kt.jsxs)(Tt,{to:"notification",children:[(0,kt.jsx)("span",{children:"Notification"}),(0,kt.jsx)("span",{children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]})}),(0,kt.jsx)("li",{onClick:e.bind(void 0),className:"setting-groups-item",children:(0,kt.jsxs)(Tt,{to:"account",children:[(0,kt.jsx)("span",{children:"Account"}),(0,kt.jsx)("span",{children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]})}),(0,kt.jsx)("li",{onClick:e.bind(void 0),className:"setting-groups-item",children:(0,kt.jsxs)(Tt,{to:"preference",children:[(0,kt.jsx)("span",{children:"Preference"}),(0,kt.jsx)("span",{children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]})}),(0,kt.jsx)("li",{onClick:e.bind(void 0),className:"setting-groups-item",children:(0,kt.jsxs)(Tt,{to:"message",children:[(0,kt.jsx)("span",{children:"Messaging"}),(0,kt.jsx)("span",{children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]})}),(0,kt.jsx)("li",{onClick:e.bind(void 0),className:"setting-groups-item",children:(0,kt.jsxs)(Tt,{to:"sound",children:[(0,kt.jsx)("span",{children:"Sounds"}),(0,kt.jsx)("span",{children:(0,kt.jsx)("i",{className:"fa fa-chevron-right"})})]})})]})})}),(0,kt.jsx)("div",{className:"col-md-6",children:(0,kt.jsx)(lt,{})})]})]})})},s$=()=>{let e=En((e=>e.profile)),t=(En((e=>e.setting)),kn()),[n,r]=(0,a.useState)({firstName:"",surname:"",nickname:"",username:"",workPlaces:[{}],schools:[{}],displayName:""});(0,a.useEffect)((()=>{null!==e&&void 0!==e&&e.user&&r({firstName:e.user.firstName||"",surname:e.user.surname||"",nickname:e.nickname||"",username:e.username||"",displayName:e.displayName||""})}),[e]);let i=(0,a.useCallback)((async e=>{r(d(d({},n),{},{[e.target.name]:e.target.value}))}),[n]),o=(0,a.useCallback)((async r=>{r.preventDefault();let i=await pa.post("/profile/update",n);200===i.status&&(t(a$(i.data)),Bt("Your Profile Updated Successfully",e.fullName,e.profilePic,""))}),[n]);const[s,c]=(0,a.useState)([{}]),[u,l]=(0,a.useState)([{}]);(0,a.useEffect)((()=>{c((null===e||void 0===e?void 0:e.workPlaces)||[{}]),l((null===e||void 0===e?void 0:e.schools)||[{}])}),[e]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"profile-setting",children:(0,kt.jsxs)("div",{className:"setting-field-container",children:[(0,kt.jsx)("h3",{className:"text-center",children:"Profile Settings"}),(0,kt.jsxs)("form",{children:[(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"firstName",children:"First Name"}),(0,kt.jsx)("input",{type:"text",onChange:i.bind(void 0),className:"form-control",id:"firstName",value:n.firstName,name:"firstName",placeholder:"Enter Frist Name"})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"surname",children:"Surname"}),(0,kt.jsx)("input",{type:"text",onChange:i.bind(void 0),className:"form-control",value:n.surname,id:"surname",name:"surname",placeholder:"Enter Last Name"})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"username",children:"Userame"}),(0,kt.jsxs)("div",{className:"input-group",children:[(0,kt.jsx)("div",{className:"input-group-prepend",children:(0,kt.jsx)("span",{className:"input-group-text",children:"@"})}),(0,kt.jsx)("input",{type:"text",className:"form-control",value:n.username,name:"username",onChange:i.bind(void 0),id:"username","aria-describedby":"emailHelp",placeholder:"Enter Username"})]})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"nickname",children:"Nickname"}),(0,kt.jsx)("input",{type:"text",onChange:i.bind(void 0),value:n.nickname,className:"form-control",id:"nickname",name:"nickname",placeholder:"Enter Nickname"})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"displayName",children:"Display Name"}),(0,kt.jsx)("input",{type:"text",onChange:i.bind(void 0),value:n.displayName,className:"form-control",id:"displayName",name:"displayName",placeholder:"Enter Display Name"})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"presentAddress",children:"Present Address"}),(0,kt.jsxs)("div",{className:"input-group",children:[(0,kt.jsx)("div",{className:"input-group-prepend",children:(0,kt.jsx)("span",{className:"input-group-text py-3",children:(0,kt.jsx)("i",{className:"fas fa-home"})})}),(0,kt.jsx)("input",{type:"text",value:e.presentAddress,onChange:i.bind(void 0),className:"form-control",id:"presentAddress",name:"presentAddress",placeholder:"Enter Present Address"})]})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"permanentAddress",children:"Permanent Address"}),(0,kt.jsxs)("div",{className:"input-group",children:[(0,kt.jsx)("div",{className:"input-group-prepend",children:(0,kt.jsxs)("span",{className:"input-group-text py-3",children:[" ",(0,kt.jsx)("i",{className:"fa fa-globe"})]})}),(0,kt.jsx)("input",{value:e.permanentAddress,type:"text",onChange:i.bind(void 0),className:"form-control",id:"permanentAddress",name:"permanentAddress",placeholder:"Enter Permanent Address"})]})]}),(0,kt.jsx)("hr",{}),(0,kt.jsxs)("div",{className:"multiple-input-container schools-container my-3 p-3",children:[(0,kt.jsx)("h4",{className:"text-center",children:"Your Schools"}),u.map(((e,t)=>(0,kt.jsxs)("div",{className:"row border border-secondary border-round my-2",children:[(0,kt.jsx)("div",{className:"col",children:(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{className:"form-label",children:"Degree"}),(0,kt.jsxs)("div",{className:"input-group",children:[(0,kt.jsx)("div",{className:"input-group-prepend",children:(0,kt.jsx)("span",{className:"input-group-text py-3",children:(0,kt.jsx)("i",{className:"fas fa-graduation-cap"})})}),(0,kt.jsx)("input",{type:"text",value:e.degree,onChange:e=>((e,t)=>{let i=[...u],a=t.currentTarget.dataset.index;i[a]={degree:t.target.value,name:u[a].name},l(i);let o=d(d({},n),{},{schools:i.filter(((e,t)=>""!==e.name||""!==e.degree))});r(o)})(0,e),placeholder:"Your Degree",className:"form-control",name:"degree","data-index":t})]})]},t)}),(0,kt.jsx)("div",{className:"col",children:(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{className:"form-label",children:"SChool Name"}),(0,kt.jsxs)("div",{className:"input-group",children:[(0,kt.jsx)("div",{className:"input-group-prepend",children:(0,kt.jsx)("span",{className:"input-group-text py-3",children:(0,kt.jsx)("i",{className:"fas fa-graduation-cap"})})}),(0,kt.jsx)("input",{type:"text",value:e.name,onChange:e=>((e,t)=>{let i=[...u],a=t.currentTarget.dataset.index;i[a]={degree:u[a].degree,name:t.target.value},l(i);let o=d(d({},n),{},{schools:i.filter(((e,t)=>""!==e.name||""!==e.degree))});r(o)})(0,e),placeholder:"School Name",className:"form-control",name:"name","data-index":t})]})]},t)})]}))),(0,kt.jsx)("button",{className:"btn btn-secondary",onClick:(e=>{e.preventDefault(),l([...u,{name:"",degree:""}])}).bind(void 0),children:"".concat(u.length>0?"Add Another School":"Add School")})]}),(0,kt.jsx)("hr",{}),(0,kt.jsxs)("div",{className:"multiple-input-container workplaces-container my-3 p-3",children:[(0,kt.jsx)("h4",{className:"text-center",children:"Your Workplaces"}),s.map(((e,t)=>(0,kt.jsxs)("div",{className:"row border border-secondary border-round my-2",children:[(0,kt.jsx)("div",{className:"col",children:(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{className:"form-label",children:"Designation"}),(0,kt.jsxs)("div",{className:"input-group",children:[(0,kt.jsx)("div",{className:"input-group-prepend",children:(0,kt.jsx)("span",{className:"input-group-text py-3",children:(0,kt.jsx)("i",{className:"fas fa-briefcase"})})}),(0,kt.jsx)("input",{type:"text",value:e.designation,onChange:e=>((e,t)=>{const i=[...s];let a=t.currentTarget.dataset.index;i[a]={designation:t.target.value,name:s[a].name},c(i);let o=d(d({},n),{},{workPlaces:i.filter(((e,t)=>""!==e.name||""!==e.designation))});r(o)})(0,e),placeholder:"Your Designation",className:"form-control",name:"designation","data-index":t})]})]},t)}),(0,kt.jsx)("div",{className:"col",children:(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{className:"form-label",children:"Company Name"}),(0,kt.jsxs)("div",{className:"input-group",children:[(0,kt.jsx)("div",{className:"input-group-prepend",children:(0,kt.jsx)("span",{className:"input-group-text py-3",children:(0,kt.jsx)("i",{className:"fas fa-briefcase"})})}),(0,kt.jsx)("input",{type:"text",value:e.name,onChange:e=>((e,t)=>{const i=[...s];let a=t.currentTarget.dataset.index;i[a]={name:t.target.value,designation:s[a].designation},c(i);let o=d(d({},n),{},{workPlaces:i.filter(((e,t)=>""!==e.name||""!==e.designation))});r(o)})(0,e),placeholder:"Workplace Name",className:"form-control",name:"name","data-index":t})]})]},t)})]}))),(0,kt.jsx)("button",{className:"btn btn-secondary",onClick:(e=>{e.preventDefault(),c([...s,{name:"",designation:""}])}).bind(void 0),children:"".concat(s.length>0?"Add Another Workplace":"Add Workplace")})]}),(0,kt.jsx)("button",{type:"submit",onClick:o.bind(void 0),className:"btn btn-primary",children:"Save Settings"})]})]})})})},c$=()=>{let e=En((e=>e.profile)),[t,n]=(0,a.useState)({userEmail:(null===e||void 0===e?void 0:e.user)&&e.user.email}),[r,i]=(0,a.useState)(!1),o=(0,a.useCallback)((async e=>{let r=e.target.id,i=e.target.value;n(d(d({},t),{},{[r]:i}))}),[]),s=(0,a.useCallback)((async n=>{if(n.preventDefault(),t.userEmail!=(null===e||void 0===e?void 0:e.user.email)){let e=await pa.post("auth/changeEmail",{email:t.userEmail});if(200==e.status){let t=JSON.stringify(e.data);return localStorage.setItem("user",t),window.location.reload()}}if(t.confirmPassword&&t.confirmPassword.length<2)return;if(t.newPassword!==t.confirmPassword)return alert("Your New password and Confirm Password is not same");let r=await pa.post("auth/changePass",t);if(400==r.status)return alert("Your Current password is invalid");if(200==r.status){let e=JSON.stringify(r.data);localStorage.setItem("user",e),window.location.reload()}}),[t]),c=(0,a.useCallback)((async e=>{e.preventDefault();let t=JSON.parse(localStorage.getItem("user")),n=await pa.post("auth/delete",{userData:t});200==n.status&&(localStorage.removeItem("user"),alert(n.data.message),window.location.reload())}),[e]),u=(0,a.useCallback)((e=>{e.preventDefault(),i(!r)}),[r]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"profile-setting",children:(0,kt.jsxs)("div",{className:"setting-field-container",children:[(0,kt.jsx)("h3",{className:"text-center",children:"Account Settings"}),(0,kt.jsxs)("form",{children:[(0,kt.jsx)("h3",{className:"fs-4",children:"Change Password"}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"userEmail",children:"Email"}),(0,kt.jsxs)("div",{className:"input-group",children:[(0,kt.jsx)("input",{onChange:o.bind(void 0),type:"email",className:"form-control",id:"userEmail",disabled:!r&&!0,value:r?t.userEmail:(null===e||void 0===e?void 0:e.user)&&(null===e||void 0===e?void 0:e.user.email),placeholder:"Email"}),(0,kt.jsx)("div",{className:"input-group-append",children:(0,kt.jsx)("button",{onClick:u.bind(void 0),className:"btn btn-danger",children:(0,kt.jsx)("i",{className:"fas fa-pen"})})})]})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"currentPassword",children:"Current Password"}),(0,kt.jsx)("input",{onChange:o.bind(void 0),type:"password",className:"form-control",id:"currentPassword",placeholder:"Current Password"})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"newPassword",children:"New Password"}),(0,kt.jsx)("input",{onChange:o.bind(void 0),type:"password",className:"form-control",id:"newPassword",placeholder:"New Password"})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"confirmPassword",children:"Confirm Password"}),(0,kt.jsx)("input",{onChange:o.bind(void 0),type:"password",className:"form-control",id:"confirmPassword",placeholder:"Confirm Password"})]}),(0,kt.jsx)("button",{type:"submit",onClick:s.bind(void 0),className:"btn btn-primary",children:"Save Settings"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("button",{onClick:c.bind(void 0),className:"btn btn-danger mt-3",children:"Delete My Account"})]})]})})})},u$=()=>(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"profile-setting",children:(0,kt.jsxs)("div",{className:"setting-field-container",children:[(0,kt.jsx)("h3",{className:"text-center",children:"Privacy Settings"}),(0,kt.jsxs)("form",{children:[(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"username",children:"Who Can See you Posts?"}),(0,kt.jsxs)("select",{className:"form-control",children:[(0,kt.jsx)("option",{value:"om",children:"Only Me"}),(0,kt.jsx)("option",{value:"fof",children:"Friend of Friends"}),(0,kt.jsx)("option",{value:"public",children:"Public"})]})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"username",children:"Who Can Sent you Friend Request?"}),(0,kt.jsxs)("select",{className:"form-control",children:[(0,kt.jsx)("option",{value:"om",children:"Only Me"}),(0,kt.jsx)("option",{value:"fof",children:"Friend of Friends"}),(0,kt.jsx)("option",{value:"public",children:"Public"})]})]}),(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"username",children:"Who Can Post on your Timeline?"}),(0,kt.jsxs)("select",{className:"form-control",children:[(0,kt.jsx)("option",{value:"om",children:"Only Me"}),(0,kt.jsx)("option",{value:"fof",children:"Friend of Friends"}),(0,kt.jsx)("option",{value:"public",children:"Public"})]})]}),(0,kt.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Save Settings"})]})]})})}),l$=()=>(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"message-setting",children:(0,kt.jsxs)("div",{className:"setting-field-container",children:[(0,kt.jsx)("h3",{className:"text-center",children:"Notification Settings"}),(0,kt.jsxs)("form",{children:[(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"friendRewReceived"}),(0,kt.jsx)("label",{className:"form-check-label",for:"friendRewReceived",children:"Friends Request Received"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"friendRewReceived",className:"form-text text-muted",children:"We Will sent you notification for each new Friends Request Received"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"friendRewAccepted"}),(0,kt.jsx)("label",{className:"form-check-label",for:"friendRewAccepted",children:"Friends Request Accpeted"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"ifriendRewAcceptedHelp",className:"form-text text-muted",children:"We Will sent you notification for each new Friends Request Accpeted"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"newMessageReceived"}),(0,kt.jsx)("label",{className:"form-check-label",for:"newMessageReceived",children:"New Message Received"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"isNotificationHelp",className:"form-text text-muted",children:"We Will sent you notification for each Message Received"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"newFriendPost"}),(0,kt.jsx)("label",{className:"form-check-label",for:"newFriendPost",children:"New Frieds's Post"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"isNotificationHelp",className:"form-text text-muted",children:"We Will sent you notification for each Frieds's new Post"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"newFriendStory"}),(0,kt.jsx)("label",{className:"form-check-label",for:"newFriendStory",children:"New Frieds's Story"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"isNotificationHelp",className:"form-text text-muted",children:"We Will sent you notification for each Frieds's new Story"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"newFriendWatch"}),(0,kt.jsx)("label",{className:"form-check-label",for:"newFriendWatch",children:"New Frieds's Watch"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"newFriendWatchHelp",className:"form-text text-muted",children:"We Will sent you notification for each Frieds's new Watch"})]}),(0,kt.jsx)("hr",{}),(0,kt.jsx)("h4",{className:"text-center",children:"Email Notifications"}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"friendRewReceivedEmail"}),(0,kt.jsx)("label",{className:"form-check-label",for:"friendRewReceivedEmail",children:"Friends Request Received"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"friendRewReceivedEmail",className:"form-text text-muted",children:"We Will sent you notification for each new Friends Request Received"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"friendRewAcceptedEmail"}),(0,kt.jsx)("label",{className:"form-check-label",for:"friendRewAcceptedEmail",children:"Friends Request Accpeted"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"ifriendRewAcceptedEmailHelp",className:"form-text text-muted",children:"We Will sent you notification for each new Friends Request Accpeted"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"newMessageReceivedEmail"}),(0,kt.jsx)("label",{className:"form-check-label",for:"newMessageReceivedEmail",children:"New Message Received"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"isNotificationEmailHelp",className:"form-text text-muted",children:"We Will sent you notification for each Message Received"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"newFriendPostEmail"}),(0,kt.jsx)("label",{className:"form-check-label",for:"newFriendPostEmail",children:"New Frieds's Post"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"newFriendPostEmailHelp",className:"form-text text-muted",children:"We Will sent you notification for each Frieds's new Post"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"newFriendStoryEmail"}),(0,kt.jsx)("label",{className:"form-check-label",for:"newFriendStoryEmail",children:"New Frieds's Story"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"isNotificationHelp",className:"form-text text-muted",children:"We Will sent you notification for each Frieds's new Story"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{type:"checkbox",className:"form-check-input",id:"newFriendWatchEmail"}),(0,kt.jsx)("label",{className:"form-check-label",for:"newFriendWatchEmail",children:"New Frieds's Watch"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"newFriendWatchHelp",className:"form-text text-muted",children:"We Will sent you notification for each Frieds's new Watch"})]}),(0,kt.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Save Settings"})]})]})})}),d$=()=>{let e=kn(),t=En((e=>e.setting)),n=(0,a.useCallback)((async t=>{let n=t.currentTarget.checked,r=await pa.post("setting/update",{isShareEmotion:n});200==r.status&&e(_j(r.data))}),[t]),r=(0,a.useCallback)((async t=>{let n=t.currentTarget.checked,r=await pa.post("setting/update",{showIsTyping:n});200==r.status&&e(_j(r.data))}),[t]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"message-setting",children:(0,kt.jsxs)("div",{className:"setting-field-container",children:[(0,kt.jsx)("h3",{className:"text-center",children:"Message Settings"}),(0,kt.jsxs)("form",{children:[(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{checked:!0===t.showIsTyping,type:"checkbox",onChange:r.bind(void 0),className:"form-check-input",id:"showTyping"}),(0,kt.jsx)("label",{className:"form-check-label",for:"showTyping",children:"Show Typing"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"showTypingChangeText",className:"form-text text-muted",children:"It will show your typing message to your friends inbox before sending"})]}),(0,kt.jsxs)("div",{className:"form-check form-switch my-3",children:[(0,kt.jsx)("input",{checked:!0===t.isShareEmotion,type:"checkbox",onChange:n.bind(void 0),className:"form-check-input",id:"shareEmotionCheck"}),(0,kt.jsx)("label",{className:"form-check-label",for:"shareEmotionCheck",children:"Share Face Mode"}),(0,kt.jsx)("br",{}),(0,kt.jsx)("small",{id:"emailHelp",className:"form-text text-muted",children:"We'll access your camera to recognize your mode by scanning your face"})]}),(0,kt.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Save Settings"})]})]})})})},f$=()=>{let e=En((e=>e.setting)),t=kn(),[n,r]=(0,a.useState)({themeMode:e.themeMode||"dark"}),i=(0,a.useCallback)((async e=>{let t=e.target.name,n=e.target.value;r((e=>d(d({},e),{},{[t]:n})))}),[n]),o=(0,a.useCallback)((async e=>{e.preventDefault();let r=await pa.post("setting/update",d({},n));200==r.status&&t(_j(r.data))}),[]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"profile-setting",children:(0,kt.jsxs)("div",{className:"setting-field-container",children:[(0,kt.jsx)("h3",{className:"text-center",children:"Preference Settings"}),(0,kt.jsxs)("form",{children:[(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"themeMode",children:"Theme Mode"}),(0,kt.jsxs)("select",{value:n.themeMode||"dark",onChange:i.bind(void 0),className:"form-control",name:"themeMode",id:"themeMode",children:[(0,kt.jsx)("option",{value:"default",children:"Default"}),(0,kt.jsx)("option",{value:"dark",children:"Dark"}),(0,kt.jsx)("option",{value:"light",children:"Light"})]})]}),(0,kt.jsx)("button",{onClick:o.bind(void 0),type:"submit",className:"btn btn-primary",children:"Save Settings"})]})]})})})},h$=()=>{let e=En((e=>e.setting)),t=kn(),[n,r]=(0,a.useState)({ringtone:e.ringtone});(0,a.useEffect)((()=>{e.ringtone>0&&r({ringtone:e.ringtone||1})}),[e]);let i=(0,a.useCallback)((async e=>{let t=e.target.name,n=e.target.value;r((e=>d(d({},e),{},{[t]:n})))}),[n]),o=(0,a.useCallback)((async e=>{e.preventDefault();let r=await pa.post("setting/update",d({},n));200==r.status&&t(_j(r.data))}),[n,e]);return(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsx)("div",{className:"profile-setting",children:(0,kt.jsxs)("div",{className:"setting-field-container",children:[(0,kt.jsx)("h3",{className:"text-center",children:"Sound Settings"}),(0,kt.jsxs)("form",{children:[(0,kt.jsxs)("div",{className:"form-group mb-2",children:[(0,kt.jsx)("label",{for:"ringTone",children:"Calling Ringtones"}),(0,kt.jsx)("select",{value:n.ringtone,onChange:i.bind(void 0),className:"form-control",name:"ringtone",id:"ringTone",children:yJ.map(((e,t)=>(0,kt.jsx)("option",{value:"".concat(e.id),children:e.name},t)))})]}),(0,kt.jsx)("button",{onClick:o.bind(void 0),type:"submit",className:"btn btn-primary",children:"Save Settings"})]})]})})})},p$=e=>{let{socket:t}=e;const n=En((e=>e.profile)),[r,i]=(0,a.useState)(""),[o,s]=(0,a.useState)(""),[c,u]=(0,a.useState)(!1),[l,d]=(0,a.useState)(null),f=(0,a.useRef)(pj().createClient({mode:"rtc",codec:"vp8"})).current,h=(0,a.useRef)(),p=(0,a.useRef)(),m=(0,a.useRef)([]);(0,a.useEffect)((()=>{null!==n&&void 0!==n&&n._id&&i(n._id)}),[n]),(0,a.useEffect)((()=>{if(t)return t.on("connect",(()=>console.log("Socket connected",t.id))),t.on("agora-incoming-call",(e=>{let{from:n,channelName:r}=e;console.log("Incoming call from",n,r),window.confirm("Incoming call. Accept?")&&(t.emit("agora-answer-call",{to:n,channelName:r}),g(r))})),t.on("agora-call-accepted",(e=>{let{channelName:t}=e;g(t)})),()=>{t.off("agora-incoming-call"),t.off("agora-call-accepted")}}),[t]);const g=async e=>{u(!0),d(e);const{appId:t,token:n}=await(async e=>{const{data:t}=await pa.post("/agora/token",{channelName:e});return t})(e);await f.join(t,e,n,r),m.current=await pj().createMicrophoneAndCameraTracks(),m.current[1].play(h.current),await f.publish(m.current),f.on("user-published",(async(e,t)=>{if(await f.subscribe(e,t),"video"===t){let t=document.getElementById(e.uid);t||(t=document.createElement("div"),t.id=e.uid,t.style.width="400px",t.style.height="300px",p.current.appendChild(t)),e.videoTrack.play(t)}"audio"===t&&e.audioTrack.play()})),f.on("user-unpublished",(e=>{const t=document.getElementById(e.uid);t&&t.remove()}))};return(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h1",{children:"Video Call"}),(0,kt.jsx)("h2",{children:"Ikram ID: 67bf1e4009395add03e1e234"})," ",(0,kt.jsx)("h2",{children:"Atik ID: 67e431d61e4463f7adfa544e"}),c?(0,kt.jsxs)("div",{className:"flex gap-4",children:[(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{children:"Me"}),(0,kt.jsx)("div",{ref:h,style:{width:"400px",height:"300px",background:"#000"}})]}),(0,kt.jsxs)("div",{children:[(0,kt.jsx)("h3",{children:"Friend"}),(0,kt.jsx)("div",{ref:p,style:{width:"400px",height:"300px",background:"#222"}})]}),(0,kt.jsx)("button",{onClick:async()=>{m.current.forEach((e=>e.close())),await f.leave(),u(!1),d(null),p.current&&(p.current.innerHTML="")},children:"End Call"})]}):(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)("input",{type:"text",placeholder:"Friend ID",value:o,onChange:e=>s(e.target.value)}),(0,kt.jsxs)("button",{onClick:()=>{if(!o)return alert("Enter friend's ID");const e="".concat(r,"-").concat(o);d(e),t.emit("agora-call-user",{to:o,channelName:e})},children:["Call ",o]})]})]})},m$=()=>(0,kt.jsx)("div",{children:(0,kt.jsx)("iframe",{style:{minHeight:"90vh",minWidth:"100vw"},src:"https://youtube.com"})}),g$=()=>{let{videoId:e}=Xe(),[t,n]=(0,a.useState)({}),[r,i]=(0,a.useState)(""),o=qe();(0,a.useEffect)((()=>{e&&((e,t)=>{hc((n=>{if(!n)return;const r=n.transaction("videos","readonly").objectStore("videos").get(e);r.onsuccess=()=>{const n=r.result;if(n){const e=URL.createObjectURL(n.blob);t(e,n.metadata)}else console.warn("No video found with ID:",e)}}))})(e,((e,t)=>{n(t),i(e)}))}),[e]);return(0,kt.jsx)("div",{className:"single-saved-video-page",children:(0,kt.jsx)("div",{className:"container py-3",children:(0,kt.jsx)("div",{className:"row",children:(0,kt.jsx)("div",{className:"col-md-6 offset-md-3",children:(0,kt.jsxs)("div",{className:"saved-video-card card bg-dark text-white",children:[r&&(0,kt.jsx)("video",{className:"card-img-top",controls:!0,src:r,style:{width:"100%"}}),(0,kt.jsxs)("div",{className:"card-body",children:[(0,kt.jsx)("h5",{className:"card-title fs-4 text-capitalize",children:t.caption}),(0,kt.jsx)("button",{onClick:()=>{mc(e),o("/downloads")},className:"btn btn-danger",children:"Delete"})]})]})})})})})},v$=e=>{let{videoData:t,videoUrl:n}=e,r=qe();if(t)return(0,kt.jsx)("div",{className:"col-md-4",children:(0,kt.jsxs)("div",{className:"saved-video-card card bg-dark text-white",onClick:()=>{t&&r("/downloads/".concat(t._id))},children:[(0,kt.jsx)("video",{className:"card-img-top",src:n,style:{width:"100%"}}),(0,kt.jsxs)("div",{className:"card-body",children:[(0,kt.jsx)("h5",{className:"card-title fs-4 text-capitalize mt-0",children:t.caption}),(0,kt.jsx)(Tt,{className:"btn btn-primary d-inline-block",style:{marginRight:"5px"},to:"/downloads/".concat(t._id),children:"View"}),(0,kt.jsx)("button",{className:"btn btn-danger",onClick:e=>{t&&(mc(t._id),window.location.reload())},children:"Delete"})]})]})})},y$=()=>{let[e,t]=(0,a.useState)([]);return(0,a.useEffect)((()=>{var e;e=e=>{console.log(e),t(e)},hc((t=>{if(!t)return e([]);const n=t.transaction("videos","readonly").objectStore("videos").getAll();n.onsuccess=()=>{const t=n.result.map((e=>({id:e.id,metadata:e.metadata,videoURL:URL.createObjectURL(e.blob)})));e(t)},n.onerror=()=>{console.error("Failed to fetch videos from IndexedDB"),e([])}}))}),[]),(0,kt.jsx)(kt.Fragment,{children:(0,kt.jsxs)("div",{className:"download-page container",children:[(0,kt.jsx)("h1",{children:"Saved Videos"}),(0,kt.jsx)("div",{className:"saved-videos-container",children:(0,kt.jsx)("div",{className:"row",children:e&&e.map(((e,t)=>(0,kt.jsx)(v$,{videoData:e.metadata,videoUrl:e.videoURL},t)))})})]})})};n(246);function b$(e,t){new Notification("New Message!",{body:e.message,icon:"https://programmerikram.com/wp-content/uploads/2025/03/ics_logo.png"}).onclick=()=>{window.open("".concat("https://programmerikram.com/","/message/").concat(t))}}const _$=()=>{const e=kn();let{token:t}=En((e=>e.auth));const n=En((e=>e.option.isLoading)),r=Xe(),i=(0,a.useRef)(null),[o,s]=(0,a.useState)(!document.hidden),c=JSON.parse(localStorage.getItem("user")||"{}").profile;(0,a.useEffect)((()=>{t&&pa.get("setting",{params:{profileId:c}}).then((t=>{200==t.status&&e(_j(t.data))}))}),[t]);const u=(e,t,n,r)=>{null===i||void 0===i||i.current.play(),Ut(e,t,n,r)};return(0,a.useEffect)((()=>{c&&(pa.get("message/chatList",{params:{profileId:c}}).then((t=>{var n;e(kc(t.data,!0)),console.log("oldMessages",t.data),e(kc(null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.reverse(),!0))})),pa.get("notification/",{params:{profileId:c}}).then((t=>{console.log("oldNotifications",t.data),e(as(null===t||void 0===t?void 0:t.data))})))}),[c]),(0,a.useEffect)((()=>{if(c)return Jo.on("newNotification",(t=>{e({type:ts,payload:t}),u(t.text,!1,t.icon,t.link)})),Jo.on("newMessageToUser",(t=>{let{updatedMessage:n,senderName:r,senderPP:i}=t;e(Dc(n)),u(n.message,r,i,"/message/"+n.senderId)})),Jo.on("bumpUser",(e=>{let{friendProfileData:t,myProfileData:n}=e;console.log("bumpUser",t,n),u("".concat(t.fullName," Bumped you"),t.fullName,t.profilePic,"/message/"+t._id)})),()=>{Jo.off("oldNotifications"),Jo.off("newNotification"),Jo.off("oldMessages"),Jo.off("newMessageToUser"),Jo.off("bumpUser")}}),[Jo,c,e]),(0,a.useEffect)((()=>{const e=()=>{s(!document.hidden)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),(0,a.useEffect)((()=>(Jo.on("notification",((t,n,r)=>{1==o?(u(t.message,n,r,"/message/"+t.senderId),e(Dc(t))):Notification&&"granted"===Notification.permission?b$(t):"denied"!==Notification.permission&&Notification.requestPermission().then((e=>{"granted"===e&&b$(t)}))})),Jo.on("speak_message",(e=>{(e=>{if(!e)return;const t=new SpeechSynthesisUtterance(e);t.lang="en-US",t.rate=1,t.pitch=1,window.speechSynthesis.speak(t)})(e)})),()=>{Jo.off("notification"),Jo.off("speak_message")})),[Jo,o]),(0,a.useEffect)((()=>{var n;e((n=window.innerHeight,{type:us,payload:n})),e(ds(!1)),t&&(pa.post("/profile",{profile:c}).then((t=>{e({type:n$}),200===t.status&&e(a$(t.data))})).catch((t=>{e({type:i$,payload:t})})),"/"==window.location.pathname||e(ds(!1)))}),[r,t,e]),(0,kt.jsxs)(a.Fragment,{children:[(0,kt.jsx)("audio",{ref:i,src:"https://programmerikram.com/wp-content/uploads/2025/05/connect-message-sound.wav"}),(0,kt.jsxs)(St,{children:[n&&(0,kt.jsx)("div",{id:"site-loader",children:(0,kt.jsx)("div",{className:"loader-logo-container",children:(0,kt.jsx)("img",{src:"https://programmerikram.com/wp-content/uploads/2025/05/ics_logo_out_transparent.png",alt:"connect"})})}),(0,kt.jsx)(fs,{}),(0,kt.jsx)("div",{id:"main-container",className:n?"loading":"",children:(0,kt.jsx)(ht,{children:(0,kt.jsxs)(dt,{path:"/",children:[(0,kt.jsx)(dt,{path:"video-call",element:(0,kt.jsx)(p$,{socket:Jo})}),(0,kt.jsx)(dt,{path:"youtube",element:(0,kt.jsx)(m$,{})}),(0,kt.jsx)(dt,{path:"downloads",element:(0,kt.jsx)(y$,{})}),(0,kt.jsx)(dt,{path:"downloads/:videoId",element:(0,kt.jsx)(g$,{})}),(0,kt.jsx)(dt,{path:"login",element:(0,kt.jsx)(zZ,{})}),(0,kt.jsx)(dt,{path:"signup",element:(0,kt.jsx)(VZ,{})}),(0,kt.jsx)(dt,{index:!0,element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(js,{})})}),(0,kt.jsxs)(dt,{path:"/portfolio/",element:(0,kt.jsx)(HZ,{}),children:[(0,kt.jsx)(dt,{index:!0,element:(0,kt.jsx)(qZ,{})}),(0,kt.jsx)(dt,{path:"about",element:(0,kt.jsx)(KZ,{})}),(0,kt.jsx)(dt,{path:"resume",element:(0,kt.jsx)(QZ,{})}),(0,kt.jsx)(dt,{path:"blogs",element:(0,kt.jsx)(XZ,{})}),(0,kt.jsx)(dt,{path:"contact",element:(0,kt.jsx)(YZ,{})})]}),(0,kt.jsxs)(dt,{path:"/:profile/",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(oc,{})}),children:[(0,kt.jsx)(dt,{index:!0,element:(0,kt.jsx)(lJ,{})}),(0,kt.jsx)(dt,{path:"about",element:(0,kt.jsx)(uJ,{})}),(0,kt.jsx)(dt,{path:"friends",element:(0,kt.jsx)(pJ,{})}),(0,kt.jsx)(dt,{path:"images",element:(0,kt.jsx)(gJ,{})}),(0,kt.jsx)(dt,{path:"videos",element:(0,kt.jsx)(vJ,{})})]}),(0,kt.jsx)(dt,{path:"/story/",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)($Q,{})}),children:" "}),(0,kt.jsxs)(dt,{path:"/story/:storyId",children:[(0,kt.jsx)(dt,{index:!0,element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(ZQ,{})})}),(0,kt.jsx)(dt,{path:"comments/",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(rJ,{})})}),(0,kt.jsx)(dt,{path:"reacts/",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(nJ,{})})})]}),(0,kt.jsxs)(dt,{path:"/post/",children:[(0,kt.jsx)(dt,{path:":postId",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(TJ,{})})}),(0,kt.jsx)(dt,{path:":postId/edit",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(TJ,{})})}),(0,kt.jsx)(dt,{path:":postId/comments",element:(0,kt.jsx)(RJ,{})}),(0,kt.jsx)(dt,{path:":postId/reacts",element:(0,kt.jsx)(IJ,{})})]}),(0,kt.jsxs)(dt,{path:"/friends/",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(sc,{})}),children:[(0,kt.jsx)(dt,{index:!0,element:(0,kt.jsx)(t$,{})}),(0,kt.jsx)(dt,{path:"requests",element:(0,kt.jsx)($Z,{})}),(0,kt.jsx)(dt,{path:"suggestions",element:(0,kt.jsx)(e$,{})})]}),(0,kt.jsx)(dt,{path:"/watch",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(_c,{})}),children:" "}),(0,kt.jsx)(dt,{path:"/watch/:watchId",children:(0,kt.jsx)(dt,{index:!0,element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(sJ,{})})})}),(0,kt.jsx)(dt,{path:"/message",element:(0,kt.jsx)(XQ,{}),children:(0,kt.jsx)(dt,{path:":profile/",element:(0,kt.jsx)(oc,{})})}),(0,kt.jsx)(dt,{path:"/marketplace",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(wc,{})}),children:" "}),(0,kt.jsx)(dt,{path:"/groups",element:(0,kt.jsx)(Ec,{}),children:" "}),(0,kt.jsx)(dt,{path:"/yt-download",element:(0,kt.jsx)(Sc,{}),children:" "}),(0,kt.jsx)(dt,{path:"/settings",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(o$,{})})}),(0,kt.jsxs)(dt,{path:"/settings/",element:(0,kt.jsx)(ws,{children:(0,kt.jsx)(o$,{})}),children:[(0,kt.jsx)(dt,{index:!0,element:(0,kt.jsx)(s$,{})}),(0,kt.jsx)(dt,{path:"account",element:(0,kt.jsx)(c$,{})}),(0,kt.jsx)(dt,{path:"privacy",element:(0,kt.jsx)(u$,{})}),(0,kt.jsx)(dt,{path:"notification",element:(0,kt.jsx)(l$,{})}),(0,kt.jsx)(dt,{path:"message",element:(0,kt.jsx)(d$,{})}),(0,kt.jsx)(dt,{path:"preference",element:(0,kt.jsx)(f$,{})}),(0,kt.jsx)(dt,{path:"sound",element:(0,kt.jsx)(h$,{})})]})]})})}),(0,kt.jsxs)(kt.Fragment,{children:[(0,kt.jsx)(bJ,{myId:c}),(0,kt.jsx)(_J,{myId:c})]}),(0,kt.jsx)($,{position:"top-right",autoClose:5e3,hideProgressBar:!0,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!1,draggable:!0,pauseOnHover:!1,theme:"light",className:"custom-toast-container",icon:!1,closeButton:!1,toastClassName:"custom-toast-item"}),(0,kt.jsx)(WZ,{})]})]})};var w$=n(2285),E$=n.n(w$);window.process=E$();const S$=function(){const e=kn(),t=localStorage.getItem("user")||"{}",n=JSON.parse(t),{isExpired:r}=ys(n.accessToken||null);return(0,a.useEffect)((()=>{n.accessToken&&e(AJ(n.accessToken)),r&&e(AJ(void 0))}),[e,r]),(0,kt.jsx)(vj,{children:(0,kt.jsx)(a.Fragment,{children:(0,kt.jsx)(_$,{})})})},C$=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,6453)).then((t=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:a,getTTFB:o}=t;n(e),r(e),i(e),a(e),o(e)}))};function x$(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var T$="function"===typeof Symbol&&Symbol.observable||"@@observable",R$=function(){return Math.random().toString(36).substring(7).split("").join(".")},I$={INIT:"@@redux/INIT"+R$(),REPLACE:"@@redux/REPLACE"+R$(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+R$()}};function N$(e){if("object"!==typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function A$(e,t,n){var r;if("function"===typeof t&&"function"===typeof n||"function"===typeof n&&"function"===typeof arguments[3])throw new Error(x$(0));if("function"===typeof t&&"undefined"===typeof n&&(n=t,t=void 0),"undefined"!==typeof n){if("function"!==typeof n)throw new Error(x$(1));return n(A$)(e,t)}if("function"!==typeof e)throw new Error(x$(2));var i=e,a=t,o=[],s=o,c=!1;function u(){s===o&&(s=o.slice())}function l(){if(c)throw new Error(x$(3));return a}function d(e){if("function"!==typeof e)throw new Error(x$(4));if(c)throw new Error(x$(5));var t=!0;return u(),s.push(e),function(){if(t){if(c)throw new Error(x$(6));t=!1,u();var n=s.indexOf(e);s.splice(n,1),o=null}}}function f(e){if(!N$(e))throw new Error(x$(7));if("undefined"===typeof e.type)throw new Error(x$(8));if(c)throw new Error(x$(9));try{c=!0,a=i(a,e)}finally{c=!1}for(var t=o=s,n=0;n<t.length;n++){(0,t[n])()}return e}return f({type:I$.INIT}),(r={dispatch:f,subscribe:d,getState:l,replaceReducer:function(e){if("function"!==typeof e)throw new Error(x$(10));i=e,f({type:I$.REPLACE})}})[T$]=function(){var e,t=d;return(e={subscribe:function(e){if("object"!==typeof e||null===e)throw new Error(x$(11));function n(){e.next&&e.next(l())}return n(),{unsubscribe:t(n)}}})[T$]=function(){return this},e},r}function k$(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function D$(e){return function(t){var n=t.dispatch,r=t.getState;return function(t){return function(i){return"function"===typeof i?i(n,r,e):t(i)}}}}var M$=D$();M$.withExtraArgument=D$;const L$=M$,O$={isLoggedIn:{},profile:{},error:null},P$={user:{},token:null};let j$=[];let F$={headerHeight:null,bodyHeight:null,isLoading:!0};let U$=[];const B$=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U$,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"ADD_MESSAGE":let r=n.payload;return t.filter((e=>e._id===n.payload._id)).length>0?t:[r,...t];case Ic:let i=n.payload;return n.reset||!1?[...i]:[...t,...i];case Nc:let a=n.payload;if(!a||!a.senderId)return console.warn("NEW_MESSAGE: Invalid message payload",a),t;let o=a.senderId,s=t.filter((e=>{var t;return(null===e||void 0===e||null===(t=e.person)||void 0===t?void 0:t._id)!==o})),c=t.filter((e=>{var t;return(null===e||void 0===e||null===(t=e.person)||void 0===t?void 0:t._id)===o}));if(c.length>0&&c[0]){return[d(d({},c[0]),{},{messages:[a,...c[0].messages||[]]}),...s]}0;return[{person:{_id:o},messages:[a]},...s];case Ac:let u=n.payload.contactId;if(!u)return console.warn("SEEN_MESSAGE: Invalid contactId provided"),t;let l=t.filter((e=>{var t;return(null===e||void 0===e||null===(t=e.person)||void 0===t?void 0:t._id)!==u})),f=t.filter((e=>{var t;return(null===e||void 0===e||null===(t=e.person)||void 0===t?void 0:t._id)===u}));if(f.length>0&&null!==(e=f[0])&&void 0!==e&&e.messages&&f[0].messages.length>0){return[d(d({},f[0]),{},{messages:f[0].messages.map(((e,t)=>0===t?d(d({},e),{},{isSeen:!0}):e))}),...l]}return t;default:return t}};let V$={isShareEmotion:!1,notification:!0,showTyping:!0};const z$=[],W$=function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r];0,"function"===typeof e[i]&&(n[i]=e[i])}var a,o=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if("undefined"===typeof n(void 0,{type:I$.INIT}))throw new Error(x$(12));if("undefined"===typeof n(void 0,{type:I$.PROBE_UNKNOWN_ACTION()}))throw new Error(x$(13))}))}(n)}catch(Vc){a=Vc}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var r=!1,i={},s=0;s<o.length;s++){var c=o[s],u=n[c],l=e[c],d=u(l,t);if("undefined"===typeof d){t&&t.type;throw new Error(x$(14))}i[c]=d,r=r||d!==l}return(r=r||o.length!==Object.keys(e).length)?i:e}}({profile:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case n$:return d(d({},e),{},{isLoading:!0});case r$:return d(d({},e),{},{isLoading:!1},t.payload);case i$:return d(d({},e),{},{isLoading:!1,error:t.payload});default:return e}},auth:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case NJ:return d(d({},e),{},{token:t.payload});case"LOGOUT":return{token:void 0};case"GET_USER":return d(d({},e),{},{user:t.payload.token});default:return e}},option:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case cs:return d(d({},e),{},{headerHeight:t.payload});case ls:return d(d({},e),{},{isLoading:t.payload});case us:return d(d({},e),{},{bodyHeight:t.payload});default:return e}},notification:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_NOTIFICATIONS":return[...e];case ts:let n=t.payload;return e.filter((e=>e._id===t.payload._id)).length>0?e:[n,...e];case ns:let r=t.payload;return t.reset||!1?[...r]:[...e,...r];case rs:let i=t.payload,a=e.filter((e=>e._id!==i)),o=e.filter((e=>e._id===i));return o.length>0&&(o[0].isSeen=!0),[...a,o[0]];case is:let s=[];return e.map(((e,t)=>{s.push(d(d({},e),{},{isSeen:!0}))})),s;case"DELETE_NOTIFICATIONS":return[];default:return e}},message:B$,setting:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MODE_SHARE":return{isShareEmotion:t.payload};case"SET_NOTIFICATION":case"UPDATE_OPTION":break;case bj:return t.payload;default:return e}},post:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ma:return[...e,...t.payload];case ga:return console.log(t.payload),[t.payload,...e];case"REMOVE_POST":let n=t.payload.postId;return e.filter((e=>!e._id==n));default:return e}}}),G$=A$(W$,k$(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error(x$(15))},i={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},a=t.map((function(e){return e(i)}));return r=k$.apply(void 0,a)(n.dispatch),d(d({},n),{},{dispatch:r})}}}(L$)));G$.subscribe((()=>{console.log(G$.getState())}));const H$=G$,Y$=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function q$(e,t){navigator.serviceWorker.register(e).then((e=>{e.waiting?t&&t.onUpdate&&t.onUpdate(e):t&&t.onSuccess&&t.onSuccess(e)})).catch((e=>{console.error("Error during service worker registration:",e)}))}(function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(()=>{const t="".concat("","/service-worker.js");Y$?(function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((n=>{const r=n.headers.get("content-type");404===n.status||r&&!r.includes("javascript")?navigator.serviceWorker.ready.then((e=>{e.unregister().then((()=>{window.location.reload()}))})):q$(e,t)})).catch((()=>{console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((()=>{console.log("This web app is being served cache-first by a service worker.")}))):q$(t,e)}))}})({onSuccess:e=>{console.log("Service Worker registered successfully:",e)}});s.createRoot(document.getElementById("root")).render((0,kt.jsx)(a.StrictMode,{children:(0,kt.jsxs)(Rn,{store:H$,children:[(0,kt.jsx)("meta",{name:"viewport",content:"width=device-width,initial-scale=1"}),(0,kt.jsx)(S$,{})]})})),C$()})()})();
//# sourceMappingURL=main.f6dfe536.js.map